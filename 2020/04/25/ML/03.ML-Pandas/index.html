<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width">
<meta name="theme-color" content="#222" media="(prefers-color-scheme: light)">
<meta name="theme-color" content="#222" media="(prefers-color-scheme: dark)"><meta name="generator" content="Hexo 6.3.0">

  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png">
  <link rel="mask-icon" href="/images/logo.svg" color="#222">

<link rel="stylesheet" href="/css/main.css">

<link rel="stylesheet" href="https://fonts.loli.net/css?family=Monda:300,300italic,400,400italic,700,700italic&display=swap&subset=latin,latin-ext">

<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" integrity="sha256-HtsXJanqjKTc8vVQjO4YMhiqFoXkfBsjBWcX91T1jr8=" crossorigin="anonymous">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/animate.css/3.1.1/animate.min.css" integrity="sha256-PR7ttpcvz8qrF57fur/yAx1qXMFJeJFiA6pSzWi0OIE=" crossorigin="anonymous">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/fancybox/3.5.7/jquery.fancybox.min.css" integrity="sha256-Vzbj7sDDS/woiFS3uNKo8eIuni59rjyNGtXfstRzStA=" crossorigin="anonymous">

<script class="next-config" data-name="main" type="application/json">{"hostname":"soundmemories.github.io","root":"/","images":"/images","scheme":"Muse","darkmode":true,"version":"8.17.1","exturl":true,"sidebar":{"position":"left","display":"always","padding":18,"offset":12},"copycode":{"enable":true,"style":null},"bookmark":{"enable":true,"color":"#222","save":"auto"},"mediumzoom":true,"lazyload":false,"pangu":false,"comments":{"style":"tabs","active":null,"storage":true,"lazyload":false,"nav":null},"stickytabs":false,"motion":{"enable":true,"async":false,"transition":{"menu_item":"fadeInDown","post_block":"fadeIn","post_header":"fadeInDown","post_body":"fadeInDown","coll_header":"fadeInLeft","sidebar":"fadeInUp"}},"prism":false,"i18n":{"placeholder":"搜索...","empty":"没有找到任何搜索结果：${query}","hits_time":"找到 ${hits} 个搜索结果（用时 ${time} 毫秒）","hits":"找到 ${hits} 个搜索结果"},"path":"/search.xml","localsearch":{"enable":true,"trigger":"auto","top_n_per_article":1,"unescape":false,"preload":false}}</script><script src="/js/config.js"></script>

    <meta name="description" content="Pandas概述 Pandas 是在 NumPy 基础上建立的新程序库，提供了一种高效的 DataFrame数据结构。 DataFrame 本质上是一种带行标签和列标签、支持相同类型数据和缺失值的多维数组。 NumPy 的 ndarray 数据结构为数值计算任务中常见的干净整齐、组织良好的数据提供了许多不可或缺的功能。虽然它在这方面做得很好，但是当我们需要处理更灵活的数据任务（如为数据添">
<meta property="og:type" content="article">
<meta property="og:title" content="ML-Pandas">
<meta property="og:url" content="https://soundmemories.github.io/2020/04/25/ML/03.ML-Pandas/index.html">
<meta property="og:site_name" content="SoundMemories">
<meta property="og:description" content="Pandas概述 Pandas 是在 NumPy 基础上建立的新程序库，提供了一种高效的 DataFrame数据结构。 DataFrame 本质上是一种带行标签和列标签、支持相同类型数据和缺失值的多维数组。 NumPy 的 ndarray 数据结构为数值计算任务中常见的干净整齐、组织良好的数据提供了许多不可或缺的功能。虽然它在这方面做得很好，但是当我们需要处理更灵活的数据任务（如为数据添">
<meta property="og:locale" content="zh_CN">
<meta property="og:image" content="https://i.loli.net/2021/05/09/cyz2tvBreGuE3g1.jpg">
<meta property="og:image" content="https://i.loli.net/2021/05/09/9nHOKhaAJGTEbiu.jpg">
<meta property="article:published_time" content="2020-04-24T16:00:00.000Z">
<meta property="article:modified_time" content="2023-07-26T11:06:26.030Z">
<meta property="article:author" content="SoundMemories">
<meta property="article:tag" content="ML">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://i.loli.net/2021/05/09/cyz2tvBreGuE3g1.jpg">


<link rel="canonical" href="https://soundmemories.github.io/2020/04/25/ML/03.ML-Pandas/">



<script class="next-config" data-name="page" type="application/json">{"sidebar":"","isHome":false,"isPost":true,"lang":"zh-CN","comments":"","permalink":"https://soundmemories.github.io/2020/04/25/ML/03.ML-Pandas/","path":"2020/04/25/ML/03.ML-Pandas/","title":"ML-Pandas"}</script>

<script class="next-config" data-name="calendar" type="application/json">""</script>
<title>ML-Pandas | SoundMemories</title>
  








  <noscript>
    <link rel="stylesheet" href="/css/noscript.css">
  </noscript>
</head>

<body itemscope itemtype="http://schema.org/WebPage" class="use-motion">
  <div class="headband"></div>

  <main class="main">
    <div class="column">
      <header class="header" itemscope itemtype="http://schema.org/WPHeader"><div class="site-brand-container">
  <div class="site-nav-toggle">
    <div class="toggle" aria-label="切换导航栏" role="button">
        <span class="toggle-line"></span>
        <span class="toggle-line"></span>
        <span class="toggle-line"></span>
    </div>
  </div>

  <div class="site-meta">

    <a href="/" class="brand" rel="start">
      <i class="logo-line"></i>
      <p class="site-title">SoundMemories</p>
      <i class="logo-line"></i>
    </a>
  </div>

  <div class="site-nav-right">
    <div class="toggle popup-trigger" aria-label="搜索" role="button">
        <i class="fa fa-search fa-fw fa-lg"></i>
    </div>
  </div>
</div>



<nav class="site-nav">
  <ul class="main-menu menu"><li class="menu-item menu-item-home"><a href="/" rel="section"><i class="fa fa-home fa-fw"></i>首页</a></li><li class="menu-item menu-item-tags"><a href="/tags/" rel="section"><i class="fa fa-tags fa-fw"></i>标签<span class="badge">10</span></a></li><li class="menu-item menu-item-categories"><a href="/categories/" rel="section"><i class="fa fa-th fa-fw"></i>分类<span class="badge">10</span></a></li><li class="menu-item menu-item-archives"><a href="/archives/" rel="section"><i class="fa fa-archive fa-fw"></i>归档<span class="badge">127</span></a></li>
      <li class="menu-item menu-item-search">
        <a role="button" class="popup-trigger"><i class="fa fa-search fa-fw"></i>搜索
        </a>
      </li>
  </ul>
</nav>



  <div class="search-pop-overlay">
    <div class="popup search-popup"><div class="search-header">
  <span class="search-icon">
    <i class="fa fa-search"></i>
  </span>
  <div class="search-input-container">
    <input autocomplete="off" autocapitalize="off" maxlength="80"
           placeholder="搜索..." spellcheck="false"
           type="search" class="search-input">
  </div>
  <span class="popup-btn-close" role="button">
    <i class="fa fa-times-circle"></i>
  </span>
</div>
<div class="search-result-container no-result">
  <div class="search-result-icon">
    <i class="fa fa-spinner fa-pulse fa-5x"></i>
  </div>
</div>

    </div>
  </div>

</header>
        
  
  <aside class="sidebar">

    <div class="sidebar-inner sidebar-nav-active sidebar-toc-active">
      <ul class="sidebar-nav">
        <li class="sidebar-nav-toc">
          文章目录
        </li>
        <li class="sidebar-nav-overview">
          站点概览
        </li>
      </ul>

      <div class="sidebar-panel-container">
        <!--noindex-->
        <div class="post-toc-wrap sidebar-panel">
            <div class="post-toc animated"><ol class="nav"><li class="nav-item nav-level-2"><a class="nav-link" href="#pandas%E6%A6%82%E8%BF%B0"><span class="nav-number">1.</span> <span class="nav-text">Pandas概述</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#pandas%E7%9A%84%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84"><span class="nav-number">2.</span> <span class="nav-text">Pandas的数据结构</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#indexmultiindex"><span class="nav-number">2.1.</span> <span class="nav-text">Index&#x2F;MultiIndex</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#series"><span class="nav-number">2.2.</span> <span class="nav-text">Series</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#dataframe"><span class="nav-number">2.3.</span> <span class="nav-text">DataFrame</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#pandas%E7%9A%84%E6%95%B0%E6%8D%AE%E5%A4%84%E7%90%86"><span class="nav-number">3.</span> <span class="nav-text">Pandas的数据处理</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E9%80%89%E6%8B%A9%E5%92%8C%E6%9B%B4%E6%96%B0"><span class="nav-number">3.1.</span> <span class="nav-text">选择和更新</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#%E5%88%87%E7%89%87%E5%BC%8F"><span class="nav-number">3.1.1.</span> <span class="nav-text">切片式</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E7%B4%A2%E5%BC%95%E5%99%A8-locilocix"><span class="nav-number">3.1.2.</span> <span class="nav-text">索引器 loc&#x2F;iloc&#x2F;ix</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E5%8D%95%E5%80%BC%E7%B4%A2%E5%BC%95%E5%99%A8-atiat"><span class="nav-number">3.1.3.</span> <span class="nav-text">单值索引器 at&#x2F;iat</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E5%A4%9A%E7%BA%A7%E7%B4%A2%E5%BC%95"><span class="nav-number">3.1.4.</span> <span class="nav-text">多级索引</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E9%AB%98%E6%80%A7%E8%83%BD%E8%BF%87%E6%BB%A4query"><span class="nav-number">3.1.5.</span> <span class="nav-text">高性能过滤query</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E6%95%B0%E6%8D%AE%E6%9B%B4%E6%96%B0"><span class="nav-number">3.1.6.</span> <span class="nav-text">数据更新</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#pandas%E5%8F%98%E6%8D%A2"><span class="nav-number">3.2.</span> <span class="nav-text">Pandas变换</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#%E6%9B%BF%E6%8D%A2%E7%B4%A2%E5%BC%95%E4%B8%A2%E5%BC%83%E7%B4%A2%E5%BC%95"><span class="nav-number">3.2.1.</span> <span class="nav-text">替换索引&#x2F;丢弃索引</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E7%B4%A2%E5%BC%95%E5%92%8C%E7%B4%A2%E5%BC%95%E8%BD%AC%E6%8D%A2"><span class="nav-number">3.2.2.</span> <span class="nav-text">索引和索引转换</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E7%B4%A2%E5%BC%95%E5%92%8C%E6%95%B0%E6%8D%AE%E8%BD%AC%E6%8D%A2"><span class="nav-number">3.2.3.</span> <span class="nav-text">索引和数据转换</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E6%95%B0%E6%8D%AE%E9%9B%86%E5%90%88%E5%B9%B6"><span class="nav-number">3.2.4.</span> <span class="nav-text">数据集合并</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#pandas%E6%B8%85%E6%B4%97"><span class="nav-number">3.3.</span> <span class="nav-text">Pandas清洗</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#%E7%BC%BA%E5%A4%B1%E5%80%BC%E5%A4%84%E7%90%86"><span class="nav-number">3.3.1.</span> <span class="nav-text">缺失值处理</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E5%88%A0%E9%99%A4%E9%87%8D%E5%A4%8D%E6%95%B0%E6%8D%AE"><span class="nav-number">3.3.2.</span> <span class="nav-text">删除重复数据</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E8%87%AA%E5%AE%9A%E4%B9%89%E5%A4%84%E7%90%86apply"><span class="nav-number">3.3.3.</span> <span class="nav-text">自定义处理apply</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E5%AD%97%E7%AC%A6%E4%B8%B2%E5%A4%84%E7%90%86str.ufunc%E6%AD%A3%E5%88%99"><span class="nav-number">3.3.4.</span> <span class="nav-text">字符串处理str.ufunc&#x2F;正则</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#pandas%E8%BF%90%E7%AE%97"><span class="nav-number">3.4.</span> <span class="nav-text">Pandas运算</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#%E9%80%9A%E7%94%A8%E8%BF%90%E7%AE%97"><span class="nav-number">3.4.1.</span> <span class="nav-text">通用运算</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E9%AB%98%E6%80%A7%E8%83%BD%E8%BF%90%E7%AE%97eval"><span class="nav-number">3.4.2.</span> <span class="nav-text">高性能运算eval</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E7%BB%9F%E8%AE%A1%E8%BF%90%E7%AE%97"><span class="nav-number">3.4.3.</span> <span class="nav-text">统计运算</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E6%8E%92%E5%BA%8F"><span class="nav-number">3.4.4.</span> <span class="nav-text">排序</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E5%88%86%E6%A1%B6"><span class="nav-number">3.4.5.</span> <span class="nav-text">分桶</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E9%87%87%E6%A0%B7sample"><span class="nav-number">3.4.6.</span> <span class="nav-text">采样sample</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E5%88%86%E7%BB%84%E8%81%9A%E5%90%88"><span class="nav-number">3.4.7.</span> <span class="nav-text">分组聚合</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E9%80%8F%E8%A7%86%E8%A1%A8%E5%92%8C%E4%BA%A4%E5%8F%89%E8%A1%A8"><span class="nav-number">3.4.8.</span> <span class="nav-text">透视表和交叉表</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E6%97%B6%E9%97%B4%E5%BA%8F%E5%88%97"><span class="nav-number">3.4.9.</span> <span class="nav-text">时间序列</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E9%87%8D%E9%87%87%E6%A0%B7resample"><span class="nav-number">3.4.10.</span> <span class="nav-text">重采样resample</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E7%A7%BB%E5%8A%A8%E7%AA%97%E5%8F%A3"><span class="nav-number">3.4.11.</span> <span class="nav-text">移动窗口</span></a></li></ol></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#pandas%E7%BB%98%E5%9B%BE"><span class="nav-number">4.</span> <span class="nav-text">Pandas绘图</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#pandas%E6%96%87%E4%BB%B6%E6%93%8D%E4%BD%9C"><span class="nav-number">5.</span> <span class="nav-text">Pandas文件操作</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%B0%8F%E6%8A%84"><span class="nav-number">6.</span> <span class="nav-text">小抄</span></a></li></ol></div>
        </div>
        <!--/noindex-->

        <div class="site-overview-wrap sidebar-panel">
          <div class="site-author animated" itemprop="author" itemscope itemtype="http://schema.org/Person">
    <img class="site-author-image" itemprop="image" alt="SoundMemories"
      src="/images/avstar.png">
  <p class="site-author-name" itemprop="name">SoundMemories</p>
  <div class="site-description" itemprop="description">今日事，今日毕</div>
</div>
<div class="site-state-wrap animated">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
        <a href="/archives/">
          <span class="site-state-item-count">127</span>
          <span class="site-state-item-name">日志</span>
        </a>
      </div>
      <div class="site-state-item site-state-categories">
          <a href="/categories/">
        <span class="site-state-item-count">10</span>
        <span class="site-state-item-name">分类</span></a>
      </div>
      <div class="site-state-item site-state-tags">
          <a href="/tags/">
        <span class="site-state-item-count">10</span>
        <span class="site-state-item-name">标签</span></a>
      </div>
  </nav>
</div>
  <div class="links-of-author animated">
      <span class="links-of-author-item">
        <span class="exturl" data-url="aHR0cHM6Ly9naXRodWIuY29tL3NvdW5kbWVtb3JpZXM=" title="GitHub → https:&#x2F;&#x2F;github.com&#x2F;soundmemories"><i class="fab fa-github fa-fw"></i>GitHub</span>
      </span>
      <span class="links-of-author-item">
        <span class="exturl" data-url="bWFpbHRvOnNvdW5kbWVtb3JpZXNAMTYzLmNvbQ==" title="E-Mail → mailto:soundmemories@163.com"><i class="fa fa-envelope fa-fw"></i>E-Mail</span>
      </span>
  </div>
  <div class="cc-license animated" itemprop="license">
    <span class="exturl cc-opacity" data-url="aHR0cHM6Ly9jcmVhdGl2ZWNvbW1vbnMub3JnL2xpY2Vuc2VzL2J5LW5jLXNhLzQuMC8="><img src="https://cdnjs.cloudflare.com/ajax/libs/creativecommons-vocabulary/2020.11.3/assets/license_badges/small/by_nc_sa.svg" alt="Creative Commons"></span>
  </div>

        </div>
      </div>
    </div>

    
        <div class="pjax">
        </div>
  </aside>


    </div>

    <div class="main-inner post posts-expand">


  


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="https://soundmemories.github.io/2020/04/25/ML/03.ML-Pandas/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avstar.png">
      <meta itemprop="name" content="SoundMemories">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="SoundMemories">
      <meta itemprop="description" content="今日事，今日毕">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="ML-Pandas | SoundMemories">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h1 class="post-title" itemprop="name headline">
          ML-Pandas
        </h1>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>

      <time title="创建时间：2020-04-25 00:00:00" itemprop="dateCreated datePublished" datetime="2020-04-25T00:00:00+08:00">2020-04-25</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">分类于</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/ML/" itemprop="url" rel="index"><span itemprop="name">ML</span></a>
        </span>
    </span>

  
    <span class="post-meta-break"></span>
    <span class="post-meta-item" title="本文字数">
      <span class="post-meta-item-icon">
        <i class="far fa-file-word"></i>
      </span>
      <span class="post-meta-item-text">本文字数：</span>
      <span>40k</span>
    </span>
    <span class="post-meta-item" title="阅读时长">
      <span class="post-meta-item-icon">
        <i class="far fa-clock"></i>
      </span>
      <span class="post-meta-item-text">阅读时长 &asymp;</span>
      <span>2:26</span>
    </span>
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody"><h2 id="pandas概述">Pandas概述</h2>
<p>Pandas 是在 NumPy 基础上建立的新程序库，提供了一种高效的
DataFrame数据结构。 DataFrame
本质上是一种带行标签和列标签、支持相同类型数据和缺失值的多维数组。</p>
<p>NumPy 的 ndarray
数据结构为数值计算任务中常见的干净整齐、组织良好的数据提供了许多不可或缺的功能。虽然它在这方面做得很好，但是当我们需要处理更灵活的数据任务（如为数据添加标签、处理缺失值等），或者需要做一些不是对每个元素都进行广播映射的计算（如分组、透视表等）时，
NumPy
的限制就非常明显了，而这些都是分析各种非结构化数据时很重要的一部分。建立在
NumPy 数组结构上的Pandas，尤其是它的 Series 和 DataFrame
对象，为我们处理那些消耗大量时间的“数据清理”任务提供了捷径。</p>
<p>在安装 Pandas 之前，确保你的操作系统中有
NumPy。可使用<code>pip install pandas</code>安装pandas。如果你使用了
Anaconda，那么 Pandas 就已经安装好了。更详细的安装请参考<span class="exturl" data-url="aHR0cHM6Ly9wYW5kYXMucHlkYXRhLm9yZy9kb2NzL2dldHRpbmdfc3RhcnRlZC9pbnN0YWxsLmh0bWw=">官方文档<i class="fa fa-external-link-alt"></i></span>。<br />
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> pandas <span class="keyword">as</span> pd</span><br><span class="line"></span><br><span class="line"><span class="comment"># 查看包的版本</span></span><br><span class="line">pd.__version__</span><br><span class="line"><span class="comment"># 自动补全</span></span><br><span class="line">pd.&lt;TAB&gt;</span><br><span class="line"><span class="comment"># 内置的文档</span></span><br><span class="line">pd?</span><br></pre></td></tr></table></figure><br />
<span id="more"></span><br />
Jupyter 中对 Pandas 的常用配置：<br />
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># Jupyter启用多行输出</span></span><br><span class="line"><span class="keyword">from</span> IPython.core.interactiveshell <span class="keyword">import</span> InteractiveShell</span><br><span class="line">InteractiveShell.ast_node_interactivity = <span class="string">&quot;all&quot;</span> </span><br><span class="line"></span><br><span class="line"><span class="comment"># numpy常用np别名</span></span><br><span class="line"><span class="keyword">import</span> pandas <span class="keyword">as</span> pd</span><br><span class="line"><span class="comment"># 显示所有列</span></span><br><span class="line">pd.set_option(<span class="string">&#x27;display.max_columns&#x27;</span>, <span class="literal">None</span>)</span><br><span class="line"><span class="comment"># 显示所有行</span></span><br><span class="line">pd.set_option(<span class="string">&#x27;display.max_rows&#x27;</span>, <span class="literal">None</span>)</span><br><span class="line"><span class="comment"># 设置value的显示长度为100，默认为50</span></span><br><span class="line">pd.set_option(<span class="string">&#x27;max_colwidth&#x27;</span>,<span class="number">100</span>)</span><br></pre></td></tr></table></figure></p>
<h2 id="pandas的数据结构">Pandas的数据结构</h2>
<p>Pandas 的三个基本数据结构： Series、 DataFrame 和
Index。其中Series、DataFrame是最常用的数据结构，也是学习重点。</p>
<p>一般情况下把行标签（row
label）称为<strong>样本/index</strong>，列标签（column
label）称为<strong>特征/属性/column</strong>。<br />
使用默认<strong>数字索引的叫隐式</strong>，使用<strong>字符串索引的叫显式</strong>。<br />
<pre class="mermaid">
graph LR
C{行索引&#x2F;列索引}
C --&gt;|隐式| D[&quot;下标&quot;]
C --&gt;|显式| E[&quot;标签&quot;]
</pre><br />
这里的索引可以理解为泛指意思，代表整个Index。</p>
<h3 id="indexmultiindex">Index/MultiIndex</h3>
<p>Pandas数据的行标签、列标签都是Index对象。可以将它看作是一个<strong>不可变</strong>数组或有序集合（实际上是一个多集，因为
Index
对象可能会包含重复值）。这样才能够使得Index对象在多个数据结构之间安全共享。</p>
<p>Index类是普通标签对象，而其下还有子类MultiIndex，能构建多级标签。<br />
MultiIndex代表的是多级索引对象。它继承自Index，其中的多级label采用元组对象来表示。在MultiIndex内部，并不直接保存元组对象，而是使用多个Index对象保存索引中每级（level）的标签。</p>
<p>Pandas 的索引不再局限于数字，还有很多的类型：<br />
（1）Index：Index对象，最基础的索引类型。<br />
（2）Int64Index：针对整数的特殊Index。<br />
（3）MultiIndex：多层索引对象，表示单个轴上的多层索引。可以看做由元组组成的数组。<br />
（4）DatatimeIndex：存储纳秒级时间戳，用numpy的datatime64类型表示。<br />
（5）PeriodIndex：针对Period数据（时间间隔）的特殊Index。</p>
<p><strong>Ⅰ、创建对象</strong><br />
主要有Index类和MultiIndex类。<br />
<strong>1、Index类创建标签</strong><br />
<code>pd.Index(data=None, dtype=None, copy=False, name=None, fastpath=False, tupleize_cols=True)</code>：创建Index对象。<br />
（1）data：一个array-like，必须是一维的。<br />
（2）name：一个字符串，为Index的名字。<br />
（3）dtype：指定数据类型。如果为None，则默认为object。<br />
（4）copy：一个布尔值。如果为True，则拷贝输入数据data。<br />
（5）tupleize_cols：一个布尔值，如果可能则尽量创建MultiIndex对象。<br />
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">pd.Index([<span class="string">&#x27;a&#x27;</span>,<span class="string">&#x27;b&#x27;</span>,<span class="string">&#x27;c&#x27;</span>])</span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">Index([&#x27;a&#x27;, &#x27;b&#x27;, &#x27;c&#x27;], dtype=&#x27;object&#x27;)</span></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br></pre></td></tr></table></figure></p>
<p><strong>2、MultiIndex类创建多级标签</strong><br />
<code>pd.MultiIndex(levels=None, codes=None, sortorder=None, names=None, copy=False, verify_integrity=True, _set_identity=True, name=None, **kwargs)</code>：<br />
（1）levels：一个数组的列表，给出了每一级level的元素列表。<br />
（2）codes：一个数组的列表，给出了结果中每一级level对应的下标列表。<br />
（3）sortorder：一个整数，给出了已经排序好了的level级别。<br />
（4）names：一个字符串序列，给出了每一级的name。其中每个级别对应一个Index对象。<br />
（5）copy：一个布尔值。如果为True，则拷贝基础数据。<br />
（6）verify_integrity：一个布尔值。如果为True，则检测各级别的label/level都是连续的且有效的。<br />
（7）name：指定了MultiIndex的名字。<br />
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">levels = [[<span class="string">&#x27;a&#x27;</span>, <span class="string">&#x27;b&#x27;</span>], [<span class="string">&#x27;blue&#x27;</span>, <span class="string">&#x27;red&#x27;</span>]] <span class="comment"># 第一个级别的序列是[&#x27;a&#x27;, &#x27;b&#x27;],第二个级别的序列是[&#x27;blue&#x27;, &#x27;red&#x27;]</span></span><br><span class="line">codes =[[<span class="number">0</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">1</span>], [<span class="number">1</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">0</span>]]  <span class="comment"># 第一个级别的下标序列是[0, 0, 1, 1],第二个级别的下标序列是[1, 0, 1, 0]</span></span><br><span class="line">pd.MultiIndex(levels=levels,codes=codes)</span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">MultiIndex([(a,  &#x27;red&#x27;),</span></span><br><span class="line"><span class="string">            (a, &#x27;blue&#x27;),</span></span><br><span class="line"><span class="string">            (b,  &#x27;red&#x27;),</span></span><br><span class="line"><span class="string">            (b, &#x27;blue&#x27;)],</span></span><br><span class="line"><span class="string">           names=[&#x27;number&#x27;, &#x27;color&#x27;])</span></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br></pre></td></tr></table></figure></p>
<p>其他的创建方法：<br />
<code>MultiIndex.from_arrays(arrays[, sortorder, names])</code>：将二维序列转换为MultiIndex。其中arrays为array-like的序列，每个array-like按顺序的给出了一列label（一个级别）。<br />
<code>MultiIndex.from_tuples(tuples[, sortorder, names])</code>：将元组序列转换为MultiIndex。其中tuples为tuple-like的序列，每个array-like按顺序的给出了一行label对（不同级别的一对）。<br />
<code>MultiIndex.from_product(iterables[, sortorder, names])</code>：根据多个可迭代对象，用笛卡尔积生成一个MultiIndex。<br />
<code>MultiIndex.from_frame(df[, sortorder, names])</code>：将DataFrame转换为MultiIndex。<br />
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 元组</span></span><br><span class="line">tuples = [(<span class="string">&#x27;bar&#x27;</span>, <span class="string">&#x27;one&#x27;</span>),</span><br><span class="line">          (<span class="string">&#x27;bar&#x27;</span>, <span class="string">&#x27;two&#x27;</span>),</span><br><span class="line">          (<span class="string">&#x27;baz&#x27;</span>, <span class="string">&#x27;one&#x27;</span>),</span><br><span class="line">          (<span class="string">&#x27;baz&#x27;</span>, <span class="string">&#x27;two&#x27;</span>),</span><br><span class="line">          (<span class="string">&#x27;foo&#x27;</span>, <span class="string">&#x27;one&#x27;</span>),</span><br><span class="line">          (<span class="string">&#x27;foo&#x27;</span>, <span class="string">&#x27;two&#x27;</span>),</span><br><span class="line">          (<span class="string">&#x27;qux&#x27;</span>, <span class="string">&#x27;one&#x27;</span>),</span><br><span class="line">          (<span class="string">&#x27;qux&#x27;</span>, <span class="string">&#x27;two&#x27;</span>)]</span><br><span class="line">index = pd.MultiIndex.from_tuples(tuples, names=[<span class="string">&quot;first&quot;</span>, <span class="string">&quot;second&quot;</span>])</span><br><span class="line">index</span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">MultiIndex([(&#x27;bar&#x27;, &#x27;one&#x27;),</span></span><br><span class="line"><span class="string">            (&#x27;bar&#x27;, &#x27;two&#x27;),</span></span><br><span class="line"><span class="string">            (&#x27;baz&#x27;, &#x27;one&#x27;),</span></span><br><span class="line"><span class="string">            (&#x27;baz&#x27;, &#x27;two&#x27;),</span></span><br><span class="line"><span class="string">            (&#x27;foo&#x27;, &#x27;one&#x27;),</span></span><br><span class="line"><span class="string">            (&#x27;foo&#x27;, &#x27;two&#x27;),</span></span><br><span class="line"><span class="string">            (&#x27;qux&#x27;, &#x27;one&#x27;),</span></span><br><span class="line"><span class="string">            (&#x27;qux&#x27;, &#x27;two&#x27;)],</span></span><br><span class="line"><span class="string">           names=[&#x27;first&#x27;, &#x27;second&#x27;])</span></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line">s = pd.Series(np.random.randn(<span class="number">8</span>), index=index)</span><br><span class="line">s</span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">first  second</span></span><br><span class="line"><span class="string">bar    one       1.254414</span></span><br><span class="line"><span class="string">       two       1.419102</span></span><br><span class="line"><span class="string">baz    one      -0.743856</span></span><br><span class="line"><span class="string">       two      -2.517437</span></span><br><span class="line"><span class="string">foo    one      -1.507096</span></span><br><span class="line"><span class="string">       two       1.149076</span></span><br><span class="line"><span class="string">qux    one      -1.193578</span></span><br><span class="line"><span class="string">       two       1.141042</span></span><br><span class="line"><span class="string">dtype: float64</span></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="comment"># 数组</span></span><br><span class="line">arrays = [[<span class="number">1</span>, <span class="number">1</span>, <span class="number">2</span>, <span class="number">2</span>], [<span class="string">&#x27;red&#x27;</span>, <span class="string">&#x27;blue&#x27;</span>, <span class="string">&#x27;red&#x27;</span>, <span class="string">&#x27;blue&#x27;</span>]]</span><br><span class="line">pd.MultiIndex.from_arrays(arrays, names=(<span class="string">&#x27;number&#x27;</span>, <span class="string">&#x27;color&#x27;</span>))</span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">MultiIndex([(1,  &#x27;red&#x27;),</span></span><br><span class="line"><span class="string">            (1, &#x27;blue&#x27;),</span></span><br><span class="line"><span class="string">            (2,  &#x27;red&#x27;),</span></span><br><span class="line"><span class="string">            (2, &#x27;blue&#x27;)],</span></span><br><span class="line"><span class="string">           names=[&#x27;number&#x27;, &#x27;color&#x27;])</span></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="comment"># 可迭代对象</span></span><br><span class="line">iterables = [[<span class="string">&quot;bar&quot;</span>, <span class="string">&quot;baz&quot;</span>, <span class="string">&quot;foo&quot;</span>, <span class="string">&quot;qux&quot;</span>], [<span class="string">&quot;one&quot;</span>, <span class="string">&quot;two&quot;</span>]]</span><br><span class="line">pd.MultiIndex.from_product(iterables, names=[<span class="string">&quot;first&quot;</span>, <span class="string">&quot;second&quot;</span>])</span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">MultiIndex([(&#x27;bar&#x27;, &#x27;one&#x27;),</span></span><br><span class="line"><span class="string">            (&#x27;bar&#x27;, &#x27;two&#x27;),</span></span><br><span class="line"><span class="string">            (&#x27;baz&#x27;, &#x27;one&#x27;),</span></span><br><span class="line"><span class="string">            (&#x27;baz&#x27;, &#x27;two&#x27;),</span></span><br><span class="line"><span class="string">            (&#x27;foo&#x27;, &#x27;one&#x27;),</span></span><br><span class="line"><span class="string">            (&#x27;foo&#x27;, &#x27;two&#x27;),</span></span><br><span class="line"><span class="string">            (&#x27;qux&#x27;, &#x27;one&#x27;),</span></span><br><span class="line"><span class="string">            (&#x27;qux&#x27;, &#x27;two&#x27;)],</span></span><br><span class="line"><span class="string">           names=[&#x27;first&#x27;, &#x27;second&#x27;])</span></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="comment"># DataFrame</span></span><br><span class="line">df = pd.DataFrame([[<span class="string">&quot;bar&quot;</span>, <span class="string">&quot;one&quot;</span>], [<span class="string">&quot;bar&quot;</span>, <span class="string">&quot;two&quot;</span>], [<span class="string">&quot;foo&quot;</span>, <span class="string">&quot;one&quot;</span>], [<span class="string">&quot;foo&quot;</span>, <span class="string">&quot;two&quot;</span>]],columns=[<span class="string">&quot;first&quot;</span>, <span class="string">&quot;second&quot;</span>])</span><br><span class="line">pd.MultiIndex.from_frame(df)</span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">MultiIndex([(&#x27;bar&#x27;, &#x27;one&#x27;),</span></span><br><span class="line"><span class="string">            (&#x27;bar&#x27;, &#x27;two&#x27;),</span></span><br><span class="line"><span class="string">            (&#x27;foo&#x27;, &#x27;one&#x27;),</span></span><br><span class="line"><span class="string">            (&#x27;foo&#x27;, &#x27;two&#x27;)],</span></span><br><span class="line"><span class="string">           names=[&#x27;first&#x27;, &#x27;second&#x27;])</span></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br></pre></td></tr></table></figure><br />
<strong>Ⅱ、对象的属性</strong><br />
Index和MultiIndex都有的属性：<br />
<code>.T</code>：返回转置。<br />
<code>.dtype</code>：返回基础数据类型。<br />
<code>.name</code>：返回名字。<br />
<code>.shape</code>：返回基础数据形状的元组。<br />
<code>.size</code>：返回基础数据中的元素数。<br />
<code>.values</code>：返回基础数据的数组。<br />
<code>.hasnans</code>：返回布尔值。检查是否有nan值。<br />
<code>.has_duplicate</code>s：返回布尔值。检查是否有重复值。<br />
<code>.is_all_dates</code>：返回布尔值。检查是否有时间类型值。<br />
<code>.is_monotonic_decreasing</code>：返回布尔值。检查是否单调递减（包括等于）。<br />
<code>.is_monotonic_increasing</code>：返回布尔值。检查是否单调递增（包括等于）。<br />
<code>.is_unique</code>：返回布尔值。检查是否无重复值。</p>
<p>MultiIndex特有的属性和方法：<br />
<code>.names</code>：各级别名称。<br />
<code>.nlevels</code>：返回索引级别数量。<br />
<code>.levshape</code>：每个级别长度组成的元组。<br />
<code>.get_level_values(level)</code>：返回指定level的Index，用于MultiIndex。</p>
<p><strong>Ⅲ、转换数据类型</strong><br />
<code>.astype(dtype,[,copy])</code>：转换成另一个数据类型的Index。元素类型也改变。<br />
<code>.to_list()</code>：转换成列表。<br />
<code>.to_series(**kwargs)</code>：转换成Series，Series的数据和label相同。<br />
<code>.to_frame([name])</code>：转换成DataFrame。DataFrame的数据和label相同。<br />
<img src="https://i.loli.net/2021/05/09/cyz2tvBreGuE3g1.jpg" /></p>
<p><strong>Ⅳ、集合运算</strong><br />
Index的功能类似一个固定大小的集合。其类似于集合的方法有：<br />
<code>.copy([name,deep,dtype])</code>：返回一份Index的拷贝。<br />
<code>.difference(other)</code>：计算差集，返回一个Index对象。<br />
<code>.intersection(other)</code>：计算交集，返回一个Index对象。<br />
<code>.union(other)</code>：计算并集，返回一个Index对象。<br />
<code>.append(other)</code>：拼接另一个Index对象，重复的label并不会合并。返回一个新的Index对象。<br />
<code>.isin(values[, level])</code>：计算Index中各label是否在values中。<br />
<code>.delete(loc)</code>：删除下标loc处的元素，返回一个Index对象。<br />
<code>.drop(labels[, errors])</code>：删除传入的labels，返回一个Index对象。<br />
<code>.insert(loc, item)</code>：在指定下标位置插入值，返回一个Index对象。<br />
<code>.unique()</code>：返回Index中唯一值的数组，返回一个Index对象。<br />
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br></pre></td><td class="code"><pre><span class="line">i1 = pd.Index([<span class="string">&#x27;a&#x27;</span>, <span class="string">&#x27;b&#x27;</span>, <span class="string">&#x27;c&#x27;</span>])</span><br><span class="line">i2 = pd.Index([<span class="string">&#x27;a&#x27;</span>, <span class="string">&#x27;d&#x27;</span>, <span class="string">&#x27;b&#x27;</span>])</span><br><span class="line">i1</span><br><span class="line">i2</span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">Index([&#x27;a&#x27;, &#x27;b&#x27;, &#x27;c&#x27;], dtype=&#x27;object&#x27;)</span></span><br><span class="line"><span class="string">Index([&#x27;a&#x27;, &#x27;d&#x27;, &#x27;b&#x27;], dtype=&#x27;object&#x27;)</span></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line">i1.copy()</span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">Index([&#x27;a&#x27;, &#x27;b&#x27;, &#x27;c&#x27;], dtype=&#x27;object&#x27;)</span></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line">i1.difference(i2)</span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">Index([&#x27;c&#x27;], dtype=&#x27;object&#x27;)</span></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line">i1.intersection(i2)</span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">Index([&#x27;a&#x27;, &#x27;b&#x27;], dtype=&#x27;object&#x27;)</span></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line">i1.union(i2)</span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">Index([&#x27;a&#x27;, &#x27;b&#x27;, &#x27;c&#x27;, &#x27;d&#x27;], dtype=&#x27;object&#x27;)</span></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line">i1.append(i2)</span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">Index([&#x27;a&#x27;, &#x27;b&#x27;, &#x27;c&#x27;, &#x27;a&#x27;, &#x27;d&#x27;, &#x27;b&#x27;], dtype=&#x27;object&#x27;)</span></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line">i1.isin([<span class="string">&#x27;a&#x27;</span>,<span class="string">&#x27;d&#x27;</span>])</span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">array([ True, False, False])</span></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line">i1.delete([<span class="number">0</span>,<span class="number">1</span>])</span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">Index([&#x27;c&#x27;], dtype=&#x27;object&#x27;)</span></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line">i1.drop([<span class="string">&#x27;a&#x27;</span>,<span class="string">&#x27;c&#x27;</span>])</span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">Index([&#x27;b&#x27;], dtype=&#x27;object&#x27;)</span></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line">i1.insert(<span class="number">0</span>,<span class="string">&#x27;e&#x27;</span>) <span class="comment"># 不能是列表，也就是一次只能插入一个</span></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">Index([&#x27;e&#x27;, &#x27;a&#x27;, &#x27;b&#x27;, &#x27;c&#x27;], dtype=&#x27;object&#x27;)</span></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line">i1.unique()</span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">Index([&#x27;a&#x27;, &#x27;b&#x27;, &#x27;c&#x27;], dtype=&#x27;object&#x27;)</span></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br></pre></td></tr></table></figure><br />
注意，因为Index不可变，因此返回的都是新的Index对象。</p>
<h3 id="series">Series</h3>
<p>Pandas 的 Series 对象是一个带索引的一维数组。<br />
<strong>Ⅰ、创建对象</strong><br />
<code>pd.Series(data=None, index=None, dtype=None, name=None, copy=False,fastpath=False)</code><br />
（1）data：表示Series包含的数据，它可以是一个字典、array-like、标量。<br />
　　如果是序列/数组，则它必须是一维的。<br />
　　如果是字典，则字典的键指定了索引。如果你同时使用了index，则以index为准。<br />
　　如果是标量，标量会重复填充到每个索引上。<br />
（2）index：它指定了索引（可重复），是一个array-like或者一个Index对象。其值必须唯一而且可哈希，且长度与data一致。如果data是一个字典，则index将会使用该字典的key（此时index不起作用）。如果未提供，index则使用<code>np.arange(n)</code>。<br />
（3）name：一个字符串，为Series的名字。<br />
（4）dtype：指定数据类型。如果为None，则数据类型被自动推断，不一致的数据会发生强转，如果强转不成功，则单独推断每个元素类型（整体显示为object）。<br />
（5）copy：一个布尔值。如果为True，则拷贝输入数据data。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 默认索引</span></span><br><span class="line">pd.Series([<span class="number">0.25</span>, <span class="number">0.5</span>, <span class="number">0.75</span>, <span class="number">1.0</span>])</span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">0 0.25</span></span><br><span class="line"><span class="string">1 0.50</span></span><br><span class="line"><span class="string">2 0.75</span></span><br><span class="line"><span class="string">3 1.00</span></span><br><span class="line"><span class="string">dtype: float64</span></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="comment"># 数组：index给出索引，长度与数组一致，否则报错</span></span><br><span class="line">pd.Series([<span class="number">0</span>, <span class="number">1</span>, <span class="number">2</span>], index=[<span class="string">&#x27;a&#x27;</span>,<span class="string">&#x27;b&#x27;</span>,<span class="string">&#x27;c&#x27;</span>])</span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">a    0</span></span><br><span class="line"><span class="string">b    1</span></span><br><span class="line"><span class="string">c    2</span></span><br><span class="line"><span class="string">dtype: int64</span></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="comment"># 标量：index给出索引，长度不够会自动扩展</span></span><br><span class="line">pd.Series(<span class="number">0</span>, index=[<span class="string">&#x27;a&#x27;</span>,<span class="string">&#x27;b&#x27;</span>,<span class="string">&#x27;c&#x27;</span>])</span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">a    0</span></span><br><span class="line"><span class="string">b    0</span></span><br><span class="line"><span class="string">c    0</span></span><br><span class="line"><span class="string">dtype: int64</span></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="comment"># 字典：key为索引</span></span><br><span class="line">pd.Series(&#123;<span class="string">&#x27;a&#x27;</span>:<span class="number">0</span>,<span class="string">&#x27;b&#x27;</span>:<span class="number">1</span>,<span class="string">&#x27;c&#x27;</span>:<span class="number">2</span>&#125;)</span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">a    0</span></span><br><span class="line"><span class="string">b    1</span></span><br><span class="line"><span class="string">c    2</span></span><br><span class="line"><span class="string">dtype: int64</span></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br></pre></td></tr></table></figure>
<p>注意，如果一组数据的类型不一致且不能强转的，会单独推断每个元素类型（整体显示为object）：<br />
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 类型不一致，可强转</span></span><br><span class="line">pd.Series([<span class="number">0.25</span>, <span class="number">0</span>, <span class="number">0.75</span>, <span class="number">1.0</span>])</span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">0    0.25</span></span><br><span class="line"><span class="string">1    0.00</span></span><br><span class="line"><span class="string">2    0.75</span></span><br><span class="line"><span class="string">3    1.00</span></span><br><span class="line"><span class="string">dtype: float64</span></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="comment"># 类型不一致，不可强转</span></span><br><span class="line">data = pd.Series([<span class="number">0.25</span>, <span class="number">0</span>, <span class="string">&#x27;a&#x27;</span>, <span class="number">1.0</span>])</span><br><span class="line">data </span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">0    0.25</span></span><br><span class="line"><span class="string">1       0</span></span><br><span class="line"><span class="string">2       a</span></span><br><span class="line"><span class="string">3     1.1</span></span><br><span class="line"><span class="string">dtype: object</span></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="built_in">type</span>(data[<span class="number">0</span>])</span><br><span class="line"><span class="built_in">type</span>(data[<span class="number">1</span>])</span><br><span class="line"><span class="built_in">type</span>(data[<span class="number">2</span>])</span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">float</span></span><br><span class="line"><span class="string">int</span></span><br><span class="line"><span class="string">str</span></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br></pre></td></tr></table></figure><br />
除此之外，话可以使用Series类的<code>form_array</code>方法来创建，但这个方法不推荐使用，是个要被废弃的方法。：<br />
<code>pd.Series.from_array(arr, index=None, name=None, dtype=None, copy=False, fastpath=False)</code>：arr可以是一个字典、array-like、标量。其他参数同上。<br />
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">pd.Series.from_array([<span class="number">0</span>, <span class="number">2</span>, <span class="number">1</span>, <span class="number">3</span>])</span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">0    0</span></span><br><span class="line"><span class="string">1    2</span></span><br><span class="line"><span class="string">2    1</span></span><br><span class="line"><span class="string">3    3</span></span><br><span class="line"><span class="string">dtype: int64</span></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br></pre></td></tr></table></figure><br />
<strong>Ⅱ、对象的属性</strong><br />
<code>.T</code>：返回转置。<br />
<code>.name</code>：返回名字。<br />
<code>.array</code>：返回数组。<br />
<code>.index</code>：返回行标签列表。<br />
<code>.dtype/.dtypes</code>：返回基础数据类型。<br />
<code>.shape</code>：返回基础数据形状的元组。<br />
<code>.size</code>：返回基础数据中的元素数。<br />
<code>.values</code>：返回基础数据的数组。<br />
<code>.hasnans</code>：返回布尔值。检查是否有nan值。<br />
<code>.is_monotonic_decreasing</code>：返回布尔值。检查是否单调递减（包括等于）。<br />
<code>.is_monotonic_increasing</code>：返回布尔值。检查是否单调递增（包括等于）。<br />
<code>.is_unique</code>：返回布尔值。检查是否无重复值。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br></pre></td><td class="code"><pre><span class="line">data = pd.Series([<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>],index=[<span class="string">&#x27;a&#x27;</span>, <span class="string">&#x27;b&#x27;</span>, <span class="string">&#x27;c&#x27;</span>])</span><br><span class="line">data</span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">a    1</span></span><br><span class="line"><span class="string">b    2</span></span><br><span class="line"><span class="string">c    3</span></span><br><span class="line"><span class="string">dtype: int64</span></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line">data.array</span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">&lt;PandasArray&gt;</span></span><br><span class="line"><span class="string">[1, 2, 3]</span></span><br><span class="line"><span class="string">Length: 3, dtype: int64</span></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line">data.index</span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">Index([&#x27;a&#x27;, &#x27;b&#x27;, &#x27;c&#x27;], dtype=&#x27;object&#x27;)</span></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line">data.dtype</span><br><span class="line">data.dtypes</span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">dtype(&#x27;int64&#x27;)</span></span><br><span class="line"><span class="string">dtype(&#x27;int64&#x27;)</span></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line">data.shape</span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">(3,)</span></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line">data.size</span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">3</span></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line">data.values</span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">array([1, 2, 3], dtype=int64)</span></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line">data.hasnans</span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">False</span></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line">data.is_monotonic_decreasing</span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">False</span></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line">data.is_monotonic_increasing</span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">True</span></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line">data.is_unique</span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">True</span></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br></pre></td></tr></table></figure>
<p><strong>Ⅲ、转换数据类型</strong><br />
<code>.to_frame([name])</code>：转换成DataFrame。DataFrame的数据和label相同。<br />
<code>.to_dict()</code>：转换成字典，格式为<code>&#123;label-&gt;value&#125;</code>。<br />
<code>.to_list()</code>：转换成列表。<br />
<code>.to_string(buf=None, na_rep='NaN', float_format=None, header=True, index=True, length=False, dtype=False, name=False, max_rows=None)</code>：转换成字符串。<br />
（1）buf：一个StringIO-like对象，作为写入的buffer。<br />
（2）na_rep：一个字符串，代表数值NaN。<br />
（3）float_format：浮点数的格式化函数。应用于浮点列。<br />
（4）header：一个布尔值。如果为True，则添加index name。<br />
（5）index：一个布尔值。如果为True，则添加index labels。<br />
（6）length：一个布尔值。如果为True，则添加Series的长度信息。<br />
（7）dtype：一个布尔值。如果为True，则添加dtype信息。<br />
（8）name：一个布尔值。如果为True，则添加Series name。<br />
（9）max_rows：一个整数值，给出了最大转换的行数。如果为None，则转换全部。<br />
<img src="https://i.loli.net/2021/05/09/9nHOKhaAJGTEbiu.jpg" /></p>
<h3 id="dataframe">DataFrame</h3>
<p>如果将 Series 类比为带灵活索引的一维数组，那么 DataFrame
就可以看作是一种既有灵活的行索引，又有灵活列名的二维数组。<br />
DataFrame 看成是有序排列的若干 Series 对象。每一列是一个 Series
对象。</p>
<p><strong>Ⅰ、创建对象</strong><br />
<code>pd.DataFrame(data=None, index=None, columns=None, dtype=None, copy=False)</code>：<br />
（1）data：可以是一个二维数组、字典、或者DataFrame。<br />
（2）index：一个Index或者array-like对象（必须为一维的），它指定了行标签。如果未提供，则使用<code>np.arange(n)</code>。<br />
（3）columns：一个Index或者array-like对象（必须为一维的），它指定了列标签。如果未提供，则使用<code>np.arange(n)</code>。<br />
（4）dtype：指定数据类型。如果为None，则数据类型被自动推断。<br />
（5）copy：一个布尔值。如果为True，则拷贝输入数据data。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 通过Series创建单列</span></span><br><span class="line">s1 = pd.Series([<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>])</span><br><span class="line">pd.DataFrame(s1,columns=[<span class="string">&#x27;a&#x27;</span>])</span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">    a</span></span><br><span class="line"><span class="string">0   1</span></span><br><span class="line"><span class="string">1   2</span></span><br><span class="line"><span class="string">2   3</span></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="comment"># 通过字典创建多列，每一项Series为一列数据</span></span><br><span class="line">s1 = pd.Series([<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>])</span><br><span class="line">s2 = pd.Series([<span class="number">4</span>, <span class="number">5</span>, <span class="number">6</span>])</span><br><span class="line">s3 = pd.Series([<span class="number">7</span>, <span class="number">8</span>, <span class="number">9</span>])</span><br><span class="line">pd.DataFrame(&#123;<span class="string">&#x27;a&#x27;</span>:s1,<span class="string">&#x27;b&#x27;</span>:s2,<span class="string">&#x27;c&#x27;</span>:s3&#125;)</span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">    a   b   c</span></span><br><span class="line"><span class="string">0   1   4   7</span></span><br><span class="line"><span class="string">1   2   5   8</span></span><br><span class="line"><span class="string">2   3   6   9</span></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="comment"># 通过Series列表创建多列，每一项Series为一行数据</span></span><br><span class="line">s1 = pd.Series([<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>],index=[<span class="string">&#x27;a&#x27;</span>,<span class="string">&#x27;b&#x27;</span>,<span class="string">&#x27;c&#x27;</span>])</span><br><span class="line">s2 = pd.Series([<span class="number">4</span>, <span class="number">5</span>, <span class="number">6</span>],index=[<span class="string">&#x27;c&#x27;</span>,<span class="string">&#x27;d&#x27;</span>,<span class="string">&#x27;e&#x27;</span>])</span><br><span class="line">s3 = pd.Series([<span class="number">7</span>, <span class="number">8</span>, <span class="number">9</span>],index=[<span class="string">&#x27;a&#x27;</span>,<span class="string">&#x27;e&#x27;</span>,<span class="string">&#x27;c&#x27;</span>])</span><br><span class="line">data = [s1,s2,s3]</span><br><span class="line">pd.DataFrame(data)</span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">      a     b     c     d     e</span></span><br><span class="line"><span class="string">0   1.0   2.0   3.0   NaN   NaN</span></span><br><span class="line"><span class="string">1   NaN   NaN   4.0   5.0   6.0</span></span><br><span class="line"><span class="string">2   7.0   NaN   9.0   NaN   8.0</span></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="comment"># 通过 NumPy 二维数组创建</span></span><br><span class="line">pd.DataFrame(np.random.randint(<span class="number">0</span>, <span class="number">2</span>,(<span class="number">3</span>,<span class="number">2</span>)),columns=[<span class="string">&#x27;foo&#x27;</span>, <span class="string">&#x27;bar&#x27;</span>],index=[<span class="string">&#x27;a&#x27;</span>, <span class="string">&#x27;b&#x27;</span>, <span class="string">&#x27;c&#x27;</span>])</span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">  foo  bar</span></span><br><span class="line"><span class="string">a   0   1</span></span><br><span class="line"><span class="string">b   0   1</span></span><br><span class="line"><span class="string">c   0   1</span></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br></pre></td></tr></table></figure>
<p>还有其他创建方式：<br />
<code>DataFrame.from_dict(data, orient='columns', dtype=None)</code>：从字典中创建DataFrame。<br />
（1）data：是个字典，其格式为： {key:array-like}或者{key:dict}。<br />
（2）orient：指定了key为行标签还是列标签，默认列标签。参数的值为'columns'是列标签，为'index'是行标签。<br />
（3）dtype：数据类型。如果为None，则自动推断。<br />
<code>DataFrame.from_items(items, columns=None, orient='columns')</code>：从元组序列中创建DataFrame。<br />
（1）items：为元组序列，元组格式为：(key,value)，其中value为表示一维数据的序列或者Series对象。<br />
（2）columns：一个序列，给出列标签。当orient='index'时必须传入，key为行标签。当orient='columns时，key为列标签，此时columns指定的标签必须存在（和某个key相等），否则抛出异常。（2）（3）orient：指定了key为行标签还是列标签，默认列标签。参数的值为'columns'是列标签，为'index'是行标签。<br />
<code>DataFrame.from_records(data, index=None, exclude=None, columns=None, coerce_float=False, nrows=None)</code>：从结构化数据创建DataFrame。<br />
（1）data：结构化的ndarray/元组/字典。<br />
（2）index：字符串数组。代表行标签，必须和行数一致，不然报错。<br />
（3）exclude：字符串序列。要排除的列标签。<br />
（4）columns
：字符串序列。data没提供列标签名时使用。代表列标签，必须和列数一致，不然报错。<br />
（5）coerce_float：布尔值。尝试将非字符串，非数字对象（如decimal.Decimal）的值转换为浮点。对SQL结果集很有用。<br />
（6）nrows：一个整数。当data是迭代器，表示读入的行数。</p>
<p><strong>Ⅱ、对象的属性</strong><br />
<code>.T</code>：返回转置。<br />
<code>.index</code>：返回行标签列表。<br />
<code>.columns</code>：返回列标签列表。<br />
<code>.dtypes</code>：返回基础数据类型。<br />
<code>.shape</code>：返回基础数据形状的元组。<br />
<code>.size</code>：返回基础数据中的元素数。<br />
<code>.values</code>：返回基础数据的数组。<br />
<code>.empty</code>：返回布尔值。检查是否为空。nan值也算值，不是空。<br />
<code>.style</code>：返回一个 Styler
对象。用于自定义DataFrame渲染样式。可改变 HTML 和 CSS 样式。</p>
<p><strong>Ⅲ、转换数据类型</strong><br />
<code>.to_dict(*args, **kwargs)</code>：转换成字典。参数orient决定了转换方式。<br />
（1）orient
='dict'：字典的形式为<code>&#123;col_label:&#123;index_label:value&#125;&#125;</code>，默认值。<br />
（2）orient
='list'：字典的形式为<code>&#123;col_label:[values]&#125;</code>。<br />
（3）orient
='series'：字典的形式为<code>&#123;col_label:Series(values)&#125;</code>。<br />
（4）orient
='split'：字典的形式为<code>&#123;'index':[index_labels],'columns':[col_labels],'data':[values]&#125;</code>。<br />
（5）orient
='records'：字典的形式为<code>[&#123;col_label:value&#125;,...,&#123;col_label:value&#125;]</code>。<br />
（6）orient
='index'：字典的形式为<code>&#123;index_label:&#123;col_label:value&#125;&#125;</code>。<br />
<code>.to_records(index=True, convert_datetime64=True)</code>：转换成结构数组。<br />
（1）index：一个布尔值。如果为True，则结果中包含index。<br />
（2）convert_datetime64：一个布尔值，如果为True，则转换 DatetimeIndex
类型为 datetime.datetime 类型。<br />
<code>.to_string(buf=None, columns=None, col_space=None, header=True, index=True,na_rep='NaN', formatters=None, float_format=None, sparsify=None, index_names=True, justify=None, line_width=None, max_rows=None, max_cols=None, show_dimensions=False)</code>：转成字符串。<br />
（1）buf：一个StringIO-like对象，是写入的buffer。<br />
（2）columns：一个序列，指定了列标签的一个子集，该子集的数据被输出。<br />
（3）col_space：一个整数，指定了每一列的最小宽度。<br />
（4）header：一个布尔值。如果为True，则添加列标签信息。<br />
（5）index：一个布尔值。如果为True，则添加行标签信息。<br />
（6）na_rep：一个字符串，代表数值NaN。<br />
（7）float_format：浮点数的格式化函数（单参数）。应用于浮点列。<br />
（8）formatters：一个单参数函数的列表（列表长度等于列数）或者一个单参数函数的字典。</p>
<h2 id="pandas的数据处理">Pandas的数据处理</h2>
<h3 id="选择和更新">选择和更新</h3>
<p>最简单的就是快速获取n行数据。<br />
<code>.head([n=5])</code>和<code>.tail([n=5])</code>返回头部/尾部n行数据，默认显示前5行。<br />
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br></pre></td><td class="code"><pre><span class="line">data = pd.Series([<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>,<span class="number">4</span>,<span class="number">5</span>,<span class="number">6</span>],index=[<span class="string">&#x27;a&#x27;</span>,<span class="string">&#x27;b&#x27;</span>,<span class="string">&#x27;c&#x27;</span>,<span class="string">&#x27;d&#x27;</span>,<span class="string">&#x27;e&#x27;</span>,<span class="string">&#x27;f&#x27;</span>])</span><br><span class="line">data</span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">a    1</span></span><br><span class="line"><span class="string">b    2</span></span><br><span class="line"><span class="string">c    3</span></span><br><span class="line"><span class="string">d    4</span></span><br><span class="line"><span class="string">e    5</span></span><br><span class="line"><span class="string">f    6</span></span><br><span class="line"><span class="string">dtype: int64</span></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line">data.head()</span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">a    1</span></span><br><span class="line"><span class="string">b    2</span></span><br><span class="line"><span class="string">c    3</span></span><br><span class="line"><span class="string">d    4</span></span><br><span class="line"><span class="string">e    5</span></span><br><span class="line"><span class="string">dtype: int64</span></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line">data.tail()</span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">b    2</span></span><br><span class="line"><span class="string">c    3</span></span><br><span class="line"><span class="string">d    4</span></span><br><span class="line"><span class="string">e    5</span></span><br><span class="line"><span class="string">dtype: int64</span></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line">data = pd.DataFrame(&#123;<span class="string">&#x27;a&#x27;</span>:[<span class="number">0</span>,<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>,<span class="number">4</span>,<span class="number">5</span>],<span class="string">&#x27;b&#x27;</span>:[<span class="number">0</span>,<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>,<span class="number">4</span>,<span class="number">5</span>],<span class="string">&#x27;c&#x27;</span>:[<span class="number">0</span>,<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>,<span class="number">4</span>,<span class="number">5</span>]&#125;,index=[<span class="string">&#x27;e&#x27;</span>,<span class="string">&#x27;f&#x27;</span>,<span class="string">&#x27;g&#x27;</span>,<span class="string">&#x27;h&#x27;</span>,<span class="string">&#x27;i&#x27;</span>,<span class="string">&#x27;j&#x27;</span>])</span><br><span class="line">data</span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">    a   b   c</span></span><br><span class="line"><span class="string">e   0   0   0</span></span><br><span class="line"><span class="string">f   1   1   1</span></span><br><span class="line"><span class="string">g   2   2   2</span></span><br><span class="line"><span class="string">h   3   3   3</span></span><br><span class="line"><span class="string">i   4   4   4</span></span><br><span class="line"><span class="string">j   5   5   5</span></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line">data.head()</span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">    a   b   c</span></span><br><span class="line"><span class="string">e   0   0   0</span></span><br><span class="line"><span class="string">f   1   1   1</span></span><br><span class="line"><span class="string">g   2   2   2</span></span><br><span class="line"><span class="string">h   3   3   3</span></span><br><span class="line"><span class="string">i   4   4   4</span></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line">data.tail()</span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">    a   b   c</span></span><br><span class="line"><span class="string">f   1   1   1</span></span><br><span class="line"><span class="string">g   2   2   2</span></span><br><span class="line"><span class="string">h   3   3   3</span></span><br><span class="line"><span class="string">i   4   4   4</span></span><br><span class="line"><span class="string">j   5   5   5</span></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br></pre></td></tr></table></figure></p>
<h4 id="切片式">切片式</h4>
<p><strong>1、Index</strong><br />
对于Index对象，可以通过<code>[]</code>来选取数据，它类似于一维ndarray的索引。索引类型可以为：<br />
（1）一个整数下标。此时返回对应的label。<br />
（2）一个整数切片。此时返回切片的Index。<br />
（3）一个array-like对象，元素可以为下标或者布尔值。此时返回对应的Index。<br />
Index对象<strong>不可更改</strong>。所以只能选取数据。如果想变更Index的标签，只能用新的Index对象去替换。<br />
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">index =  pd.Index([<span class="string">&#x27;a&#x27;</span>,<span class="string">&#x27;b&#x27;</span>,<span class="string">&#x27;c&#x27;</span>,<span class="string">&#x27;d&#x27;</span>])</span><br><span class="line">index</span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">Index([&#x27;a&#x27;, &#x27;b&#x27;, &#x27;c&#x27;, &#x27;d&#x27;], dtype=&#x27;object&#x27;)</span></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line">index[<span class="number">1</span>]</span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">&#x27;b&#x27;</span></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line">index[<span class="number">0</span>:<span class="number">3</span>]</span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">Index([&#x27;a&#x27;, &#x27;b&#x27;, &#x27;c&#x27;], dtype=&#x27;object&#x27;)</span></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line">index[[<span class="number">0</span>,<span class="number">1</span>]]</span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">Index([&#x27;a&#x27;, &#x27;b&#x27;], dtype=&#x27;object&#x27;)</span></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line">index[[<span class="literal">False</span>,<span class="literal">True</span>,<span class="literal">True</span>,<span class="literal">False</span>]]</span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">Index([&#x27;b&#x27;, &#x27;c&#x27;], dtype=&#x27;object&#x27;)</span></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br></pre></td></tr></table></figure><br />
Index的选取方法：<br />
<code>.get_indexer(target[, method, limit, ...])</code>：和target匹配，返回target对应的索引列表。Index必须有序，要么升序，要么降序。<br />
（1）target：一个Index对象。<br />
（2）method：指定label的匹配方法。可以为None，表示严格匹配（匹配不到为-1）。如果为<code>pad/ffill</code>，则未找到匹配的，使用前向匹配（复制前一个结果）。如果为<code>backfill/bfill</code>，则未找到匹配的，使用后向匹配（复制后一个结果）。如果为<code>nearest</code>，则未找到匹配的，使用最近邻匹配。<br />
（3）limit：一个整数，指定前向/后向/最近填充时：如果有连续的k个NaN，则只填充其中limit个。<br />
（4）tolerance：一个整数，用于给出在不匹配时，连续采用前向/后向/最近邻匹配的跨度的最大值。<br />
<code>.get_loc(key[, method, tolerance])</code>：返回指定label的下标，由key指定。如果method=None，且key指定的label找不到，则抛异常。<br />
<code>.get_value(series, key)</code>：寻找Series指定label处的值。若key指定的label找不到，则抛出异常。<br />
<code>.slice_locs([start, end, step, kind])</code>：计算给定start
label和end
label之间的下标序列，返回代表该下标序列的切片或者数组，左闭右开<code>[)</code>。类似切片方法，但Index的不支持用标签名切片。<br />
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line">i1 = pd.Index([<span class="string">&#x27;a&#x27;</span>, <span class="string">&#x27;c&#x27;</span>, <span class="string">&#x27;e&#x27;</span>, <span class="string">&#x27;g&#x27;</span>])</span><br><span class="line">i2 = pd.Index([<span class="string">&#x27;a&#x27;</span>, <span class="string">&#x27;b&#x27;</span>, <span class="string">&#x27;c&#x27;</span>, <span class="string">&#x27;d&#x27;</span>, <span class="string">&#x27;e&#x27;</span>])</span><br><span class="line">i1</span><br><span class="line">i2</span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">Index([&#x27;a&#x27;, &#x27;c&#x27;, &#x27;e&#x27;, &#x27;g&#x27;], dtype=&#x27;object&#x27;)</span></span><br><span class="line"><span class="string">Index([&#x27;a&#x27;, &#x27;b&#x27;, &#x27;c&#x27;, &#x27;d&#x27;, &#x27;e&#x27;], dtype=&#x27;object&#x27;)</span></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line">i1.get_indexer(i2,method=<span class="literal">None</span>) <span class="comment"># 严格匹配</span></span><br><span class="line">i1.get_indexer(i2,method=<span class="string">&#x27;ffill&#x27;</span>) <span class="comment"># 前向匹配</span></span><br><span class="line">i1.get_indexer(i2,method=<span class="string">&#x27;bfill&#x27;</span>) <span class="comment"># 后向匹配</span></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">array([ 0, -1,  1, -1,  2], dtype=int64)</span></span><br><span class="line"><span class="string">array([0, 0, 1, 1, 2], dtype=int64)</span></span><br><span class="line"><span class="string">array([0, 1, 1, 2, 2], dtype=int64)</span></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line">i1.get_loc(<span class="string">&#x27;a&#x27;</span>,method=<span class="literal">None</span>) <span class="comment"># 严格匹配</span></span><br><span class="line">i1.get_loc(<span class="string">&#x27;b&#x27;</span>,method=<span class="string">&#x27;ffill&#x27;</span>) <span class="comment"># 前向匹配</span></span><br><span class="line">i1.get_loc(<span class="string">&#x27;b&#x27;</span>,method=<span class="string">&#x27;bfill&#x27;</span>) <span class="comment"># 后向匹配</span></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">0</span></span><br><span class="line"><span class="string">0</span></span><br><span class="line"><span class="string">1</span></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line">data = pd.Series([<span class="number">1</span>, <span class="number">2</span>, <span class="number">4</span>, <span class="number">5</span>], index=i1)</span><br><span class="line">i1.get_value(data,<span class="string">&#x27;a&#x27;</span>)</span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">1</span></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line">i1.slice_locs(start=<span class="string">&#x27;a&#x27;</span>,end=<span class="string">&#x27;g&#x27;</span>)</span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">(0, 4)</span></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br></pre></td></tr></table></figure><br />
<strong>2、Series</strong><br />
对于Series对象，可以通过<code>[]</code>来选取数据，索引可以为：<br />
（1）下标/标签/序列：返回对应的数值。<br />
（2）下标切片/标签切片：返回对应的Series，隐式（下标）切片区间是<code>[)</code>，显式（标签）切片区间是<code>[]</code>。<br />
（3）一维：下标array-like/标签array-like/布尔ndarray：返回对应的Series。<br />
（4）二维：下标ndarray：返回对应值组成的二维ndarray。<br />
（5）以使用 Numpy
中介绍的掩码操作选取数据，比如<code>data[(data &gt; 0) &amp; (data &lt; 3)]</code>。<br />
<div class="note info"><p>当Series有多个重复标签，只返回第一个的值。<br />
Series可以看value是单个值的字典，可以通过<code>.keys()</code>获取索引（等价于<code>.index</code>），通过<code>list(.items())</code>获取所引值。<br />
布尔必须是ndarray/序列，不能是array-like。<br />
使用切片方式，得到的数据是其<strong>视图</strong>，原始数据更新会影响切片数据，反之切片数据更新也会影响原始数据。</p>
</div></p>
<div class="tabs" id="series"><ul class="nav-tabs"><li class="tab active"><a href="#series-1">下标/标签/序列</a></li><li class="tab"><a href="#series-2">下标切片/标签切片</a></li><li class="tab"><a href="#series-3">一维</a></li><li class="tab"><a href="#series-4">二维</a></li></ul><div class="tab-content"><div class="tab-pane active" id="series-1"><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line">data = pd.Series([<span class="number">0</span>, <span class="number">2</span>, <span class="number">1</span>, <span class="number">3</span>], index=[<span class="string">&#x27;a&#x27;</span>,<span class="string">&#x27;b&#x27;</span>,<span class="string">&#x27;c&#x27;</span>,<span class="string">&#x27;d&#x27;</span>])</span><br><span class="line">data</span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">a    0</span></span><br><span class="line"><span class="string">b    2</span></span><br><span class="line"><span class="string">c    1</span></span><br><span class="line"><span class="string">d    3</span></span><br><span class="line"><span class="string">dtype: int64</span></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line">data[<span class="number">1</span>] <span class="comment"># 下标</span></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">2</span></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line">data[<span class="string">&#x27;a&#x27;</span>] <span class="comment"># 标签</span></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">0</span></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line">data[[<span class="number">0</span>, <span class="number">1</span>]] <span class="comment"># 下标序列</span></span><br><span class="line">data[[<span class="string">&#x27;a&#x27;</span>,<span class="string">&#x27;b&#x27;</span>]] <span class="comment"># 标签序列</span></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">a    0</span></span><br><span class="line"><span class="string">b    2</span></span><br><span class="line"><span class="string">dtype: int64</span></span><br><span class="line"><span class="string">a    0</span></span><br><span class="line"><span class="string">b    2</span></span><br><span class="line"><span class="string">dtype: int64</span></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br></pre></td></tr></table></figure></div><div class="tab-pane" id="series-2"><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">data[<span class="number">1</span>:<span class="number">3</span>] <span class="comment"># 下标切片</span></span><br><span class="line">data[<span class="string">&#x27;b&#x27;</span>:<span class="string">&#x27;c&#x27;</span>] <span class="comment"># 标签切片</span></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">b    2</span></span><br><span class="line"><span class="string">c    1</span></span><br><span class="line"><span class="string">dtype: int64</span></span><br><span class="line"><span class="string">b    2</span></span><br><span class="line"><span class="string">c    1</span></span><br><span class="line"><span class="string">dtype: int64</span></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br></pre></td></tr></table></figure></div><div class="tab-pane" id="series-3"><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">data[pd.Series([<span class="number">0</span>,<span class="number">1</span>])] <span class="comment"># 下标array-like</span></span><br><span class="line">data[pd.Series([<span class="string">&#x27;a&#x27;</span>,<span class="string">&#x27;b&#x27;</span>])] <span class="comment"># 标签array-like</span></span><br><span class="line">data[pd.Series([true,<span class="string">&#x27;b&#x27;</span>])] <span class="comment"># 布尔array-like</span></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">a    0</span></span><br><span class="line"><span class="string">b    2</span></span><br><span class="line"><span class="string">dtype: int64</span></span><br><span class="line"><span class="string">a    0</span></span><br><span class="line"><span class="string">b    2</span></span><br><span class="line"><span class="string">dtype: int64</span></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line">data[np.array([<span class="literal">True</span>,<span class="literal">False</span>,<span class="literal">True</span>,<span class="literal">False</span>])] <span class="comment"># 布尔ndarray</span></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">a    0</span></span><br><span class="line"><span class="string">c    1</span></span><br><span class="line"><span class="string">dtype: int64</span></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br></pre></td></tr></table></figure></div><div class="tab-pane" id="series-4"><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 下标ndarray</span></span><br><span class="line">data[np.array([[<span class="number">0</span>,<span class="number">1</span>],</span><br><span class="line">               [<span class="number">0</span>,<span class="number">2</span>]])]</span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">array([[0, 2],</span></span><br><span class="line"><span class="string">       [0, 1]], dtype=int64)</span></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line">data[np.array([<span class="literal">True</span>,<span class="literal">False</span>,<span class="literal">True</span>,<span class="literal">False</span>])] <span class="comment"># 布尔ndarray</span></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">array([[0, 2],</span></span><br><span class="line"><span class="string">       [0, 1]], dtype=int64)</span></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br></pre></td></tr></table></figure></div></div></div>
<p><strong>3、DataFrame</strong><br />
对于DataFrame对象，可以通过<code>[]</code>来选取数据。索引可以为：<br />
（1）列标签：返回对应的<strong>列</strong>Series。<br />
（2）行下标切片/行标签切片：返回对应的<strong>行</strong>组成的DataFrame。隐式切片区间是<code>[)</code>，显式切片区间是<code>[]</code>。<br />
（3）一维：列标签的array-like：返回对应的<strong>列</strong>组成的DataFrame。<br />
（4）一维：布尔array-like：返回数组中True对应的<strong>行</strong>组成的DataFrame。<br />
<div class="note info"><p>当DataFrame有多个重复行标签（可通过<code>Index.is_unique</code>属性判断有无重复），返回所有重复行数据。<br />
DataFrame不支持单个行下标切片，即不支持data[0]，可使用data[0:1]获取第一行数据。<br />
使用切片方式，得到的数据是其<strong>视图</strong>，原始数据更新会影响切片数据，反之切片数据更新也会影响原始数据。</p>
</div><br />
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><span class="line">data = pd.DataFrame(&#123;<span class="string">&#x27;a&#x27;</span>:[<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>],<span class="string">&#x27;b&#x27;</span>:[<span class="number">0</span>,<span class="number">1</span>,<span class="number">2</span>],<span class="string">&#x27;c&#x27;</span>:[<span class="number">4</span>,<span class="number">5</span>,<span class="number">6</span>]&#125;,index=[<span class="string">&#x27;e&#x27;</span>,<span class="string">&#x27;f&#x27;</span>,<span class="string">&#x27;g&#x27;</span>])</span><br><span class="line">data</span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">    a   b   c</span></span><br><span class="line"><span class="string">e   1   0   4</span></span><br><span class="line"><span class="string">f   2   1   5</span></span><br><span class="line"><span class="string">g   3   2   6</span></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line">data[<span class="string">&#x27;a&#x27;</span>] <span class="comment"># 列标签</span></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">e    1</span></span><br><span class="line"><span class="string">f    2</span></span><br><span class="line"><span class="string">g    3</span></span><br><span class="line"><span class="string">Name: a, dtype: int64</span></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line">data[<span class="number">0</span>:<span class="number">2</span>] <span class="comment"># 下标切片</span></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">    a   b   c</span></span><br><span class="line"><span class="string">e   1   0   4</span></span><br><span class="line"><span class="string">f   2   1   5</span></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line">data[<span class="string">&#x27;e&#x27;</span>:<span class="string">&#x27;g&#x27;</span>] <span class="comment"># 行标签切片，左闭右闭</span></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">    a   b   c</span></span><br><span class="line"><span class="string">e   1   0   4</span></span><br><span class="line"><span class="string">f   2   1   5</span></span><br><span class="line"><span class="string">g   3   2   6</span></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line">data[[<span class="string">&#x27;a&#x27;</span>,<span class="string">&#x27;c&#x27;</span>]] <span class="comment"># 列标签的array-like</span></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">    a   c</span></span><br><span class="line"><span class="string">e   1   4</span></span><br><span class="line"><span class="string">f   2   5</span></span><br><span class="line"><span class="string">g   3   6</span></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line">data[[<span class="literal">True</span>,<span class="literal">False</span>,<span class="literal">True</span>]] <span class="comment"># 布尔array-like</span></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">    a   b   c</span></span><br><span class="line"><span class="string">e   1   0   4</span></span><br><span class="line"><span class="string">g   3   2   6</span></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br></pre></td></tr></table></figure></p>
<h4 id="索引器-locilocix">索引器 loc/iloc/ix</h4>
<div class="note info"><p>注意，索引器方式，使用array-like获取的是深拷贝。其他方式获取的数据是浅拷贝。</p>
</div>
<p>前述的切片和取值的习惯用法经常会造成混乱。例如，如果 Series
是<strong>显式整数索引</strong>，那么 data[1]
这样的取值操作会使用显式索引，而 data[1:3]
这样的切片操作却会使用隐式索引。<br />
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">data = pd.Series([<span class="string">&#x27;a&#x27;</span>, <span class="string">&#x27;b&#x27;</span>, <span class="string">&#x27;c&#x27;</span>], index=[<span class="number">1</span>, <span class="number">3</span>, <span class="number">5</span>])</span><br><span class="line">data</span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">1    a</span></span><br><span class="line"><span class="string">3    b</span></span><br><span class="line"><span class="string">5    c</span></span><br><span class="line"><span class="string">dtype: object</span></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line">data[<span class="number">1</span>] <span class="comment"># 取值操作是显式索引</span></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">&#x27;a&#x27;</span></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line">data[<span class="number">1</span>:<span class="number">3</span>] <span class="comment"># 切片操作是隐式索引</span></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">3    b</span></span><br><span class="line"><span class="string">5    c</span></span><br><span class="line"><span class="string">dtype: object</span></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br></pre></td></tr></table></figure><br />
由于整数索引很容易造成混淆，所以 Pandas
提供了一些索引器属性来作为取值的方法。它们不是 Series
对象的函数方法，而是暴露切片接口的属性。<br />
<strong>第一种索引器是 loc
属性，表示取值和切片都是显式的</strong>：<br />
（1）取值区间是<code>[]</code>。<br />
（2）Series中对应标签序列方式。<br />
（3）DataFrame中，单个标签/数组标签/布尔数组对应行，两个标签对应行和列（取单个值）。切片可以在行和列上同时使用，而不同于之前的只能用行切片。<br />
DataFrame中布尔数组，不需要和行长度相等，未写的默认是False。<br />
<div class="tabs" id="f2"><ul class="nav-tabs"><li class="tab active"><a href="#f2-1">Series</a></li><li class="tab"><a href="#f2-2">DataFrame</a></li></ul><div class="tab-content"><div class="tab-pane active" id="f2-1"><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line">data = pd.Series([<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>],index=[<span class="string">&#x27;a&#x27;</span>,<span class="string">&#x27;b&#x27;</span>,<span class="string">&#x27;c&#x27;</span>])</span><br><span class="line">data</span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">a    1</span></span><br><span class="line"><span class="string">b    2</span></span><br><span class="line"><span class="string">c    3</span></span><br><span class="line"><span class="string">dtype: int64</span></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line">data.loc[<span class="string">&#x27;a&#x27;</span>] <span class="comment"># 单个标签</span></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">1</span></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line">data.loc[[<span class="string">&#x27;a&#x27;</span>,<span class="string">&#x27;b&#x27;</span>]] <span class="comment"># 数组标签</span></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">a    1</span></span><br><span class="line"><span class="string">b    2</span></span><br><span class="line"><span class="string">dtype: int64</span></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line">data.loc[<span class="string">&#x27;a&#x27;</span>:<span class="string">&#x27;c&#x27;</span>] <span class="comment"># 切片</span></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">a    1</span></span><br><span class="line"><span class="string">b    2</span></span><br><span class="line"><span class="string">c    3</span></span><br><span class="line"><span class="string">dtype: int64</span></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br></pre></td></tr></table></figure></div><div class="tab-pane" id="f2-2"><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line">data = pd.DataFrame(&#123;<span class="string">&#x27;a&#x27;</span>:[<span class="number">0</span>,<span class="number">1</span>,<span class="number">2</span>],<span class="string">&#x27;b&#x27;</span>:[<span class="number">0</span>,<span class="number">1</span>,<span class="number">2</span>],<span class="string">&#x27;c&#x27;</span>:[<span class="number">0</span>,<span class="number">1</span>,<span class="number">2</span>]&#125;,index=[<span class="string">&#x27;e&#x27;</span>,<span class="string">&#x27;f&#x27;</span>,<span class="string">&#x27;g&#x27;</span>])</span><br><span class="line">data</span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">    a   b   c</span></span><br><span class="line"><span class="string">e   0   0   0</span></span><br><span class="line"><span class="string">f   1   1   1</span></span><br><span class="line"><span class="string">g   2   2   2</span></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line">data.loc[<span class="string">&#x27;e&#x27;</span>] <span class="comment"># 单个标签</span></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">a    0</span></span><br><span class="line"><span class="string">b    0</span></span><br><span class="line"><span class="string">c    0</span></span><br><span class="line"><span class="string">Name: e, dtype: int64</span></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line">data.loc[[<span class="string">&#x27;e&#x27;</span>, <span class="string">&#x27;f&#x27;</span>]] <span class="comment"># 数组标签</span></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">    a   b   c</span></span><br><span class="line"><span class="string">e   0   0   0</span></span><br><span class="line"><span class="string">f   1   1   1</span></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line">data.loc[[<span class="literal">True</span>, <span class="literal">False</span>]] <span class="comment"># 布尔数组，不需要和行长度相等</span></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">    a   b   c</span></span><br><span class="line"><span class="string">e   0   0   0</span></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line">data.loc[<span class="string">&#x27;e&#x27;</span>,<span class="string">&#x27;b&#x27;</span>] <span class="comment"># 两个标签，对应行和列，取单个值</span></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">0</span></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line">data.loc[<span class="string">&#x27;e&#x27;</span>:<span class="string">&#x27;g&#x27;</span>,<span class="string">&#x27;b&#x27;</span>:<span class="string">&#x27;c&#x27;</span>] <span class="comment"># 行（0轴）和列（1轴）都可以切片</span></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">    b   c</span></span><br><span class="line"><span class="string">e   0   0</span></span><br><span class="line"><span class="string">f   1   1</span></span><br><span class="line"><span class="string">g   2   2</span></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br></pre></td></tr></table></figure></div></div></div><br />
<strong>第二种是 iloc 属性，表示取值和切片都是隐式索引：</strong><br />
（1）取值区间是<code>[)</code>。<br />
（2）方式和loc相同。</p>
<div class="tabs" id="f1"><ul class="nav-tabs"><li class="tab active"><a href="#f1-1">Series</a></li><li class="tab"><a href="#f1-2">DataFrame</a></li></ul><div class="tab-content"><div class="tab-pane active" id="f1-1"><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line">data = pd.Series([<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>],index=[<span class="string">&#x27;a&#x27;</span>,<span class="string">&#x27;b&#x27;</span>,<span class="string">&#x27;c&#x27;</span>])</span><br><span class="line">data</span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">a    1</span></span><br><span class="line"><span class="string">b    2</span></span><br><span class="line"><span class="string">c    3</span></span><br><span class="line"><span class="string">dtype: int64</span></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line">data.iloc[<span class="number">0</span>] <span class="comment"># 单个下标</span></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">1</span></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line">data.iloc[[<span class="number">0</span>,<span class="number">1</span>]] <span class="comment"># 数组下标</span></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">a    1</span></span><br><span class="line"><span class="string">b    2</span></span><br><span class="line"><span class="string">dtype: int64</span></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line">data.iloc[<span class="number">0</span>:<span class="number">2</span>] <span class="comment"># 下标切片</span></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">a    1</span></span><br><span class="line"><span class="string">b    2</span></span><br><span class="line"><span class="string">dtype: int64</span></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br></pre></td></tr></table></figure></div><div class="tab-pane" id="f1-2"><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line">data = pd.DataFrame(&#123;<span class="string">&#x27;a&#x27;</span>:[<span class="number">0</span>,<span class="number">1</span>,<span class="number">2</span>],<span class="string">&#x27;b&#x27;</span>:[<span class="number">0</span>,<span class="number">1</span>,<span class="number">2</span>],<span class="string">&#x27;c&#x27;</span>:[<span class="number">0</span>,<span class="number">1</span>,<span class="number">2</span>]&#125;,index=[<span class="string">&#x27;e&#x27;</span>,<span class="string">&#x27;f&#x27;</span>,<span class="string">&#x27;g&#x27;</span>])</span><br><span class="line">data</span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">    a   b   c</span></span><br><span class="line"><span class="string">e   0   0   0</span></span><br><span class="line"><span class="string">f   1   1   1</span></span><br><span class="line"><span class="string">g   2   2   2</span></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line">data.iloc[<span class="number">0</span>] <span class="comment"># 单个行下标</span></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">a    0</span></span><br><span class="line"><span class="string">b    0</span></span><br><span class="line"><span class="string">c    0</span></span><br><span class="line"><span class="string">Name: e, dtype: int64</span></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line">data.iloc[[<span class="number">0</span>, <span class="number">1</span>]] <span class="comment"># 数组行下标</span></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">    a   b   c</span></span><br><span class="line"><span class="string">e   0   0   0</span></span><br><span class="line"><span class="string">f   1   1   1</span></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line">data.iloc[[<span class="literal">True</span>, <span class="literal">False</span>]] <span class="comment"># 布尔数组，不需要和行长度相等</span></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">    a   b   c</span></span><br><span class="line"><span class="string">e   0   0   0</span></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line">data.iloc[<span class="number">0</span>,<span class="number">1</span>] <span class="comment"># 两个下标，对应行和列，取单个值</span></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">0</span></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line">data.iloc[<span class="number">0</span>:<span class="number">2</span>, <span class="number">1</span>:<span class="number">2</span>] <span class="comment"># 行（0轴）和列（1轴）都可以切片</span></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">    b</span></span><br><span class="line"><span class="string">e   0</span></span><br><span class="line"><span class="string">f   1</span></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br></pre></td></tr></table></figure></div></div></div>
<p><strong>第三种取值属性是
ix，它是前两种索引器的混合形式：</strong><br />
（1）下标和标签未混合使用时，参考<code>loc</code>和<code>iloc</code>。<br />
（2）下标和标签混合使用时，可以一个轴（行是0轴/列是1轴）显示形式，另一个轴为标签形式。因为只能在多个轴时可以这么用，所以Series不支持这种混合。DataFrame支持，此时区间遵循显式<code>[]</code>，隐式<code>[)</code>。<br />
不混合使用时，为防止歧义，建议不用<code>ix</code>方式，而使用<code>loc</code>和<code>iloc</code>方式。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">data = pd.DataFrame(&#123;<span class="string">&#x27;a&#x27;</span>:[<span class="number">0</span>,<span class="number">1</span>,<span class="number">2</span>],<span class="string">&#x27;b&#x27;</span>:[<span class="number">0</span>,<span class="number">1</span>,<span class="number">2</span>],<span class="string">&#x27;c&#x27;</span>:[<span class="number">0</span>,<span class="number">1</span>,<span class="number">2</span>]&#125;,index=[<span class="string">&#x27;e&#x27;</span>,<span class="string">&#x27;f&#x27;</span>,<span class="string">&#x27;g&#x27;</span>])</span><br><span class="line">data</span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">    a   b   c</span></span><br><span class="line"><span class="string">e   0   0   0</span></span><br><span class="line"><span class="string">f   1   1   1</span></span><br><span class="line"><span class="string">g   2   2   2</span></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line">data.ix[<span class="number">0</span>,<span class="string">&#x27;a&#x27;</span>] </span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">0</span></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line">data.ix[<span class="number">0</span>:<span class="number">2</span>, <span class="string">&#x27;b&#x27;</span>:<span class="string">&#x27;c&#x27;</span>] <span class="comment"># 区间遵循显式[]，隐式[)</span></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">    b   c</span></span><br><span class="line"><span class="string">e   0   0</span></span><br><span class="line"><span class="string">f   1   1</span></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br></pre></td></tr></table></figure>
<h4 id="单值索引器-atiat">单值索引器 at/iat</h4>
<p><code>.at</code>和<code>.iat</code>分别使用显式和隐式<strong>获取单个值</strong>。它类似于<code>.loc</code>和<code>.iloc</code>，但是<code>.at</code>和<code>.iat</code>的速度更快。<br />
具体规则可参考索引器<code>.loc</code>和<code>.iloc</code>。<br />
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line">data = pd.Series([<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>],index=[<span class="string">&#x27;a&#x27;</span>,<span class="string">&#x27;b&#x27;</span>,<span class="string">&#x27;c&#x27;</span>])</span><br><span class="line">data</span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">a    1</span></span><br><span class="line"><span class="string">b    2</span></span><br><span class="line"><span class="string">c    3</span></span><br><span class="line"><span class="string">dtype: int64</span></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line">data.iat[<span class="number">0</span>]</span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">1</span></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line">data.at[<span class="string">&#x27;a&#x27;</span>]</span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">1</span></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line">data = pd.DataFrame(&#123;<span class="string">&#x27;a&#x27;</span>:[<span class="number">0</span>,<span class="number">1</span>,<span class="number">2</span>],<span class="string">&#x27;b&#x27;</span>:[<span class="number">0</span>,<span class="number">1</span>,<span class="number">2</span>],<span class="string">&#x27;c&#x27;</span>:[<span class="number">0</span>,<span class="number">1</span>,<span class="number">2</span>]&#125;,index=[<span class="string">&#x27;e&#x27;</span>,<span class="string">&#x27;f&#x27;</span>,<span class="string">&#x27;g&#x27;</span>])</span><br><span class="line">data</span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">    a   b   c</span></span><br><span class="line"><span class="string">e   0   0   0</span></span><br><span class="line"><span class="string">f   1   1   1</span></span><br><span class="line"><span class="string">g   2   2   2</span></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line">data.iat[<span class="number">0</span>,<span class="number">0</span>]</span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">0</span></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line">data.at[<span class="string">&#x27;e&#x27;</span>,<span class="string">&#x27;a&#x27;</span>]</span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">0</span></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br></pre></td></tr></table></figure></p>
<h4 id="多级索引">多级索引</h4>
<p>对于<code>.loc</code>/<code>[]</code>，可以指定多级索引中，每级索引上的标签。<br />
（1）轴对应的下标/标签是一个元组，该元组中每个元素按顺序对应一个索引级别。<br />
（2）如果下标/标签不是元组，则将其转换成长度为 1 的元组。<br />
（3）如果元组的长度比索引级别少，则在其后面补充<code>slice(None)</code>，而不能使用<code>:</code>（会导致语法错误）。这种方法不建议使用。<br />
（4）为解决（3）的问题，可以使用Pandas内置的IndexSlice对象，进行切片。<br />
<div class="note info"><p><strong>如果 MultiIndex 不是有序的索引，
那么大多数切片操作都会失败。</strong><br />
<strong>建议使用排序函数sort_index()和sortlevel()，来排序多级行标签和列标签。</strong></p>
</div><br />
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 本办法表示多级索引</span></span><br><span class="line">idx1 = [(<span class="string">&#x27;a&#x27;</span>, <span class="string">&#x27;c&#x27;</span>),(<span class="string">&#x27;a&#x27;</span>, <span class="string">&#x27;d&#x27;</span>),(<span class="string">&#x27;b&#x27;</span>, <span class="string">&#x27;c&#x27;</span>),(<span class="string">&#x27;b&#x27;</span>, <span class="string">&#x27;d&#x27;</span>)]</span><br><span class="line">value = [<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>,<span class="number">4</span>]</span><br><span class="line">s1 = pd.Series(value, index=idx)</span><br><span class="line">s1</span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">(a, c)    1</span></span><br><span class="line"><span class="string">(a, d)    2</span></span><br><span class="line"><span class="string">(b, c)    3</span></span><br><span class="line"><span class="string">(b, d)    4</span></span><br><span class="line"><span class="string">dtype: int64</span></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="comment"># Pandas的MultiIndex表示多级索引</span></span><br><span class="line"><span class="comment"># idx = pd.MultiIndex.from_tuples(idx1)</span></span><br><span class="line">idx = pd.MultiIndex(levels=[[<span class="string">&#x27;a&#x27;</span>,<span class="string">&#x27;b&#x27;</span>],[<span class="string">&#x27;c&#x27;</span>,<span class="string">&#x27;d&#x27;</span>]],codes=[[<span class="number">0</span>,<span class="number">0</span>,<span class="number">1</span>,<span class="number">1</span>],[<span class="number">0</span>,<span class="number">1</span>,<span class="number">0</span>,<span class="number">1</span>]],names=[<span class="string">&#x27;lv1&#x27;</span>,<span class="string">&#x27;lv2&#x27;</span>])</span><br><span class="line"><span class="comment"># idx.levels</span></span><br><span class="line">data = pd.Series([<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>,<span class="number">4</span>],index=idx)</span><br><span class="line">data</span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">lv1  lv2</span></span><br><span class="line"><span class="string">a    c      1</span></span><br><span class="line"><span class="string">     d      2</span></span><br><span class="line"><span class="string">b    c      3</span></span><br><span class="line"><span class="string">     d      4</span></span><br><span class="line"><span class="string">dtype: int64</span></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line">data.loc[<span class="string">&#x27;a&#x27;</span>,<span class="string">&#x27;c&#x27;</span>]</span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">1</span></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="comment"># 把两层索引的Series转成一个DataFrame</span></span><br><span class="line">df = data.unstack()</span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">lv2 c   d</span></span><br><span class="line"><span class="string">lv1      </span></span><br><span class="line"><span class="string">a   1   2</span></span><br><span class="line"><span class="string">b   3   4</span></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="comment"># 把一个DataFrame转成两层索引的Series</span></span><br><span class="line">df.stack()</span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">lv1  lv2</span></span><br><span class="line"><span class="string">a    c      1</span></span><br><span class="line"><span class="string">     d      2</span></span><br><span class="line"><span class="string">b    c      3</span></span><br><span class="line"><span class="string">     d      4</span></span><br><span class="line"><span class="string">dtype: int64</span></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line">data = pd.DataFrame(&#123;<span class="string">&#x27;e&#x27;</span>:[<span class="number">0</span>,<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>],<span class="string">&#x27;f&#x27;</span>:[<span class="number">0</span>,<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>]&#125;,index=idx)</span><br><span class="line">data</span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">         e   f</span></span><br><span class="line"><span class="string">lv1  lv2      </span></span><br><span class="line"><span class="string">a    c   0   0</span></span><br><span class="line"><span class="string">     d   1   1</span></span><br><span class="line"><span class="string">b    c   2   2</span></span><br><span class="line"><span class="string">     d   3   3</span></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line">data.loc[<span class="string">&#x27;a&#x27;</span>,[<span class="string">&#x27;e&#x27;</span>,<span class="string">&#x27;f&#x27;</span>]]</span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">    e   f</span></span><br><span class="line"><span class="string">lv2      </span></span><br><span class="line"><span class="string">c   0   0</span></span><br><span class="line"><span class="string">d   1   1</span></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line">data.loc[(<span class="string">&#x27;a&#x27;</span>,<span class="built_in">slice</span>(<span class="literal">None</span>)),[<span class="string">&#x27;e&#x27;</span>,<span class="string">&#x27;f&#x27;</span>]]</span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">         e   f</span></span><br><span class="line"><span class="string">lv1  lv2      </span></span><br><span class="line"><span class="string">a    c   0   0</span></span><br><span class="line"><span class="string">     d   1   1</span></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="comment"># 推荐使用这个方法</span></span><br><span class="line">idx = pd.IndexSlice</span><br><span class="line">data.loc[idx[<span class="string">&#x27;a&#x27;</span>,:], idx[<span class="string">&#x27;e&#x27;</span>,<span class="string">&#x27;f&#x27;</span>]]</span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">         e   f</span></span><br><span class="line"><span class="string">lv1  lv2      </span></span><br><span class="line"><span class="string">a    c   0   0</span></span><br><span class="line"><span class="string">     d   1   1</span></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br></pre></td></tr></table></figure><br />
你可能会纠结于为什么要费时间研究层级索引。其实理由很简单：如果我们可以用含多级索引的一维
Series 数据表示二维数据，那么我们就可以用 Series 或 DataFrame
表示三维甚至更高维度的数据。多级索引每增加一级，就表示数据增加一维，利用这一特点就可以轻松表示任意维度的数据了。</p>
<p>这里还有一些 Pandas 的基本数据结构没有介绍到，包括 pd.Panel 对象和
pd.Panel4D对象。这两种数据结构可以分别看成是（一维数组） Series
和（二维数组） DataFrame 的三维与四维形式。如果你熟悉 Series 和
DataFrame 的使用方法，那么 Panel 和 Panel4D 使用起来也会很简单， ix、
loc 和 iloc 索引器在高维数据结构上的用法更是完全相同。</p>
<p>多级索引在大多数情况下都是更实用、更直观的高维数据形式。另外， Panel
采用密集数据存储形式，而多级索引采用稀疏数据存储形式。在解决许多真实的数据集时，随着维度的不断增加，密集数据存储形式的效率将越来越低。所以在处理多个标签的数据时，建议使用多层索引的方式。</p>
<h4 id="高性能过滤query">高性能过滤query</h4>
<p>对于DataFrame，当需要根据一定的条件对行进行过滤时，通常可以先创建一个布尔数组，然后使用该数组获取True对应的行。当筛选条件很多时，写法复杂，此时可以使用<code>query()</code>方法进行选择数据。<br />
<code>DataFrame.query(expr, inplace=False, **kwargs)</code>：<br />
（1）expr：运算表达式字符串，如'label1 &gt; 0 and label2 &lt; 3'。<br />
　　　表达式中的变量名表示对应的列，可以使用 not/and/or
等关键字进行向量布尔运算。该方法会筛选出那些满足条件的行。<br />
　　　如果希望在表达式中使用Python变量，则在变量名之前使用<code>@</code>。<br />
（2）inplace：是个布尔值。如果为True，则原地修改。否则返回一份拷贝。<br />
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line">df = pd.DataFrame(&#123;<span class="string">&#x27;A&#x27;</span>: <span class="built_in">range</span>(<span class="number">1</span>, <span class="number">6</span>),</span><br><span class="line">                   <span class="string">&#x27;B&#x27;</span>: <span class="built_in">range</span>(<span class="number">10</span>, <span class="number">0</span>, -<span class="number">2</span>),</span><br><span class="line">                   <span class="string">&#x27;C C&#x27;</span>: <span class="built_in">range</span>(<span class="number">10</span>, <span class="number">5</span>, -<span class="number">1</span>)&#125;)</span><br><span class="line">df</span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">   A   B  C C</span></span><br><span class="line"><span class="string">0  1  10   10</span></span><br><span class="line"><span class="string">1  2   8    9</span></span><br><span class="line"><span class="string">2  3   6    8</span></span><br><span class="line"><span class="string">3  4   4    7</span></span><br><span class="line"><span class="string">4  5   2    6</span></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line">df.query(<span class="string">&#x27;A &gt; B&#x27;</span>)</span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">   A  B  C C</span></span><br><span class="line"><span class="string">4  5  2    6</span></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="comment"># 列名中有空格时，可使用``</span></span><br><span class="line">df.query(<span class="string">&#x27;B == `C C`&#x27;</span>)</span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">   A   B  C C</span></span><br><span class="line"><span class="string">0  1  10   10</span></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line">df.query(<span class="string">&#x27;A &gt; 2 &amp; B &lt; 4&#x27;</span>)</span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">   A   B   C C</span></span><br><span class="line"><span class="string">4  5   2   6</span></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line">a = <span class="number">10</span></span><br><span class="line">df.query(<span class="string">&#x27;B == @a&#x27;</span>)</span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">    A   B   C C</span></span><br><span class="line"><span class="string">0   1   10  10</span></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br></pre></td></tr></table></figure></p>
<h4 id="数据更新">数据更新</h4>
<p>对于Series的赋值/新增/删除：<br />
（1）下标/标签/切片赋值，两侧长度必须相等。<br />
（2）新增行，必须用字典（<code>[列标签]</code>）的形式，不能用属性（<code>.列标签</code>）的形式。<br />
（3）del用于删除行（必须用字典（<code>[列标签]</code>）的形式，不能用属性（<code>.列标签</code>）的形式）。<br />
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line">data = pd.Series([<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>],index=[<span class="string">&#x27;a&#x27;</span>,<span class="string">&#x27;b&#x27;</span>,<span class="string">&#x27;c&#x27;</span>])</span><br><span class="line">data</span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">a    1</span></span><br><span class="line"><span class="string">b    2</span></span><br><span class="line"><span class="string">c    3</span></span><br><span class="line"><span class="string">dtype: int64</span></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line">data[<span class="number">0</span>] = <span class="number">5</span></span><br><span class="line">data[<span class="string">&#x27;b&#x27;</span>] = <span class="number">6</span></span><br><span class="line">data</span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">a    5</span></span><br><span class="line"><span class="string">b    6</span></span><br><span class="line"><span class="string">c    3</span></span><br><span class="line"><span class="string">dtype: int64</span></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line">data[<span class="string">&#x27;d&#x27;</span>] = <span class="number">6</span></span><br><span class="line">data</span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">a    5</span></span><br><span class="line"><span class="string">b    6</span></span><br><span class="line"><span class="string">c    3</span></span><br><span class="line"><span class="string">d    6</span></span><br><span class="line"><span class="string">dtype: int64</span></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="keyword">del</span> data[<span class="string">&#x27;d&#x27;</span>]</span><br><span class="line">data</span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">a    5</span></span><br><span class="line"><span class="string">b    6</span></span><br><span class="line"><span class="string">c    3</span></span><br><span class="line"><span class="string">dtype: int64</span></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br></pre></td></tr></table></figure><br />
对于DataFrame的列赋值/列新增/列删除：<br />
（1）将列表/数组赋值给某个列时，长度必须等于DataFrame行数，否则报错。<br />
（2）将Series赋值给某个列时，会按照行标签匹配。如果匹配不到，则赋值NaN（空位都将被填上缺失值）。<br />
（3）将标量赋值给某个列时，会将标量扩充为整列。<br />
（4）新增列（之前不存在）必须用字典（<code>[列标签]</code>）的形式，不能用属性（<code>.列标签</code>）的形式。<br />
（5）del用于删除列（必须用字典（<code>[列标签]</code>）的形式，不能用属性（<code>.列标签</code>）的形式）。<br />
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br></pre></td><td class="code"><pre><span class="line">data = pd.DataFrame(&#123;<span class="string">&#x27;a&#x27;</span>:[<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>],<span class="string">&#x27;b&#x27;</span>:[<span class="number">0</span>,<span class="number">1</span>,<span class="number">2</span>],<span class="string">&#x27;c&#x27;</span>:[<span class="number">4</span>,<span class="number">5</span>,<span class="number">6</span>]&#125;,index=[<span class="string">&#x27;e&#x27;</span>,<span class="string">&#x27;f&#x27;</span>,<span class="string">&#x27;g&#x27;</span>])</span><br><span class="line">data</span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">    a   b   c</span></span><br><span class="line"><span class="string">e   1   0   4</span></span><br><span class="line"><span class="string">f   2   1   5</span></span><br><span class="line"><span class="string">g   3   2   6</span></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line">data[<span class="string">&#x27;a&#x27;</span>] = [<span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>] <span class="comment"># 必须和列长度相等</span></span><br><span class="line">data</span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">    a   b   c</span></span><br><span class="line"><span class="string">e   0   0   4</span></span><br><span class="line"><span class="string">f   0   1   5</span></span><br><span class="line"><span class="string">g   0   2   6</span></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line">data[<span class="string">&#x27;a&#x27;</span>] = pd.Series([<span class="number">3</span>,<span class="number">2</span>,<span class="number">1</span>],index=[<span class="string">&#x27;e&#x27;</span>,<span class="string">&#x27;f&#x27;</span>,<span class="string">&#x27;g&#x27;</span>]) <span class="comment"># Series按照index匹配，匹配不到为Nan</span></span><br><span class="line">data</span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">    a   b   c</span></span><br><span class="line"><span class="string">e   3   0   4</span></span><br><span class="line"><span class="string">f   2   1   5</span></span><br><span class="line"><span class="string">g   1   2   6</span></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line">data[<span class="string">&#x27;a&#x27;</span>] = <span class="number">4</span> <span class="comment"># 标量会扩充为整列</span></span><br><span class="line">data</span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">    a   b   c</span></span><br><span class="line"><span class="string">e   4   0   4</span></span><br><span class="line"><span class="string">f   4   1   5</span></span><br><span class="line"><span class="string">g   4   2   6</span></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line">data[<span class="string">&#x27;d&#x27;</span>] = <span class="number">5</span> <span class="comment"># 新增一列</span></span><br><span class="line">data</span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">    a   b   c   c</span></span><br><span class="line"><span class="string">e   4   0   4   5</span></span><br><span class="line"><span class="string">f   4   1   5   5</span></span><br><span class="line"><span class="string">g   4   2   6   5</span></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="keyword">del</span> data[<span class="string">&#x27;d&#x27;</span>] <span class="comment"># 删除一列</span></span><br><span class="line">data</span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">    a   b   c</span></span><br><span class="line"><span class="string">e   4   0   4</span></span><br><span class="line"><span class="string">f   4   1   5</span></span><br><span class="line"><span class="string">g   4   2   6</span></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br></pre></td></tr></table></figure></p>
<h3 id="pandas变换">Pandas变换</h3>
<h4 id="替换索引丢弃索引">替换索引/丢弃索引</h4>
<p><strong>1、替换索引</strong><br />
因为Index类型不可变，所以只能用新的对象替换。<br />
<code>Series/DataFrame.reindex(index=None, **kwargs)</code>：<br />
（1）index：一个array-like对象，给出了新的index的标签。<br />
（2）method：当新的label的值缺失时，如何处理。参数值可以为：<br />
　　　None：不做任何处理，缺失地方填充NaN ;<br />
　　　'backfill'/'bfill'：用下一个可用的值填充该空缺（后向填充）;<br />
　　　'pad'/'ffill'：用上一个可用的值填充该空缺（前向填充）;<br />
　　　'nearest'：用最近的可用值填充该空缺。<br />
（3）copy：一个布尔值，如果为True，则返回一个新的Series对象（即使传入的index与原来的index相同）。<br />
（4）level：一个整数或者name，在MultiIndex的指定级别上匹配简单索引。<br />
（5）fill_value：一个标量。指定缺失值的填充数据，默认为NaN（如果该参数与method同时出现，则以method为主）。<br />
（6）limit：一个整数，指定前向/后向填充时：如果有连续的k个NaN，则只填充其中limit个。它与method配合。<br />
（7）tolerance：一个整数，用于给出在不匹配时，连续采用前向/后向/最近邻匹配的跨度的最大值。它与method配合。<br />
DataFrame中独有参数：<br />
（1）labels：一个array-like对象，标签序列。配合axis使用，来确定是行/列表标签。<br />
（2）axis：指定当前标签是哪个轴的。<br />
（2）columns：一个array-like对象，给出了新的columns的标签。配合index使用。<br />
<div class="note info"><p>DataFrame中的reindex有两套使用方式，一种是index和columns；另一种是默认的labels和axis。不要混合使用，避免发生错误。<br />
当行和列都使用新索引时，method的插值按照行（0轴）来进行。</p>
</div></p>
<div class="tabs" id="f6"><ul class="nav-tabs"><li class="tab active"><a href="#f6-1">Series</a></li><li class="tab"><a href="#f6-2">DataFrame</a></li></ul><div class="tab-content"><div class="tab-pane active" id="f6-1"><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line">idx = pd.Index([<span class="string">&#x27;a&#x27;</span>,<span class="string">&#x27;c&#x27;</span>,<span class="string">&#x27;d&#x27;</span>,<span class="string">&#x27;f&#x27;</span>,<span class="string">&#x27;p&#x27;</span>])</span><br><span class="line">s = pd.Series([<span class="number">1</span>,<span class="number">5</span>,<span class="number">3</span>,<span class="number">2</span>,<span class="number">6</span>],index=idx)</span><br><span class="line">s</span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">a    1</span></span><br><span class="line"><span class="string">c    5</span></span><br><span class="line"><span class="string">d    3</span></span><br><span class="line"><span class="string">f    2</span></span><br><span class="line"><span class="string">p    6</span></span><br><span class="line"><span class="string">dtype: int64</span></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line">s.reindex([<span class="string">&#x27;a&#x27;</span>,<span class="string">&#x27;b&#x27;</span>,<span class="string">&#x27;i&#x27;</span>],method=<span class="literal">None</span>)</span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">a    1.0</span></span><br><span class="line"><span class="string">b    NaN</span></span><br><span class="line"><span class="string">i    NaN</span></span><br><span class="line"><span class="string">dtype: float64</span></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line">s.reindex([<span class="string">&#x27;a&#x27;</span>,<span class="string">&#x27;b&#x27;</span>,<span class="string">&#x27;i&#x27;</span>],method=<span class="string">&#x27;bfill&#x27;</span>)</span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">a    1</span></span><br><span class="line"><span class="string">b    5</span></span><br><span class="line"><span class="string">i    6</span></span><br><span class="line"><span class="string">dtype: int64</span></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br></pre></td></tr></table></figure></div><div class="tab-pane" id="f6-2"><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line">idx = pd.Index([<span class="string">&#x27;a&#x27;</span>,<span class="string">&#x27;c&#x27;</span>,<span class="string">&#x27;d&#x27;</span>,<span class="string">&#x27;f&#x27;</span>,<span class="string">&#x27;p&#x27;</span>])</span><br><span class="line">df = pd.DataFrame(&#123;<span class="string">&#x27;c1&#x27;</span>:[<span class="number">1</span>,<span class="number">5</span>,<span class="number">3</span>,<span class="number">2</span>,<span class="number">6</span>],<span class="string">&#x27;c3&#x27;</span>:[<span class="number">2</span>,<span class="number">2</span>,<span class="number">5</span>,<span class="number">6</span>,<span class="number">3</span>]&#125;,index=idx)</span><br><span class="line">df</span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">   c1  c3</span></span><br><span class="line"><span class="string">a   1   2</span></span><br><span class="line"><span class="string">c   5   2</span></span><br><span class="line"><span class="string">d   3   5</span></span><br><span class="line"><span class="string">f   2   6</span></span><br><span class="line"><span class="string">p   6   3</span></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line">df.reindex(index=[<span class="string">&#x27;a&#x27;</span>,<span class="string">&#x27;b&#x27;</span>,<span class="string">&#x27;c&#x27;</span>],columns=[<span class="string">&#x27;c1&#x27;</span>,<span class="string">&#x27;c2&#x27;</span>,<span class="string">&#x27;c3&#x27;</span>],fill_value=-<span class="number">1</span>)</span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">   c1   c2  c3</span></span><br><span class="line"><span class="string">a   1   -1   2</span></span><br><span class="line"><span class="string">b  -1   -1  -1</span></span><br><span class="line"><span class="string">c   5   -1   2</span></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line">df.reindex(labels=[<span class="string">&#x27;a&#x27;</span>,<span class="string">&#x27;b&#x27;</span>,<span class="string">&#x27;c&#x27;</span>],axis=<span class="number">0</span>,fill_value=-<span class="number">1</span>)</span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">   c1  c3</span></span><br><span class="line"><span class="string">a   1   2</span></span><br><span class="line"><span class="string">b  -1  -1</span></span><br><span class="line"><span class="string">c   5   2</span></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br></pre></td></tr></table></figure></div></div></div>
<p><code>Series.rename(index=None, **kwargs)</code>：<br />
<code>DataFrame.rename(index=None, columns=None, **kwargs)</code>：<br />
（1）index/columns：一个标量/dict-like/一个函数。<br />
　　　标量：修改了Series.name属性。但是对于DataFrame会抛出异常。<br />
　　　dict-like/函数：应用于对应轴的label上。<br />
（2）copy：如果为True，则拷贝底层数据（此时inplace=False）。<br />
（3）inplace：一个布尔值。如果为True，则原地修改，此时忽略copy参数。否则新创建对象。<br />
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">df = pd.DataFrame(&#123;<span class="string">&quot;A&quot;</span>: [<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>], <span class="string">&quot;B&quot;</span>: [<span class="number">4</span>, <span class="number">5</span>, <span class="number">6</span>]&#125;)</span><br><span class="line">df</span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">    A   B</span></span><br><span class="line"><span class="string">0   1   4</span></span><br><span class="line"><span class="string">1   2   5</span></span><br><span class="line"><span class="string">2   3   6</span></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line">df.rename(index=&#123;<span class="number">0</span>: <span class="string">&quot;x&quot;</span>, <span class="number">1</span>: <span class="string">&quot;y&quot;</span>, <span class="number">2</span>: <span class="string">&quot;z&quot;</span>&#125;,columns=&#123;<span class="string">&quot;A&quot;</span>: <span class="string">&quot;a&quot;</span>, <span class="string">&quot;B&quot;</span>: <span class="string">&quot;c&quot;</span>&#125;)</span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">    a   c</span></span><br><span class="line"><span class="string">x   1   4</span></span><br><span class="line"><span class="string">y   2   5</span></span><br><span class="line"><span class="string">z   3   6</span></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line">df.rename(<span class="built_in">str</span>.lower, axis=<span class="string">&#x27;columns&#x27;</span>)</span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">   a  b</span></span><br><span class="line"><span class="string">0  1  4</span></span><br><span class="line"><span class="string">1  2  5</span></span><br><span class="line"><span class="string">2  3  6</span></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br></pre></td></tr></table></figure><br />
还可以采用<code>Index.map(mapper)</code>方法。其中mapper是个可调用对象，它对每个label进行调用，然后返回新的label。该函数返回一个新的Index对象。然后将其赋值给pandas对象的.index/.columns属性。<br />
<strong>2、丢弃索引</strong><br />
当有多层索引时，可丢弃某条轴上的一个或者多个索引。<br />
<code>Series/DataFrame.drop(labels[, axis, level, inplace, errors])</code>:<br />
（1）labels：单个label/一个label序列，代表要被丢弃的label。<br />
（2）axis：一个整数，或者轴的名字。默认为 0 轴。<br />
（3）level：一个整数或者level名字，用于MultiIndex。因为可能在多个level上都有同名的label。<br />
（4）inplace：一个布尔值。如果为True，则原地修改并且返回None。<br />
（5）errors：可以为'ignore'/'raise'。<br />
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line">idx = pd.MultiIndex(levels=[[<span class="string">&#x27;a&#x27;</span>,<span class="string">&#x27;b&#x27;</span>],[<span class="string">&#x27;c&#x27;</span>,<span class="string">&#x27;d&#x27;</span>]],codes=[[<span class="number">0</span>,<span class="number">0</span>,<span class="number">1</span>,<span class="number">1</span>],[<span class="number">0</span>,<span class="number">1</span>,<span class="number">0</span>,<span class="number">1</span>]],names=[<span class="string">&#x27;lv1&#x27;</span>,<span class="string">&#x27;lv2&#x27;</span>])</span><br><span class="line">s = pd.Series([<span class="number">1</span>,<span class="number">5</span>,<span class="number">3</span>,<span class="number">2</span>],index=idx)</span><br><span class="line">s</span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">lv1  lv2</span></span><br><span class="line"><span class="string">a    c      1</span></span><br><span class="line"><span class="string">     d      5</span></span><br><span class="line"><span class="string">b    c      3</span></span><br><span class="line"><span class="string">     d      2</span></span><br><span class="line"><span class="string">dtype: int64</span></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line">s.drop(<span class="string">&#x27;a&#x27;</span>)</span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">lv1  lv2</span></span><br><span class="line"><span class="string">b    c      3</span></span><br><span class="line"><span class="string">     d      2</span></span><br><span class="line"><span class="string">dtype: int64</span></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line">s.drop(<span class="string">&#x27;c&#x27;</span>,level=<span class="string">&#x27;lv2&#x27;</span>) <span class="comment"># s.drop(&#x27;c&#x27;,level=1)</span></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">lv1  lv2</span></span><br><span class="line"><span class="string">a    d      5</span></span><br><span class="line"><span class="string">b    d      2</span></span><br><span class="line"><span class="string">dtype: int64</span></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br></pre></td></tr></table></figure></p>
<h4 id="索引和索引转换">索引和索引转换</h4>
<p><code>DataFrame/Series.swapaxes(axis1, axis2, copy=True)</code>：交换两个轴。<br />
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">idx = pd.Index([<span class="string">&#x27;a&#x27;</span>,<span class="string">&#x27;c&#x27;</span>,<span class="string">&#x27;d&#x27;</span>,<span class="string">&#x27;f&#x27;</span>])</span><br><span class="line">df = pd.DataFrame(&#123;<span class="string">&#x27;c1&#x27;</span>:[<span class="number">1</span>,<span class="number">5</span>,<span class="number">3</span>,<span class="number">2</span>],<span class="string">&#x27;c2&#x27;</span>:[<span class="number">2</span>,<span class="number">1</span>,<span class="number">5</span>,<span class="number">7</span>],<span class="string">&#x27;c3&#x27;</span>:[<span class="number">3</span>,<span class="number">2</span>,<span class="number">5</span>,<span class="number">6</span>]&#125;,index=idx)</span><br><span class="line">df</span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">   c1  c2  c3</span></span><br><span class="line"><span class="string">a   1   2   3</span></span><br><span class="line"><span class="string">c   5   1   2</span></span><br><span class="line"><span class="string">d   3   5   5</span></span><br><span class="line"><span class="string">f   2   7   6</span></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line">df.swapaxes(<span class="number">0</span>,<span class="number">1</span>)</span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">     a   c   d   f</span></span><br><span class="line"><span class="string">c1   1   5   3   2</span></span><br><span class="line"><span class="string">c2   2   1   5   7</span></span><br><span class="line"><span class="string">c3   3   2   5   6</span></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br></pre></td></tr></table></figure><br />
<code>DataFrame/Series.swaplevel(i=-2, j=-1, axis=0, copy=True)</code>：交换多级索引的两个level。<br />
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><span class="line">index = pd.MultiIndex.from_tuples([(<span class="string">&#x27;bird&#x27;</span>, <span class="string">&#x27;falcon&#x27;</span>),</span><br><span class="line">                                   (<span class="string">&#x27;bird&#x27;</span>, <span class="string">&#x27;parrot&#x27;</span>),</span><br><span class="line">                                   (<span class="string">&#x27;mammal&#x27;</span>, <span class="string">&#x27;lion&#x27;</span>),</span><br><span class="line">                                   (<span class="string">&#x27;mammal&#x27;</span>, <span class="string">&#x27;monkey&#x27;</span>)],</span><br><span class="line">                                  names=[<span class="string">&#x27;class&#x27;</span>, <span class="string">&#x27;name&#x27;</span>])</span><br><span class="line">columns = pd.MultiIndex.from_tuples([(<span class="string">&#x27;speed&#x27;</span>, <span class="string">&#x27;max&#x27;</span>),</span><br><span class="line">                                     (<span class="string">&#x27;species&#x27;</span>, <span class="string">&#x27;type&#x27;</span>)])</span><br><span class="line">df = pd.DataFrame([(<span class="number">389.0</span>, <span class="string">&#x27;fly&#x27;</span>),</span><br><span class="line">                   ( <span class="number">24.0</span>, <span class="string">&#x27;fly&#x27;</span>),</span><br><span class="line">                   ( <span class="number">80.5</span>, <span class="string">&#x27;run&#x27;</span>),</span><br><span class="line">                   (np.nan, <span class="string">&#x27;jump&#x27;</span>)],</span><br><span class="line">                  index=index,</span><br><span class="line">                  columns=columns)</span><br><span class="line">df</span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">               speed species</span></span><br><span class="line"><span class="string">                 max    type</span></span><br><span class="line"><span class="string">class  name</span></span><br><span class="line"><span class="string">bird   falcon  389.0     fly</span></span><br><span class="line"><span class="string">       parrot   24.0     fly</span></span><br><span class="line"><span class="string">mammal lion     80.5     run</span></span><br><span class="line"><span class="string">       monkey    NaN    jump</span></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line">df.swaplevel(i=<span class="number">0</span>,j=<span class="number">1</span>,axis=<span class="number">0</span>)</span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">               speed   species</span></span><br><span class="line"><span class="string">               max     type</span></span><br><span class="line"><span class="string">name    class      </span></span><br><span class="line"><span class="string">falcon   bird   389.0   fly</span></span><br><span class="line"><span class="string">parrot   bird   24.0   fly</span></span><br><span class="line"><span class="string">lion   mammal   80.5   run</span></span><br><span class="line"><span class="string">monkey   mammal   NaN   jump</span></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line">df.swaplevel(i=<span class="number">0</span>,j=<span class="number">1</span>,axis=<span class="number">1</span>)</span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">               max      type</span></span><br><span class="line"><span class="string">               speed    species</span></span><br><span class="line"><span class="string">class  name</span></span><br><span class="line"><span class="string">bird   falcon  389.0     fly</span></span><br><span class="line"><span class="string">       parrot   24.0     fly</span></span><br><span class="line"><span class="string">mammal lion     80.5     run</span></span><br><span class="line"><span class="string">       monkey    NaN    jump</span></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br></pre></td></tr></table></figure><br />
<code>DataFrame.stack(level=-1, dropna=True)</code>：列索引旋转为行索引。<br />
（1）level：一个整数、字符串或者整数字符串的列表。如果列索引为多级索引，它指定了将哪个级别的索引旋转为行索引。<br />
（2）dropna：一个布尔值。如果为True，则如果结果中某行全为NaN，则抛弃该行。<br />
<code>DataFrame.unstack(level=-1, fill_value=None)</code>：行索引转换为列索引。<br />
（1）level：一个整数、字符串或者整数字符串的列表。如果行索引为多级索引，它指定了将哪个级别的索引旋转为列索引。<br />
（2）fill_value：一个标量。如果结果中有NaN，则使用fill_value替换。<br />
旋转时，比如列索引旋转为行索引，则新的行索引是个多级索引，最内层的一级就是原来的列索引。<br />
<div class="tabs" id="f7"><ul class="nav-tabs"><li class="tab active"><a href="#f7-1">stack</a></li><li class="tab"><a href="#f7-2">unstack</a></li></ul><div class="tab-content"><div class="tab-pane active" id="f7-1"><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line">multicol1 = pd.MultiIndex.from_tuples([(<span class="string">&#x27;weight&#x27;</span>, <span class="string">&#x27;kg&#x27;</span>),</span><br><span class="line">                                       (<span class="string">&#x27;weight&#x27;</span>, <span class="string">&#x27;pounds&#x27;</span>)])</span><br><span class="line">df_multi_level_cols1 = pd.DataFrame([[<span class="number">1</span>, <span class="number">2</span>], [<span class="number">2</span>, <span class="number">4</span>]],</span><br><span class="line">                                    index=[<span class="string">&#x27;cat&#x27;</span>, <span class="string">&#x27;dog&#x27;</span>],</span><br><span class="line">                                    columns=multicol1)</span><br><span class="line">df_multi_level_cols1</span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">     weight</span></span><br><span class="line"><span class="string">         kg    pounds</span></span><br><span class="line"><span class="string">cat       1        2</span></span><br><span class="line"><span class="string">dog       2        4</span></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line">df_multi_level_cols1.stack()</span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">            weight</span></span><br><span class="line"><span class="string">cat kg           1</span></span><br><span class="line"><span class="string">    pounds       2</span></span><br><span class="line"><span class="string">dog kg           2</span></span><br><span class="line"><span class="string">    pounds       4</span></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line">multicol2 = pd.MultiIndex.from_tuples([(<span class="string">&#x27;weight&#x27;</span>, <span class="string">&#x27;kg&#x27;</span>),</span><br><span class="line">                                       (<span class="string">&#x27;height&#x27;</span>, <span class="string">&#x27;m&#x27;</span>)])</span><br><span class="line">df_multi_level_cols2 = pd.DataFrame([[<span class="number">1.0</span>, <span class="number">2.0</span>], [<span class="number">3.0</span>, <span class="number">4.0</span>]],</span><br><span class="line">                                    index=[<span class="string">&#x27;cat&#x27;</span>, <span class="string">&#x27;dog&#x27;</span>],</span><br><span class="line">                                    columns=multicol2)</span><br><span class="line">df_multi_level_cols2</span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">    weight height</span></span><br><span class="line"><span class="string">        kg      m</span></span><br><span class="line"><span class="string">cat    1.0    2.0</span></span><br><span class="line"><span class="string">dog    3.0    4.0</span></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line">df_multi_level_cols2.stack()</span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">        height  weight</span></span><br><span class="line"><span class="string">cat kg     NaN     1.0</span></span><br><span class="line"><span class="string">    m      2.0     NaN</span></span><br><span class="line"><span class="string">dog kg     NaN     3.0</span></span><br><span class="line"><span class="string">    m      4.0     NaN</span></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br></pre></td></tr></table></figure></div><div class="tab-pane" id="f7-2"><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line">index = pd.MultiIndex.from_tuples([(<span class="string">&#x27;one&#x27;</span>, <span class="string">&#x27;a&#x27;</span>), (<span class="string">&#x27;one&#x27;</span>, <span class="string">&#x27;b&#x27;</span>),</span><br><span class="line">                                   (<span class="string">&#x27;two&#x27;</span>, <span class="string">&#x27;a&#x27;</span>), (<span class="string">&#x27;two&#x27;</span>, <span class="string">&#x27;b&#x27;</span>)])</span><br><span class="line">s = pd.Series(np.arange(<span class="number">1.0</span>, <span class="number">5.0</span>), index=index)</span><br><span class="line">s</span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">one  a   1.0</span></span><br><span class="line"><span class="string">     b   2.0</span></span><br><span class="line"><span class="string">two  a   3.0</span></span><br><span class="line"><span class="string">     b   4.0</span></span><br><span class="line"><span class="string">dtype: float64</span></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="comment"># Series旋转后是DataFrame</span></span><br><span class="line">s.unstack(level=-<span class="number">1</span>)</span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">     a    b</span></span><br><span class="line"><span class="string">one  1.0  2.0</span></span><br><span class="line"><span class="string">two  3.0  4.0</span></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="comment"># Series旋转后是DataFrame</span></span><br><span class="line">s.unstack(level=<span class="number">0</span>)</span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">   one   two</span></span><br><span class="line"><span class="string">a  1.0   3.0</span></span><br><span class="line"><span class="string">b  2.0   4.0</span></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="comment"># 转换后的列不是MultiIndex时，则输出将是Series</span></span><br><span class="line">s.unstack(level=<span class="number">0</span>).unstack()</span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">one  a  1.0</span></span><br><span class="line"><span class="string">     b  2.0</span></span><br><span class="line"><span class="string">two  a  3.0</span></span><br><span class="line"><span class="string">     b  4.0</span></span><br><span class="line"><span class="string">dtype: float64</span></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br></pre></td></tr></table></figure></div></div></div></p>
<h4 id="索引和数据转换">索引和数据转换</h4>
<div class="note info"><p>将原始输入数据的列直接转换成 MultiIndex
，这种重建索引的方法处理数据集非常好用。</p>
</div>
<p>将<strong>列数据</strong>转换成<strong>行索引</strong>，只对DataFrame有效，因为Series没有列索引，其中DataFrame的。<br />
<code>DataFrame.set_index(keys, drop=True, append=False, inplace=False, verify_integrity=False)</code>：<br />
（1）keys：指定了一个或者多个列的标签。这些列将会被转换，列名变成行Index名，列数据变成行Index值。<br />
（2）drop：一个布尔值。如果为True，则keys对应的列会被删除；否则这些列仍然被保留。<br />
（3）append：一个布尔值。如果为True，则原有的行索引将保留（此时一定是个多级索引）；否则抛弃原来的行索引。<br />
（4）inplace：一个布尔值。如果为True，则原地修改并且返回None。<br />
（5）verify_integrity：一个布尔值。如果为True，则检查新的index是否有重复值。否则会推迟到检测过程到必须检测的时候。<br />
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line">idx = pd.Index([<span class="string">&#x27;a&#x27;</span>,<span class="string">&#x27;c&#x27;</span>,<span class="string">&#x27;d&#x27;</span>,<span class="string">&#x27;f&#x27;</span>])</span><br><span class="line">df = pd.DataFrame(&#123;<span class="string">&#x27;c1&#x27;</span>:[<span class="number">1</span>,<span class="number">5</span>,<span class="number">3</span>,<span class="number">2</span>],<span class="string">&#x27;c2&#x27;</span>:[<span class="number">2</span>,<span class="number">1</span>,<span class="number">5</span>,<span class="number">7</span>],<span class="string">&#x27;c3&#x27;</span>:[<span class="number">3</span>,<span class="number">2</span>,<span class="number">5</span>,<span class="number">6</span>]&#125;,index=idx)</span><br><span class="line">df</span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">   c1  c2  c3</span></span><br><span class="line"><span class="string">a   1   2   3</span></span><br><span class="line"><span class="string">c   5   1   2</span></span><br><span class="line"><span class="string">d   3   5   5</span></span><br><span class="line"><span class="string">f   2   7   6</span></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="comment"># 列c1和c2转换成行索引（多级索引），列名变成行索引名，列数据变成行标签。</span></span><br><span class="line">df.set_index(keys=[<span class="string">&#x27;c1&#x27;</span>,<span class="string">&#x27;c2&#x27;</span>])</span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">        c3</span></span><br><span class="line"><span class="string">c1  c2   </span></span><br><span class="line"><span class="string">1   2   3</span></span><br><span class="line"><span class="string">5   1   2</span></span><br><span class="line"><span class="string">3   5   5</span></span><br><span class="line"><span class="string">2   7   6</span></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="comment"># 保留原索引</span></span><br><span class="line">df.set_index(keys=<span class="string">&#x27;c1&#x27;</span>,append=<span class="literal">True</span>)</span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">       c2   c3</span></span><br><span class="line"><span class="string">   c1      </span></span><br><span class="line"><span class="string">a   1   2   3</span></span><br><span class="line"><span class="string">c   5   1   2</span></span><br><span class="line"><span class="string">d   3   5   5</span></span><br><span class="line"><span class="string">f   2   7   6</span></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br></pre></td></tr></table></figure><br />
将<strong>行索引</strong>转换为一个<strong>新列</strong>。<br />
<code>Series.reset_index(level=None, drop=False, name=None, inplace=False)</code>：<br />
<code>DataFrame.reset_index(level=None, drop=False, inplace=False, col_level=0, col_fill='')</code>：<br />
（1）level：一个整数/str/元组/列表。它指定了将哪层的行Index转换。如果为None，则转换所有的行Index。<br />
（2）drop：一个布尔值。如果为True，则并不会转换成新的列。如果为False，则转换成新的列，由原行Index组成，其列名默认为'index'，Series可用name指定，DataFrame为Index名。<br />
（3）inplace：一个布尔值。如果为True，则原地修改并且返回None。<br />
（4）col_level：一个整数/str/元组/列表。如果列索引也是多层次的，则决定插入到列索引的哪个level。Index名字放入此level中。<br />
（5）col_fill：一个字符串/字符串列表。如果列索引也是多层次的，则决定插入之后剩余level的索引名字是什么。默认情况下就是重复该Index名字。<br />
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br></pre></td><td class="code"><pre><span class="line">idx = pd.MultiIndex.from_arrays(arrays=[[<span class="string">&#x27;a&#x27;</span>,<span class="string">&#x27;c&#x27;</span>,<span class="string">&#x27;d&#x27;</span>,<span class="string">&#x27;f&#x27;</span>],[<span class="string">&#x27;g&#x27;</span>,<span class="string">&#x27;h&#x27;</span>,<span class="string">&#x27;i&#x27;</span>,<span class="string">&#x27;j&#x27;</span>]],names=[<span class="string">&#x27;i1&#x27;</span>,<span class="string">&#x27;i2&#x27;</span>])</span><br><span class="line">df = pd.DataFrame(&#123;<span class="string">&#x27;c1&#x27;</span>:[<span class="number">1</span>,<span class="number">5</span>,<span class="number">3</span>,<span class="number">2</span>],<span class="string">&#x27;c2&#x27;</span>:[<span class="number">2</span>,<span class="number">1</span>,<span class="number">5</span>,<span class="number">7</span>]&#125;,index=idx)</span><br><span class="line">df</span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">        c1  c2</span></span><br><span class="line"><span class="string">i1  i2      </span></span><br><span class="line"><span class="string">a   g   1   2</span></span><br><span class="line"><span class="string">c   h   5   1</span></span><br><span class="line"><span class="string">d   i   3   5</span></span><br><span class="line"><span class="string">f   j   2   7</span></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="comment"># 行索引转换成列</span></span><br><span class="line">df.reset_index(level=<span class="number">0</span>)</span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">   i1  c1  c2</span></span><br><span class="line"><span class="string">i2         </span></span><br><span class="line"><span class="string">g   a   1   2</span></span><br><span class="line"><span class="string">h   c   5   1</span></span><br><span class="line"><span class="string">i   d   3   5</span></span><br><span class="line"><span class="string">j   f   2   7</span></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="comment"># 抛弃转换后的列，行Index使用自动编码</span></span><br><span class="line">df.reset_index(level=[<span class="number">0</span>,<span class="number">1</span>],drop=<span class="literal">True</span>)</span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">   c1   c2</span></span><br><span class="line"><span class="string">0   1   2</span></span><br><span class="line"><span class="string">1   5   1</span></span><br><span class="line"><span class="string">2   3   5</span></span><br><span class="line"><span class="string">3   2   7</span></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line">index = pd.MultiIndex.from_tuples([(<span class="string">&#x27;bird&#x27;</span>, <span class="string">&#x27;falcon&#x27;</span>),</span><br><span class="line">                                   (<span class="string">&#x27;bird&#x27;</span>, <span class="string">&#x27;parrot&#x27;</span>),</span><br><span class="line">                                   (<span class="string">&#x27;mammal&#x27;</span>, <span class="string">&#x27;lion&#x27;</span>),</span><br><span class="line">                                   (<span class="string">&#x27;mammal&#x27;</span>, <span class="string">&#x27;monkey&#x27;</span>)],</span><br><span class="line">                                  names=[<span class="string">&#x27;class&#x27;</span>, <span class="string">&#x27;name&#x27;</span>])</span><br><span class="line">columns = pd.MultiIndex.from_tuples([(<span class="string">&#x27;speed&#x27;</span>, <span class="string">&#x27;max&#x27;</span>),</span><br><span class="line">                                     (<span class="string">&#x27;species&#x27;</span>, <span class="string">&#x27;type&#x27;</span>)])</span><br><span class="line">df = pd.DataFrame([(<span class="number">389.0</span>, <span class="string">&#x27;fly&#x27;</span>),</span><br><span class="line">                   ( <span class="number">24.0</span>, <span class="string">&#x27;fly&#x27;</span>),</span><br><span class="line">                   ( <span class="number">80.5</span>, <span class="string">&#x27;run&#x27;</span>),</span><br><span class="line">                   (np.nan, <span class="string">&#x27;jump&#x27;</span>)],</span><br><span class="line">                  index=index,</span><br><span class="line">                  columns=columns)</span><br><span class="line">df</span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">               speed species</span></span><br><span class="line"><span class="string">                 max    type</span></span><br><span class="line"><span class="string">class  name</span></span><br><span class="line"><span class="string">bird   falcon  389.0     fly</span></span><br><span class="line"><span class="string">       parrot   24.0     fly</span></span><br><span class="line"><span class="string">mammal lion     80.5     run</span></span><br><span class="line"><span class="string">       monkey    NaN    jump</span></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line">df.reset_index(level=<span class="string">&#x27;class&#x27;</span>, col_level=<span class="number">1</span>)</span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">                speed species</span></span><br><span class="line"><span class="string">         class    max    type</span></span><br><span class="line"><span class="string">name</span></span><br><span class="line"><span class="string">falcon    bird  389.0     fly</span></span><br><span class="line"><span class="string">parrot    bird   24.0     fly</span></span><br><span class="line"><span class="string">lion    mammal   80.5     run</span></span><br><span class="line"><span class="string">monkey  mammal    NaN    jump</span></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line">df.reset_index(level=<span class="string">&#x27;class&#x27;</span>, col_level=<span class="number">1</span>, col_fill=<span class="string">&#x27;species&#x27;</span>)</span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">              species  speed species</span></span><br><span class="line"><span class="string">                class    max    type</span></span><br><span class="line"><span class="string">name</span></span><br><span class="line"><span class="string">falcon           bird  389.0     fly</span></span><br><span class="line"><span class="string">parrot           bird   24.0     fly</span></span><br><span class="line"><span class="string">lion           mammal   80.5     run</span></span><br><span class="line"><span class="string">monkey         mammal    NaN    jump</span></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br></pre></td></tr></table></figure><br />
<code>DataFrame.pivot(index=None, columns=None, values=None)</code>：它使用set_index将指定列数据变成行索引，然后使用unstack将指定行索引转为列索引。<br />
（1）index：一个字符串。指定了哪个列数据来set_index（将该列数据变成行索引，删除了原来的旧的行索引）。如果为None，则不执行set_index。<br />
（2）columns：一个字符串。指定了哪个列数据作为结果的列标签。<br />
（3）values：一个字符串。指定了哪个列数据作为结果的数据。如果未提供，则剩余的所有列都将作为结果的数据。<br />
前提是指定索引组合下的数据，不能出现重复值，会报错。<br />
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br></pre></td><td class="code"><pre><span class="line">df = pd.DataFrame(&#123;<span class="string">&#x27;foo&#x27;</span>: [<span class="string">&#x27;one&#x27;</span>, <span class="string">&#x27;one&#x27;</span>, <span class="string">&#x27;one&#x27;</span>, <span class="string">&#x27;two&#x27;</span>, <span class="string">&#x27;two&#x27;</span>,</span><br><span class="line">                           <span class="string">&#x27;two&#x27;</span>],</span><br><span class="line">                   <span class="string">&#x27;bar&#x27;</span>: [<span class="string">&#x27;A&#x27;</span>, <span class="string">&#x27;B&#x27;</span>, <span class="string">&#x27;C&#x27;</span>, <span class="string">&#x27;A&#x27;</span>, <span class="string">&#x27;B&#x27;</span>, <span class="string">&#x27;C&#x27;</span>],</span><br><span class="line">                   <span class="string">&#x27;baz&#x27;</span>: [<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span>, <span class="number">5</span>, <span class="number">6</span>],</span><br><span class="line">                   <span class="string">&#x27;zoo&#x27;</span>: [<span class="string">&#x27;x&#x27;</span>, <span class="string">&#x27;y&#x27;</span>, <span class="string">&#x27;z&#x27;</span>, <span class="string">&#x27;q&#x27;</span>, <span class="string">&#x27;w&#x27;</span>, <span class="string">&#x27;t&#x27;</span>]&#125;)</span><br><span class="line">df</span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">    foo   bar  baz  zoo</span></span><br><span class="line"><span class="string">0   one   A    1    x</span></span><br><span class="line"><span class="string">1   one   B    2    y</span></span><br><span class="line"><span class="string">2   one   C    3    z</span></span><br><span class="line"><span class="string">3   two   A    4    q</span></span><br><span class="line"><span class="string">4   two   B    5    w</span></span><br><span class="line"><span class="string">5   two   C    6    t</span></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="comment"># foo变为行索引，bar变为列索引，使用baz的数据填充结果</span></span><br><span class="line">df.pivot(index=<span class="string">&#x27;foo&#x27;</span>, columns=<span class="string">&#x27;bar&#x27;</span>, values=<span class="string">&#x27;baz&#x27;</span>)</span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">bar  A   B   C</span></span><br><span class="line"><span class="string">foo</span></span><br><span class="line"><span class="string">one  1   2   3</span></span><br><span class="line"><span class="string">two  4   5   6</span></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="comment"># 使用剩余列填充结果</span></span><br><span class="line">df.pivot(index=<span class="string">&#x27;foo&#x27;</span>, columns=<span class="string">&#x27;bar&#x27;</span>, values=[<span class="string">&#x27;baz&#x27;</span>, <span class="string">&#x27;zoo&#x27;</span>])</span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">      baz       zoo</span></span><br><span class="line"><span class="string">bar   A  B  C   A  B  C</span></span><br><span class="line"><span class="string">foo</span></span><br><span class="line"><span class="string">one   1  2  3   x  y  z</span></span><br><span class="line"><span class="string">two   4  5  6   q  w  t</span></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line">df = pd.DataFrame(&#123;<span class="string">&quot;foo&quot;</span>: [<span class="string">&#x27;one&#x27;</span>, <span class="string">&#x27;one&#x27;</span>, <span class="string">&#x27;two&#x27;</span>, <span class="string">&#x27;two&#x27;</span>],</span><br><span class="line">                   <span class="string">&quot;bar&quot;</span>: [<span class="string">&#x27;A&#x27;</span>, <span class="string">&#x27;A&#x27;</span>, <span class="string">&#x27;B&#x27;</span>, <span class="string">&#x27;C&#x27;</span>],</span><br><span class="line">                   <span class="string">&quot;baz&quot;</span>: [<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span>]&#125;)</span><br><span class="line">df <span class="comment"># foo和bar组合</span></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">   foo bar  baz</span></span><br><span class="line"><span class="string">0  one   A    1</span></span><br><span class="line"><span class="string">1  one   A    2</span></span><br><span class="line"><span class="string">2  two   B    3</span></span><br><span class="line"><span class="string">3  two   C    4</span></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="comment"># foo和bar的组合有相同值(one   A)，会报错</span></span><br><span class="line">df.pivot(index=<span class="string">&#x27;foo&#x27;</span>, columns=<span class="string">&#x27;bar&#x27;</span>, values=<span class="string">&#x27;baz&#x27;</span>)</span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">Traceback (most recent call last):</span></span><br><span class="line"><span class="string">   ...</span></span><br><span class="line"><span class="string">ValueError: Index contains duplicate entries, cannot reshape</span></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br></pre></td></tr></table></figure><br />
其他方式：DataFrame的.T方法会对DataFrame进行转置，使得行与列互换（行索引与列索引也互换）。</p>
<h4 id="数据集合并">数据集合并</h4>
<p><code>pd.concat(objs, axis=0, join='outer', ignore_index=False, keys=None, levels=None, names=None, verify_integrity=False, sort=False, copy=True)</code>：将多个DataFrame/Series对象拼接起来。默认行拼接，行索引重复也会保留。<br />
（1）objs：一个序列，序列元素为Series/DataFrame/Panel等。你也可以传入一个字典，此时字典的键将作为keys参数。<br />
（2）axis：指定拼接沿着哪个轴。可以为0/'index'表示沿着 0
轴拼接。可以为1/'columns'表示沿着 1 轴拼接。<br />
（3）join：可以为'inner'（交集）/'outer'（并集），指定其他轴上的列如何拼接。<br />
（4）verify_integrity：一个布尔值。如果为True，则检查新连接的轴上是否有重复标签，如果有则抛出异常。<br />
（5）keys：一个序列。它用于区分拼接结果中，这些行/列来分别来自哪里。在必要的时候将建立多级索引，keys作为最外层的索引。如果objs是个字典，则使用字典的键作为keys。<br />
（6）levels：一个序列。与keys配合使用，指定多级索引各级别上的下标。如果为空，则从keys参数中推断。（推荐为空）。<br />
（7）names：一个序列。与keys配合使用，用于建立多级索引的names。<br />
（8）ignore_index：一个布尔值。如果为True，不使用拼接后轴的索引，使用RangeIndex，取值为0,1,...。<br />
（9）copy：一个布尔值。如果为True，则拷贝数据。<br />
（10）sort：一个布尔值。是否按照列名排序，join为'outer'时才有效，因为join为'inner'时，拼接结果已经排序了。<br />
<div class="tabs" id="10"><ul class="nav-tabs"><li class="tab active"><a href="#10-1">Series</a></li><li class="tab"><a href="#10-2">DataFrame</a></li></ul><div class="tab-content"><div class="tab-pane active" id="10-1"><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line">s1 = pd.Series([<span class="string">&#x27;a&#x27;</span>, <span class="string">&#x27;b&#x27;</span>])</span><br><span class="line">s2 = pd.Series([<span class="string">&#x27;c&#x27;</span>, <span class="string">&#x27;d&#x27;</span>])</span><br><span class="line">pd.concat([s1, s2])</span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">0    a</span></span><br><span class="line"><span class="string">1    b</span></span><br><span class="line"><span class="string">0    c</span></span><br><span class="line"><span class="string">1    d</span></span><br><span class="line"><span class="string">dtype: object</span></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="comment"># 不使用拼接后的索引</span></span><br><span class="line">pd.concat([s1, s2], ignore_index=<span class="literal">True</span>)</span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">0    a</span></span><br><span class="line"><span class="string">1    b</span></span><br><span class="line"><span class="string">2    c</span></span><br><span class="line"><span class="string">3    d</span></span><br><span class="line"><span class="string">dtype: object</span></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="comment"># 增加数据来源名</span></span><br><span class="line">pd.concat([s1, s2], keys=[<span class="string">&#x27;s1&#x27;</span>, <span class="string">&#x27;s2&#x27;</span>])</span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">s1  0    a</span></span><br><span class="line"><span class="string">    1    b</span></span><br><span class="line"><span class="string">s2  0    c</span></span><br><span class="line"><span class="string">    1    d</span></span><br><span class="line"><span class="string">dtype: object</span></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="comment"># 配合keys使用，为多级索引命名</span></span><br><span class="line">pd.concat([s1, s2], keys=[<span class="string">&#x27;s1&#x27;</span>, <span class="string">&#x27;s2&#x27;</span>],names=[<span class="string">&#x27;Series name&#x27;</span>, <span class="string">&#x27;Row ID&#x27;</span>])</span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">Series name  Row ID</span></span><br><span class="line"><span class="string">s1           0         a</span></span><br><span class="line"><span class="string">             1         b</span></span><br><span class="line"><span class="string">s2           0         c</span></span><br><span class="line"><span class="string">             1         d</span></span><br><span class="line"><span class="string">dtype: object</span></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br></pre></td></tr></table></figure></div><div class="tab-pane" id="10-2"><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br></pre></td><td class="code"><pre><span class="line">df1 = pd.DataFrame([[<span class="string">&#x27;a&#x27;</span>, <span class="number">1</span>], [<span class="string">&#x27;b&#x27;</span>, <span class="number">2</span>]],</span><br><span class="line">                   columns=[<span class="string">&#x27;letter&#x27;</span>, <span class="string">&#x27;number&#x27;</span>])</span><br><span class="line">df1</span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">  letter  number</span></span><br><span class="line"><span class="string">0      a       1</span></span><br><span class="line"><span class="string">1      b       2</span></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line">df2 = pd.DataFrame([[<span class="string">&#x27;c&#x27;</span>, <span class="number">3</span>], [<span class="string">&#x27;d&#x27;</span>, <span class="number">4</span>]],</span><br><span class="line">                   columns=[<span class="string">&#x27;letter&#x27;</span>, <span class="string">&#x27;number&#x27;</span>])</span><br><span class="line">df2</span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">  letter  number</span></span><br><span class="line"><span class="string">0      c       3</span></span><br><span class="line"><span class="string">1      d       4</span></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line">pd.concat([df1, df2])</span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">  letter  number</span></span><br><span class="line"><span class="string">0      a       1</span></span><br><span class="line"><span class="string">1      b       2</span></span><br><span class="line"><span class="string">0      c       3</span></span><br><span class="line"><span class="string">1      d       4</span></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line">df3 = pd.DataFrame([[<span class="string">&#x27;c&#x27;</span>, <span class="number">3</span>, <span class="string">&#x27;cat&#x27;</span>], [<span class="string">&#x27;d&#x27;</span>, <span class="number">4</span>, <span class="string">&#x27;dog&#x27;</span>]],</span><br><span class="line">                   columns=[<span class="string">&#x27;letter&#x27;</span>, <span class="string">&#x27;number&#x27;</span>, <span class="string">&#x27;animal&#x27;</span>])</span><br><span class="line">df3</span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">  letter  number animal</span></span><br><span class="line"><span class="string">0      c       3    cat</span></span><br><span class="line"><span class="string">1      d       4    dog</span></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line">pd.concat([df1, df3], sort=<span class="literal">False</span>)</span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">  letter  number animal</span></span><br><span class="line"><span class="string">0      a       1    NaN</span></span><br><span class="line"><span class="string">1      b       2    NaN</span></span><br><span class="line"><span class="string">0      c       3    cat</span></span><br><span class="line"><span class="string">1      d       4    dog</span></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line">pd.concat([df1, df3], sort=<span class="literal">True</span>)</span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">  animal   letter   number</span></span><br><span class="line"><span class="string">0   NaN        a        1</span></span><br><span class="line"><span class="string">1   NaN        b        2</span></span><br><span class="line"><span class="string">0   cat        c        3</span></span><br><span class="line"><span class="string">1   dog        d        4</span></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line">pd.concat([df1, df3], join=<span class="string">&quot;inner&quot;</span>)</span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">  letter  number</span></span><br><span class="line"><span class="string">0      a       1</span></span><br><span class="line"><span class="string">1      b       2</span></span><br><span class="line"><span class="string">0      c       3</span></span><br><span class="line"><span class="string">1      d       4</span></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line">df4 = pd.DataFrame([[<span class="string">&#x27;bird&#x27;</span>, <span class="string">&#x27;polly&#x27;</span>], [<span class="string">&#x27;monkey&#x27;</span>, <span class="string">&#x27;george&#x27;</span>]],columns=[<span class="string">&#x27;animal&#x27;</span>, <span class="string">&#x27;name&#x27;</span>])</span><br><span class="line">df4 </span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">   animal    name</span></span><br><span class="line"><span class="string">0   bird    polly</span></span><br><span class="line"><span class="string">1   monkey  george</span></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line">pd.concat([df1, df4], axis=<span class="number">1</span>)</span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">  letter  number  animal    name</span></span><br><span class="line"><span class="string">0      a       1    bird   polly</span></span><br><span class="line"><span class="string">1      b       2  monkey  george</span></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br></pre></td></tr></table></figure></div></div></div></p>
<p>对于DataFrame，可以像数据库一样连接操作，参数也是参考的数据库操作，<code>merge()</code>方法就是一种方式，它可以根据一个或者多个<strong>列键</strong>将不同DataFrame连接接起来。<br />
<code>DataFrame.merge(right, how='inner', on=None, left_on=None, right_on=None, left_index=False, right_index=False, sort=False, suffixes=('_x', '_y'), copy=True, indicator=False)</code>：<br />
<code>pd.merge(left, right, how='inner', on=None, left_on=None, right_on=None, left_index=False, right_index=False, sort=False, suffixes=('_x', '_y'), copy=True, indicator=False)</code>：<br />
（1）right：另一个DataFrame对象。<br />
（2）how：指定连接类型，和数据库一样。可以为：<br />
　　　'left'：左连接。只使用左边DataFrame的连接键。<br />
　　　'right'：右连接。只使用右边DataFrame的连接键。<br />
　　　'outer'：外连接。使用两个DataFrame的连接键的并集。<br />
　　　'inner'：内连接。使用两个DataFrame的连接键的交集。<br />
　　　'cross'：交叉连接。两个DataFrame的连接键的笛卡儿积，保留左键的顺序。<br />
（3）on：一个label或者label
list。它指定于连接键的列的label。并且必须在两个DataFrame中这些label都存在。如果它为None，则默认使用两个DataFrame的列label的交集。你可以通过left_on/right_on分别指定两侧DataFrame对齐的连接键。<br />
（4）left_on：一个label或者label
list。指定左边DataFrame用作连接键的列，参考on。<br />
（5）right_on：一个label或者label
list。指定右边DataFrame用作连接键的列，参考on。<br />
（6）left_index：一个布尔值。如果为True，则使用左边的DataFrame的行Index
label来作为连接键来合并。<br />
（7）right_index：一个布尔值。如果为True，则使用右边的DataFrame的行Index
label来作为连接键来合并。<br />
（8）sort：一个布尔值。如果为True，则在结果中，对合并采用的连接键进行排序。<br />
（9）suffixes：一个二元序列。对于结果中同名的列，它会添加前缀来指示它们来自哪个DataFrame。<br />
（10）copy：一个布尔值。如果为True，则拷贝基础数据。否则不拷贝数据。<br />
（11）indicator：一个字符串或者布尔值。如果为True，则结果中多了一列称作_merge，该列给出了每一行来自于那个DataFrame。如果为字符串，则结果中多了一列，列名由indicator给出，该列给出了每一行来自于那个DataFrame。<br />
（12）validate：检查合并是否为指定的类型。可检查的类型：<br />
　　　'one_to_one'/'1:1'：检查合并键的值组合在左右数据集中是否唯一。<br />
　　　'one_to_many'/'1:m'：检查合并键值组合在左数据集中是否唯一。<br />
　　　'many_to_one'/'m:1'：检查合并键值组合在右数据集中是否唯一。<br />
　　　'many_to_many'/'m:m'：都允许，不会导致检查。<br />
<div class="note info"><ul>
<li>如果合并的序列来自于行Index
label，则使用left_index或者right_index参数。如果是使用了left_index=True，则必须使用right_index=True或者指定right_on。此时right_on为第二个DataFrame的行label。此时所有对键的操作都针行Index
label，而不再是column label。</li>
<li>如果不指定连接的键，则默认使用两个DataFrame的column
label的交集中的第一个label。</li>
<li>如果根据列来连接，则结果的行Index
label是RangeIndex（连续整数）。如果根据行Index label连接，则结果行Index
label和column label来自两个DataFrame。</li>
<li>对于多层索引的数据，必须以列表的形式指明用作合并键的多个列。</li>
<li>可实现一对一，多对一，多对多方式连接。一方有重复值时，会像笛卡尔乘积那样生成多对数据。</li>
</ul>
</div><br />
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br></pre></td><td class="code"><pre><span class="line">df1 = pd.DataFrame(&#123;<span class="string">&#x27;lkey&#x27;</span>: [<span class="string">&#x27;foo&#x27;</span>, <span class="string">&#x27;bar&#x27;</span>, <span class="string">&#x27;baz&#x27;</span>, <span class="string">&#x27;foo&#x27;</span>],</span><br><span class="line">                    <span class="string">&#x27;value&#x27;</span>: [<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">5</span>]&#125;)</span><br><span class="line">df2 = pd.DataFrame(&#123;<span class="string">&#x27;rkey&#x27;</span>: [<span class="string">&#x27;foo&#x27;</span>, <span class="string">&#x27;bar&#x27;</span>, <span class="string">&#x27;baz&#x27;</span>, <span class="string">&#x27;foo&#x27;</span>],</span><br><span class="line">                    <span class="string">&#x27;value&#x27;</span>: [<span class="number">5</span>, <span class="number">6</span>, <span class="number">7</span>, <span class="number">8</span>]&#125;)</span><br><span class="line">df1</span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">    lkey value</span></span><br><span class="line"><span class="string">0   foo      1</span></span><br><span class="line"><span class="string">1   bar      2</span></span><br><span class="line"><span class="string">2   baz      3</span></span><br><span class="line"><span class="string">3   foo      5</span></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line">df2</span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">    rkey value</span></span><br><span class="line"><span class="string">0   foo      5</span></span><br><span class="line"><span class="string">1   bar      6</span></span><br><span class="line"><span class="string">2   baz      7</span></span><br><span class="line"><span class="string">3   foo      8</span></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="comment"># 按指定列连接</span></span><br><span class="line">df1.merge(df2, left_on=<span class="string">&#x27;lkey&#x27;</span>, right_on=<span class="string">&#x27;rkey&#x27;</span>)</span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">  lkey  value_x rkey  value_y</span></span><br><span class="line"><span class="string">0  foo        1  foo        5</span></span><br><span class="line"><span class="string">1  foo        1  foo        8</span></span><br><span class="line"><span class="string">2  foo        5  foo        5</span></span><br><span class="line"><span class="string">3  foo        5  foo        8</span></span><br><span class="line"><span class="string">4  bar        2  bar        6</span></span><br><span class="line"><span class="string">5  baz        3  baz        7</span></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="comment"># 重名列，添加前缀表示来自哪个DataFrame</span></span><br><span class="line">df1.merge(df2, left_on=<span class="string">&#x27;lkey&#x27;</span>, right_on=<span class="string">&#x27;rkey&#x27;</span>, suffixes=(<span class="string">&#x27;_left&#x27;</span>, <span class="string">&#x27;_right&#x27;</span>))</span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">  lkey  value_left rkey  value_right</span></span><br><span class="line"><span class="string">0  foo           1  foo            5</span></span><br><span class="line"><span class="string">1  foo           1  foo            8</span></span><br><span class="line"><span class="string">2  foo           5  foo            5</span></span><br><span class="line"><span class="string">3  foo           5  foo            8</span></span><br><span class="line"><span class="string">4  bar           2  bar            6</span></span><br><span class="line"><span class="string">5  baz           3  baz            7</span></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line">df1 = pd.DataFrame(&#123;<span class="string">&#x27;a&#x27;</span>: [<span class="string">&#x27;foo&#x27;</span>, <span class="string">&#x27;bar&#x27;</span>], <span class="string">&#x27;b&#x27;</span>: [<span class="number">1</span>, <span class="number">2</span>]&#125;)</span><br><span class="line">df2 = pd.DataFrame(&#123;<span class="string">&#x27;a&#x27;</span>: [<span class="string">&#x27;foo&#x27;</span>, <span class="string">&#x27;baz&#x27;</span>], <span class="string">&#x27;c&#x27;</span>: [<span class="number">3</span>, <span class="number">4</span>]&#125;)</span><br><span class="line">df1</span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">      a  b</span></span><br><span class="line"><span class="string">0   foo  1</span></span><br><span class="line"><span class="string">1   bar  2</span></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line">df2</span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">      a  c</span></span><br><span class="line"><span class="string">0   foo  3</span></span><br><span class="line"><span class="string">1   baz  4</span></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="comment"># 内链接（列交集）</span></span><br><span class="line">df1.merge(df2, how=<span class="string">&#x27;inner&#x27;</span>, on=<span class="string">&#x27;a&#x27;</span>)</span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">      a  b  c</span></span><br><span class="line"><span class="string">0   foo  1  3</span></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="comment"># 左连接</span></span><br><span class="line">df1.merge(df2, how=<span class="string">&#x27;left&#x27;</span>, on=<span class="string">&#x27;a&#x27;</span>)</span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">      a  b  c</span></span><br><span class="line"><span class="string">0   foo  1  3.0</span></span><br><span class="line"><span class="string">1   bar  2  NaN</span></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line">df1 = pd.DataFrame(&#123;<span class="string">&#x27;left&#x27;</span>: [<span class="string">&#x27;foo&#x27;</span>, <span class="string">&#x27;bar&#x27;</span>]&#125;)</span><br><span class="line">df2 = pd.DataFrame(&#123;<span class="string">&#x27;right&#x27;</span>: [<span class="number">7</span>, <span class="number">8</span>]&#125;)</span><br><span class="line">df1</span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">    left</span></span><br><span class="line"><span class="string">0   foo</span></span><br><span class="line"><span class="string">1   bar</span></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line">df2</span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">    right</span></span><br><span class="line"><span class="string">0   7</span></span><br><span class="line"><span class="string">1   8</span></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line">df1.merge(df2, how=<span class="string">&#x27;cross&#x27;</span>)</span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">   left  right</span></span><br><span class="line"><span class="string">0   foo      7</span></span><br><span class="line"><span class="string">1   foo      8</span></span><br><span class="line"><span class="string">2   bar      7</span></span><br><span class="line"><span class="string">3   bar      8</span></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br></pre></td></tr></table></figure></p>
<p>如果所有的连接键来自于某列值，则可以使用<code>DataFrame.join()</code>函数。它是<code>merge()</code>的简化版。<br />
<code>DataFrame.join(other, on=None, how='left', lsuffix='', rsuffix='', sort=False)</code>：<br />
（1）other：一个DataFrame/一个Series（要求它的name非空）/一个DataFrame序列。Series的name作用等同DataFrame的column
label。<br />
（2）on：指定以调用者的哪个列为键。<br />
（3）how：参考merge的how。<br />
（4）lsuffic/rsuffix：参考merge的suffixes。如果结果中有重名的列，则必须指定它们之一。<br />
（5）sort：一个布尔值。如果为True，则在结果中，对合并采用的连接键进行排序。<br />
如果是Series，则连接键为Series的行Index。此外，DataFrame默认使用行Index连接（这与merge不同，merge默认是列键拼接）。<br />
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br></pre></td><td class="code"><pre><span class="line">df = pd.DataFrame(&#123;<span class="string">&#x27;key&#x27;</span>: [<span class="string">&#x27;K0&#x27;</span>, <span class="string">&#x27;K1&#x27;</span>, <span class="string">&#x27;K2&#x27;</span>, <span class="string">&#x27;K3&#x27;</span>, <span class="string">&#x27;K4&#x27;</span>, <span class="string">&#x27;K5&#x27;</span>],</span><br><span class="line">                   <span class="string">&#x27;A&#x27;</span>: [<span class="string">&#x27;A0&#x27;</span>, <span class="string">&#x27;A1&#x27;</span>, <span class="string">&#x27;A2&#x27;</span>, <span class="string">&#x27;A3&#x27;</span>, <span class="string">&#x27;A4&#x27;</span>, <span class="string">&#x27;A5&#x27;</span>]&#125;)</span><br><span class="line">df</span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">  key   A</span></span><br><span class="line"><span class="string">0  K0  A0</span></span><br><span class="line"><span class="string">1  K1  A1</span></span><br><span class="line"><span class="string">2  K2  A2</span></span><br><span class="line"><span class="string">3  K3  A3</span></span><br><span class="line"><span class="string">4  K4  A4</span></span><br><span class="line"><span class="string">5  K5  A5</span></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line">other = pd.DataFrame(&#123;<span class="string">&#x27;key&#x27;</span>: [<span class="string">&#x27;K0&#x27;</span>, <span class="string">&#x27;K1&#x27;</span>, <span class="string">&#x27;K2&#x27;</span>],</span><br><span class="line">                      <span class="string">&#x27;B&#x27;</span>: [<span class="string">&#x27;B0&#x27;</span>, <span class="string">&#x27;B1&#x27;</span>, <span class="string">&#x27;B2&#x27;</span>]&#125;)</span><br><span class="line">other</span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">  key   B</span></span><br><span class="line"><span class="string">0  K0  B0</span></span><br><span class="line"><span class="string">1  K1  B1</span></span><br><span class="line"><span class="string">2  K2  B2</span></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="comment"># 默认行连接</span></span><br><span class="line">df.join(other, lsuffix=<span class="string">&#x27;_caller&#x27;</span>, rsuffix=<span class="string">&#x27;_other&#x27;</span>)</span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">  key_caller   A key_other    B</span></span><br><span class="line"><span class="string">0         K0  A0        K0   B0</span></span><br><span class="line"><span class="string">1         K1  A1        K1   B1</span></span><br><span class="line"><span class="string">2         K2  A2        K2   B2</span></span><br><span class="line"><span class="string">3         K3  A3       NaN  NaN</span></span><br><span class="line"><span class="string">4         K4  A4       NaN  NaN</span></span><br><span class="line"><span class="string">5         K5  A5       NaN  NaN</span></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="comment"># 如果要使用键列进行联接，则需要将key设置为df和other的行索引</span></span><br><span class="line">df.set_index(<span class="string">&#x27;key&#x27;</span>).join(other.set_index(<span class="string">&#x27;key&#x27;</span>))</span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">      A    B</span></span><br><span class="line"><span class="string">key</span></span><br><span class="line"><span class="string">K0   A0   B0</span></span><br><span class="line"><span class="string">K1   A1   B1</span></span><br><span class="line"><span class="string">K2   A2   B2</span></span><br><span class="line"><span class="string">K3   A3  NaN</span></span><br><span class="line"><span class="string">K4   A4  NaN</span></span><br><span class="line"><span class="string">K5   A5  NaN</span></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="comment"># 使用键列进行连接的另一种方法是使用on参数</span></span><br><span class="line"><span class="comment"># 此方法将原始DataFrame的索引保留在结果中</span></span><br><span class="line">df.join(other.set_index(<span class="string">&#x27;key&#x27;</span>), on=<span class="string">&#x27;key&#x27;</span>)</span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">  key   A    B</span></span><br><span class="line"><span class="string">0  K0  A0   B0</span></span><br><span class="line"><span class="string">1  K1  A1   B1</span></span><br><span class="line"><span class="string">2  K2  A2   B2</span></span><br><span class="line"><span class="string">3  K3  A3  NaN</span></span><br><span class="line"><span class="string">4  K4  A4  NaN</span></span><br><span class="line"><span class="string">5  K5  A5  NaN</span></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br></pre></td></tr></table></figure><br />
如果你想在行合并时，对两个数据集列连接后的结果进行处理，可使用<code>combine()</code>方法。<br />
<code>Series.combine(other, func, fill_value=nan)</code>：<br />
<code>DataFrame.combine(other, func, fill_value=None, overwrite=True)</code>：<br />
（1）other：Series中必须为另一个Series，DataFrame中必须为另一个DataFrame。<br />
（2）func：一个函数，该函数拥有两个位置参数。第一个参数来自于调用者，第二个参数来自于other。<br />
　　　对于Series，两个参数都是标量值，对应它们对齐后的元素值。返回值就是结果对应位置处的值。<br />
　　　对于DataFrame，这两个参数都是Series，即对应的列。<br />
（3）fill_value：一个标量 。在合并之前先用它来填充 NaN。<br />
（4）overwrite：如果为True，则原地修改调用者。如果为False，则返回一个新建的对象。<br />
<div class="note info"><ul>
<li>Series：结果的index是两个的并集。结果中每个元素值这样产生：将两个Series，相同的index的两个标量值，作为参数传给func；func的返回值就是对应Series在当前位置值。</li>
<li>DataFrame：结果的index/columns是两个的并集。结果中每列这样产生：将两个DataFrame，相同的column
label的两个列，作为参数传给func；func的返回值就是对应列的当前位置值。</li>
</ul>
</div><br />
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br></pre></td><td class="code"><pre><span class="line">df1 = pd.DataFrame(&#123;<span class="string">&#x27;A&#x27;</span>: [<span class="number">0</span>, <span class="number">1</span>], <span class="string">&#x27;B&#x27;</span>: [<span class="number">2</span>, <span class="number">4</span>]&#125;)</span><br><span class="line">df2 = pd.DataFrame(&#123;<span class="string">&#x27;A&#x27;</span>: [<span class="number">1</span>, <span class="number">2</span>], <span class="string">&#x27;B&#x27;</span>: [<span class="number">4</span>, <span class="number">3</span>]&#125;)</span><br><span class="line">df1</span><br><span class="line">df2</span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">    A   B</span></span><br><span class="line"><span class="string">0   0   2</span></span><br><span class="line"><span class="string">1   1   4</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">    A   B</span></span><br><span class="line"><span class="string">0   1   4</span></span><br><span class="line"><span class="string">1   2   3</span></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line">df1.join(df2, lsuffix=<span class="string">&#x27;_caller&#x27;</span>, rsuffix=<span class="string">&#x27;_other&#x27;</span>)</span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">   A_caller   B_caller   A_other   B_other</span></span><br><span class="line"><span class="string">0       0           2          1        4</span></span><br><span class="line"><span class="string">1       1           4          2        3</span></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="comment"># 传递的是相同column label的整列数据</span></span><br><span class="line"><span class="comment"># 返回的是对应列的当前位置值</span></span><br><span class="line">take_smaller = <span class="keyword">lambda</span> caller, other: caller <span class="keyword">if</span> caller.<span class="built_in">sum</span>() &lt; other.<span class="built_in">sum</span>() <span class="keyword">else</span> other</span><br><span class="line">df1.combine(df2, take_smaller)</span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">   A  B</span></span><br><span class="line"><span class="string">0  0  2</span></span><br><span class="line"><span class="string">1  1  4</span></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line">df1 = pd.DataFrame(&#123;<span class="string">&#x27;A&#x27;</span>: [<span class="number">5</span>, <span class="number">0</span>], <span class="string">&#x27;B&#x27;</span>: [<span class="number">2</span>, <span class="number">4</span>]&#125;)</span><br><span class="line">df2 = pd.DataFrame(&#123;<span class="string">&#x27;A&#x27;</span>: [<span class="number">1</span>, <span class="number">1</span>], <span class="string">&#x27;B&#x27;</span>: [<span class="number">3</span>, <span class="number">3</span>]&#125;)</span><br><span class="line">df1</span><br><span class="line">df2</span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">    A   B</span></span><br><span class="line"><span class="string">0   5   2</span></span><br><span class="line"><span class="string">1   0   4</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">    A   B</span></span><br><span class="line"><span class="string">0   1   3</span></span><br><span class="line"><span class="string">1   1   3</span></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line">df1.join(df2, lsuffix=<span class="string">&#x27;_caller&#x27;</span>, rsuffix=<span class="string">&#x27;_other&#x27;</span>)</span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">   A_caller   B_caller   A_other   B_other</span></span><br><span class="line"><span class="string">0       5           2          1        3</span></span><br><span class="line"><span class="string">1       0           4          1        3</span></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="comment"># np.minimum：返回两个数组x和y对应位置的最小值</span></span><br><span class="line">df1.combine(df2, np.minimum)</span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">   A  B</span></span><br><span class="line"><span class="string">0  1  2</span></span><br><span class="line"><span class="string">1  0  3</span></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line">df1 = pd.DataFrame(&#123;<span class="string">&#x27;A&#x27;</span>: [<span class="number">0</span>, <span class="number">0</span>], <span class="string">&#x27;B&#x27;</span>: [<span class="literal">None</span>, <span class="number">4</span>]&#125;)</span><br><span class="line">df2 = pd.DataFrame(&#123;<span class="string">&#x27;A&#x27;</span>: [<span class="number">1</span>, <span class="number">1</span>], <span class="string">&#x27;B&#x27;</span>: [<span class="number">3</span>, <span class="number">3</span>]&#125;)</span><br><span class="line"><span class="comment"># 传递前会填充None值</span></span><br><span class="line">df1.combine(df2, take_smaller, fill_value=-<span class="number">5</span>)</span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">   A    B</span></span><br><span class="line"><span class="string">0  0 -5.0</span></span><br><span class="line"><span class="string">1  0  4.0</span></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line">df1 = pd.DataFrame(&#123;<span class="string">&#x27;A&#x27;</span>: [<span class="number">0</span>, <span class="number">0</span>], <span class="string">&#x27;B&#x27;</span>: [<span class="literal">None</span>, <span class="number">4</span>]&#125;)</span><br><span class="line">df2 = pd.DataFrame(&#123;<span class="string">&#x27;A&#x27;</span>: [<span class="number">1</span>, <span class="number">1</span>], <span class="string">&#x27;B&#x27;</span>: [<span class="literal">None</span>, <span class="number">3</span>]&#125;)</span><br><span class="line"><span class="comment"># 连个DataFrame对应位置都是None，则不fill_value</span></span><br><span class="line">df1.combine(df2, take_smaller, fill_value=-<span class="number">5</span>)</span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">   A     B</span></span><br><span class="line"><span class="string">0  0  -5.0</span></span><br><span class="line"><span class="string">1  0   3.0</span></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br></pre></td></tr></table></figure><br />
如果你只想处理行合并数据中的Nan值，可用<code>combine_first()</code>处理。<br />
<code>Series/DataFrame.combine_first(other)</code>：<br />
（1）other：Series中必须为另一个Series，DataFrame中必须为另一个DataFrame。<br />
结果的index/columns是两个的并集。结果中每个元素值这样产生：如果调用者不是NaN，则选择调用者的值；如果调用者是NaN，则选择other的值（此时无论参数的值是否NaN）；如果该NaN值的位置在其他位置不存在，则NaN值仍然存在。<br />
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line">df1 = pd.DataFrame(&#123;<span class="string">&#x27;A&#x27;</span>: [<span class="literal">None</span>, <span class="number">0</span>], <span class="string">&#x27;B&#x27;</span>: [<span class="literal">None</span>, <span class="number">4</span>]&#125;)</span><br><span class="line">df2 = pd.DataFrame(&#123;<span class="string">&#x27;A&#x27;</span>: [<span class="number">1</span>, <span class="number">1</span>], <span class="string">&#x27;B&#x27;</span>: [<span class="number">3</span>, <span class="number">3</span>]&#125;)</span><br><span class="line">df1</span><br><span class="line">df2</span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">      A     B</span></span><br><span class="line"><span class="string">0   NaN   NaN</span></span><br><span class="line"><span class="string">1   0.0   4.0</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">    A   B</span></span><br><span class="line"><span class="string">0   1   3</span></span><br><span class="line"><span class="string">1   1   3</span></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line">df1.combine_first(df2)</span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">     A    B</span></span><br><span class="line"><span class="string">0  1.0  3.0</span></span><br><span class="line"><span class="string">1  0.0  4.0</span></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line">df1 = pd.DataFrame(&#123;<span class="string">&#x27;A&#x27;</span>: [<span class="literal">None</span>, <span class="number">0</span>], <span class="string">&#x27;B&#x27;</span>: [<span class="number">4</span>, <span class="literal">None</span>]&#125;)</span><br><span class="line">df2 = pd.DataFrame(&#123;<span class="string">&#x27;B&#x27;</span>: [<span class="number">3</span>, <span class="number">3</span>], <span class="string">&#x27;C&#x27;</span>: [<span class="number">1</span>, <span class="number">1</span>]&#125;, index=[<span class="number">1</span>, <span class="number">2</span>])</span><br><span class="line">df1</span><br><span class="line">df2</span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">    A       B</span></span><br><span class="line"><span class="string">0   NaN   4.0</span></span><br><span class="line"><span class="string">1   0.0   NaN</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">    B   C</span></span><br><span class="line"><span class="string">1   3   1</span></span><br><span class="line"><span class="string">2   3   1</span></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="comment"># A 和 C 对应other中没有，保留NaN</span></span><br><span class="line">df1.combine_first(df2)</span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">     A    B    C</span></span><br><span class="line"><span class="string">0  NaN  4.0  NaN</span></span><br><span class="line"><span class="string">1  0.0  3.0  1.0</span></span><br><span class="line"><span class="string">2  NaN  3.0  1.0</span></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br></pre></td></tr></table></figure></p>
<h3 id="pandas清洗">Pandas清洗</h3>
<h4 id="缺失值处理">缺失值处理</h4>
<p><strong>Ⅰ、Pandas的缺失值</strong><br />
在数据表或 DataFrame
中有很多表示缺失值的方法。一般情况下可以分为两种：<br />
（1）通过一个覆盖全局的<strong>掩码</strong>表示缺失值。数字'0'和'1'/布尔值'True'/'False'。<br />
（2）通过一个<strong>标签值</strong>表示缺失值。可能是具体的数据（例如用
-9999
表示缺失的整数），也可能是其他极少出现的形式。标签值还可能是更全局的值<code>None</code>/<code>NaN</code>。<br />
NumPy/Pandas 中缺失值是<code>NaN</code>，Python
中空对象是<code>None</code>、空字符是<code>null</code>。一般用<code>NA</code>符号表示缺失状态。</p>
<p>Pandas 最终选择用标签方法表示缺失值，包括两种 Python
原有的缺失值：浮点数据类型的 <code>NaN</code> 值，以及 Python 的
<code>None</code> 对象。</p>
<p><strong>1、None：Python对象</strong><br />
由于 None 是一个 Python 对象，所以不能作为任何 NumPy / Pandas
数组类型的缺失值，只能用于 'object' 数组类型（即由 Python
对象构成的数组）。<br />
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">vals1 = np.array([<span class="number">1</span>, <span class="literal">None</span>, <span class="number">3</span>, <span class="number">4</span>])</span><br><span class="line">vals1</span><br><span class="line"><span class="comment"># None是object类型，一个Python对象</span></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">array([1, None, 3, 4], dtype=object)</span></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br></pre></td></tr></table></figure><br />
None 类型对数据的任何操作最终都会在 Python 层面完成，但是在进行常见的
NumPy / Pandas
快速操作时，这种类型比其他原生类型数组要<strong>消耗更多的资源</strong>。如果你对一个包含
None 的数组进行累计操作，如 sum() 或者
min()，那么还通常会<strong>出现类型错误</strong>。</p>
<p><strong>2、NaN：数值类型的缺失值</strong><br />
另一种缺失值的标签是 NaN（全称 Not a Number），是一种按照 IEEE
浮点数标准设计、在任何系统中都兼容的特殊浮点数：<br />
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">vals2 = np.array([<span class="number">1</span>, np.nan, <span class="number">3</span>, <span class="number">4</span>])</span><br><span class="line">vals2.dtype</span><br><span class="line"><span class="comment"># NaN是浮点类型</span></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">dtype(&#x27;float64&#x27;)</span></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br></pre></td></tr></table></figure><br />
NumPy 会为这个数组选择一个原生浮点类型，这意味着和之前的 object
类型数组不同，这个数组会被编译成 C 代码从而实现快速操作。你可以把 NaN
看作是一个数据类病毒——它会将与它接触过的数据同化。无论和 NaN
进行何种操作，最终结果都是
NaN，而且不会像None那样出现异常。<strong>谨记， NaN
是一种特殊的浮点数，不是整数、字符串以及其他数据类型。</strong></p>
<p><strong>3、Pandas中NaN与None的差异</strong><br />
虽然 NaN 与 None 各有各的用处，但是 Pandas
把它们看成是可以等价交换的，在适当的时候会将两者进行替换：<br />
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">pd.Series([<span class="number">1</span>, np.nan, <span class="number">2</span>, <span class="literal">None</span>])</span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">0 1.0</span></span><br><span class="line"><span class="string">1 NaN</span></span><br><span class="line"><span class="string">2 2.0</span></span><br><span class="line"><span class="string">3 NaN</span></span><br><span class="line"><span class="string">dtype: float64</span></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br></pre></td></tr></table></figure><br />
Pandas 会将没有标签值（值为空）的数据类型自动转换为 NA
状态。例如，当我们将整型数组中的一个值设置为 None
时，这个值就会强制转换成浮点数缺失值 NaN。<br />
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">x = pd.Series(<span class="built_in">range</span>(<span class="number">2</span>), dtype=<span class="built_in">int</span>)</span><br><span class="line">x</span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">0 0</span></span><br><span class="line"><span class="string">1 1</span></span><br><span class="line"><span class="string">dtype: int64</span></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line">x[<span class="number">0</span>] = <span class="literal">None</span></span><br><span class="line">x</span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">0 NaN</span></span><br><span class="line"><span class="string">1 1.0</span></span><br><span class="line"><span class="string">dtype: float64</span></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br></pre></td></tr></table></figure><br />
Pandas对不同类型缺失值的转换规则：<br />
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">     类型         缺失值转换规则       NA标签值</span><br><span class="line">floating 浮点型     无变化             np.nan</span><br><span class="line">object 对象类型     无变化             None 或 np.nan</span><br><span class="line">integer 整数类型    强制转换为float64  np.nan</span><br><span class="line">boolean 布尔类型    强制转换为object   None 或 np.nan</span><br></pre></td></tr></table></figure></p>
<p><strong>Ⅱ、处理缺失值</strong><br />
<strong>1、判断缺失值：</strong><br />
<code>isnull()</code>：判断当前值是NaN？返回布尔类型的掩码数据。<br />
<code>notnull()</code>：判断当前值不是NaN？返回布尔类型的掩码数据。</p>
<p><strong>2、剔除缺失值所在的行/列：</strong><br />
<code>Series.dropna(axis=0, inplace=False, **kwargs)</code>：<br />
<code>DataFrame.dropna(axis=0, how='any', thresh=None, subset=None, inplace=False)</code>：<br />
（1）axis：指定沿着哪个轴进行过滤。如果为0/'index'，则沿着0轴；如果为1/'columns'，则沿着1轴。你也可以同时提供两个轴（以列表或者元组的形式）。<br />
（2）how：指定过滤方式。如果为'any'，则如果该label对应的数据中只要有任何NaN，则抛弃该label；如果为'all'，则如果该label对应的数据中必须全部为NaN才抛弃该label。<br />
（3）thresh：一个整数，要求该label必须有thresh个非NaN才保留下来。它比how的优先级较高。<br />
（4）subset：一个label的array-like。比如axis=0，则subset为轴 1
上的标签，它指定你考虑哪些列的子集上的NaN。<br />
（5）inplace：一个布尔值。如果为True，则原地修改。否则返回一个新创建的DataFrame。</p>
<p><strong>3、填充缺失值：</strong><br />
<code>DataFrame/Series.fillna(value=None, method=None, axis=None, inplace=False, limit=None, downcast=None, **kwargs)</code>：<br />
（1）value：一个标量/字典/Series/DataFrame。注意：value与method只能指定其中之一，不能同时提供。<br />
　　　如果为标量，则它指定了填充NaN的数据。<br />
　　　如果为Series/dict，则它指定了填充每个index的数据。<br />
　　　如果为DataFrame，则它指定了填充每个DataFrame单元的数据。<br />
（2）method：指定填充方式。可以为None，也可以为：<br />
　　　'backfill'/'bfill'：缺失值后面的有效值来从后往前填充。在从前往后填充时，需要填充的缺失值前面没有值，那么它就仍然是缺失值。<br />
　　　'ffill'/'pad'：缺失值前面的有效值来从前往后填充。<br />
（3）axis：指定沿着哪个轴进行填充。如果为0/'index'，则沿着0轴；如果为1/'columns'，则沿着1轴。<br />
（4）inplace：一个布尔值。如果为True，则原地修改。否则返回一个新创建的DataFrame。<br />
（5）limit：一个整数。如果method提供了，则当有连续的N个NaN时，只有其中的limit个NaN会被填充（注意：对于前向填充和后向填充，剩余的空缺的位置不同）。<br />
（6）downcast：一个字典<code>&#123;label:dtype&#125;</code>，用于类型转换。dtype可以为字符串，也可以为np.float64等。</p>
<p><code>fillna()</code>方法可以看作是值替换的一种特殊情况。更通用的是值替换<code>replace()</code>方法。<br />
<code>Series/DataFrame.replace(to_replace=None, value=None, inplace=False, limit=None, regex=False, method='pad', axis=None)</code>：<br />
（1）to_replace：一个字符串/正则表达式/列表/字典/Series/数值/None。指出哪些值要被替换。<br />
　　　字符串：则只有严格等于该字符串的那些值才被替换。<br />
　　　正则表达式：只有匹配该正则表达式的那些值才被替换（regex=True）。<br />
　　　列表：如果to_place和value都是列表，则它们必须长度严格相等；如果regex=True，则列表中所有字符串都是正则表达式。<br />
　　　字典：字典的键对应了被替换的值，字典的值给出了替换值。如果是嵌套字典，则最外层的键给出了column名。<br />
　　　None：此时regex必须是个字符串，该字符串可以表示正则表达式、列表、字典、ndarray等。如果value也是None，则to_replace必须是个嵌套字典。<br />
（2）value：一个字符串/正则表达式/列表/字典/Series/数值/None。给出了替换值。如果是个字典，则键指出了将填充哪些列（不在其中的那些列将不被填充）<br />
（3）inplace：一个布尔值。如果为True，则原地修改。否则创建新对象。<br />
（4）limit：一个整数，指定了连续填充的最大跨度。<br />
（5）regex：一个布尔值/与to_replace类型相同。如果为True，则to_replace必须是个字符串。如果是个字符串，则to_replace必须为None，因为它会被视作过滤器。<br />
（6）method：指定填充类型。可以为'pad'/'ffill'/'bfill'。当to_replace是个列表时该参数有效。</p>
<p><code>interpolate()</code>通过前后数据插值来填充NaN。<br />
<code>Series/DataFrame.interpolate(method='linear', axis=0, limit=None, inplace=False, limit_direction='forward', downcast=None, **kwargs)</code>：<br />
（1）method：一个字符串，指定插值的方法。<br />
　　　'linear'：线性插值。只有它支持MultiIndex。<br />
　　　'index'/'values'：使用索引标签的整数下标来辅助插值。<br />
　　　'time'：处理时间对象。<br />
　　　'nearest'/'zero'/'slinear'/'quadratic'/'cubic'/'spline'/'barycentric'/'polynomial'：使用scipy.interpolate.interp1d。<br />
　　　'krogh'/'piecewise_polynomial'/'spline'/'pchip'/'akima'/'cubicspline'：scipy的插值算法。使用索引下标来辅助插值。<br />
（2）axis：指定插值的轴。如果为0/'index'则沿着0
轴；如果为1/'columns'则沿着 1 轴。<br />
（3）limit：一个整数，指定插值时，如果有K个连续的NaN，则只插值其中的limit个。<br />
（4）limit_direction：一个字符串。当设定了limit时，指定处理哪个方向的limit个NaN。'forward'/'backward'/'both'。<br />
（5）inplace：一个布尔值。如果为True，则原地修改。否则创建新对象。<br />
（6）downcast：指定是否自动向下执行类型转换。<br />
其他参数是传递给scipy的插值函数的。</p>
<h4 id="删除重复数据">删除重复数据</h4>
<p><code>Series/DataFrame.duplicated(*args, **kwargs)</code>：返回一个布尔Series，标记哪些行是重复的（重复行标记为True）。<br />
（1）keep：一个字符串或者False，指示如何标记。它代替了废弃的参数take_last。<br />
　　　'first'：对于重复数据，第一次出现时标记为False，后面出现时标记为True。<br />
　　　'last'：对于重复数据，最后一次出现时标记为False，前面出现时标记为True。<br />
　　　False：对于重复数据，所有出现的地方都标记为True。<br />
（2）inplace：一个布尔值。如果为True，则原地修改。否则返回新建的对象。<br />
<code>Series/DataFrame.drop_duplicates(*args, **kwargs)</code>：返回重复行被移除之后的Series/DataFrame。<br />
（1）keep：一个字符串或者False，指示如何删除。
它代替了废弃的参数take_last。<br />
　　　'first'：对于重复数据，保留第一次出现，后面出现时删除。<br />
　　　'last'：对于重复数据，最后一次出现时保留，前面出现时删除。<br />
　　　False：对于重复数据，删除所有出现的位置。<br />
（2）inplace：一个布尔值。如果为True，则原地修改。否则返回新建的对象。<br />
（3）subset：一个列label/列label列表，DataFrame中，只考虑哪些列。默认考虑所有列。</p>
<h4 id="自定义处理apply">自定义处理apply</h4>
<p><strong>1、可使用numpy的ufunc函数操作pandas对象。</strong><br />
<strong>2、将函数应用到由各列/各行形成的一维数组上：</strong><br />
<code>DataFrame.apply(func, axis=0, broadcast=False, raw=False, reduce=None, args=(), **kwds)</code>：<br />
（1）func：一个可调用对象，它会应用于每一行/每一列。<br />
（2）axis：应用于行/列。如果为0/'index'，则沿着0轴计算（应用于每一列）；如果为1/'columns'，则沿着1轴计算（应用于每一行）。<br />
（3）broadcast：一个布尔值，如果为True，则结果为DataFrame（不足的部分通过广播来填充）。<br />
（4）raw：一个布尔值。如果为False，则转换每一行/每一列为一个Series，传给
func 作为参数。如果True，则func接受到的是ndarray。<br />
（5）reduce：一个布尔值。用于判断当DataFrame为空时，应该返回一个Series（reduce=True）还是DataFrame（reduce=False）。<br />
（6）args：传递给func的额外的位置参数（第一个位置参数始终为Series/ndarray）。<br />
<strong>3、将函数应用到Series/DataFrame中的每个元素：</strong><br />
<code>DataFrame.applymap(func, na_action=None)</code>：<br />
<code>Series.map(arg, na_action=None)</code>：<br />
<code>Series.apply(func, convert_dtype=True, args=(), **kwds)</code>：<br />
（1）func：一个可调用对象，它会应用于每个元素。<br />
（2）arg：一个函数/字典/Series。如果为字典/Series，则它是一种映射关系，输入值和k相匹配，v就是返回值。<br />
（3）na_action：对Nan值策略。None/'ignore'，'ignore'不处理NaN。<br />
（4）convert_dtype：一个布尔值。如果为True，则pandas会自动匹配func结果的最佳dtype；如果为False，则dtype=object。<br />
（5）args：传递给func的额外的位置参数。<br />
（6）kwds：传递给func的额外的关键字参数。</p>
<h4 id="字符串处理str.ufunc正则">字符串处理str.ufunc/正则</h4>
<p>Pandas 为包含字符串的 Series 和 Index 对象提供的 str
属性，可以进行向量化字符串操作（ufunc函数），还可以处理缺失值NaN。<br />
DataFrame可用apply函数的func参数指定这些方法。<br />
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br></pre></td><td class="code"><pre><span class="line">Series.str.capitalize() </span><br><span class="line">Series.str.cat([others, sep, na_rep])  连接字符串（此功能比较复杂，建议阅读文档）</span><br><span class="line">Series.str.center(width[, fillchar]) </span><br><span class="line">Series.str.contains(pat[, case=True, flags=0, na=nan, regex=True])</span><br><span class="line">Series.str.count(pat[, flags]) </span><br><span class="line">Series.str.decode(encoding[, errors]) </span><br><span class="line">Series.str.encode(encoding[, errors]) </span><br><span class="line">Series.str.endswith(pat[, na]) </span><br><span class="line">Series.str.extract(pat[, flags, expand]) </span><br><span class="line">Series.str.extractall(pat[, flags]) </span><br><span class="line">Series.str.find(sub[, start, end]) </span><br><span class="line">Series.str.findall(pat[, flags]) </span><br><span class="line">Series.str.get(i)  获取元素索引位置上的值，索引从 0 开始</span><br><span class="line">Series.str.index(sub[, start, end]) </span><br><span class="line">Series.str.join(sep) 用分隔符连接 Series 的每个元素</span><br><span class="line">Series.str.len() </span><br><span class="line">Series.str.ljust(width[, fillchar]) </span><br><span class="line">Series.str.lower() </span><br><span class="line">Series.str.lstrip([to_strip]) </span><br><span class="line">Series.str.match(pat[, case=True, flags=0, na=nan, as_indexer=False]) </span><br><span class="line">Series.str.normalize(form) 将字符串转换为 Unicode 规范形式</span><br><span class="line">Series.str.pad(width[, side, fillchar]) 在字符串的左边、右边或两边增加空格</span><br><span class="line">Series.str.partition([pat, expand]) </span><br><span class="line">Series.str.repeat(repeats) 重复元素</span><br><span class="line">Series.str.replace(pat, repl[, n, case, flags]) </span><br><span class="line">Series.str.rfind(sub[, start, end]) </span><br><span class="line">Series.str.rindex(sub[, start, end]) </span><br><span class="line">Series.str.rjust(width[, fillchar]) </span><br><span class="line">Series.str.rpartition([pat, expand]) </span><br><span class="line">Series.str.rstrip([to_strip])</span><br><span class="line">Series.str.slice([start, stop, step])  对元素进行切片取值</span><br><span class="line">Series.str.slice_replace([start, stop, repl])  对元素进行切片替换</span><br><span class="line">Series.str.split([pat, n, expand])</span><br><span class="line">Series.str.rsplit([pat, n, expand])</span><br><span class="line">Series.str.startswith(pat[, na])</span><br><span class="line">Series.str.strip([to_strip])</span><br><span class="line">Series.str.swapcase()</span><br><span class="line">Series.str.title()</span><br><span class="line">Series.str.translate(table[, deletechars])</span><br><span class="line">Series.str.upper()</span><br><span class="line">Series.str.wrap(width, **kwargs) 将字符串按照指定的宽度换行</span><br><span class="line">Series.str.zfill(width)</span><br><span class="line">Series.str.isalnum()</span><br><span class="line">Series.str.isalpha()</span><br><span class="line">Series.str.isdigit()</span><br><span class="line">Series.str.isspace()</span><br><span class="line">Series.str.islower()</span><br><span class="line">Series.str.isupper()</span><br><span class="line">Series.str.istitle()</span><br><span class="line">Series.str.isnumeric()</span><br><span class="line">Series.str.isdecimal()</span><br><span class="line">Series.str.get_dummies([sep]) 按照分隔符提取每个元素的 dummy 变量，转换为独热（one-hot）编码的 DataFrame</span><br></pre></td></tr></table></figure></p>
<p>Pandas 支持正则表达式的方法可以用来处理每个字符串元素。 Pandas
向量化字符串方法根据 Python 标准库的 re 模块函数实现的 API。<br />
Pandas向量化字符串方法与Python标准库的re模块函数的对应关系：<br />
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">方法            描述</span><br><span class="line">match()     对每个元素调用 re.match()，返回布尔类型值</span><br><span class="line">extract()   对每个元素调用 re.match()，返回匹配的字符串组（groups）</span><br><span class="line">findall()   对每个元素调用 re.findall()</span><br><span class="line">replace()   用正则模式替换字符串</span><br><span class="line">contains()  对每个元素调用 re.search()，返回布尔类型值</span><br><span class="line">count()     计算符合正则模式的字符串的数量</span><br><span class="line">split()     等价于 str.split()，支持正则表达式</span><br><span class="line">rsplit()    等价于 str.rsplit()，支持正则表达式</span><br></pre></td></tr></table></figure></p>
<h3 id="pandas运算">Pandas运算</h3>
<p>NumPy
的基本能力之一是快速对每个元素进行运算，既包括基本算术运算（加、减、乘、除），也包括更复杂的运算（三角函数、指数函数和对数函数等）。
Pandas 继承了 NumPy 的功能，而且<strong>生成的都是新的 Pandas
对象</strong>。</p>
<p>Pandas 也实现了一些高效技巧：<br />
（1）对于一元运算（像函数与三角函数），这些通用函数将在输出结果中保留索引和列标签。<br />
（2）对于二元运算（如加法和乘法）， Pandas
在传递通用函数时会自动对齐索引进行计算，即运算符会对<strong>标签相同的两个元素进行计算</strong>。比如DataFrame，对齐会同时发生在行和列上。当某一方的<strong>标签不存在时，默认以NaN填充</strong>，并且会在运算过程中传播。由于NaN是浮点数中的一个特殊值，因此结果的元素类型被转换为float64。<strong>结果的索引是双方索引的并集。</strong></p>
<h4 id="通用运算">通用运算</h4>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">+      add()</span><br><span class="line">-      sub()、 subtract()</span><br><span class="line">*      mul()、 multiply()</span><br><span class="line">/      truediv()、 div()、 divide()</span><br><span class="line">//     floordiv()</span><br><span class="line">%      mod()</span><br><span class="line">**     pow()</span><br></pre></td></tr></table></figure>
<p>这些方法的参数，以加法为例<code>add(other, axis='columns', level=None, fill_value=None)</code>：<br />
（1）other：一个DataFrame/Series/一个array-like/一个标量值。<br />
（2）axis：指定操作的轴。可以为0/1/'index'/'columns'。<br />
（3）fill_value：替换双方所有的NaN值。可以为None（不替换）。注意：NaN与任何值相加结果都是NaN。若两个值原来都是NaN，结果还是NaN，fill_value无效。<br />
（4）level：一个整数/标签，用于多级索引的运算。</p>
<p>还有比较运算：<br />
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">==         eq(other, axis=&#x27;columns&#x27;, level=None)</span><br><span class="line">!=         ne(other, axis=&#x27;columns&#x27;, level=None)</span><br><span class="line">&lt;          lt(other, axis=&#x27;columns&#x27;, level=None)</span><br><span class="line">&lt;=         le(other, axis=&#x27;columns&#x27;, level=None)</span><br><span class="line">&gt;          gt(other, axis=&#x27;columns&#x27;, level=None)</span><br><span class="line">&gt;=         ge(other, axis=&#x27;columns&#x27;, level=None)</span><br></pre></td></tr></table></figure><br />
这些的方法的参数只有<code>ohter,axis,level</code>，用法同数值运算。</p>
<p>除此之外，其他数值运算方法可以使用 NumPy
的数值计算方法，这些方法是通用函数（ufunc），在 Pandas
中它们通常有三个常用参数：<br />
（1）axis：指定运算沿着哪个轴进行。<br />
（2）level：如果轴是多级索引MultiIndex，则根据level分组计算。<br />
（3）skipna：运算是否自动跳过NaN。</p>
<p><strong>1、相同类型计算</strong><br />
和 Numpy 计算相同，根据上述计算技巧，索引对齐计算。<br />
<div class="tabs" id="f4"><ul class="nav-tabs"><li class="tab active"><a href="#f4-1">Series</a></li><li class="tab"><a href="#f4-2">DataFrame</a></li></ul><div class="tab-content"><div class="tab-pane active" id="f4-1"><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br></pre></td><td class="code"><pre><span class="line">a = pd.Series([<span class="number">1</span>,np.nan])</span><br><span class="line">b = pd.Series([np.nan,<span class="number">2</span>])</span><br><span class="line">a</span><br><span class="line">b</span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">0    1.0</span></span><br><span class="line"><span class="string">1    NaN</span></span><br><span class="line"><span class="string">dtype: float64</span></span><br><span class="line"><span class="string">0    NaN</span></span><br><span class="line"><span class="string">1    2</span></span><br><span class="line"><span class="string">dtype: int64</span></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="comment"># NaN和任何值相加都为NaN</span></span><br><span class="line">a.add(b)</span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">0   NaN</span></span><br><span class="line"><span class="string">1   NaN</span></span><br><span class="line"><span class="string">dtype: float64</span></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="comment"># fill_value会替换方所有的NaN</span></span><br><span class="line">a.add(b,fill_value=<span class="number">2</span>)</span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">0    3.0</span></span><br><span class="line"><span class="string">1    4.0</span></span><br><span class="line"><span class="string">dtype: float64</span></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line">a = pd.Series([<span class="number">1</span>,np.nan])</span><br><span class="line">b = pd.Series([<span class="number">1</span>,np.nan])</span><br><span class="line">a</span><br><span class="line">b</span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">0    1.0</span></span><br><span class="line"><span class="string">1    NaN</span></span><br><span class="line"><span class="string">dtype: float64</span></span><br><span class="line"><span class="string">0    1.0</span></span><br><span class="line"><span class="string">1    NaN</span></span><br><span class="line"><span class="string">dtype: float64</span></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line">a.add(b)</span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">0    2.0</span></span><br><span class="line"><span class="string">1    NaN</span></span><br><span class="line"><span class="string">dtype: float64</span></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="comment"># a和b对应索引都为NaN，fill_value无效</span></span><br><span class="line">a.add(b, fill_value=<span class="number">3</span>) </span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">0    2.0</span></span><br><span class="line"><span class="string">1    NaN</span></span><br><span class="line"><span class="string">dtype: float64</span></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br></pre></td></tr></table></figure></div><div class="tab-pane" id="f4-2"><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line">np.random.seed(<span class="number">0</span>)</span><br><span class="line">df1 = pd.DataFrame(np.random.randint(<span class="number">0</span>, <span class="number">10</span>, (<span class="number">3</span>, <span class="number">3</span>)),columns=<span class="built_in">list</span>(<span class="string">&#x27;BAC&#x27;</span>))</span><br><span class="line">df2 = pd.DataFrame(np.random.randint(<span class="number">0</span>, <span class="number">10</span>, (<span class="number">3</span>, <span class="number">2</span>)),columns=<span class="built_in">list</span>(<span class="string">&#x27;BC&#x27;</span>))</span><br><span class="line">df1</span><br><span class="line">df2</span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">    B   A   C</span></span><br><span class="line"><span class="string">0   5   0   3</span></span><br><span class="line"><span class="string">1   3   7   9</span></span><br><span class="line"><span class="string">2   3   5   2</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">    B   C</span></span><br><span class="line"><span class="string">0   4   7</span></span><br><span class="line"><span class="string">1   6   8</span></span><br><span class="line"><span class="string">2   8   1</span></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line">df1.add(df2, fill_value=<span class="number">2</span>)</span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">      A   B    C</span></span><br><span class="line"><span class="string">0   2.0   9   10</span></span><br><span class="line"><span class="string">1   9.0   9   17</span></span><br><span class="line"><span class="string">2   7.0  11    3</span></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br></pre></td></tr></table></figure></div></div></div></p>
<p><strong>2、DataFrame与Series的运算</strong><br />
DataFrame 和 Series 的运算规则，与 NumPy
中二维数组与一维数组的运算规则是一样的，根据 NumPy
的广播规则计算即可。<br />
简单来讲，总结出的规律就是：<br />
（1）DataFrame和Series的运算，默认会用DataFrame的每一行与Series运算。<br />
（2）若想用DataFrame的每一列与Series运算，则必须使用函数方式指定axis=0（表示操作匹配的轴），而不能使用符号方式。<br />
<div class="tabs" id="f5"><ul class="nav-tabs"><li class="tab active"><a href="#f5-1">Numpy</a></li><li class="tab"><a href="#f5-2">Pandas</a></li></ul><div class="tab-content"><div class="tab-pane active" id="f5-1"><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">arr = np.random.randint(<span class="number">10</span>, size=(<span class="number">3</span>, <span class="number">4</span>))</span><br><span class="line">arr</span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">array([[8, 5, 0, 3],</span></span><br><span class="line"><span class="string">       [1, 5, 9, 7],</span></span><br><span class="line"><span class="string">       [0, 7, 0, 4]])</span></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line">arr - arr[<span class="number">0</span>]</span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">array([[ 0,  0,  0,  0],</span></span><br><span class="line"><span class="string">       [-7,  0,  9,  4],</span></span><br><span class="line"><span class="string">       [-8,  2,  0,  1]])</span></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br></pre></td></tr></table></figure></div><div class="tab-pane" id="f5-2"><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line">data = np.array([[<span class="number">8</span>, <span class="number">5</span>, <span class="number">0</span>, <span class="number">3</span>],</span><br><span class="line">                 [<span class="number">1</span>, <span class="number">5</span>, <span class="number">9</span>, <span class="number">7</span>],</span><br><span class="line">                 [<span class="number">0</span>, <span class="number">7</span>, <span class="number">0</span>, <span class="number">4</span>]])</span><br><span class="line">df = pd.DataFrame(data, columns=<span class="built_in">list</span>(<span class="string">&#x27;QRST&#x27;</span>))</span><br><span class="line">df</span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">    Q   R   S   T</span></span><br><span class="line"><span class="string">0   8   5   0   3</span></span><br><span class="line"><span class="string">1   1   5   9   7</span></span><br><span class="line"><span class="string">2   0   7   0   4</span></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="comment"># 默认DataFrame的每一行与Series运算</span></span><br><span class="line">df - df.iloc[<span class="number">0</span>]</span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">    Q   R   S   T</span></span><br><span class="line"><span class="string">0   0   0   0   0</span></span><br><span class="line"><span class="string">1  -7   0   9   4</span></span><br><span class="line"><span class="string">2  -8   2   0   1</span></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line">df.subtract(df[<span class="string">&#x27;R&#x27;</span>], axis=<span class="number">0</span>)</span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">    Q   R   S   T</span></span><br><span class="line"><span class="string">0   3   0  -5  -2</span></span><br><span class="line"><span class="string">1  -4   0   4   2</span></span><br><span class="line"><span class="string">2  -7   0  -7  -3</span></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br></pre></td></tr></table></figure></div></div></div></p>
<h4 id="高性能运算eval">高性能运算eval</h4>
<p>在 NumPy 里是向量化 / 广播运算，在 Pandas
里是分组型的运算。虽然这些抽象功能可以简洁高效地解决许多问题，但是它们经常需要创建临时中间对象，这样就会占用大量的计算时间与内存。<br />
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> numpy <span class="keyword">as</span> np</span><br><span class="line">rng = np.random.RandomState(<span class="number">42</span>)</span><br><span class="line">x = rng.rand(<span class="number">1E6</span>)</span><br><span class="line">y = rng.rand(<span class="number">1E6</span>)</span><br><span class="line">%timeit x + y</span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">100 loops, best of 3: 3.39 ms per loop</span></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line">%timeit np.fromiter((xi + yi <span class="keyword">for</span> xi, yi <span class="keyword">in</span> <span class="built_in">zip</span>(x, y)), dtype=x.dtype, count=<span class="built_in">len</span>(x))</span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">1 loop, best of 3: 266 ms per loop</span></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="comment"># 但是这种运算在处理复合代数式问题时的效率比较低</span></span><br><span class="line">mask = (x &gt; <span class="number">0.5</span>) &amp; (y &lt; <span class="number">0.5</span>)</span><br><span class="line"><span class="comment"># 由于 NumPy 会计算每一个代数子式，因此这个计算过程等价于：</span></span><br><span class="line">tmp1 = (x &gt; <span class="number">0.5</span>)</span><br><span class="line">tmp2 = (y &lt; <span class="number">0.5</span>)</span><br><span class="line">mask = tmp1 &amp; tmp2</span><br><span class="line"><span class="comment"># 也就是说， 每段中间过程都需要显式地分配内存</span></span><br></pre></td></tr></table></figure><br />
Numexpr
程序库可以让你在不为中间过程分配全部内存的前提下，完成元素到元素的复合代数式运算。简单点儿说，这个程序库其实就是用一个
NumPy 风格的字符串代数式进行运算。 Pandas 的 <code>eval()</code> 和
<code>query()</code> 工具其实也是基于 Numexpr
实现的。<code>eval()</code> 函数用字符串代数式实现了 DataFrame
的高性能运算，<code>query()</code>和 <code>eval()</code>
使用方式一样，只是返回结果会自动使用计算的掩码，而eval直接返回计算结果。<code>query()</code>
使用方法在前面 高性能选择 中讲过。<br />
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br></pre></td><td class="code"><pre><span class="line">df1, df2, df3, df4, df5 = (pd.DataFrame(rng.randint(<span class="number">0</span>, <span class="number">1000</span>, (<span class="number">100</span>, <span class="number">3</span>))) <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">5</span>))</span><br><span class="line"><span class="comment"># 算术运算</span></span><br><span class="line">result1 = -df1 * df2 / (df3 + df4) - df5</span><br><span class="line">result2 = pd.<span class="built_in">eval</span>(<span class="string">&#x27;-df1 * df2 / (df3 + df4) - df5&#x27;</span>)</span><br><span class="line">np.allclose(result1, result2)</span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">True</span></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="comment"># 比较运算</span></span><br><span class="line">result1 = (df1 &lt; df2) &amp; (df2 &lt;= df3) &amp; (df3 != df4)</span><br><span class="line">result2 = pd.<span class="built_in">eval</span>(<span class="string">&#x27;df1 &lt; df2 &lt;= df3 != df4&#x27;</span>)</span><br><span class="line">np.allclose(result1, result2)</span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">True</span></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="comment"># 位运算</span></span><br><span class="line">result1 = (df1 &lt; <span class="number">0.5</span>) &amp; (df2 &lt; <span class="number">0.5</span>) | (df3 &lt; df4)</span><br><span class="line">result2 = pd.<span class="built_in">eval</span>(<span class="string">&#x27;(df1 &lt; 0.5) &amp; (df2 &lt; 0.5) | (df3 &lt; df4)&#x27;</span>)</span><br><span class="line">np.allclose(result1, result2)</span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">True</span></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="comment"># 逻辑运算</span></span><br><span class="line">result3 = pd.<span class="built_in">eval</span>(<span class="string">&#x27;(df1 &lt; 0.5) and (df2 &lt; 0.5) or (df3 &lt; df4)&#x27;</span>)</span><br><span class="line">np.allclose(result1, result3)</span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">True</span></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="comment"># 对象属性与索引</span></span><br><span class="line">result1 = df2.T[<span class="number">0</span>] + df3.iloc[<span class="number">1</span>]</span><br><span class="line">result2 = pd.<span class="built_in">eval</span>(<span class="string">&#x27;df2.T[0] + df3.iloc[1]&#x27;</span>)</span><br><span class="line">np.allclose(result1, result2)</span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">True</span></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line">df = pd.DataFrame(rng.rand(<span class="number">1000</span>, <span class="number">3</span>), columns=[<span class="string">&#x27;A&#x27;</span>, <span class="string">&#x27;B&#x27;</span>, <span class="string">&#x27;C&#x27;</span>])</span><br><span class="line">df.head()</span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">  A        B        C</span></span><br><span class="line"><span class="string">0 0.375506 0.406939 0.069938</span></span><br><span class="line"><span class="string">1 0.069087 0.235615 0.154374</span></span><br><span class="line"><span class="string">2 0.677945 0.433839 0.652324</span></span><br><span class="line"><span class="string">3 0.264038 0.808055 0.347197</span></span><br><span class="line"><span class="string">4 0.589161 0.252418 0.557789</span></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="comment"># 按列运算</span></span><br><span class="line">result1 = (df[<span class="string">&#x27;A&#x27;</span>] + df[<span class="string">&#x27;B&#x27;</span>]) / (df[<span class="string">&#x27;C&#x27;</span>] - <span class="number">1</span>)</span><br><span class="line"><span class="comment"># 下面两者等价</span></span><br><span class="line">result2 = pd.<span class="built_in">eval</span>(<span class="string">&quot;(df.A + df.B) / (df.C - 1)&quot;</span>)</span><br><span class="line">result3 = df.<span class="built_in">eval</span>(<span class="string">&#x27;(A + B) / (C - 1)&#x27;</span>)</span><br><span class="line">np.allclose(result1, result2)</span><br><span class="line">np.allclose(result1, result3)</span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">True</span></span><br><span class="line"><span class="string">True</span></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line">result1 = df[(df.A &lt; <span class="number">0.5</span>) &amp; (df.B &lt; <span class="number">0.5</span>)]</span><br><span class="line"><span class="comment"># 下面二者等价</span></span><br><span class="line">result2 = pd.<span class="built_in">eval</span>(<span class="string">&#x27;df[(df.A &lt; 0.5) &amp; (df.B &lt; 0.5)]&#x27;</span>)</span><br><span class="line">result3 = df.query(<span class="string">&#x27;A &lt; 0.5 and B &lt; 0.5&#x27;</span>) <span class="comment"># 自动使用计算的掩码</span></span><br><span class="line">np.allclose(result1, result2)</span><br><span class="line">np.allclose(result1, result3)</span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br></pre></td></tr></table></figure><br />
<code>pd.eval()</code>
还不支持函数调用、条件语句、循环以及更复杂的运算。</p>
<h4 id="统计运算">统计运算</h4>
<p>下面的方法适用于DataFrame和Series，只是用于其一的会单独写出来。<br />
对于多级索引，可以通过level参数来指定在某个轴上的操作索引级别。如果level=None，则整体计算，结果为标量。<br />
<strong>1、裁剪数据：</strong><br />
<code>clip([lower, upper, axis])</code>：将指定轴上的数据裁剪到<code>[lower,upper]</code>这个闭区间之内。超过upper的值裁剪成upper；小于lower的值裁剪成lower。<br />
<code>clip_lower(threshold[, axis])</code>：返回一份拷贝，该拷贝是在指定轴上：向下裁剪到threshold。<br />
<code>clip_upper(threshold[, axis])</code>：返回一份拷贝，该拷贝是在指定轴上：向上裁剪到threshold。</p>
<p><strong>2、最大最小值：</strong><br />
<code>max([axis, skipna, level, ...])</code>：沿着指定轴，计算最大值。<br />
<code>min([axis, skipna, level, ...])</code>：沿着指定轴，计算最小值。<br />
<code>cummax([axis, skipna])</code>：计算沿着axis轴的累积最大值。<br />
<code>cummin([axis, skipna])</code>：计算沿着axis轴的累积最最小值。<br />
<code>Series.argmax([axis, skipna, ...])</code>：计算最大值的索引下标，0.20版本之后返回标签，等价于
idxmax。<br />
<code>Series.argmin([axis, skipna, ...])</code>：计算最小值的索引下标，0.20版本之后返回标签，等价于
idxmin。<br />
<code>Series.idxmax([axis, skipna, ...])</code>：计算最大值的索引label。<br />
<code>Series.idxmin([axis, skipna, ...])</code>：计算最小值的索引label。<br />
<code>Series.nlargest( *args,**kwargs)</code>：计算最大的N个数。n为最大的多少个。keep为遇到重复值时怎么处理，可以为'first'/'last'。<br />
<code>Series.nsmallest( *args,**kwargs)</code>：计算最小的N个数。参数同上。</p>
<p><strong>3、基础运算：</strong><br />
<code>abs()</code>：每个数值元素的绝对值（只对数值元素进行计算）。<br />
<code>sum([axis, skipna, level, ...])</code>：沿着指定轴，计算样本的和。<br />
<code>cumsum([axis, skipna])</code>：沿着axis轴的累积和。<br />
<code>prod([axis, skipna, level, ...])</code>：计算指定轴上的乘积。<br />
<code>cumprod([axis, skipna])</code>：沿着axis轴的累积乘积。<br />
<code>quantile([q, axis, numeric_only, ...])</code>：计算指定轴上样本的百分位数。q为一个浮点数/一个array-like。每个元素都是0~1之间。<br />
<code>pct_change([periods, fill_method, ...])</code>：计算百分比变化。<code>(s[i+periods]-s[i])/s[i]</code>，periods为相隔几个周期，结果不乘100。<br />
<code>round([decimals])</code>：指定元素小数点位数。decimals：一个整数（适用于全部元素）/一个字典（列标签指定对应小数点位数）。</p>
<p><strong>4、统计运算：</strong><br />
<code>count([axis, level, numeric_only])</code>：沿着axis轴的level级索引，非NaN值的数量。numeric_only=True，则只考虑数值和布尔类型。<br />
<code>DataFrame.nunique(axis=0, dropna=True)</code>：沿着axis轴，计算不重复值得数量。<br />
<code>Series.unique()</code>：返回Series中唯一值组成的一维ndarray。<br />
<code>Series.value_counts(normalize=False, sort=True, ascending=False, bins=None, dropna=True)</code>：对Series中的数进行计数。如果normalize为True，则返回频率而不是频数。sort为True则结果根据出现的值排序，排序方式由ascending指定。bins是一个整数/None。如果它为整数，则使用半开半闭区间来统计，它给出了该区间的数量。<br />
<code>isin(values)</code>：一个列表，判断values中的值，是否在当前位置值中出现。<br />
<code>any([axis, bool_only, skipna, level])</code>：指定轴上是否存在某个元素都为True或者非零。bool_only=True，则仅考虑布尔型的数据。<br />
<code>all([axis, bool_only, skipna, level])</code>：指定轴上是否所有元素都为True或者非零。bool_only=True，则仅考虑布尔型的数据。<br />
<code>describe([percentiles, include, ...])</code>：获取顺序统计量以及其他的统计结果。percentiles：一个array-like，表示分位数，每个元素都是0~1之间。include/exclude：包含/不包含哪些列，可以为None/'all'/一个dtype列表（通过dtype来指定）。</p>
<p><code>mean([axis, skipna, level, ...])</code>：沿着指定轴，计算平均值。<br />
<code>median([axis, skipna, level, ...])</code>：沿着指定轴，计算位于中间大小的数。<br />
<code>var([axis, skipna, level, ddof, ...])</code>：沿着指定轴，计算样本的方差。<br />
<code>std([axis, skipna, level, ddof, ...])</code>：沿着指定轴，计算样本的标准差。<br />
<code>mad([axis, skipna, level])</code>：沿着指定轴，根据平均值计算平均绝对离差。<br />
<code>diff([periods, axis])</code>：沿着指定轴的一阶差分。periods为间隔。<br />
<code>skew([axis, skipna, level, ...])</code>：沿着指定轴计算样本的偏度（二阶矩）。<br />
<code>kurt([axis, skipna, level, ...])</code>：沿着指定轴，计算样本的峰度（四阶矩）。</p>
<p><code>corr([method, min_periods])</code>：计算任意两个列之间的非NaN的、按照索引对齐的值的相关系数。method为相关系数的类型：'pearson'(标准的相关系数)，'kendall'(Kendall
Tau相关系数)，'spearman'(Spearman
rank相关系数)，也可以用自定义函数。min_periods：一个整数。它指定为了生成一个有效的相关系数，每一对列数据的最短长度。<br />
<code>corrwith(other[, axis, drop])</code>：计算两个DataFrame的行-行、列-列的相关系数。axis：如果为0/'index'则沿着0轴，则计算列-列之间的相关系数。如果为1/'columns'，则沿着1轴，计算行-行之间的相关系数。drop：一个布尔值。如果为True，则如果某行/列都是NaN，则抛弃该行/列。如果为False，则返回全部。<br />
<code>DataFrame.cov([min_periods])</code>：计算任意两列之间的协方差。min_periods：为了生成一个有效的协方差，每一对列数据的最短长度。</p>
<div class="tabs" id="f11"><ul class="nav-tabs"><li class="tab active"><a href="#f11-1">count</a></li><li class="tab"><a href="#f11-2">any/all</a></li></ul><div class="tab-content"><div class="tab-pane active" id="f11-1"><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line">df = pd.DataFrame(&#123;<span class="string">&quot;Person&quot;</span>:</span><br><span class="line">                   [<span class="string">&quot;John&quot;</span>, <span class="string">&quot;Myla&quot;</span>, <span class="string">&quot;Lewis&quot;</span>, <span class="string">&quot;John&quot;</span>, <span class="string">&quot;Myla&quot;</span>],</span><br><span class="line">                   <span class="string">&quot;Age&quot;</span>: [<span class="number">24.</span>, np.nan, <span class="number">21.</span>, <span class="number">33</span>, <span class="number">26</span>],</span><br><span class="line">                   <span class="string">&quot;Single&quot;</span>: [<span class="literal">False</span>, <span class="literal">True</span>, <span class="literal">True</span>, <span class="literal">True</span>, <span class="literal">False</span>]&#125;)</span><br><span class="line">df</span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">   Person   Age  Single</span></span><br><span class="line"><span class="string">0    John  24.0   False</span></span><br><span class="line"><span class="string">1    Myla   NaN    True</span></span><br><span class="line"><span class="string">2   Lewis  21.0    True</span></span><br><span class="line"><span class="string">3    John  33.0    True</span></span><br><span class="line"><span class="string">4    Myla  26.0   False</span></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line">df.count()</span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">Person    5</span></span><br><span class="line"><span class="string">Age       4</span></span><br><span class="line"><span class="string">Single    5</span></span><br><span class="line"><span class="string">dtype: int64</span></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line">df.set_index([<span class="string">&quot;Person&quot;</span>, <span class="string">&quot;Single&quot;</span>])</span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">                    Age</span></span><br><span class="line"><span class="string">Person   Single   </span></span><br><span class="line"><span class="string">John     False      24.0</span></span><br><span class="line"><span class="string">Myla     True       NaN</span></span><br><span class="line"><span class="string">Lewis    True       21.0</span></span><br><span class="line"><span class="string">John     True       33.0</span></span><br><span class="line"><span class="string">Myla     False      26.0</span></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line">df.set_index([<span class="string">&quot;Person&quot;</span>, <span class="string">&quot;Single&quot;</span>]).count(level=<span class="string">&quot;Person&quot;</span>)</span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">        Age</span></span><br><span class="line"><span class="string">Person</span></span><br><span class="line"><span class="string">John      2</span></span><br><span class="line"><span class="string">Lewis     1</span></span><br><span class="line"><span class="string">Myla      1</span></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br></pre></td></tr></table></figure></div><div class="tab-pane" id="f11-2"><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br></pre></td><td class="code"><pre><span class="line">pd.Series([<span class="literal">False</span>, <span class="literal">False</span>]).<span class="built_in">any</span>()</span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">False</span></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line">pd.Series([]).<span class="built_in">any</span>()</span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">False</span></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line">pd.Series([np.nan]).<span class="built_in">any</span>()</span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">False</span></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line">pd.Series([np.nan]).<span class="built_in">any</span>(skipna=<span class="literal">False</span>)</span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">True</span></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line">df = pd.DataFrame(&#123;<span class="string">&quot;A&quot;</span>: [<span class="literal">True</span>, <span class="literal">False</span>], <span class="string">&quot;B&quot;</span>: [<span class="number">1</span>, <span class="number">2</span>]&#125;)</span><br><span class="line">df</span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">       A  B</span></span><br><span class="line"><span class="string">0   True  1</span></span><br><span class="line"><span class="string">1  False  2</span></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="comment"># reduce rows</span></span><br><span class="line">df.<span class="built_in">any</span>()</span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">A    True</span></span><br><span class="line"><span class="string">B    True</span></span><br><span class="line"><span class="string">dtype: bool</span></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="comment"># reduce columns</span></span><br><span class="line">df.<span class="built_in">any</span>(axis=<span class="string">&#x27;columns&#x27;</span>)</span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">0    True</span></span><br><span class="line"><span class="string">1    True</span></span><br><span class="line"><span class="string">dtype: bool</span></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line">df = pd.DataFrame(&#123;<span class="string">&#x27;col1&#x27;</span>: [<span class="literal">True</span>, <span class="literal">True</span>], <span class="string">&#x27;col2&#x27;</span>: [<span class="literal">True</span>, <span class="literal">False</span>]&#125;)</span><br><span class="line">df</span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">   col1   col2</span></span><br><span class="line"><span class="string">0  True   True</span></span><br><span class="line"><span class="string">1  True  False</span></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="comment"># reduce rows</span></span><br><span class="line">df.<span class="built_in">all</span>()</span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">col1     True</span></span><br><span class="line"><span class="string">col2    False</span></span><br><span class="line"><span class="string">dtype: bool</span></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="comment"># reduce columns</span></span><br><span class="line">df.<span class="built_in">all</span>(axis=<span class="string">&#x27;columns&#x27;</span>)</span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">0     True</span></span><br><span class="line"><span class="string">1    False</span></span><br><span class="line"><span class="string">dtype: bool</span></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="comment"># 每个值是否均为True?</span></span><br><span class="line">df.<span class="built_in">all</span>(axis=<span class="literal">None</span>)</span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">False</span></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br></pre></td></tr></table></figure></div></div></div>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line">df = pd.DataFrame([(<span class="number">.2</span>, <span class="number">.3</span>), (<span class="number">.0</span>, <span class="number">.6</span>), (<span class="number">.6</span>, <span class="number">.0</span>), (<span class="number">.2</span>, <span class="number">.1</span>)], columns=[<span class="string">&#x27;dogs&#x27;</span>, <span class="string">&#x27;cats&#x27;</span>])</span><br><span class="line">df <span class="comment"># 每列的和为1，这样自己和自己计算corr时结果为1</span></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">    dogs  cats</span></span><br><span class="line"><span class="string">0   0.2   0.3</span></span><br><span class="line"><span class="string">1   0.0   0.6</span></span><br><span class="line"><span class="string">2   0.6   0.0</span></span><br><span class="line"><span class="string">3   0.2   0.1</span></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">histogram_intersection</span>(<span class="params">a, b</span>):</span><br><span class="line">    v = np.minimum(a, b).<span class="built_in">sum</span>().<span class="built_in">round</span>(decimals=<span class="number">1</span>)</span><br><span class="line">    <span class="keyword">return</span> v</span><br><span class="line">df.corr(method=histogram_intersection)</span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">      dogs  cats</span></span><br><span class="line"><span class="string">dogs   1.0   0.3</span></span><br><span class="line"><span class="string">cats   0.3   1.0</span></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line">df.cov()</span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">        dogs        cats</span></span><br><span class="line"><span class="string">dogs   0.063333   -0.056667</span></span><br><span class="line"><span class="string">cats  -0.056667    0.070000</span></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br></pre></td></tr></table></figure>
<h4 id="排序">排序</h4>
<p><code>DataFrame/Series.sort_index(axis=0, level=None, ascending=True, inplace=False, kind='quicksort', na_position='last', sort_remaining=True)</code>：按照标签排序。<br />
（1）axis：指定沿着那个轴排序。如果为0/'index'，则沿着0轴，对行标签排序；如果为1/'columns'，则沿着1轴对列标签排序。<br />
（2）level：一个整数/标签、整数/标签列表、None。对于多级索引，它指定在哪一级上排序。<br />
（3）ascending：一个布尔值，如果为True，则升序排序；如果是False，则降序排序。<br />
（4）inplace：一个布尔值，如果为True，则原地修改。如果为False，则返回排好序的新对象。<br />
（5）kind：一个字符串，指定排序算法。可以为'quicksort'/'mergesort'/'heapsort'。注意只有归并排序是稳定排序的。<br />
（6）na_position：一个字符串，值为'first'/'last'。将NaN排在最开始还是最末尾。<br />
（7）sort_remaining：一个布尔值。如果为True，则当多级索引排序中，指定level的索引排序完毕后，对剩下level的索引也排序。<br />
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br></pre></td><td class="code"><pre><span class="line">np.random.seed(<span class="number">0</span>)</span><br><span class="line">index = pd.MultiIndex.from_product([[<span class="string">&#x27;a&#x27;</span>, <span class="string">&#x27;c&#x27;</span>, <span class="string">&#x27;b&#x27;</span>], [<span class="number">2</span>, <span class="number">1</span>]])</span><br><span class="line">data = pd.Series(np.random.randint(<span class="number">0</span>,<span class="number">10</span>,(<span class="number">6</span>,)), index=index)</span><br><span class="line">data.index.names = [<span class="string">&#x27;char&#x27;</span>, <span class="string">&#x27;int&#x27;</span>]</span><br><span class="line">data</span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">char  int</span></span><br><span class="line"><span class="string">a     2      5</span></span><br><span class="line"><span class="string">      1      0</span></span><br><span class="line"><span class="string">c     2      3</span></span><br><span class="line"><span class="string">      1      3</span></span><br><span class="line"><span class="string">b     2      7</span></span><br><span class="line"><span class="string">      1      9</span></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line">data = data.sort_index()</span><br><span class="line">data</span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">char  int</span></span><br><span class="line"><span class="string">a     1      5</span></span><br><span class="line"><span class="string">      2      0</span></span><br><span class="line"><span class="string">b     1      7</span></span><br><span class="line"><span class="string">      2      9</span></span><br><span class="line"><span class="string">c     1      3</span></span><br><span class="line"><span class="string">      2      3</span></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line">np.random.seed(<span class="number">0</span>)</span><br><span class="line">index = pd.MultiIndex.from_product([[<span class="string">&#x27;a&#x27;</span>, <span class="string">&#x27;c&#x27;</span>, <span class="string">&#x27;b&#x27;</span>], [<span class="number">2</span>, <span class="number">1</span>]])</span><br><span class="line">columns = pd.MultiIndex.from_product([[<span class="string">&#x27;a&#x27;</span>, <span class="string">&#x27;c&#x27;</span>, <span class="string">&#x27;b&#x27;</span>], [<span class="number">2</span>, <span class="number">1</span>]])</span><br><span class="line">data = pd.DataFrame(np.random.randint(<span class="number">0</span>,<span class="number">10</span>,(<span class="number">6</span>,<span class="number">6</span>)), index=index, columns=columns)</span><br><span class="line">data</span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">        a       c       b</span></span><br><span class="line"><span class="string">        2   1   2   1   2   1</span></span><br><span class="line"><span class="string">a   2   5   0   3   3   7   9</span></span><br><span class="line"><span class="string">    1   3   5   2   4   7   6</span></span><br><span class="line"><span class="string">c   2   8   8   1   6   7   7</span></span><br><span class="line"><span class="string">    1   8   1   5   9   8   9</span></span><br><span class="line"><span class="string">b   2   4   3   0   3   5   0</span></span><br><span class="line"><span class="string">    1   2   3   8   1   3   3</span></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line">data = data.sort_index(axis=<span class="number">0</span>)</span><br><span class="line">data</span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">        a       c       b</span></span><br><span class="line"><span class="string">        2   1   2   1   2   1</span></span><br><span class="line"><span class="string">a   1   5   0   3   3   7   9</span></span><br><span class="line"><span class="string">    2   3   5   2   4   7   6</span></span><br><span class="line"><span class="string">b   1   8   8   1   6   7   7</span></span><br><span class="line"><span class="string">    2   8   1   5   9   8   9</span></span><br><span class="line"><span class="string">c   1   4   3   0   3   5   0</span></span><br><span class="line"><span class="string">    2   2   3   8   1   3   3</span></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line">data = data.sort_index(axis=<span class="number">1</span>)</span><br><span class="line">data</span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">        a       b       c</span></span><br><span class="line"><span class="string">        1   2   1   2   1   2</span></span><br><span class="line"><span class="string">a   1   5   0   3   3   7   9</span></span><br><span class="line"><span class="string">    2   3   5   2   4   7   6</span></span><br><span class="line"><span class="string">b   1   8   8   1   6   7   7</span></span><br><span class="line"><span class="string">    2   8   1   5   9   8   9</span></span><br><span class="line"><span class="string">c   1   4   3   0   3   5   0</span></span><br><span class="line"><span class="string">    2   2   3   8   1   3   3</span></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br></pre></td></tr></table></figure><br />
<code>Index/MultiIndex.sortlevel(level=0, ascending=True, sort_remaining=True)</code>：排序标签。<br />
（1）level：一个整数/标签、整数/标签列表、None。对于多级索引，它指定在哪一级上排序。<br />
（2）ascending：一个布尔值，如果为True，则升序排序；如果是False，则降序排序。<br />
（3）sort_remaining：一个布尔值。如果为True，则当多级索引排序中，指定level的索引排序完毕后，对剩下level的索引也排序。<br />
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line">np.random.seed(<span class="number">0</span>)</span><br><span class="line">index = pd.MultiIndex.from_product([[<span class="string">&#x27;a&#x27;</span>, <span class="string">&#x27;c&#x27;</span>, <span class="string">&#x27;b&#x27;</span>], [<span class="number">2</span>, <span class="number">1</span>]])</span><br><span class="line">columns = pd.MultiIndex.from_product([[<span class="string">&#x27;a&#x27;</span>, <span class="string">&#x27;c&#x27;</span>, <span class="string">&#x27;b&#x27;</span>], [<span class="number">2</span>, <span class="number">1</span>]])</span><br><span class="line">data = pd.DataFrame(np.random.randint(<span class="number">0</span>,<span class="number">10</span>,(<span class="number">6</span>,<span class="number">6</span>)), index=index, columns=columns)</span><br><span class="line">data</span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">        a       c       b</span></span><br><span class="line"><span class="string">        2   1   2   1   2   1</span></span><br><span class="line"><span class="string">a   2   5   0   3   3   7   9</span></span><br><span class="line"><span class="string">    1   3   5   2   4   7   6</span></span><br><span class="line"><span class="string">c   2   8   8   1   6   7   7</span></span><br><span class="line"><span class="string">    1   8   1   5   9   8   9</span></span><br><span class="line"><span class="string">b   2   4   3   0   3   5   0</span></span><br><span class="line"><span class="string">    1   2   3   8   1   3   3</span></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line">data.index.sortlevel(level=<span class="number">0</span>)</span><br><span class="line">data</span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">        a       c       b</span></span><br><span class="line"><span class="string">        2   1   2   1   2   1</span></span><br><span class="line"><span class="string">a   2   5   0   3   3   7   9</span></span><br><span class="line"><span class="string">    1   3   5   2   4   7   6</span></span><br><span class="line"><span class="string">b   2   8   8   1   6   7   7</span></span><br><span class="line"><span class="string">    1   8   1   5   9   8   9</span></span><br><span class="line"><span class="string">c   2   4   3   0   3   5   0</span></span><br><span class="line"><span class="string">    1   2   3   8   1   3   3</span></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line">data.index.sortlevel(level=<span class="number">1</span>)</span><br><span class="line">data</span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">        a       c       b</span></span><br><span class="line"><span class="string">        2   1   2   1   2   1</span></span><br><span class="line"><span class="string">a   1   5   0   3   3   7   9</span></span><br><span class="line"><span class="string">    2   3   5   2   4   7   6</span></span><br><span class="line"><span class="string">b   1   8   8   1   6   7   7</span></span><br><span class="line"><span class="string">    2   8   1   5   9   8   9</span></span><br><span class="line"><span class="string">c   1   4   3   0   3   5   0</span></span><br><span class="line"><span class="string">    2   2   3   8   1   3   3</span></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br></pre></td></tr></table></figure><br />
<code>DataFrame/Series.sort_values(by, axis=0, ascending=True, inplace=False, kind='quicksort', na_position='last')</code>：按照行/列的值排序。<br />
（1）by：一个字符串/字符串列表（优先级按列表顺序），指定标签对应的列或行的元素进行排序。对于DataFrame，必须指定该参数。而Series不能指定该参数。<br />
（2）axis：指定沿着那个轴排序。如果为0/'index'，则沿着0轴排序（此时by指定列标签）；如果为1/'columns'，则沿着1轴排序（此时by指定行标签）。<br />
（3）ascending：一个布尔值，如果为True，则升序排序；如果是False，则降序排序。<br />
（4）inplace：一个布尔值，如果为True，则原地修改。如果为False，则返回排好序的新对象。<br />
（5）kind：一个字符串，指定排序算法。可以为'quicksort'/'mergesort'/'heapsort'。注意只有归并排序是稳定排序的。<br />
（6）na_position：一个字符串，值为'first'/'last'。将NaN排在最开始还是最末尾。<br />
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><span class="line">np.random.seed(<span class="number">0</span>)</span><br><span class="line">index = pd.MultiIndex.from_product([[<span class="string">&#x27;a&#x27;</span>, <span class="string">&#x27;c&#x27;</span>, <span class="string">&#x27;b&#x27;</span>], [<span class="number">2</span>, <span class="number">1</span>]])</span><br><span class="line">columns = pd.MultiIndex.from_product([[<span class="string">&#x27;a&#x27;</span>, <span class="string">&#x27;c&#x27;</span>, <span class="string">&#x27;b&#x27;</span>], [<span class="number">2</span>, <span class="number">1</span>]])</span><br><span class="line">data = pd.DataFrame(np.random.randint(<span class="number">0</span>,<span class="number">10</span>,(<span class="number">6</span>,<span class="number">6</span>)), index=index, columns=columns)</span><br><span class="line">data</span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">        a       c       b</span></span><br><span class="line"><span class="string">        2   1   2   1   2   1</span></span><br><span class="line"><span class="string">a   2   5   0   3   3   7   9</span></span><br><span class="line"><span class="string">    1   3   5   2   4   7   6</span></span><br><span class="line"><span class="string">c   2   8   8   1   6   7   7</span></span><br><span class="line"><span class="string">    1   8   1   5   9   8   9</span></span><br><span class="line"><span class="string">b   2   4   3   0   3   5   0</span></span><br><span class="line"><span class="string">    1   2   3   8   1   3   3</span></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="comment"># 多层索引必须用元组指定所有层</span></span><br><span class="line"><span class="comment"># 默认按列标签排序，axis=0</span></span><br><span class="line">data.sort_values((<span class="string">&#x27;a&#x27;</span>,<span class="number">2</span>)) </span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">        a       c       b</span></span><br><span class="line"><span class="string">        2   1   2   1   2   1</span></span><br><span class="line"><span class="string">b   1   2   3   8   1   3   3</span></span><br><span class="line"><span class="string">a   1   3   5   2   4   7   6</span></span><br><span class="line"><span class="string">b   2   4   3   0   3   5   0</span></span><br><span class="line"><span class="string">a   2   5   0   3   3   7   9</span></span><br><span class="line"><span class="string">c   2   8   8   1   6   7   7</span></span><br><span class="line"><span class="string">    1   8   1   5   9   8   9</span></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="comment"># 按照行排列</span></span><br><span class="line"><span class="comment"># (&#x27;c&#x27;,2) 优先级高于 (&#x27;a&#x27;,2)</span></span><br><span class="line">data.sort_values([(<span class="string">&#x27;c&#x27;</span>,<span class="number">2</span>), (<span class="string">&#x27;a&#x27;</span>,<span class="number">2</span>)], axis=<span class="number">1</span>) </span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">        c       b       a</span></span><br><span class="line"><span class="string">        2   1   2   1   1   2</span></span><br><span class="line"><span class="string">a   2   3   3   7   9   0   5</span></span><br><span class="line"><span class="string">    1   2   4   7   6   5   3</span></span><br><span class="line"><span class="string">c   2   1   6   7   7   8   8</span></span><br><span class="line"><span class="string">    1   5   9   8   9   1   8</span></span><br><span class="line"><span class="string">b   2   0   3   5   0   3   4</span></span><br><span class="line"><span class="string">    1   8   1   3   3   3   2</span></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br></pre></td></tr></table></figure><br />
<code>DataFrame/Series.rank(axis=0, method='average', numeric_only=None, na_option='keep', ascending=True, pct=False)</code>：rank排序，编号从1开始。<br />
（1）axis：指定沿着那个轴排名。如果为0/'index'，则沿着行排名（对列排名）；如果为1/'columns'，则沿着列排名（对行排名）。<br />
（2）method：一个字符串，如何对具有相同值的记录组进行排名。假设相同数值的
a 一共有N个。现在轮到对a排序，设当前应该排名为k。可选择方法：<br />
　　　'average'：使用均值的排名，这N个数的排名都是 K+(N-1)/2 ;<br />
　　　'min'：使用可用的最小的排名，这N个数的排名都是 k ;<br />
　　　'max'：使用可用的最大的排名，这N各数的排名都是 k+N-1 ;<br />
　　　'first'：根据元素数据中出现的顺序依次分配排名，即按照它们出现的顺序，其排名分别为
k,k+1,...k+N-1 ;<br />
　　　'dense'：类似于
'min'，但是排名并不会跳跃。即比a大的下一个数值排名为k+1，而不是k+N
。<br />
（3）numeric_only：一个布尔值。如果为True，则只对float/int/bool数据排名。仅对DataFrame有效。<br />
（4）na_option：一个字符串，指定对NaN的处理。可以为：<br />
　　　'keep'：保留NaN在原位置;<br />
　　　'top'：如果升序，则NaN安排最大的排名;<br />
　　　'bottom'：如果升序，则NaN安排最小的排名。<br />
（5）ascending：一个布尔值，如果为True，则升序排名；如果是False，则降序排名。<br />
（6）pct：一个布尔值。如果为True，则计算数据的百分位数，而不是排名。<br />
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line">np.random.seed(<span class="number">0</span>)</span><br><span class="line">index = pd.MultiIndex.from_product([[<span class="string">&#x27;a&#x27;</span>, <span class="string">&#x27;c&#x27;</span>, <span class="string">&#x27;b&#x27;</span>], [<span class="number">2</span>, <span class="number">1</span>]])</span><br><span class="line">columns = pd.MultiIndex.from_product([[<span class="string">&#x27;a&#x27;</span>, <span class="string">&#x27;c&#x27;</span>, <span class="string">&#x27;b&#x27;</span>], [<span class="number">2</span>, <span class="number">1</span>]])</span><br><span class="line">data = pd.DataFrame(np.random.randint(<span class="number">0</span>,<span class="number">10</span>,(<span class="number">6</span>,<span class="number">6</span>)), index=index, columns=columns)</span><br><span class="line">data</span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">        a       c       b</span></span><br><span class="line"><span class="string">        2   1   2   1   2   1</span></span><br><span class="line"><span class="string">a   2   5   0   3   3   7   9</span></span><br><span class="line"><span class="string">    1   3   5   2   4   7   6</span></span><br><span class="line"><span class="string">c   2   8   8   1   6   7   7</span></span><br><span class="line"><span class="string">    1   8   1   5   9   8   9</span></span><br><span class="line"><span class="string">b   2   4   3   0   3   5   0</span></span><br><span class="line"><span class="string">    1   2   3   8   1   3   3</span></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="comment"># 默认按照列排序</span></span><br><span class="line">data.rank()</span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">        a           c           b</span></span><br><span class="line"><span class="string">        2     1     2     1     2     1</span></span><br><span class="line"><span class="string">a   2   4.0   1.0   4.0   2.5   4.0   5.5</span></span><br><span class="line"><span class="string">    1   2.0   5.0   3.0   4.0   4.0   3.0</span></span><br><span class="line"><span class="string">c   2   5.5   6.0   2.0   5.0   4.0   4.0</span></span><br><span class="line"><span class="string">    1   5.5   2.0   5.0   6.0   6.0   5.5</span></span><br><span class="line"><span class="string">b   2   3.0   3.5   1.0   2.5   2.0   1.0</span></span><br><span class="line"><span class="string">    1   1.0   3.5   6.0   1.0   1.0   2.0</span></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br></pre></td></tr></table></figure></p>
<h4 id="分桶">分桶</h4>
<p>连续数据常常会被离散化或者拆分成桶bin。<br />
<code>pd.cut(x, bins, right=True, labels=None, retbins=False, precision=3, include_lowest=False, duplicates='raise', ordered=True)</code>：<br />
（1）x：一维的数据。<br />
（2）bins：一个整数/一个序列。<br />
　　整数：划分区间的数量。每个区间是等长的，且最左侧的区间的左侧比x最小值小0.1%；最右侧的区间的右侧比x最大值大0.1%。<br />
　　序列：区间的划分点。<br />
（3）right：<code>&#123;bool, default True&#125;</code>。如果为True，则区间是<code>(]</code>；否则区间是<code>[)</code>。<br />
（4）labels：<code>&#123;array or False, default None&#125;</code>。如果为一个array，则它指定了结果bins区间名（长度与bins划分的区间数量相同）。如果为None，则使用默认区间来表示。如果为False，则用数字表示当前值是哪个bin的。<br />
（5）retbins：<code>&#123;bool, default False&#125;</code>。如果为True，则返回输入的bins。<br />
（6）precision：<code>&#123;int, default 3&#125;</code>，给出存储和显示bin
label的精度。<br />
（7）include_lowest：<code>&#123;bool, default False&#125;</code>。如果为True，则最左侧bin的左侧是闭区间。<br />
（8）duplicates：<code>&#123;default ‘raise’, ‘drop’&#125;</code>，如果bin边缘不是唯一的，则引发ValueError或丢弃非唯一变量。<br />
（9）ordered：<code>&#123;bool, default True&#125;</code>，True则将对结果分类进行排序。False则结果分类将是无序的（必须提供标签）。<br />
返回的是一个Categorical对象或者Series对象。该函数类似于<code>numpy.histogram()</code>函数。</p>
<p><code>pd.qcut(x, q, labels=None, retbins=False, precision=3)</code>：<br />
（1）q：一个整数/序列。<br />
　　整数：它指定了划分区间的数量。<br />
　　一个序列：它给出了百分比划分点。比如[0,0.25,0.5,0.75,0.1]。0.25代表25%划分点。如果数据不在任何区间内，则标记为NaN。<br />
（2）qcut没有bins参数，其他参数与cut相同。<br />
<div class="tabs" id="f12"><ul class="nav-tabs"><li class="tab active"><a href="#f12-1">cut</a></li><li class="tab"><a href="#f12-2">qcut</a></li></ul><div class="tab-content"><div class="tab-pane active" id="f12-1"><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br></pre></td><td class="code"><pre><span class="line">s = pd.Series(np.array([<span class="number">2</span>, <span class="number">4</span>, <span class="number">6</span>, <span class="number">8</span>, <span class="number">10</span>]),</span><br><span class="line">              index=[<span class="string">&#x27;a&#x27;</span>, <span class="string">&#x27;b&#x27;</span>, <span class="string">&#x27;c&#x27;</span>, <span class="string">&#x27;d&#x27;</span>, <span class="string">&#x27;e&#x27;</span>])</span><br><span class="line">s</span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">a     2</span></span><br><span class="line"><span class="string">b     4</span></span><br><span class="line"><span class="string">c     6</span></span><br><span class="line"><span class="string">d     8</span></span><br><span class="line"><span class="string">e    10</span></span><br><span class="line"><span class="string">dtype: int32</span></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line">pd.cut(s, <span class="number">3</span>)</span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">a    (1.992, 4.667]</span></span><br><span class="line"><span class="string">b    (1.992, 4.667]</span></span><br><span class="line"><span class="string">c    (4.667, 7.333]</span></span><br><span class="line"><span class="string">d     (7.333, 10.0]</span></span><br><span class="line"><span class="string">e     (7.333, 10.0]</span></span><br><span class="line"><span class="string">dtype: category</span></span><br><span class="line"><span class="string">Categories (3, interval[float64]): [(1.992, 4.667] &lt; (4.667, 7.333] &lt; (7.333, 10.0]]</span></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line">pd.cut(s, [<span class="number">0</span>, <span class="number">2</span>, <span class="number">4</span>, <span class="number">6</span>, <span class="number">8</span>, <span class="number">10</span>])</span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">a     (0, 2]</span></span><br><span class="line"><span class="string">b     (2, 4]</span></span><br><span class="line"><span class="string">c     (4, 6]</span></span><br><span class="line"><span class="string">d     (6, 8]</span></span><br><span class="line"><span class="string">e    (8, 10]</span></span><br><span class="line"><span class="string">dtype: category</span></span><br><span class="line"><span class="string">Categories (5, interval[int64]): [(0, 2] &lt; (2, 4] &lt; (4, 6] &lt; (6, 8] &lt; (8, 10]]</span></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line">pd.cut(s, [<span class="number">0</span>, <span class="number">4</span>, <span class="number">6</span>, <span class="number">8</span>, <span class="number">10</span>], labels=<span class="literal">False</span>)</span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">a    0</span></span><br><span class="line"><span class="string">b    0</span></span><br><span class="line"><span class="string">c    1</span></span><br><span class="line"><span class="string">d    2</span></span><br><span class="line"><span class="string">e    3</span></span><br><span class="line"><span class="string">dtype: int64</span></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line">pd.cut(s, [<span class="number">0</span>, <span class="number">2</span>, <span class="number">4</span>, <span class="number">6</span>, <span class="number">8</span>, <span class="number">10</span>], retbins=<span class="literal">True</span>)</span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">(a     (0, 2]</span></span><br><span class="line"><span class="string"> b     (2, 4]</span></span><br><span class="line"><span class="string"> c     (4, 6]</span></span><br><span class="line"><span class="string"> d     (6, 8]</span></span><br><span class="line"><span class="string"> e    (8, 10]</span></span><br><span class="line"><span class="string"> dtype: category</span></span><br><span class="line"><span class="string"> Categories (5, interval[int64]): [(0, 2] &lt; (2, 4] &lt; (4, 6] &lt; (6, 8] &lt; (8, 10]],</span></span><br><span class="line"><span class="string"> array([ 0,  2,  4,  6,  8, 10]))</span></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line">pd.cut(s, [<span class="number">0</span>, <span class="number">2</span>, <span class="number">4</span>, <span class="number">6</span>, <span class="number">8</span>, <span class="number">10</span>], right=<span class="literal">False</span>)</span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">a     [2.0, 4.0)</span></span><br><span class="line"><span class="string">b     [4.0, 6.0)</span></span><br><span class="line"><span class="string">c     [6.0, 8.0)</span></span><br><span class="line"><span class="string">d    [8.0, 10.0)</span></span><br><span class="line"><span class="string">e            NaN</span></span><br><span class="line"><span class="string">dtype: category</span></span><br><span class="line"><span class="string">Categories (5, interval[int64]): [[0, 2) &lt; [2, 4) &lt; [4, 6) &lt; [6, 8) &lt; [8, 10)]</span></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br></pre></td></tr></table></figure></div><div class="tab-pane" id="f12-2"><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">pd.qcut(<span class="built_in">range</span>(<span class="number">5</span>), <span class="number">4</span>)</span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">[(-0.001, 1.0], (-0.001, 1.0], (1.0, 2.0], (2.0, 3.0], (3.0, 4.0]]</span></span><br><span class="line"><span class="string">Categories (4, interval[float64]): [(-0.001, 1.0] &lt; (1.0, 2.0] &lt; (2.0, 3.0] &lt; (3.0, 4.0]]</span></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line">pd.qcut(<span class="built_in">range</span>(<span class="number">5</span>), <span class="number">3</span>, labels=[<span class="string">&quot;good&quot;</span>, <span class="string">&quot;medium&quot;</span>, <span class="string">&quot;bad&quot;</span>])</span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">[good, good, medium, bad, bad]</span></span><br><span class="line"><span class="string">Categories (3, object): [good &lt; medium &lt; bad]</span></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line">pd.qcut(<span class="built_in">range</span>(<span class="number">5</span>), <span class="number">4</span>, labels=<span class="literal">False</span>)</span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">array([0, 0, 1, 2, 3])</span></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br></pre></td></tr></table></figure></div></div></div></p>
<h4 id="采样sample">采样sample</h4>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">Series/DataFrame.sample(n=<span class="literal">None</span>, frac=<span class="literal">None</span>, replace=<span class="literal">False</span>, weights=<span class="literal">None</span>, random_state=<span class="literal">None</span>, axis=<span class="literal">None</span>)</span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">n：一个整数。按axis轴返回行/列数。不能与frac一起使用。如果frac=None，则默认值=1。</span></span><br><span class="line"><span class="string">frac：一个浮点数。百分比，比如0.5，取总行/列数的50%。比如2，取总行/列数的200%。</span></span><br><span class="line"><span class="string">replace：一个布尔值。允许/禁止对同一行/列进行多次采样。frac&gt;1时replace应为True。</span></span><br><span class="line"><span class="string">weights：一个字符串/ndarray。只能用于axis=0，当axis=0时设定一个/组列名，这组列中值大的更有可能被采样。</span></span><br><span class="line"><span class="string">random_state：随机种子。</span></span><br><span class="line"><span class="string">axis：0取行，1取列。</span></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br></pre></td></tr></table></figure>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line">df = pd.DataFrame(&#123;<span class="string">&#x27;num_legs&#x27;</span>: [<span class="number">2</span>, <span class="number">4</span>, <span class="number">8</span>, <span class="number">0</span>],</span><br><span class="line">                   <span class="string">&#x27;num_wings&#x27;</span>: [<span class="number">2</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>],</span><br><span class="line">                   <span class="string">&#x27;num_specimen_seen&#x27;</span>: [<span class="number">10</span>, <span class="number">2</span>, <span class="number">1</span>, <span class="number">8</span>]&#125;,</span><br><span class="line">                  index=[<span class="string">&#x27;falcon&#x27;</span>, <span class="string">&#x27;dog&#x27;</span>, <span class="string">&#x27;spider&#x27;</span>, <span class="string">&#x27;fish&#x27;</span>])</span><br><span class="line">df</span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">        num_legs    num_wings    num_specimen_seen</span></span><br><span class="line"><span class="string">falcon    2             2             10</span></span><br><span class="line"><span class="string">dog       4             0             2</span></span><br><span class="line"><span class="string">spider    8             0             1</span></span><br><span class="line"><span class="string">fish      0             0             8</span></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="comment"># 行采样</span></span><br><span class="line">df.sample(n=<span class="number">2</span>, random_state=<span class="number">1</span>, axis=<span class="number">0</span>)</span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">        num_legs    num_wings    num_specimen_seen</span></span><br><span class="line"><span class="string">spider    8             0             1</span></span><br><span class="line"><span class="string">fish      0             0             8</span></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="comment"># 行采样，侧重num_specimen_seen值大的样本</span></span><br><span class="line">df.sample(n=<span class="number">2</span>, weights=<span class="string">&#x27;num_specimen_seen&#x27;</span>, random_state=<span class="number">1</span>, axis=<span class="number">0</span>) <span class="comment"># weights只能行采样axis=0时使用</span></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">        num_legs    num_wings    num_specimen_seen</span></span><br><span class="line"><span class="string">falcon    2             2             10</span></span><br><span class="line"><span class="string">fish      0             0             8</span></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br></pre></td></tr></table></figure>
<h4 id="分组聚合">分组聚合</h4>
<p><strong>Ⅰ、分组groupby</strong><br />
简单的累计方法可以让我们对数据集有一个笼统的认识，但是我们经常还需要对某些标签或索引的局部进行累计分析，这时就需要用到
<code>groupby()</code>
了，分组的过程包括：<strong>分割</strong>（split）、
<strong>应用</strong>（apply）和<strong>组合</strong>（combine）。<br />
（1）分割：将 DataFrame 按照指定的键分割成若干组。<br />
（2）应用：根据你提供的一个函数应用到这些分组上。<br />
（3）合并：将每一组的结果合并成一个输出数组。</p>
<p>分组中有两种数据：源数据（被分组的对象），分组数据（用于划分源数据的）。<br />
<code>Series/DataFrame.groupby(by=None, axis=0, level=None, as_index=True, sort=True, group_keys=True, squeeze=False, **kwargs)</code>：<br />
（1）by：一个map函数/列表函数/字典/序列/元组/列名列表。它指定了分组数据。<br />
　　如果传入了函数，则在在当前索引上调用函数来产生分组数据。<br />
　　如果是Series，则根据当前索引在Series中的值来产生分组数据。<br />
　　如果是字典，则根据当前索引在字典key的值来产生分组数据，字典的value代表分组别名。<br />
　　如果是个label，则使用该label抽取出来的一列数据产生分组数据。<br />
　　如果是个label的list，则使用一组label抽取出来的多行/列数据作为分组数据。<br />
　　如果是个序列，则它直接指定了分组数据。<br />
　　如果是个嵌套序列，则使用这些行/列的值拼接成一个MulitiIndex，然后根据label的值来分组。<br />
（2）axis：指定沿着哪个轴分组。可以为0/'index'按行分组。可以为1/'columns'，按列分组。<br />
（3）level：一个整数/level name/level
name序列。如果axis是个MultiIndex，则在指定级别上的索引来分组。<br />
（4）as_index：一个布尔值。如果为True，则将group
label作为输出的index。如果为False，则输出是SQL风格的分组（此时分组的key作为一列，而不是作为index）。Series中该参数必须为True。<br />
（5）sort：一个布尔值。如果为True，则对分组的键进行排序。<br />
（6）group_keys：一个布尔值。如果为True且用函数来决定分组，则添加分组键来区分不同的数据（否则不知道每一行数据什么组的）。<br />
（7）squeeze：一个布尔值。如果为True，则尽可能的缩减结果的类型。</p>
<p><strong>groupby返回一个GroupBy对象，它是一个迭代器对象：</strong><br />
（1）迭代结果产生一组二元组<code>(分组名1,数据块1),(分组名2,数据块2)...</code>。如果有多重键，则元组的第一个元素将也是由键组成的元组。可以用<code>dict(list(GroupBy_obj))</code>将转成一个字典，方便引用。<br />
（2）<strong>按列取值</strong><code>groupby('A')['label']</code>，或者通过<code>.get_group(key)</code>获取分组键对应的数据。<br />
（3）<strong>按组迭代</strong>。GroupBy对象支持直接按组进行迭代，返回的每一组都是
Series 或 DataFrame。<br />
（4）<strong>调用方法</strong>。GroupBy对象支持很多调用方法（聚合函数），比如<code>.describe()</code>等方法，我在后面会列出来。<br />
（5）GroupBy类定义了<code>__getattr__()</code>方法，当获取GroupBy中未定义的属性时：<br />
　　　如果属性名是源数据对象的某列的名称则，相当于<code>GroupBy[name]</code>，即获取针对该列的GroupBy对象<br />
　　　如果属性名是源数据对象的方法，则相当于通过<code>.apply(name)</code>对每个分组调用该方法。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br></pre></td><td class="code"><pre><span class="line">df = pd.DataFrame(&#123;<span class="string">&#x27;Animal&#x27;</span>: [<span class="string">&#x27;Falcon&#x27;</span>, <span class="string">&#x27;Falcon&#x27;</span>,</span><br><span class="line">                              <span class="string">&#x27;Parrot&#x27;</span>, <span class="string">&#x27;Parrot&#x27;</span>],</span><br><span class="line">                   <span class="string">&#x27;Max Speed&#x27;</span>: [<span class="number">380.</span>, <span class="number">370.</span>, <span class="number">24.</span>, <span class="number">26.</span>]&#125;)</span><br><span class="line">df</span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">   Animal  Max Speed</span></span><br><span class="line"><span class="string">0  Falcon      380.0</span></span><br><span class="line"><span class="string">1  Falcon      370.0</span></span><br><span class="line"><span class="string">2  Parrot       24.0</span></span><br><span class="line"><span class="string">3  Parrot       26.0</span></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="comment"># groupby之后是一个元组，通过dict能清晰的理解</span></span><br><span class="line"><span class="built_in">dict</span>(<span class="built_in">list</span>(df.groupby([<span class="string">&#x27;Animal&#x27;</span>])))</span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">&#123;&#x27;Falcon&#x27;:    </span></span><br><span class="line"><span class="string">    Animal  Max Speed</span></span><br><span class="line"><span class="string"> 0  Falcon      380.0</span></span><br><span class="line"><span class="string"> 1  Falcon      370.0, </span></span><br><span class="line"><span class="string"> &#x27;Parrot&#x27;:    </span></span><br><span class="line"><span class="string">    Animal  Max Speed</span></span><br><span class="line"><span class="string"> 2  Parrot       24.0</span></span><br><span class="line"><span class="string"> 3  Parrot       26.0&#125;</span></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="keyword">for</span> (Animal, group) <span class="keyword">in</span> df.groupby(<span class="string">&#x27;Animal&#x27;</span>):</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;&#123;0:30s&#125; shape=&#123;1&#125;&quot;</span>.<span class="built_in">format</span>(Animal, group.shape))</span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">Falcon                         shape=(2, 2)</span></span><br><span class="line"><span class="string">Parrot                         shape=(2, 2)</span></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line">df.groupby(<span class="string">&#x27;Animal&#x27;</span>).get_group(<span class="string">&#x27;Falcon&#x27;</span>)</span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">    Animal   Max Speed</span></span><br><span class="line"><span class="string">0   Falcon   380.0</span></span><br><span class="line"><span class="string">1   Falcon   370.0</span></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line">df.groupby([<span class="string">&#x27;Animal&#x27;</span>]).mean()</span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">        Max Speed</span></span><br><span class="line"><span class="string">Animal</span></span><br><span class="line"><span class="string">Falcon      375.0</span></span><br><span class="line"><span class="string">Parrot       25.0</span></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line">arrays = [[<span class="string">&#x27;Falcon&#x27;</span>, <span class="string">&#x27;Falcon&#x27;</span>, <span class="string">&#x27;Parrot&#x27;</span>, <span class="string">&#x27;Parrot&#x27;</span>],</span><br><span class="line">          [<span class="string">&#x27;Captive&#x27;</span>, <span class="string">&#x27;Wild&#x27;</span>, <span class="string">&#x27;Captive&#x27;</span>, <span class="string">&#x27;Wild&#x27;</span>]]</span><br><span class="line">index = pd.MultiIndex.from_arrays(arrays, names=(<span class="string">&#x27;Animal&#x27;</span>, <span class="string">&#x27;Type&#x27;</span>))</span><br><span class="line">df = pd.DataFrame(&#123;<span class="string">&#x27;Max Speed&#x27;</span>: [<span class="number">390.</span>, <span class="number">350.</span>, <span class="number">30.</span>, <span class="number">20.</span>]&#125;,</span><br><span class="line">                  index=index)</span><br><span class="line">df</span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">                Max Speed</span></span><br><span class="line"><span class="string">Animal Type</span></span><br><span class="line"><span class="string">Falcon Captive      390.0</span></span><br><span class="line"><span class="string">       Wild         350.0</span></span><br><span class="line"><span class="string">Parrot Captive       30.0</span></span><br><span class="line"><span class="string">       Wild          20.0</span></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line">df.groupby(level=<span class="number">0</span>).mean()</span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">        Max Speed</span></span><br><span class="line"><span class="string">Animal</span></span><br><span class="line"><span class="string">Falcon      370.0</span></span><br><span class="line"><span class="string">Parrot       25.0</span></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line">df.groupby(level=<span class="string">&quot;Type&quot;</span>).mean()</span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">         Max Speed</span></span><br><span class="line"><span class="string">Type</span></span><br><span class="line"><span class="string">Captive      210.0</span></span><br><span class="line"><span class="string">Wild         185.0</span></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="comment"># NaN可以分组</span></span><br><span class="line">l = [[<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>], [<span class="number">1</span>, <span class="literal">None</span>, <span class="number">4</span>], [<span class="number">2</span>, <span class="number">1</span>, <span class="number">3</span>], [<span class="number">1</span>, <span class="number">2</span>, <span class="number">2</span>]]</span><br><span class="line">df = pd.DataFrame(l, columns=[<span class="string">&quot;a&quot;</span>, <span class="string">&quot;b&quot;</span>, <span class="string">&quot;c&quot;</span>])</span><br><span class="line">df</span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">    a     b   c</span></span><br><span class="line"><span class="string">0   1   2.0   3</span></span><br><span class="line"><span class="string">1   1   NaN   4</span></span><br><span class="line"><span class="string">2   2   1.0   3</span></span><br><span class="line"><span class="string">3   1   2.0   2</span></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line">df.groupby(by=[<span class="string">&quot;b&quot;</span>]).<span class="built_in">sum</span>()</span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">    a   c</span></span><br><span class="line"><span class="string">b</span></span><br><span class="line"><span class="string">1.0 2   3</span></span><br><span class="line"><span class="string">2.0 2   5</span></span><br><span class="line"><span class="string">NaN 1   4</span></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="comment"># None不能分组</span></span><br><span class="line">l = [[<span class="string">&quot;a&quot;</span>, <span class="number">12</span>, <span class="number">12</span>], [<span class="literal">None</span>, <span class="number">12.3</span>, <span class="number">33.</span>], [<span class="string">&quot;b&quot;</span>, <span class="number">12.3</span>, <span class="number">123</span>], [<span class="string">&quot;a&quot;</span>, <span class="number">1</span>, <span class="number">1</span>]]</span><br><span class="line">df = pd.DataFrame(l, columns=[<span class="string">&quot;a&quot;</span>, <span class="string">&quot;b&quot;</span>, <span class="string">&quot;c&quot;</span>])</span><br><span class="line">df</span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">    a       b       c</span></span><br><span class="line"><span class="string">0   a      12.0   12.0</span></span><br><span class="line"><span class="string">1   None   12.3   33.0</span></span><br><span class="line"><span class="string">2   b      12.3   123.0</span></span><br><span class="line"><span class="string">3   a      1.0    1.0</span></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line">df.groupby(by=[<span class="string">&quot;a&quot;</span>]).<span class="built_in">sum</span>()</span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">    b       c</span></span><br><span class="line"><span class="string">a</span></span><br><span class="line"><span class="string">a   13.0  13.0</span></span><br><span class="line"><span class="string">b   12.3  123.0</span></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line">df.groupby(by=df.dtypes,axis=<span class="number">1</span>)</span><br></pre></td></tr></table></figure>
<p><strong>Ⅱ、GroupBy的聚合函数（排除了NaN）：</strong><br />
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">GroupBy.count()                计算各分组的非NaN的数量</span><br><span class="line">GroupBy.cumcount([ascending])  计算累积分组数量</span><br><span class="line">GroupBy.first()                计算每个分组的第一个非NaN值</span><br><span class="line">GroupBy.head([n])              返回每个分组的前n个值</span><br><span class="line">GroupBy.last()                 计算每个分组的最后一个非NaN值</span><br><span class="line">GroupBy.max()                  计算每个分组的最大值</span><br><span class="line">GroupBy.mean(*args, **kwargs)  计算每个分组的均值</span><br><span class="line">GroupBy.median()               计算每个分组的中位数</span><br><span class="line">GroupBy.min()                  计算每个分组的最小值</span><br><span class="line">GroupBy.nth(n[, dropna])       计算每个分组第n行数据。 如果n是个整数列表，则也返回一个列表</span><br><span class="line">GroupBy.ohlc()                 计算每个分组的开始、最高、最低、结束值</span><br><span class="line">GroupBy.prod()                 计算每个分组的乘</span><br><span class="line">GroupBy.size()                 计算每个分组的大小（包含了NaN）</span><br><span class="line">GroupBy.sem([ddof])            计算每个分组的sem（与均值的绝对误差之和）</span><br><span class="line">GroupBy.std([ddof])            计算每个分组的标准差</span><br><span class="line">GroupBy.sum()                  计算每个分组的和</span><br><span class="line">GroupBy.var([ddof])            计算每个分组的方差</span><br><span class="line">GroupBy.tail([n])              返回每个分组的尾部n个值</span><br></pre></td></tr></table></figure><br />
GroupBy也支持Series/DataFrame的统计类方法以及其他方法：<br />
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#SeriesGroupBy - DataFrameGroupBy 都有的方法：</span></span><br><span class="line">.agg(arg, *args, **kwargs)</span><br><span class="line">.<span class="built_in">all</span>([axis, bool_only, ...]) </span><br><span class="line">.<span class="built_in">any</span>([axis, bool_only, ...])</span><br><span class="line">.bfill([limit])</span><br><span class="line">.corr([method, min_periods])</span><br><span class="line">.count() </span><br><span class="line">.cov([min_periods]) </span><br><span class="line">.cummax([axis, skipna]) </span><br><span class="line">.cummin([axis, skipna]) </span><br><span class="line">.cumprod([axis]) </span><br><span class="line">.cumsum([axis]) </span><br><span class="line">.describe([percentiles, ...]) </span><br><span class="line">.diff([periods, axis])   </span><br><span class="line">.ffill([limit]) </span><br><span class="line">.fillna([value, method, ...]) </span><br><span class="line">.hist(data[, column, by, ...]) </span><br><span class="line">.idxmax([axis, skipna]) </span><br><span class="line">.idxmin([axis, skipna]) </span><br><span class="line">.mad([axis, skipna, level])</span><br><span class="line">.pct_change([periods, ...]) </span><br><span class="line">.plot </span><br><span class="line">.quantile([q, axis, ...]) </span><br><span class="line">.rank([axis, method, ...]) </span><br><span class="line">.sample(n=<span class="literal">None</span>, frac=<span class="literal">None</span>, ...)</span><br><span class="line">.resample(rule, *args, **kwargs) </span><br><span class="line">.shift([periods, freq, axis]) 迁移数据</span><br><span class="line">.size() </span><br><span class="line">.skew([axis, skipna, level, ...]) </span><br><span class="line">.take(indices[, axis, ...])</span><br><span class="line">.tshift([periods, freq, axis]) 迁移索引</span><br><span class="line"><span class="comment">#SeriesGroupBy独有的方法</span></span><br><span class="line">SeriesGroupBy.nlargest(*args, **kwargs) </span><br><span class="line">SeriesGroupBy.nsmallest(*args, **kwargs) </span><br><span class="line">SeriesGroupBy.nunique([dropna]) </span><br><span class="line">SeriesGroupBy.unique()</span><br><span class="line">SeriesGroupBy.value_counts([normalize, ...])   </span><br><span class="line"><span class="comment">#DataFrameGroupBy独有的方法</span></span><br><span class="line">DataFrameGroupBy.corrwith(other[, axis, drop]) </span><br><span class="line">DataFrameGroupBy.boxplot(grouped[, ...])</span><br></pre></td></tr></table></figure><br />
除此之外，GroupBy对象还有更常用的组合：<br />
<strong>1、累计</strong><br />
agg是aggregate的别名，都一样。它支持更复杂的操作，比如字符串、函数或者函数列表，并且能一次性计算所有累计值。<br />
<code>Series/DataFrame.agg(func=None, axis=0, *args, **kwargs)</code>：<br />
<code>GroupBy.agg(func, *args, **kwargs)</code>：<br />
（1）func函数按<strong>每组的列</strong>处理，接受<strong>一维数组，返回一个标量值</strong>。func可以是多个聚合函数名（字符串）。<br />
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br></pre></td><td class="code"><pre><span class="line">df = pd.DataFrame([[<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>],</span><br><span class="line">                   [<span class="number">4</span>, <span class="number">5</span>, <span class="number">6</span>],</span><br><span class="line">                   [<span class="number">7</span>, <span class="number">8</span>, <span class="number">9</span>],</span><br><span class="line">                   [np.nan, np.nan, np.nan]],</span><br><span class="line">                  columns=[<span class="string">&#x27;A&#x27;</span>, <span class="string">&#x27;B&#x27;</span>, <span class="string">&#x27;C&#x27;</span>])</span><br><span class="line">df</span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">      A     B     C</span></span><br><span class="line"><span class="string">0   1.0   2.0   3.0</span></span><br><span class="line"><span class="string">1   4.0   5.0   6.0</span></span><br><span class="line"><span class="string">2   7.0   8.0   9.0</span></span><br><span class="line"><span class="string">3   NaN   NaN   NaN</span></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line">df.agg([<span class="string">&#x27;sum&#x27;</span>, <span class="string">&#x27;min&#x27;</span>])</span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">        A     B     C</span></span><br><span class="line"><span class="string">sum  12.0  15.0  18.0</span></span><br><span class="line"><span class="string">min   1.0   2.0   3.0</span></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line">df.agg(&#123;<span class="string">&#x27;A&#x27;</span> : [<span class="string">&#x27;sum&#x27;</span>, <span class="string">&#x27;min&#x27;</span>], <span class="string">&#x27;B&#x27;</span> : [<span class="string">&#x27;min&#x27;</span>, <span class="string">&#x27;max&#x27;</span>]&#125;)</span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">        A    B</span></span><br><span class="line"><span class="string">sum  12.0  NaN</span></span><br><span class="line"><span class="string">min   1.0  2.0</span></span><br><span class="line"><span class="string">max   NaN  8.0</span></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line">df.agg(x=(<span class="string">&#x27;A&#x27;</span>, <span class="string">&#x27;max&#x27;</span>), y=(<span class="string">&#x27;B&#x27;</span>, <span class="string">&#x27;min&#x27;</span>), z=(<span class="string">&#x27;C&#x27;</span>, np.mean))</span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">     A    B    C</span></span><br><span class="line"><span class="string">x  7.0  NaN  NaN</span></span><br><span class="line"><span class="string">y  NaN  2.0  NaN</span></span><br><span class="line"><span class="string">z  NaN  NaN  6.0</span></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line">df.agg(<span class="string">&quot;mean&quot;</span>, axis=<span class="string">&quot;columns&quot;</span>)</span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">0    2.0</span></span><br><span class="line"><span class="string">1    5.0</span></span><br><span class="line"><span class="string">2    8.0</span></span><br><span class="line"><span class="string">3    NaN</span></span><br><span class="line"><span class="string">dtype: float64</span></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="comment"># GroupBy方式</span></span><br><span class="line">df.groupby(<span class="string">&#x27;A&#x27;</span>).agg(<span class="keyword">lambda</span> x: x.<span class="built_in">max</span>()-x.<span class="built_in">min</span>())</span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">        B     C</span></span><br><span class="line"><span class="string">A      </span></span><br><span class="line"><span class="string">1.0   0.0   0.0</span></span><br><span class="line"><span class="string">4.0   0.0   0.0</span></span><br><span class="line"><span class="string">7.0   0.0   0.0</span></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line">df.groupby(<span class="string">&#x27;A&#x27;</span>).agg(<span class="string">&#x27;count&#x27;</span>)</span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">      B   C</span></span><br><span class="line"><span class="string">A      </span></span><br><span class="line"><span class="string">1.0   1   1</span></span><br><span class="line"><span class="string">4.0   1   1</span></span><br><span class="line"><span class="string">7.0   1   1</span></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line">df.groupby(<span class="string">&#x27;A&#x27;</span>).agg([<span class="string">&#x27;count&#x27;</span>,<span class="string">&#x27;sum&#x27;</span>])</span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">    B             C</span></span><br><span class="line"><span class="string">    count   sum   count   sum</span></span><br><span class="line"><span class="string">A            </span></span><br><span class="line"><span class="string">1.0   1     2.0     1     3.0</span></span><br><span class="line"><span class="string">4.0   1     5.0     1     6.0</span></span><br><span class="line"><span class="string">7.0   1     8.0     1     9.0</span></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line">df.groupby(<span class="string">&#x27;A&#x27;</span>).agg([(<span class="string">&#x27;name1&#x27;</span>,<span class="string">&#x27;count&#x27;</span>),(<span class="string">&#x27;name2&#x27;</span>,<span class="string">&#x27;sum&#x27;</span>)])</span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">    B             C</span></span><br><span class="line"><span class="string">    name1   name2   name1   name2</span></span><br><span class="line"><span class="string">A            </span></span><br><span class="line"><span class="string">1.0   1     2.0     1       3.0</span></span><br><span class="line"><span class="string">4.0   1     5.0     1       6.0</span></span><br><span class="line"><span class="string">7.0   1     8.0     1       9.0</span></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line">df.groupby(<span class="string">&#x27;A&#x27;</span>).agg(&#123;<span class="string">&#x27;B&#x27;</span> : [<span class="string">&#x27;sum&#x27;</span>, <span class="string">&#x27;min&#x27;</span>], <span class="string">&#x27;C&#x27;</span> : [<span class="string">&#x27;min&#x27;</span>, <span class="string">&#x27;max&#x27;</span>]&#125;)</span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">      B           C</span></span><br><span class="line"><span class="string">      sum   min   min   max</span></span><br><span class="line"><span class="string">A            </span></span><br><span class="line"><span class="string">1.0   2.0   2.0   3.0   3.0</span></span><br><span class="line"><span class="string">4.0   5.0   5.0   6.0   6.0</span></span><br><span class="line"><span class="string">7.0   8.0   8.0   9.0   9.0</span></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br></pre></td></tr></table></figure><br />
<strong>2、过滤</strong><br />
过滤操作可以<strong>按照分组的属性丢弃若干数据</strong>。<br />
<code>GroupBy.filter(func, dropna=True, *args, **kwargs)</code>：<br />
（1）func函数按组处理，接受<strong>每组的DataFrame，返回一个Pandas对象（DataFrame/Series）/标量（被广播）</strong>。<br />
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line">rng = np.random.RandomState(<span class="number">0</span>)</span><br><span class="line">df = pd.DataFrame(&#123;<span class="string">&#x27;key&#x27;</span>: [<span class="string">&#x27;A&#x27;</span>, <span class="string">&#x27;B&#x27;</span>, <span class="string">&#x27;C&#x27;</span>, <span class="string">&#x27;A&#x27;</span>, <span class="string">&#x27;B&#x27;</span>, <span class="string">&#x27;C&#x27;</span>],</span><br><span class="line">                    <span class="string">&#x27;data1&#x27;</span>: <span class="built_in">range</span>(<span class="number">6</span>),</span><br><span class="line">                    <span class="string">&#x27;data2&#x27;</span>: rng.randint(<span class="number">0</span>, <span class="number">10</span>, <span class="number">6</span>)&#125;,</span><br><span class="line">                    columns = [<span class="string">&#x27;key&#x27;</span>, <span class="string">&#x27;data1&#x27;</span>, <span class="string">&#x27;data2&#x27;</span>])</span><br><span class="line">df</span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">    key  data1   data2</span></span><br><span class="line"><span class="string">0   A       0       5</span></span><br><span class="line"><span class="string">1   B       1       0</span></span><br><span class="line"><span class="string">2   C       2       3</span></span><br><span class="line"><span class="string">3   A       3       3</span></span><br><span class="line"><span class="string">4   B       4       7</span></span><br><span class="line"><span class="string">5   C       5       9</span></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line">df.groupby(<span class="string">&#x27;key&#x27;</span>).std()</span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">    data1     data2</span></span><br><span class="line"><span class="string">key      </span></span><br><span class="line"><span class="string">A   2.12132   1.414214</span></span><br><span class="line"><span class="string">B   2.12132   4.949747</span></span><br><span class="line"><span class="string">C   2.12132   4.242641</span></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">filter_func</span>(<span class="params">x</span>):</span><br><span class="line">    <span class="keyword">return</span> x[<span class="string">&#x27;data2&#x27;</span>].std() &gt; <span class="number">4</span></span><br><span class="line"><span class="comment"># 保留标准差超过某个阈值的组</span></span><br><span class="line">df.groupby(<span class="string">&#x27;key&#x27;</span>).<span class="built_in">filter</span>(filter_func)</span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">    key   data1   data2</span></span><br><span class="line"><span class="string">1   B       1       0</span></span><br><span class="line"><span class="string">2   C       2       3</span></span><br><span class="line"><span class="string">4   B       4       7</span></span><br><span class="line"><span class="string">5   C       5       9</span></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br></pre></td></tr></table></figure></p>
<p><strong>3、转换</strong><br />
累计操作返回的是对组内全量数据缩减过的结果，而转换操作会返回一个新的全量数据。数据经过转换之后，其形状与原来的输入数据是一样的。常见的例子就是将每一组的样本数据减去各组的均值，实现数据标准化：<code>df.groupby('key').transform(lambda x: x - x.mean())</code>。<br />
<code>Series/DataFrame.transform(func, axis=0, *args, **kwargs)</code>：<br />
<code>GroupBy.transform(func, *args, **kwargs)</code>：<br />
（1）func函数按<strong>每组的列</strong>处理，接受<strong>一维数组，返回一个Pandas对象（DataFrame/Series）/标量（被广播）</strong>。<br />
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br></pre></td><td class="code"><pre><span class="line">df = pd.DataFrame(&#123;<span class="string">&#x27;A&#x27;</span>: <span class="built_in">range</span>(<span class="number">3</span>), <span class="string">&#x27;B&#x27;</span>: <span class="built_in">range</span>(<span class="number">1</span>, <span class="number">4</span>)&#125;)</span><br><span class="line">df</span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">   A  B</span></span><br><span class="line"><span class="string">0  0  1</span></span><br><span class="line"><span class="string">1  1  2</span></span><br><span class="line"><span class="string">2  2  3</span></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line">df.transform(<span class="keyword">lambda</span> x: x + <span class="number">1</span>)</span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">   A  B</span></span><br><span class="line"><span class="string">0  1  2</span></span><br><span class="line"><span class="string">1  2  3</span></span><br><span class="line"><span class="string">2  3  4</span></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line">df.transform([np.sqrt, np.exp])</span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">    A                     B</span></span><br><span class="line"><span class="string">    sqrt       exp        sqrt       exp</span></span><br><span class="line"><span class="string">0   0.000000   1.000000   1.000000   2.718282</span></span><br><span class="line"><span class="string">1   1.000000   2.718282   1.414214   7.389056</span></span><br><span class="line"><span class="string">2   1.414214   7.389056   1.732051   20.085537</span></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line">df = pd.DataFrame(&#123;<span class="string">&#x27;A&#x27;</span> : [<span class="string">&#x27;foo&#x27;</span>, <span class="string">&#x27;bar&#x27;</span>, <span class="string">&#x27;foo&#x27;</span>, <span class="string">&#x27;bar&#x27;</span>,</span><br><span class="line">                          <span class="string">&#x27;foo&#x27;</span>, <span class="string">&#x27;bar&#x27;</span>],</span><br><span class="line">                   <span class="string">&#x27;B&#x27;</span> : [<span class="string">&#x27;one&#x27;</span>, <span class="string">&#x27;one&#x27;</span>, <span class="string">&#x27;two&#x27;</span>, <span class="string">&#x27;three&#x27;</span>,</span><br><span class="line">                          <span class="string">&#x27;two&#x27;</span>, <span class="string">&#x27;two&#x27;</span>],</span><br><span class="line">                   <span class="string">&#x27;C&#x27;</span> : [<span class="number">1</span>, <span class="number">5</span>, <span class="number">5</span>, <span class="number">2</span>, <span class="number">5</span>, <span class="number">5</span>],</span><br><span class="line">                   <span class="string">&#x27;D&#x27;</span> : [<span class="number">2.0</span>, <span class="number">5.</span>, <span class="number">8.</span>, <span class="number">1.</span>, <span class="number">2.</span>, <span class="number">9.</span>]&#125;)</span><br><span class="line">df</span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">    A     B       C   D</span></span><br><span class="line"><span class="string">0   foo   one     1   2.0</span></span><br><span class="line"><span class="string">1   bar   one     5   5.0</span></span><br><span class="line"><span class="string">2   foo   two     5   8.0</span></span><br><span class="line"><span class="string">3   bar   three   2   1.0</span></span><br><span class="line"><span class="string">4   foo   two     5   2.0</span></span><br><span class="line"><span class="string">5   bar   two     5   9.0</span></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line">df.groupby(<span class="string">&#x27;A&#x27;</span>).transform(<span class="keyword">lambda</span> x: (x - x.mean()) / x.std())</span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">          C         D</span></span><br><span class="line"><span class="string">0 -1.154701 -0.577350</span></span><br><span class="line"><span class="string">1  0.577350  0.000000</span></span><br><span class="line"><span class="string">2  0.577350  1.154701</span></span><br><span class="line"><span class="string">3 -1.154701 -1.000000</span></span><br><span class="line"><span class="string">4  0.577350 -0.577350</span></span><br><span class="line"><span class="string">5  0.577350  1.000000</span></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line">df.groupby(<span class="string">&#x27;A&#x27;</span>).transform(<span class="keyword">lambda</span> x: x.<span class="built_in">sum</span>())</span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">    B             C    D</span></span><br><span class="line"><span class="string">0   onetwotwo     11   12</span></span><br><span class="line"><span class="string">1   onethreetwo   12   15</span></span><br><span class="line"><span class="string">2   onetwotwo     11   12</span></span><br><span class="line"><span class="string">3   onethreetwo   12   15</span></span><br><span class="line"><span class="string">4   onetwotwo     11   12</span></span><br><span class="line"><span class="string">5   onethreetwo   12   15</span></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line">df.groupby(<span class="string">&#x27;A&#x27;</span>).transform(<span class="keyword">lambda</span> x: -<span class="number">1</span>)</span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">     B    C    D</span></span><br><span class="line"><span class="string">0   -1   -1   -1</span></span><br><span class="line"><span class="string">1   -1   -1   -1</span></span><br><span class="line"><span class="string">2   -1   -1   -1</span></span><br><span class="line"><span class="string">3   -1   -1   -1</span></span><br><span class="line"><span class="string">4   -1   -1   -1</span></span><br><span class="line"><span class="string">5   -1   -1   -1</span></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br></pre></td></tr></table></figure><br />
<strong>4、应用</strong><br />
<code>apply()</code>方法让你可以在每个组上应用任意方法。组合操作会适应返回结果类型。<br />
<code>GroupBy.apply(func, *args, **kwargs)</code>：<br />
（1）func函数按组处理，接受<strong>每组的DataFrame，返回一个Pandas对象（DataFrame/Series）/标量（被广播）</strong>。<br />
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line">df = pd.DataFrame(&#123;<span class="string">&#x27;A&#x27;</span> : [<span class="string">&#x27;foo&#x27;</span>, <span class="string">&#x27;bar&#x27;</span>, <span class="string">&#x27;foo&#x27;</span>, <span class="string">&#x27;bar&#x27;</span>,</span><br><span class="line">                          <span class="string">&#x27;foo&#x27;</span>, <span class="string">&#x27;bar&#x27;</span>],</span><br><span class="line">                   <span class="string">&#x27;B&#x27;</span> : [<span class="string">&#x27;one&#x27;</span>, <span class="string">&#x27;one&#x27;</span>, <span class="string">&#x27;two&#x27;</span>, <span class="string">&#x27;three&#x27;</span>,</span><br><span class="line">                          <span class="string">&#x27;two&#x27;</span>, <span class="string">&#x27;two&#x27;</span>],</span><br><span class="line">                   <span class="string">&#x27;C&#x27;</span> : [<span class="number">1</span>, <span class="number">5</span>, <span class="number">5</span>, <span class="number">2</span>, <span class="number">5</span>, <span class="number">5</span>],</span><br><span class="line">                   <span class="string">&#x27;D&#x27;</span> : [<span class="number">2.0</span>, <span class="number">5.</span>, <span class="number">8.</span>, <span class="number">1.</span>, <span class="number">2.</span>, <span class="number">9.</span>]&#125;)</span><br><span class="line">df</span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">    A     B       C   D</span></span><br><span class="line"><span class="string">0   foo   one     1   2.0</span></span><br><span class="line"><span class="string">1   bar   one     5   5.0</span></span><br><span class="line"><span class="string">2   foo   two     5   8.0</span></span><br><span class="line"><span class="string">3   bar   three   2   1.0</span></span><br><span class="line"><span class="string">4   foo   two     5   2.0</span></span><br><span class="line"><span class="string">5   bar   two     5   9.0</span></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line">df.groupby(<span class="string">&#x27;A&#x27;</span>).apply(<span class="keyword">lambda</span> x: x[<span class="string">&#x27;B&#x27;</span>])</span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">A     </span></span><br><span class="line"><span class="string">bar  1      one</span></span><br><span class="line"><span class="string">     3    three</span></span><br><span class="line"><span class="string">     5      two</span></span><br><span class="line"><span class="string">foo  0      one</span></span><br><span class="line"><span class="string">     2      two</span></span><br><span class="line"><span class="string">     4      two</span></span><br><span class="line"><span class="string">Name: B, dtype: object</span></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="comment"># pd.cut()/qcut() 分桶</span></span><br><span class="line">factor = pd.cut(df[<span class="string">&#x27;C&#x27;</span>],bins=<span class="number">2</span>)</span><br><span class="line">df.groupby(factor).apply(<span class="keyword">lambda</span> x: x[<span class="string">&#x27;B&#x27;</span>])</span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">C              </span></span><br><span class="line"><span class="string">(0.996, 3.0]  0      one</span></span><br><span class="line"><span class="string">              3    three</span></span><br><span class="line"><span class="string">(3.0, 5.0]    1      one</span></span><br><span class="line"><span class="string">              2      two</span></span><br><span class="line"><span class="string">              4      two</span></span><br><span class="line"><span class="string">              5      two</span></span><br><span class="line"><span class="string">Name: B, dtype: object</span></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br></pre></td></tr></table></figure><br />
<div class="note info"><p>agg()+python内置方法的计算速度最快，其次是transform()+python内置方法。而
transform() 方法+自定义函数 的组合方法最慢，需要避免使用！</p>
</div></p>
<h4 id="透视表和交叉表">透视表和交叉表</h4>
<p>我们已经知道 GroupBy 抽象类是如何探索数据集内部的关联性的了。
数据透视表（pivot table）是一种类似的操作方法，常见于 Excel
与类似的表格应用中。数据透视表将每一列数据作为输入，输出将数据不断细分成多个维度累计信息的二维数据表。人们有时容易弄混数据透视表与
GroupBy，但我觉得数据透视表更像是一种<strong>多维的</strong> GroupBy
累计操作。也就是说，虽然你也可以分割 - 应用 -
组合，但是分割与组合不是发生在一维索引上，而是在二维网格上（行列同时分组）。<br />
<code>pd.pivot_table(data, values=None, index=None, columns=None, aggfunc='mean', fill_value=None, margins=False, dropna=True, margins_name='All', observed=False)</code>：<br />
（1）data：一个DataFrame对象。<br />
（2）values：指定哪些列将被聚合。默认聚合所有的数值列。<br />
（3）index：一个index
label/一个Grouper/一个数组/前面这些类型的一个列表。它指定关于分组的列名或者其他分组键，出现在结果透视表的行。<br />
（4）columns：一个column
label/一个Grouper/一个数组/前面这些类型的一个列表。它指定关于分组的列名或者其他分组键，出现在结果透视表的列。<br />
（5）aggfunc：一个函数/函数列表。默认为numpy.mean。它作为聚合函数。如果为函数的列表，则结果中会出现多级索引，函数名就是最外层的索引名。<br />
（6）fill_value：一个标量，用于替换NaN。<br />
（7）margins：一个布尔值。如果为True，则添加行/列的总计。<br />
（8）dropna：一个布尔值。如果为True，则结果不包含所有元素都是NaN的列。<br />
（9）margins_name：一个字符串。当margins=True时，margins列的列名。<br />
（10）observed：一个布尔值。当Grouper是Categoricals时有效。如果为True，则只显示在分类中的值，False则显示所有。<br />
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br></pre></td><td class="code"><pre><span class="line">df = pd.DataFrame(&#123;<span class="string">&quot;A&quot;</span>: [<span class="string">&quot;foo&quot;</span>, <span class="string">&quot;foo&quot;</span>, <span class="string">&quot;foo&quot;</span>, <span class="string">&quot;foo&quot;</span>, <span class="string">&quot;foo&quot;</span>,</span><br><span class="line">                         <span class="string">&quot;bar&quot;</span>, <span class="string">&quot;bar&quot;</span>, <span class="string">&quot;bar&quot;</span>, <span class="string">&quot;bar&quot;</span>],</span><br><span class="line">                   <span class="string">&quot;B&quot;</span>: [<span class="string">&quot;one&quot;</span>, <span class="string">&quot;one&quot;</span>, <span class="string">&quot;one&quot;</span>, <span class="string">&quot;two&quot;</span>, <span class="string">&quot;two&quot;</span>,</span><br><span class="line">                         <span class="string">&quot;one&quot;</span>, <span class="string">&quot;one&quot;</span>, <span class="string">&quot;two&quot;</span>, <span class="string">&quot;two&quot;</span>],</span><br><span class="line">                   <span class="string">&quot;C&quot;</span>: [<span class="string">&quot;small&quot;</span>, <span class="string">&quot;large&quot;</span>, <span class="string">&quot;large&quot;</span>, <span class="string">&quot;small&quot;</span>,</span><br><span class="line">                         <span class="string">&quot;small&quot;</span>, <span class="string">&quot;large&quot;</span>, <span class="string">&quot;small&quot;</span>, <span class="string">&quot;small&quot;</span>,</span><br><span class="line">                         <span class="string">&quot;large&quot;</span>],</span><br><span class="line">                   <span class="string">&quot;D&quot;</span>: [<span class="number">1</span>, <span class="number">2</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">3</span>, <span class="number">4</span>, <span class="number">5</span>, <span class="number">6</span>, <span class="number">7</span>],</span><br><span class="line">                   <span class="string">&quot;E&quot;</span>: [<span class="number">2</span>, <span class="number">4</span>, <span class="number">5</span>, <span class="number">5</span>, <span class="number">6</span>, <span class="number">6</span>, <span class="number">8</span>, <span class="number">9</span>, <span class="number">9</span>]&#125;)</span><br><span class="line">df</span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">     A    B      C  D  E</span></span><br><span class="line"><span class="string">0  foo  one  small  1  2</span></span><br><span class="line"><span class="string">1  foo  one  large  2  4</span></span><br><span class="line"><span class="string">2  foo  one  large  2  5</span></span><br><span class="line"><span class="string">3  foo  two  small  3  5</span></span><br><span class="line"><span class="string">4  foo  two  small  3  6</span></span><br><span class="line"><span class="string">5  bar  one  large  4  6</span></span><br><span class="line"><span class="string">6  bar  one  small  5  8</span></span><br><span class="line"><span class="string">7  bar  two  small  6  9</span></span><br><span class="line"><span class="string">8  bar  two  large  7  9</span></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="comment"># 按照&#x27;A&#x27;, &#x27;B&#x27;, &#x27;C&#x27;分组（&#x27;C&#x27;转成了列索引），&#x27;D&#x27;的数据填充分组</span></span><br><span class="line"><span class="comment"># 透视表等价于下面的groupby操作，多维的groupby</span></span><br><span class="line">table = pd.pivot_table(df, values=<span class="string">&#x27;D&#x27;</span>, index=[<span class="string">&#x27;A&#x27;</span>, <span class="string">&#x27;B&#x27;</span>], columns=[<span class="string">&#x27;C&#x27;</span>], aggfunc=np.<span class="built_in">sum</span>)</span><br><span class="line"><span class="comment"># df.groupby([&#x27;A&#x27;, &#x27;B&#x27;, &#x27;C&#x27;])[&#x27;D&#x27;].sum().unstack()</span></span><br><span class="line">table</span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">C        large  small</span></span><br><span class="line"><span class="string">A   B</span></span><br><span class="line"><span class="string">bar one    4.0    5.0</span></span><br><span class="line"><span class="string">    two    7.0    6.0</span></span><br><span class="line"><span class="string">foo one    4.0    1.0</span></span><br><span class="line"><span class="string">    two    NaN    6.0</span></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="comment"># 当aggfun使用字典时，可以不用指定values了，因为映射关系已经确定了透视的数据</span></span><br><span class="line">table = pd.pivot_table(df, index=[<span class="string">&#x27;A&#x27;</span>, <span class="string">&#x27;C&#x27;</span>], aggfunc=&#123;<span class="string">&#x27;D&#x27;</span>: np.mean, <span class="string">&#x27;E&#x27;</span>: np.mean&#125;)</span><br><span class="line">table</span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">                D         E</span></span><br><span class="line"><span class="string">A   C</span></span><br><span class="line"><span class="string">bar large  5.500000  7.500000</span></span><br><span class="line"><span class="string">    small  5.500000  8.500000</span></span><br><span class="line"><span class="string">foo large  2.000000  4.500000</span></span><br><span class="line"><span class="string">    small  2.333333  4.333333</span></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line">table = pd.pivot_table(df, index=[<span class="string">&#x27;A&#x27;</span>, <span class="string">&#x27;C&#x27;</span>], aggfunc=&#123;<span class="string">&#x27;D&#x27;</span>: np.mean, <span class="string">&#x27;E&#x27;</span>: [<span class="built_in">min</span>, <span class="built_in">max</span>, np.mean]&#125;)</span><br><span class="line">table</span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">                D    E</span></span><br><span class="line"><span class="string">            mean     max    mean    min</span></span><br><span class="line"><span class="string">A   C</span></span><br><span class="line"><span class="string">bar large  5.500000  9.0  7.500000  6.0</span></span><br><span class="line"><span class="string">    small  5.500000  9.0  8.500000  8.0</span></span><br><span class="line"><span class="string">foo large  2.000000  5.0  4.500000  4.0</span></span><br><span class="line"><span class="string">    small  2.333333  6.0  4.333333  2.0</span></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br></pre></td></tr></table></figure></p>
<p>交叉表是一种用于计算分组频率的特殊透视表。我们可以使用<code>pivot_table()</code>函数实现交叉表的功能，但是直接使用<code>crosstab()</code>更方便：<br />
<code>pd.crosstab(index, columns, values=None, rownames=None, colnames=None, aggfunc=None, margins=False, margins_name='All', dropna=True, normalize=False)</code>：<br />
（1）index：一个array-like、Series或者前两种的列表。它给出了行的计算频数的数据。<br />
（2）columns：一个array-like、Series或者前两种的列表。它给出了列的计算频数的数据。<br />
（3）values：一个array-like，该数据用于聚合。如果出现了values，则必须提供aggfunc。<br />
（4）aggfunc：一个函数对象，是聚合函数。如果出现了aggfunc，则必须提供values。<br />
（5）rownames：一个序列。如果非空，则必须和结果的row
index的level数量相等。<br />
（6）colnames：一个序列。如果非空，则必须和结果的column
index的level数量相等。<br />
（7）margins：一个布尔值。如果为True，则添加行/列的总计。<br />
（8）margins_name：一个字符串。当margins=True时，margins列的列名。<br />
（9）dropna：一个布尔值。如果为True，则结果不包含这样的列：该列所有元素都是NaN。<br />
（10）normalize：一个布尔值、字符串（'all'/'index'/'columns'）、或者整数0/1。它指定是否进行归一化处理（归一化为频率），否则就是频数。<br />
　　　如果'all'/True，则对所有数据进行归一化；<br />
　　　如果为'index'：则对每一行归一化；<br />
　　　如果为'columns'：则对每一列归一化；<br />
　　　如果margins为True，则对margins也归一化。<br />
首先根据index-columns建立坐标。行坐标来自index，列坐标来自columns。在index-columns-values中，同一个坐标下的values组成Series。这个Series被aggfunc进行聚合，返回一个标量。此时就不再是对坐标点进行计数了，而是对values进行聚合。<br />
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line">a = np.array([<span class="string">&quot;foo&quot;</span>, <span class="string">&quot;foo&quot;</span>, <span class="string">&quot;foo&quot;</span>, <span class="string">&quot;foo&quot;</span>, <span class="string">&quot;bar&quot;</span>, <span class="string">&quot;bar&quot;</span>,</span><br><span class="line">              <span class="string">&quot;bar&quot;</span>, <span class="string">&quot;bar&quot;</span>, <span class="string">&quot;foo&quot;</span>, <span class="string">&quot;foo&quot;</span>, <span class="string">&quot;foo&quot;</span>], dtype=<span class="built_in">object</span>)</span><br><span class="line">b = np.array([<span class="string">&quot;one&quot;</span>, <span class="string">&quot;one&quot;</span>, <span class="string">&quot;one&quot;</span>, <span class="string">&quot;two&quot;</span>, <span class="string">&quot;one&quot;</span>, <span class="string">&quot;one&quot;</span>,</span><br><span class="line">              <span class="string">&quot;one&quot;</span>, <span class="string">&quot;two&quot;</span>, <span class="string">&quot;two&quot;</span>, <span class="string">&quot;two&quot;</span>, <span class="string">&quot;one&quot;</span>], dtype=<span class="built_in">object</span>)</span><br><span class="line">c = np.array([<span class="string">&quot;dull&quot;</span>, <span class="string">&quot;dull&quot;</span>, <span class="string">&quot;shiny&quot;</span>, <span class="string">&quot;dull&quot;</span>, <span class="string">&quot;dull&quot;</span>, <span class="string">&quot;shiny&quot;</span>,</span><br><span class="line">              <span class="string">&quot;shiny&quot;</span>, <span class="string">&quot;dull&quot;</span>, <span class="string">&quot;shiny&quot;</span>, <span class="string">&quot;shiny&quot;</span>, <span class="string">&quot;shiny&quot;</span>],</span><br><span class="line">             dtype=<span class="built_in">object</span>)</span><br><span class="line">pd.crosstab(a, [b, c], rownames=[<span class="string">&#x27;a&#x27;</span>], colnames=[<span class="string">&#x27;b&#x27;</span>, <span class="string">&#x27;c&#x27;</span>])</span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">b   one        two</span></span><br><span class="line"><span class="string">c   dull shiny dull shiny</span></span><br><span class="line"><span class="string">a</span></span><br><span class="line"><span class="string">bar    1     2    1     0</span></span><br><span class="line"><span class="string">foo    2     2    1     2</span></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line">foo = pd.Categorical([<span class="string">&#x27;a&#x27;</span>, <span class="string">&#x27;b&#x27;</span>], categories=[<span class="string">&#x27;a&#x27;</span>, <span class="string">&#x27;b&#x27;</span>, <span class="string">&#x27;c&#x27;</span>])</span><br><span class="line">bar = pd.Categorical([<span class="string">&#x27;d&#x27;</span>, <span class="string">&#x27;e&#x27;</span>], categories=[<span class="string">&#x27;d&#x27;</span>, <span class="string">&#x27;e&#x27;</span>, <span class="string">&#x27;f&#x27;</span>])</span><br><span class="line">pd.crosstab(foo, bar)</span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">col_0  d  e</span></span><br><span class="line"><span class="string">row_0</span></span><br><span class="line"><span class="string">a      1  0</span></span><br><span class="line"><span class="string">b      0  1</span></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line">pd.crosstab(foo, bar, dropna=<span class="literal">False</span>)</span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">col_0  d  e  f</span></span><br><span class="line"><span class="string">row_0</span></span><br><span class="line"><span class="string">a      1  0  0</span></span><br><span class="line"><span class="string">b      0  1  0</span></span><br><span class="line"><span class="string">c      0  0  0</span></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br></pre></td></tr></table></figure></p>
<h4 id="时间序列">时间序列</h4>
<p><strong>Ⅰ、时区</strong><br />
所有的时间都有一个时区。同样一个时间戳，根据不同的时区，它可以转换成不同的时间。<br />
pytz模块的common_timezones可以获取常用的表示时区的字符串。你可以通过<code>pytz.timezone('timezone_str')</code>来创建时区对象。<br />
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> pytz</span><br><span class="line"><span class="comment"># 可用时区</span></span><br><span class="line">pytz.common_timezones[<span class="number">270</span>:<span class="number">280</span>]</span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">[&#x27;Asia/Qyzylorda&#x27;,</span></span><br><span class="line"><span class="string"> &#x27;Asia/Riyadh&#x27;,</span></span><br><span class="line"><span class="string"> &#x27;Asia/Sakhalin&#x27;,</span></span><br><span class="line"><span class="string"> &#x27;Asia/Samarkand&#x27;,</span></span><br><span class="line"><span class="string"> &#x27;Asia/Seoul&#x27;,</span></span><br><span class="line"><span class="string"> &#x27;Asia/Shanghai&#x27;,</span></span><br><span class="line"><span class="string"> &#x27;Asia/Singapore&#x27;,</span></span><br><span class="line"><span class="string"> &#x27;Asia/Srednekolymsk&#x27;,</span></span><br><span class="line"><span class="string"> &#x27;Asia/Taipei&#x27;,</span></span><br><span class="line"><span class="string"> &#x27;Asia/Tashkent&#x27;]</span></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br></pre></td></tr></table></figure><br />
<strong>Ⅱ、datetime模块</strong><br />
datetime模块中主要包含四个类：<br />
（1）datetime.time：时间类。只包含时、分、秒、微秒等时间信息。<br />
（2）datetime.date：日期类。值包含年月日星期等日期信息。<br />
（3）datetime.datetime：日期时间类。包含上述两者的全部信息。<br />
（4）datetime.timedelta：日期时间间隔类，用来表示两个datetime之间的差值。<br />
<code>datetime.time([hour[, minute[, second[, microsecond[, tzinfo]]]]])</code>：其中tzinfo就是时区对象。0&lt;=hour&lt;24，0&lt;=minute&lt;60，0&lt;=second&lt;60，0&lt;=microsecond&lt;1000000，否则抛出异常。tzinfo默认为None。<br />
（1）属性有：hour/minute/second/microsecond/tzinfo。<br />
（2）方法有：time.replace()：替换对应的值，返回一个新的对象。<br />
　　　　　　time.isoformat()：返回一个ISO 8601格式的字符串。<br />
　　　　　　time.strftime(format)：格式化datetime.time对象。<br />
　　　　　　time.tzname()：如果时区为为None，则返回None。否则返回时区名称。</p>
<p><code>datetime.date(year, month, day)</code>：month取值为<code>[1,12]</code>；day取值为<code>[1,num]</code>，num取决于指定的年和月有多少天。<br />
（1）类方法有：date.today()/date.fromtimestamp(timestamp)。<br />
（2）属性有：year/month/day。<br />
（3）方法有：运算：date1-date2、date1+timedelta、date1-timedelta、date1&lt;date2<br />
　　　　　　date.replace(year,month,day)：替换掉对应值，返回新对象。<br />
　　　　　　date.timetuple()：返回一个time.struct_time类型的元组。<br />
　　　　　　date.weekday()：返回代表星期几的数字。0为周日。<br />
　　　　　　date.isoweekday()：返回代表星期几的数字。7为周日。<br />
　　　　　　date.isocalendar()：返回一个元组(ISO year,IOS week num,ISO
weekday)。<br />
　　　　　　date.isoformat()：返回一个ISO 8601格式的字符串。<br />
　　　　　　date.ctime()：等价于time.ctime(time.mktime(d.timetuple()))。<br />
　　　　　　date.strftime(format)：格式化datetime.date对象。</p>
<p><code>datetime.datetime(year, month, day, hour=0, minute=0, second=0, microsecond=0, tzinfo=None)</code>：<br />
（1）类方法有：datetime.today()：返回当前的时间日期。<br />
　　　　　　datetime.now(tz=None)：返回指定时区当前的时间日期。如果tz=None，则等价于datetime.today()。<br />
　　　　　　datetime.utcnow()：返回当前的UTC时间日期。<br />
　　　　　　datetime.fromtimestamp(timestamp,
tz=None)：根据时间戳，创建指定时区下的时间日期。<br />
　　　　　　datetime.utcfromtimestamp(timestamp)：根据时间戳，创建UTC下的时间日期。<br />
　　　　　　datetime.combine(date,
time)：从date和time对象中创建datetime。<br />
　　　　　　datetime.strptime(date_string,
format)：从字符串中创建datetime。<br />
（2）属性有：year/month/day/hour/minute/second/microsecond/tzinfo<br />
（3）方法有：运算：datetime1-datetime2、datetime1+timedelta、datetime1-timedelta、datetime1&lt;datetime2<br />
　　　　　　datetime.date()：返回一个date对象。<br />
　　　　　　datetime.time()：返回一个time对象（该time的tzinfo=None）。<br />
　　　　　　datetime.timetz()：返回一个time对象（该time的tzinfo为datetime的tzinfo）。<br />
　　　　　　datetime.replace([year[, month[, day[, hour[, minute[,
second[, microsecond[, tzinfo]]]]]]]])：替换指定值，返回新对象。<br />
　　　　　　datetime.astimezone(tz=None)
：调整时区。如果tz=None，则默认采用系统时区。注意，调整前后的UTC时间是相同的。<br />
　　　　　　datetime.tzname()：返回时区名字。<br />
　　　　　　datetime.timetuple()：返回一个time.struct_time这样的命名元组。<br />
　　　　　　datetime.utctimetuple()：返回一个time.struct_time这样的命名元组，注意它是在UTC时间下的，而不是local
time下的。<br />
　　　　　　datetime.timestamp()：返回一个时间戳。<br />
　　　　　　datetime.weekday()：返回代表星期几的数字。0为周日。<br />
　　　　　　datetime.isoweekday()：返回代表星期几的数字。7为周日
。<br />
　　　　　　datetime.isocalendar()：返回一个元组(ISO year,IOS week
num,ISO weekday)。<br />
　　　　　　datetime.isoformat(sep='T')：返回一个ISO
8601格式的字符串。<br />
　　　　　　datetime.ctime()：等价于time.ctime(time.mktime(d.timetuple()))。<br />
　　　　　　datetime.strftime(format)：格式化datetime.datetime对象。<br />
　　　　　　注意：不能将tzinfo=None和tzinfo!=None的两个datetime进行运算。</p>
<p><code>datetime.timedelta(days=0, seconds=0, microseconds=0, milliseconds=0, minutes=0, hours=0, weeks=0)</code>：在内部，只存储秒、微秒。其他时间单位都转换为秒和微秒。<br />
（1）实例属性（只读）：days/seconds/microseconds。<br />
（2）实例方法：timedelta.total_seconds()：返回总秒数。</p>
<p>常用格式化字符串定义：<br />
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">&#x27;%Y&#x27;：4位数的年</span><br><span class="line">&#x27;%y&#x27;：2位数的年</span><br><span class="line">&#x27;%m&#x27;：2位数的月 [01,12]</span><br><span class="line">&#x27;%d&#x27;：2位数的日 [01,31]</span><br><span class="line">&#x27;%H&#x27;：小时（24小时制）[00,23]</span><br><span class="line">&#x27;%I&#x27;：小时（12小时制）[01,12]</span><br><span class="line">&#x27;%M&#x27;：2位数的分[00,59]</span><br><span class="line">&#x27;%S&#x27;：秒[00,61]，61秒用于闰秒</span><br><span class="line">&#x27;%w&#x27;：用整数表示的星期几[0,6]，0 表示星期日</span><br><span class="line">&#x27;%U&#x27;：每年的第几周[00,53]。星期天表示每周的第一天。每年的第一个星期天之前的那几天被认为是第 0 周</span><br><span class="line">&#x27;%W&#x27;：每年的第几周[00,53]。星期一表示每周的第一天。每年的第一个星期一之前的那几天被认为是第 0 周</span><br><span class="line">&#x27;%z&#x27;：以+HHMM或者-HHMM表示的UTC时区偏移量。如果未指定时区，则返回空字符串。</span><br><span class="line">&#x27;%F&#x27;：以%Y-%m-%d简写的形式</span><br><span class="line">&#x27;%D&#x27;：以%m/%d/%y简写的形式</span><br><span class="line">&#x27;%a&#x27;：星期几的简称</span><br><span class="line">&#x27;%A&#x27;：星期几的全称</span><br><span class="line">&#x27;%b&#x27;：月份的简称</span><br><span class="line">&#x27;%B&#x27;：月份的全称</span><br><span class="line">&#x27;%c&#x27;：完整的日期和时间</span><br><span class="line">&#x27;%q&#x27;：季度[01,04]</span><br></pre></td></tr></table></figure></p>
<p><strong>Ⅲ、NumPy/Pandas的时间对象</strong><br />
由于 Pandas
最初是为金融模型而创建的，因此它拥有一些功能非常强大的日期、时间、带时间索引数据的处理工具。<br />
日期与时间数据主要包含三类：<br />
（1）<strong>时间戳</strong>表示某个具体的时间点。<br />
（2）<strong>时间间隔</strong>与<strong>周期</strong>表示开始时间点与结束时间点之间的时间长度。<br />
（3）<strong>时间增量</strong>（time delta）或
<strong>持续时间</strong>（duration）表示精确的时间长度。</p>
<p>Python 的 datetime 和 dateutil
模块在处理时间序列上都很出色。但如果你处理的时间数据量比较大，那么速度就会比较慢。<br />
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> datetime <span class="keyword">import</span> datetime</span><br><span class="line"><span class="comment">#  datetime 类型创建一个日期</span></span><br><span class="line">datetime(year=<span class="number">2015</span>, month=<span class="number">7</span>, day=<span class="number">4</span>)</span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">datetime.datetime(2015, 7, 4, 0, 0)</span></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="keyword">from</span> dateutil <span class="keyword">import</span> parser</span><br><span class="line"><span class="comment">#  dateutil 模块对各种字符串格式的日期进行正确解析</span></span><br><span class="line">date = parser.parse(<span class="string">&quot;4th of July, 2015&quot;</span>)</span><br><span class="line">date</span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">datetime.datetime(2015, 7, 4, 0, 0)</span></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="comment"># date这一天是星期几</span></span><br><span class="line">date.strftime(<span class="string">&#x27;%A&#x27;</span>)</span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">&#x27;Saturday&#x27;</span></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br></pre></td></tr></table></figure><br />
Python 原生日期格式的性能弱点促使 NumPy 增加了自己的时间序列类型。<br />
datetime64 类型将日期编码为 64
位整数，这样可以让日期数组非常紧凑（节省内存）。<br />
datetime64
需要在设置日期时确定具体的输入类型。你可以通过各种格式的代码设置基本时间单位。需要注意的是，时区将自动设置为执行代码的操作系统的当地时区。<br />
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> numpy <span class="keyword">as</span> np</span><br><span class="line">date = np.array(<span class="string">&#x27;2015-07-04&#x27;</span>, dtype=np.datetime64)</span><br><span class="line">date</span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">array(datetime.date(2015, 7, 4), dtype=&#x27;datetime64[D]&#x27;)</span></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="comment"># 设置时间单位，默认单位都用纳秒 datetime64[ns]</span></span><br><span class="line">np.datetime64(<span class="string">&#x27;2015-07-04 12:59:59.50&#x27;</span>, <span class="string">&#x27;ns&#x27;</span>)</span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">numpy.datetime64(&#x27;2015-07-04T12:59:59.500000000&#x27;)</span></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br></pre></td></tr></table></figure><br />
datetime64的日期与时间单位格式：<br />
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">Y 年（year）</span><br><span class="line">M 月（month）</span><br><span class="line">W 周（week）</span><br><span class="line">D 日（day） </span><br><span class="line">h 时（hour） </span><br><span class="line">m 分（minute）</span><br><span class="line">s 秒（second）</span><br><span class="line">ms 毫秒（millisecond）</span><br><span class="line">us 微秒（microsecond）</span><br><span class="line">ns 纳秒（nanosecond）</span><br><span class="line">ps 皮秒（picosecond）</span><br><span class="line">fs 飞秒（femtosecond）</span><br><span class="line">as 原秒（attosecond） </span><br></pre></td></tr></table></figure></p>
<p>Pandas 所有关于日期与时间的处理方法全部都是通过 Timestamp
对象实现的，它利用 numpy.datetime64 的有效存储和向量化接口将 datetime 和
dateutil 的易用性有机结合起来。 Pandas 通过一组 Timestamp
对象就可以创建一个可以作为 Series 或 DataFrame 索引的
DatetimeIndex。<br />
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">index = pd.DatetimeIndex([<span class="string">&#x27;2014-07-04&#x27;</span>, <span class="string">&#x27;2014-08-04&#x27;</span>,<span class="string">&#x27;2015-07-04&#x27;</span>, <span class="string">&#x27;2015-08-04&#x27;</span>])</span><br><span class="line">data = pd.Series([<span class="number">0</span>, <span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>], index=index)</span><br><span class="line">data</span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">2014-07-04   0</span></span><br><span class="line"><span class="string">2014-08-04   1</span></span><br><span class="line"><span class="string">2015-07-04   2</span></span><br><span class="line"><span class="string">2015-08-04   3</span></span><br><span class="line"><span class="string">dtype: int64</span></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="comment"># 切片</span></span><br><span class="line">data[<span class="string">&#x27;2014-07-04&#x27;</span>:<span class="string">&#x27;2015-07-04&#x27;</span>]</span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">2014-07-04   0</span></span><br><span class="line"><span class="string">2014-08-04   1</span></span><br><span class="line"><span class="string">2015-07-04   2</span></span><br><span class="line"><span class="string">dtype: int64</span></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br></pre></td></tr></table></figure><br />
<strong>1、时间戳</strong><br />
针对时间戳数据， Pandas 提供了 Timestamp
类型。与前面介绍的一样，它本质上是 Python 的原生 datetime
类型的替代品，但是在性能更好的 numpy.datetime64
类型的基础上创建。对应的索引数据结构是 DatetimeIndex。<br />
<code>pd.Timestamp(ts_input=&lt;object object&gt;, freq=None, tz=None, unit=None, year=None, month=None, day=None, hour=None, minute=None, second=None, microsecond=None, tzinfo=None, offset=None)</code>：<br />
（1）ts_input：一个datetime-like/str/int/float，该值将被转换成Timestamp<br />
（2）freq：一个字符串或者DateOffset，给出了偏移量<br />
（3）tz：一个字符串或者pytz.timezone对象，给出了时区<br />
（4）unit：一个字符串。当ts_input为整数或者浮点数时，给出了转换单位<br />
（5）offset：废弃的，推荐使用freq<br />
其他的参数来自于datetime.datetime。它们要么使用位置参数，要么使用关键字参数，但是不能混用。<br />
<div class="note info"><p>默认情况下，pands中的Timestamp是tz-naive，即tz字段为None。
Timestamp提供了方便的时区转换功能。如果tz非空，则是tz-aware
Timestamp。不同时区的时间可以比较，但是naive Timestamp和localized
Timestamp无法比较。<br />
Timestamp的减法，要求两个Timestamp要么都是同一个时区下，要么都是tz-naive的。</p>
</div></p>
<p>属性有：<br />
（1）year/month/day/hour/minute/second/microsecond/nanosecond...,这些属性都为整数。<br />
（2）dayofweek/dayofyear/days_in_mounth/freqstr/quarter/weekofyear/...。<br />
（3）tzinfo：时区信息（默认为None），它是一个datetime.tzinfo对象。<br />
（4）value：保存的是UTC时间戳（自Unix纪元1970年1月1日以来的纳秒数），该值在时区转换过程中保持不变。</p>
<p>类方法有：<br />
（1）<code>combine(date, time)</code>：通过datetime.date和datetime.time创建一个Timestamp。<br />
（2）<code>fromtimestamp(ts)</code>：通过时间戳创建一个Timestamp。<br />
（3）<code>now(tz=None)</code>：创建一个指定时区的当前时间。<br />
（4）<code>doday(tz=None)</code>：创建一个指定时区的当前时间。<br />
（5）<code>utcfromtimestamp(ts)</code>：从时间戳创建一个UTC
Timestamp，其tzinfo=None。<br />
（6）<code>utcnow()</code>：创建一个当前的UTC
Timestamp，其tzinfo=UTC。</p>
<p>方法有：<br />
（1）<code>astimezone(tz)</code>/<code>tz_convert(tz)</code>：将一个tz-aware
Timestamp转换时区。<br />
（2）<code>isoformat(sep='T')</code>：返回一个ISO
8601格式的字符串。<br />
（3）<code>normalize()</code>：将Timestamp调整到午夜（保留tzinfo）。<br />
（4）<code>replace(**kwds)</code>：调整对应值，返回一个新对象。<br />
（5）<code>to_period(self, freq=None)</code>：返回一个Period对象。<br />
（6）<code>tz_localize(self, tz, ambiguous='raise', errors='raise')</code>：利用tz将tz-naive
Timestamp转换成tz-aware Timestamp。<br />
（7）<code>to_pydatetime(...)</code>：转换为python datetime对象。<br />
（8）<code>to_datetime64(...)</code>：转换为numpy.datetime64对象。<br />
（9）<code>strftime(date_format, format)</code>：可以将datetime对象和Timestamp对象，根据指定的格式，格式化为字符串。<br />
（10）<code>strptime(string, format)</code>：根据指定的格式把一个时间字符串解析为时间元组。对于一些常见的日期格式，使用dateutil这个第三方包中的<code>parser.parse(dt_str)</code>，它几乎可以解析所有的日期表示形式。<br />
（11）其他从datetime.date/datetime.datetime继承而来的方法。<br />
<code>pd.to_datetime()</code>方法可以解析多种不同的日期表示形式，将字符串转换为日期。对于标准日期格式的解析非常快。如果发现无法解析（如不是一个日期），则返回一个NaT（Not
a Time），它是时间戳数据中的NA值。</p>
<p><strong>DatetimeIndex</strong><br />
DatetimeIndex是一种索引，它的各个标量值是Timestamp对象，它用numpy的datetime64数据类型以纳秒形式存储时间戳。<br />
<code>pd.DatetimeIndex(data=None, freq=None, start=None, end=None, periods=None, copy=False, name=None, tz=None, verify_integrity=True, normalize=False, closed=None, ambiguous='raise', dtype=None, **kwargs)</code>：<br />
（1）data：一个array-like对象，给出了各个时间。<br />
（2）copy：一个布尔值，如果为True 则拷贝基础数据。<br />
（3）freq：一个字符串或者DateOffset对象，给出了频率。<br />
（4）start：一个datetime-like，指定了起始时间。如果data=None，则使用它来生成时间。<br />
（5）periods：一个整数（大于0），指定生成多少个时间。如果data=None，则使用它来生成时间。<br />
（6）end：一个datetime-like，指定了结束时间。如果data=None且periods=None，则使用它来生成时间。<br />
（7）closed：一个字符串或者None。用于指示区间的类型。可以为'left'（左闭右开），'right'（左开右闭），None（左闭右闭）。<br />
（8）tz： 一个字符串，指定了时区。如果非空，则返回的是localized
DatetimeIndex 。<br />
（9）name：指定了Index的名字。</p>
<p>DatetimeIndex继承自Index，因此它有Index的所有方法：<br />
（1）<code>indexer_at_time(time, asof=False)</code>：返回指定time的位置。<br />
（2）indexer_between_time( start_time, end_time, include_start=True,
include_end=True)：返回指定的两个时间之间的索引的位置。<br />
（3）normalize()：将时间调整到午夜。<br />
（4）to_period( freq=None)：以指定freq转换到PeriodIndex。<br />
（5）to_perioddelta(
freq)：计算不同索引值的Timedelta，然后转换成一个TimedeldaIndex。<br />
（6）to_pydatetime/tz_convert/tz_localize：对每个时间使用Timestamp对应的方法。<br />
任何Timestamp的属性都可以作用于DatetimeIndex。</p>
<p>创建有规律的时间序列：<code>pd.date_range()</code> 可以处理时间戳、
<code>pd.period_range()</code> 可以处理周期、
<code>pd.timedelta_range()</code> 可以处理时间间隔。<br />
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># periods 周期数; freq 参数改变时间间隔</span></span><br><span class="line">pd.date_range(<span class="string">&#x27;2015-07-03&#x27;</span>, periods=<span class="number">8</span>, freq=<span class="string">&#x27;B&#x27;</span>)</span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">DatetimeIndex([&#x27;2015-07-03&#x27;, &#x27;2015-07-06&#x27;, &#x27;2015-07-07&#x27;, &#x27;2015-07-08&#x27;,</span></span><br><span class="line"><span class="string">               &#x27;2015-07-09&#x27;, &#x27;2015-07-10&#x27;, &#x27;2015-07-13&#x27;, &#x27;2015-07-14&#x27;],</span></span><br><span class="line"><span class="string">              dtype=&#x27;datetime64[ns]&#x27;, freq=&#x27;B&#x27;)</span></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br></pre></td></tr></table></figure></p>
<p><strong>2、时间周期</strong><br />
针对时间周期数据， Pandas 提供了 Period 类型。这是利用 numpy.datetime64
类型将固定频率的时间间隔进行编码。对应的索引数据结构是
PeriodIndex。<br />
Period表示一个标准的时间段（如某年，某月），时间段的长短由freq属性决定。<br />
<code>pd.Period(value=None, freq=None, ordinal=None, year=None, month=None, quarter=None, day=None, hour=None, minute=None, second=None)</code>：<br />
（1）value：一个Period对象或者字符串（如'4Q2016'），它表示一个时区段。默认为None<br />
（2）freq：一个字符串，表示区间长度。可选的值这些函数获取：<code>pd.tseries.frequencies._period_code_map.keys()</code>，<code>pd.tseries.frequencies._period_alias_dictionary()</code>。<br />
（3）其他的参数和Timestamp类的构造函数类似。其中quarter表示季度。</p>
<p>属性：<br />
（1）day/dayofweek/dayofyear/hour/minute/quarter/second/year/week/weekday/weekofyear/year。<br />
（2）end_time：区间结束的Timestamp。start_time：区间开始的Timestamp。freq：周期。</p>
<p>方法：<br />
（1）<code>asfreq(freq,how)</code>：转换为其他区间。其中freq为字符串。how可以为'E'/'end'，表示包含区间结束；'S'/'start'表示包含区间开始。<br />
（2）<code>now(freq)</code>：返回当期日期对应freq下的Period。<br />
（3）<code>strftime(format)</code>：给出Period的格式化字符串表示。<br />
（4）<code>to_timestamp(freq,how)</code>：转换为Timestamp。</p>
<p><strong>PeriodIndex</strong><br />
如果将一个Period序列作为索引，则该索引就是PeriodIndex类型。其各位置的值为Period对象。<br />
<code>pd.PeriodIndex(data=None, ordinal=None, freq=None, start=None, end=None, periods=None, copy=False, name=None, tz=None, dtype=None, **kwargs)</code>：<br />
（1）data：一个array-like对象，给出了各个时间段。<br />
（2）copy：一个布尔值，如果为True 则拷贝基础数据。<br />
（3）freq：一个字符串或者period对象，给出了频率。<br />
（4）start：一个period-like，指定了起始时间段。如果data=None，则使用它来生成时间段。<br />
（5）periods：一个整数（大于0），指定生成多少个时间段。如果data=None，则使用它来生成时间段。<br />
（6）end：一个period-like，指定了结束时间段。如果data=None且periods=None，则使用它来生成时间段。<br />
（7）year/month/quarter/day/hour/minute/second：一个整数、array或者Series
。通过它们可以组装出一个Period序列。<br />
（8）tz： 一个字符串，指定了时区。如果非空，则返回的是localized
DatetimeIndex。<br />
（9）name：指定了Index的名字。</p>
<p>PeriodIndex继承自Index，因此它有Index的所有方法：<br />
（1）<code>asfreq( freq=None, how='E')</code>：转换成另一种频率的时间段。<br />
（2）<code>to_timestamp(self, freq=None, how='start')</code>：转成DatetimeIndex。<br />
（3）<code>tz_convert(self, tz)/tz_localize(self, tz, infer_dst=False)</code>：转成对应时区的DatetimeIndex。<br />
任何Period的属性都可以作用于PeriodIndex。</p>
<p>创建有规律的时间序列：<code>pd.date_range()</code> 可以处理时间戳、
<code>pd.period_range()</code> 可以处理周期、
<code>pd.timedelta_range()</code> 可以处理时间间隔。<br />
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">pd.period_range(<span class="string">&#x27;2015-07-03&#x27;</span>, periods=<span class="number">8</span>, freq=<span class="string">&#x27;H&#x27;</span>)</span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">PeriodIndex([&#x27;2015-07-03 00:00&#x27;, &#x27;2015-07-03 01:00&#x27;, &#x27;2015-07-03 02:00&#x27;,</span></span><br><span class="line"><span class="string">             &#x27;2015-07-03 03:00&#x27;, &#x27;2015-07-03 04:00&#x27;, &#x27;2015-07-03 05:00&#x27;,</span></span><br><span class="line"><span class="string">             &#x27;2015-07-03 06:00&#x27;, &#x27;2015-07-03 07:00&#x27;],</span></span><br><span class="line"><span class="string">            dtype=&#x27;period[H]&#x27;, freq=&#x27;H&#x27;)</span></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br></pre></td></tr></table></figure></p>
<p><strong>3、时间增量</strong><br />
针对时间增量或持续时间， Pandas 提供了 Timedelta 类型。 Timedelta
是一种代替 Python 原生 datetime.timedelta
类型的高性能数据结构，同样是基于 numpy.timedelta64
类型。对应的索引数据结构是 TimedeltaIndex。<br />
<code>pd.Timedelta(value=&lt;object object&gt;, unit=None, **kwargs)</code><br />
（1）value：一个Timedelta对象，或者datetime.timedelta，或者np.timedelta64、或者一个整数，或者一个字符串。指定了时间间隔。<br />
（2）unit：一个字符串，指明了当输入时整数时，其单位。可以为'D'/'h'/'m'/'s'/'ms'/'us'/'ns'。<br />
（3）days/seconds/microseconds/nanoseconds：都是数值。给出了某个时间单位下的时间间隔。</p>
<p>属性：<br />
（1）days/seconds/microseconds/nanoseconds...。<br />
（2）components：返回各成分的命名元组。<br />
（3）delta：返回总的时常（纳秒计）。<br />
一个时间间隔有天数、秒数等等属性。注意：所有的这些值与对应的单位相乘的和，才是总的时间间隔。两个Timestamp相减可以得到时间间隔Timedelta。</p>
<p>方法：<br />
（1）to_timedelta64()：返回一个numpy.timedelta64类型（按照纳秒的精度）。<br />
（2）total_seconds()：返回总的时间间隔，单位秒（精度为纳秒）。<br />
（3）to_pytimedelta()：返回一个datetime.timedelta对象。</p>
<p><strong>4、pandas的偏移量/偏移对象：</strong><br />
DateOffset也一定程度上表示时间间隔，但是DateOffset更侧重于按照某个固定的频率的间隔，比如一天、一个月、一周等。<br />
DateOffset对象：是一个表示日期偏移对象。Timestamp加一个日期偏移，结果还是一个Timestamp对象。<br />
<code>pd.DateOffset(n=1, normalize=False, **kwds)</code>：可使用的偏移参数为years/months/weeks/days/hours/minutes/seconds/microseconds/nanoseconds。<br />
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> pandas.tseries.offsets <span class="keyword">import</span> DateOffset</span><br><span class="line">ts = pd.Timestamp(<span class="string">&#x27;2017-01-01 09:10:11&#x27;</span>)</span><br><span class="line">ts + DateOffset(months=<span class="number">3</span>)</span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">Timestamp(&#x27;2017-04-01 09:10:11&#x27;)</span></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br></pre></td></tr></table></figure><br />
或者使用pandas.tseries.offsets中的对象：<br />
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">Day：日历日</span><br><span class="line">BusinessDay：工作日</span><br><span class="line">Hour：小时</span><br><span class="line">Minute：分钟</span><br><span class="line">Second：秒</span><br><span class="line">Milli：毫秒</span><br><span class="line">Micro：微秒</span><br><span class="line">MonthEnd：每月最后一个日历日</span><br><span class="line">BusinessMonthEnd：每月最后一个工作日</span><br><span class="line">MonthBegin：每月第一个日历日</span><br><span class="line">BusinessMonthBegin：每月第一个工作日</span><br><span class="line">Week：每周几 </span><br></pre></td></tr></table></figure><br />
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> pandas.tseries.offsets <span class="keyword">import</span> Day</span><br><span class="line">ts = pd.Timestamp(<span class="string">&#x27;2015-01-01 09:10:11&#x27;</span>)</span><br><span class="line">ts</span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">Timestamp(&#x27;2015-01-01 09:10:11&#x27;)</span></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line">ts + Day(<span class="number">1</span>) <span class="comment">#增加一个日历日</span></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">Timestamp(&#x27;2015-01-02 09:10:11&#x27;)</span></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br></pre></td></tr></table></figure><br />
<strong>5、pandas的freq频率：</strong><br />
pands中的频率是由一个基础频率和一个倍数组成。</p>
<p>（1）基础频率通常以一个字符串别名表示，如'M'表示每月，'H'表示每小时。对于每个基础频率，都有一个DateOffset对象与之对应。如pandas.tseries.offsets中的Hour/Minute。Hour(4)表示日期偏移为
4小时。pandas中的freq频率代码：<br />
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line">D 天（calendar day，按日历算，含双休日） </span><br><span class="line">B 天（business day，仅含工作日）</span><br><span class="line">W 周（weekly）</span><br><span class="line">M 月末（month end） </span><br><span class="line">BM 月末（business month end，仅含工作日）</span><br><span class="line">Q 季末（quarter end） </span><br><span class="line">BQ 季末（business quarter end，仅含工作日）</span><br><span class="line">A 年末（year end） </span><br><span class="line">BA 年末（business year end，仅含工作日）</span><br><span class="line">H 小时（hours） </span><br><span class="line">BH 小时（business hours，工作时间）</span><br><span class="line">T 分钟（minutes）</span><br><span class="line">S 秒（seconds）</span><br><span class="line">L 毫秒（milliseonds）</span><br><span class="line">U 微秒（microseconds）</span><br><span class="line">N 纳秒（nanoseconds）</span><br><span class="line"></span><br><span class="line">MS 月初（month start）</span><br><span class="line">BMS 月初（business month start，仅含工作日）</span><br><span class="line">QS 季初（quarter start）</span><br><span class="line">BQS 季初（business quarter start，仅含工作日）</span><br><span class="line">AS 年初（year start）</span><br><span class="line">BAS 年初（business year start，仅含工作日）</span><br></pre></td></tr></table></figure><br />
另外，你可以在频率代码后面加三位月份缩写字母来改变季、年频率的开始时间：A-JAN、
BA-FEB、 AS-MAR、 BAS-APR 等。<br />
同理，也可以在后面加三位星期缩写字母来改变一周的开始时间：W-SUN、
W-MON、 W-TUE、 W-WED 等。</p>
<p>（2）倍数为基础频率之前的数字，如'4H'。还可以将频率组合起来创建的新的周期，可以用小时（H）和分钟（T）的组合来实现
2 小时 30 分钟：<code>freq="2H30T"</code>。</p>
<h4 id="重采样resample">重采样resample</h4>
<p>重采样resampling指的是将时间序列从一个频率转换到另一个频率的处理过程。</p>
<p>将高频数据转换到低频数据称作降采样。降采样时，待聚合的数据不必拥有固定的频率，期望的频率（低频的）会自动划分聚合的bin的边界。这些bin将时间序列拆分为多个片段。这些片段都是半开放的，一个数据点只能属于一个片段，所有的片段的并集组成了整个时间帧。在对数据降采样时，需要考虑：<br />
（1）各个区间哪边是闭合的，<br />
（2）如何标记各个聚合bin，用区间的开头还是结尾。</p>
<p>将低频数据转换到高频数据称作升采样。将数据转换到高频时，就不需要聚合了，而是插值，默认引入缺失值。插值的填充和填充方式与fillna/reindex的一样。在对时间段Period进行重采样时，升采样稍微麻烦点，因为你必须决定：哪个高频区间代表原区间。就像asfreq一样，convention可以设置为'end'/'start'。</p>
<p>有些重采样并不划分到上述两者之中。比如将W-WED（每周三）转换到W-FRI（每周五）。另外，由于Period是时间区间，所以升采样和降采样的规则就比较严格：<br />
（1）降采样中，目标频率必须包含原频率。如Day-&gt;Month，目标频率为每月，原频率为每天。<br />
（2）升采样中，原频率必须包含目标频率。如Day-&gt;Hour，目标频率为每小时，原频率为每天。<br />
如果不满足这些条件，则会引发异常。</p>
<p><code>Series/DataFrame.resample(rule, axis=0, closed=None, label=None, convention='start', kind=None, loffset=None, limit=None, base=None, on=None, level=None, origin='start_day', offset=None)</code>：<br />
（1）rule：一个字符串，指定了重采样的目标频率。<br />
（2）axis：为0/'index'表示沿着0轴重采样；为1/'columns'表示沿着1轴重采样。<br />
（3）closed：一个字符串，指定降采样中，各时间段的哪一端是闭合的。如果为'right'，则是左开右闭区间；如果为'left'，则是左闭右开区间。<br />
（4）label：在降采样中，如何设置聚合值的标签。可以为'right'/'left'（面元的右边界或者左边界）。如：9:30~9:35这5分钟会被标记为9:30或者9:35。<br />
（5）convention：当重采样时期时，将低频转换到高频所采用的约定。可以为's'/'start'（用第一个高频）或者'e'/'end'（用最后一个高频）。<br />
（6）on：一个字符串，对于DataFrame，它指定了重采样的列。该列必须是datetime-like。<br />
（7）level：一个字符串或者整数。对于MultiIndex，该参数指定了被重采样的子索引。<br />
（8）limit：一个整数。指定向前或者向后填充时，运行连续填充的最大单元数量。<br />
（9）kind：一个字符串，指定聚合到时间段Period还是时间戳Timestamp。默认聚合到时间序列的索引类型。<br />
（10）origin：{‘epoch’, ‘start’, ‘start_day’}, Timestamp or str, default
‘start_day’。调整分组的时间戳。<br />
（11）offset：一个timedelta，偏移量。<br />
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br></pre></td><td class="code"><pre><span class="line">index = pd.date_range(<span class="string">&#x27;1/1/2000&#x27;</span>, periods=<span class="number">9</span>, freq=<span class="string">&#x27;T&#x27;</span>)</span><br><span class="line">series = pd.Series(<span class="built_in">range</span>(<span class="number">9</span>), index=index)</span><br><span class="line">series</span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">2000-01-01 00:00:00    0</span></span><br><span class="line"><span class="string">2000-01-01 00:01:00    1</span></span><br><span class="line"><span class="string">2000-01-01 00:02:00    2</span></span><br><span class="line"><span class="string">2000-01-01 00:03:00    3</span></span><br><span class="line"><span class="string">2000-01-01 00:04:00    4</span></span><br><span class="line"><span class="string">2000-01-01 00:05:00    5</span></span><br><span class="line"><span class="string">2000-01-01 00:06:00    6</span></span><br><span class="line"><span class="string">2000-01-01 00:07:00    7</span></span><br><span class="line"><span class="string">2000-01-01 00:08:00    8</span></span><br><span class="line"><span class="string">Freq: T, dtype: int64</span></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line">series.resample(<span class="string">&#x27;3T&#x27;</span>).<span class="built_in">sum</span>()</span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">2000-01-01 00:00:00     3</span></span><br><span class="line"><span class="string">2000-01-01 00:03:00    12</span></span><br><span class="line"><span class="string">2000-01-01 00:06:00    21</span></span><br><span class="line"><span class="string">Freq: 3T, dtype: int64</span></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line">series.resample(<span class="string">&#x27;3T&#x27;</span>, label=<span class="string">&#x27;right&#x27;</span>).<span class="built_in">sum</span>()</span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">2000-01-01 00:03:00     3</span></span><br><span class="line"><span class="string">2000-01-01 00:06:00    12</span></span><br><span class="line"><span class="string">2000-01-01 00:09:00    21</span></span><br><span class="line"><span class="string">Freq: 3T, dtype: int64</span></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line">series.resample(<span class="string">&#x27;3T&#x27;</span>, label=<span class="string">&#x27;right&#x27;</span>, closed=<span class="string">&#x27;right&#x27;</span>).<span class="built_in">sum</span>()</span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">2000-01-01 00:00:00     0</span></span><br><span class="line"><span class="string">2000-01-01 00:03:00     6</span></span><br><span class="line"><span class="string">2000-01-01 00:06:00    15</span></span><br><span class="line"><span class="string">2000-01-01 00:09:00    15</span></span><br><span class="line"><span class="string">Freq: 3T, dtype: int64</span></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line">start, end = <span class="string">&#x27;2000-10-01 23:30:00&#x27;</span>, <span class="string">&#x27;2000-10-02 00:30:00&#x27;</span></span><br><span class="line">rng = pd.date_range(start, end, freq=<span class="string">&#x27;7min&#x27;</span>)</span><br><span class="line">ts = pd.Series(np.arange(<span class="built_in">len</span>(rng)) * <span class="number">3</span>, index=rng)</span><br><span class="line">ts</span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">2000-10-01 23:30:00     0</span></span><br><span class="line"><span class="string">2000-10-01 23:37:00     3</span></span><br><span class="line"><span class="string">2000-10-01 23:44:00     6</span></span><br><span class="line"><span class="string">2000-10-01 23:51:00     9</span></span><br><span class="line"><span class="string">2000-10-01 23:58:00    12</span></span><br><span class="line"><span class="string">2000-10-02 00:05:00    15</span></span><br><span class="line"><span class="string">2000-10-02 00:12:00    18</span></span><br><span class="line"><span class="string">2000-10-02 00:19:00    21</span></span><br><span class="line"><span class="string">2000-10-02 00:26:00    24</span></span><br><span class="line"><span class="string">Freq: 7T, dtype: int64</span></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line">ts.resample(<span class="string">&#x27;17min&#x27;</span>).<span class="built_in">sum</span>()</span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">2000-10-01 23:14:00     0</span></span><br><span class="line"><span class="string">2000-10-01 23:31:00     9</span></span><br><span class="line"><span class="string">2000-10-01 23:48:00    21</span></span><br><span class="line"><span class="string">2000-10-02 00:05:00    54</span></span><br><span class="line"><span class="string">2000-10-02 00:22:00    24</span></span><br><span class="line"><span class="string">Freq: 17T, dtype: int64</span></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line">ts.resample(<span class="string">&#x27;17min&#x27;</span>, offset=<span class="string">&#x27;2min&#x27;</span>).<span class="built_in">sum</span>()</span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">2000-10-01 23:16:00     0</span></span><br><span class="line"><span class="string">2000-10-01 23:33:00     9</span></span><br><span class="line"><span class="string">2000-10-01 23:50:00    36</span></span><br><span class="line"><span class="string">2000-10-02 00:07:00    39</span></span><br><span class="line"><span class="string">2000-10-02 00:24:00    24</span></span><br><span class="line"><span class="string">Freq: 17T, dtype: int64</span></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line">ts.resample(<span class="string">&#x27;17min&#x27;</span>, origin=<span class="string">&#x27;start&#x27;</span>).<span class="built_in">sum</span>()</span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">2000-10-01 23:30:00     9</span></span><br><span class="line"><span class="string">2000-10-01 23:47:00    21</span></span><br><span class="line"><span class="string">2000-10-02 00:04:00    54</span></span><br><span class="line"><span class="string">2000-10-02 00:21:00    24</span></span><br><span class="line"><span class="string">Freq: 17T, dtype: int64</span></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br></pre></td></tr></table></figure><br />
<code>Series/DataFrame.shift(periods=1, freq=None, axis=0, fill_value=&lt;object object&gt;)</code>：迁移数据/索引，前移或者后移操作。<br />
（1）periods:一个整数（可以为负的），指定移动的数量。对于时间序列，单位由freq指定。<br />
（2）freq：一个DateOffset/timedelta或者一个频率字符串。指定移动的单位。注意，如果为PeriodIndex，则freq必须和它匹配。<br />
（3）axis：为0/'index'表示沿着0轴移动；为1/'columns'表示沿着1轴移动。<br />
（4）fill_value：缺失值填充。<br />
如果有freq（periods必须有），就是针对时间序列索引的迁移，Series/DataFrame的值不变。<br />
对于非时间序列、没有freq只有periods，就是移动Series/DataFrame的值。默认方式。<br />
tshift()方法只是迁移时间索引的，默认向后迁移。<br />
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br></pre></td><td class="code"><pre><span class="line">df = pd.DataFrame(&#123;<span class="string">&quot;Col1&quot;</span>: [<span class="number">10</span>, <span class="number">20</span>, <span class="number">15</span>, <span class="number">30</span>, <span class="number">45</span>],</span><br><span class="line">                   <span class="string">&quot;Col2&quot;</span>: [<span class="number">13</span>, <span class="number">23</span>, <span class="number">18</span>, <span class="number">33</span>, <span class="number">48</span>],</span><br><span class="line">                   <span class="string">&quot;Col3&quot;</span>: [<span class="number">17</span>, <span class="number">27</span>, <span class="number">22</span>, <span class="number">37</span>, <span class="number">52</span>]&#125;,</span><br><span class="line">                  index=pd.date_range(<span class="string">&quot;2020-01-01&quot;</span>, <span class="string">&quot;2020-01-05&quot;</span>))</span><br><span class="line">d</span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">            Col1  Col2  Col3</span></span><br><span class="line"><span class="string">2020-01-01    10    13    17</span></span><br><span class="line"><span class="string">2020-01-02    20    23    27</span></span><br><span class="line"><span class="string">2020-01-03    15    18    22</span></span><br><span class="line"><span class="string">2020-01-04    30    33    37</span></span><br><span class="line"><span class="string">2020-01-05    45    48    52</span></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="comment"># 默认数据向后迁移</span></span><br><span class="line">df.shift(periods=<span class="number">3</span>)</span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">            Col1  Col2  Col3</span></span><br><span class="line"><span class="string">2020-01-01   NaN   NaN   NaN</span></span><br><span class="line"><span class="string">2020-01-02   NaN   NaN   NaN</span></span><br><span class="line"><span class="string">2020-01-03   NaN   NaN   NaN</span></span><br><span class="line"><span class="string">2020-01-04  10.0  13.0  17.0</span></span><br><span class="line"><span class="string">2020-01-05  20.0  23.0  27.0</span></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line">df.shift(periods=<span class="number">1</span>, axis=<span class="string">&quot;columns&quot;</span>)</span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">            Col1  Col2  Col3</span></span><br><span class="line"><span class="string">2020-01-01   NaN    10    13</span></span><br><span class="line"><span class="string">2020-01-02   NaN    20    23</span></span><br><span class="line"><span class="string">2020-01-03   NaN    15    18</span></span><br><span class="line"><span class="string">2020-01-04   NaN    30    33</span></span><br><span class="line"><span class="string">2020-01-05   NaN    45    48</span></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line">df.shift(periods=<span class="number">3</span>, fill_value=<span class="number">0</span>)</span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">            Col1  Col2  Col3</span></span><br><span class="line"><span class="string">2020-01-01     0     0     0</span></span><br><span class="line"><span class="string">2020-01-02     0     0     0</span></span><br><span class="line"><span class="string">2020-01-03     0     0     0</span></span><br><span class="line"><span class="string">2020-01-04    10    13    17</span></span><br><span class="line"><span class="string">2020-01-05    20    23    27</span></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="comment"># periods为3，freq为天，两个参数针对时间序列索引</span></span><br><span class="line">df.shift(periods=<span class="number">3</span>, freq=<span class="string">&quot;D&quot;</span>)</span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">            Col1  Col2  Col3</span></span><br><span class="line"><span class="string">2020-01-04    10    13    17</span></span><br><span class="line"><span class="string">2020-01-05    20    23    27</span></span><br><span class="line"><span class="string">2020-01-06    15    18    22</span></span><br><span class="line"><span class="string">2020-01-07    30    33    37</span></span><br><span class="line"><span class="string">2020-01-08    45    48    52</span></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br></pre></td></tr></table></figure></p>
<h4 id="移动窗口">移动窗口</h4>
<p>时间序列的移动窗口上的各种统计函数是一种常见的操作。这一类函数我们称作移动窗口函数（排除了NA值）。</p>
<p>所谓移动窗口，就是两层含义：<br />
（1）窗口：统计函数作用的对象为该窗口内的数值。<br />
（2）移动：该窗口是移动的，每个窗口对应一个统计量
。最终生成一个统计量序列。</p>
<p><strong>1、计算移动窗口的平均值</strong><br />
<code>Series/DataFrame.rolling(window, min_periods=None, freq=None, center=False, win_type=None, on=None, axis=0)</code>：该方法返回一个Window对象，你可以在该对象上调用.mean()/.sum()/.agg()/.aggregate()等方法。<br />
（1）window：一个整数或者一个offset。如果是个整数，则给出了窗口的大小（窗口大小是固定的）。如果是个offset，则每个窗口对应一个时间段，因此窗口大小不固定。<br />
（2）min_periods：一个整数。给出了窗口内有效值的数量。<br />
（3）freq：一个字符串或者DateOffset对象，该参数被废弃。它用于对数据重采样，因为我们一般使用resample()来完成，所以该参数被废弃。<br />
（4）center：一个布尔值。如果为True，则聚合结果的label为窗口的中心点的索引。默认情况下，聚合结果的label为窗口的最右点的索引。（因为一个聚合结果对应了
window个数据，因此该聚合结果可选的索引可以从这些数据的索引中选取）。<br />
（5）win_type：一个字符串，给出了窗口类型。<br />
（6）on：一个字符串。对于DataFrame，它指定在哪一column上进行移动平均。否则是index。<br />
（7）axis：一个整数。指定沿着0轴还是1轴移动平均。如果为0/'index'则沿着0轴；如果为1/'columns'则沿着0轴。<br />
窗口类型可为：'boxcar'/'triang'/'blackman'/'hamming'/'bartlett'/'parzen'/'bohman'/'blackmanharris'/'nuttall'/'barthann'/'kaiser'（需要beta参数），该参数由后面的.mean()等方法给出/'guassian'（需要std参数），该参数由后面的.mean()等方法给出/'general_gaussian'（需要power,width参数），该参数由后面的.mean()等方法给出/'slepian'（需要width参数），该参数由后面的.mean()等方法给出。<br />
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br></pre></td><td class="code"><pre><span class="line">df = pd.DataFrame(&#123;<span class="string">&#x27;B&#x27;</span>: [<span class="number">0</span>, <span class="number">1</span>, <span class="number">2</span>, np.nan, <span class="number">4</span>]&#125;)</span><br><span class="line">df</span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">     B</span></span><br><span class="line"><span class="string">0  0.0</span></span><br><span class="line"><span class="string">1  1.0</span></span><br><span class="line"><span class="string">2  2.0</span></span><br><span class="line"><span class="string">3  NaN</span></span><br><span class="line"><span class="string">4  4.0</span></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line">df.rolling(<span class="number">2</span>, win_type=<span class="string">&#x27;triang&#x27;</span>).<span class="built_in">sum</span>()</span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">     B</span></span><br><span class="line"><span class="string">0  NaN</span></span><br><span class="line"><span class="string">1  0.5</span></span><br><span class="line"><span class="string">2  1.5</span></span><br><span class="line"><span class="string">3  NaN</span></span><br><span class="line"><span class="string">4  NaN</span></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line">df.rolling(<span class="number">2</span>, win_type=<span class="string">&#x27;gaussian&#x27;</span>).<span class="built_in">sum</span>(std=<span class="number">3</span>)</span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">          B</span></span><br><span class="line"><span class="string">0       NaN</span></span><br><span class="line"><span class="string">1  0.986207</span></span><br><span class="line"><span class="string">2  2.958621</span></span><br><span class="line"><span class="string">3       NaN</span></span><br><span class="line"><span class="string">4       NaN</span></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line">df = pd.DataFrame(&#123;<span class="string">&#x27;B&#x27;</span>: [<span class="number">0</span>, <span class="number">1</span>, <span class="number">2</span>, np.nan, <span class="number">4</span>]&#125;,</span><br><span class="line">                  index = [pd.Timestamp(<span class="string">&#x27;20130101 09:00:00&#x27;</span>),</span><br><span class="line">                           pd.Timestamp(<span class="string">&#x27;20130101 09:00:02&#x27;</span>),</span><br><span class="line">                           pd.Timestamp(<span class="string">&#x27;20130101 09:00:03&#x27;</span>),</span><br><span class="line">                           pd.Timestamp(<span class="string">&#x27;20130101 09:00:05&#x27;</span>),</span><br><span class="line">                           pd.Timestamp(<span class="string">&#x27;20130101 09:00:06&#x27;</span>)])</span><br><span class="line">df</span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">                       B</span></span><br><span class="line"><span class="string">2013-01-01 09:00:00  0.0</span></span><br><span class="line"><span class="string">2013-01-01 09:00:02  1.0</span></span><br><span class="line"><span class="string">2013-01-01 09:00:03  2.0</span></span><br><span class="line"><span class="string">2013-01-01 09:00:05  NaN</span></span><br><span class="line"><span class="string">2013-01-01 09:00:06  4.0</span></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="comment"># 窗口大小为2s</span></span><br><span class="line">df.rolling(<span class="string">&#x27;2s&#x27;</span>).<span class="built_in">sum</span>()</span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">                       B</span></span><br><span class="line"><span class="string">2013-01-01 09:00:00  0.0</span></span><br><span class="line"><span class="string">2013-01-01 09:00:02  1.0</span></span><br><span class="line"><span class="string">2013-01-01 09:00:03  3.0</span></span><br><span class="line"><span class="string">2013-01-01 09:00:05  NaN</span></span><br><span class="line"><span class="string">2013-01-01 09:00:06  4.0</span></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br></pre></td></tr></table></figure><br />
扩展窗口<code>expanding()</code>：当窗口大小等于序列长度，窗口中数据有空缺，则剔除空缺值再计算。<br />
计算移动窗口的指数加权平均值<code>ewm()</code>等等。</p>
<h2 id="pandas绘图">Pandas绘图</h2>
<p>matplotlib是Pandas绘图使用的底层工具，pandas中有许多利用DataFrame对象数据组织特点来创建标准图表的高级绘图方法。<br />
Series/DataFrame.plot()：绘制图形。它们返回的是AxesSubplot对象，或者AxesSubplot的ndarrays。<br />
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br></pre></td><td class="code"><pre><span class="line">Series.plot(kind=<span class="string">&#x27;line&#x27;</span>, ax=<span class="literal">None</span>, figsize=<span class="literal">None</span>, use_index=<span class="literal">True</span>, title=<span class="literal">None</span>, grid=<span class="literal">None</span>,</span><br><span class="line">  legend=<span class="literal">False</span>, style=<span class="literal">None</span>, logx=<span class="literal">False</span>, logy=<span class="literal">False</span>,loglog=<span class="literal">False</span>,xticks=<span class="literal">None</span>,yticks=<span class="literal">None</span>,</span><br><span class="line">  xlim=<span class="literal">None</span>, ylim=<span class="literal">None</span>, rot=<span class="literal">None</span>, fontsize=<span class="literal">None</span>, colormap=<span class="literal">None</span>, table=<span class="literal">False</span>, yerr=<span class="literal">None</span>, </span><br><span class="line">  xerr=<span class="literal">None</span>, label=<span class="literal">None</span>, secondary_y=<span class="literal">False</span>, **kwds)</span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">kind：绘制的类型。可以为：&#x27;line&#x27;、&#x27;bar&#x27;、&#x27;barh&#x27;（水平的bar）、&#x27;hist&#x27;、&#x27;box&#x27;、&#x27;kde&#x27;（核密度估计）、&#x27;density&#x27;（类似kde）、&#x27;area&#x27;、&#x27;pie&#x27; </span></span><br><span class="line"><span class="string">ax：一个Axes实例对象。如果为空，则是plt.gca()的返回值（当前Axes）</span></span><br><span class="line"><span class="string">figsize：一个元组，指定图片大小（单位为英寸）</span></span><br><span class="line"><span class="string">use_index：一个布尔值。如果为True，则使用index作为X轴。</span></span><br><span class="line"><span class="string">title：图形的标题</span></span><br><span class="line"><span class="string">grid：一个布尔值。如果为True，则开启网格</span></span><br><span class="line"><span class="string">legend：一个布尔值，如果为True，则放置图例</span></span><br><span class="line"><span class="string">style：一个列表或者字典，给出了每一列的线型</span></span><br><span class="line"><span class="string">logx：一个布尔值，如果为True，则x轴为对数型</span></span><br><span class="line"><span class="string">logy：一个布尔值，如果为True，则y轴为对数型</span></span><br><span class="line"><span class="string">loglog：一个布尔值，如果为True，则x轴和y轴都为对数型</span></span><br><span class="line"><span class="string">xticks：一个序列，用于给出xticks</span></span><br><span class="line"><span class="string">yticks：一个序列，用于给出yticks</span></span><br><span class="line"><span class="string">xlim：一个二元的元组或者序列，给出x轴范围</span></span><br><span class="line"><span class="string">ylim：一个二元的元组或者序列，给出y轴范围</span></span><br><span class="line"><span class="string">rot：一个整数，给出了x轴和y轴tick旋转角度（不是弧度）。</span></span><br><span class="line"><span class="string">fontsize：一个整数，给出了xtick/ytick的字体大小</span></span><br><span class="line"><span class="string">colormap：一个字符串或者colormap对象，给出了colormap</span></span><br><span class="line"><span class="string">colorbar：一个布尔值。如果为True，则绘制colorbar（只用于scatter和hexbin图中）</span></span><br><span class="line"><span class="string">position：一个浮点数。给出了bar图中，各bar的对其位置（0表示bar的左侧与它的坐标 对其；1表示bar的右侧与它的坐标对其）</span></span><br><span class="line"><span class="string">layout：一个元组。给出了(rows,columns)</span></span><br><span class="line"><span class="string">table：一个布尔值或者Series/DataFrame。如果为True，则将本Series/DataFrame绘制为一个表格；如果为Series/DataFrame，则将该参数绘制为表格</span></span><br><span class="line"><span class="string">yerr：用于绘制Error Bar</span></span><br><span class="line"><span class="string">xerr：用于绘制Error Bar</span></span><br><span class="line"><span class="string">label：plot的label参数</span></span><br><span class="line"><span class="string">secondary_y：一个布尔值或者一个整数序列。如果为True，则y轴绘制在右侧</span></span><br><span class="line"><span class="string">mark_right：一个布尔值，如果为True且secondary_y=True，则在图例中标记为right</span></span><br><span class="line"><span class="string">kwds：传递给matplotlib中的plot函数的其他关键字参数</span></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line">DataFrame.plot(x=<span class="literal">None</span>, y=<span class="literal">None</span>, kind=<span class="string">&#x27;line&#x27;</span>, ax=<span class="literal">None</span>, subplots=<span class="literal">False</span>, sharex=<span class="literal">None</span>, </span><br><span class="line">  sharey=<span class="literal">False</span>, layout=<span class="literal">None</span>, figsize=<span class="literal">None</span>, use_index=<span class="literal">True</span>, title=<span class="literal">None</span>, grid=<span class="literal">None</span>, </span><br><span class="line">  legend=<span class="literal">True</span>, style=<span class="literal">None</span>, logx=<span class="literal">False</span>, logy=<span class="literal">False</span>, loglog=<span class="literal">False</span>, xticks=<span class="literal">None</span>, </span><br><span class="line">  yticks=<span class="literal">None</span>, xlim=<span class="literal">None</span>, ylim=<span class="literal">None</span>, rot=<span class="literal">None</span>, fontsize=<span class="literal">None</span>, colormap=<span class="literal">None</span>,</span><br><span class="line">  table=<span class="literal">False</span>, yerr=<span class="literal">None</span>, xerr=<span class="literal">None</span>, secondary_y=<span class="literal">False</span>, sort_columns=<span class="literal">False</span>, **kwds)</span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">x：label或者position</span></span><br><span class="line"><span class="string">y： label或者position</span></span><br><span class="line"><span class="string">subplots：一个布尔值，如果为True，则将每一列作为一个子图来绘制</span></span><br><span class="line"><span class="string">sharex：一个布尔值。如果为True，且subplots=True，则子图共享x轴</span></span><br><span class="line"><span class="string">sharey：一个布尔值。如果为True，且subplots=True，则子图共享y轴</span></span><br><span class="line"><span class="string">stacked：一个布尔值。在bar中，如果为True，则将柱状图堆积起来</span></span><br><span class="line"><span class="string">sort_columns：一个布尔值。如果为True，则根据列名来决定绘制的先后顺序。</span></span><br><span class="line"><span class="string">其他参数同Series.plot。</span></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br></pre></td></tr></table></figure><br />
除了画图，数据显示的样式也可以进行“美颜”，这里不进行展示了，可参考<span class="exturl" data-url="aHR0cHM6Ly9wYW5kYXMucHlkYXRhLm9yZy9wYW5kYXMtZG9jcy9zdGFibGUvdXNlcl9ndWlkZS9zdHlsZS5odG1s">Styling<i class="fa fa-external-link-alt"></i></span>和<span class="exturl" data-url="aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L2xlbW9uYml0L2FydGljbGUvZGV0YWlscy8xMDc1MDI3NzQ=">数据表格美颜<i class="fa fa-external-link-alt"></i></span>。</p>
<p><strong>1、Pandas画图part1</strong><br />
<iframe src="https://nbviewer.jupyter.org/github/soundmemories/StudyNotes/blob/cc4141f7491403a41ac738dba7695d7aaeda9c07/Cheatsheets/Pandas_visualization_part1.ipynb" width="1000" height="800"></iframe></p>
<p><strong>2、Pandas画图part2</strong><br />
<iframe src="https://nbviewer.jupyter.org/github/soundmemories/StudyNotes/blob/cc4141f7491403a41ac738dba7695d7aaeda9c07/Cheatsheets/Pandas_visualization_part2.ipynb" width="1000" height="800"></iframe></p>
<h2 id="pandas文件操作">Pandas文件操作</h2>
<p><strong>1、CSV</strong><br />
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br></pre></td><td class="code"><pre><span class="line">pandas.read_csv(</span><br><span class="line">    filepath_or_buffer: <span class="type">Union</span>[<span class="built_in">str</span>, pathlib.Path, IO[~AnyStr]], <span class="comment">#文件地址，可以是URL。</span></span><br><span class="line">    sep=<span class="string">&#x27;,&#x27;</span>, <span class="comment">#指定分隔符。如果不指定参数，则会尝试使用逗号分隔。</span></span><br><span class="line">    delimiter=<span class="literal">None</span>, <span class="comment">#定界符，备选分隔符（如果指定该参数，则sep参数失效）</span></span><br><span class="line">    header=<span class="string">&#x27;infer&#x27;</span>, <span class="comment">#指定行用来作为列名，数据开始行数。如果文件中没有列名，则默认为0，否则设置为None，也可以用列表。注意：如果skip_blank_lines=True 那么header参数忽略注释行和空行，所以header=0表示第一行数据而不是文件的第一行。</span></span><br><span class="line">    names=<span class="literal">None</span>, <span class="comment">#用于结果的列名列表，如果数据文件中没有列标题行，就需要执行header=None。默认列表中不能出现重复，除非设定参数mangle_dupe_cols=True。</span></span><br><span class="line">    index_col=<span class="literal">None</span>, <span class="comment">#用作行索引的列编号或者列名，如果给定一个序列则有多个行索引。</span></span><br><span class="line">    usecols=<span class="literal">None</span>, <span class="comment">#返回一个数据子集，该列表中的值必须可以对应到文件中的位置（数字可以对应到指定的列）或者是字符传为文件中的列名。例如：usecols有效参数可能是 [0,1,2]或者是 [‘foo’, ‘bar’, ‘baz’]。使用这个参数可以加快加载速度并降低内存消耗。</span></span><br><span class="line">    squeeze=<span class="literal">False</span>, <span class="comment">#如果文件值包含一列，则返回一个Series</span></span><br><span class="line">    prefix=<span class="literal">None</span>, <span class="comment">#在没有列标题时，给列添加前缀。例如：添加‘X’ 成为 X0, X1, ...</span></span><br><span class="line">    mangle_dupe_cols=<span class="literal">True</span>, <span class="comment">#重复的列，将‘X’...’X’表示为‘X.0’...’X.N’。如果设定为false则会将所有重名列覆盖。</span></span><br><span class="line">    dtype=<span class="literal">None</span>, <span class="comment">#每列数据的数据类型。</span></span><br><span class="line">    engine=<span class="literal">None</span>, <span class="comment">#使用的分析引擎。可以选择C或者是python。C引擎快但是Python引擎功能更加完备。</span></span><br><span class="line">    converters=<span class="literal">None</span>, <span class="comment">#列转换函数的字典。key可以是列名或者列的序号。</span></span><br><span class="line">    true_values=<span class="literal">None</span>, </span><br><span class="line">    false_values=<span class="literal">None</span>, </span><br><span class="line">    skipinitialspace=<span class="literal">False</span>, <span class="comment">#忽略分隔符后的空白（默认为False，即不忽略）.</span></span><br><span class="line">    skiprows=<span class="literal">None</span>, <span class="comment">#需要忽略的行数（从文件开始处算起），或需要跳过的行号列表（从0开始）。</span></span><br><span class="line">    skipfooter=<span class="number">0</span>, <span class="comment">#从文件尾部开始忽略。 (c引擎不支持)</span></span><br><span class="line">    nrows=<span class="literal">None</span>, <span class="comment">#需要读取的行数（从文件头开始算起）。</span></span><br><span class="line">    na_values=<span class="literal">None</span>, <span class="comment">#一组用于替换NA/NaN的值。如果传参，需要制定特定列的空值。</span></span><br><span class="line">    keep_default_na=<span class="literal">True</span>, <span class="comment">#如果指定na_values参数，并且keep_default_na=False，那么默认的NaN将被覆盖，否则添加。</span></span><br><span class="line">    na_filter=<span class="literal">True</span>, <span class="comment">#是否检查丢失值（空字符串或者是空值）。对于大文件来说数据集中没有空值，设定na_filter=False可以提升读取速度</span></span><br><span class="line">    verbose=<span class="literal">False</span>, <span class="comment">#是否打印各种解析器的输出信息，例如：“非数值列中缺失值的数量”等。</span></span><br><span class="line">    skip_blank_lines=<span class="literal">True</span>, <span class="comment">#如果为True，则跳过空行；否则记为NaN。</span></span><br><span class="line">    parse_dates=<span class="literal">False</span>, <span class="comment">#boolean. True -&gt; 解析索引；If [1, 2, 3] -&gt; 解析1,2,3列的值作为独立的日期列；If [[1, 3]] -&gt; 合并1,3列作为一个日期列使用；&#123;‘foo’ : [1, 3]&#125; -&gt; 将1,3列合并，并给合并后的列起名为&quot;foo&quot;。</span></span><br><span class="line">    infer_datetime_format=<span class="literal">False</span>, <span class="comment">#如果设定为True并且parse_dates 可用，那么pandas将尝试转换为日期类型，如果可以转换，转换方法并解析。在某些情况下会快5~10倍。</span></span><br><span class="line">    keep_date_col=<span class="literal">False</span>, <span class="comment">#如果连接多列解析日期，则保持参与连接的列。默认为False。</span></span><br><span class="line">    date_parser=<span class="literal">None</span>, <span class="comment">#用于解析日期的函数，默认使用dateutil.parser.parser来做转换。每行调用一次date_parser函数来解析一个或者多个字符串（由parse_dates指定）作为参数。</span></span><br><span class="line">    dayfirst=<span class="literal">False</span>, <span class="comment">#DD/MM格式的日期类型</span></span><br><span class="line">    cache_dates=<span class="literal">True</span>, </span><br><span class="line">    iterator=<span class="literal">False</span>, <span class="comment">#返回一个TextFileReader 对象，以便逐块处理文件。</span></span><br><span class="line">    chunksize=<span class="literal">None</span>, <span class="comment">#文件块的大小</span></span><br><span class="line">    compression=<span class="string">&#x27;infer&#x27;</span>, <span class="comment">#直接使用磁盘上的压缩文件。如果使用infer参数，则使用 gzip, bz2, zip或者解压文件名中以‘.gz’, ‘.bz2’, ‘.zip’, or ‘xz’这些为后缀的文件，否则不解压。如果使用zip，那么ZIP包中国必须只包含一个文件。设置为None则不解压。</span></span><br><span class="line">    thousands=<span class="literal">None</span>, <span class="comment">#千分位分割符，如“，”或者“.&quot;</span></span><br><span class="line">    decimal=<span class="string">b&#x27;.&#x27;</span>, <span class="comment">#字符中的小数点</span></span><br><span class="line">    lineterminator=<span class="literal">None</span>, <span class="comment">#行分割符，只在C解析器下使用。</span></span><br><span class="line">    quotechar=<span class="string">&#x27;&quot;&#x27;</span>, <span class="comment">#引号，用作标识开始和解释的字符，引号内的分割符将被忽略。</span></span><br><span class="line">    quoting=<span class="number">0</span>, <span class="comment">#控制csv中的引号常量。</span></span><br><span class="line">    doublequote=<span class="literal">True</span>, <span class="comment">#双引号，当单引号已经被定义，并且quoting 参数不是QUOTE_NONE的时候，使用双引号表示引号内的元素作为一个元素使用。</span></span><br><span class="line">    escapechar=<span class="literal">None</span>, </span><br><span class="line">    comment=<span class="literal">None</span>, <span class="comment">#标识着多余的行不被解析。如果该字符出现在行首，这一行将被全部忽略。</span></span><br><span class="line">    encoding=<span class="literal">None</span>, <span class="comment">#指定字符集类型，通常指定为&#x27;utf-8&#x27;. </span></span><br><span class="line">    dialect=<span class="literal">None</span>, </span><br><span class="line">    error_bad_lines=<span class="literal">True</span>, <span class="comment">#如果一行包含太多的列，那么默认不会返回DataFrame ，如果设置成false，那么会将改行剔除（只能在C解析器下使用）。</span></span><br><span class="line">    warn_bad_lines=<span class="literal">True</span>, <span class="comment">#如果error_bad_lines =False，并且warn_bad_lines =True 那么所有的“bad lines”将会被输出（只能在C解析器下使用）。</span></span><br><span class="line">    delim_whitespace=<span class="literal">False</span>, </span><br><span class="line">    low_memory=<span class="literal">True</span>, <span class="comment">##分块加载到内存，再低内存消耗中解析。但是可能出现类型混淆。确保类型不被混淆需要设置为False。</span></span><br><span class="line">    memory_map=<span class="literal">False</span>, <span class="comment">#如果使用的文件在内存内，那么直接map文件使用。使用这种方式可以避免文件再次进行IO操作。</span></span><br><span class="line">    float_precision=<span class="literal">None</span></span><br><span class="line">)</span><br></pre></td></tr></table></figure></p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line">Series/DataFrame.to_csv(path_or_buf=<span class="literal">None</span>, sep=<span class="string">&#x27;, &#x27;</span>, na_rep=<span class="string">&#x27;&#x27;</span>, float_format=<span class="literal">None</span>,</span><br><span class="line">  columns=<span class="literal">None</span>, header=<span class="literal">True</span>, index=<span class="literal">True</span>, index_label=<span class="literal">None</span>, mode=<span class="string">&#x27;w&#x27;</span>, </span><br><span class="line">  encoding=<span class="literal">None</span>, compression=<span class="literal">None</span>, quoting=<span class="literal">None</span>, quotechar=<span class="string">&#x27;&quot;&#x27;</span>,</span><br><span class="line">  line_terminator=<span class="string">&#x27;\n&#x27;</span>, chunksize=<span class="literal">None</span>, tupleize_cols=<span class="literal">False</span>, date_format=<span class="literal">None</span>, </span><br><span class="line">  doublequote=<span class="literal">True</span>, escapechar=<span class="literal">None</span>, decimal=<span class="string">&#x27;.&#x27;</span>)</span><br><span class="line">  Series.to_csv(path=<span class="literal">None</span>, index=<span class="literal">True</span>, sep=<span class="string">&#x27;, &#x27;</span>, na_rep=<span class="string">&#x27;&#x27;</span>, float_format=<span class="literal">None</span>, </span><br><span class="line">  header=<span class="literal">False</span>, index_label=<span class="literal">None</span>, mode=<span class="string">&#x27;w&#x27;</span>, encoding=<span class="literal">None</span>, date_format=<span class="literal">None</span>, </span><br><span class="line">  decimal=<span class="string">&#x27;.&#x27;</span>)</span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">path_or_buf：一个字符串或者file对象。指定写入的文件。如果为空，则返回一个字符串而不是写入文件</span></span><br><span class="line"><span class="string">sep：一个字符串，指定字段的分隔符</span></span><br><span class="line"><span class="string">na_rep：一个字符串，指定NaN的代表字符串</span></span><br><span class="line"><span class="string">float_format：一个字符串，指定了浮点数的格式化字符串</span></span><br><span class="line"><span class="string">columns：一个序列，指定要写入哪些列</span></span><br><span class="line"><span class="string">header：一个布尔值或者字符串列表。如果为True，则写出列名。如果为字符串列表，则它直接指定了列名的别名</span></span><br><span class="line"><span class="string">index：一个布尔值。如果为True，则输出index label</span></span><br><span class="line"><span class="string">mode：一个字符串，文件操作的读写模式。默认为&#x27;w&#x27;</span></span><br><span class="line"><span class="string">encoding：一个字符串，指定编码方式</span></span><br><span class="line"><span class="string">compression：一个字符串，指定压缩格式</span></span><br><span class="line"><span class="string">line_terminator：一个字符串，指定换行符</span></span><br><span class="line"><span class="string">chunksize：一个整数，指定了一次写入多少行</span></span><br><span class="line"><span class="string">date_format：一个字符串，给出了日期格式化字符串</span></span><br><span class="line"><span class="string">decimal：一个字符串，给出了小数点的格式</span></span><br><span class="line"><span class="string">tupleize_cols：一个布尔值。如果为True，则MultiIndex被写成list of tuples</span></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br></pre></td></tr></table></figure>
<strong>2、Excel</strong><br />
<code>read_excel()</code>读取Excel文件。需要用到第三方包xlrd/xlwt，前者读excel，后者写excel。<br />
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">pd.read_excel(io, sheetname=<span class="number">0</span>, header=<span class="number">0</span>, skiprows=<span class="literal">None</span>, skip_footer=<span class="number">0</span>,</span><br><span class="line">  index_col=<span class="literal">None</span>, names=<span class="literal">None</span>, parse_cols=<span class="literal">None</span>, parse_dates=<span class="literal">False</span>, date_parser=<span class="literal">None</span>,</span><br><span class="line">  na_values=<span class="literal">None</span>, thousands=<span class="literal">None</span>, convert_float=<span class="literal">True</span>, has_index_names=<span class="literal">None</span>,</span><br><span class="line">  converters=<span class="literal">None</span>, true_values=<span class="literal">None</span>, false_values=<span class="literal">None</span>, engine=<span class="literal">None</span>, </span><br><span class="line">  squeeze=<span class="literal">False</span>, **kwds)</span><br><span class="line"></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">io：一个字符串，或者file-like对象。如果是个字符串，则必须是个URL（其中包含了协议名，如http//,ftp//,file//等）</span></span><br><span class="line"><span class="string">sheetname：一个字符串或者整数，或者列表。它指定选取Excel文件中哪个sheet。字符串指定的是sheet名，整数指定的是sheet的位置（0为第一个sheet）</span></span><br><span class="line"><span class="string">engine：一个字符串，指定了读写Excel的引擎。可以为：io.excel.xlsx.writer、io.excel.xls.writer、io.excel.xlsm.writer、</span></span><br><span class="line"><span class="string">其他参数参考read_csv</span></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br></pre></td></tr></table></figure><br />
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">DataFrame.to_excel(excel_writer, sheet_name=<span class="string">&#x27;Sheet1&#x27;</span>, na_rep=<span class="string">&#x27;&#x27;</span>, </span><br><span class="line">  float_format=<span class="literal">None</span>, columns=<span class="literal">None</span>, header=<span class="literal">True</span>, index=<span class="literal">True</span>, index_label=<span class="literal">None</span>, </span><br><span class="line">  startrow=<span class="number">0</span>, startcol=<span class="number">0</span>, engine=<span class="literal">None</span>, merge_cells=<span class="literal">True</span>, encoding=<span class="literal">None</span>, </span><br><span class="line">  inf_rep=<span class="string">&#x27;inf&#x27;</span>, verbose=<span class="literal">True</span>)</span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">excel_writer：一个字符串（文件名）或者一个ExcelWriter对象</span></span><br><span class="line"><span class="string">sheet_name：一个字符串，指定sheet名</span></span><br><span class="line"><span class="string">na_rep：一个字符串，代表NaN</span></span><br><span class="line"><span class="string">startrow/startcol：指定了左上角的单元格的位置</span></span><br><span class="line"><span class="string">engine：一个字符串，指定了读写Excel的引擎。可以为：io.excel.xlsx.writer、io.excel.xls.writer、io.excel.xlsm.writer、</span></span><br><span class="line"><span class="string">merge_cells：一个布尔值。如果为True，则多级索引中，某些索引会合并单元格</span></span><br><span class="line"><span class="string">inf_rep：一个字符串，只代表无穷大。</span></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br></pre></td></tr></table></figure><br />
<strong>3、html</strong><br />
<code>read_html()</code>可以将HTML中的
<table>
</table>
<p>解析为一个DataFrame列表。<br />
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"> pd.read_html(io, <span class="keyword">match</span>=<span class="string">&#x27;.+&#x27;</span>, flavor=<span class="literal">None</span>, header=<span class="literal">None</span>, index_col=<span class="literal">None</span>, </span><br><span class="line">  skiprows=<span class="literal">None</span>, attrs=<span class="literal">None</span>, parse_dates=<span class="literal">False</span>, tupleize_cols=<span class="literal">False</span>, </span><br><span class="line">  thousands=<span class="string">&#x27;, &#x27;</span>, encoding=<span class="literal">None</span>, decimal=<span class="string">&#x27;.&#x27;</span>, converters=<span class="literal">None</span>, </span><br><span class="line">  na_values=<span class="literal">None</span>, keep_default_na=<span class="literal">True</span>)</span><br><span class="line"></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">io：为一个字符串或者一个file-like对象。</span></span><br><span class="line"><span class="string">match：一个字符串或者正则表达式。HTML中的&lt;table&gt;&lt;/table&gt;中，只要匹配这个正则表达式的表格都被处理。默认的为匹配任何非空的表格</span></span><br><span class="line"><span class="string">flavor：一个字符串，指定了解析引擎。可以为&#x27;bs4&#x27;或者&#x27;html5lib&#x27;或者&#x27;lxml&#x27;</span></span><br><span class="line"><span class="string">attrs：一个字典。它筛选出你要解析哪些表格</span></span><br><span class="line"><span class="string">其他参数参考read_csv</span></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br></pre></td></tr></table></figure><br />
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"> DataFrame.to_html(buf=<span class="literal">None</span>, columns=<span class="literal">None</span>, col_space=<span class="literal">None</span>, header=<span class="literal">True</span>,</span><br><span class="line">  index=<span class="literal">True</span>, na_rep=<span class="string">&#x27;NaN&#x27;</span>, formatters=<span class="literal">None</span>, float_format=<span class="literal">None</span>, </span><br><span class="line">  sparsify=<span class="literal">None</span>, index_names=<span class="literal">True</span>, justify=<span class="literal">None</span>, bold_rows=<span class="literal">True</span>, </span><br><span class="line">  classes=<span class="literal">None</span>, escape=<span class="literal">True</span>, max_rows=<span class="literal">None</span>, max_cols=<span class="literal">None</span>, show_dimensions=<span class="literal">False</span>, </span><br><span class="line">  notebook=<span class="literal">False</span>, decimal=<span class="string">&#x27;.&#x27;</span>, border=<span class="literal">None</span>)</span><br><span class="line"></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">bold_rows：一个布尔值。如果为True，则让row label加粗</span></span><br><span class="line"><span class="string">classes：一个字符串或者列表或者元组，给出了table的css class</span></span><br><span class="line"><span class="string">escape：一个布尔值，如果为True，则将字符&lt;&gt;&amp;为安全的HTML字符</span></span><br><span class="line"><span class="string">max_rows：一个整数，指定最大输出行数。默认显示全部的行</span></span><br><span class="line"><span class="string">decimal：一个字符串，指定了小数点的格式</span></span><br><span class="line"><span class="string">border：一个整数，给出了border属性的值。</span></span><br><span class="line"><span class="string">buf：指定将HTML写到哪里，它是一个StringIO-like对象</span></span><br><span class="line"><span class="string">col_space：一个整数，给出每一列最小宽度</span></span><br><span class="line"><span class="string">header：一个布尔值，如果为True，则打印列名</span></span><br><span class="line"><span class="string">columns：一个序列，指定要输出哪些列</span></span><br><span class="line"><span class="string">index：一个布尔值，如果为True，则打印index labels</span></span><br><span class="line"><span class="string">formatters：一个一元函数的列表，或者一元函数的字典。给出了每一列的转换成字符串的函数</span></span><br><span class="line"><span class="string">float_format：一个一元函数，给出了浮点数转换成字符串的函数</span></span><br><span class="line"><span class="string">justify：左对齐还是右对齐。可以为&#x27;left&#x27;/&#x27;right&#x27;</span></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br></pre></td></tr></table></figure><br />
<strong>4、Json</strong><br />
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line">pd.read_json(path_or_buf=<span class="literal">None</span>, orient=<span class="literal">None</span>, typ=<span class="string">&#x27;frame&#x27;</span>, dtype=<span class="literal">True</span>, </span><br><span class="line">  convert_axes=<span class="literal">True</span>, convert_dates=<span class="literal">True</span>, keep_default_dates=<span class="literal">True</span>, numpy=<span class="literal">False</span>,</span><br><span class="line">  precise_float=<span class="literal">False</span>, date_unit=<span class="literal">None</span>, encoding=<span class="literal">None</span>, lines=<span class="literal">False</span>)</span><br><span class="line"></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">path_or_buf：一个字符串或者一个file-like对象。如果是个字符串，则必须是个URL（其中包含了协议名，如http//,ftp//,file//等）</span></span><br><span class="line"><span class="string">orient：一个字符串，指定了期望的JSON格式。可选的格式有（参考to_json的实例）：</span></span><br><span class="line"><span class="string">    &#x27;split&#x27;：JSON是个类似字典的格式：&#123;index -&gt; [index], columns -&gt; [columns], data -&gt; [values]&#125;</span></span><br><span class="line"><span class="string">    &#x27;records&#x27;：JSON 是个类似列表的格式：[&#123;column -&gt; value&#125;, ... , &#123;column -&gt; value&#125;]</span></span><br><span class="line"><span class="string">    &#x27;index&#x27;： JSON是个类似字典的格式&#123;index -&gt; &#123;column -&gt; value&#125;&#125;</span></span><br><span class="line"><span class="string">        &#x27;columns&#x27;：JSON 是个类似字典的格式&#123;column -&gt; &#123;index -&gt; value&#125;&#125;</span></span><br><span class="line"><span class="string">&#x27;values&#x27;：JSON就是值的序列</span></span><br><span class="line"><span class="string">        如果type==&#x27;series&#x27;，则允许的&#x27;orients= &#123;&#x27;split&#x27;,&#x27;records&#x27;,&#x27;index&#x27;&#125;，默认为&#x27;index&#x27;，且如果为&#x27;index&#x27;，则要求索引为唯一的。</span></span><br><span class="line"><span class="string">        如果type==&#x27;frame&#x27;，则允许上所有的格式，默认为&#x27;columns&#x27;，且如果为&#x27;index&#x27;/&#x27;columns&#x27;，则要求DataFrame.index为唯一的；</span></span><br><span class="line"><span class="string">        如果&#x27;index&#x27;/&#x27;columns&#x27;/&#x27;records&#x27;，则要求DataFrame.columns为唯一的。</span></span><br><span class="line"><span class="string">typ：一个字符串，指定将JSON转换为Series/DataFrame那一种。可以为&#x27;series&#x27;，&#x27;frame&#x27;</span></span><br><span class="line"><span class="string">dtype：一个布尔值或者字典。如果为True，则自动推断数值类型。如果为False，则不推断类型。如果为字典，则给出了每一列的数值类型</span></span><br><span class="line"><span class="string">convert_axes：一个布尔值，如果为True，则试图转换到合适的数值类型</span></span><br><span class="line"><span class="string">convert_dates：一个布尔值，如果为True，则试图转换日期列为日期。它转换下面这些列名的列：列名以&#x27;_at&#x27;/&#x27;_time&#x27;结束、列名以&#x27;timestamp&#x27;开始、列名为&#x27;mofified&#x27;/&#x27;date&#x27;</span></span><br><span class="line"><span class="string">keep_default_dates：一个布尔值。如果为True，则当转换日期列时，保留原列</span></span><br><span class="line"><span class="string">numpy：一个布尔值，如果为True，则直接转换为ndarray</span></span><br><span class="line"><span class="string">precise_float：一个布尔值，如果为True，则使用解析为更高精度的浮点数</span></span><br><span class="line"><span class="string">date_unit：一个字符串。用于转换时间戳到日期。它提供时间戳的单位，如&#x27;s&#x27;/&#x27;ms&#x27;</span></span><br><span class="line"><span class="string">lines：一个布尔值。如果为True，则读取文件的每一行作为一个JSON</span></span><br><span class="line"><span class="string">encoding：一个字符串，指定编码方式</span></span><br></pre></td></tr></table></figure><br />
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">Series/DataFrame.to_json(path_or_buf=<span class="literal">None</span>, orient=<span class="literal">None</span>, date_format=<span class="string">&#x27;epoch&#x27;</span>,</span><br><span class="line">  double_precision=<span class="number">10</span>, force_ascii=<span class="literal">True</span>, date_unit=<span class="string">&#x27;ms&#x27;</span>, default_handler=<span class="literal">None</span>, </span><br><span class="line">  lines=<span class="literal">False</span>)</span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">path_or_buf：指定保存的地方。如果为None，则该函数返回一个StringIO对象</span></span><br><span class="line"><span class="string">orient参数：参考read_json()</span></span><br><span class="line"><span class="string">date_format：一个字符串，指定日期转换格式。可以为&#x27;epoch&#x27;（从1970-1-1日以来的毫秒数）、&#x27;iso&#x27;</span></span><br><span class="line"><span class="string">double_precision：一个整数，指定了浮点数的精度</span></span><br><span class="line"><span class="string">force_ascii：一个布尔值，如果为True，则将encoded string转换成ASCII</span></span><br><span class="line"><span class="string">date_unit：一个字符串，参考read_json</span></span><br><span class="line"><span class="string">default_handler：一个可调用对象。用于处理当对象无法转换成JSON的情况。它只有一个参数，就是被转换的对象</span></span><br><span class="line"><span class="string">lines：一个布尔值。如果orient=&#x27;records&#x27;时，输出换行符。对其他格式则抛出异常</span></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br></pre></td></tr></table></figure><br />
<strong>5、二进制</strong><br />
<code>pd.read_pickle(path)</code>：从pickle文件中读取数据，path为pickle文件的文件名。<br />
<code>Series/DataFrame.to_pickle(path)</code>：将Series/DataFrame保存到pickle文件中，path为pickle文件的文件名。</p>
<p><strong>6、SQL</strong><br />
<code>read_sql_table()</code>从指定数据表中，提取你所需要的列。<br />
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">pd.read_sql_table(table_name, con, schema=<span class="literal">None</span>, index_col=<span class="literal">None</span>,</span><br><span class="line">  coerce_float=<span class="literal">True</span>, parse_dates=<span class="literal">None</span>, columns=<span class="literal">None</span>, chunksize=<span class="literal">None</span>)</span><br><span class="line"></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">table_name：一个字符串，指定了数据库的表名</span></span><br><span class="line"><span class="string">con：一个SQLAlchemy conectable或者一个database string URI，指定了连接对象它就是SQLAlchemy中的Engine对象。</span></span><br><span class="line"><span class="string">schema：一个字符串，给出了SQL schema（在mysql中就是database）</span></span><br><span class="line"><span class="string">index_col：一个字符串或者字符串列表，指定哪一列或者哪些列作为index</span></span><br><span class="line"><span class="string">coerce_float：一个布尔值，如果为True，则试图转换结果到数值类型</span></span><br><span class="line"><span class="string">parse_dates：一个列表或者字典。指定如何解析日期：</span></span><br><span class="line"><span class="string">　　列名的列表：这些列将被解析为日期</span></span><br><span class="line"><span class="string">　　字典&#123;col_name:format_str&#125;：给出了那些列被解析为日期，以及解析字符串</span></span><br><span class="line"><span class="string">　　字典&#123;col_name:arg dict&#125;：给出了哪些列被解析为日期，arg dict将传递给pandas.to_datetime()函数来解析日期</span></span><br><span class="line"><span class="string">columns：一个列表，给出了将从sql中提取哪些列</span></span><br><span class="line"><span class="string">chunksize：一个整数。如果给出了，则函数返回的是一个迭代器，每次迭代时，返回chunksize行的数据。</span></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br></pre></td></tr></table></figure><br />
<code>read_sql_query()</code>可以选择select
query语句。因此你可以执行多表联合查询。<br />
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">pd.read_sql_query(sql, con, index_col=<span class="literal">None</span>, coerce_float=<span class="literal">True</span>,</span><br><span class="line">  params=<span class="literal">None</span>, parse_dates=<span class="literal">None</span>, chunksize=<span class="literal">None</span>)</span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">sql：一个SQL查询字符串，或者SQLAlchemy Selectable对象。</span></span><br><span class="line"><span class="string">params：一个列表，元组或者字典。用于传递给sql查询语句。比如：sql为uses %(name)s...，因此params为&#123;&#x27;name&#x27;:&#x27;xxxx&#x27;&#125;</span></span><br><span class="line"><span class="string">其他参数见read_sql_table</span></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br></pre></td></tr></table></figure><br />
<code>read_sql()</code>是前两者的一个包装，它可以根据sql参数，自由地选择使用哪个方式。<br />
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"> pd.read_sql(sql, con, index_col=<span class="literal">None</span>, coerce_float=<span class="literal">True</span>, params=<span class="literal">None</span>,</span><br><span class="line">  parse_dates=<span class="literal">None</span>, columns=<span class="literal">None</span>, chunksize=<span class="literal">None</span>)</span><br><span class="line"></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">sql：一个数据表名，或者查询字符串，或者SQLAlchemy Selectable对象。</span></span><br><span class="line"><span class="string">    如果为表名，则使用read_sql_table；如果为后两者，则使用read_sql_query</span></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br></pre></td></tr></table></figure><br />
<code>Series/DataFrame.to_sql()</code>方法用于插入数据库。<br />
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">Series/DataFrame.to_sql(name, con, flavor=<span class="literal">None</span>, schema=<span class="literal">None</span>, if_exists=<span class="string">&#x27;fail&#x27;</span>,</span><br><span class="line">  index=<span class="literal">True</span>, index_label=<span class="literal">None</span>, chunksize=<span class="literal">None</span>, dtype=<span class="literal">None</span>)</span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">name：一个字符串，指定表名</span></span><br><span class="line"><span class="string">con：一个SQLAlchemy conectable或者一个database string URI，指定了连接对象。它就是SQLAlchemy中的Engine对象。</span></span><br><span class="line"><span class="string">flavor：被废弃的参数</span></span><br><span class="line"><span class="string">schema：一个字符串，指定了SQL schema</span></span><br><span class="line"><span class="string">if_exists：一个字符串，指定当数据表已存在时如何。可以为：</span></span><br><span class="line"><span class="string">&#x27;fail&#x27;：什么都不做（即不存储数据）</span></span><br><span class="line"><span class="string">&#x27;replace&#x27;：删除数据表，创建新表，然后插入数据</span></span><br><span class="line"><span class="string">&#x27;append&#x27;：如果数据表不存在则创建数据表然后插入数据。入股数据表已存在，则追加数据</span></span><br><span class="line"><span class="string">index：一个布尔值。如果为True，则将index作为一列数据插入数据库</span></span><br><span class="line"><span class="string">index_label：index的存储名。如果index=True，且index_label=None，则使用index.name</span></span><br><span class="line"><span class="string">chunksize：一个整数。  如果为None，则一次写入所有的记录。如果非空，则一次写入chunksize大小的记录</span></span><br><span class="line"><span class="string">dtype：一个字典。给出了各列的存储类型。</span></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br></pre></td></tr></table></figure></p>
<h2 id="小抄">小抄</h2>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br></pre></td><td class="code"><pre><span class="line">data.loc[data.notnull().<span class="built_in">all</span>(axis=<span class="number">1</span>)] <span class="comment"># 取所有非null的行(axis=1)</span></span><br><span class="line">data.loc[:,data.notnull().<span class="built_in">all</span>(axis=<span class="number">0</span>)] <span class="comment"># 取所有非null的列(axis=0)</span></span><br><span class="line"></span><br><span class="line">data.loc[data.isnull().<span class="built_in">any</span>(axis=<span class="number">1</span>)] <span class="comment"># 取所有存在null的行(axis=1)</span></span><br><span class="line">data.loc[:,data.isnull().<span class="built_in">any</span>(axis=<span class="number">0</span>)] <span class="comment"># 取所有存在null的列(axis=0)</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># 数据类型正确？</span></span><br><span class="line">data.dtypes</span><br><span class="line"><span class="comment"># 噪音(不合理数据范围，极端值)？</span></span><br><span class="line">data.describe()</span><br><span class="line"><span class="comment"># 种类统计？</span></span><br><span class="line">data[<span class="string">&#x27;type&#x27;</span>].value_counts()</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># 删除全为0的行</span></span><br><span class="line">data[data.apply(np.<span class="built_in">sum</span>,axis=<span class="number">1</span>)!=<span class="number">0</span>]</span><br><span class="line"></span><br><span class="line"><span class="comment"># 是否存在列</span></span><br><span class="line"><span class="keyword">if</span> &#123;<span class="string">&#x27;A&#x27;</span>, <span class="string">&#x27;C&#x27;</span>&#125;.issubset(data.columns):</span><br><span class="line"><span class="comment"># 列重命名</span></span><br><span class="line">data.rename(columns=<span class="built_in">dict</span>, inplace=<span class="literal">True</span>)</span><br><span class="line"><span class="comment"># 删除列</span></span><br><span class="line">data.drop([<span class="string">&#x27;a&#x27;</span>, <span class="string">&#x27;b&#x27;</span>], axis=<span class="number">1</span>)</span><br><span class="line"><span class="comment"># 删除缺失值最多的列</span></span><br><span class="line">data.drop(data.count().idxmin(),axis=<span class="number">1</span>)</span><br><span class="line">data.drop([x <span class="keyword">for</span> x <span class="keyword">in</span> data.columns <span class="keyword">if</span> data.count().loc[x]== data.count().<span class="built_in">min</span>()][<span class="number">0</span>],axis=<span class="number">1</span>) </span><br><span class="line"><span class="comment"># 删除全为0的列</span></span><br><span class="line">data.loc[:, (data != <span class="number">0</span>).<span class="built_in">any</span>(axis=<span class="number">0</span>)]</span><br><span class="line"><span class="comment"># 列中缺失行数</span></span><br><span class="line">null_sum = data.isnull().<span class="built_in">sum</span>()</span><br><span class="line"><span class="comment"># 缺失百分比，去除某列(去除缺失大于30%数据的列)</span></span><br><span class="line">cols = data.columns[null_sum &gt; <span class="built_in">len</span>(data)*<span class="number">0.3</span>]</span><br><span class="line">data.drop(columns=cols, inplace=<span class="literal">True</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 去除某列极端值所在行</span></span><br><span class="line">abnormal = (data[<span class="string">&#x27;age&#x27;</span>]&lt;<span class="number">1</span> | data[<span class="string">&#x27;age&#x27;</span>]&gt;<span class="number">110</span>)</span><br><span class="line">data = data[-abnormal]</span><br><span class="line"></span><br><span class="line"><span class="comment"># 数值比较大的用log</span></span><br><span class="line">ax = sns.hisplot(np.log10(data[<span class="string">&#x27;Price&#x27;</span>]))</span><br><span class="line">ax.set_xlim([<span class="number">3</span>,<span class="number">8</span>])</span><br><span class="line">ax.set_xticks(<span class="built_in">range</span>(<span class="number">3</span>,<span class="number">9</span>))</span><br><span class="line">ax.set_xticklabels([<span class="string">&#x27;%.0e&#x27;</span> %a <span class="keyword">for</span> a <span class="keyword">in</span> <span class="number">10</span>**ax.get_xticks()])</span><br><span class="line"></span><br><span class="line"><span class="comment"># 从每一行中选择特定列</span></span><br><span class="line">[df.loc[idx, col] <span class="keyword">for</span> idx, col <span class="keyword">in</span> <span class="built_in">enumerate</span>([<span class="string">&#x27;a&#x27;</span>, <span class="string">&#x27;a&#x27;</span>, <span class="string">&#x27;b&#x27;</span>, <span class="string">&#x27;c&#x27;</span>, <span class="string">&#x27;b&#x27;</span>])]</span><br><span class="line"></span><br><span class="line"><span class="comment"># 某列值转为list类型</span></span><br><span class="line">data[<span class="string">&#x27;a&#x27;</span>].apply(<span class="keyword">lambda</span> x: [<span class="built_in">int</span>(a) <span class="keyword">for</span> a <span class="keyword">in</span> x.strip(<span class="string">&quot;[]&quot;</span>).split(<span class="string">&quot;, &quot;</span>)])</span><br><span class="line"></span><br><span class="line"><span class="comment"># 选取数值特征(非对象特征)</span></span><br><span class="line">numeric_features = data.dtypes[data.dtypes != <span class="string">&#x27;object&#x27;</span>].index</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># 标准化数据</span></span><br><span class="line">data[numeric_features] = data[numeric_features].apply(</span><br><span class="line">    <span class="keyword">lambda</span> x: (x - x.mean()) / (x.std()))</span><br><span class="line"><span class="comment"># 标准化后填充缺失值</span></span><br><span class="line">data[numeric_features] = data[numeric_features].fillna(<span class="number">0</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># One-Hot，NA视为有效特征值</span></span><br><span class="line">data = pd.get_dummies(data, dummy_na=<span class="literal">True</span>) </span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># 一列数据拆分成多列</span></span><br><span class="line"><span class="comment"># https://blog.csdn.net/lly1122334/article/details/104629678</span></span><br><span class="line"><span class="keyword">import</span> numpy <span class="keyword">as</span> np</span><br><span class="line"><span class="keyword">import</span> pandas <span class="keyword">as</span> pd</span><br><span class="line"></span><br><span class="line">data = [&#123;<span class="string">&#x27;Name&#x27;</span>: <span class="string">&#x27;小爱&#x27;</span>, <span class="string">&#x27;Chinese&#x27;</span>: <span class="number">70</span>, <span class="string">&#x27;Math&#x27;</span>: <span class="number">90</span>&#125;,</span><br><span class="line">        &#123;<span class="string">&#x27;Name&#x27;</span>: <span class="string">&#x27;小明&#x27;</span>, <span class="string">&#x27;Chinese&#x27;</span>: [<span class="number">70</span>, <span class="number">80</span>], <span class="string">&#x27;Math&#x27;</span>: [<span class="number">90</span>, <span class="number">80</span>]&#125;,</span><br><span class="line">        &#123;<span class="string">&#x27;Name&#x27;</span>: <span class="string">&#x27;小红&#x27;</span>, <span class="string">&#x27;Chinese&#x27;</span>: [<span class="number">70</span>, <span class="number">80</span>, <span class="number">90</span>], <span class="string">&#x27;Math&#x27;</span>: [<span class="number">90</span>, <span class="number">80</span>, <span class="number">70</span>]&#125;]</span><br><span class="line">data = pd.DataFrame(data)</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">split_col</span>(<span class="params">data, columns</span>):</span><br><span class="line">    <span class="string">&#x27;&#x27;&#x27;拆分成列</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">    :param data: 原始数据</span></span><br><span class="line"><span class="string">    :param columns: 拆分的列名</span></span><br><span class="line"><span class="string">    :type data: pandas.core.frame.DataFrame</span></span><br><span class="line"><span class="string">    :type columns: list</span></span><br><span class="line"><span class="string">    &#x27;&#x27;&#x27;</span></span><br><span class="line">    <span class="keyword">for</span> c <span class="keyword">in</span> columns:</span><br><span class="line">        new_col = data.pop(c)</span><br><span class="line">        max_len = <span class="built_in">max</span>(<span class="built_in">list</span>(<span class="built_in">map</span>(<span class="keyword">lambda</span> x:<span class="built_in">len</span>(x) <span class="keyword">if</span> <span class="built_in">isinstance</span>(x, <span class="built_in">list</span>) <span class="keyword">else</span> <span class="number">1</span>, new_col.values)))  <span class="comment"># 最大长度</span></span><br><span class="line">        new_col = new_col.apply(<span class="keyword">lambda</span> x: x+[<span class="literal">None</span>]*(max_len - <span class="built_in">len</span>(x)) <span class="keyword">if</span> <span class="built_in">isinstance</span>(x, <span class="built_in">list</span>) <span class="keyword">else</span> [x]+[<span class="literal">None</span>]*(max_len - <span class="number">1</span>))  <span class="comment"># 补空值，None可换成np.nan</span></span><br><span class="line">        new_col = np.array(new_col.tolist()).T  <span class="comment"># 转置</span></span><br><span class="line">        <span class="keyword">for</span> i, j <span class="keyword">in</span> <span class="built_in">enumerate</span>(new_col):</span><br><span class="line">            data[c + <span class="built_in">str</span>(i)] = j</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">split_col(data, columns=[<span class="string">&#x27;Chinese&#x27;</span>,<span class="string">&#x27;Math&#x27;</span>])</span><br><span class="line">data</span><br><span class="line"></span><br></pre></td></tr></table></figure>

    </div>

    
    
    

    <footer class="post-footer">
          

<div class="post-copyright">
<ul>
  <li class="post-copyright-author">
      <strong>本文作者： </strong>SoundMemories
  </li>
  <li class="post-copyright-link">
      <strong>本文链接：</strong>
      <a href="https://soundmemories.github.io/2020/04/25/ML/03.ML-Pandas/" title="ML-Pandas">https://soundmemories.github.io/2020/04/25/ML/03.ML-Pandas/</a>
  </li>
  <li class="post-copyright-license">
      <strong>版权声明： </strong>本博客所有文章除特别声明外，均采用 <span class="exturl" data-url="aHR0cHM6Ly9jcmVhdGl2ZWNvbW1vbnMub3JnL2xpY2Vuc2VzL2J5LW5jLXNhLzQuMC8="><i class="fab fa-fw fa-creative-commons"></i>BY-NC-SA</span> 许可协议。转载请注明出处！
  </li>
</ul>
</div>

          <div class="post-tags">
              <a href="/tags/ML/" rel="tag"><i class="fa fa-tag"></i> ML</a>
          </div>

        

          <div class="post-nav">
            <div class="post-nav-item">
                <a href="/2020/04/22/ML/02.ML-NumPy/" rel="prev" title="ML-NumPy">
                  <i class="fa fa-chevron-left"></i> ML-NumPy
                </a>
            </div>
            <div class="post-nav-item">
                <a href="/2020/04/30/ML/04.ML-Matplolib/" rel="next" title="ML-Matplotlib">
                  ML-Matplotlib <i class="fa fa-chevron-right"></i>
                </a>
            </div>
          </div>
    </footer>
  </article>
</div>






</div>
  </main>

  <footer class="footer">
    <div class="footer-inner">

  <div class="copyright">
    &copy; 2019 – 
    <span itemprop="copyrightYear">2024</span>
    <span class="with-love">
      <i class="fa fa-heart"></i>
    </span>
    <span class="author" itemprop="copyrightHolder">SoundMemories</span>
  </div>
  <div class="powered-by">由 <span class="exturl" data-url="aHR0cHM6Ly9oZXhvLmlv">Hexo</span> & <span class="exturl" data-url="aHR0cHM6Ly90aGVtZS1uZXh0LmpzLm9yZy9tdXNlLw==">NexT.Muse</span> 强力驱动
  </div>

    </div>
  </footer>

  
  <div class="toggle sidebar-toggle" role="button">
    <span class="toggle-line"></span>
    <span class="toggle-line"></span>
    <span class="toggle-line"></span>
  </div>
  <div class="sidebar-dimmer"></div>
  <div class="back-to-top" role="button" aria-label="返回顶部">
    <i class="fa fa-arrow-up fa-lg"></i>
    <span>0%</span>
  </div>
  <a role="button" class="book-mark-link book-mark-link-fixed"></a>

<noscript>
  <div class="noscript-warning">Theme NexT works best with JavaScript enabled</div>
</noscript>


  
  <script src="https://cdnjs.cloudflare.com/ajax/libs/animejs/3.2.1/anime.min.js" integrity="sha256-XL2inqUJaslATFnHdJOi9GfQ60on8Wx1C2H8DYiN1xY=" crossorigin="anonymous"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/next-theme-pjax/0.6.0/pjax.min.js" integrity="sha256-vxLn1tSKWD4dqbMRyv940UYw4sXgMtYcK6reefzZrao=" crossorigin="anonymous"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.7.0/jquery.min.js" integrity="sha256-2Pmvv0kuTBOenSvLm6bvfBSSHrUJ+3A7x6P5Ebd07/g=" crossorigin="anonymous"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/fancybox/3.5.7/jquery.fancybox.min.js" integrity="sha256-yt2kYMy0w8AbtF89WXb2P1rfjcP/HTHLT7097U8Y5b8=" crossorigin="anonymous"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/medium-zoom/1.0.8/medium-zoom.min.js" integrity="sha256-7PhEpEWEW0XXQ0k6kQrPKwuoIomz8R8IYyuU1Qew4P8=" crossorigin="anonymous"></script>
<script src="/js/comments.js"></script><script src="/js/utils.js"></script><script src="/js/motion.js"></script><script src="/js/schemes/muse.js"></script><script src="/js/next-boot.js"></script><script src="/js/bookmark.js"></script><script src="/js/pjax.js"></script>

  <script src="https://cdnjs.cloudflare.com/ajax/libs/hexo-generator-searchdb/1.4.1/search.js" integrity="sha256-1kfA5uHPf65M5cphT2dvymhkuyHPQp5A53EGZOnOLmc=" crossorigin="anonymous"></script>
<script src="/js/third-party/search/local-search.js"></script>

  <script class="next-config" data-name="pdf" type="application/json">{"object_url":{"url":"https://cdnjs.cloudflare.com/ajax/libs/pdfobject/2.2.12/pdfobject.min.js","integrity":"sha256-g2xji1rlE3KsGVClvuxTbcR0Kn2+wtQADSff2Tbb4zA="},"url":"/lib/pdf/web/viewer.html"}</script>
  <script src="/js/third-party/tags/pdf.js"></script>

  <script class="next-config" data-name="mermaid" type="application/json">{"enable":true,"theme":{"light":"neutral","dark":"neutral"},"js":{"url":"https://cdnjs.cloudflare.com/ajax/libs/mermaid/10.2.3/mermaid.min.js","integrity":"sha256-JFptYy4KzJ5OQP+Q9fubNf3cxpPPmZKqUOovyEONKrQ="}}</script>
  <script src="/js/third-party/tags/mermaid.js"></script>


  <script src="/js/third-party/fancybox.js"></script>



  




  

  <script class="next-config" data-name="enableMath" type="application/json">true</script><script class="next-config" data-name="mathjax" type="application/json">{"enable":true,"tags":"none","js":{"url":"https://cdnjs.cloudflare.com/ajax/libs/mathjax/3.2.2/es5/tex-mml-chtml.js","integrity":"sha256-MASABpB4tYktI2Oitl4t+78w/lyA+D7b/s9GEP0JOGI="}}</script>
<script src="/js/third-party/math/mathjax.js"></script>


  <script src="https://cdnjs.cloudflare.com/ajax/libs/quicklink/2.3.0/quicklink.umd.js" integrity="sha256-yvJQOINiH9fWemHn0vCA5lsHWJaHs6/ZmO+1Ft04SvM=" crossorigin="anonymous"></script>
  <script class="next-config" data-name="quicklink" type="application/json">{"enable":true,"home":true,"archive":true,"delay":true,"timeout":3000,"priority":true,"url":"https://soundmemories.github.io/2020/04/25/ML/03.ML-Pandas/"}</script>
  <script src="/js/third-party/quicklink.js"></script>

</body>
</html>
