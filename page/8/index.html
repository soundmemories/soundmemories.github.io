<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width">
<meta name="theme-color" content="#222" media="(prefers-color-scheme: light)">
<meta name="theme-color" content="#222" media="(prefers-color-scheme: dark)"><meta name="generator" content="Hexo 6.3.0">

  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png">
  <link rel="mask-icon" href="/images/logo.svg" color="#222">

<link rel="stylesheet" href="/css/main.css">

<link rel="stylesheet" href="https://fonts.loli.net/css?family=Monda:300,300italic,400,400italic,700,700italic&display=swap&subset=latin,latin-ext">

<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" integrity="sha256-HtsXJanqjKTc8vVQjO4YMhiqFoXkfBsjBWcX91T1jr8=" crossorigin="anonymous">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/animate.css/3.1.1/animate.min.css" integrity="sha256-PR7ttpcvz8qrF57fur/yAx1qXMFJeJFiA6pSzWi0OIE=" crossorigin="anonymous">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/fancybox/3.5.7/jquery.fancybox.min.css" integrity="sha256-Vzbj7sDDS/woiFS3uNKo8eIuni59rjyNGtXfstRzStA=" crossorigin="anonymous">

<script class="next-config" data-name="main" type="application/json">{"hostname":"soundmemories.github.io","root":"/","images":"/images","scheme":"Muse","darkmode":true,"version":"8.17.1","exturl":true,"sidebar":{"position":"left","display":"always","padding":18,"offset":12},"copycode":{"enable":true,"style":null},"bookmark":{"enable":true,"color":"#222","save":"auto"},"mediumzoom":true,"lazyload":false,"pangu":false,"comments":{"style":"tabs","active":null,"storage":true,"lazyload":false,"nav":null},"stickytabs":false,"motion":{"enable":true,"async":false,"transition":{"menu_item":"fadeInDown","post_block":"fadeIn","post_header":"fadeInDown","post_body":"fadeInDown","coll_header":"fadeInLeft","sidebar":"fadeInUp"}},"prism":false,"i18n":{"placeholder":"搜索...","empty":"没有找到任何搜索结果：${query}","hits_time":"找到 ${hits} 个搜索结果（用时 ${time} 毫秒）","hits":"找到 ${hits} 个搜索结果"},"path":"/search.xml","localsearch":{"enable":true,"trigger":"auto","top_n_per_article":1,"unescape":false,"preload":false}}</script><script src="/js/config.js"></script>

    <meta name="description" content="今日事，今日毕">
<meta property="og:type" content="website">
<meta property="og:title" content="SoundMemories">
<meta property="og:url" content="https://soundmemories.github.io/page/8/index.html">
<meta property="og:site_name" content="SoundMemories">
<meta property="og:description" content="今日事，今日毕">
<meta property="og:locale" content="zh_CN">
<meta property="article:author" content="SoundMemories">
<meta name="twitter:card" content="summary">


<link rel="canonical" href="https://soundmemories.github.io/page/8/">



<script class="next-config" data-name="page" type="application/json">{"sidebar":"","isHome":true,"isPost":false,"lang":"zh-CN","comments":"","permalink":"","path":"page/8/index.html","title":""}</script>

<script class="next-config" data-name="calendar" type="application/json">""</script>
<title>SoundMemories</title>
  








  <noscript>
    <link rel="stylesheet" href="/css/noscript.css">
  </noscript>
</head>

<body itemscope itemtype="http://schema.org/WebPage" class="use-motion">
  <div class="headband"></div>

  <main class="main">
    <div class="column">
      <header class="header" itemscope itemtype="http://schema.org/WPHeader"><div class="site-brand-container">
  <div class="site-nav-toggle">
    <div class="toggle" aria-label="切换导航栏" role="button">
        <span class="toggle-line"></span>
        <span class="toggle-line"></span>
        <span class="toggle-line"></span>
    </div>
  </div>

  <div class="site-meta">

    <a href="/" class="brand" rel="start">
      <i class="logo-line"></i>
      <h1 class="site-title">SoundMemories</h1>
      <i class="logo-line"></i>
    </a>
  </div>

  <div class="site-nav-right">
    <div class="toggle popup-trigger" aria-label="搜索" role="button">
        <i class="fa fa-search fa-fw fa-lg"></i>
    </div>
  </div>
</div>



<nav class="site-nav">
  <ul class="main-menu menu"><li class="menu-item menu-item-home"><a href="/" rel="section"><i class="fa fa-home fa-fw"></i>首页</a></li><li class="menu-item menu-item-tags"><a href="/tags/" rel="section"><i class="fa fa-tags fa-fw"></i>标签<span class="badge">10</span></a></li><li class="menu-item menu-item-categories"><a href="/categories/" rel="section"><i class="fa fa-th fa-fw"></i>分类<span class="badge">10</span></a></li><li class="menu-item menu-item-archives"><a href="/archives/" rel="section"><i class="fa fa-archive fa-fw"></i>归档<span class="badge">129</span></a></li>
      <li class="menu-item menu-item-search">
        <a role="button" class="popup-trigger"><i class="fa fa-search fa-fw"></i>搜索
        </a>
      </li>
  </ul>
</nav>



  <div class="search-pop-overlay">
    <div class="popup search-popup"><div class="search-header">
  <span class="search-icon">
    <i class="fa fa-search"></i>
  </span>
  <div class="search-input-container">
    <input autocomplete="off" autocapitalize="off" maxlength="80"
           placeholder="搜索..." spellcheck="false"
           type="search" class="search-input">
  </div>
  <span class="popup-btn-close" role="button">
    <i class="fa fa-times-circle"></i>
  </span>
</div>
<div class="search-result-container no-result">
  <div class="search-result-icon">
    <i class="fa fa-spinner fa-pulse fa-5x"></i>
  </div>
</div>

    </div>
  </div>

</header>
        
  
  <aside class="sidebar">

    <div class="sidebar-inner sidebar-overview-active">
      <ul class="sidebar-nav">
        <li class="sidebar-nav-toc">
          文章目录
        </li>
        <li class="sidebar-nav-overview">
          站点概览
        </li>
      </ul>

      <div class="sidebar-panel-container">
        <!--noindex-->
        <div class="post-toc-wrap sidebar-panel">
        </div>
        <!--/noindex-->

        <div class="site-overview-wrap sidebar-panel">
          <div class="site-author animated" itemprop="author" itemscope itemtype="http://schema.org/Person">
    <img class="site-author-image" itemprop="image" alt="SoundMemories"
      src="/images/avstar.png">
  <p class="site-author-name" itemprop="name">SoundMemories</p>
  <div class="site-description" itemprop="description">今日事，今日毕</div>
</div>
<div class="site-state-wrap animated">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
        <a href="/archives/">
          <span class="site-state-item-count">129</span>
          <span class="site-state-item-name">日志</span>
        </a>
      </div>
      <div class="site-state-item site-state-categories">
          <a href="/categories/">
        <span class="site-state-item-count">10</span>
        <span class="site-state-item-name">分类</span></a>
      </div>
      <div class="site-state-item site-state-tags">
          <a href="/tags/">
        <span class="site-state-item-count">10</span>
        <span class="site-state-item-name">标签</span></a>
      </div>
  </nav>
</div>
  <div class="links-of-author animated">
      <span class="links-of-author-item">
        <span class="exturl" data-url="aHR0cHM6Ly9naXRodWIuY29tL3NvdW5kbWVtb3JpZXM=" title="GitHub → https:&#x2F;&#x2F;github.com&#x2F;soundmemories"><i class="fab fa-github fa-fw"></i>GitHub</span>
      </span>
      <span class="links-of-author-item">
        <span class="exturl" data-url="bWFpbHRvOnNvdW5kbWVtb3JpZXNAMTYzLmNvbQ==" title="E-Mail → mailto:soundmemories@163.com"><i class="fa fa-envelope fa-fw"></i>E-Mail</span>
      </span>
  </div>
  <div class="cc-license animated" itemprop="license">
    <span class="exturl cc-opacity" data-url="aHR0cHM6Ly9jcmVhdGl2ZWNvbW1vbnMub3JnL2xpY2Vuc2VzL2J5LW5jLXNhLzQuMC8="><img src="https://cdnjs.cloudflare.com/ajax/libs/creativecommons-vocabulary/2020.11.3/assets/license_badges/small/by_nc_sa.svg" alt="Creative Commons"></span>
  </div>

        </div>
      </div>
    </div>

    
        <div class="pjax">
        </div>
  </aside>


    </div>

    <div class="main-inner index posts-expand">

    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="https://soundmemories.github.io/2020/04/30/ML/04.ML-Matplolib/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avstar.png">
      <meta itemprop="name" content="SoundMemories">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="SoundMemories">
      <meta itemprop="description" content="今日事，今日毕">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | SoundMemories">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2020/04/30/ML/04.ML-Matplolib/" class="post-title-link" itemprop="url">ML-Matplotlib</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>

      <time title="创建时间：2020-04-30 00:00:00" itemprop="dateCreated datePublished" datetime="2020-04-30T00:00:00+08:00">2020-04-30</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">分类于</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/ML/" itemprop="url" rel="index"><span itemprop="name">ML</span></a>
        </span>
    </span>

  
    <span class="post-meta-break"></span>
    <span class="post-meta-item" title="本文字数">
      <span class="post-meta-item-icon">
        <i class="far fa-file-word"></i>
      </span>
      <span class="post-meta-item-text">本文字数：</span>
      <span>33k</span>
    </span>
    <span class="post-meta-item" title="阅读时长">
      <span class="post-meta-item-icon">
        <i class="far fa-clock"></i>
      </span>
      <span class="post-meta-item-text">阅读时长 &asymp;</span>
      <span>1:59</span>
    </span>
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <h1 id="matplotlib概述">Matplotlib概述</h1>
<p>Matplotlib 是建立在 NumPy
数组基础上的多平台数据可视化程序库，最初被设计用于完善 SciPy
的生态环境。 John Hunter 希望能画出类似 MATLAB 风格的交互式图形，之后
John 就把补丁做成了 Matplotlib 程序包。</p>
<p>Matplotlib
支持几十种图形显示接口与输出格式，这使得用户无论在哪种操作系统上都可以输出自己想要的图形格式。这种跨平台、面面俱到的特点已经成为
Matplotlib 最强大的功能之一，新版的 Matplotlib
已经可以轻松实现主流的绘图风格，人们不断在 Matplotlib
的基础上开发出新的程序包，实现更加简洁、现代化的 API，例如
Seaborn、ggplot、HoloViews、Altair，以 及 Pandas 对 Matplotlib 的 API
封装的画图功能。虽然已经有了封装后的高级工具，但是掌握 Matplotlib
的语法更能让你灵活地控制最终的图形结果。</p>
<p>和Pandas一样，使用<code>pip install matplotlib</code>进行安装，可查看和引用它：<br />
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> matplotlib <span class="keyword">as</span> mpl</span><br><span class="line"><span class="keyword">import</span> matplotlib.pyplot <span class="keyword">as</span> plt</span><br><span class="line"></span><br><span class="line"><span class="comment"># 查看包的版本</span></span><br><span class="line">mpl.__version__</span><br><span class="line"><span class="comment"># 自动补全</span></span><br><span class="line">mpl.&lt;TAB&gt;</span><br><span class="line"><span class="comment"># 内置的文档</span></span><br><span class="line">mpl?</span><br></pre></td></tr></table></figure></p>
<h1 id="matplotlib三层结构">Matplotlib三层结构</h1>
<h2 id="容器层">容器层</h2>
<p>容器层主要由Canvas、Figure、Axes组成。<br />
（1）Canvas是位于最底层的系统层，在绘图的过程中充当<strong>画板</strong>的角色，即放置画布（Figure）的工具。<br />
（2）Figure是Canvas上面的一层，也是需要用户来操作的应用层的第一层，在绘图的过程中充当<strong>画布</strong>的角色。<br />
（3）Axes是Figure之上的一层，是应用层的第二层，在绘图的过程中相当于画布上的<strong>绘图区</strong>角色。</p>
<div class="note info"><p>Figure：指整个图形（可以通过plt.figure()设置画布的大小和分辨率等。<br />
Axes：指坐标系，数据的绘图区。<br />
Axis指坐标轴，坐标系中的一条轴，包含大小限制、刻度和刻度标签。</p>
<p>一个figure（画布）可以包含多个axes（绘图区/坐标系），但是一个axes只能属于一个figure。<br />
一个axes（绘图区/坐标系）可以包含多个axis（坐标轴），包含两个即为2d坐标系，3个即为3d坐标系。</p>
</div>
<p><img src="https://i.loli.net/2021/05/20/kQxnK39Ar1wbIYJ.jpg" width="50%" height="50%"></p>
<h2 id="图像层">图像层</h2>
<p>图像层建立建立在Axes上面，是指Axes内通过plot、scatter、bar、histogram、pie等函数<strong>根据数据绘制出的图像</strong>。<br />
<img src="https://i.loli.net/2021/05/20/9QKgsyWvTEdS7kf.png" width="70%" height="70%"></p>
<h2 id="辅助显示层">辅助显示层</h2>
<p>辅助显示层也是建立在Axes上面，为Axes（绘图区）内的，<strong>除了根据数据绘制出的图像以外的内容</strong>，主要包括Axes外观(facecolor)、边框线(spines)、坐标轴(axis)、坐标轴名称(axis
label)、坐标轴刻度(tick)、坐标轴刻度标签(tick
label)、网格线(grid)、图例(legend)、标题(title)等内容。该层的设置可使图像显示更加直观更加容易被用户理解，但又不会对图像产生实质的影响。<br />
<img src="https://i.loli.net/2021/05/20/xw5SpbBa6J81Mqo.png" /></p>
<h1 id="matplotlib配置和技巧">Matplotlib配置和技巧</h1>
<h2 id="数据格式">数据格式</h2>
<p>matplotlib的所有plotting
function期待输入numpy.array或者numpy.ma.masked_array类型的数据作为输入。某些长得像numpy.array的数据比如numpy.matrix类型的输入数据可能会导致matplotlib工作异常。如果确实需要使用numpy.matrix，你应该首先将它转换为numpy.array。</p>
<h2 id="pyplotpylab">pyplot、pylab</h2>
<p><strong>matplotlib.pyplot</strong>：位于matplotlib的顶层，它为底层的面向对象接口提供了一个state-machine
interface。这个state-machine必要的时候隐式创建Figure和Axes，并维护current
Figure和current
Axes。该模块中的很多函数是用于给当前Figure的当前Axes添加plot
element，比如line、text、image等。它非常类似于Matlab的用法。常用方法参考<span class="exturl" data-url="aHR0cHM6Ly9tYXRwbG90bGliLm9yZy9zdGFibGUvYXBpL19hc19nZW4vbWF0cGxvdGxpYi5weXBsb3QuaHRtbD9oaWdobGlnaHQ9bWF0cGxvdGxpYiUyMHB5cGxvdCNtb2R1bGUtbWF0cGxvdGxpYi5weXBsb3Q=">pyplot<i class="fa fa-external-link-alt"></i></span></p>
<p>matplotlib.pyplot的下一层是面向对象的接口：在这一层pyplot只是用部分函数来创建Figure，然后通过该Figure显式的创建Axes，然后通过面向对象的接口在该Axes上添加图形。极端情况下用户可以完全抛弃pyplot而完全使用面向对象的接口。</p>
<p><strong>matplotlib.pylab</strong>：是一个便利的module，它导入了matplotlib.pyplot以及numpy，它只是为了plot以及math方便而用。<strong>官方文档不推荐使用它。</strong></p>
<h2 id="配置">配置</h2>
<p>官网<span class="exturl" data-url="aHR0cHM6Ly9tYXRwbG90bGliLm9yZy9zdGFibGUvdHV0b3JpYWxzL2ludHJvZHVjdG9yeS9jdXN0b21pemluZy5odG1s">customizing<i class="fa fa-external-link-alt"></i></span>。<br />
matplotlib配置信息是从配置文件<code>.matplotlibrc</code>中读取的。<br />
在配置文件中可以为matplotlib几乎所有的属性指定永久有效的默认值。<br />
你可以通过索引字典改变这些设置，可通过<code>mpl.rcdefaults()</code>恢复初始值。使用
plt.style 来选择图形的绘图风格。<br />
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 查看配置</span></span><br><span class="line">mpl.rcParams</span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">RcParams(&#123;&#x27;_internal.classic_mode&#x27;: False,</span></span><br><span class="line"><span class="string">          &#x27;agg.path.chunksize&#x27;: 0,</span></span><br><span class="line"><span class="string">          &#x27;animation.avconv_args&#x27;: [],</span></span><br><span class="line"><span class="string">          &#x27;animation.avconv_path&#x27;: &#x27;avconv&#x27;,</span></span><br><span class="line"><span class="string">          &#x27;animation.bitrate&#x27;: -1,</span></span><br><span class="line"><span class="string">          &#x27;animation.codec&#x27;: &#x27;h264&#x27;,</span></span><br><span class="line"><span class="string">          &#x27;animation.convert_args&#x27;: [],</span></span><br><span class="line"><span class="string">          &#x27;animation.convert_path&#x27;: &#x27;convert&#x27;,</span></span><br><span class="line"><span class="string">          &#x27;animation.embed_limit&#x27;: 20.0,</span></span><br><span class="line"><span class="string">          &#x27;animation.ffmpeg_args&#x27;: [],</span></span><br><span class="line"><span class="string">          &#x27;animation.ffmpeg_path&#x27;: &#x27;ffmpeg&#x27;,</span></span><br><span class="line"><span class="string">          &#x27;animation.frame_format&#x27;: &#x27;png&#x27;,</span></span><br><span class="line"><span class="string">          &#x27;animation.html&#x27;: &#x27;none&#x27;,</span></span><br><span class="line"><span class="string">          ...</span></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="comment"># 字典修改所有已经加载的配置项</span></span><br><span class="line">mpl.rcParams[<span class="string">&#x27;lines.color&#x27;</span>] = <span class="string">&#x27;r&#x27;</span></span><br><span class="line">mpl.rcParams[<span class="string">&#x27;lines.color&#x27;</span>]</span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">&#x27;r&#x27;</span></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="comment"># 恢复初始值</span></span><br><span class="line">mpl.rcdefaults()</span><br><span class="line">mpl.rcParams[<span class="string">&#x27;lines.color&#x27;</span>]</span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">&#x27;C0&#x27;</span></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="comment"># 配置绘图样式，经典风格classic</span></span><br><span class="line">plt.style.use(<span class="string">&#x27;classic&#x27;</span>)</span><br></pre></td></tr></table></figure><br />
如果你不希望在每次代码开始时进行参数配置，则可以在项目中给出配置文件。配置文件有三个位置：<br />
（1）系统级配置文件。通常在 python 的 site-packages 目录下。每次重装
matplotlib 之后该配置文件就会被覆盖。<br />
（2）用户级配置文件。通常在<code>$HOME</code>目录下。可以用<code>mpl.get_configdir()</code>函数来查找当前用户的配置文件目录。可以通过<code>MATPLOTLIBRC</code>修改它的位置。<br />
（3）当前工作目录。即项目的目录。在当前目录下，可以为目录所包含的当前项目给出配置文件，文件名为<code>.matplotlibrc</code>。<br />
优先级：<code>当前工作目录 &gt; 用户级配置文件 &gt; 系统级配置文件</code>。查看当前使用的配置文件的路径为：<code>mpl.matplotlib_fname()</code>。</p>
<p>配置文件的内容常见的有以下几种：<br />
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">axes            设置坐标轴边界和表面的颜色、坐标刻度值大小和网格的显示</span><br><span class="line">backend         设置目标输出TkAgg和GTKAgg</span><br><span class="line">figure          控制dpi、边界颜色、图像大小和子区(subplot)设置</span><br><span class="line">font            字体(font family)、字体大小和样式设置</span><br><span class="line">grid            设置网格颜色和线型</span><br><span class="line">legend          设置图例以及其中的文本显示</span><br><span class="line">line            设置线条（颜色、线型、宽度等）和标记</span><br><span class="line">patch           填充2D空间的图形图像，如多边形和圆。控制线宽、颜色和抗锯齿设置等。</span><br><span class="line">savefig         对保存的图形进行单独设置。如渲染的文件背景为白色。</span><br><span class="line">text            设置字体颜色、文本解析（纯文本和latex标记）等。</span><br><span class="line">verbose:        设置matplotlib执行期间的信息输出，如silent、helpful、debug和debug--annoying</span><br><span class="line">xticks、yticks  为x、y轴的主刻度和次刻度设置颜色、大小、方向以及标签大小</span><br></pre></td></tr></table></figure></p>
<p>Matplotlib
每次加载时，都会定义一个<strong>运行时配置</strong>（runtime
configuration，rc），其中包含了所有你创建的图形元素的默认风格。你可以用
<code>plt.rc()</code>
简便方法随时修改这个配置。这些配置会保存在<code>.matplotlibrc</code>文件中。<br />
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line">%matplotlib inline</span><br><span class="line"><span class="keyword">import</span> numpy <span class="keyword">as</span> np</span><br><span class="line"><span class="keyword">import</span> matplotlib.pyplot <span class="keyword">as</span> plt</span><br><span class="line"><span class="keyword">from</span> matplotlib <span class="keyword">import</span> cycler</span><br><span class="line"></span><br><span class="line"><span class="comment"># 先复制一下目前的 rcParams 字典，这样可以在修改之后再还原回来</span></span><br><span class="line">IPython_default = plt.rcParams.copy()</span><br><span class="line"></span><br><span class="line">colors = cycler(<span class="string">&#x27;color&#x27;</span>,[<span class="string">&#x27;#EE6666&#x27;</span>, <span class="string">&#x27;#3388BB&#x27;</span>, <span class="string">&#x27;#9988DD&#x27;</span>,<span class="string">&#x27;#EECC55&#x27;</span>, <span class="string">&#x27;#88BB44&#x27;</span>, <span class="string">&#x27;#FFBBBB&#x27;</span>])</span><br><span class="line"></span><br><span class="line">plt.rc(<span class="string">&#x27;axes&#x27;</span>, facecolor=<span class="string">&#x27;#E6E6E6&#x27;</span>, edgecolor=<span class="string">&#x27;none&#x27;</span>,axisbelow=<span class="literal">True</span>, grid=<span class="literal">True</span>, prop_cycle=colors)</span><br><span class="line">plt.rc(<span class="string">&#x27;grid&#x27;</span>, color=<span class="string">&#x27;w&#x27;</span>, linestyle=<span class="string">&#x27;solid&#x27;</span>)</span><br><span class="line">plt.rc(<span class="string">&#x27;xtick&#x27;</span>, direction=<span class="string">&#x27;out&#x27;</span>, color=<span class="string">&#x27;gray&#x27;</span>)</span><br><span class="line">plt.rc(<span class="string">&#x27;ytick&#x27;</span>, direction=<span class="string">&#x27;out&#x27;</span>, color=<span class="string">&#x27;gray&#x27;</span>)</span><br><span class="line">plt.rc(<span class="string">&#x27;patch&#x27;</span>, edgecolor=<span class="string">&#x27;#E6E6E6&#x27;</span>)</span><br><span class="line">plt.rc(<span class="string">&#x27;lines&#x27;</span>, linewidth=<span class="number">2</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 直方图</span></span><br><span class="line">x = np.random.randn(<span class="number">1000</span>)</span><br><span class="line">plt.hist(x)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 不用时，还原默认配置</span></span><br><span class="line"><span class="comment"># plt.rcParams.update(IPython_default)</span></span><br></pre></td></tr></table></figure><br />
<img src="https://i.loli.net/2021/05/25/EiDR8KCS5XTZVzU.jpg" /><br />
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 折线图</span></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">4</span>):</span><br><span class="line">    plt.plot(np.random.rand(<span class="number">10</span>))</span><br></pre></td></tr></table></figure><br />
<img src="https://i.loli.net/2021/05/25/QeFNs14KUYZkBgA.jpg" /></p>
<h2 id="样式表">样式表</h2>
<p>手动用<code>plt.rc()</code>修改配置，太麻烦，Matplotlib
中增加了一个非常好用的 style
模块里面包含了大量的新式默认样式表，还支持创建和打包你自己的风格。虽然这些样式表实现的格式功能与前面介绍的<code>.matplotlibrc</code>文件类似，但是它的文件扩展名是<code>.mplstyle</code>。通过<code>plt.style.available</code>
命令可以看到所有可用的风格：<br />
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 查看前5个样式</span></span><br><span class="line">plt.style.available[:<span class="number">5</span>]</span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">[&#x27;fivethirtyeight&#x27;,</span></span><br><span class="line"><span class="string">&#x27;seaborn-pastel&#x27;,</span></span><br><span class="line"><span class="string">&#x27;seaborn-whitegrid&#x27;,</span></span><br><span class="line"><span class="string">&#x27;ggplot&#x27;,</span></span><br><span class="line"><span class="string">&#x27;grayscale&#x27;]</span></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br></pre></td></tr></table></figure><br />
使用某一个样式：<code>plt.style.use('stylename')</code>，但需要注意的是，这样会改变后面所有的风格！如果需要，你可以使用风格上下文管理器临时更换至另一种风格：<br />
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">with</span> plt.style.context(<span class="string">&#x27;stylename&#x27;</span>):</span><br><span class="line">    <span class="comment">#...</span></span><br></pre></td></tr></table></figure><br />
常用的是seaborn风格，除了<code>plt.style.use('seaborn-pastel')</code>这种方式导入样式，还能用<code>import seaborn</code>，在
Notebook 导入 Seaborn 程序库后会自动加载seaborn样式。</p>
<h2 id="绘图显示">绘图显示</h2>
<p>如何显示你的图形，就取决于具体的开发环境了。 Matplotlib
的最佳实践与你使用的开发环境有关。简单来说，就是有三种开发环境，分别是<strong>脚本</strong>、
<strong>IPython shell</strong> 和 <strong>IPython
Notebook</strong>。<br />
（1）<strong>脚本</strong>文件中使用Matplotlib，那么显示图形的时候<strong>必须使用<code>plt.show()</code></strong>。<br />
（2）<strong>IPython
shell</strong>中<strong>交互式</strong>地使用Matplotlib，需使用<code>%matplotlib</code>魔法命令启动Matplotlib模式。<br />
（3）<strong>IPython
Notebook</strong>中使用Matplotlib有两种方式：<code>%matplotlib notebook</code>
启动<strong>交互式</strong>图形；<code>%matplotlib inline</code>
启动<strong>静态</strong>图形。<br />
之后的所有Notebook中的例子都会使用静态模式。<br />
<div class="note info"><p>plt.show() 会启动一个事件循环（event
loop），并找到所有当前可用的图形对象，然后打开一个或多个交互式窗口显示图形。但一个
Python 会话中只能使用一次 plt.show()，因此通常都把它放在脚本的最后。</p>
<p>IPython shell中启动Matplotlib 模式后，任何 plt
命令都会自动打开一个图形窗口，增加新的命令，图形就会更新，所以不需要使用
plt.show()。有一些变化（例如改变已经画好的线条属性）不会自动及时更新；对于这些变化，可以使用plt.draw()
强制更新。</p>
<p>IPython Notebook 中，静态模式时，运行单元格中的命令之后（每一个
Notebook 核心任务 / 会话只需要运行一次），在每一个 Notebook
的单元中创建图形就会直接将 PNG 格式图形文件嵌入在单元中。</p>
</div></p>
<h2 id="图形保存">图形保存</h2>
<p>Matplotlib 的一个优点是能够将图形保存为各种不同的数据格式。你可以用
<code>savefig()</code> 命令将图形保存为文件。例如，如果要将图形保存为
PNG 格式，你可以运行这行代码：<br />
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> numpy <span class="keyword">as</span> np</span><br><span class="line"><span class="keyword">import</span> matplotlib <span class="keyword">as</span> mpl</span><br><span class="line"><span class="keyword">import</span> matplotlib.pyplot <span class="keyword">as</span> plt</span><br><span class="line">x = np.linspace(<span class="number">0</span>, <span class="number">10</span>, <span class="number">100</span>)</span><br><span class="line"></span><br><span class="line">fig = plt.figure()</span><br><span class="line">plt.plot(x, np.sin(x), <span class="string">&#x27;-&#x27;</span>)</span><br><span class="line">plt.plot(x, np.cos(x), <span class="string">&#x27;--&#x27;</span>)</span><br><span class="line"><span class="comment"># 保存图形</span></span><br><span class="line">fig.savefig(<span class="string">&#x27;my_figure.png&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 显示保存的图形</span></span><br><span class="line"><span class="keyword">from</span> IPython.display <span class="keyword">import</span> Image</span><br><span class="line">Image(<span class="string">&#x27;my_figure.png&#x27;</span>)</span><br></pre></td></tr></table></figure><br />
在 savefig() 里面，保存的图片文件格式就是文件的扩展名。 你可以通过
canvas 对象的方法查看系统支持的文件格式：<br />
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">fig.canvas.get_supported_filetypes()</span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">&#123;&#x27;ps&#x27;: &#x27;Postscript&#x27;,</span></span><br><span class="line"><span class="string"> &#x27;eps&#x27;: &#x27;Encapsulated Postscript&#x27;,</span></span><br><span class="line"><span class="string"> &#x27;pdf&#x27;: &#x27;Portable Document Format&#x27;,</span></span><br><span class="line"><span class="string"> &#x27;pgf&#x27;: &#x27;PGF code for LaTeX&#x27;,</span></span><br><span class="line"><span class="string"> &#x27;png&#x27;: &#x27;Portable Network Graphics&#x27;,</span></span><br><span class="line"><span class="string"> &#x27;raw&#x27;: &#x27;Raw RGBA bitmap&#x27;,</span></span><br><span class="line"><span class="string"> &#x27;rgba&#x27;: &#x27;Raw RGBA bitmap&#x27;,</span></span><br><span class="line"><span class="string"> &#x27;svg&#x27;: &#x27;Scalable Vector Graphics&#x27;,</span></span><br><span class="line"><span class="string"> &#x27;svgz&#x27;: &#x27;Scalable Vector Graphics&#x27;&#125;</span></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br></pre></td></tr></table></figure></p>
<h2 id="两种画图接口">两种画图接口</h2>
<p>Matplotlib
有一个容易让人混淆的特性，就是它的两种画图接口：一个是便捷的<strong>MATLAB风格接口</strong>，另一个是功能更强大的<strong>面向对象接口</strong>。下面来快速对比一下两种接口的主要差异。<br />
（1）MATLAB风格接口：许多语法都和MATLAB类似。MATLAB风格的工具位于
<code>pyplot（plt）</code>接口中。这种接口最重要的特性是有状态的：它会持续跟踪“当前的”图形和坐标轴，所有
plt 命令都可以应用。你可以用
<code>plt.gcf()</code>（获取当前图形，figure对象）和
<code>plt.gca()</code>（获取当前坐标轴，Axes对象）来查看具体信息。虽然这个有状态的接口画起图来又快又方便，但是也很容易出问题，例如，当创建上面的第二个子图时，想回到第一个子图，并增加新内容，这在MATLAB风格接口中实现就非常复杂了。<br />
（2）面向对象接口：画图函数不再受到当前“活动”图形或坐标轴的限制，而变成了显式的
Figure 和 Axes
的方法。可以适应更复杂的场景，更好地控制你自己的图形。</p>
<p>虽然在画简单图形时，选择哪种绘图风格主要看个人喜好，但是在画比较复杂的图形时，面向对象方法会更方便。在绝大多数场景中，<code>plt.plot()</code>
与 <code>ax.plot()</code>
的差异非常小，但是后文会重点指出其中的一些陷阱。</p>
<div class="tabs" id="f1"><ul class="nav-tabs"><li class="tab active"><a href="#f1-1">MATLAB风格接口</a></li><li class="tab"><a href="#f1-2">面向对象接口</a></li></ul><div class="tab-content"><div class="tab-pane active" id="f1-1"><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">plt.figure() <span class="comment"># 创建图形</span></span><br><span class="line"><span class="comment"># 创建两个子图中的第一个，设置坐标轴</span></span><br><span class="line">plt.subplot(<span class="number">2</span>, <span class="number">1</span>, <span class="number">1</span>) <span class="comment"># (行、列、子图编号)</span></span><br><span class="line">plt.plot(x, np.sin(x))</span><br><span class="line"><span class="comment"># 创建两个子图中的第二个，设置坐标轴</span></span><br><span class="line">plt.subplot(<span class="number">2</span>, <span class="number">1</span>, <span class="number">2</span>)</span><br><span class="line">plt.plot(x, np.cos(x))</span><br></pre></td></tr></table></figure></div><div class="tab-pane" id="f1-2"><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 先创建图形网格</span></span><br><span class="line"><span class="comment"># ax是一个包含两个Axes对象的数组</span></span><br><span class="line">fig, ax = plt.subplots(<span class="number">2</span>)</span><br><span class="line"><span class="comment"># 在每个对象上调用plot()方法</span></span><br><span class="line">ax[<span class="number">0</span>].plot(x, np.sin(x))</span><br><span class="line">ax[<span class="number">1</span>].plot(x, np.cos(x))</span><br><span class="line"></span><br><span class="line"><span class="comment"># 或者用pylab接口画图，但官方不建议使用！</span></span><br><span class="line">plt.plot(x, np.sin(x))</span><br></pre></td></tr></table></figure></div></div></div>
<p>对于非交互式绘图，官方文档推荐用pyplot创建Figure，然后使用面向对象接口来绘图。</p>
<h2 id="颜色相关">颜色相关</h2>
<p>可以通过<code>matplotlib.pyplot.colors()</code>方法获取matplotlib支持的所有颜色。该方法不做任何事情，就是提供一个帮助文档。<br />
或者参考官方提供的颜色代码：<span class="exturl" data-url="aHR0cHM6Ly94a2NkLmNvbS9jb2xvci9yZ2Iv">colors<i class="fa fa-external-link-alt"></i></span>。<br />
<strong>Ⅰ、字符串</strong><br />
matplotlib提供了下面颜色的别名：'b'：蓝色；'g'：绿色；'r'：红色；'y'：黄色；'c'：青色；'k'：黑色；'m'：洋红色；'w'：白色。</p>
<p>你也可以定制自己的颜色。有两种方法：<br />
（1）使用HTML十六进制字符串/颜色名字：如'#eeefff'，如'red'<br />
（2）使用一个归一化到闭区间[0-1]的RGB元组：如color=(0.3,0.3,0.4)</p>
<p><strong>Ⅱ、颜色代码转换</strong><br />
matplotlib.colors是一个模块，用于转换数字或者颜色参数到 RGB 或者
RGBA。<br />
RGB：一个浮点数元组，有3个浮点数。每个数都是 0-1之间。<br />
RGBA：一个浮点数元组，有4个浮点数。每个数都是 0-1之间。</p>
<p>colors.cnames是个字典，它给出了常用颜色的字符串和对应的#FFFFFF形式。<br />
<code>colors.rgb2hex(rgb)</code>：给出了rgb元组到#FFFFFF形式。
而<code>hex2color(s)</code>给出了#FFFFFF到rgb形式。</p>
<p>colors.ColorConverter类是个颜色转换器类。它提供了下面方法用于转换颜色：<br />
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">.to_rgb(arg)：转换其他类型的颜色到标准的rgb三元组。</span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">arg: 可以为一个rgb/rgba序列/一个字符串，字符串格式为：</span></span><br><span class="line"><span class="string">    一个代表颜色的字符，如&#x27;rgbcmykw&#x27;</span></span><br><span class="line"><span class="string">    一个十六进制的颜色字符串，如&#x27;#0FFFFFF&#x27;</span></span><br><span class="line"><span class="string">    一个标准的颜色的名字，如&#x27;red&#x27;</span></span><br><span class="line"><span class="string">    一个代表浮点数的字符串，如&#x27;0.5&#x27;</span></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line">.to_rgba(arg, alpha=<span class="literal">None</span>)：转换其他类型的颜色到标准的rgba四元组</span><br><span class="line">.to_rgba_array(c, alpha=<span class="literal">None</span>)：它返回一个ndarray，而不是一个元组</span><br><span class="line">colors.colorConverter是模块提供的一个默认的实例。</span><br></pre></td></tr></table></figure><br />
<strong>Ⅲ、颜色条</strong><br />
通过 plt.colorbar() 函数就可以创建最简单的颜色条：<br />
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> matplotlib.pyplot <span class="keyword">as</span> plt</span><br><span class="line">%matplotlib inline</span><br><span class="line"><span class="keyword">import</span> numpy <span class="keyword">as</span> np</span><br><span class="line">plt.style.use(<span class="string">&#x27;classic&#x27;</span>)</span><br><span class="line"></span><br><span class="line">x = np.linspace(<span class="number">0</span>, <span class="number">10</span>, <span class="number">1000</span>)</span><br><span class="line">I = np.sin(x) * np.cos(x[:, np.newaxis])</span><br><span class="line">plt.imshow(I)</span><br><span class="line">plt.colorbar()</span><br></pre></td></tr></table></figure><br />
可以通过 cmap 参数配置调色盘，下面详细介绍下调色盘和配色方案等。<br />
<strong>1、调色盘</strong><br />
参考调色盘：<span class="exturl" data-url="aHR0cHM6Ly9tYXRwbG90bGliLm9yZy8yLjAuMi9leGFtcGxlcy9jb2xvci9jb2xvcm1hcHNfcmVmZXJlbmNlLmh0bWw=">colormaps<i class="fa fa-external-link-alt"></i></span>。</p>
<p>matplotlib.cm模块包含了一系列的colormap，以及相关的函数。它主要有两个函数：<br />
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line">matplotlib.cm.get_cmap(name=<span class="literal">None</span>, lut=<span class="literal">None</span>)：获取一个colormap实例。</span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">name：指定了colormap的名字。如果为None，则使用rc配置。如果它已经是colormap实例，则直接返回该实例。</span></span><br><span class="line"><span class="string">      注意：register_cmap注册的colormap优先查询</span></span><br><span class="line"><span class="string">lut：一个整数。如果非None，则指定了查询表的number of entries</span></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line">matplotlib.cm.register_cmap(name=<span class="literal">None</span>, cmap=<span class="literal">None</span>, data=<span class="literal">None</span>, lut=<span class="literal">None</span>)：注册一个colormap。有两种使用方式：</span><br><span class="line">    register_cmap(name=<span class="string">&#x27;swirly&#x27;</span>, cmap=swirly_cmap)：此时cmap参数必须是mpl.colors.Colormap实例。</span><br><span class="line">                                                    name默认为该Colormap实例的.name属性。</span><br><span class="line">    register_cmap(name=<span class="string">&#x27;choppy&#x27;</span>, data=choppydata, lut=<span class="number">128</span>)：</span><br><span class="line">                    此时这三个参数传递给mpl.colors.LinearSegementedColormap初始化函数。</span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">配色方案都在 plt.cm 命名空间（name）里面，如下:</span></span><br><span class="line"><span class="string">&#x27;Perceptually Uniform Sequential&#x27;:[&#x27;viridis&#x27;, &#x27;inferno&#x27;, &#x27;plasma&#x27;, &#x27;magma&#x27;]</span></span><br><span class="line"><span class="string">  &#x27;Sequential&#x27;:[&#x27;Blues&#x27;, &#x27;BuGn&#x27;, &#x27;BuPu&#x27;,&#x27;GnBu&#x27;, &#x27;Greens&#x27;, &#x27;Greys&#x27;, &#x27;Oranges&#x27;, &#x27;OrRd&#x27;,</span></span><br><span class="line"><span class="string">  &#x27;PuBu&#x27;, &#x27;PuBuGn&#x27;, &#x27;PuRd&#x27;, &#x27;Purples&#x27;, &#x27;RdPu&#x27;,&#x27;Reds&#x27;, &#x27;YlGn&#x27;, &#x27;YlGnBu&#x27;, </span></span><br><span class="line"><span class="string">  &#x27;YlOrBr&#x27;, &#x27;YlOrRd&#x27;]</span></span><br><span class="line"><span class="string">  &#x27;Sequential (2)&#x27;:[&#x27;afmhot&#x27;, &#x27;autumn&#x27;, &#x27;bone&#x27;, &#x27;cool&#x27;,&#x27;copper&#x27;, &#x27;gist_heat&#x27;, &#x27;gray&#x27;, </span></span><br><span class="line"><span class="string">  &#x27;hot&#x27;,&#x27;pink&#x27;, &#x27;spring&#x27;, &#x27;summer&#x27;, &#x27;winter&#x27;] </span></span><br><span class="line"><span class="string">  &#x27;Diverging&#x27;:[&#x27;BrBG&#x27;, &#x27;bwr&#x27;, &#x27;coolwarm&#x27;, &#x27;PiYG&#x27;, &#x27;PRGn&#x27;, &#x27;PuOr&#x27;,</span></span><br><span class="line"><span class="string">  &#x27;RdBu&#x27;, &#x27;RdGy&#x27;, &#x27;RdYlBu&#x27;, &#x27;RdYlGn&#x27;, &#x27;Spectral&#x27;,&#x27;seismic&#x27;] </span></span><br><span class="line"><span class="string">  &#x27;Qualitative&#x27;:[&#x27;Accent&#x27;, &#x27;Dark2&#x27;, &#x27;Paired&#x27;, &#x27;Pastel1&#x27;, &#x27;Pastel2&#x27;,</span></span><br><span class="line"><span class="string">  &#x27;Set1&#x27;, &#x27;Set2&#x27;, &#x27;Set3&#x27;] </span></span><br><span class="line"><span class="string">  &#x27;Miscellaneous&#x27;:[&#x27;gist_earth&#x27;, &#x27;terrain&#x27;, &#x27;ocean&#x27;, &#x27;gist_stern&#x27;,&#x27;brg&#x27;,</span></span><br><span class="line"><span class="string">  &#x27;CMRmap&#x27;, &#x27;cubehelix&#x27;,&#x27;gnuplot&#x27;, &#x27;gnuplot2&#x27;,   </span></span><br><span class="line"><span class="string">  &#x27;gist_ncar&#x27;,&#x27;nipy_spectral&#x27;, &#x27;jet&#x27;, &#x27;rainbow&#x27;,</span></span><br><span class="line"><span class="string">  &#x27;gist_rainbow&#x27;, &#x27;hsv&#x27;, &#x27;flag&#x27;, &#x27;prism&#x27;] </span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">可使用 plt.cm.&lt;TAB&gt; 查看这些配色方案。</span></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br></pre></td></tr></table></figure><br />
可以使用cm.get_cmap('winter')来使用，也可以直接用cm.winter来使用。</p>
<p>很多函数中有 cmap 参数，就是使用的调色盘。<br />
<strong>2、配色方案</strong><br />
一般情况下，你只需要重点关注三种不同的配色方案：<br />
（1）顺序配色方案：由一组连续的颜色构成的配色方案（例如 binary 或
viridis）。<br />
（2）互逆配色方案：通常由两种互补的颜色构成，表示正反两种含义（例如 RdBu
或 PuOr）。<br />
（3）定性配色方案：随机顺序的一组颜色（例如 rainbow 或 jet）</p>
<p>jet 是一种定性配色方案，曾是 Matplotlib 2.0
之前所有版本的默认配色方案。把它作为默认配色方案实在不是个好主意，因为定性配色方案在对定性数据进行可视化时的选择空间非常有限。随着图形亮度的提高，经常会出现颜色无法区分的问题。</p>
<p>更好的配色方案是 viridis，已经成为 Matplotlib 2.0
的默认配色方案。它采用了精心设计的亮度渐变方式，这样不仅便于视觉观察，而且转换成灰度图后也更清晰。<br />
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># jet 转换为黑白的灰度图看看具体的颜色</span></span><br><span class="line"><span class="keyword">from</span> matplotlib.colors <span class="keyword">import</span> LinearSegmentedColormap</span><br><span class="line"><span class="keyword">def</span> <span class="title function_">grayscale_cmap</span>(<span class="params">cmap</span>):</span><br><span class="line">    <span class="string">&quot;&quot;&quot;为配色方案显示灰度图&quot;&quot;&quot;</span></span><br><span class="line">    cmap = plt.cm.get_cmap(cmap)</span><br><span class="line">    colors = cmap(np.arange(cmap.N))</span><br><span class="line"></span><br><span class="line">    <span class="comment"># 将RGBA色转换为不同亮度的灰度值</span></span><br><span class="line">    <span class="comment"># 参考链接http://alienryderflex.com/hsp.html</span></span><br><span class="line">    RGB_weight = [<span class="number">0.299</span>, <span class="number">0.587</span>, <span class="number">0.114</span>]</span><br><span class="line">    luminance = np.sqrt(np.dot(colors[:, :<span class="number">3</span>] ** <span class="number">2</span>, RGB_weight))</span><br><span class="line">    colors[:, :<span class="number">3</span>] = luminance[:, np.newaxis]</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> LinearSegmentedColormap.from_list(cmap.name + <span class="string">&quot;_gray&quot;</span>, colors, cmap.N)</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">view_colormap</span>(<span class="params">cmap</span>):</span><br><span class="line">    <span class="string">&quot;&quot;&quot;用等价的灰度图表示配色方案&quot;&quot;&quot;</span></span><br><span class="line">    cmap = plt.cm.get_cmap(cmap)</span><br><span class="line">    colors = cmap(np.arange(cmap.N))</span><br><span class="line"></span><br><span class="line">    cmap = grayscale_cmap(cmap)</span><br><span class="line">    grayscale = cmap(np.arange(cmap.N))</span><br><span class="line"></span><br><span class="line">    fig, ax = plt.subplots(<span class="number">2</span>, figsize=(<span class="number">6</span>, <span class="number">2</span>), subplot_kw=<span class="built_in">dict</span>(xticks=[], yticks=[]))</span><br><span class="line"></span><br><span class="line">    <span class="comment"># 每个配色方案都有2个图：色彩图、灰度图</span></span><br><span class="line">    ax[<span class="number">0</span>].imshow([colors], extent=[<span class="number">0</span>, <span class="number">10</span>, <span class="number">0</span>, <span class="number">1</span>])</span><br><span class="line">    ax[<span class="number">1</span>].imshow([grayscale], extent=[<span class="number">0</span>, <span class="number">10</span>, <span class="number">0</span>, <span class="number">1</span>])</span><br><span class="line"></span><br><span class="line"><span class="comment"># jet 黑白</span></span><br><span class="line">view_colormap(<span class="string">&#x27;jet&#x27;</span>)</span><br><span class="line"><span class="comment"># viridis</span></span><br><span class="line">view_colormap(<span class="string">&#x27;viridis&#x27;</span>)</span><br><span class="line"><span class="comment"># cubehelix 彩虹色</span></span><br><span class="line">view_colormap(<span class="string">&#x27;cubehelix&#x27;</span>)</span><br><span class="line"><span class="comment"># 要用两种颜色表示正反两种含义时，可以使用 RdBu 双色配色方案，红色-蓝色（Red-Blue简称）</span></span><br><span class="line">view_colormap(<span class="string">&#x27;RdBu&#x27;</span>)</span><br></pre></td></tr></table></figure><br />
<img src="https://i.loli.net/2021/05/24/gD14zfP3vbuY8ds.jpg" /></p>
<p><strong>3、颜色条刻度等设置</strong><br />
Matplotlib 提供了丰富的颜色条配置功能。由于可以将颜色条本身仅看作是一个
plt.Axes实例，因此所有关于坐标轴和刻度值的格式配置技巧都可以派上用场。<br />
例如，我们可以缩短颜色取值的上下限，对于超出上下限的数据，通过 extend
参数用三角箭头表示比上限大的数或者比下限小的数。比如你想展示一张噪点图：<br />
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 为图形像素设置1%噪点</span></span><br><span class="line">x = np.linspace(<span class="number">0</span>, <span class="number">10</span>, <span class="number">1000</span>)</span><br><span class="line">I = np.sin(x) * np.cos(x[:, np.newaxis])</span><br><span class="line">speckles = (np.random.random(I.shape) &lt; <span class="number">0.01</span>)</span><br><span class="line">I[speckles] = np.random.normal(<span class="number">0</span>, <span class="number">3</span>, np.count_nonzero(speckles))</span><br><span class="line"></span><br><span class="line">plt.figure(figsize=(<span class="number">10</span>, <span class="number">3.5</span>))</span><br><span class="line"></span><br><span class="line">plt.subplot(<span class="number">1</span>, <span class="number">2</span>, <span class="number">1</span>)</span><br><span class="line">plt.imshow(I, cmap=<span class="string">&#x27;RdBu&#x27;</span>)</span><br><span class="line">plt.colorbar()</span><br><span class="line"></span><br><span class="line">plt.subplot(<span class="number">1</span>, <span class="number">2</span>, <span class="number">2</span>)</span><br><span class="line">plt.imshow(I, cmap=<span class="string">&#x27;RdBu&#x27;</span>)</span><br><span class="line">plt.colorbar(extend=<span class="string">&#x27;both&#x27;</span>)</span><br><span class="line">plt.clim(-<span class="number">1</span>, <span class="number">1</span>)</span><br></pre></td></tr></table></figure><br />
<img src="https://i.loli.net/2021/05/24/OJdV6aQhq7iGgKl.jpg" /><br />
左边那幅图是用默认的颜色条刻度限制实现的效果，噪点的范围完全覆盖了我们感兴趣的数据。而右边的图形设置了颜色条的刻度上下限，并在上下限之外增加了扩展功能，这样的数据可视化图形显然更有效果。</p>
<p><strong>4、离散型颜色条</strong><br />
虽然颜色条默认都是连续的，但有时你可能也需要表示离散数据。最简单的做法就是使用<code>plt.cm.get_cmap()</code>函数，将适当的配色方案的名称以及需要的区间数量传进去即可。<br />
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">plt.imshow(I, cmap=plt.cm.get_cmap(<span class="string">&#x27;Blues&#x27;</span>, <span class="number">6</span>))</span><br><span class="line">plt.colorbar()</span><br><span class="line">plt.clim(-<span class="number">1</span>, <span class="number">1</span>) <span class="comment"># 设置颜色区间</span></span><br></pre></td></tr></table></figure><br />
<img src="https://i.loli.net/2021/05/24/odkw4xtLuQbl9hK.jpg"
alt="离散颜色条.jpg" /></p>
<h2 id="点的形状">点的形状</h2>
<p>参考<span class="exturl" data-url="aHR0cHM6Ly9tYXRwbG90bGliLm9yZy9zdGFibGUvYXBpL21hcmtlcnNfYXBpLmh0bWw=">matplotlib.markers<i class="fa fa-external-link-alt"></i></span>。<br />
<img src="https://i.loli.net/2021/05/24/4WHxe6LDfpvOzEu.png"
alt="marker形状.jpg" /></p>
<h2 id="子图布局">子图布局</h2>
<p><code>pyplot.subplot2grid()</code>：创建网格布局。你只需要提供网格形状以及SubPlot位置即可，如：<br />
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">plt.subplot2grid((<span class="number">2</span>,<span class="number">2</span>),(<span class="number">0</span>,<span class="number">0</span>))</span><br><span class="line"><span class="comment"># 它等价于ax=pyplot.subplot(2,2,1)。其中subplot2grid()的位置坐标从0开始。</span></span><br></pre></td></tr></table></figure><br />
<code>subplot2grid()</code>支持SubPlot横跨或者纵跨多个单元格。colspan关键字参数指定纵向的跨度；rowspanguan尖子参数指定横向的跨度。<br />
<strong>1、单个子图</strong><br />
<code>Figure.add_subplot(*args,**kwargs)</code>/<code>pyplot.subplot(*args,**kwargs)</code>方法做一个子图布局，它返回的是Axes实例。SubPlot类是Axes类的子类。因此SubPlot对象也是Axes对象。<br />
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">matplotlib.pyplot.subplot(nrows,ncols,plot_number)：创建子图</span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">nrows和ncols将图表划分成nrows*ncols大小的网格区域，每一个区域都能存放一个子图；</span></span><br><span class="line"><span class="string">plot_number子图位置。从1开始，从左到右，从上到下，最大值为nrows*ncols。</span></span><br><span class="line"><span class="string">如果nrows、ncols、plot_number都是个位数，则你可以指定一个三位数来简化函数调用plt.subplot(integer)：</span></span><br><span class="line"><span class="string">    其中百分位代表nrows，十分位代表ncols，各位代表plot_number。</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">其他参数：</span></span><br><span class="line"><span class="string">axisbg：指定subplot的背景色</span></span><br><span class="line"><span class="string">polar：指定subplot是否是极坐标。默认为False</span></span><br><span class="line"><span class="string">projection：指定坐标方式。值可以为：</span></span><br><span class="line"><span class="string">            &#x27;aitoff&#x27;、&#x27;hammer&#x27;、&#x27;lambert&#x27;、&#x27;mollweide&#x27;、</span></span><br><span class="line"><span class="string">            &#x27;polar&#x27;、 &#x27;rectilinear&#x27;。当projection=&#x27;polar&#x27;等价于ploar=True</span></span><br><span class="line"><span class="string">sharex关键字参数：指定subplot与其他Axes(由该参数值指定）共享xaxis attribute</span></span><br><span class="line"><span class="string">sharey关键字参数：指定subplot是否与其他Axes(由该参数值指定）共享yaxis attribute</span></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br></pre></td></tr></table></figure><br />
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># subplot，下图左</span></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">1</span>, <span class="number">7</span>):</span><br><span class="line">    plt.subplot(<span class="number">2</span>, <span class="number">3</span>, i)</span><br><span class="line">    plt.text(<span class="number">0.5</span>, <span class="number">0.5</span>, <span class="built_in">str</span>((<span class="number">2</span>, <span class="number">3</span>, i)), fontsize=<span class="number">18</span>, ha=<span class="string">&#x27;center&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># subplots_adjust 调整位置和间距，下图右</span></span><br><span class="line">fig = plt.figure()</span><br><span class="line">fig.subplots_adjust(hspace=<span class="number">0.4</span>, wspace=<span class="number">0.4</span>)</span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">1</span>, <span class="number">7</span>):</span><br><span class="line">    ax = fig.add_subplot(<span class="number">2</span>, <span class="number">3</span>, i)</span><br><span class="line">    ax.text(<span class="number">0.5</span>, <span class="number">0.5</span>, <span class="built_in">str</span>((<span class="number">2</span>, <span class="number">3</span>, i)), fontsize=<span class="number">18</span>, ha=<span class="string">&#x27;center&#x27;</span>)</span><br></pre></td></tr></table></figure><br />
<div class="group-picture"><div class="group-picture-row"><div class="group-picture-column"><img src="https://i.loli.net/2021/05/24/kf7Dix3pEBbK4lj.jpg" /></div><div class="group-picture-column"><img src="https://i.loli.net/2021/05/24/SowXgFQlE1di23M.jpg" /></div></div></div></p>
<p><strong>2、多个子图</strong><br />
可以通过<code>pyplot.subplots()</code>函数一次性的创建多个SubPlot。<br />
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line">matplotlib.pyplot.subplots(*args,**kwargs)</span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">nrows：行数，默认为1</span></span><br><span class="line"><span class="string">ncols：列数，默认为1</span></span><br><span class="line"><span class="string">sharex：</span></span><br><span class="line"><span class="string">        如果为True，则所有SubPlot的X axis被共享。此时只有最后一行的X轴可见。</span></span><br><span class="line"><span class="string">        如果为False，则SubPlot的X axis不共享，每一个SbuPlot的X轴可见。</span></span><br><span class="line"><span class="string">        如果为字符串all，则等效于True</span></span><br><span class="line"><span class="string">        如果为字符串none，则当小于False</span></span><br><span class="line"><span class="string">        如果为字符串row，则每一行的SubPlot共享一个X轴（与False等效）</span></span><br><span class="line"><span class="string">        如果为字符串col，则每一列的SubPlot共享一个X轴（与True等效）</span></span><br><span class="line"><span class="string">sharey：</span></span><br><span class="line"><span class="string">        如果为True，则所有SubPlot的Y axis被共享。此时只有第一列的Y轴可见。</span></span><br><span class="line"><span class="string">        如果为False，则SubPlot的Y axis不共享，每一个SbuPlot的Y轴可见。</span></span><br><span class="line"><span class="string">        如果为字符串all，则等效于True</span></span><br><span class="line"><span class="string">        如果为字符串none，则当小于False</span></span><br><span class="line"><span class="string">        如果为字符串row，则每一行的SubPlot共享一个Y轴（与True等效）</span></span><br><span class="line"><span class="string">        如果为字符串col，则每一列的SubPlot共享一个Y轴（与False等效）</span></span><br><span class="line"><span class="string">squeeze：</span></span><br><span class="line"><span class="string">        如果为True：</span></span><br><span class="line"><span class="string">                    如果只创建了一个SubPlot，则返回一个变量（创建的SubPlot对象)</span></span><br><span class="line"><span class="string">                    如果创建了N*1或者1*N个SubPlot，则返回一个1维向量</span></span><br><span class="line"><span class="string">                    如果创建了N*M个SubPlot（其中N&gt;1,M&gt;1），则返回一个2维向量</span></span><br><span class="line"><span class="string">                    如果为False则始终返回一个2维向量</span></span><br><span class="line"><span class="string">        如果为False则始终返回一个2维向量</span></span><br><span class="line"><span class="string">subplot_kw：一个字典参数，用于传递给Axes.add_subplot()来创建SubPlot</span></span><br><span class="line"><span class="string">gridspec_kw：一个字典参数，用于传递给GridSpec构造函数来创建SubPlot存放的网格</span></span><br><span class="line"><span class="string">fig_kw：一个字典参数，用于传递给pyplot.figure()函数。所有前述未能识别的感激案子参数都会传到这里。</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">其返回值为figure,ax。其中figure是一个Figure对象；ax取决于squeeze参数。</span></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br></pre></td></tr></table></figure><br />
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 创建一个 2×3 网格子图，每行的3个子图使用相同的y轴坐标，每列的2个子图使用相同的x轴坐标</span></span><br><span class="line"><span class="comment"># 设置 sharex 与 sharey 参数之后，我们就可以自动去掉网格内部子图的标签，让图形看起来更整洁</span></span><br><span class="line">fig, ax = plt.subplots(<span class="number">2</span>, <span class="number">3</span>, sharex=<span class="string">&#x27;col&#x27;</span>, sharey=<span class="string">&#x27;row&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 坐标轴存放在一个NumPy数组中，按照[row, col]取值</span></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">2</span>):</span><br><span class="line">    <span class="keyword">for</span> j <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">3</span>):</span><br><span class="line">        ax[i, j].text(<span class="number">0.5</span>, <span class="number">0.5</span>, <span class="built_in">str</span>((i, j)), fontsize=<span class="number">18</span>, ha=<span class="string">&#x27;center&#x27;</span>)</span><br></pre></td></tr></table></figure><br />
<img src="https://i.loli.net/2021/05/24/ngr1q8p6bUwlRTH.jpg"
alt="subplots.jpg" /></p>
<p><strong>3、不规则子图</strong><br />
实现不规则的多行多列子图网格，<code>plt.GridSpec()</code>是最好的工具。<code>plt.GridSpec()</code>对象本身不能直接创建一个图形，它只是<code>plt.subplot()</code>命令可以识别的简易接口。<br />
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 一个带行列间距的2×3网格</span></span><br><span class="line">grid = plt.GridSpec(<span class="number">2</span>, <span class="number">3</span>, wspace=<span class="number">0.4</span>, hspace=<span class="number">0.3</span>)</span><br><span class="line"><span class="comment"># 类似 Python 切片的语法设置子图的位置和扩展尺寸</span></span><br><span class="line">plt.subplot(grid[<span class="number">0</span>, <span class="number">0</span>])</span><br><span class="line">plt.subplot(grid[<span class="number">0</span>, <span class="number">1</span>:])</span><br><span class="line">plt.subplot(grid[<span class="number">1</span>, :<span class="number">2</span>])</span><br><span class="line">plt.subplot(grid[<span class="number">1</span>, <span class="number">2</span>])</span><br></pre></td></tr></table></figure><br />
<img src="https://i.loli.net/2021/05/24/3XnAv6cjaQxEdiZ.jpg" /></p>
<p>这种灵活的网格排列方式用途十分广泛，我经常会用它来创建多轴频次直方图：<br />
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 创建一些正态分布数据</span></span><br><span class="line">mean = [<span class="number">0</span>, <span class="number">0</span>]</span><br><span class="line">cov = [[<span class="number">1</span>, <span class="number">1</span>], [<span class="number">1</span>, <span class="number">2</span>]]</span><br><span class="line">x, y = np.random.multivariate_normal(mean, cov, <span class="number">3000</span>).T</span><br><span class="line"></span><br><span class="line"><span class="comment"># 设置坐标轴和网格配置方式</span></span><br><span class="line">fig = plt.figure(figsize=(<span class="number">6</span>, <span class="number">6</span>))</span><br><span class="line">grid = plt.GridSpec(<span class="number">4</span>, <span class="number">4</span>, hspace=<span class="number">0.2</span>, wspace=<span class="number">0.2</span>)</span><br><span class="line">main_ax = fig.add_subplot(grid[:-<span class="number">1</span>, <span class="number">1</span>:])</span><br><span class="line">y_hist = fig.add_subplot(grid[:-<span class="number">1</span>, <span class="number">0</span>], xticklabels=[], sharey=main_ax)</span><br><span class="line">x_hist = fig.add_subplot(grid[-<span class="number">1</span>, <span class="number">1</span>:], yticklabels=[], sharex=main_ax)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 主坐标轴画散点图</span></span><br><span class="line">main_ax.plot(x, y, <span class="string">&#x27;ok&#x27;</span>, markersize=<span class="number">3</span>, alpha=<span class="number">0.2</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 次坐标轴画频次直方图</span></span><br><span class="line">x_hist.hist(x, <span class="number">40</span>, histtype=<span class="string">&#x27;stepfilled&#x27;</span>, orientation=<span class="string">&#x27;vertical&#x27;</span>, color=<span class="string">&#x27;gray&#x27;</span>)</span><br><span class="line">x_hist.invert_yaxis()</span><br><span class="line"></span><br><span class="line">y_hist.hist(y, <span class="number">40</span>, histtype=<span class="string">&#x27;stepfilled&#x27;</span>, orientation=<span class="string">&#x27;horizontal&#x27;</span>, color=<span class="string">&#x27;gray&#x27;</span>)</span><br><span class="line">y_hist.invert_xaxis()</span><br></pre></td></tr></table></figure><br />
<img src="https://i.loli.net/2021/05/24/bGk2wdTjIY14KyP.jpg" /></p>
<h2 id="坐标变换">坐标变换</h2>
<p>matplotlib中有四个坐标系：<br />
（1）data坐标系：坐标转换对象为ax.transData。它是用户级坐标系，由xlim和ylim控制。<br />
（2）Axes坐标系：坐标转换对象为ax.transAxes。它是Axes的坐标系，(0,0)为Axes的左下角，(1,1)为Axes的右上角。<br />
（3）Figure坐标系：坐标转换对象为fig.transFigure。它是Figure的坐标系，(0,0)为Figure的左下角，(1,1)为Figure的右上角。<br />
（4）display坐标系：它没有坐标转换对象。它显示的是display的像素坐标系，(0,0)为display左下角、(width,height)为display右上角。</p>
<p>前面三个坐标系的坐标转换对象有方法执行坐标转换，这些方法接受输入并产生输出：<strong>输入为本坐标系内的坐标点，输出为display坐标系中的坐标</strong>。（因此display坐标系没有坐标转换对象）。当然他们也有相关方法将来自于display坐标系中的坐标转换回本坐标系内的坐标。</p>
<p>一共有三种预定义的坐标变换方式：<br />
（1）ax.transData：以数据为基准的坐标变换。改变了坐标轴上下限，那么只有transData坐标会受影响。<br />
（2）ax.transAxes：以坐标轴为基准的坐标变换（以坐标轴维度为单位）。<br />
（3）fig.transFigure：以图形为基准的坐标变换（以图形维度为单位）。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">fig, ax = plt.subplots(facecolor=<span class="string">&#x27;lightgray&#x27;</span>)</span><br><span class="line">ax.axis([<span class="number">0</span>, <span class="number">10</span>, <span class="number">0</span>, <span class="number">10</span>])</span><br><span class="line"><span class="comment"># 在Artist的构造函数中传入 transform 关键字参数（其值为坐标转换对象），就能够切换坐标系</span></span><br><span class="line"><span class="comment"># 虽然transform=ax.transData是默认值，但还是设置一下</span></span><br><span class="line">ax.text(<span class="number">1</span>, <span class="number">5</span>, <span class="string">&quot;. Data: (1, 5)&quot;</span>, transform=ax.transData)</span><br><span class="line"><span class="comment"># 将Text放置于Axes坐标系中的(0.5,0.1)位置处</span></span><br><span class="line">ax.text(<span class="number">0.5</span>, <span class="number">0.1</span>, <span class="string">&quot;. Axes: (0.5, 0.1)&quot;</span>, transform=ax.transAxes)</span><br><span class="line">ax.text(<span class="number">0.2</span>, <span class="number">0.2</span>, <span class="string">&quot;. Figure: (0.2, 0.2)&quot;</span>, transform=fig.transFigure)</span><br><span class="line">plt.grid()</span><br></pre></td></tr></table></figure>
<p><img src="https://i.loli.net/2021/05/24/u8ACsBVSK7DeZjG.jpg" /><br />
transData坐标用x轴与y轴的标签作为数据坐标。<br />
transAxes坐标以坐标轴（图中白色矩形）左下角的位置为原点，按坐标轴尺寸的比例呈现坐标。<br />
transFigure坐标与之类似，不过是以图形（图中灰色矩形）左下角的位置为原点，按图形尺寸的比例呈现坐标。</p>
<p>通常不建议直接使用display坐标系。因为它固定了绝对坐标，导致resize图表时你必须重新定位坐标。所以必须监听resize事件，非常麻烦。<br />
<strong>1、 用户的 data 坐标系</strong><br />
当调用<code>ax.set_xlimit(x_min,x_max)</code>以及<code>ax.set_ylimit(y_min,y_max)</code>时，即建立起了用户data坐标系。左下角坐标为<code>(x_min,y_min)</code>，右上角坐标为<code>(x_max,y_max)</code>。<br />
有时候你可能并没有显式调用<code>.set_xlimit()</code>以及<code>.set_ylimit()</code>。其实matplotlib会隐式调用它们来设置坐标轴的数据范围。</p>
<p>可以调用ax.transData返回data坐标系的坐标转换对象。<br />
对该坐标转换对象调用<code>.transform(point)</code>方法会返回point在display坐标系下的坐标。其中point是点在data坐标系下的坐标(x,y)。你也可以给<code>.transform()</code>方法一次传入多个点的坐标，此时输出也是对应于display坐标系下的一系列坐标。<br />
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> matplotlib.pyplot <span class="keyword">as</span> plt</span><br><span class="line"></span><br><span class="line">fig = plt.figure()</span><br><span class="line">ax = fig.add_subplot(<span class="number">111</span>)</span><br><span class="line">ax.set_xlim(<span class="number">0</span>, <span class="number">10</span>)</span><br><span class="line">ax.set_ylim(-<span class="number">1</span>, <span class="number">1</span>)</span><br><span class="line"><span class="comment"># type(ax.transData)</span></span><br><span class="line">ax.transData.transform((<span class="number">5</span>, <span class="number">0</span>))</span><br></pre></td></tr></table></figure><br />
可以对ax.trandData返回的坐标转换对象调用<code>.inverted()</code>方法。该方法返回的是一个坐标逆转换对象。对该坐标逆转换对象调用<code>.transform(point)</code>方法会返回point在data坐标系下的坐标。其中point是点在display坐标系下的坐标(x,y)。你也可以给<code>.transform()</code>方法一次传入多个点的坐标，此时输出也是对应于data坐标系下的一系列坐标。</p>
<p>当你调用了<code>ax.set_xlim()</code>或者<code>ax.set_ylim()</code>时，坐标转换对象会实时更新。</p>
<p><strong>2、Axes 坐标系</strong><br />
在Axes坐标系中，(0,0)位于Axes的左下角，(1,1)位于Axes的右上角，(0.5,0.5)位于Axes的中心。当然你可以引用位于这之外的点，如(-0.1,1.1)。</p>
<p>通常如果你需要在Axes中放置一些文字说明，那么一般都是采用Axes坐标系来定位。这样无论图形怎么缩放，这些Text都能位于正确的位置。</p>
<p>你也可以在Axes中通过Axes坐标系添加一些Patch，但是通常建议在data坐标系下添加。因为你在Axes中添加的图表当图表缩放时可能会出现问题。</p>
<p><strong>3、混合坐标系</strong><br />
有时候你需要混合data坐标系和Axes坐标系。通过<code>matplotlib.transforms.blended_transform_factory(ax.transData, ax.transAxes)</code>能够返回一个混合坐标系，该坐标系中：x坐标为data坐标系，y坐标为Axes坐标系。因此该坐标系中(1,1)表示的是data坐标系中x=1但是y位于最上方的点。</p>
<p>有两个函数返回特定的混合坐标系：<br />
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">matplotlib.axes.Axes.get_xaxis_transform():</span><br><span class="line"><span class="comment"># 等价于matplotlib.transforms.blended_transform_factory(ax.transData, ax.transAxes)</span></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">x坐标为data坐标系，y坐标为Axes坐标系。常用于绘制x轴的label、tick、gridline。</span></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line">matplotlib.axes.Axes.get_yaxis_transform():</span><br><span class="line"><span class="comment"># 等价于matplotlib.transforms.blended_transform_factory(ax.transAxes,ax.transData)</span></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">x坐标为Axes坐标系，y坐标为data坐标系。常用于绘制y轴的label、tick、gridline。</span></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br></pre></td></tr></table></figure><br />
<strong>4、其他坐标系</strong><br />
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 下面2个方法，可以设置x轴/y轴是否对数坐标</span></span><br><span class="line">Axes.set_xscale(value,**kwargs)</span><br><span class="line">Axes.set_yscale(value,**kwargs)</span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">其中value可以为:</span></span><br><span class="line"><span class="string">    linear：线性</span></span><br><span class="line"><span class="string">    log：对数。其中basex|basey关键字指定对数的基</span></span><br><span class="line"><span class="string">    logit：以2为底的对数</span></span><br><span class="line"><span class="string">    symlog：对数，其中basex|basey关键字指定对数的基</span></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="comment"># 你也可以通过下面2个方法，来设置对数坐标。一定要先添加数据后设置对数坐标。</span></span><br><span class="line">matplotlib.pyplot.xscale()</span><br><span class="line">matplotlib.pyplot.yscale()</span><br></pre></td></tr></table></figure><br />
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 下面2个方法，可以创建一个极坐标的Axes。</span></span><br><span class="line"><span class="comment"># Figure.add_subplot(...)也是同样的设置</span></span><br><span class="line">Figure.add_axes((left,bottom,width,height),projection=<span class="string">&#x27;polar&#x27;</span>)</span><br><span class="line">Figure.add_axes((left,bottom,width,height), polar=<span class="literal">True</span>)</span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">projection: 不仅可以设置极坐标，还可以设置自定义坐标（它将坐标统一为映射关系）。</span></span><br><span class="line"><span class="string">polar: 为了兼容旧代码，新代码推荐用projection关键字</span></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br></pre></td></tr></table></figure></p>
<h2 id="箭头注释">箭头注释</h2>
<p>虽然有一个<code>plt.arrow()</code>函数可以实现这个功能，但是我不推荐使用它，因为它创建出的箭头是
SVG
向量图对象，会随着图形分辨率的变化而改变，最终的结果可能完全不是用户想要的。我要推荐的是<code>plt.annotate()</code>函数。这个函数既可以创建文字，也可以创建箭头，而且它创建的箭头能够进行非常灵活的配置。<br />
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">%matplotlib inline</span><br><span class="line">fig, ax = plt.subplots()</span><br><span class="line">x = np.linspace(<span class="number">0</span>, <span class="number">20</span>, <span class="number">1000</span>)</span><br><span class="line">ax.plot(x, np.cos(x))</span><br><span class="line">ax.axis(<span class="string">&#x27;equal&#x27;</span>)</span><br><span class="line">ax.annotate(<span class="string">&#x27;local maximum&#x27;</span>, xy=(<span class="number">6.28</span>, <span class="number">1</span>), xytext=(<span class="number">10</span>, <span class="number">4</span>), arrowprops=<span class="built_in">dict</span>(facecolor=<span class="string">&#x27;black&#x27;</span>, shrink=<span class="number">0.05</span>))</span><br><span class="line">ax.annotate(<span class="string">&#x27;local minimum&#x27;</span>, xy=(<span class="number">5</span> * np.pi, -<span class="number">1</span>), xytext=(<span class="number">2</span>, -<span class="number">6</span>), arrowprops=<span class="built_in">dict</span>(arrowstyle=<span class="string">&quot;-&gt;&quot;</span>,</span><br><span class="line">             connectionstyle=<span class="string">&quot;angle3,angleA=0,angleB=-90&quot;</span>))</span><br></pre></td></tr></table></figure><br />
<img src="https://i.loli.net/2021/05/25/Q6W3yDgvTPrEOV7.jpg"
alt="箭头注释.jpg" /></p>
<h2 id="自定义坐标轴刻度">自定义坐标轴刻度</h2>
<p>虽然 Matplotlib
默认的坐标轴定位器（locator）与格式生成器（formatter）可以满足大部分需求，但是并非对每一幅图都合适。通过其他的定位器和格式器，可以将坐标轴刻度调整为你需要的位置与格式。</p>
<p>常用的定位器：<br />
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">NullLocator         无刻度</span><br><span class="line">FixedLocator        刻度位置固定</span><br><span class="line">IndexLocator        用索引作为定位器（如 x = range(len(y)) ）</span><br><span class="line">LinearLocator       从 min 到 max 均匀分布刻度</span><br><span class="line">LogLocator          从 min 到 max 按对数分布刻度</span><br><span class="line">MultipleLocator     刻度和范围都是基数（base）的倍数</span><br><span class="line">MaxNLocator         为最大刻度找到最优位置</span><br><span class="line">AutoLocator        （默认）以 MaxNLocator 进行简单配置</span><br><span class="line">AutoMinorLocator    次要刻度的定位器</span><br></pre></td></tr></table></figure><br />
常用的和格式器：<br />
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">NullFormatter         刻度上无标签</span><br><span class="line">IndexFormatter        将一组标签设置为字符串</span><br><span class="line">FixedFormatter        手动为刻度设置标签</span><br><span class="line">FuncFormatter         用自定义函数设置标签</span><br><span class="line">FormatStrFormatter    为每个刻度值设置字符串格式</span><br><span class="line">ScalarFormatter       （默认）为标量值设置标签</span><br><span class="line">LogFormatter          对数坐标轴的默认格式生成器</span><br></pre></td></tr></table></figure></p>
<p>figure 对象，它其实就是一个盛放图形元素（子对象）的容器，例如每个
figure 都会包含一个或多个 axes 对象，每个 axes
对象又会包含其他表示图形内容的对象。坐标轴刻度线也不例外，每个 axes 都有
xaxis 和 yaxis
属性，每个属性同样包含构成坐标轴的线条、刻度和标签的全部属性。</p>
<p>每一个坐标轴都有<strong>主要</strong>刻度线与<strong>次要</strong>刻度线。<br />
在Matplotlib中，默认的刻度是由locator类控制，其中子类MultipleLocator和FormatStrFormatter负责位置和标签。</p>
<p>使用MultipleLocator自定义刻度位置，通过<code>set_xxx_locator()</code>设置：<br />
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">%matplotlib inline</span><br><span class="line"><span class="keyword">import</span> matplotlib.pyplot <span class="keyword">as</span> plt</span><br><span class="line"></span><br><span class="line"><span class="keyword">from</span> matplotlib.ticker <span class="keyword">import</span> MultipleLocator, FormatStrFormatter</span><br><span class="line">plt.figure(figsize=(<span class="number">7</span>,<span class="number">6</span>),dpi=<span class="number">100</span>)</span><br><span class="line">ax = plt.gca()</span><br><span class="line"></span><br><span class="line"><span class="comment"># 设置x，y轴上下限</span></span><br><span class="line">ax.set_xlim(<span class="number">0</span>,<span class="number">5</span>)</span><br><span class="line">ax.set_ylim(<span class="number">0</span>,<span class="number">5</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 设置x，y轴的主刻度器</span></span><br><span class="line"><span class="comment"># 隐藏刻度：plt.NullLocator()</span></span><br><span class="line">ax.xaxis.set_major_locator(MultipleLocator(<span class="number">1</span>))</span><br><span class="line">ax.yaxis.set_major_locator(MultipleLocator(<span class="number">1</span>))</span><br><span class="line"><span class="comment"># 设置x，y轴次刻度器</span></span><br><span class="line">ax.xaxis.set_minor_locator(MultipleLocator(<span class="number">0.25</span>))</span><br><span class="line">ax.yaxis.set_minor_locator(MultipleLocator(<span class="number">0.25</span>))</span><br></pre></td></tr></table></figure><br />
<img src="https://i.loli.net/2021/05/25/tyD9weG5VZh2RmP.jpg" /></p>
<p>通过FormatStrFormatter自定义刻度标签，通过<code>set_xxx_formatter()</code>设置：<br />
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 设置x轴主刻度标签格式</span></span><br><span class="line"><span class="comment"># 隐藏标签：plt.NullFormatter() </span></span><br><span class="line">ax.xaxis.set_major_formatter(plt.NullFormatter()) <span class="comment"># 主刻度隐藏，避免和次刻度标签重复显示</span></span><br><span class="line"><span class="comment"># 设置x，y轴次刻度标签格式</span></span><br><span class="line">ax.xaxis.set_minor_formatter(FormatStrFormatter(<span class="string">&#x27;%0.1f&#x27;</span>))</span><br><span class="line"></span><br><span class="line"><span class="comment"># 主次刻度线，标签长度</span></span><br><span class="line">ax.tick_params(which=<span class="string">&#x27;major&#x27;</span>,length=<span class="number">8</span>,labelsize=<span class="number">10</span>)</span><br><span class="line">ax.tick_params(which=<span class="string">&#x27;minor&#x27;</span>,length=<span class="number">4</span>)</span><br></pre></td></tr></table></figure><br />
必要时，可以用<code>plt.NullFormatter()</code>隐藏刻度。<br />
为了显示效果，用<code>tick_params()</code>设置了刻度长度和标签大小。<br />
<img src="https://i.loli.net/2021/05/25/7PHlOintrv6KfGI.jpg" /></p>
<p>还可以用<code>set_major_locator(plt.MaxNLocator(3))</code>设置刻度显示数量（这里是3），Matplotlib
会自动为刻度安排恰当的位置。<br />
还可以用<code>set_major_formatter(plt.FuncFormatter(format_func))</code>自定义标签格式。比如正弦余弦曲线刻度用<span
class="math inline">\(\pi\)</span>效果更改好：<br />
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line">%matplotlib inline</span><br><span class="line"><span class="keyword">import</span> matplotlib.pyplot <span class="keyword">as</span> plt</span><br><span class="line"><span class="keyword">import</span> numpy <span class="keyword">as</span> np</span><br><span class="line"></span><br><span class="line"><span class="comment"># 画正弦曲线和余弦曲线</span></span><br><span class="line">fig, ax = plt.subplots()</span><br><span class="line">x = np.linspace(<span class="number">0</span>, <span class="number">3</span> * np.pi, <span class="number">1000</span>)</span><br><span class="line">ax.plot(x, np.sin(x), lw=<span class="number">3</span>, label=<span class="string">&#x27;Sine&#x27;</span>)</span><br><span class="line">ax.plot(x, np.cos(x), lw=<span class="number">3</span>, label=<span class="string">&#x27;Cosine&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 设置网格、图例和坐标轴上下限</span></span><br><span class="line">ax.grid(<span class="literal">True</span>)</span><br><span class="line">ax.legend(frameon=<span class="literal">False</span>)</span><br><span class="line">ax.axis(<span class="string">&#x27;equal&#x27;</span>)</span><br><span class="line">ax.set_xlim(<span class="number">0</span>, <span class="number">3</span> * np.pi)</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">format_func</span>(<span class="params">value, tick_number</span>):</span><br><span class="line">    <span class="comment"># 找到π/2的倍数刻度</span></span><br><span class="line">    N = <span class="built_in">int</span>(np.<span class="built_in">round</span>(<span class="number">2</span> * value / np.pi))</span><br><span class="line">    <span class="keyword">if</span> N == <span class="number">0</span>:</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;0&quot;</span></span><br><span class="line">    <span class="keyword">elif</span> N == <span class="number">1</span>:</span><br><span class="line">        <span class="keyword">return</span> <span class="string">r&quot;$\pi/2$&quot;</span></span><br><span class="line">    <span class="keyword">elif</span> N == <span class="number">2</span>:</span><br><span class="line">        <span class="keyword">return</span> <span class="string">r&quot;$\pi$&quot;</span></span><br><span class="line">    <span class="keyword">elif</span> N % <span class="number">2</span> &gt; <span class="number">0</span>:</span><br><span class="line">        <span class="keyword">return</span> <span class="string">r&quot;$&#123;0&#125;\pi/2$&quot;</span>.<span class="built_in">format</span>(N)</span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        <span class="keyword">return</span> <span class="string">r&quot;$&#123;0&#125;\pi$&quot;</span>.<span class="built_in">format</span>(N // <span class="number">2</span>)</span><br><span class="line">ax.xaxis.set_major_formatter(plt.FuncFormatter(format_func))</span><br></pre></td></tr></table></figure><br />
<img src="https://i.loli.net/2021/05/25/styFqfZB8VRTdKW.jpg" /></p>
<h2 id="d绘图">3D绘图</h2>
<p>3D绘图与2D绘图的调用方法几乎相同，除了增加一个
<code>projection='3d'</code>
的关键字参数，<strong>使用projection参数，必须导入mplot3d模块</strong>。<br />
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> matplotlib.pyplot <span class="keyword">as</span> plt</span><br><span class="line"><span class="keyword">from</span> mpl_toolkits <span class="keyword">import</span> mplot3d</span><br><span class="line"><span class="keyword">from</span> mpl_toolkits.mplot3d <span class="keyword">import</span> Axes3D</span><br><span class="line"></span><br><span class="line">fig = plt.figure()</span><br><span class="line"><span class="comment"># 旧式写法</span></span><br><span class="line">ax = plt.axes(projection=<span class="string">&#x27;3d&#x27;</span>) </span><br><span class="line"><span class="comment"># 新式写法</span></span><br><span class="line">ax = Axes3D(fig) </span><br></pre></td></tr></table></figure><br />
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line">Axes3D.plot(xs, ys, *args, **kwargs): 绘制直线。</span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">xs,ys：点的 x,y坐标</span></span><br><span class="line"><span class="string">zs：点的z坐标。该值可以是一个标量（表示对所有点都取同一个值）；也可以是个数组或列表，表示每个点一个值</span></span><br><span class="line"><span class="string">zdir：指定那个是z轴。其值可以是&#x27;x&#x27;或者&#x27;y&#x27;或者&#x27;z&#x27;</span></span><br><span class="line"><span class="string">剩下的关键字参数与Axes.plot()相同</span></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line">Axes3D.scatter(xs, ys, zs=<span class="number">0</span>, zdir=’z’, s=<span class="number">20</span>, c=’b’, </span><br><span class="line">                depthshade=<span class="literal">True</span>, *args, **kwargs)：绘制散点图。</span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">xs,ys：点的 x,y坐标</span></span><br><span class="line"><span class="string">zs：点的z坐标。该值可以是一个标量（表示对所有点都取同一个值）；也可以是个数组或列表，表示每个点一个值</span></span><br><span class="line"><span class="string">zdir：指定那个是z轴。其值可以是&#x27;x&#x27;或者&#x27;y&#x27;或者&#x27;z&#x27;</span></span><br><span class="line"><span class="string">s：散点的大小（单位为 point^2).该值可以是一个标量（表示对所有点都取同一个值）；也可以是个数组或列表，表示每个点一个值</span></span><br><span class="line"><span class="string">c：散点的颜色。你可以将它设为一个颜色字符串，表示所有的点都是一个颜色。或者是个 cmap，指定颜色图</span></span><br><span class="line"><span class="string">depthshade：一个布尔值。如果为True，则通过对marker设置阴影来展示层次关系</span></span><br><span class="line"><span class="string">剩下的关键字参数与Axes.scatter()相同</span></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line">Axes3D.plot_wireframe(X, Y, Z, *args, **kwargs): 绘制线框。</span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">X,Y：点的 x,y坐标</span></span><br><span class="line"><span class="string">Z：点的z坐标。该值可以是一个标量（表示对所有点都取同一个值）；也可以是个数组或列表，表示每个点一个值</span></span><br><span class="line"><span class="string">rstride：行的步长</span></span><br><span class="line"><span class="string">cstride：列的步长</span></span><br><span class="line"><span class="string">剩下的关键字传递给LineCollection</span></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br></pre></td></tr></table></figure><br />
<strong>1、三维点图和线图</strong><br />
最基本的三维图是由<code>(x , y , z )</code>三维坐标点构成的线图与散点图。与二维图类似，可以用
<code>ax.plot3D</code> 与 <code>ax.scatter3D</code>
函数来创建它们。<br />
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">%matplotlib notebook</span><br><span class="line"><span class="keyword">import</span> numpy <span class="keyword">as</span> np</span><br><span class="line"><span class="keyword">import</span> matplotlib.pyplot <span class="keyword">as</span> plt </span><br><span class="line"><span class="keyword">from</span> mpl_toolkits.mplot3d <span class="keyword">import</span> Axes3D</span><br><span class="line"></span><br><span class="line">fig = plt.figure()</span><br><span class="line"><span class="comment"># 创建三维坐标轴</span></span><br><span class="line">ax = Axes3D(fig)</span><br><span class="line"><span class="comment"># 三维线的数据</span></span><br><span class="line">zline = np.linspace(<span class="number">0</span>, <span class="number">15</span>, <span class="number">1000</span>)</span><br><span class="line">xline = np.sin(zline)</span><br><span class="line">yline = np.cos(zline)</span><br><span class="line">ax.plot3D(xline, yline, zline, <span class="string">&#x27;gray&#x27;</span>)</span><br><span class="line"><span class="comment"># 三维散点的数据</span></span><br><span class="line">zdata = <span class="number">15</span> * np.random.random(<span class="number">100</span>)</span><br><span class="line">xdata = np.sin(zdata) + <span class="number">0.1</span> * np.random.randn(<span class="number">100</span>)</span><br><span class="line">ydata = np.cos(zdata) + <span class="number">0.1</span> * np.random.randn(<span class="number">100</span>)</span><br><span class="line">ax.scatter3D(xdata, ydata, zdata, c=zdata, cmap=<span class="string">&#x27;Greens&#x27;</span>)</span><br></pre></td></tr></table></figure><br />
<img src="https://i.loli.net/2021/05/25/6FqUkXK1TSMtRaH.jpg"
alt="三维点图和线图.jpg" /><br />
默认情况下，散点会自动改变透明度，以在平面上呈现出立体感。有时在静态图形上观察三维效果很费劲，通过交互视图就可以让所有数据点呈现出极佳的视觉效果。</p>
<p><strong>2、三维等高线图</strong><br />
与二维 <code>ax.contour()</code>
图形一样，<code>ax.contour3D()</code>要求所有数据都是二维网格数据的形式，并且由函数计算
z 轴数值。<br />
用三维正弦函数画的三维等高线图：<br />
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line">%matplotlib notebook</span><br><span class="line"><span class="keyword">import</span> numpy <span class="keyword">as</span> np</span><br><span class="line"><span class="keyword">import</span> matplotlib.pyplot <span class="keyword">as</span> plt </span><br><span class="line"><span class="keyword">from</span> mpl_toolkits.mplot3d <span class="keyword">import</span> Axes3D</span><br><span class="line"></span><br><span class="line">fig = plt.figure()</span><br><span class="line"><span class="comment"># 创建三维坐标轴</span></span><br><span class="line">ax = Axes3D(fig)</span><br><span class="line"><span class="comment"># 三维线的数据</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">f</span>(<span class="params">x, y</span>):</span><br><span class="line">    <span class="keyword">return</span> np.sin(np.sqrt(x ** <span class="number">2</span> + y ** <span class="number">2</span>))</span><br><span class="line"></span><br><span class="line">x = np.linspace(-<span class="number">6</span>, <span class="number">6</span>, <span class="number">30</span>)</span><br><span class="line">y = np.linspace(-<span class="number">6</span>, <span class="number">6</span>, <span class="number">30</span>)</span><br><span class="line"></span><br><span class="line">X, Y = np.meshgrid(x, y)</span><br><span class="line">Z = f(X, Y)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 三维等高线图</span></span><br><span class="line">ax.contour3D(X, Y, Z, <span class="number">50</span>, cmap=<span class="string">&#x27;binary&#x27;</span>)</span><br><span class="line">ax.set_xlabel(<span class="string">&#x27;x&#x27;</span>)</span><br><span class="line">ax.set_ylabel(<span class="string">&#x27;y&#x27;</span>)</span><br><span class="line">ax.set_zlabel(<span class="string">&#x27;z&#x27;</span>)</span><br></pre></td></tr></table></figure><br />
<img src="https://i.loli.net/2021/05/25/k3TDlJqXHmtAdhf.jpg"
alt="三维等高线图.jpg" /></p>
<p><code>iew_init</code> 可以调整观察角度与方位角，比如把俯仰角调整为 60
度（这里的 60 度是 x-y 平面的旋转角度），方位角调整为 35 度（就是绕 z
轴顺时针旋转 35 度）：<code>ax.view_init(60, 35)</code>。<br />
<strong>3、线框图和曲面图</strong><br />
它们都是将网格数据映射成三维曲面，比如线框图：<br />
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">%matplotlib notebook</span><br><span class="line"><span class="keyword">import</span> numpy <span class="keyword">as</span> np</span><br><span class="line"><span class="keyword">import</span> matplotlib.pyplot <span class="keyword">as</span> plt </span><br><span class="line"><span class="keyword">from</span> mpl_toolkits.mplot3d <span class="keyword">import</span> Axes3D</span><br><span class="line"></span><br><span class="line">fig = plt.figure()</span><br><span class="line"><span class="comment"># 创建三维坐标轴</span></span><br><span class="line">ax = Axes3D(fig)</span><br><span class="line"><span class="comment"># 三维线的数据</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">f</span>(<span class="params">x, y</span>):</span><br><span class="line">    <span class="keyword">return</span> np.sin(np.sqrt(x ** <span class="number">2</span> + y ** <span class="number">2</span>))</span><br><span class="line"></span><br><span class="line">x = np.linspace(-<span class="number">6</span>, <span class="number">6</span>, <span class="number">30</span>)</span><br><span class="line">y = np.linspace(-<span class="number">6</span>, <span class="number">6</span>, <span class="number">30</span>)</span><br><span class="line"></span><br><span class="line">X, Y = np.meshgrid(x, y)</span><br><span class="line">Z = f(X, Y)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 线框图</span></span><br><span class="line">ax.plot_wireframe(X, Y, Z, color=<span class="string">&#x27;black&#x27;</span>)</span><br><span class="line">ax.set_title(<span class="string">&#x27;wireframe&#x27;</span>)</span><br></pre></td></tr></table></figure><br />
<img src="https://i.loli.net/2021/05/25/d6NL94mRnUhCWuP.jpg"
alt="三维线框图.jpg" /><br />
曲面图与线框图类似，只不过线框图的每个面都是由多边形构成的。只要增加一个配色方案来填充这些多边形，就可以让读者感受到可视化图形表面的拓扑结构了：<br />
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">%matplotlib notebook</span><br><span class="line"><span class="keyword">import</span> numpy <span class="keyword">as</span> np</span><br><span class="line"><span class="keyword">import</span> matplotlib.pyplot <span class="keyword">as</span> plt </span><br><span class="line"><span class="keyword">from</span> mpl_toolkits.mplot3d <span class="keyword">import</span> Axes3D</span><br><span class="line"></span><br><span class="line">fig = plt.figure()</span><br><span class="line"><span class="comment"># 创建三维坐标轴</span></span><br><span class="line">ax = Axes3D(fig)</span><br><span class="line"><span class="comment"># 三维线的数据</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">f</span>(<span class="params">x, y</span>):</span><br><span class="line">    <span class="keyword">return</span> np.sin(np.sqrt(x ** <span class="number">2</span> + y ** <span class="number">2</span>))</span><br><span class="line"></span><br><span class="line">x = np.linspace(-<span class="number">6</span>, <span class="number">6</span>, <span class="number">30</span>)</span><br><span class="line">y = np.linspace(-<span class="number">6</span>, <span class="number">6</span>, <span class="number">30</span>)</span><br><span class="line"></span><br><span class="line">X, Y = np.meshgrid(x, y)</span><br><span class="line">Z = f(X, Y)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 线框图</span></span><br><span class="line">ax.plot_surface(X, Y, Z, rstride=<span class="number">1</span>, cstride=<span class="number">1</span>, cmap=<span class="string">&#x27;viridis&#x27;</span>, edgecolor=<span class="string">&#x27;none&#x27;</span>)</span><br><span class="line">ax.set_title(<span class="string">&#x27;surface&#x27;</span>)</span><br></pre></td></tr></table></figure><br />
<img src="https://i.loli.net/2021/05/25/y4Q5rl8pV3UIWBm.jpg"
alt="三维曲面图.jpg" /></p>
<p>需要注意的是，画曲面图需要二维数据，但可以不是直角坐标系（也可以用极坐标）。<br />
下面示例，创建了一个局部的极坐标网格，当我们把它画成 surface3D
图形时，可以获得一种使用了切片的可视化效果。<br />
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">%matplotlib notebook</span><br><span class="line"><span class="keyword">import</span> numpy <span class="keyword">as</span> np</span><br><span class="line"><span class="keyword">import</span> matplotlib.pyplot <span class="keyword">as</span> plt </span><br><span class="line"><span class="keyword">from</span> mpl_toolkits.mplot3d <span class="keyword">import</span> Axes3D</span><br><span class="line"></span><br><span class="line">fig = plt.figure()</span><br><span class="line"><span class="comment"># 创建三维坐标轴</span></span><br><span class="line">ax = Axes3D(fig)</span><br><span class="line"><span class="comment"># 三维线的数据</span></span><br><span class="line">r = np.linspace(<span class="number">0</span>, <span class="number">6</span>, <span class="number">20</span>)</span><br><span class="line">theta = np.linspace(-<span class="number">0.9</span> * np.pi, <span class="number">0.8</span> * np.pi, <span class="number">40</span>)</span><br><span class="line"><span class="comment"># 极坐标网格</span></span><br><span class="line">r, theta = np.meshgrid(r, theta)</span><br><span class="line"></span><br><span class="line">X = r * np.sin(theta)</span><br><span class="line">Y = r * np.cos(theta)</span><br><span class="line">Z = f(X, Y)</span><br><span class="line"></span><br><span class="line">ax.plot_surface(X, Y, Z, rstride=<span class="number">1</span>, cstride=<span class="number">1</span>,cmap=<span class="string">&#x27;viridis&#x27;</span>, edgecolor=<span class="string">&#x27;none&#x27;</span>)</span><br><span class="line">ax.set_title(<span class="string">&#x27;surface-polar&#x27;</span>)</span><br></pre></td></tr></table></figure><br />
<img src="https://i.loli.net/2021/05/25/zYx1yXmSIWNktVw.jpg"
alt="曲面图-极坐标.jpg" /></p>
<p><strong>4、曲面三角剖分</strong><br />
曲面图数据不是均匀且完整的，如何绘图呢？可以使用三角剖分图形：</p>
<p>先绘制一个散点图，看看数据分布：<br />
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">%matplotlib notebook</span><br><span class="line"><span class="keyword">import</span> numpy <span class="keyword">as</span> np</span><br><span class="line"><span class="keyword">import</span> matplotlib.pyplot <span class="keyword">as</span> plt </span><br><span class="line"><span class="keyword">from</span> mpl_toolkits.mplot3d <span class="keyword">import</span> Axes3D</span><br><span class="line"></span><br><span class="line">fig = plt.figure()</span><br><span class="line"><span class="comment"># 创建三维坐标轴</span></span><br><span class="line">ax = Axes3D(fig)</span><br><span class="line"><span class="comment"># 三维线的数据</span></span><br><span class="line">theta = <span class="number">2</span> * np.pi * np.random.random(<span class="number">1000</span>)</span><br><span class="line">r = <span class="number">6</span> * np.random.random(<span class="number">1000</span>)</span><br><span class="line"></span><br><span class="line">x = np.ravel(r * np.sin(theta))</span><br><span class="line">y = np.ravel(r * np.cos(theta))</span><br><span class="line">z = f(x, y)</span><br><span class="line"></span><br><span class="line">ax.scatter(x, y, z, c=z, cmap=<span class="string">&#x27;viridis&#x27;</span>, linewidth=<span class="number">0.5</span>)</span><br><span class="line">ax.set_title(<span class="string">&#x27;surface-scatter&#x27;</span>)</span><br></pre></td></tr></table></figure><br />
<img src="https://i.loli.net/2021/05/25/23Nn8UQfxMpgrFK.jpg"
alt="三维曲面散点图.jpg" /></p>
<p>还有许多地方需要修补，这些工作可以由 <code>ax.plot_trisurf()</code>
函数帮助我们完成。它首先找到一组所有点都连接起来的三角形，然后用这些三角形创建曲面：<br />
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">ax.plot_trisurf(x, y, z, cmap=<span class="string">&#x27;viridis&#x27;</span>, edgecolor=<span class="string">&#x27;none&#x27;</span>)</span><br><span class="line">ax.set_title(<span class="string">&#x27;surface-trisurf&#x27;</span>)</span><br><span class="line">fig</span><br></pre></td></tr></table></figure><br />
<img src="https://i.loli.net/2021/05/25/K2OpVmW5Cs8ay4v.jpg"
alt="三维曲面图三角切面.jpg" /><br />
虽然结果肯定没有之前用均匀网格画的图完美，但是这种三角剖分方法很灵活。</p>
<h2 id="其他技巧">其他技巧</h2>
<p><strong>1、设置中文</strong><br />
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 为了支持中文，在开头设置：</span></span><br><span class="line"><span class="keyword">import</span> matplotlib.pyplot <span class="keyword">as</span> plt</span><br><span class="line">plt.rcParams[<span class="string">&#x27;font.sans-serif&#x27;</span>] = [<span class="string">&#x27;SimHei&#x27;</span>]  <span class="comment">#matplotlib 中文字体</span></span><br></pre></td></tr></table></figure></p>
<p><strong>2、共享坐标轴</strong><br />
当你通过<code>pyplot.subplot()</code>、<code>pyplot.axes()</code>函数或者<code>Figure.add_subplot()</code>、<code>Figure.add_axes()</code>方法创建一个Axes时，你可以通过sharex关键字参数传入另一个Axes表示共享X轴；或者通过sharey关键字参数传入另一个Axes表示共享Y轴。共享轴线时，当你缩放某个Axes时，另一个Axes也跟着缩放。</p>
<p><strong>3、创建多个subplot</strong><br />
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 旧式风格</span></span><br><span class="line">fig=plt.figure()</span><br><span class="line">ax1=fig.add_subplot(<span class="number">221</span>)</span><br><span class="line">ax2=fig.add_subplot(<span class="number">222</span>,sharex=ax1,sharey=ax1)</span><br><span class="line">ax3=fig.add_subplot(<span class="number">223</span>,sharex=ax1,sharey=ax1)</span><br><span class="line">ax4=fig.add_subplot(<span class="number">224</span>,sharex=ax1,sharey=ax1)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 新式风格的代码</span></span><br><span class="line">fig,((ax1,ax2),(ax3,ax4))=plt.subplots(<span class="number">2</span>,<span class="number">2</span>,sharex=<span class="literal">True</span>,sharey=<span class="literal">True</span>)</span><br><span class="line">ax1.plot(...)</span><br><span class="line">ax2.plot(...)</span><br><span class="line"><span class="comment"># 也可以直接用，不解包</span></span><br><span class="line">fig,axs=plt.subplots(<span class="number">2</span>,<span class="number">2</span>,sharex=<span class="literal">True</span>,sharey=<span class="literal">True</span>)</span><br><span class="line">ax1=axs[<span class="number">0</span>,<span class="number">0</span>]</span><br><span class="line">ax2=axs[<span class="number">0</span>,<span class="number">1</span>]</span><br><span class="line">ax3=axs[<span class="number">1</span>,<span class="number">0</span>]</span><br><span class="line">ax4=axs[<span class="number">1</span>,<span class="number">1</span>]</span><br><span class="line"><span class="comment"># 返回的axs是一个nrows*ncols的array，支持numpy的索引。</span></span><br></pre></td></tr></table></figure></p>
<p><strong>4、调整日期显示</strong><br />
当x轴为时间日期时，有可能间隔太密集导致显示都叠加在一起。此时可以用<code>matplotlib.figure.Figure.autofmt_xdate()</code>函数来自动调整X轴日期的显式。</p>
<p>你也可以调整X轴的显示格式。当X轴为时间时，其显示由Axes.fmt_xdata属性来提供。该属性是一个函数对象或者函数，接受一个日期参数，返回该日期的显示字符串。<br />
matplotlib已经提供了许多date
formatter，你可以直接使用<code>ax.fmt_xdata=matplotlib.dates.DateFormatter('%Y-%m-%d')</code>。</p>
<p><strong>5、放置text box</strong><br />
当你在Axes中放置text box时，你最好将它放置在axes
coordinates下，这样当你调整X轴或者Y轴时，它能够自动调整位置。</p>
<p>你也可以使用Text的.bbox属性来让这个Text始终放在某个Patch中。其中.bbox是个字典，它存放的是该Patch实例的属性。</p>
<p><strong>6、Latex文字</strong><br />
要想在文本中使用Latex，你需要使用<code>'$...$'</code>这种字符串（即使用<code>'$'</code>作为界定符）。通常建议使用raw字符串，即<code>r'$...$'</code>的格式，因为原生字符串不会转义''，从而使得大量的Latex词法能够正确解析。</p>
<p><strong>7、平移坐标轴：</strong><br />
Axes.spines是个字典，它存放了四个键，分别为：<br />
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">Axes.spines[&#x27;left],</span><br><span class="line">Axes.spines[&#x27;right],</span><br><span class="line">Axes.spines[&#x27;top],</span><br><span class="line">Axes.spines[&#x27;bottom] </span><br></pre></td></tr></table></figure><br />
他们都是一个matplotlib.spines.Spine对象，该对象继承自matplotlib.patches.Patch对象，主要是设置图形边界的边框。<br />
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">Spine.set_color(<span class="string">&#x27;none&#x27;</span>)：不显示这条边线</span><br><span class="line">Spine.set_position((position))：将边线移动到指定坐标。</span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">position是一个二元元组，指定了 (position type,amount)，position type可以是：</span></span><br><span class="line"><span class="string">        outward：在绘图区域之外放置边线，离开绘图区域的距离由 amount指定（负值则在会去区域内绘制）</span></span><br><span class="line"><span class="string">        axes：在 Axes coordinate内放置边线（从 0.0 到 1.0 ）</span></span><br><span class="line"><span class="string">        data：在 data coordinate 内放置边线</span></span><br><span class="line"><span class="string">你也可以指定position为 ： &#x27;center&#x27;，等价于 (&#x27;axes&#x27;,0.5)；或者 &#x27;zero&#x27;，等价于 (&#x27;data&#x27;,0.0)</span></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br></pre></td></tr></table></figure></p>
<p><strong>8、清除</strong><br />
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 通过pyplot来清除绘图</span></span><br><span class="line">pyplot.cla()：清除current axis。非当前axis不受影响</span><br><span class="line">pyplot.clf()：清除current figure。但是它不关闭window</span><br><span class="line">pyplot.close()：关闭window</span><br><span class="line"><span class="comment"># 通过面向对象的方法清除绘图</span></span><br><span class="line">Figure.clf()：清除该Figure对象的所有内容。</span><br></pre></td></tr></table></figure><br />
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 清除X坐标和Y坐标：</span></span><br><span class="line">Axes.set_xticks(())</span><br><span class="line">Axes.set_yticks(())</span><br><span class="line">Axes.set_axis_off() <span class="comment">#清除 tick 和边框</span></span><br></pre></td></tr></table></figure></p>
<h1 id="matplotlib的主要api">Matplotlib的主要API</h1>
<p>参考Matplotlib的<span class="exturl" data-url="aHR0cHM6Ly9tYXRwbG90bGliLm9yZy9zdGFibGUvYXBpL2luZGV4Lmh0bWwjdXNhZ2UtcGF0dGVybnM=">Modules<i class="fa fa-external-link-alt"></i></span>。</p>
<p>写这个主要是从上层了解Matplotlib绘图时使用的类和方法，其中Axes类全面列出了使用的绘图方法和参数详解。之后会分类使用这些方法。</p>
<h2 id="artist">Artist</h2>
<p>我们之前讲了Matplotlib的三层结构，那谁使用它们呢？就是Artist（艺术家）。</p>
<p>matplotlib的三个API：<br />
（1）matplotlib.backend_bases.FigureCanvas：代表了一个绘图区，在这个绘图区上图表被绘制。<br />
（2）matplotlib.backend_bases.Renderer：代表了渲染器，它知道如何在绘图区上绘图。<br />
（2）matplotlib.artist.Artist：代表了图表组件，它知道如何利用渲染器在绘图区上绘图。<br />
我们经常使用的是与matplotlib.artist.Artist类，它是高层次的绘图控制。</p>
<p>matplotlib中有两种Artist：<br />
（1）primitive：代表了我们在绘图区域上绘制的基础的绘图组件，比如Line2D，Rectangle，Text
以及AxesImage等等。<br />
（2）container：代表了放置primitive的那些绘图组件。比如Axis、Axes以及Figure。对应容器层。</p>
<div class="note info"><p><strong>matplotlib的标准使用流程为：</strong><br />
（1）创建一个Figure实例对象fig。<br />
（2）使用fig实例创建一个或者多个Axes实例，或者创建一个或者多个Subplot实例。<br />
（3）使用Axes实例的方法来创建primitive。</p>
</div>
<p>每个在图形中出现的元素都是Artist。其属性有：<br />
（1）Figure.patch属性：一个Rectangle，代表了图表的矩形框，它的大小就是图表的大小，
并且可以通过它设置图表的背景色和透明度。<br />
（2）Axes.patch属性：一个Rectangle，代表了绘图坐标轴内部的矩形框（白底黑边），
通过它可以设置Axes的颜色、透明度等。</p>
<p>所有的Artist有下列属性：<br />
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">.alpha：透明度。值为0--1之间的浮点数</span><br><span class="line">.animated：一个布尔值，表示是否用于加速动画绘制</span><br><span class="line">.axes：返回这个Artist所属的axes，可能为None</span><br><span class="line">.clip_box：用于剪切Artist的bounding box</span><br><span class="line">.clip_on：是否开启clip</span><br><span class="line">.clip_path：Artist沿着该path执行clip</span><br><span class="line">.contains：一个picking function用于测试Artist是否包含pick point</span><br><span class="line">.figure：该Artist所属的Figure，可能为None</span><br><span class="line">.gid：该Artist的id字符串</span><br><span class="line">.label：一个text label</span><br><span class="line">.picker:一个python object用于控制object picking</span><br><span class="line">.transform：转换矩阵</span><br><span class="line">.url：一个url string，代表本Artist</span><br><span class="line">.visible：布尔值，控制Artist是否绘制</span><br><span class="line">.zorder：决定了Artist的绘制顺序。zorder越小就越底层，则越优先绘制。</span><br></pre></td></tr></table></figure><br />
这些属性可以通过旧式的实例对象方法，setter和getter函数访问和设置。如figure对象：<code>fig.get_alpha()</code>，<code>fig.set_alpha(0.5)</code>、<code>fig.set(alpha=0.5,zorder=2)</code>（一次设置多个属性）。</p>
<p>或者使用<code>plt.getp(o,"alpha")</code>来获取属性（一次只能返回一个属性），如果指定属性名，则返回对象的该属性值；如果不指定属性名，则返回对象的所有的属性和值。使用<code>plt.setp(o,alpha=0.5,zorder=2)</code>来设置属性（一次可以设置多个属性）。<br />
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 获取fig所有属性</span></span><br><span class="line"><span class="comment"># 下面两种方式等价</span></span><br><span class="line">mpl.artist.getp(fig)</span><br><span class="line">plt.getp(fig)</span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">agg_filter = None</span></span><br><span class="line"><span class="string">alpha = None</span></span><br><span class="line"><span class="string">animated = False</span></span><br><span class="line"><span class="string">axes = [&lt;matplotlib.axes._subplots.AxesSubplot object at ...</span></span><br><span class="line"><span class="string">children = [&lt;matplotlib.patches.Rectangle object at 0x0000019...</span></span><br><span class="line"><span class="string">clip_box = None</span></span><br><span class="line"><span class="string">clip_on = True</span></span><br><span class="line"><span class="string">clip_path = None</span></span><br><span class="line"><span class="string">constrained_layout = False</span></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br></pre></td></tr></table></figure></p>
<h2 id="figure">Figure</h2>
<p>matplotlib.figure.Figure是最顶层的container
Artist，它包含了图表中的所有元素。它的属性有：<br />
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">Figure.patch：Figure的背景矩形</span><br><span class="line">Figure.axes：持有的一个Axes实例的列表(包括Subplot)</span><br><span class="line">Figure.images：持有的一个FigureImages patch列表</span><br><span class="line">Figure.lines：持有一个Line2D实例的列表(很少使用)</span><br><span class="line">Figure.legends：持有的一个Figure Legend实例列表(不同于Axes.legends)</span><br><span class="line">Figure.patches：持有的一个Figure pathes实例列表(很少使用)</span><br><span class="line">Figure.texts：持有的Figure Text实例列表</span><br><span class="line">Figure.figsize：图像的尺寸，(w,h)，以英寸为单位</span><br><span class="line">Figure.dpi：图像分辨率</span><br><span class="line">Figure.facecolor：背景色</span><br><span class="line">Figure.edgecolor：edge color</span><br><span class="line">Figure.linewidth：edge linewidth</span><br><span class="line">Figure.frameon：如果为False，则不绘制图像</span><br><span class="line">Figure.subplotpars：一个SubplotParams实例</span><br><span class="line">Figure.tight_layout：如果为False，则使用subplotpars；否则使用tight_layout()调整subplot parameters</span><br></pre></td></tr></table></figure><br />
当你执行<code>Figure.add_subplot()</code>或者<code>Figure.add_axes()</code>时，这些新建的Axes都被添加到Figure.axes列表中。</p>
<p>由于Figure维持了当前的axes，因此不要手动的从Figure.axes列表中添加删除元素，而是要通过<code>Figure.add_subplot()</code>、<code>Figure.add_axes()</code>来添加元素，通过<code>Figure.delaxes()</code>来删除元素。但是你可以迭代或者访问Figure.axes中的Axes实例，然后修改这个实例的属性。</p>
<p>可以通过<code>Figure.gca()</code>获取当前的axes，通过<code>Figure.sca()</code>设置当前的axes。</p>
<p>Figure也有它自己的text、line、patch、image。可通过add
primitive（原始组件）语句直接添加。但是注意Figure默认的坐标系是以像素为单位，可能需要转换成figure坐标系：(0,0)表示左下点，(1,1)表示右上点。</p>
<p>创建Figure的方法：<br />
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">matplotlib.pyplot.figure(num=<span class="literal">None</span>, figsize=<span class="literal">None</span>, dpi=<span class="literal">None</span>, facecolor=<span class="literal">None</span>,</span><br><span class="line">    edgecolor=<span class="literal">None</span>, frameon=<span class="literal">True</span>, FigureClass=&lt;<span class="keyword">class</span> <span class="string">&#x27;matplotlib.figure.Figure&#x27;</span>&gt;, **kwargs)</span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">num：一个整数或者字符串。</span></span><br><span class="line"><span class="string">    若未提供，则创建一个新的figure。</span></span><br><span class="line"><span class="string">    如果给出了一个整数，而且某个现有的figure对象的number属性刚好等于这个整数：</span></span><br><span class="line"><span class="string">        则激活该figure并且返回该figure；否则创建一个新的figure</span></span><br><span class="line"><span class="string">    如果是个字符串，则创建一个新的figure，并且将window title设置为该字符串。</span></span><br><span class="line"><span class="string">figsize：一对整数的元组。给出了英寸为单位的高度和宽度。默认由rc的figure.figsize给出</span></span><br><span class="line"><span class="string">dpi：一个整数，给出figure的分辨率。默认由rc的figure.dpi给出</span></span><br><span class="line"><span class="string">facecolor：背景色。若未提供，则由rc的figure.facecolor给出</span></span><br><span class="line"><span class="string">edgecolor：border color。若未提供，则由rc的figure.edgecolor给出</span></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br></pre></td></tr></table></figure><br />
Figure的一些方法：<br />
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br></pre></td><td class="code"><pre><span class="line">add_axes(*args, **kwargs)：创建一个坐标轴。</span><br><span class="line">如果已经存在同样位置同样参数的一个Axes，则返回该Axes，并将其设为current Axes。</span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">rect:一个元组，代表了(left,bottom,width,height)，它是第一个位置参数</span></span><br><span class="line"><span class="string">axisbg：一个color，背景色</span></span><br><span class="line"><span class="string">frameon：布尔值，是否display frame</span></span><br><span class="line"><span class="string">sharex：另一个Axes对象，与该Axes共享 xaxis</span></span><br><span class="line"><span class="string">sharey：另一个Axes对象，与该Axes共享 yaxis</span></span><br><span class="line"><span class="string">projection：坐标系类型。projection=&#x27;polar&#x27;也等价于polar=True</span></span><br><span class="line"><span class="string">aspect：一个数值，指定x和y轴每个单位的尺寸比例。也可以设定为字符串&#x27;equal&#x27;/&#x27;auto&#x27;</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">如果你想在同样的一个rect创建两个Axes，那么你需要设置label参数。不同的Axes通过不同的label鉴别。</span></span><br><span class="line"><span class="string">如果你使用了`fig.delaxes()`从Figure中移除了ax，那么你可以通过`fig.add_exes(ax)`来将其放回。</span></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line">sca(a)：设置a为current axes并返回它。</span><br><span class="line">gca(**kwargs)：返回current axes。如果不存在则创建一个。</span><br><span class="line">delaxes(a)：从figure中移除axes。</span><br><span class="line"></span><br><span class="line">autofmt_xdate(bottom=<span class="number">0.2</span>, rotation=<span class="number">30</span>, ha=<span class="string">&#x27;right&#x27;</span>)：用于设置Date ticklabel的位置。</span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">bottom：设置距离subplot底部的位置。</span></span><br><span class="line"><span class="string">rotation：设置了xtick label的旋转角度。</span></span><br><span class="line"><span class="string">ha：设置xtick label的对其方式。</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">该函数主要用于当xtick为日期，可能会重叠，因此可以旋转一个角度。</span></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line">suptitle(t, **kwargs):设置图像标题。t为标题字符串。关键字参数就是Text对象的参数：</span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">x：在图形坐标系中，标题的横坐标（范围 0～1）</span></span><br><span class="line"><span class="string">y：在图形坐标系中，标题的纵坐标（范围 0～1）</span></span><br><span class="line"><span class="string">horizontalalignment：标题水平对齐方式，默认为&#x27;center&#x27;</span></span><br><span class="line"><span class="string">verticalalignment：标题垂直对齐方式，默认为&#x27;top&#x27;</span></span><br><span class="line"><span class="string">fontsize：字体大小</span></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line">text(x, y, s, *args, **kwargs)：添加文本。</span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">x：在图形坐标系中，标题的横坐标（范围 0～1）</span></span><br><span class="line"><span class="string">y：在图形坐标系中，标题的纵坐标（范围 0～1）</span></span><br><span class="line"><span class="string">s：文本字符串</span></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line">tight_layout(renderer=<span class="literal">None</span>, pad=<span class="number">1.08</span>, h_pad=<span class="literal">None</span>, w_pad=<span class="literal">None</span>, rect=<span class="literal">None</span>)：调整subplot的间距。</span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">pad：设定subplot和figure edge之间的距离。单位为font-size</span></span><br><span class="line"><span class="string">h_pad/w_pad：subplot之间的高距/宽距。</span></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="comment"># 子图，除了下面方法，还有plt.subplot()、plt.subplots()</span></span><br><span class="line">add_subplot(*args,**kwargs)：创建一个subplot。</span><br><span class="line">如果已经存在同样位置同样参数的一个subplot，则返回该subplot，并将其设为current Axes。</span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">nrows：行数</span></span><br><span class="line"><span class="string">nclos：列数，每个单元格是一个sub-axes。</span></span><br><span class="line"><span class="string">plot_number：子图的序列，从1开始，从左到右，从上到下顺序排列。最大为nrows*ncols。</span></span><br><span class="line"><span class="string">            当nrows,ncols,plot_number这三个数字都是个位数时，可以使用一个三位数代替，每位代表一个数。</span></span><br><span class="line"><span class="string">projection：坐标系类型。projection=&#x27;polar&#x27;也等价于polar=True</span></span><br><span class="line"><span class="string">axisbg：一个color，背景色</span></span><br><span class="line"><span class="string">frameon：布尔值，是否display frame</span></span><br><span class="line"><span class="string">sharex：另一个Axes对象，与该Axes共享 xaxis</span></span><br><span class="line"><span class="string">sharey：另一个Axes对象，与该Axes共享 yaxis</span></span><br><span class="line"><span class="string">projection：坐标系类型。projection=&#x27;polar&#x27;也等价于polar=True</span></span><br><span class="line"><span class="string">aspect：一个数值，指定x和y轴每个单位的尺寸比例。也可以设定为字符串&#x27;equal&#x27;/&#x27;auto&#x27;</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">&#x27;&#x27;</span></span><br><span class="line"><span class="string">%matplotlib inline</span></span><br><span class="line"><span class="string">import matplotlib.pyplot as plt</span></span><br><span class="line"><span class="string">plt.style.use(&#x27;seaborn-white&#x27;)</span></span><br><span class="line"><span class="string">import numpy as np</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">for i in range(1, 7):</span></span><br><span class="line"><span class="string">    plt.subplot(2, 3, i)</span></span><br><span class="line"><span class="string">    plt.text(0.5, 0.5, str((2, 3, i)), fontsize=18, ha=&#x27;center&#x27;)</span></span><br><span class="line"><span class="string">&#x27;&#x27;</span></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line">subplots_adjust(left=<span class="literal">None</span>, bottom=<span class="literal">None</span>, right=<span class="literal">None</span>, top=<span class="literal">None</span>, wspace=<span class="literal">None</span>, hspace=<span class="literal">None</span>)：调整子图之间的间隔和位置。</span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">hspace 与 wspace 参数设置与图形高度与宽度一致的子图间距，数值以子图的尺寸为单位</span></span><br><span class="line"><span class="string">&#x27;&#x27;</span></span><br><span class="line"><span class="string"># 在本例中，间距是子图宽度与高度的40%</span></span><br><span class="line"><span class="string">fig = plt.figure()</span></span><br><span class="line"><span class="string">fig.subplots_adjust(hspace=0.4, wspace=0.4)</span></span><br><span class="line"><span class="string">for i in range(1, 7):</span></span><br><span class="line"><span class="string">    ax = fig.add_subplot(2, 3, i)</span></span><br><span class="line"><span class="string">    ax.text(0.5, 0.5, str((2, 3, i)), fontsize=18, ha=&#x27;center&#x27;)</span></span><br><span class="line"><span class="string">&#x27;&#x27;</span></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line">colorbar(mappable, cax=<span class="literal">None</span>, ax=<span class="literal">None</span>, use_gridspec=<span class="literal">True</span>, **kw)：为mappable创建一个colorbar。</span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">mapple：一个ScalarMapple实例。它可以是Image/ContourSet等等。</span></span><br><span class="line"><span class="string">cax：指定在哪个axes中绘制colorbar。也可以是None</span></span><br><span class="line"><span class="string">ax：如果cax为None，则一个或多个父轴将从中窃取用于新颜色条轴的空间。如果设置了cax，则此设置无效。</span></span><br><span class="line"><span class="string">use_gridspec：如果cax为None，则将创建一个新的cax作为Axes的实例。</span></span><br><span class="line"><span class="string">              如果ax是Subplot的实例，并且use_gridspec为True，则使用gridspec模块将cax创建为Subplot的实例。</span></span><br><span class="line"><span class="string">ticks: 一个序列，离散颜色分箱。</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">plt.clim(min,max)：设置颜色条上下限。</span></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line">legend(handles, labels, *args, **kwargs)：创建图例。</span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">handles：是一个Lin2D/Patch等实例的一个序列</span></span><br><span class="line"><span class="string">labels：是个字符串序列，用于给上述实例添加图例说明</span></span><br><span class="line"><span class="string">loc：指定图例的位置。可以是字符串&#x27;best&#x27;/&#x27;upper right&#x27;/&#x27;upper left&#x27;</span></span><br><span class="line"><span class="string">    /&#x27;lower left&#x27;/&#x27;lower right&#x27;/&#x27;right&#x27;/&#x27;center left&#x27;/&#x27;center right&#x27;</span></span><br><span class="line"><span class="string">    /&#x27;lower center&#x27;/&#x27;upper center&#x27;/&#x27;center&#x27;。你也可以指定坐标(x,y)，其中(0,0)是左下角，(1,1)是右上角</span></span><br><span class="line"><span class="string">numpoint/scatterpoints：图例上每个图例线的点数</span></span><br><span class="line"><span class="string">fancybox：如果为True，图例的边框采用圆角矩形</span></span><br><span class="line"><span class="string">shadow：如果为True，图例添加背影</span></span><br><span class="line"><span class="string">ncol：列数</span></span><br><span class="line"><span class="string">title：图例的标题</span></span><br><span class="line"><span class="string">framealpha：一个浮点数，从0到 1，图例的透明度</span></span><br><span class="line"><span class="string">frameon：一个布尔值，如果为True，则绘制图例的背景框。否则不绘制。</span></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line">savefig(fname, dpi=<span class="literal">None</span>, facecolor=<span class="string">&#x27;w&#x27;</span>, edgecolor=<span class="string">&#x27;w&#x27;</span>,orientation=<span class="string">&#x27;portrait&#x27;</span>, </span><br><span class="line">        papertype=<span class="literal">None</span>, <span class="built_in">format</span>=<span class="literal">None</span>, transparent=<span class="literal">False</span>, bbox_inches=<span class="literal">None</span>, pad_inches=<span class="number">0.1</span>,frameon=<span class="literal">None</span>)：保存图像。</span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">fname：带路径的文件名。</span></span><br><span class="line"><span class="string">dpi：保存的分辨率。</span></span><br><span class="line"><span class="string">facecolor/edgecolor：figure rectangle的背景色和边线颜色</span></span><br><span class="line"><span class="string">orientation：可以为&#x27;landscape&#x27; | &#x27;portrait&#x27;</span></span><br><span class="line"><span class="string">format：图片格式。可以为&#x27;png&#x27;/&#x27;pdf&#x27;/&#x27;svg&#x27;/&#x27;eps&#x27;...</span></span><br><span class="line"><span class="string">transparent：如果为True，设置figure和axes背景透明（除非你设置了facecolor/edgecolor）</span></span><br><span class="line"><span class="string">frameon：如果为False，则图形背景透明</span></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="comment"># 显示图像</span></span><br><span class="line">show(warn=<span class="literal">True</span>)：显示图像。如果warn=<span class="literal">True</span>，则开启警报。</span><br><span class="line"><span class="comment"># 获取/设置属性</span></span><br><span class="line">get_dpi()/get_edgecolor()/get_facecolor()...：获取对应的属性值。</span><br><span class="line">get_children()：获取figure中包含的artists。</span><br><span class="line">get_size_inches()：返回fig的当前尺寸（单位为英寸。<span class="number">1</span><span class="keyword">in</span>=<span class="number">2.54</span>cm）</span><br><span class="line"></span><br><span class="line">set_dpi()/set_edgecolor()...：设置相关属性。</span><br><span class="line"><span class="comment"># 清除fig</span></span><br><span class="line">clear()：清除一个figure。</span><br><span class="line">clf(keep_observers=<span class="literal">False</span>)：清除一个figure。如果keep_observers=<span class="literal">True</span>，则gui仍然会跟踪figure中的axes。</span><br></pre></td></tr></table></figure></p>
<h2 id="axes">Axes</h2>
<p>Axes类是matplotlib的核心，大多数时间都是在与它打交道。Axes代表了绘图区。大量的用于绘图的Artist存放在它内部，并且它有许多辅助方法来创建和添加Artist给它自己，而且它也有许多赋值方法来访问和修改这些Artist。</p>
<p>它有许多方法用于绘图，如<code>.plot()</code>、<code>.text()</code>、<code>.hist()</code>、<code>.imshow()</code>等方法用于创建大多数常见的primitive(如Line2D，Rectangle，Text，Image等等）。这些方法会创建primitive
Artist实例，并且添加这些实例到对应的container上去，然后必要的时候会绘制这些图形。</p>
<p>例如，Subplot就是一个特殊的Axes，其实例是位于网格中某个区域的Subplot实例。其实你也可以在任意区域创建Axes，通过<code>Figure.add_axes([left,bottom,width,height])</code>来创建一个任意区域的Axes，其中left,bottom,width,height都是<code>[0,1]</code>之间的浮点数，他们代表了相对于Figure的坐标。<br />
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> numpy <span class="keyword">as</span> np </span><br><span class="line"><span class="keyword">import</span> matplotlib.pyplot <span class="keyword">as</span> plt</span><br><span class="line">%matplotlib notebook <span class="comment"># 使用交互式能显示整体Figure和Axes</span></span><br><span class="line"></span><br><span class="line">fig = plt.figure() <span class="comment"># 创建图形</span></span><br><span class="line">ax = fig.add_axes([<span class="number">0.15</span>,<span class="number">0.1</span>,<span class="number">0.7</span>,<span class="number">0.3</span>]) <span class="comment"># 绘图区坐标</span></span><br><span class="line"></span><br><span class="line">x = np.arange(<span class="number">0.0</span>,<span class="number">1.0</span>,<span class="number">0.01</span>)</span><br><span class="line">ax.plot(x, np.sin(<span class="number">2</span>*np.pi*x))</span><br></pre></td></tr></table></figure><br />
<img src="https://i.loli.net/2021/05/21/vHaJ7ncBWPmtf31.jpg" /><br />
Axes包含了一个<code>.patch</code>属性，对于笛卡尔坐标系而言，它是一个Rectangle；对于极坐标而言，它是一个Circle。这个<code>.patch</code>属性决定了plotting
region的形状、背景和边框。</p>
<p>当调用<code>Axes.plot()</code>方法时，该方法会创建一个matplotlib.lines.Line2D实例，然后会利用传给<code>.plot()</code>的关键字参数来更新该Line2D的属性，然后将这个Line2D添加到Axes.lines列表中。该方法返回的刚创建的Line2D列表，因为你可以传递多个<code>(x,y)</code>值从而创建多个Line2D。同理，当调用<code>Axes.hist()</code>方法时，类似于<code>.plot()</code>方法，不过它会添加patches到Axes.patches列表。<br />
<div class="note info"><p>不应该直接对Axes.lines和Axes.patches列表操作来添加图表。因为当你通过.plot()和.hist()等方法添加图表时，matplotlib会做许多工作而不仅仅是添加绘图组件到Axes.lines或者Axes.patches列表中。你可以使用Axes的辅助方法.add_line()和.add_patch()方法来添加。</p>
</div></p>
<p>下面是Axes用于创建primitive
Artist以及添加他们到相应的container中的方法：<br />
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">ax.annotate()：创建text annotation（Annotate对象），然后添加到ax.texts列表中。</span><br><span class="line">ax.bar()：创建bar chart（Rectangle对象），然后添加到ax.patches列表中。</span><br><span class="line">ax.errorbar()：创建error bar plot（Line2D对象和Rectangle对象），然后添加到ax.lines列表中和ax.patches列表中。</span><br><span class="line">ax.fill()：创建shared area（Polygon对象），然后添加到ax.patches列表中</span><br><span class="line">ax.hist()：创建histogram（Rectangle对象），然后添加到ax.patches列表中。</span><br><span class="line">ax.imshow()：创建image data（AxesImage对象），然后添加到ax.images列表中。</span><br><span class="line">ax.legend()：创建axes legends（Legend对象），然后添加到ax.legends列表中。</span><br><span class="line">ax.plot()：创建xy plot（Line2D对象），然后添加到ax.lines列表中。</span><br><span class="line">ax.scatter()：创建scatter charts（PolygonCollection对象），然后添加到ax.collections列表中。</span><br><span class="line">ax.text()：创建text（Text对象），然后添加到ax.texts列表中。</span><br></pre></td></tr></table></figure><br />
另外Axes还包含两个最重要的Artist container：<br />
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">ax.xaxis：XAxis对象的实例，用于处理x轴tick以及label的绘制</span><br><span class="line">ax.yaxis：YAxis对象的实例，用于处理y轴tick以及label的绘制</span><br></pre></td></tr></table></figure><br />
Axes包含了许多辅助方法来访问和修改XAxis和YAxis，这些辅助方法其实内部调用的是XAxis和YAxis的方法。因此通常情况下不需要直接调用XAxis和YAxis的方法。只需要知道更改x轴和y轴的tick和label的方法，都是对XAxis和YAxis的操作的。</p>
<p>Axes 的一些方法：<br />
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br><span class="line">234</span><br><span class="line">235</span><br><span class="line">236</span><br><span class="line">237</span><br><span class="line">238</span><br><span class="line">239</span><br><span class="line">240</span><br><span class="line">241</span><br><span class="line">242</span><br><span class="line">243</span><br><span class="line">244</span><br><span class="line">245</span><br><span class="line">246</span><br><span class="line">247</span><br><span class="line">248</span><br><span class="line">249</span><br><span class="line">250</span><br><span class="line">251</span><br><span class="line">252</span><br><span class="line">253</span><br><span class="line">254</span><br><span class="line">255</span><br><span class="line">256</span><br><span class="line">257</span><br><span class="line">258</span><br><span class="line">259</span><br><span class="line">260</span><br><span class="line">261</span><br><span class="line">262</span><br><span class="line">263</span><br><span class="line">264</span><br><span class="line">265</span><br><span class="line">266</span><br><span class="line">267</span><br><span class="line">268</span><br><span class="line">269</span><br><span class="line">270</span><br><span class="line">271</span><br><span class="line">272</span><br><span class="line">273</span><br><span class="line">274</span><br><span class="line">275</span><br><span class="line">276</span><br><span class="line">277</span><br><span class="line">278</span><br><span class="line">279</span><br><span class="line">280</span><br><span class="line">281</span><br><span class="line">282</span><br><span class="line">283</span><br><span class="line">284</span><br><span class="line">285</span><br><span class="line">286</span><br><span class="line">287</span><br><span class="line">288</span><br><span class="line">289</span><br><span class="line">290</span><br><span class="line">291</span><br><span class="line">292</span><br><span class="line">293</span><br><span class="line">294</span><br><span class="line">295</span><br><span class="line">296</span><br><span class="line">297</span><br><span class="line">298</span><br><span class="line">299</span><br><span class="line">300</span><br><span class="line">301</span><br><span class="line">302</span><br><span class="line">303</span><br><span class="line">304</span><br><span class="line">305</span><br><span class="line">306</span><br><span class="line">307</span><br><span class="line">308</span><br><span class="line">309</span><br><span class="line">310</span><br><span class="line">311</span><br><span class="line">312</span><br><span class="line">313</span><br><span class="line">314</span><br><span class="line">315</span><br><span class="line">316</span><br><span class="line">317</span><br><span class="line">318</span><br><span class="line">319</span><br><span class="line">320</span><br><span class="line">321</span><br><span class="line">322</span><br></pre></td><td class="code"><pre><span class="line">cla()/clear()：清除Axes</span><br><span class="line">remove()：从figure中移除本axes。除非重绘figure，否则看不出来效果。</span><br><span class="line"></span><br><span class="line">acorr(x, **kwargs)：绘制序列x的自相关。</span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">x：一个标量序列。对x执行自相关</span></span><br><span class="line"><span class="string">normed：一个布尔值，如果为True，则对数据正则化处理</span></span><br><span class="line"><span class="string">maxlags：一个整数，默认为10.它给出了要展示多少个lag。如果为None，则使用所有的2*len(x)-1个</span></span><br><span class="line"><span class="string">其他kwargs：控制了Line2D的属性</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">返回：(lags,c,lin,b)</span></span><br><span class="line"><span class="string">lags：是一个长度为2*maxlags+的lag vector</span></span><br><span class="line"><span class="string">c：是长度为2*maxlags+的自相关向量</span></span><br><span class="line"><span class="string">line：是一个Line2D实例</span></span><br><span class="line"><span class="string">b：是x-axis</span></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line">add_artist(a)：添加a（一个Artist对象）到axes上</span><br><span class="line">add_collection(collection, autolim=<span class="literal">True</span>)：添加Collection实例到axes上</span><br><span class="line">add_container(container)：添加Container实例到axes上</span><br><span class="line">add_image(image)：添加Image实例到axes上</span><br><span class="line">add_line(line)：添加Line2D实例到axes上</span><br><span class="line">add_patch(p)：添加Patch实例到axes上</span><br><span class="line">add_table(tab)：添加Table实例到axes上</span><br><span class="line"></span><br><span class="line">annotate(*args, **kwargs)：对坐标点(x,y)绘制注解。</span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">s：注解字符串</span></span><br><span class="line"><span class="string">xy：一个长度为2的序列，给出了坐标点的(x,y)坐标</span></span><br><span class="line"><span class="string">xytext：一个长度为2的序列，给出了注解字符串的(x,y)坐标</span></span><br><span class="line"><span class="string">xycoords：给出了坐标点的(x,y)所对应的坐标系。可以为&#x27;figure points&#x27;、 &#x27;figure pixels&#x27;、&#x27;figure fraction&#x27;、</span></span><br><span class="line"><span class="string">        &#x27;axes points&#x27;、 &#x27;axes pixels&#x27;、&#x27;axes fraction&#x27;、&#x27;data&#x27;。</span></span><br><span class="line"><span class="string">         figure表示Figure坐标系，axes表示Axes坐标系，data表示被注解的点所在的数据坐标系。</span></span><br><span class="line"><span class="string">         points表示单位为点（分辨率的点）；pixels表示单位为像素，fraction表示：(0,0) 为左下角，(1,1) 为右上角</span></span><br><span class="line"><span class="string">textcoords：给出了注解字符串的(x,y)所对应的坐标系。可以为xycoords允许的值之外，还可以为：</span></span><br><span class="line"><span class="string">        &#x27;offset points&#x27;：偏移被注解的坐标点的距离为 (x,y)个点（分辨率的点）</span></span><br><span class="line"><span class="string">        &#x27;offset pixels&#x27;：偏移被注解的坐标点的距离为 (x,y)个像素</span></span><br><span class="line"><span class="string">arrowprops：一个字典，给出了箭头的类型。</span></span><br><span class="line"><span class="string">        若字典不包含arrowstyle，则可以使用下面的键： width/headwidth/headlength/shrink以及其他的FancyArrowPatch的属性。</span></span><br><span class="line"><span class="string">        如果字典包含了arrowstyle，则上面的这些键将被屏蔽。arrowstyle的值可以为：</span></span><br><span class="line"><span class="string">            &#x27;-&#x27;、&#x27;-&gt;&#x27;、&#x27;-[&#x27;、&#x27;|-|&#x27;、&#x27;-|&gt;&#x27;、&#x27;&lt;-&#x27;、&#x27;&lt;-&gt;&#x27;、</span></span><br><span class="line"><span class="string">            &#x27;&lt;|-&#x27;、&#x27;&lt;|-|&gt;&#x27;、&#x27;fancy&#x27;、&#x27;simple&#x27;、&#x27;wedge&#x27;</span></span><br><span class="line"><span class="string">annotation_clip：一个布尔值。如果为True，则超出axes的部分将会不可见</span></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line">autoscale_view(tight=<span class="literal">None</span>, scalex=<span class="literal">True</span>, scaley=<span class="literal">True</span>)：自动调整坐标轴的范围。</span><br><span class="line">                                                      如果你不想自动调整x轴，则scalex=<span class="literal">False</span>即可。y轴类似。</span><br><span class="line">arrow(x, y, dx, dy, **kwargs)：绘制箭头。箭头起点为 (x,y)，终点为 (x+dx,y+dy)。你也可以使用annotate()来模拟本方法。</span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">x,y：箭头起点坐标（data坐标系）</span></span><br><span class="line"><span class="string">dxx,dy：箭头终点坐标为 (x+dx,y+dy)（data坐标系）</span></span><br><span class="line"><span class="string">width：箭头宽度</span></span><br><span class="line"><span class="string">length_includes_head:：如果为True，则箭头的头部也算在箭头长度内</span></span><br><span class="line"><span class="string">head_width：箭头的头部宽度</span></span><br><span class="line"><span class="string">head_length：箭头的头部长度 </span></span><br><span class="line"><span class="string">shape：可以为&#x27;full&#x27;/&#x27;left&#x27;/&#x27;right&#x27;。确定是绘制左半边/右半边还是全部画出</span></span><br><span class="line"><span class="string">其他参数控制了Patch的属性</span></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line">axhline(y=<span class="number">0</span>, xmin=<span class="number">0</span>, xmax=<span class="number">1</span>, **kwargs)：绘制水平线。</span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">y：一个标量，默认为 0.给出了水平的 y坐标（采用data坐标系）</span></span><br><span class="line"><span class="string">xmin：一个标量，默认为 0。给出了水平线的起始横坐标。最大为 1（表示最右侧）（使用Axes坐标系）</span></span><br><span class="line"><span class="string">xmax：一个标量，默认为 1。 给出了水平线的终点横坐标。最小为 0 （表示最左侧）（使用Axes坐标系）</span></span><br><span class="line"><span class="string">其他关键字参数控制Line2D的属性</span></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line">axhspan(ymin, ymax, xmin=<span class="number">0</span>, xmax=<span class="number">1</span>, **kwargs)：绘制水平区域。</span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">ymin/ymax：给出了水平区域的y坐标的下界和上界，采用data坐标系</span></span><br><span class="line"><span class="string">xmin/xmax：给出了水平区域的左侧和右侧的位置。采用Axes坐标系，最小为0，最大为 1</span></span><br><span class="line"><span class="string">其他关键字参数控制Line2D的属性</span></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line">axis(*v, **kwargs)：设置axis属性，它返回的是(xmin,xmax,ymin,ymax)。data坐标系下每个轴的最小值、最大值。</span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">v： Axis data limits set from a float list。也可以是字符串：</span></span><br><span class="line"><span class="string">    &#x27;on&#x27;：切换新轴线，有标签</span></span><br><span class="line"><span class="string">    &#x27;off&#x27;：切换新轴线，无标签</span></span><br><span class="line"><span class="string">    &#x27;equal&#x27;：根据设置的限制，平等缩放</span></span><br><span class="line"><span class="string">    &#x27;tight&#x27;：限制允许内，显示所有数据</span></span><br><span class="line"><span class="string">    &#x27;auto&#x27;：自动缩放</span></span><br><span class="line"><span class="string">xmin/ymin/ymax/ymax：待设置的轴的最小/最大值</span></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line">axvline(x=<span class="number">0</span>, ymin=<span class="number">0</span>, ymax=<span class="number">1</span>, **kwargs)：绘制垂直线。</span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">x：一个标量，默认为 0.给出了垂直线的 x坐标（采用data坐标系）</span></span><br><span class="line"><span class="string">ymin：一个标量，默认为 0。给出了垂直线的起始纵坐标。最大为 1（表示最上侧）（使用Axes坐标系）</span></span><br><span class="line"><span class="string">ymax：一个标量，默认为 1。 给出了垂直线的终点纵坐标。最小为 0 （表示最下侧）（使用Axes坐标系）</span></span><br><span class="line"><span class="string">其他关键字参数控制Line2D的属性</span></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line">axvspan(xmin, xmax, ymin=<span class="number">0</span>, ymax=<span class="number">1</span>, **kwargs)：绘制垂直区域。</span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">xmin/xmax：给出了垂直区域的x坐标的左侧和右侧，采用data坐标系</span></span><br><span class="line"><span class="string">ymin/ymax：给出了垂直区域的上侧和下侧的位置。采用Axes坐标系，最小为0，最大为 1</span></span><br><span class="line"><span class="string">其他关键字参数控制Line2D的属性</span></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line">clabel(CS, *args, **kwargs)：为等高线添加label。</span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">CS：由contour函数返回的ContourSet，代表一组等高线</span></span><br><span class="line"><span class="string">fontsize：label的字体大小，或者给出字符串&#x27;smaller&#x27;/&#x27;x-large&#x27;</span></span><br><span class="line"><span class="string">colors：如果为None，则使用对应的等高线的颜色。</span></span><br><span class="line"><span class="string">        如果为一个字符串指定的颜色，则所有的等高线label使用该颜色。</span></span><br><span class="line"><span class="string">        如果为一组颜色，则不同的等高线的label按顺序使用其中的不同的颜色。</span></span><br><span class="line"><span class="string">inline：一个布尔值。如果为True，则移除label覆盖的底层的等高线（嵌入式）；否则就全部绘制（重叠式）</span></span><br><span class="line"><span class="string">inline_spacing:一个浮点数，单位为像素点。它控制了label距离等高线的距离</span></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line">findobj(<span class="keyword">match</span>=<span class="literal">None</span>, include_self=<span class="literal">True</span>)：筛选出合适的artist对象，返回一个列表。他会递归的向下搜寻</span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">match指定过滤器：</span></span><br><span class="line"><span class="string">    如果为None，则它选出axes包含的所有artist</span></span><br><span class="line"><span class="string">    如果为一个函数，则函数接受一个artist参数，返回布尔值。所有返回True的artist被选中</span></span><br><span class="line"><span class="string">    如果是一个类，则返回属于该类的artist</span></span><br><span class="line"><span class="string">include_self：如果为True，则也检查自己</span></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line">get_xx函数：返回对应的属性值。</span><br><span class="line">    get_alpha()/get_anchor()/get_animated()...</span><br><span class="line"></span><br><span class="line">grid(b=<span class="literal">None</span>, which=<span class="string">&#x27;major&#x27;</span>, axis=<span class="string">&#x27;both&#x27;</span>, **kwargs)：开启关闭网格。</span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">b：布尔值，指定你想开启(True)还是关闭网格</span></span><br><span class="line"><span class="string">which：可以为&#x27;major&#x27;/&#x27;minor&#x27;/&#x27;both&#x27;，指定你想开启哪个级别的网格</span></span><br><span class="line"><span class="string">axis：可以为&#x27;x&#x27;/&#x27;y&#x27;/&#x27;both&#x27;，指定你想在那个轴上开启网格</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">其他的关键字参数设定了网格的线条类型。如color/linestype/linewidth</span></span><br><span class="line"><span class="string">还有一种简单用法，就是axes.grid()，此时表示：如果网格开启，则关闭。如果网格关闭，则开启。</span></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line">locator_params(axis=<span class="string">&#x27;both&#x27;</span>, tight=<span class="literal">None</span>, **kwargs)：控制tick locator</span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">axis：一个字符串，指定控制那个轴。可以为&#x27;x&#x27;/&#x27;y&#x27;/&#x27;both&#x27;。</span></span><br><span class="line"><span class="string">tight：一个布尔值。它传递给autoscale_view()</span></span><br><span class="line"><span class="string">其他关键字参数传递给set_params()方法</span></span><br><span class="line"><span class="string">如果你想调整主轴上的刻度线的数量，可以使用ax.locator_params(tight=True,nbins=4)</span></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line">loglog(*args, **kwargs)：绘制line，但是将x轴和y轴都调整为对数坐标</span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">x：数据的x坐标</span></span><br><span class="line"><span class="string">y：数据的y坐标</span></span><br><span class="line"><span class="string">basex/basey：一个大于 1 的标量，控制对数的底数</span></span><br><span class="line"><span class="string">subsx/subsy：一个序列，给出了x/y轴的子刻度的位置（数据坐标系）。默认为None，此时子刻度是自动划分的</span></span><br><span class="line"><span class="string">nonposx/nonposy：</span></span><br><span class="line"><span class="string">               如果为&#x27;mask&#x27;，则x/y的负数或者零将被视作无效的数；</span></span><br><span class="line"><span class="string">               如果为&#x27;clip&#x27;，则x/y的负数或者零将被视作一个非常小的正数（因为对数的自变量要大于零）</span></span><br><span class="line"><span class="string">剩下的参数将被作为Line2D的属性</span></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line">margins(*args, **kw)：设置Axes的margin。</span><br><span class="line">                      你可以通过ax.margins()获取当前的margin。</span><br><span class="line">                      你也可以通过ax.margins(x=xmargin,y=ymargin)来设置margin。这两个参数的值是 <span class="number">0</span>～<span class="number">1</span></span><br><span class="line"></span><br><span class="line">minorticks_off()：关闭次刻度线。minorticks_on()：打开次刻度线。</span><br><span class="line"></span><br><span class="line">pcolor(*args, **kwargs)：绘制一个pseudocolor plot，返回一个Collection实例。</span><br><span class="line">                         对于大型数组，它很慢，此时推荐使用pcolormesh()。常用的方式为：</span><br><span class="line">pcolor(C,*kwargs)，此时C为一个二维数组。也可以指定pcolor(X,Y,C,*kwargs)。</span><br><span class="line">    X/Y/C都是二维数组，并且X和Y的尺寸比C大。它将在四个点决定的矩形中填充颜色:</span><br><span class="line">        C[i,j]： (X[i, j], Y[i, j])，(X[i, j+<span class="number">1</span>], Y[i, j+<span class="number">1</span>])， </span><br><span class="line">        (X[i+<span class="number">1</span>, j], Y[i+<span class="number">1</span>, j])，(X[i+<span class="number">1</span>, j+<span class="number">1</span>], Y[i+<span class="number">1</span>, j+<span class="number">1</span>])。X/Y也可以是一维的，但是首先会进行广播法则。</span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">cmap：一个Colormap实例。如果为None，则使用rc的设置</span></span><br><span class="line"><span class="string">edgecolors：None或者&#x27;none&#x27;或者一个颜色或者一个颜色序列。用于设定边的颜色</span></span><br><span class="line"><span class="string">其他参数设置PopyCollection属性</span></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line">pcolorfast(*args, **kwargs)：用法和pcolor相同，它是一个实验性质的，提供了一个更快的实现。</span><br><span class="line"></span><br><span class="line">pcolormesh(*args, **kwargs)：作用和pcolor相同。</span><br><span class="line">                             但是它是另一个实现方式，并且返回不同的对象，它返回的是QuadMesh对象。</span><br><span class="line">                             它的速度更快。其参数和用法与pcolor相同。</span><br><span class="line"></span><br><span class="line">edgecolors：除了pcolor的edgecolors之外，还多了一个<span class="string">&#x27;face&#x27;</span>，表示使用与四边形背景色相同的颜色。</span><br><span class="line"></span><br><span class="line">ax.xaxis.set_major_locator(MonthLocator())：设置x轴的主刻度的locator。常见的一些DateLocator有：</span><br><span class="line">                                            MinuteLocator、HourLocator、DayLocator、 WeekdayLocator、</span><br><span class="line">                                           MonthLocator、YearLocator、AutoDateLocator </span><br><span class="line">ax.xaxis.set_major_formatter(DateFormatter(<span class="string">&quot;%Y-%m-%d %H:%M:%S&quot;</span>))：设置x轴的主刻度的formatter。</span><br><span class="line"></span><br><span class="line">properties()：返回一个字典，该字典中包含了axes中的所有属性的键值对。</span><br><span class="line"></span><br><span class="line">table(**kwargs)：添加一个表格，返回一个table.Table实例。调用方式为：</span><br><span class="line">    table(cellText=<span class="literal">None</span>, cellColours=<span class="literal">None</span>,</span><br><span class="line">        cellLoc=<span class="string">&#x27;right&#x27;</span>, colWidths=<span class="literal">None</span>,</span><br><span class="line">        rowLabels=<span class="literal">None</span>, rowColours=<span class="literal">None</span>, rowLoc=<span class="string">&#x27;left&#x27;</span>,</span><br><span class="line">        colLabels=<span class="literal">None</span>, colColours=<span class="literal">None</span>, colLoc=<span class="string">&#x27;center&#x27;</span>,</span><br><span class="line">        loc=<span class="string">&#x27;bottom&#x27;</span>, bbox=<span class="literal">None</span>)</span><br><span class="line"></span><br><span class="line">text(x, y, s, fontdict=<span class="literal">None</span>, withdash=<span class="literal">False</span>, **kwargs)：添加文本，返回一个Text实例。</span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">s：一个字符串，被添加的文本</span></span><br><span class="line"><span class="string">x/y：一个标量，文本被添加的坐标</span></span><br><span class="line"><span class="string">fontdict：一个字典，给出了字体属性。</span></span><br><span class="line"><span class="string">withdash：一个布尔值。如果为True，则创建一个TextWithDash实例而不是Text实例。</span></span><br><span class="line"><span class="string">其他参数用于控制Text属性</span></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line">tick_params(axis=<span class="string">&#x27;both&#x27;</span>, **kwargs)：控制tick和tick label。</span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">axis：一个字符串，指定要控制那个轴。可以为&#x27;x&#x27;/&#x27;y&#x27;/&#x27;both&#x27;</span></span><br><span class="line"><span class="string">reset：一个布尔值。如果为True，那么在进行处理其他关键字参数之前，先恢复默认值。默认为False</span></span><br><span class="line"><span class="string">which：一个字符串，指定控制主刻度还是次刻度。可以为&#x27;major&#x27;/&#x27;minor&#x27;/&#x27;both&#x27;</span></span><br><span class="line"><span class="string">direction：一个字符串，控制将刻度放置在axes里面还是外面。可以为&#x27;in&#x27;/&#x27;out&#x27;/&#x27;inout&#x27;</span></span><br><span class="line"><span class="string">length：一个标量值。给出了每个刻度线的长度（就是那个小竖线），单位为像素点</span></span><br><span class="line"><span class="string">width：一个标量值。给出了每个刻度线的宽度（就是那个小竖线），单位为像素点</span></span><br><span class="line"><span class="string">color：给出刻度线的颜色</span></span><br><span class="line"><span class="string">pad：一个标量值，给出了刻度线和刻度label之间的距离，单位为像素点</span></span><br><span class="line"><span class="string">labelsize：一个标量值，给出了刻度label的字体大小。可以为数值，单位为像素点。也可以为字符串，如large&#x27;</span></span><br><span class="line"><span class="string">labelcolor：给出了刻度label的颜色</span></span><br><span class="line"><span class="string">colors：同时调整刻度线的颜色和刻度label的颜色</span></span><br><span class="line"><span class="string">bottom/top/left/right：一个布尔值或者字符串&#x27;on&#x27;/&#x27;off&#x27;。控制是否绘制对应位置的刻度线</span></span><br><span class="line"><span class="string">labelbottom/labeltop/labelleft/labelright：一个布尔值或者字符串&#x27;on&#x27;/&#x27;off&#x27;。控制是否绘制对应位置的刻度label</span></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line">vlines(x, ymin, ymax, colors=<span class="string">&#x27;k&#x27;</span>, linestyles=<span class="string">&#x27;solid&#x27;</span>, label=<span class="string">&#x27;&#x27;</span>, **kwargs)：绘制一群垂直线。</span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">x：标量或者一维数组，给出了垂线的位置</span></span><br><span class="line"><span class="string">ymin/ymax：给出了垂线的起始和终止位置。如果是个标量，则所有垂线共享该值</span></span><br><span class="line"><span class="string">colors：给出垂线的颜色</span></span><br><span class="line"><span class="string">linestyles：给出了垂线的线型</span></span><br><span class="line"><span class="string">label：一个字符串</span></span><br><span class="line"><span class="string">其他关键字参数设置LineCollection参数</span></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line">hlines(y, xmin, xmax, colors=<span class="string">&#x27;k&#x27;</span>, linestyles=<span class="string">&#x27;solid&#x27;</span>, label=<span class="string">&#x27;&#x27;</span>, **kwargs)：</span><br><span class="line">从xmin到xmax绘制一系列的水平线。这些水平线的纵坐标由y提供。</span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">y：水平线的纵坐标。如果为标量，则为一条水平；如果为序列，则为一系列水平线。数据坐标系</span></span><br><span class="line"><span class="string">xmin/xmax：水平线的起点和终点的横坐标。如果是个标量，则所有的水平线公用。如果是序列，则每个水平线设置一个。数据坐标系</span></span><br><span class="line"><span class="string">linestyles：指定线型。</span></span><br><span class="line"><span class="string">            可以为一个字符串（所有水平线公用），或者字符串序列（每个水平线一个）。</span></span><br><span class="line"><span class="string">            线型在&#x27;solid&#x27; | &#x27;dashed&#x27; | &#x27;dashdot&#x27; | &#x27;dotted&#x27;四者之一</span></span><br><span class="line"><span class="string">colors：指定颜色。可以为一个颜色（所有水平线公用），或者颜色序列（每个水平线一个）。</span></span><br><span class="line"><span class="string">label：一个字符串，指定标签。</span></span><br><span class="line"><span class="string">其他关键字参数设置LineCollection属性。</span></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line">quiver(*args, **kw)：创建一个二维的场向量。常见的调用方式有：</span><br><span class="line">    quiver(U,V,**kw)、 quiver(U,V,C,**kw)、quiver(X,Y,U,V,C,**kw)</span><br><span class="line">    quiver(X,Y,U,V,C,**kw)</span><br><span class="line">    其中U/V为向量的x轴分量和y轴分量。X/Y为绘制向量的起点坐标。C用于指定每个箭头的颜色。</span><br><span class="line">    如果为指定X/Y，则默认每个向量的起点从每个单元格生成。</span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">units：一个字符串，指定箭头的单位。除了箭头的长度以外，其他的度量都是以该单位为准。可以为：</span></span><br><span class="line"><span class="string">    &#x27;width&#x27;/&#x27;height&#x27;：以axes的宽度/高度为单位</span></span><br><span class="line"><span class="string">    &#x27;dots&#x27;/&#x27;inches&#x27;：以像素点/英寸为单位</span></span><br><span class="line"><span class="string">    &#x27;x&#x27;/&#x27;y&#x27;/&#x27;xy&#x27;：以数据坐标系下的X/Y为单位，而xy&#x27;表示数据坐标系下的单位矩形的对角线为单位。</span></span><br><span class="line"><span class="string">angles：指定向量的角度。正方形可能因为X/Y轴缩放尺度不同而显示为长方形。</span></span><br><span class="line"><span class="string">        可以为&#x27;uv&#x27;，表示只采用U,V的值计算；可以为&#x27;xy&#x27;，表示角度计算时考虑X轴与Y轴的缩放尺度。</span></span><br><span class="line"><span class="string">scale：一个浮点数，决定缩放比例。它和scale_units决定了箭头的全长。</span></span><br><span class="line"><span class="string">       假如向量的长度计算得到为 10，那么假如scale为 2， 而scale_units为dots，那么该向量的长度为5像素点。</span></span><br><span class="line"><span class="string">scale_units：一个字符串，指定缩放比例的单位。可以为&#x27;width&#x27;/&#x27;height&#x27;/&#x27;dots&#x27;/&#x27;inches&#x27;/&#x27;x&#x27;/&#x27;y&#x27;/&#x27;xy&#x27;</span></span><br><span class="line"><span class="string">width:一个标量，指定箭头的宽度，单位由units参数指定</span></span><br><span class="line"><span class="string">headwitdh:一个标量，指定箭头的头部的宽度，单位由units参数指定</span></span><br><span class="line"><span class="string">headlength:一个标量，指定箭头的头部的长度，单位由units参数指定</span></span><br><span class="line"><span class="string">headaxislength:一个标量，指定的是箭头的头部的左半边小三角与箭杆的相交的长度。单位由units参数指定</span></span><br><span class="line"><span class="string">minshaft:一个标量，Length below which arrow scales, in units of head length. 。不要设置成小于1，否则图形很难看</span></span><br><span class="line"><span class="string">minlength:一个标量，指定所有箭头的最短长度（单位由units参数指定）。如果有的箭头长度小于它，则绘制成一个点。</span></span><br><span class="line"><span class="string">pivot:一个字符串，控制了箭头旋转的中心。可以为&#x27;tail&#x27;/&#x27;mid&#x27;/&#x27;middle&#x27;/&#x27;tip&#x27;。tip表示箭头的尖尖。</span></span><br><span class="line"><span class="string">color:给出了箭头的颜色。如果给出了C参数，则该参数被忽略。</span></span><br><span class="line"><span class="string">其他参数控制了PolyCollection的属性</span></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line">quiverkey(*args, **kw)：给quiver设置key。常用的调用方式为：quiverkey(Q,X,Y,U,label,**kw)。</span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">Q：一个Quiver实例，由quiver()返回</span></span><br><span class="line"><span class="string">X/Y：key放置的位置，都是标量</span></span><br><span class="line"><span class="string">U：key的长度，都是标量</span></span><br><span class="line"><span class="string">label：一个字符串，指定了标记。</span></span><br><span class="line"><span class="string">coordinates：一个字符串，指定了X/Y的坐标系。</span></span><br><span class="line"><span class="string">    &#x27;axes&#x27;：axes坐标系，(0，0)为axes的左下角，(1,1)为axes的右上角。</span></span><br><span class="line"><span class="string">    &#x27;figure&#x27;：figure坐标系，(0，0)为figure的左下角，(1,1)为figure的右上角。</span></span><br><span class="line"><span class="string">    &#x27;data&#x27;：data坐标系</span></span><br><span class="line"><span class="string">    &#x27;inches&#x27;：为figure坐标系，但是以像素点为基准。(0,0)为左下角</span></span><br><span class="line"><span class="string">color：重写了Q的color</span></span><br><span class="line"><span class="string">labelpos：放置标记的位置，可以为&#x27;N&#x27;/&#x27;S&#x27;/&#x27;E&#x27;/&#x27;W&#x27;</span></span><br><span class="line"><span class="string">labelsep：给出了标记和箭头的距离，单位为英寸</span></span><br><span class="line"><span class="string">labelcolor：给出了标记的颜色</span></span><br><span class="line"><span class="string">fontproperties：一个字典或者FontProperties实例，设置了标记的字体。</span></span><br><span class="line"><span class="string">其他的关键字参数用于重写quiver的一些属性。</span></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line">semilogx(*args, **kwargs)：它类似plot()，只是将x轴设置为对数坐标。除了多了下面的参数外，其他设置与plot()一样。</span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">basex：一个大于 1 的标量，用于设置对数的底数</span></span><br><span class="line"><span class="string">subx：一个序列或者None。用于设置x轴的主要刻度值。默认采用自动设定</span></span><br><span class="line"><span class="string">nonposx：如果为&#x27;mask&#x27;，则x的负数或者零将被视作无效的数；</span></span><br><span class="line"><span class="string">         如果为&#x27;clip&#x27;，则x的负数或者零将被视作一个非常小的正数（因为对数的自变量要大于零）</span></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line">semilogy(*args, **kwargs)：它类似plot()，只是将y轴设置为对数坐标。除了多了下面的参数外，其他设置与plot()一样。</span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">basey：一个大于 1 的标量，用于设置对数的底数</span></span><br><span class="line"><span class="string">suby：一个序列或者None。用于设置y轴的主要刻度值。默认采用自动设定</span></span><br><span class="line"><span class="string">nonposy：如果为&#x27;mask&#x27;，则y的负数或者零将被视作无效的数；</span></span><br><span class="line"><span class="string">         如果为&#x27;clip&#x27;，则y的负数或者零将被视作一个非常小的正数（因为对数的自变量要大于零）</span></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line">spy(Z, precision=<span class="number">0</span>, marker=<span class="literal">None</span>, markersize=<span class="literal">None</span>, aspect=<span class="string">&#x27;equal&#x27;</span>, origin=<span class="string">&#x27;upper&#x27;</span>, **kwargs)：绘制矩阵中的非零值。</span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">Z：待绘制的二维矩阵，它和precision决定了绘制区域。坐标点(i,j)对应于Z[j,i]，即列对应于x轴。</span></span><br><span class="line"><span class="string">precision：只有Z中的那些大于precision的值才被绘制</span></span><br><span class="line"><span class="string">marker：用它来表示Z中的非零值</span></span><br><span class="line"><span class="string">markersize：marker的大小。</span></span><br><span class="line"><span class="string">aspect：高宽比</span></span><br><span class="line"><span class="string">origin：参考imshow的origin</span></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line">stem(*args, **kwargs)：绘制stem图。其调用方式为：</span><br><span class="line">  stem(y, linefmt=<span class="string">&#x27;b-&#x27;</span>, markerfmt=<span class="string">&#x27;bo&#x27;</span>, basefmt=<span class="string">&#x27;r-&#x27;</span>)</span><br><span class="line">  stem(x, y, linefmt=<span class="string">&#x27;b-&#x27;</span>, markerfmt=<span class="string">&#x27;bo&#x27;</span>, basefmt=<span class="string">&#x27;r-&#x27;</span>)</span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">linefmt：决定了垂线的格式。</span></span><br><span class="line"><span class="string">markerfmt：决定了每个`fmt`的格式。</span></span><br><span class="line"><span class="string">x：决定了每条垂线的位置（如果未提供，则为`[0,1,...len(y)-1]`）。</span></span><br><span class="line"><span class="string">y：序列决定了每条垂线的高度。</span></span><br><span class="line"><span class="string">basefmt：决定了位于`y=0`这条基准直线的格式。</span></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line">step(x, y, *args, **kwargs)：绘制阶梯图。调用方式为step(x, y, *args, **kwargs)</span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">x/y：都是一维序列，并且假设x为单调递增的（如果不满足，也不报错）</span></span><br><span class="line"><span class="string">where：指定分步类型。可以为&#x27;pre&#x27;/&#x27;post&#x27;/&#x27;mid&#x27;</span></span><br><span class="line"><span class="string">其他参数与plot()相同</span></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line">streamplot(x, y, u, v, density=<span class="number">1</span>, linewidth=<span class="literal">None</span>, color=<span class="literal">None</span>, cmap=<span class="literal">None</span>, </span><br><span class="line">           norm=<span class="literal">None</span>, arrowsize=<span class="number">1</span>, arrowstyle=<span class="string">&#x27;-|&gt;&#x27;</span>, minlength=<span class="number">0.1</span>, </span><br><span class="line">           transform=<span class="literal">None</span>, zorder=<span class="number">1</span>, start_points=<span class="literal">None</span>)：绘制向量场流线。</span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">x/y：一维数组，给出了网格的坐标</span></span><br><span class="line"><span class="string">u/v：二维数组，给出了每个网格的向量。其行数等于y的长度，列数等于x的长度</span></span><br><span class="line"><span class="string">density：一个浮点数或者浮点数的二元元组。控制了绘制向量场的密度。</span></span><br><span class="line"><span class="string">linewidth：标量或者二维数组，给出了每个向量箭头的线宽</span></span><br><span class="line"><span class="string">color：标量或者二维数组，给出了每个向量箭头的颜色</span></span><br><span class="line"><span class="string">cmap：一个Colormap实例。当color是一个二维数组时，它配合使用，给出了每个向量箭头的颜色</span></span><br><span class="line"><span class="string">norm：一个Normalize实例。当color是一个二维数组时，它配合使用，将颜色亮度调整为0~1</span></span><br><span class="line"><span class="string">arrowsize：一个浮点数，给出了箭头缩放比例</span></span><br><span class="line"><span class="string">arrowstyle：一个字符串，给出了箭头的类型。</span></span><br><span class="line"><span class="string">minlength：一个浮点数，限定了最小的向量长度</span></span><br><span class="line"><span class="string">start_points：它是一个N*2的数组，N流线起点的个数，给出了流线起始点的位置</span></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br></pre></td></tr></table></figure></p>
<p>常用绘图方法：<br />
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br><span class="line">234</span><br><span class="line">235</span><br><span class="line">236</span><br><span class="line">237</span><br><span class="line">238</span><br><span class="line">239</span><br><span class="line">240</span><br><span class="line">241</span><br><span class="line">242</span><br><span class="line">243</span><br><span class="line">244</span><br><span class="line">245</span><br><span class="line">246</span><br><span class="line">247</span><br><span class="line">248</span><br><span class="line">249</span><br><span class="line">250</span><br><span class="line">251</span><br><span class="line">252</span><br><span class="line">253</span><br><span class="line">254</span><br><span class="line">255</span><br><span class="line">256</span><br><span class="line">257</span><br><span class="line">258</span><br><span class="line">259</span><br><span class="line">260</span><br><span class="line">261</span><br><span class="line">262</span><br><span class="line">263</span><br><span class="line">264</span><br><span class="line">265</span><br><span class="line">266</span><br><span class="line">267</span><br><span class="line">268</span><br><span class="line">269</span><br><span class="line">270</span><br><span class="line">271</span><br><span class="line">272</span><br><span class="line">273</span><br><span class="line">274</span><br><span class="line">275</span><br><span class="line">276</span><br><span class="line">277</span><br><span class="line">278</span><br><span class="line">279</span><br><span class="line">280</span><br><span class="line">281</span><br><span class="line">282</span><br><span class="line">283</span><br><span class="line">284</span><br><span class="line">285</span><br><span class="line">286</span><br><span class="line">287</span><br><span class="line">288</span><br><span class="line">289</span><br><span class="line">290</span><br><span class="line">291</span><br><span class="line">292</span><br><span class="line">293</span><br><span class="line">294</span><br><span class="line">295</span><br><span class="line">296</span><br><span class="line">297</span><br><span class="line">298</span><br><span class="line">299</span><br><span class="line">300</span><br><span class="line">301</span><br><span class="line">302</span><br><span class="line">303</span><br><span class="line">304</span><br><span class="line">305</span><br><span class="line">306</span><br><span class="line">307</span><br><span class="line">308</span><br><span class="line">309</span><br><span class="line">310</span><br><span class="line">311</span><br><span class="line">312</span><br><span class="line">313</span><br><span class="line">314</span><br><span class="line">315</span><br><span class="line">316</span><br><span class="line">317</span><br><span class="line">318</span><br><span class="line">319</span><br><span class="line">320</span><br><span class="line">321</span><br><span class="line">322</span><br><span class="line">323</span><br><span class="line">324</span><br><span class="line">325</span><br><span class="line">326</span><br><span class="line">327</span><br><span class="line">328</span><br><span class="line">329</span><br><span class="line">330</span><br><span class="line">331</span><br><span class="line">332</span><br><span class="line">333</span><br><span class="line">334</span><br><span class="line">335</span><br><span class="line">336</span><br><span class="line">337</span><br><span class="line">338</span><br><span class="line">339</span><br><span class="line">340</span><br><span class="line">341</span><br><span class="line">342</span><br><span class="line">343</span><br><span class="line">344</span><br><span class="line">345</span><br><span class="line">346</span><br><span class="line">347</span><br><span class="line">348</span><br><span class="line">349</span><br><span class="line">350</span><br><span class="line">351</span><br><span class="line">352</span><br><span class="line">353</span><br><span class="line">354</span><br><span class="line">355</span><br><span class="line">356</span><br><span class="line">357</span><br><span class="line">358</span><br><span class="line">359</span><br><span class="line">360</span><br><span class="line">361</span><br><span class="line">362</span><br><span class="line">363</span><br><span class="line">364</span><br><span class="line">365</span><br><span class="line">366</span><br><span class="line">367</span><br><span class="line">368</span><br><span class="line">369</span><br><span class="line">370</span><br><span class="line">371</span><br><span class="line">372</span><br><span class="line">373</span><br><span class="line">374</span><br><span class="line">375</span><br><span class="line">376</span><br><span class="line">377</span><br><span class="line">378</span><br><span class="line">379</span><br><span class="line">380</span><br><span class="line">381</span><br><span class="line">382</span><br><span class="line">383</span><br><span class="line">384</span><br><span class="line">385</span><br><span class="line">386</span><br><span class="line">387</span><br><span class="line">388</span><br><span class="line">389</span><br><span class="line">390</span><br><span class="line">391</span><br><span class="line">392</span><br><span class="line">393</span><br><span class="line">394</span><br><span class="line">395</span><br><span class="line">396</span><br><span class="line">397</span><br><span class="line">398</span><br><span class="line">399</span><br><span class="line">400</span><br><span class="line">401</span><br><span class="line">402</span><br><span class="line">403</span><br><span class="line">404</span><br><span class="line">405</span><br><span class="line">406</span><br><span class="line">407</span><br><span class="line">408</span><br><span class="line">409</span><br><span class="line">410</span><br><span class="line">411</span><br><span class="line">412</span><br><span class="line">413</span><br><span class="line">414</span><br><span class="line">415</span><br><span class="line">416</span><br><span class="line">417</span><br><span class="line">418</span><br><span class="line">419</span><br><span class="line">420</span><br><span class="line">421</span><br><span class="line">422</span><br><span class="line">423</span><br><span class="line">424</span><br><span class="line">425</span><br><span class="line">426</span><br><span class="line">427</span><br><span class="line">428</span><br><span class="line">429</span><br><span class="line">430</span><br><span class="line">431</span><br><span class="line">432</span><br><span class="line">433</span><br><span class="line">434</span><br><span class="line">435</span><br><span class="line">436</span><br><span class="line">437</span><br><span class="line">438</span><br><span class="line">439</span><br><span class="line">440</span><br><span class="line">441</span><br><span class="line">442</span><br><span class="line">443</span><br><span class="line">444</span><br><span class="line">445</span><br><span class="line">446</span><br><span class="line">447</span><br></pre></td><td class="code"><pre><span class="line">bar(left, height, width=<span class="number">0.8</span>, bottom=<span class="literal">None</span>, **kwargs)：绘制一个bar。</span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">left：一个标量或者标量的序列，bar的左侧的x坐标，采用data坐标系</span></span><br><span class="line"><span class="string">height：一个标量或者标量的序列，bar的高度，采用data坐标系</span></span><br><span class="line"><span class="string">width：一个标量或者标量的序列，bar的宽度，默认为 0.8，采用data坐标系</span></span><br><span class="line"><span class="string">bottom：一个标量或者标量的序列，bar的底部的y坐标，默认为 0，采用data坐标系</span></span><br><span class="line"><span class="string">color：一个标量或者标量的序列，bar的背景色</span></span><br><span class="line"><span class="string">edgecolor：一个标量或者标量的序列，bar的边色颜色</span></span><br><span class="line"><span class="string">linewidth：一个标量或者标量的序列，bar的边的线宽</span></span><br><span class="line"><span class="string">tick_label：一个字符串或者字符串的序列，给出了bar的label</span></span><br><span class="line"><span class="string">xerr：一个标量或者标量的序列，用于设置bar的errorbar。（水平方向的小横线）</span></span><br><span class="line"><span class="string">yerr：一个标量或者标量的序列，用于设置bar的errorbar（垂直方向的小横线）</span></span><br><span class="line"><span class="string">ecolor：一个标量或者标量的序列，用于设置errorbar。</span></span><br><span class="line"><span class="string">capsize：一个标量，用于设置errorbar。小横线头部的一个小短线</span></span><br><span class="line"><span class="string">error_kw：一个字典，用于设置errorbar。如ecolor/capsize关键字</span></span><br><span class="line"><span class="string">align：一个字符串，设定bar的对齐方式。可以为&#x27;edge&#x27;/&#x27;center&#x27;。柱子的左边跟x=left线对齐，还是柱子的中线跟x=left线对齐。</span></span><br><span class="line"><span class="string">orientation：一个字符串，指定bar的方向。可以为&#x27;vertical&#x27;/&#x27;horizontal&#x27;。它决定了errbar和label放置的位置。</span></span><br><span class="line"><span class="string">log：一个布尔值，如果为True，则设置axis为对数坐标</span></span><br><span class="line"><span class="string">返回matplotlib.container.BarContainer。</span></span><br><span class="line"><span class="string">可以一次添加多个bar，此时就是上述的“标量的序列”。</span></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line">barh(bottom, width, height=<span class="number">0.8</span>, left=<span class="literal">None</span>, **kwargs)：绘制水平的bar</span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">bottom：一个标量或者标量的序列，bar的底部的y坐标，默认为 0，采用data坐标系</span></span><br><span class="line"><span class="string">width：一个标量或者标量的序列，bar的宽度，默认为 0.8，采用data坐标系</span></span><br><span class="line"><span class="string">height：一个标量或者标量的序列，bar的高度，采用data坐标系</span></span><br><span class="line"><span class="string">left：一个标量或者标量的序列，bar的左侧的x坐标，采用data坐标系</span></span><br><span class="line"><span class="string">其他参数参考 bar方法</span></span><br><span class="line"><span class="string">它就是bar(orientation=&#x27;horizontal&#x27;)</span></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line">errorbar(x, y, yerr=<span class="literal">None</span>, xerr=<span class="literal">None</span>, fmt=<span class="string">&#x27;&#x27;</span>, ecolor=<span class="literal">None</span>, elinewidth=<span class="literal">None</span>, capsize=<span class="literal">None</span>, </span><br><span class="line">        barsabove=<span class="literal">False</span>, lolims=<span class="literal">False</span>, uplims=<span class="literal">False</span>, xlolims=<span class="literal">False</span>, xuplims=<span class="literal">False</span>, errorevery=<span class="number">1</span>, </span><br><span class="line">        capthick=<span class="literal">None</span>, **kwargs)：绘制errorbar，返回(plotline, caplines, barlinecols)</span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">x：一个序列，指定x坐标</span></span><br><span class="line"><span class="string">y:一个序列，指定y坐标。即： y=f(x)</span></span><br><span class="line"><span class="string">yerr：指定y的error。</span></span><br><span class="line"><span class="string">      如果为标量，则每个点都是相同的error；</span></span><br><span class="line"><span class="string">      如果为一维向量，则依次给出了每个点的error。</span></span><br><span class="line"><span class="string">      如果是个二维向量，则依次给出了每个点的上error和下error</span></span><br><span class="line"><span class="string">xerr：指定x的error。</span></span><br><span class="line"><span class="string">      如果为标量，则每个点都是相同的error；</span></span><br><span class="line"><span class="string">      如果为一维向量，则依次给出了每个点的error。</span></span><br><span class="line"><span class="string">      如果是个二维向量，则依次给出了每个点的左error和右error</span></span><br><span class="line"><span class="string">fmt：可以为空字符串，或者&#x27;none&#x27;或者其他的plot format string。如果是&#x27;none&#x27;则只有errorbars能够被绘制</span></span><br><span class="line"><span class="string">color：点(x, y)的颜色，比如color=black&#x27;&#x27;</span></span><br><span class="line"><span class="string">ecolor：指定了errorbar的颜色，比如ecolor=&#x27;lightgray&#x27;</span></span><br><span class="line"><span class="string">elinewidth：指定了errorbar的线宽</span></span><br><span class="line"><span class="string">capsize：指定了errorbar头部的小横线的宽度</span></span><br><span class="line"><span class="string">errorevery：一个整数。如果为 4， 则每隔 4个点才绘制一个errorbar</span></span><br><span class="line"><span class="string">其他的关键字参数都是用于指定marker的类型。</span></span><br><span class="line"><span class="string">     如： `marker=&#x27;s&#x27;,mfc=&#x27;red&#x27;, mec=&#x27;green&#x27;, ms=20, mew=4。</span></span><br><span class="line"><span class="string">     他们是markderfacecolor,markeredgecolor,markdersize,markderedgewidth的缩写。</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">errorbar是配合散点图使用，分析离散变量的误差性。</span></span><br><span class="line"><span class="string">我的经验是，让误差线的颜色比数据点的颜色浅一点，效果会非常好，尤其在点密集的图形中。</span></span><br><span class="line"><span class="string">比如，plt.errorbar(x, y, yerr=dy, fmt=&#x27;o&#x27;, color=&#x27;black&#x27;,ecolor=&#x27;lightgray&#x27;, elinewidth=3, capsize=0)</span></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line">eventplot(positions, orientation=<span class="string">&#x27;horizontal&#x27;</span>, lineoffsets=<span class="number">1</span>, linelengths=<span class="number">1</span>, </span><br><span class="line">          linewidths=<span class="literal">None</span>, colors=<span class="literal">None</span>, linestyles=<span class="string">&#x27;solid&#x27;</span>, **kwargs) ：绘制时间线。</span><br><span class="line">          时间线就是在指定位置上并排的一系列线段。返回 matplotlib.collections.EventCollection的一个列表</span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">positions：一个一维或者二维的数组。每一行代表了一组直线</span></span><br><span class="line"><span class="string">orientation：可以为&#x27;horizonal&#x27;|&#x27;vertical&#x27;，代表了摆放时间线的方式。</span></span><br><span class="line"><span class="string">             如果是水平走向的，则垂直摆放直线；如果是垂直走向的，则水平放置直线</span></span><br><span class="line"><span class="string">lineoffsets：一个浮点数或者浮点数的序列，指定了时间线中轴距离y=0的偏离值</span></span><br><span class="line"><span class="string">linelengths：一个浮点数或者浮点数的序列，指定了线的长度</span></span><br><span class="line"><span class="string">linewidths：一个浮点数或者浮点数的序列，指定了线的宽度</span></span><br><span class="line"><span class="string">colors：一个颜色或者一组颜色，指定了线的颜色。颜色可以为颜色字符串，或者一个RGB元组。</span></span><br><span class="line"><span class="string">linestyles：一个线型或者一组线型，指定了线型。线型在&#x27;solid&#x27; | &#x27;dashed&#x27; | &#x27;dashdot&#x27; | &#x27;dotted&#x27;四者之一</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">如果positions是一个一维数组，表示绘制一组时间线。</span></span><br><span class="line"><span class="string">    那么lineoffsets/linelengths/linewidths/colors/linestyles都是标量值，指定该组时间线的格式。</span></span><br><span class="line"><span class="string">    如果positions是一个二维数组则，有多少行，就有多少组时间线。</span></span><br><span class="line"><span class="string">        制定时间线格式的这些参数都是序列，序列长度就是positions的行数。</span></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line">fill(*args, **kwargs)：绘制多边形。返回一个Patch列表，plot()支持的颜色字符在这里也被支持。其常用的方式为：</span><br><span class="line">    fill(x,y,<span class="string">&#x27;b&#x27;</span>)：绘制一个多边形。其中x为多边形的边上的点的x坐标；y为多边形的边上的点的y坐标。<span class="string">&#x27;b&#x27;</span>为多边形的填充颜色。</span><br><span class="line">    fill(x1,y1,<span class="string">&#x27;b&#x27;</span>,x2,y2,<span class="string">&#x27;r&#x27;</span>)：绘制多个多边形。这里指定多个x,y,color就可以。</span><br><span class="line"><span class="string">&#x27;&#x27;&#x27; </span></span><br><span class="line"><span class="string">closed：一个布尔值，确定是否封闭多边形（即多一条从起点到终点的边）。默认为True。</span></span><br><span class="line"><span class="string">剩下的关键字参数用于控制Polygon的属性。如</span></span><br><span class="line"><span class="string">    hatch：一个字符串，指定填充方式，如[&#x27;/&#x27; | &#x27;\&#x27; | &#x27;|&#x27; | &#x27;-&#x27; | &#x27;+&#x27; | &#x27;x&#x27; | &#x27;o&#x27; | &#x27;O&#x27; | &#x27;.&#x27; | &#x27;*&#x27;]</span></span><br><span class="line"><span class="string">    label：一个字符串，指定标签</span></span><br><span class="line"><span class="string">    fill：一个布尔值，决定是否填充</span></span><br><span class="line"><span class="string">    facecolor/edgecolor/color：颜色</span></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line">fill_between(x, y1, y2=<span class="number">0</span>, where=<span class="literal">None</span>, interpolate=<span class="literal">False</span>, step=<span class="literal">None</span>, **kwargs)：绘制填充区域。</span><br><span class="line">它填充两个曲线之间的部分。它返回一个PolyCollection对象。</span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">x：一个序列，指定x坐标</span></span><br><span class="line"><span class="string">y1：第一条曲线的纵坐标。如果为标量，说明该曲线为水平线。相当于y轴的连续误差线（下限）。</span></span><br><span class="line"><span class="string">y2：第二条曲线的纵坐标。如果为标量，说明该曲线为水平线。相当于y轴的连续误差线（上限）。</span></span><br><span class="line"><span class="string">where：指定填充哪里。</span></span><br><span class="line"><span class="string">       如果为None，则填充两条曲线之间的所有区域，这是默认值。</span></span><br><span class="line"><span class="string">       如果非None，则他是一个一维布尔数组，长度与x相同。只有为True对应的x处才被填充。</span></span><br><span class="line"><span class="string">interpolate：一个布尔值。如果True，则进行插值计算来寻找两个曲线的交点。如果为False，则不进行插值。</span></span><br><span class="line"><span class="string">step：可以为&#x27;pre&#x27;/&#x27;post&#x27;/&#x27;mid&#x27;或者None，设定填充区域的边界的形状。</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">我的经验是，可以画连续变量误差区间。结合plot绘制连续误差线的上界和下界曲线，并且用颜色填充区间。</span></span><br><span class="line"><span class="string">比如：plt.fill_between(xfit, yfit-dyfit, yfit+dyfit, color=&#x27;gray&#x27;, alpha=&#x27;0.2&#x27;)</span></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line">fill_betweenx(y, x1, x2=<span class="number">0</span>, where=<span class="literal">None</span>, step=<span class="literal">None</span>, **kwargs)：绘制填充区域。</span><br><span class="line">该区域是以y为自变量，x为函数的两条曲线合围而成。它返回一个PolyCollection对象。</span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">y：一个序列，为纵坐标</span></span><br><span class="line"><span class="string">x1：第一个曲线的x坐标。它是一个反函数，即以y为自变量。相当于x轴的连续误差线（下限）。</span></span><br><span class="line"><span class="string">x2：第二个曲线的y坐标。它也是一个反函数。相当于x轴的连续误差线（上限）。</span></span><br><span class="line"><span class="string">where：指定填充哪里。</span></span><br><span class="line"><span class="string">       如果为None，则填充两条曲线之间的所有区域，这是默认值。</span></span><br><span class="line"><span class="string">       如果非None，则他是一个一维布尔数组，长度与y相同。只有为True对应的y处才被填充。</span></span><br><span class="line"><span class="string">step：可以为&#x27;pre&#x27;/&#x27;post&#x27;/&#x27;mid&#x27;或者None，设定填充区域的边界的形状。</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">通常建议提供一个alpha参数，用于设定填充的透明度。</span></span><br><span class="line"><span class="string">如果同一个区域被多个fill_between()填充，那么设定alpha之后会让每一层都能显示出来。</span></span><br><span class="line"><span class="string">fill_between沿着x轴填充；fill_betweenx沿着y轴填充</span></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line">hist(x, bins=<span class="number">10</span>, <span class="built_in">range</span>=<span class="literal">None</span>, normed=<span class="literal">False</span>, weights=<span class="literal">None</span>, cumulative=<span class="literal">False</span>, </span><br><span class="line">    bottom=<span class="literal">None</span>, histtype=<span class="string">&#x27;bar&#x27;</span>, align=<span class="string">&#x27;mid&#x27;</span>, orientation=<span class="string">&#x27;vertical&#x27;</span>, </span><br><span class="line">    rwidth=<span class="literal">None</span>, log=<span class="literal">False</span>, color=<span class="literal">None</span>, label=<span class="literal">None</span>, stacked=<span class="literal">False</span>, **kwargs) ：绘制频次直方图。 其返回值为：</span><br><span class="line">    如果绘制一个直方图，那么就是元组 (n, bins, patches)，n为频数/频率；bins为直方图的各个分界点；patches为每个直方图</span><br><span class="line">    如果绘制多个直方图，那么就是元组 ([n0, n1, ...], bins, [patches0, patches1,...])</span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">x:一个序列或者一维数组，给定了直方图的数据</span></span><br><span class="line"><span class="string">bins：一个整数。返回了bins+1个分界点，将竖着划分成等分的bins份。</span></span><br><span class="line"><span class="string">      你可以传递一个序列，指定分界点，此时可以实现非等分的划分。</span></span><br><span class="line"><span class="string">range：一个元组，给出了数据的上界和下界，在这之外的数据不被考虑。默认就是(x.min(),x.max())</span></span><br><span class="line"><span class="string">normed：布尔值，如果为True，则返回的是数据出现的频率；否则返回的是数据出现的频数</span></span><br><span class="line"><span class="string">weights：长度与x相同的序列，给出了每个数据的权重</span></span><br><span class="line"><span class="string">cumulative  ：布尔值。如果为True，则计算的是累积频率/频数</span></span><br><span class="line"><span class="string">bottom：一个整数或者整数序列或者None，指定了直方图底部的纵坐标。默认为 0</span></span><br><span class="line"><span class="string">histtype：直方图的类型。可以为&#x27;bar&#x27;/&#x27;barstacked&#x27;/&#x27;step&#x27;/&#x27;stepfilled&#x27;</span></span><br><span class="line"><span class="string">align：直方图每个小矩形的对齐方式。可以为&#x27;left&#x27;/&#x27;mid&#x27;/right&#x27;</span></span><br><span class="line"><span class="string">orientation：调整方向。可以为&#x27;horizontal&#x27;/&#x27;vertical&#x27;。如果为水平则，使用barh，同时bottom参数设定的是左侧的横坐标值</span></span><br><span class="line"><span class="string">rwidth：一个标量值，设定了直方图每个矩形的相对于默认值的宽度。如果直方图类型为 step/stepfilled，则忽略该参数。</span></span><br><span class="line"><span class="string">log：布尔值。如果为True：则x轴使用对数坐标</span></span><br><span class="line"><span class="string">color：颜色或者颜色序列，用于给直方图指定颜色</span></span><br><span class="line"><span class="string">label：字符串或者字符串序列。给直方图指定标签</span></span><br><span class="line"><span class="string">stacked：一个布尔值。如果为True，则多个直方图会叠加在一起。</span></span><br><span class="line"><span class="string">其他参数设置了Patch的属性</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">我的经验是，对不同分布特征的样本进行对比时，histtype=‘stepfilled&#x27;和alpha配合效果很好。</span></span><br><span class="line"><span class="string">如果只是分段区间，显示区间数量，不显示图，使用np.histogram(data,bins)更好。</span></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line">hist2d(x, y, bins=<span class="number">10</span>, <span class="built_in">range</span>=<span class="literal">None</span>, normed=<span class="literal">False</span>, </span><br><span class="line">        weights=<span class="literal">None</span>, cmin=<span class="literal">None</span>, cmax=<span class="literal">None</span>, **kwargs)：</span><br><span class="line">        将二维数组按照二维区间进行切分，绘制二维频次直方图。</span><br><span class="line">        其返回值为元组 (counts, xedges, yedges, Image) </span><br><span class="line">        二维频次直方图由与坐标轴的方块分割而成的，用于同一个地方有很多点的情况。  </span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">x:一个序列或者一维数组，给定了x坐标序列</span></span><br><span class="line"><span class="string">y:一个序列或者一维数组，给定了y坐标序列</span></span><br><span class="line"><span class="string">bins：</span></span><br><span class="line"><span class="string">    如果为整数，则给出了两个维度上的区间数量</span></span><br><span class="line"><span class="string">    如果为int,int序列，则分别给出了x区间数量和y区间数量</span></span><br><span class="line"><span class="string">    如果给定了一个一维数组，则给出了 x_edges=y_edges=bins</span></span><br><span class="line"><span class="string">    如果为定了array,array，则分别给出了x_edges,y_edges</span></span><br><span class="line"><span class="string">range：一个(2,2)的数组，给出了数据的上界和下界，在这之外的数据不被考虑。默认就是(x.min(),x.max())</span></span><br><span class="line"><span class="string">normed：布尔值，如果为True，则返回的是数据出现的频率；否则返回的是数据出现的频数</span></span><br><span class="line"><span class="string">weights：长度与x相同的序列，给出了每个数据的权重</span></span><br><span class="line"><span class="string">cmin：一个标量值。那些count值小于cmin的单元不被显示。同时返回的结果中，这些单元返回nan</span></span><br><span class="line"><span class="string">cmax：一个标量值。那些count值大于cmax的单元不被显示。同时返回的结果中，这些单元返回nan</span></span><br><span class="line"><span class="string">其他参数设置了pcolorfast()属性</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">如果只是分段区间，显示区间数量，不显示图，使用np.histogram2ds(x, y, bins)更好。</span></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line">hexbin(x, y, C=<span class="literal">None</span>, gridsize=<span class="number">100</span>, bins=<span class="literal">None</span>, xscale=<span class="string">&#x27;linear&#x27;</span>, yscale=<span class="string">&#x27;linear&#x27;</span>, </span><br><span class="line">    extent=<span class="literal">None</span>, cmap=<span class="literal">None</span>, norm=<span class="literal">None</span>, vmin=<span class="literal">None</span>, vmax=<span class="literal">None</span>, alpha=<span class="literal">None</span>, </span><br><span class="line">    linewidths=<span class="literal">None</span>, edgecolors=<span class="string">&#x27;none&#x27;</span>, reduce_C_function=&lt;function mean&gt;, </span><br><span class="line">    mincnt=<span class="literal">None</span>, marginals=<span class="literal">False</span>, **kwargs)：</span><br><span class="line">    同hist2d，绘制二维频次直方图。不同的是六边形面元划分。返回一个PolyCollection对象。</span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">x/y：一维数组，它们形状相同。它们给出了绘制六边形面元的点。</span></span><br><span class="line"><span class="string">C：如果非None，则它给出了坐标(x[i],y[i])的count value。它和x长度相同，也是一维数组</span></span><br><span class="line"><span class="string">   x/y/C也可能是masked array，此时只有unmasked的点才被绘制</span></span><br><span class="line"><span class="string">reduce_C_function：将坐标(x[i],y[i])的count value进行归并。</span></span><br><span class="line"><span class="string">                   因为同一个坐标可能被设定了多个count value。而每个点根据其count value来染色</span></span><br><span class="line"><span class="string">gridsize：一个整数。它调整了六边形面元x方向的尺寸，y方向的尺寸自动选取。</span></span><br><span class="line"><span class="string">         你也可以设定它为一个元组，同时调整x/y方向的尺寸。</span></span><br><span class="line"><span class="string">         它实际上给出的是x轴可以放置的面元数量，因此该数值越大，六边形面元尺寸越小。</span></span><br><span class="line"><span class="string">bins：</span></span><br><span class="line"><span class="string">    如果为None，则每个六边形面元的颜色值直接对应了它的count value</span></span><br><span class="line"><span class="string">    如果为&#x27;log&#x27;，则每个六边形面元的颜色值对应了它的count value+1的对数值</span></span><br><span class="line"><span class="string">    如果为一个整数，将counts划分为指定数量的箱，并相应地为六边形上色</span></span><br><span class="line"><span class="string">    如果为一个整数序列，则使用箱边界的下限值</span></span><br><span class="line"><span class="string">xscale：可以为&#x27;linear&#x27;/&#x27;log&#x27;，设置了x轴是线性还是对数</span></span><br><span class="line"><span class="string">scale：可以为&#x27;linear&#x27;/&#x27;log&#x27;，设置了y轴是线性还是对数</span></span><br><span class="line"><span class="string">mincnt：一个整数或者None。它指定显示这一类的面元：面元包含的坐标点的数量超过mincnt。</span></span><br><span class="line"><span class="string">        对于面元包含坐标点数量少于mincnt的，不显示。</span></span><br><span class="line"><span class="string">marginals：一个布尔值。如果为True，则沿着坐标轴绘制密度条。</span></span><br><span class="line"><span class="string">extent：一个元组(left, right, bottom, top)，等价于同时使用了set_xlim(left,right)+set_ylim(bottom,top)。</span></span><br><span class="line"><span class="string">剩下的参数设定颜色和面元的属性。</span></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line">contour(*args, **kwargs)：绘制等高线。它返回一个QuadContourSet对象 最常用的四种方式：</span><br><span class="line">    contour(Z)：其中Z为二维数组。数据坐标系下的坐标点(i,j)对应了Z[j,i]（x轴对应列，y轴对应行）。</span><br><span class="line">                该方法随机挑选一些等高线绘制。</span><br><span class="line">    contour(X,Y,Z)：其中 X/Y/Z均为二维数组，且形状相同。对应位置的横坐标由X提供，纵坐标由Y提供，值由Z提供。</span><br><span class="line">                    X和Y也可以同时是一维数组，且<span class="built_in">len</span>(X)是Z的列数，<span class="built_in">len</span>(Y)是Z的行数。</span><br><span class="line">                    该方法随机挑选一些等高线绘制。</span><br><span class="line">    contour(Z,N)/contour(X,Y,Z,N)：N为一个整数，表示绘制N条等高线。该方法随机挑选N条等高线绘制。</span><br><span class="line">    contour(Z,V)/contour(X,Y,Z,V)：V为一个递增的序列，表示绘制那些值位于V中的等高线</span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">colors：如果为None，则由cmap给出。如果是一个字符串，这所有的等高线由字符串指定的颜色给出。</span></span><br><span class="line"><span class="string">        如果是一个序列，该序列中每个都代表了一个颜色，则等高线的颜色依次由该序列给出。</span></span><br><span class="line"><span class="string">cmap：一个Colormap对象。如果为None，则默认的Colormap将被使用</span></span><br><span class="line"><span class="string">levels：一个序列（升序排列）。指定了要绘制等高线值位于levels的等高线。</span></span><br><span class="line"><span class="string">origin：可以为&#x27;upper&#x27;/&#x27;lower&#x27;。图片的第一个像素X[0,0]放置在坐标原点。默认是左上。</span></span><br><span class="line"><span class="string">        &#x27;upper&#x27;：横坐标向右，纵坐标向下</span></span><br><span class="line"><span class="string">        &#x27;lower&#x27;：横坐标向右，纵坐标向上</span></span><br><span class="line"><span class="string">extent：它是一个元组(x0,x1,y0,y1)。如果给出了(X,Y)，则该参数无效。如果未给出(X,Y)：</span></span><br><span class="line"><span class="string">        如果origin非None，则它给出了外边界， Z[0,0]位于图形中间</span></span><br><span class="line"><span class="string">        如果origin为None，则(x0,y0)对应Z[0,0]；(x1,y1)对应Z[-1.-1]，</span></span><br><span class="line"><span class="string">            等价于同时使用了set_xlim(left,right) + set_ylim(bottom,top)</span></span><br><span class="line"><span class="string">antialiased：一个布尔值，用于开启/关闭反走样</span></span><br><span class="line"><span class="string">linewidths：如果为None，则使用默认值。如果为一个整数，则所有的等高线都是用该线宽。</span></span><br><span class="line"><span class="string">            如果为一个整数序列，则等高线依次使用它指定的线宽。只有contour适用</span></span><br><span class="line"><span class="string">linestyles：如果为None，则使用默认的实线。你也可以指定为&#x27;solid&#x27;/&#x27;dashed&#x27;/&#x27;dashdot&#x27;/&#x27;dotted&#x27;。</span></span><br><span class="line"><span class="string">            你可以指定搜有的等高线使用一种线型，也可以使用一个线型序列。只有contour适用</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">所有使用cmap调色盘的，都可以plt.colorbar()显示颜色条。</span></span><br><span class="line"><span class="string">我的经验是，contour方法等高线图单一，可以进一步使用contourf方法在等高线间进行颜色填充，区分度更高。</span></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line">contourf(*args, **kwargs)：它绘制的是带填充的等高线。其参数和用法基本和contour相同。它返回一个QuadContourSet对象。</span><br><span class="line">    contourf(Z,V)：</span><br><span class="line">    contourf(X,Y,Z,V)：</span><br><span class="line">    V是递增的序列，指定了等高线的值。该方法会填充V中相邻两个等高线之间的区域。</span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">hatches：它指定了填充区域的填充类型（如以小斜线填充）。</span></span><br><span class="line"><span class="string">         如果为None，则无任何hatch。它典型值为hatches=[&#x27;.&#x27;, &#x27;/&#x27;, &#x27;\&#x27;, None, &#x27;\\&#x27;, &#x27;*&#x27;,&#x27;-&#x27;,]</span></span><br><span class="line"><span class="string">contourf填充的是半开半闭区间(z1,z2]</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">我的经验是，contourf进一步提高了等高线图的显示效果，但区分度强，看上去像是一块块斑渍，可用imshow渲染成渐变图。</span></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line">imshow(X, cmap=<span class="literal">None</span>, norm=<span class="literal">None</span>, aspect=<span class="literal">None</span>, interpolation=<span class="literal">None</span>, </span><br><span class="line">        alpha=<span class="literal">None</span>, vmin=<span class="literal">None</span>, vmax=<span class="literal">None</span>, origin=<span class="literal">None</span>, extent=<span class="literal">None</span>, </span><br><span class="line">        shape=<span class="literal">None</span>, filternorm=<span class="number">1</span>, filterrad=<span class="number">4.0</span>, imlim=<span class="literal">None</span>, </span><br><span class="line">        resample=<span class="literal">None</span>, url=<span class="literal">None</span>, **kwargs)：绘制色彩图片。返回一个AxesImage对象</span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">X：包含了图片的数据。其形状可以为：</span></span><br><span class="line"><span class="string">   (n,m)（灰度图），类型为float</span></span><br><span class="line"><span class="string">   (n,m,3)（RGB图），类型为float（此时每个元素的值都在 0 和 1.0 之间），或者unit8</span></span><br><span class="line"><span class="string">   (n,m,4)（RGBA图），类型为float（此时每个元素的值都在 0 和 1.0 之间），或者unit8</span></span><br><span class="line"><span class="string">cmap：一个Colormap实例。默认由rc的image.cmap指定。如果X是RGB/RGBA，则忽略该参数</span></span><br><span class="line"><span class="string">aspect：一个字符串，指定图片的缩放。可以为：</span></span><br><span class="line"><span class="string">        &#x27;auto&#x27;：缩放图片的宽高比，是的它匹配axes</span></span><br><span class="line"><span class="string">        &#x27;equal&#x27;：当extent参数为None时，修改axes的宽高比，使得它匹配图片；</span></span><br><span class="line"><span class="string">                 如果extent参数不是None，则修改axes的宽高比来匹配extent</span></span><br><span class="line"><span class="string">        None：默认由rc的image.aspect指定</span></span><br><span class="line"><span class="string">interpolation：一个字符串，指定插值方式。</span></span><br><span class="line"><span class="string">              可以为&#x27;none&#x27;, &#x27;nearest&#x27;, &#x27;bilinear&#x27;, &#x27;bicubic&#x27;, &#x27;spline16&#x27;, &#x27;spline36&#x27;, &#x27;hanning&#x27;, </span></span><br><span class="line"><span class="string">              &#x27;hamming&#x27;, &#x27;hermite&#x27;, &#x27;kaiser&#x27;, &#x27;quadric&#x27;, &#x27;catrom&#x27;, &#x27;gaussian&#x27;,</span></span><br><span class="line"><span class="string">              &#x27;bessel&#x27;, &#x27;mitchell&#x27;, &#x27;sinc&#x27;, &#x27;lanczos&#x27;</span></span><br><span class="line"><span class="string">norm：一个Normalize实例，用于将图片亮度正则化到 0~1。如果为None，则采用normalize.norm</span></span><br><span class="line"><span class="string">vmin/vmax：用于辅助norm进行正则化。如果你传入了一个norm实例，则该参数忽略</span></span><br><span class="line"><span class="string">alpha：浮点数，指定透明度</span></span><br><span class="line"><span class="string">origin：&#x27;upper&#x27;/&#x27;lower&#x27;。图片的第一个像素X[0,0]放置在坐标原点，默认左上角。</span></span><br><span class="line"><span class="string">        &#x27;upper&#x27;：横坐标向右，纵坐标向下</span></span><br><span class="line"><span class="string">        &#x27;lower&#x27;：横坐标向右，纵坐标向上。正常方向，建议用此参数。</span></span><br><span class="line"><span class="string">extent：一个元组(left, right, bottom, top)，等价于set_xlim(left,right)+set_ylim(bottom,top)</span></span><br><span class="line"><span class="string">shape：一个元组(column,rows)，用于rar buffer image</span></span><br><span class="line"><span class="string">filternorm/filterrad：用于过滤</span></span><br><span class="line"><span class="string">其他参数用于调整 Artist属性</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">我的经验是：</span></span><br><span class="line"><span class="string">imshow不支持x轴、y轴设置网格，而是通过extent设置图形坐标范围。</span></span><br><span class="line"><span class="string">imshow会自动调整坐标轴的精度以适应数据显示。可通过plt.axis(aspect=&#x27;image&#x27;)来设置x轴与y轴的单位。</span></span><br><span class="line"><span class="string">等高线图+色彩图，使用alpha设置透明度，用plt.clabel()函数与另一幅坐标轴相同、带数据标签的等高线图叠放在一起，效果更好:</span></span><br><span class="line"><span class="string">    contours = plt.contour(X, Y, Z, 3, colors=&#x27;black&#x27;)</span></span><br><span class="line"><span class="string">    plt.clabel(contours, inline=True, fontsize=8) # 叠放</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">    plt.imshow(Z, extent=[0, 5, 0, 5], origin=&#x27;lower&#x27;,cmap=&#x27;RdGy&#x27;, alpha=0.5)</span></span><br><span class="line"><span class="string">    plt.colorbar()</span></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line">matshow(Z, **kwargs)：将一个矩阵绘制成图片。</span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">Z：一个形状为(n,m)的数组</span></span><br><span class="line"><span class="string">其他参数见imshow</span></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line">Legend(*args, **kwargs)：创建图例。</span><br><span class="line">ax.legend((line1,line2),(<span class="string">&#x27;label1&#x27;</span>,<span class="string">&#x27;label2&#x27;</span>))：</span><br><span class="line">    输入lines列表，lines标签名列表。</span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">loc：指定了图例的位置。可以为整数、字符串：</span></span><br><span class="line"><span class="string">     对应于整数的0~10。也可以指定坐标(x,y)，其中(0,0)是左下角，(1,1)是右上角</span></span><br><span class="line"><span class="string">     &#x27;best&#x27;/&#x27;upper right&#x27;/&#x27;upper left&#x27;</span></span><br><span class="line"><span class="string">     /&#x27;lower left&#x27;/&#x27;lower right&#x27;/&#x27;right&#x27;/&#x27;center left&#x27;/</span></span><br><span class="line"><span class="string">     &#x27;center right&#x27;/&#x27;lower center&#x27;/&#x27;upper center&#x27;/&#x27;center&#x27;，</span></span><br><span class="line"><span class="string">ncol：一个整数，指定图例中有几列，默认为 1列</span></span><br><span class="line"><span class="string">prop：一个字典，或者FontProperties实例，可以指定图例中的字体属性。</span></span><br><span class="line"><span class="string">fontsize：控制字体大小，可以为整数、浮点数（指定字体绝对大小），或者字符串:</span></span><br><span class="line"><span class="string">         &#x27;xx-small&#x27;, &#x27;x-small&#x27;, &#x27;small&#x27;, &#x27;medium&#x27;, &#x27;large&#x27;, &#x27;x-large&#x27;, &#x27;xx-large&#x27;</span></span><br><span class="line"><span class="string">numpoint/scatterpoints：图例上每个图例线的点数</span></span><br><span class="line"><span class="string">fancybox：如果为True，图例的边框采用圆角矩形</span></span><br><span class="line"><span class="string">framealpha：一个浮点数，从0到1，外边框的透明度</span></span><br><span class="line"><span class="string">frameon：如果为True，则绘制图例的背景框。否则不绘制</span></span><br><span class="line"><span class="string">shadow：如果为True，图例添加背影</span></span><br><span class="line"><span class="string">ncol：标签列数</span></span><br><span class="line"><span class="string">title：图例的标题</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">图例显示：</span></span><br><span class="line"><span class="string">（1）plt.plot(x, y)返回lines实例列表，然后直接调用ax.legend()即可。</span></span><br><span class="line"><span class="string">（2）单个创建line，然后调用line.set_label()，然后调用ax.legend()。</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">默认会不显示无标签的line。</span></span><br><span class="line"><span class="string">如果你想显示部分line，那么只需把想显示的line添加标签即可。</span></span><br><span class="line"><span class="string">如果你想显示全部line + 显示部分图例，那么需绘制两幅图：</span></span><br><span class="line"><span class="string">    第一幅不添加标签（显示全部line）；</span></span><br><span class="line"><span class="string">    第二幅line数据为空，图例数据（比如图形大小,颜色等）添加标签。</span></span><br><span class="line"><span class="string">&#x27;&#x27;</span></span><br><span class="line"><span class="string">import pandas as pd</span></span><br><span class="line"><span class="string">cities = pd.read_csv(&#x27;data/california_cities.csv&#x27;)</span></span><br><span class="line"><span class="string"># 提取感兴趣的数据</span></span><br><span class="line"><span class="string">lat, lon = cities[&#x27;latd&#x27;], cities[&#x27;longd&#x27;]</span></span><br><span class="line"><span class="string">population, area = cities[&#x27;population_total&#x27;], cities[&#x27;area_total_km2&#x27;]</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string"># 用不同尺寸和颜色的散点图表示数据，但是不带标签</span></span><br><span class="line"><span class="string">plt.scatter(lon, lat, label=None, c=np.log10(population), cmap=&#x27;viridis&#x27;,</span></span><br><span class="line"><span class="string">            s=area, linewidth=0, alpha=0.5)</span></span><br><span class="line"><span class="string">plt.axis(aspect=&#x27;equal&#x27;)</span></span><br><span class="line"><span class="string">plt.xlabel(&#x27;longitude&#x27;)</span></span><br><span class="line"><span class="string">plt.ylabel(&#x27;latitude&#x27;)</span></span><br><span class="line"><span class="string">plt.colorbar(label=&#x27;log$_&#123;10&#125;$(population)&#x27;)</span></span><br><span class="line"><span class="string">plt.clim(3, 7)</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string"># 下面创建一个图例：</span></span><br><span class="line"><span class="string"># 画一些带标签和尺寸的空列表，尺寸代表面积</span></span><br><span class="line"><span class="string">for area in [100, 300, 500]:</span></span><br><span class="line"><span class="string">    plt.scatter([], [], c=&#x27;k&#x27;, alpha=0.3, s=area, label=str(area) + &#x27; km$^2$&#x27;)</span></span><br><span class="line"><span class="string">plt.legend(scatterpoints=1, frameon=False, labelspacing=1, title=&#x27;City Area&#x27;)</span></span><br><span class="line"><span class="string">plt.title(&#x27;California Cities: Area and Population&#x27;)</span></span><br><span class="line"><span class="string">&#x27;&#x27;</span></span><br><span class="line"><span class="string">如果你想显示多个图例，可以通过Legend()创建一个新的legend artist，然后用底层的ax.add_artist()方法在图上添加第二个图例:</span></span><br><span class="line"><span class="string">&#x27;&#x27;</span></span><br><span class="line"><span class="string">fig, ax = plt.subplots()</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">lines = []</span></span><br><span class="line"><span class="string">styles = [&#x27;-&#x27;, &#x27;--&#x27;, &#x27;-.&#x27;, &#x27;:&#x27;]</span></span><br><span class="line"><span class="string">x = np.linspace(0, 10, 1000)</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">for i in range(4):</span></span><br><span class="line"><span class="string">    lines += ax.plot(x, np.sin(x - i * np.pi / 2), styles[i], color=&#x27;black&#x27;)</span></span><br><span class="line"><span class="string">ax.axis(&#x27;equal&#x27;)</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string"># 设置第一个图例要显示的线条和标签</span></span><br><span class="line"><span class="string">ax.legend(lines[:2], [&#x27;line A&#x27;, &#x27;line B&#x27;], loc=&#x27;upper right&#x27;, frameon=False)</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string"># 创建第二个图例，通过add_artist方法添加到图上</span></span><br><span class="line"><span class="string">from matplotlib.legend import Legend</span></span><br><span class="line"><span class="string">leg = Legend(ax, lines[2:], [&#x27;line C&#x27;, &#x27;line D&#x27;], loc=&#x27;lower right&#x27;, frameon=False)</span></span><br><span class="line"><span class="string">ax.add_artist(leg)</span></span><br><span class="line"><span class="string">&#x27;&#x27;</span></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line">pie(x, explode=<span class="literal">None</span>, labels=<span class="literal">None</span>, colors=<span class="literal">None</span>, autopct=<span class="literal">None</span>, pctdistance=<span class="number">0.6</span>, </span><br><span class="line">    shadow=<span class="literal">False</span>, labeldistance=<span class="number">1.1</span>, startangle=<span class="literal">None</span>, radius=<span class="literal">None</span>, counterclock=<span class="literal">True</span>,</span><br><span class="line">    wedgeprops=<span class="literal">None</span>, textprops=<span class="literal">None</span>, center=(<span class="number">0</span>, <span class="number">0</span>), frame=<span class="literal">False</span>)：绘制饼状图。</span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">x：数据序列。每一块饼的权重为x/sum(x)；如果sum(x)&lt;=1，则x已经代表了每一块饼的权重，</span></span><br><span class="line"><span class="string">             此时并不会除以sum(x)。饼状图从x轴开始，逆时针绘制。</span></span><br><span class="line"><span class="string">explode：如果不是None，则它给出了每个饼的径向偏移量。该偏移量表示：径向偏移除以半径。</span></span><br><span class="line"><span class="string">colors：给出了每一块饼的颜色。可以为None或者颜色序列</span></span><br><span class="line"><span class="string">labels：给出了每个饼的字符串标签。可以为None或者字符串序列</span></span><br><span class="line"><span class="string">autopct：它可以为一个字符串，可以指定每个饼的数值标签，但是该字符串是 fmt%pct，</span></span><br><span class="line"><span class="string">         通过pct参数格式化，pct为饼的比重（自动提供）。也可以是一个可调用对象。</span></span><br><span class="line"><span class="string">pctdistance：若autopct为None，则忽略之。否则就是数值标签的径向距离，它是个相对距离，相对于半径。</span></span><br><span class="line"><span class="string">labeldistance：控制了饼的字符串标签的径向距离，它是个相对距离，相对于半径。</span></span><br><span class="line"><span class="string">shadow：一个布尔值，如果为True，则绘制带阴影的饼状图</span></span><br><span class="line"><span class="string">startangle：如果不是None，则它可控制了第一块饼与x轴的夹角</span></span><br><span class="line"><span class="string">radius：一个标量，控制了饼状图的半径。如果为None，则默认为 1</span></span><br><span class="line"><span class="string">counterclock：一个布尔值。如果为True，则为逆时针方向；否则为顺时针排列</span></span><br><span class="line"><span class="string">wedgeprops：一个字典，控制了每一块饼的某些属性，如线型</span></span><br><span class="line"><span class="string">textprops：一个字典，控制了饼的文字的一些属性</span></span><br><span class="line"><span class="string">center：一个二元的元组，指定了饼状图的中心</span></span><br><span class="line"><span class="string">frame：一个布尔值，控制是否绘制axes frame（也就是背后的数轴）。发现版本1.5.3中，开启它是个Bug，图形混乱。</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">为了显示好看，建议使用ax.set_aspect(1)将Axes的长宽比设置为 1， 此时的饼状图是个圆形（否则为椭圆）。</span></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line">plot(*args, **kwargs)：绘制line或者marker。他返回line的列表。</span><br><span class="line">    plot(x,y)：最简单的用法，其中x为数据点的横坐标，y为数据点的纵坐标。</span><br><span class="line">               此时采用默认的线型和颜色。如果x/y为二维数组，那么每一行作为一组line来绘制。</span><br><span class="line">    plot(x,y,<span class="string">&#x27;bo&#x27;</span>)：可设置线型和颜色。<span class="string">&#x27;b&#x27;</span>代表颜色为蓝色，<span class="string">&#x27;o&#x27;</span>代表使用小圆圈标记数据点。<span class="string">&#x27;bo&#x27;</span>称作plot <span class="built_in">format</span> string</span><br><span class="line">    plot(y)：可省略x。此时隐含着x等于[<span class="number">0</span>,<span class="number">1</span>,...<span class="built_in">len</span>(y-<span class="number">1</span>)]</span><br><span class="line">    plot(x1,y1,<span class="string">&#x27;b+&#x27;</span>,x2,y2,<span class="string">&#x27;b-&#x27;</span>,x3,y3,<span class="string">&#x27;bo&#x27;</span>)：可一次绘制多条线</span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">linestyle:&#x27;-&#x27;或者&#x27;solid&#x27;：表示实线</span></span><br><span class="line"><span class="string">          &#x27;--&#x27;或者dashed：表示虚线</span></span><br><span class="line"><span class="string">          &#x27;-.&#x27;或者dash_dot：表示点划线</span></span><br><span class="line"><span class="string">          &#x27;:&#x27;或者&#x27;dotted&#x27;：表示点线</span></span><br><span class="line"><span class="string">marker：&#x27;.&#x27;/&#x27;,&#x27;/&#x27;o&#x27;/&#x27;v&#x27;/&#x27;^&#x27;/&#x27;&lt;&#x27;/&#x27;&gt;&#x27;/&#x27;1&#x27;/&#x27;2&#x27;/&#x27;3&#x27;/&#x27;4&#x27;/</span></span><br><span class="line"><span class="string">        &#x27;s&#x27;/&#x27;p&#x27;/&#x27;*&#x27;/&#x27;h&#x27;/&#x27;H&#x27;/&#x27;+&#x27;/&#x27;x&#x27;/&#x27;D&#x27;/&#x27;d&#x27;/&#x27;|&#x27;/&#x27;_&#x27;</span></span><br><span class="line"><span class="string">color：&#x27;b&#x27;/&#x27;g&#x27;/&#x27;r&#x27;/&#x27;c&#x27;/&#x27;m&#x27;/&#x27;y&#x27;/&#x27;k&#x27;/&#x27;w&#x27;；</span></span><br><span class="line"><span class="string">        全名：&#x27;red&#x27;；</span></span><br><span class="line"><span class="string">        十六进制字符串：&#x27;#00ff00；</span></span><br><span class="line"><span class="string">        一个RGB/RGBA元组：(0,1,0)/(0,1,0,1)。</span></span><br><span class="line"><span class="string">默认情况下，不同的线采用不同的线型，它由rc的axes.prop_cycle参数控制，并且是循环使用。</span></span><br><span class="line"><span class="string">如果一个plot绘制了多条线，则其参数对所有的线起作用。这些关键字全部用于设定Line2D的属性。</span></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line">plot_date(x, y, fmt=<span class="string">&#x27;o&#x27;</span>, tz=<span class="literal">None</span>, xdate=<span class="literal">True</span>, ydate=<span class="literal">False</span>, **kwargs)：绘制日期相关的数据。</span><br><span class="line">它类似于plot()方法，但是plot_data的x轴或者y轴可能是日期相关的数据。</span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">x/y：待绘制的点的坐标序列。如果是日期序列，则代表了从0001-01-01 UTC以来的天数（浮点数）（它映射到整数1）。</span></span><br><span class="line"><span class="string">     日期必须大于等于 0（1代表第一天），且日期跨度大于一个月（31天）</span></span><br><span class="line"><span class="string">fmt：plot format string，如bo</span></span><br><span class="line"><span class="string">tz：指定时区。可以为时区字符串，也可以为tzinfo实例或者None</span></span><br><span class="line"><span class="string">xdate：一个布尔值。如果为True，则x轴为时间序列</span></span><br><span class="line"><span class="string">ydate：一个布尔值。如果为True，则y轴为时间序列</span></span><br><span class="line"><span class="string">其他参数用于设定Line2D的属性</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">注意：plot_date()使用默认的dates.AutoDateLocator/dates.AutoDateFormatter。</span></span><br><span class="line"><span class="string">     如果你希望使用自定义的，则你需要在调用plot_date()之后调用方法来设置date ticker/date formatter</span></span><br><span class="line"><span class="string">设置时区：</span></span><br><span class="line"><span class="string">    from datetime import timezone,timedelta</span></span><br><span class="line"><span class="string">    ax.plot_date(X,Y,tz=timezone(+timedelta(hours=23)))   </span></span><br><span class="line"><span class="string">设置日期格式化和位置：</span></span><br><span class="line"><span class="string">    from matplotlib.dates import AutoDateLocator,AutoDateFormatter,DateFormatter</span></span><br><span class="line"><span class="string">    autoloc = AutoDateLocator() #默认的 formatter</span></span><br><span class="line"><span class="string">    autofmt = AutoDateFormatter() #默认的 locator</span></span><br><span class="line"><span class="string">    myfmt = DateFormatter(&#x27;%Y-%m-%d %H:%M:%S&#x27;)#自定义的formatter,使用`strftime()`的格式化方式</span></span><br><span class="line"><span class="string">    ax.xaxis.set_major_locator(autodates)       #设置时间间隔</span></span><br><span class="line"><span class="string">    ax.xaxis.set_major_formatter(myfmt)      #设置时间显示格式</span></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line">scatter(x, y, s=<span class="number">20</span>, c=<span class="literal">None</span>, marker=<span class="string">&#x27;o&#x27;</span>, cmap=<span class="literal">None</span>, norm=<span class="literal">None</span>, vmin=<span class="literal">None</span>, vmax=<span class="literal">None</span>, </span><br><span class="line">        alpha=<span class="literal">None</span>, linewidths=<span class="literal">None</span>, verts=<span class="literal">None</span>, edgecolors=<span class="literal">None</span>, **kwargs)：</span><br><span class="line">        绘制散点图。返回一个PathCollection实例。</span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">x/y：数据的x坐标和y坐标，要求它们形状为(n,)</span></span><br><span class="line"><span class="string">s:指定散点的尺寸，可以为标量，也可以为一个长度为n的序列（序列配合c和cmap使用，c也必须为序列）</span></span><br><span class="line"><span class="string">c：指定散点的颜色字符。可以为一个颜色，或者颜色序列（序列配合cmap使用）</span></span><br><span class="line"><span class="string">marker：指定散点的类型，默认为&#x27;o&#x27;。可以为：</span></span><br><span class="line"><span class="string">        &#x27;.&#x27;,&#x27;,&#x27;,&#x27;o&#x27;,&#x27;v&#x27;,&#x27;^&#x27;,&#x27;&lt;&#x27;,&#x27;&gt;&#x27;,&#x27;1&#x27;,&#x27;2&#x27;,&#x27;3&#x27;,&#x27;4&#x27;,&#x27;s&#x27;,&#x27;p&#x27;,</span></span><br><span class="line"><span class="string">       &#x27;*&#x27;,&#x27;h&#x27;,&#x27;H&#x27;,&#x27;+&#x27;,&#x27;x&#x27;,&#x27;D&#x27;,&#x27;d&#x27;,&#x27;|&#x27;,&#x27;_&#x27;,&#x27;None&#x27;,None,&#x27; &#x27;,&#x27;&#x27;,&#x27;$...$&#x27;之一。</span></span><br><span class="line"><span class="string">       也可以为一个Path实例。也可以是一个元组(numsided,style,angle)：</span></span><br><span class="line"><span class="string">            numsided指定了边的数量</span></span><br><span class="line"><span class="string">            style：可以为0(正多边形）；1（星星状的符号）；2（一个*）;3（一个圆，此时numsided,angle被忽略）</span></span><br><span class="line"><span class="string">            angle：指定了散点旋转的角度（按照角度制而不是弧度制）</span></span><br><span class="line"><span class="string">cmap：设定一个colormap。可以是Colormap实例，或者它的名字。只有当c参数为一列浮点数时有效！</span></span><br><span class="line"><span class="string">norm：一个Normalize实例，用于将亮度调整到0~1</span></span><br><span class="line"><span class="string">vmin,vmax：一个标量，用于辅助默认的norm调整亮度（如果你传入了一个Normalize实例给norm，则该参数忽略）</span></span><br><span class="line"><span class="string">alpha：一个标量，设置透明度</span></span><br><span class="line"><span class="string">linewidths：一个标量或者序列，设置线宽</span></span><br><span class="line"><span class="string">edgecolors：设定边线的颜色，可以为一个颜色，或者颜色序列</span></span><br><span class="line"><span class="string">其他参数用于设定Collection参数</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">我的经验是，数据密集的图形，使用plot绘制散点图效率会更高。</span></span><br><span class="line"><span class="string">因为plot的配置适用于所有点，而scatter对每个点都要渲染一遍。</span></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line">xcorr(x, y, normed=<span class="literal">True</span>, detrend=&lt;function detrend_none&gt;, </span><br><span class="line">     usevlines=<span class="literal">True</span>, maxlags=<span class="number">10</span>, **kwargs)：绘制互相关图。参数解释参考acorr()自相关函数。</span><br></pre></td></tr></table></figure></p>
<h2 id="axis">Axis</h2>
<p>matplotlib.axis.Axis实例处理tick line、grid line、tick label以及axis
label的绘制，它包括坐标轴上的刻度线、刻度label、坐标网格、坐标轴标题。<br />
通常你可以独立的配置y轴的左边刻度以及右边的刻度，也可以独立地配置x轴的上边刻度以及下边的刻度。刻度包括主刻度和次刻度，它们都是Tick刻度对象。</p>
<p>Axis也存储了数据用于内部的缩放以及自适应处理。它还有Locator实例和Formatter实例用于控制刻度线的位置以及刻度label。</p>
<p>每个Axis都有一个.label属性，也有主刻度列表和次刻度列表。这些tick是XTick和YTick的实例，他们存放着实际的line
primitive以及text primitive来渲染刻度线以及刻度文本。</p>
<p>Axis也提供了一些辅助方法来获取刻度文本、刻度线位置等方法，更多方法请参考<span class="exturl" data-url="aHR0cHM6Ly9tYXRwbG90bGliLm9yZy9zdGFibGUvYXBpL2F4aXNfYXBpLmh0bWw/aGlnaGxpZ2h0PXhheGlzI21hdHBsb3RsaWIuYXhpcy5YQXhpcw==">axis<i class="fa fa-external-link-alt"></i></span>：<br />
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line">Axis.get_major_ticks()：获取主刻度列表(一个Tick对象的列表)</span><br><span class="line"></span><br><span class="line">Axis.get_minor_ticks()：获取次刻度列表(一个Tick对象的列表)</span><br><span class="line"></span><br><span class="line">Axis.get_majorticklabels()：获取主刻度label列表(一个Text对象的列表)</span><br><span class="line"></span><br><span class="line">Axis.get_majorticklines():获取主刻度线(一个Line2D对象的列表)</span><br><span class="line"></span><br><span class="line">Axis.get_ticklocs()：获取刻度线位置的列表。可通过minor=<span class="literal">True</span>|<span class="literal">False</span>控制输出minor还是major的tick location。</span><br><span class="line"></span><br><span class="line">Axis.get_ticklabels()：获取刻度label列表(一个Text实例的列表）。可通过minor=<span class="literal">True</span>|<span class="literal">False</span>控制输出minor还是major的tick label。</span><br><span class="line"></span><br><span class="line">Axis.get_ticklines()：获取刻度线列表(一个Line2D实例的列表）。可通过minor=<span class="literal">True</span>|<span class="literal">False</span>控制输出minor还是major的tick line。</span><br><span class="line"></span><br><span class="line">Axis.get_scale()：获取坐标轴的缩放属性，如<span class="string">&#x27;log&#x27;</span>或者<span class="string">&#x27;linear&#x27;</span></span><br><span class="line"></span><br><span class="line">Axis.get_view_interval():获取内部的axis view limits实例</span><br><span class="line"></span><br><span class="line">Axis.get_data_interval():获取内部的axis data limits实例</span><br><span class="line"></span><br><span class="line">Axis.get_gridlines():获取grid line的列表</span><br><span class="line"></span><br><span class="line">Axis.get_label():获取axis label(一个Text实例)</span><br><span class="line"></span><br><span class="line">Axis.get_label_text():获取axis label的字符串</span><br><span class="line"></span><br><span class="line">Axis.get_major_locator():获取major tick locator(一个matplotlib.ticker.Locator实例)</span><br><span class="line"></span><br><span class="line">Axis.get_minor_locator():获取minor tick locator(一个matplotlib.ticker.Locator实例)</span><br><span class="line"></span><br><span class="line">Axis.get_major_formatter():获取major tick formatter(一个matplotlib.ticker.Formatter实例)</span><br><span class="line"></span><br><span class="line">Axis.get_minor_formatter():获取minor tick formatter(一个matplotlib.ticker.Formatter实例)</span><br><span class="line"></span><br><span class="line">Axis.grid(b=<span class="literal">None</span>,which=<span class="string">&#x27;major&#x27;</span>,**kwargs):一个开关，用于控制major或者minor的tick的on|off</span><br><span class="line"></span><br><span class="line">Axis.cla()：清除axis</span><br><span class="line">Axis.axis_date(tz=<span class="literal">None</span>)：将x轴视作时间轴。</span><br></pre></td></tr></table></figure><br />
当然，设置这些属性可通过<code>set_xxx()</code>方法，进行对应的设置。</p>
<p>获取对应实例后，可以对其做很多修改。比如获取刻度label之后，可以设置其各种属性，对刻度label旋转30度：<br />
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">for</span> line <span class="keyword">in</span> axis.get_majorticklabels():</span><br><span class="line">    line.set_rotation(<span class="number">30</span>)</span><br></pre></td></tr></table></figure></p>
<h2 id="tick">Tick</h2>
<p>matplotlib.axis.Tick类是从Figure--&gt;Axes--&gt;Tick这个container体系中最末端的container。Tick容纳了tick、grid
line以及tick对应的label。所有的这些都可以通过Tick的属性获取:<br />
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">Tick.tick1line：一个Line2D实例</span><br><span class="line">Tick.tick2line：一个Line2D实例</span><br><span class="line">Tick.gridline：一个Line2D实例</span><br><span class="line">Tick.label1：一个Text实例</span><br><span class="line">Tick.label2：一个Text实例</span><br><span class="line">Tick.gridOn：一个布尔值，决定了是否绘制tickline</span><br><span class="line">Tick.tick1On：一个布尔值，决定了是否绘制1st tickline</span><br><span class="line">Tick.tick2On：一个布尔值，决定了是否绘制2nd tickline</span><br><span class="line">Tick.label1On：一个布尔值，决定了是否绘制1st tick label</span><br><span class="line">Tick.label2On：一个布尔值，决定了是否绘制2nd tick label</span><br></pre></td></tr></table></figure><br />
y轴分为左右两个，因此<code>tick1*对应左侧的轴</code>；<code>tick2*对应右侧的轴</code>。
x轴分为上下两个，因此<code>tick1*对应下侧的轴</code>；<code>tick2*对应上侧的轴</code>。</p>
<p>Tick 方法：<br />
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">get_loc()：以标量的形式返回Tick的坐标</span><br><span class="line">get_pad()：返回Tick的label和刻度线之间的距离（单位为像素点）</span><br><span class="line">set_label(s)/set_label1(s)/set_label2(s)：设置label</span><br><span class="line">set_pad(val)：设置Tick的label和刻度线之间的距离（单位为像素点）</span><br></pre></td></tr></table></figure></p>
<h2 id="primitive">primitive</h2>
<h3 id="line2d">Line2D</h3>
<p>matplotlib.lines.Line2D类是matplotlib中的曲线类（基类是matplotlib.artist.Artist），它可以有各种各样的颜色、类型、以及标注<br />
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br></pre></td><td class="code"><pre><span class="line">Line2D(xdata, ydata, linewidth=<span class="literal">None</span>, linestyle=<span class="literal">None</span>,</span><br><span class="line">  color=<span class="literal">None</span>, marker=<span class="literal">None</span>, markersize=<span class="literal">None</span>, markeredgewidth</span><br><span class="line">  =<span class="literal">None</span>, markeredgecolor=<span class="literal">None</span>, markerfacecolor</span><br><span class="line">  =<span class="literal">None</span>, markerfacecoloralt=’none’, fillstyle=<span class="literal">None</span>,</span><br><span class="line">  antialiased=<span class="literal">None</span>, dash_capstyle=<span class="literal">None</span>, solid_capstyle=<span class="literal">None</span>,</span><br><span class="line">  dash_joinstyle=<span class="literal">None</span>, solid_joinstyle=<span class="literal">None</span>, pickradius=<span class="number">5</span>,</span><br><span class="line">  drawstyle=<span class="literal">None</span>, markevery=<span class="literal">None</span>, **kwargs)</span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">这些关键字参数都是Line2D的属性。其属性有：</span></span><br><span class="line"><span class="string">    继承自Artist基类的属性：.alpha、.animated、.axes、.clip_box、</span></span><br><span class="line"><span class="string">        .clip_on、.clip_path、.contains、 .figure、.gid、.label、</span></span><br><span class="line"><span class="string">        .picker、.transform、.url、.visible、.zorder</span></span><br><span class="line"><span class="string">    .antialiased/.aa：一个布尔值。如果为True则表示线条是抗锯齿处理的</span></span><br><span class="line"><span class="string">    .color/.c：一个matplotlib color值，表示线条的颜色，</span></span><br><span class="line"><span class="string">    .dash_capstyle：为&#x27;butt&#x27; or &#x27;round&#x27; or &#x27;projecting&#x27;，表示虚线头端类型</span></span><br><span class="line"><span class="string">    .dash_joinstyle：为&#x27;miter&#x27; or &#x27;round&#x27; or &#x27;bevel&#x27;，表示虚线连接处类型</span></span><br><span class="line"><span class="string">    .dashes：一个数值序列，表示虚线的实部、虚部的尺寸。如果为(None,None)则虚线成为实线</span></span><br><span class="line"><span class="string">    .drawstyle：为&#x27;default&#x27;or&#x27;steps&#x27;or&#x27;step-pre&#x27;or&#x27;step-mid&#x27;or&#x27;step-post&#x27;，表示曲线类型。</span></span><br><span class="line"><span class="string">                &#x27;default&#x27;：点之间以直线连接</span></span><br><span class="line"><span class="string">                &#x27;steps*&#x27;：绘制阶梯图。其中steps等价于steps-pre，是为了保持兼容旧代码</span></span><br><span class="line"><span class="string">    .fillstyle：为&#x27;full&#x27;or&#x27;left&#x27;or&#x27;right&#x27;or&#x27;bottom&#x27;or&#x27;top&#x27;or&#x27;none&#x27;表示marker的填充类型。</span></span><br><span class="line"><span class="string">                &#x27;full&#x27;：填充整个marker</span></span><br><span class="line"><span class="string">                none：不填充marker</span></span><br><span class="line"><span class="string">                其他值：表示填充一半marker</span></span><br><span class="line"><span class="string">    .linestyle/.ls：指定线型，可以为以下值：</span></span><br><span class="line"><span class="string">            &#x27;-&#x27;或者&#x27;solid&#x27;：表示实线</span></span><br><span class="line"><span class="string">            &#x27;--&#x27;或者dashed：表示虚线</span></span><br><span class="line"><span class="string">            &#x27;-.&#x27;或者dash_dot：表示点划线</span></span><br><span class="line"><span class="string">            &#x27;:&#x27;或者&#x27;dotted&#x27;：表示点线</span></span><br><span class="line"><span class="string">            &#x27;None&#x27;或者&#x27; &#x27;或者&#x27;&#x27;：表示没有线条（不画线）</span></span><br><span class="line"><span class="string">    .linewidth/.lw：为浮点值，表示线条宽度</span></span><br><span class="line"><span class="string">    .marker：可以为一系列的字符串，如&#x27;.&#x27;、&#x27;,&#x27;、&#x27;o&#x27;....,表示线条的marker</span></span><br><span class="line"><span class="string">    .markeredgecolor/.mec:可以为matplotlib color，表示marker的边的颜色</span></span><br><span class="line"><span class="string">    .markeredgewidth/.mew:可以为浮点数，表示marker边的宽度</span></span><br><span class="line"><span class="string">    .markerfacecolor/.mfc：可以为matplotlib color，表示marker的前景色</span></span><br><span class="line"><span class="string">    .markerfacecoloralt/.mfcalt：可以为matplotlib color，表示marker的可选前景色</span></span><br><span class="line"><span class="string">    .markersize/.ms：可以为浮点数，表示marker的大小</span></span><br><span class="line"><span class="string">    .markevery：指定每隔多少个点绘制一个marker，可以为以下值，其他值参考文档：</span></span><br><span class="line"><span class="string">            None：表示每个点都绘制marker</span></span><br><span class="line"><span class="string">            N：表示每隔N个点绘制marker，从0开始</span></span><br><span class="line"><span class="string">            (start,N)：表示每隔N个点绘制marker，从start开始</span></span><br><span class="line"><span class="string">            [i,j,m,n]：只有点i,j,m,n的marker绘制</span></span><br><span class="line"><span class="string">    .pickradius：浮点值，表示pick radius</span></span><br><span class="line"><span class="string">    .solid_capstyle：可以为&#x27;butt&#x27;、&#x27;round&#x27;、&#x27;projecting&#x27;，表示实线的头端类型</span></span><br><span class="line"><span class="string">    .sold_joinstyle：可以为&#x27;miter&#x27;、&#x27;round&#x27;、&#x27;bevel&#x27;，表示实线连接处的类型</span></span><br><span class="line"><span class="string">    .xdata：可以为一维的numpy.array，表示x轴数据</span></span><br><span class="line"><span class="string">    .ydata：可以为一维的numpy.array，表示y轴数据</span></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br></pre></td></tr></table></figure></p>
<h3 id="text">Text</h3>
<p>matplotlib.text.Text类是绘制文字的类（基类是matplotlib.artist.Artist）。它的构造函数为：<br />
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br></pre></td><td class="code"><pre><span class="line">Text(x=<span class="number">0</span>, y=<span class="number">0</span>, text=<span class="string">&#x27;&#x27;</span>, color=<span class="literal">None</span>, verticalalignment=<span class="string">&#x27;baseline&#x27;</span>,</span><br><span class="line">  horizontalalignment=’left’, multialignment=<span class="literal">None</span>, fontproperties</span><br><span class="line">  =<span class="literal">None</span>, rotation=<span class="literal">None</span>, linespacing=<span class="literal">None</span>, rotation_</span><br><span class="line">  mode=<span class="literal">None</span>, usetex=<span class="literal">None</span>, wrap=<span class="literal">False</span>, **kwargs)</span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">这些关键字参数也是属性。其属性有：</span></span><br><span class="line"><span class="string">    继承自Artist基类的属性： .alpha、.animated、.axes、.clip_box、</span></span><br><span class="line"><span class="string">        .clip_on、.clip_path、.contains、.figure、.gid、</span></span><br><span class="line"><span class="string">        .label、.picker、.transform、.url、.visible、.zorder</span></span><br><span class="line"><span class="string">    .backgroundcolor：背景色，可以为任何matplotlib color</span></span><br><span class="line"><span class="string">    .bbox：文本框的边框。其值是FancyBboxPatch类的属性字典。</span></span><br><span class="line"><span class="string">    .color：字体颜色，可以为任何matplotlib color</span></span><br><span class="line"><span class="string">    .family/.name/.fontfamily/.fontname：字体的名字。</span></span><br><span class="line"><span class="string">        可以是string或者string list（表示可以为若干个名字，优先级依次递减）。</span></span><br><span class="line"><span class="string">        string必须是一个真实字体的名字，或者一个字体的class name。</span></span><br><span class="line"><span class="string">    .fontproperties/.font_properties：字体的属性。</span></span><br><span class="line"><span class="string">        值是一个matplotlib.font_manager.FontProperties实例，该实例一次性设置字体的很多属性：</span></span><br><span class="line"><span class="string">            比如字体类型、字体名字、字体大小、宽度等等。</span></span><br><span class="line"><span class="string">    .horizontalalignment/.ha：水平对齐方式，可以为&#x27;center&#x27;、&#x27;right&#x27;、&#x27;left&#x27;</span></span><br><span class="line"><span class="string">    .linespacing：为浮点数，单位为font size，表示行间距</span></span><br><span class="line"><span class="string">    .multialignment：multiline text对齐方式，可以为&#x27;left&#x27;、&#x27;right&#x27;、&#x27;center&#x27;</span></span><br><span class="line"><span class="string">    .position：为一个元组(x,y)，表示文本框的位置</span></span><br><span class="line"><span class="string">    .rotation：字体旋转角度。可以为下列值：</span></span><br><span class="line"><span class="string">        浮点数，表示角度</span></span><br><span class="line"><span class="string">        &#x27;vertical&#x27;、&#x27;horizontal&#x27;</span></span><br><span class="line"><span class="string">    .rotation_mode：旋转模式。可以为下列值：</span></span><br><span class="line"><span class="string">        &#x27;anchor&#x27;：文本首先对齐，然后根据对齐点来旋转</span></span><br><span class="line"><span class="string">        None：文本先旋转，再对齐</span></span><br><span class="line"><span class="string">    .size或者.fontsize：字体大小。可以为下列值：</span></span><br><span class="line"><span class="string">        浮点值，表示字体大小</span></span><br><span class="line"><span class="string">        &#x27;xx-small&#x27;、&#x27;x-small&#x27;、&#x27;small&#x27;、&#x27;medium&#x27;、&#x27;large&#x27;、&#x27;x-large&#x27;、&#x27;xx-large&#x27;</span></span><br><span class="line"><span class="string">    .stretch/.fontstretch：字体沿水平方向的拉伸。可以为下列值：</span></span><br><span class="line"><span class="string">        整数，在[0---1000]之间</span></span><br><span class="line"><span class="string">        &#x27;ultra-condensed&#x27;、&#x27;extra-condensed&#x27;、&#x27;condensed&#x27;、&#x27;semi-condensed&#x27;、</span></span><br><span class="line"><span class="string">        &#x27;normal&#x27;、&#x27;semi-expanded&#x27;、&#x27;expanded&#x27;、&#x27;extra-expanded&#x27;、&#x27;ultra-expanded&#x27;</span></span><br><span class="line"><span class="string">    .style/.fontstyle：字体样式，可以为&#x27;normal&#x27;、&#x27;italic&#x27;、&#x27;oblique&#x27;</span></span><br><span class="line"><span class="string">    .text:文本字符串，可以为任意字符串（他可以包含&#x27;\n&#x27;换行符或者LATEX语法）</span></span><br><span class="line"><span class="string">    .variant/.fontvariant：表示字体形变，可以为下列值：&#x27;normal&#x27;、&#x27;small-caps&#x27;</span></span><br><span class="line"><span class="string">    .verticalalignment/.ma/.va：表示文本的垂直对齐，可以为&#x27;center&#x27;、&#x27;top&#x27;、&#x27;bottom&#x27;、&#x27;baseline&#x27;</span></span><br><span class="line"><span class="string">    .weight/.fontweight：设置字体的weight，可以为下列值：</span></span><br><span class="line"><span class="string">        一个整数值，在[0---1000]之间</span></span><br><span class="line"><span class="string">        &#x27;ultralight&#x27;、&#x27;light&#x27;、&#x27;normal&#x27;、&#x27;regular&#x27;、&#x27;book&#x27;、&#x27;medium&#x27;、</span></span><br><span class="line"><span class="string">        &#x27;roman&#x27;、&#x27;semibold&#x27;、&#x27;demibold&#x27;、&#x27;demi&#x27;、&#x27;bold&#x27;、&#x27;heavy&#x27;、</span></span><br><span class="line"><span class="string">        &#x27;extrabold&#x27;、&#x27;black&#x27;</span></span><br><span class="line"><span class="string">    .x：一个浮点值，表示文本框位置的x值</span></span><br><span class="line"><span class="string">    .y：一个浮点值，表示文本框位置的y值</span></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br></pre></td></tr></table></figure><br />
可以通过<code>ax.text(*args,**kwargs)</code>设置文字，参数就是Text的属性。</p>
<h3 id="annotation">Annotation</h3>
<p>matplotlib.text.Annotation类是图表中的图式，它是一个带箭头的文本框，用于解说图表中的图形。它的基类是matplotlib.text.Text和matplotlib.text._AnnotationBase。其构造函数为：<br />
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line">Annotation(s, xy, xytext=<span class="literal">None</span>, xycoords=’data’, textcoords=<span class="literal">None</span>, arrowprops</span><br><span class="line">  =<span class="literal">None</span>, annotation_clip=<span class="literal">None</span>, **kwargs)</span><br><span class="line"><span class="comment"># 在位置xytext处放置一个文本框，该文本框用于解释点xy，文本框的文本为s。</span></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">s：文本框的文本字符串</span></span><br><span class="line"><span class="string">xy：被解释的点的坐标</span></span><br><span class="line"><span class="string">xytext：文本框放置的位置。如果为None，则默认取xy</span></span><br><span class="line"><span class="string">xycoords：xy坐标系，默认取&#x27;data&#x27;坐标系（即xy是数据坐标系中的点）。可以为以下值：</span></span><br><span class="line"><span class="string">    &#x27;figure points&#x27;：从figure左下角开始的点</span></span><br><span class="line"><span class="string">    &#x27;figure pixesl&#x27;：从figure左下角开始的像素值</span></span><br><span class="line"><span class="string">    &#x27;figure fraction&#x27;：(0,0)代表figure的左下角，(1,1)代表figure的右上角</span></span><br><span class="line"><span class="string">    &#x27;axes points&#x27;：从axes左下角开始的点</span></span><br><span class="line"><span class="string">    &#x27;axes pixels&#x27;：从axes左下角开始的像素</span></span><br><span class="line"><span class="string">    &#x27;axes fraction&#x27;：(0,0)代表axes的左下角，(1,1)代表axes的右上角</span></span><br><span class="line"><span class="string">    &#x27;data&#x27;：使用被标注对象的坐标系</span></span><br><span class="line"><span class="string">    &#x27;offset points&#x27;：指定从xy的偏移点</span></span><br><span class="line"><span class="string">    &#x27;polar&#x27;：极坐标系</span></span><br><span class="line"><span class="string">textcoords：文本框坐标系（即xytext是文本坐标系中的点），默认等于xycoords</span></span><br><span class="line"><span class="string">arrowprops：指定文本框和被解释的点之间的箭头。如果不是None，则是一个字典，该字典设定了matplotlib.lines.Line2D的属性。</span></span><br><span class="line"><span class="string">            如果该字典有一个arrowstyle属性，则该键的值也是一个字典，创建一个FancyArrowsPatch实例，实例属性由该字典指定。</span></span><br><span class="line"><span class="string">            如果该字典没有arrowstyle属性，则创建一个YAArrow实例，</span></span><br><span class="line"><span class="string">annotation_clip：控制超出axes区域的annotation的显示。如果为True则annotation 只显示位于axes区域内的内容。</span></span><br><span class="line"><span class="string">额外的关键字参数全部是设置Text的属性</span></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br></pre></td></tr></table></figure></p>
<h3 id="legend">Legend</h3>
<p>matplotlib.legend.Legend是图例类，它的基类是matplotlib.artist.Artist。其构造函数为：<br />
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br></pre></td><td class="code"><pre><span class="line">Legend(parent, handles, labels, loc=<span class="literal">None</span>, numpoints=<span class="literal">None</span>, markerscale</span><br><span class="line">  =<span class="literal">None</span>, markerfirst=<span class="literal">True</span>, scatterpoints=<span class="literal">None</span>,</span><br><span class="line">  scatteryoffsets=<span class="literal">None</span>, prop=<span class="literal">None</span>, fontsize=<span class="literal">None</span>, borderpad</span><br><span class="line">  =<span class="literal">None</span>, labelspacing=<span class="literal">None</span>, handlelength=<span class="literal">None</span>,</span><br><span class="line">  handleheight=<span class="literal">None</span>, handletextpad=<span class="literal">None</span>, borderaxespad</span><br><span class="line">  =<span class="literal">None</span>, columnspacing=<span class="literal">None</span>, ncol=<span class="number">1</span>, mode=<span class="literal">None</span>,</span><br><span class="line">  fancybox=<span class="literal">None</span>, shadow=<span class="literal">None</span>, title=<span class="literal">None</span>, framealpha</span><br><span class="line">  =<span class="literal">None</span>, bbox_to_anchor=<span class="literal">None</span>, bbox_transform=<span class="literal">None</span>,</span><br><span class="line">  frameon=<span class="literal">None</span>, handler_map=<span class="literal">None</span>)</span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">parent：持有该legend的artist</span></span><br><span class="line"><span class="string">loc:图例的位置。其值可以为字符串或者数字：</span></span><br><span class="line"><span class="string">    best或0：自动计算</span></span><br><span class="line"><span class="string">    upper right或1： 右上角</span></span><br><span class="line"><span class="string">    upper left或2：上角</span></span><br><span class="line"><span class="string">    lower left或3：下角</span></span><br><span class="line"><span class="string">    lower right或4：右下角</span></span><br><span class="line"><span class="string">    right或5：右边</span></span><br><span class="line"><span class="string">    center left或6：中间偏左</span></span><br><span class="line"><span class="string">    center right或7：中间偏右</span></span><br><span class="line"><span class="string">    lower center或8：中间底部</span></span><br><span class="line"><span class="string">    upper center或9：中间顶部</span></span><br><span class="line"><span class="string">    center或10：正中央</span></span><br><span class="line"><span class="string">handle：一个artist列表，添加这些artist到legend中</span></span><br><span class="line"><span class="string">lebels：一个字符串列表添加到legend中</span></span><br><span class="line"><span class="string">prop:字体属性</span></span><br><span class="line"><span class="string">fontsize: 字体大小（只有prop未设置时有效）</span></span><br><span class="line"><span class="string">markerscale: marker的缩放比例（相对于原始大小）</span></span><br><span class="line"><span class="string">markerfirst: 如果为True，则marker放在label左侧；否则marker放在label右侧</span></span><br><span class="line"><span class="string">numpoints: the number of points in the legend for line</span></span><br><span class="line"><span class="string">scatterpoints: the number of points in the legend for scatter plot</span></span><br><span class="line"><span class="string">scatteryoffsets: a list of offsets for scatter symbols in legend</span></span><br><span class="line"><span class="string">frameon: if True, draw a frame around the legend. If None, use rc</span></span><br><span class="line"><span class="string">fancybox: if True, draw a frame with a round fancybox. If None, use rc</span></span><br><span class="line"><span class="string">shadow: if True, draw a shadow behind legend</span></span><br><span class="line"><span class="string">framealpha: If not None, alpha channel for the frame.</span></span><br><span class="line"><span class="string">ncol: number of columns</span></span><br><span class="line"><span class="string">borderpad: the fractional whitespace inside the legend border</span></span><br><span class="line"><span class="string">labelspacing: the vertical space between the legend entries</span></span><br><span class="line"><span class="string">handlelength: the length of the legend handles</span></span><br><span class="line"><span class="string">handleheight: the height of the legend handles</span></span><br><span class="line"><span class="string">handletextpad: the pad between the legend handle and text</span></span><br><span class="line"><span class="string">borderaxespad: the pad between the axes and legend border</span></span><br><span class="line"><span class="string">columnspacing:the spacing between columns</span></span><br><span class="line"><span class="string">title: 图例的标题</span></span><br><span class="line"><span class="string">bbox_to_anchor: the bbox that the legend will be anchored.</span></span><br><span class="line"><span class="string">bbox_transform: the transform for the bbox. transAxes if Noneloc a location code</span></span><br><span class="line"><span class="string">其他关键字参数用于设置属性</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">继承自Artist基类的属性：</span></span><br><span class="line"><span class="string">.alpha、.animated、.axes、.clip_box、..clip_on、.clip_path、.contains、</span></span><br><span class="line"><span class="string">.figure、.gid、.label、.picker、.transform、.url、.visible、.zorder</span></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br></pre></td></tr></table></figure></p>
<h3 id="patch">Patch</h3>
<p>matplotlib.patches.Patch类是二维图形类。它的基类是matplotlib.artist.Artist。其构造函数为：<br />
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br></pre></td><td class="code"><pre><span class="line"> Patch(edgecolor=<span class="literal">None</span>, facecolor=<span class="literal">None</span>, color=<span class="literal">None</span>,</span><br><span class="line">  linewidth=<span class="literal">None</span>, linestyle=<span class="literal">None</span>, antialiased=<span class="literal">None</span>,</span><br><span class="line">  hatch=<span class="literal">None</span>, fill=<span class="literal">True</span>, capstyle=<span class="literal">None</span>, joinstyle=<span class="literal">None</span>,</span><br><span class="line">  **kwargs)</span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">edgecolor：可以为matplotlib color，表示边线条的颜色，若为none则表示无颜色</span></span><br><span class="line"><span class="string">facecolor：可以为matplotlib color，表示前景色，若为none则表示无颜色</span></span><br><span class="line"><span class="string">color可以为matplotlib color，表示边线条和前景色的颜色。</span></span><br><span class="line"><span class="string">linewidth：为浮点数，表示线条宽度</span></span><br><span class="line"><span class="string">linestyle：指定线型，可以为以下值：</span></span><br><span class="line"><span class="string">            &#x27;-&#x27;或者&#x27;solid&#x27;：表示实线</span></span><br><span class="line"><span class="string">            &#x27;--&#x27;或者dashed：表示虚线</span></span><br><span class="line"><span class="string">            &#x27;-.&#x27;或者dash_dot：表示点划线</span></span><br><span class="line"><span class="string">            &#x27;:&#x27;或者&#x27;dotted&#x27;：表示点线</span></span><br><span class="line"><span class="string">            &#x27;None&#x27;或者&#x27; &#x27;或者&#x27;&#x27;：表示没有线条（不画线）</span></span><br><span class="line"><span class="string">antialiased：一个布尔值。如果为True则表示线条是抗锯齿处理的</span></span><br><span class="line"><span class="string">hatch：设置hatching pattern，可以为下列的值：</span></span><br><span class="line"><span class="string">        &#x27;\&#x27;、&#x27;|&#x27;、&#x27;-&#x27;、&#x27;+&#x27;、&#x27;x&#x27;、&#x27;o&#x27;、&#x27;0&#x27;、&#x27;.&#x27;、&#x27;*&#x27;</span></span><br><span class="line"><span class="string">fill：为布尔值。如果为True则填充图形，否则不填充</span></span><br><span class="line"><span class="string">capstyle：为&#x27;butt&#x27; or &#x27;round&#x27; or &#x27;projecting&#x27;，表示线条头端类型</span></span><br><span class="line"><span class="string">joinstyle：可以为&#x27;miter&#x27;、&#x27;round&#x27;、&#x27;bevel&#x27;，表示矩形线条接头类型</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">其他关键字参数用于设置属性。</span></span><br><span class="line"><span class="string">如果 edgecolor, facecolor, linewidth, or antialiased 为None则这些值从rc params中读取</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">属性如下：</span></span><br><span class="line"><span class="string">继承自Artist基类的属性： .alpha、.animated、.axes、.clip_box、</span></span><br><span class="line"><span class="string">                       .clip_on、.clip_path、.contains、.figure、.gid、</span></span><br><span class="line"><span class="string">                       .label、path_effects、.picker、.transform、.url、.visible、.zorder</span></span><br><span class="line"><span class="string">.antialiased/.aa：一个布尔值。如果为True则表示线条是抗锯齿处理的</span></span><br><span class="line"><span class="string">.capstyle：为&#x27;butt&#x27; or &#x27;round&#x27; or &#x27;projecting&#x27;，表示线条头端类型</span></span><br><span class="line"><span class="string">.color：可以为matplotlib color，表示边线条和前景色的颜色。</span></span><br><span class="line"><span class="string">.edgecolor/.ec：可以为matplotlib color，表示边线条的颜色，若为none则表示无颜色</span></span><br><span class="line"><span class="string">.facecolor/.fc：可以为matplotlib color，表示前景色，若为none则表示无颜色</span></span><br><span class="line"><span class="string">.fill：为布尔值。如果为True则填充图形，否则不填充</span></span><br><span class="line"><span class="string">.hatch：设置hatching pattern，可以为下列的值：</span></span><br><span class="line"><span class="string">            &#x27;\&#x27;、&#x27;|&#x27;、&#x27;-&#x27;、&#x27;+&#x27;、&#x27;x&#x27;、&#x27;o&#x27;、&#x27;0&#x27;、&#x27;.&#x27;、&#x27;*&#x27;</span></span><br><span class="line"><span class="string">.joinstyle：可以为&#x27;miter&#x27;、&#x27;round&#x27;、&#x27;bevel&#x27;，表示矩形线条接头类型</span></span><br><span class="line"><span class="string">.linestyle/.ls：指定线型，可以为以下值：</span></span><br><span class="line"><span class="string">                    &#x27;-&#x27;或者&#x27;solid&#x27;：表示实线</span></span><br><span class="line"><span class="string">                    &#x27;--&#x27;或者dashed：表示虚线</span></span><br><span class="line"><span class="string">                    &#x27;-.&#x27;或者dash_dot：表示点划线</span></span><br><span class="line"><span class="string">                    &#x27;:&#x27;或者&#x27;dotted&#x27;：表示点线</span></span><br><span class="line"><span class="string">                    &#x27;None&#x27;或者&#x27; &#x27;或者&#x27;&#x27;：表示没有线条（不画线）</span></span><br><span class="line"><span class="string">.linewidth/.lw：为浮点数，表示线条宽度</span></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br></pre></td></tr></table></figure></p>
<h3 id="rectangle">Rectangle</h3>
<p>matplotlib.patches.Rectangle类是矩形类（基类是matplotlib.patches.Patch），其构造函数为：<br />
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">Rectangle(xy,width,height,angle=<span class="number">0.0</span>,**kwargs)</span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">xy：矩形左下角坐标</span></span><br><span class="line"><span class="string">width：矩形宽度</span></span><br><span class="line"><span class="string">height：矩形高度</span></span><br><span class="line"><span class="string">其他关键字参数用于设置属性</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">其属性有：</span></span><br><span class="line"><span class="string">继承自Artist基类的属性：.alpha、.animated、.axes、.clip_box、.clip_on、.clip_path、</span></span><br><span class="line"><span class="string">                      .contains、.figure、.gid、.label、.picker、.transform、</span></span><br><span class="line"><span class="string">                      .url、.visible、.zorder</span></span><br><span class="line"><span class="string">继承自Patch基类的属性：.antialiased/.aa、.capstyle、.color、.edgecolor/.ec、</span></span><br><span class="line"><span class="string">                     .facecolor/.fc、.fill、.hatch、.joinstyle、.linestyle/.ls、.linewidth/.lw</span></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br></pre></td></tr></table></figure></p>
<h3 id="polygon">Polygon</h3>
<p>matplotlib.patches.Polygon类是多边形类。其基类是matplotlib.patches.Patch。其构造函数为：<br />
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">Polygon(xy, closed=<span class="literal">True</span>, **kwargs)</span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">xy：是一个N×2的numpy array，为多边形的顶点。</span></span><br><span class="line"><span class="string">closed：为True则指定多边形将起点和终点重合从而显式关闭多边形。</span></span><br><span class="line"><span class="string">其他关键字参数用于设置属性</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">Polygon的属性有：</span></span><br><span class="line"><span class="string">继承自Artist基类的属性：.alpha、.animated、.axes、.clip_box、</span></span><br><span class="line"><span class="string">                      .clip_on、.clip_path、.contains、.figure、</span></span><br><span class="line"><span class="string">                      .gid、.label、.picker、.transform、.url、.visible、.zorder</span></span><br><span class="line"><span class="string">继承自Patch基类的属性：.antialiased/.aa、.capstyle、.color、.edgecolor/.ec、</span></span><br><span class="line"><span class="string">                     .facecolor/.fc、.fill、.hatch、.joinstyle、.linestyle/.ls、.linewidth/.lw</span></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br></pre></td></tr></table></figure></p>
<h3 id="polycollection">PolyCollection</h3>
<p>matplotlib.collections.PolyCollection是多边形集合类，其基类是matplotlib.collections._CollectionWithSizes。它的构造函数为：<br />
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">PolyCollection(verts, sizes=<span class="literal">None</span>, closed=<span class="literal">True</span>, **kwargs)</span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">verts：一个顶点序列。每个顶点都由xy元组或者xy数组组成</span></span><br><span class="line"><span class="string">sizes：一个浮点数序列，依次指定每个顶点正方形的边长。如果序列长度小于顶点长度，则循环从序列头部再开始  挑选</span></span><br><span class="line"><span class="string">closed：如果为True，则显式封闭多边形</span></span><br><span class="line"><span class="string">edgecolors: collection的边的颜色</span></span><br><span class="line"><span class="string">其他关键字参数用于设置属性</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">属性：</span></span><br><span class="line"><span class="string">继承自Artist基类的属性：.alpha、.animated、.axes、.clip_box、.clip_on、</span></span><br><span class="line"><span class="string">                      .clip_path、.contains、.figure、.gid、.label、</span></span><br><span class="line"><span class="string">                      .picker、.transform、.url、.visible、.zorder</span></span><br><span class="line"><span class="string">.facecolors: collection的前景色</span></span><br><span class="line"><span class="string">.linewidths: collection的边线宽</span></span><br><span class="line"><span class="string">.antialiaseds: 抗锯齿属性，可以为True或者False</span></span><br><span class="line"><span class="string">.offsets: 设置collection的偏移</span></span><br><span class="line"><span class="string">.norm: 归一化对象</span></span><br><span class="line"><span class="string">.cmap: color map</span></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br></pre></td></tr></table></figure></p>
<h1 id="matplotlib实例">Matplotlib实例</h1>
<p><img src="https://i.loli.net/2021/05/22/V9JoBlqxdeHjtbD.jpg" /></p>
<h2 id="基础画图参数">基础画图、参数</h2>
<p>绘图中常用的方法：<br />
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 设置坐标轴上下限</span></span><br><span class="line"><span class="comment"># 第一种方法</span></span><br><span class="line">plt.axis([xmin,xmax,ymin,ymax])</span><br><span class="line"><span class="comment"># 第二种方法</span></span><br><span class="line">plt.xlim(left, right) <span class="comment"># x轴上线下限 </span></span><br><span class="line">plt.ylim(left, right<span class="comment"># y轴上线下限</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 设置图形标题</span></span><br><span class="line">plt.title(<span class="string">&quot;title&quot;</span>)</span><br><span class="line"><span class="comment"># 设置x轴y轴标题</span></span><br><span class="line">plt.xlabel(<span class="string">&quot;x&quot;</span>)</span><br><span class="line">plt.ylabel(<span class="string">&quot;y&quot;</span>)</span><br><span class="line"><span class="comment"># 显示图例</span></span><br><span class="line">plt.legend()</span><br></pre></td></tr></table></figure><br />
一般情况下plt方法也可以用ax调用，但有些方法名字不一样：<br />
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">plt.xlabel()   ax.set_xlabel()</span><br><span class="line">plt.ylabel()   ax.set_ylabel()</span><br><span class="line">plt.xlim()     ax.set_xlim()</span><br><span class="line">plt.ylim()     ax.set_ylim()</span><br><span class="line">plt.title()    ax.set_title()</span><br><span class="line"><span class="comment"># 一般常用ax.set()全部设置了，比如：</span></span><br><span class="line">ax.<span class="built_in">set</span>(xlim=(<span class="number">0</span>, <span class="number">10</span>), ylim=(-<span class="number">2</span>, <span class="number">2</span>), xlabel=<span class="string">&#x27;x&#x27;</span>, ylabel=<span class="string">&#x27;sin(x)&#x27;</span>, title=<span class="string">&#x27;title&#x27;</span>)</span><br></pre></td></tr></table></figure><br />
显示marker样式：<br />
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">rng = np.random.RandomState(<span class="number">0</span>)</span><br><span class="line"><span class="keyword">for</span> marker <span class="keyword">in</span> [<span class="string">&#x27;o&#x27;</span>, <span class="string">&#x27;.&#x27;</span>, <span class="string">&#x27;,&#x27;</span>, <span class="string">&#x27;x&#x27;</span>, <span class="string">&#x27;+&#x27;</span>, <span class="string">&#x27;v&#x27;</span>, <span class="string">&#x27;^&#x27;</span>, <span class="string">&#x27;&lt;&#x27;</span>, <span class="string">&#x27;&gt;&#x27;</span>, <span class="string">&#x27;s&#x27;</span>, <span class="string">&#x27;d&#x27;</span>]:</span><br><span class="line">    plt.plot(rng.rand(<span class="number">5</span>), rng.rand(<span class="number">5</span>), marker, label=<span class="string">&quot;marker=&#x27;&#123;0&#125;&#x27;&quot;</span>.<span class="built_in">format</span>(marker))</span><br><span class="line">    plt.legend(numpoints=<span class="number">1</span>)</span><br><span class="line">    plt.xlim(<span class="number">0</span>, <span class="number">1.8</span>)</span><br></pre></td></tr></table></figure></p>
<iframe src="https://nbviewer.jupyter.org/github/soundmemories/StudyNotes/blob/cc4141f7491403a41ac738dba7695d7aaeda9c07/Cheatsheets/Matplotlib_visualization.ipynb" width="1000" height="800">
</iframe>
<h2 id="d画图参数">3D画图、参数</h2>
<iframe src="https://nbviewer.jupyter.org/github/soundmemories/StudyNotes/blob/cc4141f7491403a41ac738dba7695d7aaeda9c07/Cheatsheets/Matplotlib%203D.ipynb" width="1000" height="800">
</iframe>
<h1 id="basemap可视化地理数据">Basemap可视化地理数据</h1>
<p>地理数据可视化是数据科学中一种十分常见的可视化类型。 Matplotlib
做此类可视化的主要工具是 Basemap 工具箱，它是 Matplotlib 的 mpl_toolkits
命名空间里的众多工具箱之一。坦白说， Basemap
用起来有点笨重，就算做点儿简单的可视化图也需要花费比预期更长的时间。在处理比较复杂的地图可视化任务时，更现代的解决方案可能会更适用一些，比如
leaflet 开发库或 Google Maps API。</p>
<p>Basemap是Matplotlib的第三方扩展，Matplotlib还支持很多这种第三方库，详情<span class="exturl" data-url="aHR0cHM6Ly9tYXRwbG90bGliLm9yZy9zdGFibGUvdGhpcmRwYXJ0eXBhY2thZ2VzL2luZGV4Lmh0bWwjbWFwcGluZy10b29sa2l0cw==">thirdpartypackages<i class="fa fa-external-link-alt"></i></span>。</p>
<p>Basemap安装环境（本环境是python 3.6）：<br />
（1）pyproj可以直接pip安装，手动安装要和python版本一致。<br />
（2）basemap需要手动下载安装，从<span class="exturl" data-url="aHR0cHM6Ly93d3cubGZkLnVjaS5lZHUvfmdvaGxrZS9weXRob25saWJzLw==">pythonlibs<i class="fa fa-external-link-alt"></i></span>下载basemap安装（必须和python版本一致）。<br />
（3）python2需要pil包，python3还需要安装pillwo包。<br />
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 安装pyproj</span></span><br><span class="line">!pip install pyproj</span><br><span class="line"><span class="comment"># 下载3.6版本的安装包，放在notebook目录下</span></span><br><span class="line">!pip install basemap-<span class="number">1.2</span><span class="number">.2</span>-cp36-cp36m-win_amd64.whl</span><br></pre></td></tr></table></figure><br />
显示地球投影：<br />
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">%matplotlib inline</span><br><span class="line"><span class="keyword">import</span> numpy <span class="keyword">as</span> np</span><br><span class="line"><span class="keyword">import</span> matplotlib.pyplot <span class="keyword">as</span> plt</span><br><span class="line"><span class="comment"># 导入</span></span><br><span class="line"><span class="keyword">from</span> mpl_toolkits.basemap <span class="keyword">import</span> Basemap</span><br><span class="line"></span><br><span class="line">plt.figure(figsize=(<span class="number">8</span>, <span class="number">8</span>))</span><br><span class="line">m = Basemap(projection=<span class="string">&#x27;ortho&#x27;</span>, resolution=<span class="literal">None</span>, lat_0=<span class="number">50</span>, lon_0=-<span class="number">100</span>)</span><br><span class="line">m.bluemarble(scale=<span class="number">0.5</span>)</span><br></pre></td></tr></table></figure><br />
<img src="https://i.loli.net/2021/05/25/shcfE8TC2kHNiYB.jpg"
alt="basemap地球.jpg" /></p>
<p>ETOPO 地图，显示陆地与海底的地形特征作为背景：<br />
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">fig = plt.figure(figsize=(<span class="number">8</span>, <span class="number">8</span>))</span><br><span class="line">m = Basemap(projection=<span class="string">&#x27;lcc&#x27;</span>, resolution=<span class="literal">None</span>, width=<span class="number">8E6</span>, height=<span class="number">8E6</span>, lat_0=<span class="number">30</span>, lon_0=<span class="number">100</span>)</span><br><span class="line"><span class="comment"># etopo图</span></span><br><span class="line">m.etopo(scale=<span class="number">0.5</span>, alpha=<span class="number">0.5</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 地图上的(经度, 纬度)对应图上的(x, y)坐标</span></span><br><span class="line">x, y = m(<span class="number">116.20</span>, <span class="number">39.56</span>) <span class="comment"># 北京</span></span><br><span class="line">plt.plot(x, y, <span class="string">&#x27;ok&#x27;</span>, markersize=<span class="number">5</span>)</span><br><span class="line">plt.text(x, y, <span class="string">&#x27; 北京&#x27;</span>, fontsize=<span class="number">12</span>)</span><br></pre></td></tr></table></figure><br />
<img src="https://i.loli.net/2021/05/25/UiL2A5P46DaMShs.jpg"
alt="北京.jpg" /></p>
<p>对于背景，用 <code>bluemarble()</code> 和 <code>shadedrelief()</code>
方法可以画出地球投影，用 <code>drawparallels()</code> 和
<code>drawmeridians()</code> 方法可以画出纬线与经线。<br />
Basemap
程序包中有许多实用的函数，可以画出各种地形的轮廓，如陆地、海洋、湖泊、河流、分界线等等。<br />
常用方法：<br />
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 物理边界与水体</span></span><br><span class="line">drawcoastlines()      绘制大陆海岸线</span><br><span class="line">drawlsmask()          为陆地与海洋设置填充色，从而可以在陆地或海洋投影其他图像</span><br><span class="line">drawmapboundary()     绘制地图边界，包括为海洋填充颜色</span><br><span class="line">drawrivers()          绘制河流</span><br><span class="line">fillcontinents()      用一种颜色填充大陆，用另一种颜色填充湖泊（可选）</span><br><span class="line"><span class="comment"># 政治边界</span></span><br><span class="line">drawcountries()       绘制国界线</span><br><span class="line">drawstates()          绘制美国州界线</span><br><span class="line">drawcounties()        绘制美国县界线</span><br><span class="line"><span class="comment"># 地图功能</span></span><br><span class="line">drawgreatcircle()    在两点之间绘制一个大圆</span><br><span class="line">drawparallels()      绘制纬线</span><br><span class="line">drawmeridians()      绘制经线</span><br><span class="line">drawmapscale()       在地图上绘制一个线性比例尺</span><br><span class="line"><span class="comment"># 地球影像</span></span><br><span class="line">bluemarble()         绘制 NASA 蓝色弹珠地球投影</span><br><span class="line">shadedrelief()       在地图上绘制地貌晕渲图</span><br><span class="line">etopo()              在地图上绘制地形晕渲图</span><br><span class="line">warpimage()          将用户提供的图像投影到地图上</span><br></pre></td></tr></table></figure><br />
对于数据，可以在背景上画出，常用方法：<br />
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">contour()/contourf()     绘制等高线 / 填充等高线</span><br><span class="line">imshow()                 绘制一个图像</span><br><span class="line">pcolor()/pcolormesh()    绘制带规则 / 不规则网格的伪彩图</span><br><span class="line">plot()                   绘制线条和 / 或标签</span><br><span class="line">scatter()                绘制带标签的点</span><br><span class="line">quiver()                 绘制箭头</span><br><span class="line">barbs()                  绘制风羽（wind barb）</span><br><span class="line">drawgreatcircle()        绘制大圆圈</span><br></pre></td></tr></table></figure></p>
<h1 id="seaborn可视化">Seaborn可视化</h1>
<p>Matplotlib缺点：<br />
（1）Matplotlib 的 API
比较底层。虽然可以实现复杂的统计数据可视化，但是通常都需要写大量的样板代码。<br />
（2）由于 Matplotlib 比 Pandas 早十几年，因此它并不是为 Pandas 的
DataFrame 设计的。为了实现 Pandas 的 DataFrame
数据的可视化，你必须先提取每个
Series，然后通常还需要将它们合并成适当的格式。如果有一个画图程序库可以智能地使用DataFrame的标签画图，那一定会很方便。</p>
<p>Seaborn 在 Matplotlib 的基础上开发了一套
API，为默认的图形样式和颜色设置提供了理智的选择，为常用的统计图形定义了许多简单的高级函数，并与
Pandas DataFrame 的功能有机结合。</p>
<p>Matplotlib 团队也一直在努力解决这些问题，Matplotlib
中不仅增加了<code>plt.style</code> 工具，而且与 Pandas
数据也可以无缝衔接。</p>
<p>Seanborn内置的数据集<span class="exturl" data-url="aHR0cHM6Ly9naXRodWIuY29tL213YXNrb20vc2VhYm9ybi1kYXRh">seaborn-data<i class="fa fa-external-link-alt"></i></span>。<br />
Seaborn<span class="exturl" data-url="aHR0cDovL3NlYWJvcm4ucHlkYXRhLm9yZw==">文档<i class="fa fa-external-link-alt"></i></span>、<span class="exturl" data-url="aHR0cDovL3N0YW5mb3JkLmVkdS9+bXdhc2tvbS9zb2Z0d2FyZS9zZWFib3JuL3R1dG9yaWFsLmh0bWw=">教程<i class="fa fa-external-link-alt"></i></span>和
Seaborn <span class="exturl" data-url="aHR0cDovL3N0YW5mb3JkLmVkdS9+bXdhc2tvbS9zb2Z0d2FyZS9zZWFib3JuL2V4YW1wbGVzL2luZGV4Lmh0bWw=">画廊<i class="fa fa-external-link-alt"></i></span>。</p>
<p><strong>1、频次直方图、 KDE和密度图</strong><br />
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> numpy <span class="keyword">as</span> np</span><br><span class="line"><span class="keyword">import</span> pandas <span class="keyword">as</span> pd</span><br><span class="line"><span class="keyword">import</span> seaborn <span class="keyword">as</span> sns</span><br><span class="line"><span class="keyword">import</span> matplotlib.pyplot <span class="keyword">as</span> plt </span><br><span class="line"></span><br><span class="line">data = np.random.multivariate_normal([<span class="number">0</span>, <span class="number">0</span>], [[<span class="number">5</span>, <span class="number">2</span>], [<span class="number">2</span>, <span class="number">2</span>]], size=<span class="number">2000</span>)</span><br><span class="line">data = pd.DataFrame(data, columns=[<span class="string">&#x27;x&#x27;</span>, <span class="string">&#x27;y&#x27;</span>])</span><br><span class="line"><span class="keyword">for</span> col <span class="keyword">in</span> <span class="string">&#x27;xy&#x27;</span>:</span><br><span class="line">    plt.hist(data[col], density=<span class="literal">True</span>, alpha=<span class="number">0.5</span>)</span><br></pre></td></tr></table></figure><br />
<img src="https://i.loli.net/2021/05/25/MRIcGhDvJywsx9e.jpg"
alt="直方图.jpg" /></p>
<p>还可以用 KDE 获取变量分布的平滑估计：<br />
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">for</span> col <span class="keyword">in</span> <span class="string">&#x27;xy&#x27;</span>:</span><br><span class="line">    sns.kdeplot(data[col], shade=<span class="literal">True</span>)</span><br></pre></td></tr></table></figure><br />
<img src="https://i.loli.net/2021/05/25/1VQ7XoztnxcjylU.jpg"
alt="sns_kde.jpg" /></p>
<p>用 distplot 可以让频次直方图与 KDE 结合起来：<br />
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">sns.distplot(data[<span class="string">&#x27;x&#x27;</span>])</span><br><span class="line">sns.distplot(data[<span class="string">&#x27;y&#x27;</span>])</span><br></pre></td></tr></table></figure><br />
<img src="https://i.loli.net/2021/05/25/5jaP7gXxVCnT9Uc.jpg"
alt="sns_displot.jpg" /></p>
<p>如果向 kdeplot
输入的是二维数据集，那么就可以获得一个二维数据可视化图：<br />
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sns.kdeplot(data)</span><br></pre></td></tr></table></figure><br />
<img src="https://i.loli.net/2021/05/25/nLC3rfKHoQPq5v7.jpg"
alt="sns_kde2.jpg" /></p>
<p>用 sns.jointplot
可以同时看到两个变量的联合分布与单变量的独立分布：<br />
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 白色背景</span></span><br><span class="line"><span class="keyword">with</span> sns.axes_style(<span class="string">&#x27;white&#x27;</span>):</span><br><span class="line">    sns.jointplot(<span class="string">&quot;x&quot;</span>, <span class="string">&quot;y&quot;</span>, data, kind=<span class="string">&#x27;kde&#x27;</span>)</span><br></pre></td></tr></table></figure><br />
<img src="https://i.loli.net/2021/05/25/zOb5WjnBpATCRrQ.jpg"
alt="sns_joinplot.jpg" /></p>
<p>可以向 jointplot
函数传递一些参数。例如，可以用六边形块代替频次直方图：<br />
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">with</span> sns.axes_style(<span class="string">&#x27;white&#x27;</span>):</span><br><span class="line">    sns.jointplot(<span class="string">&quot;x&quot;</span>, <span class="string">&quot;y&quot;</span>, data, kind=<span class="string">&#x27;hex&#x27;</span>)</span><br></pre></td></tr></table></figure><br />
<img src="https://i.loli.net/2021/05/25/1rJpz4dkQ7nHlRF.jpg"
alt="sns_joinplot2.jpg" /></p>
<p><strong>2、矩阵图</strong><br />
需要对多维数据集进行可视化时，最终都要使用矩阵图。<br />
如果想画出所有变量中任意两个变量之间的图形，用矩阵图探索多维数据不同维度间的相关性非常有效。</p>
<p>可视化样本中多个维度的关系非常简单，直接用 sns.pairplot 即可：<br />
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">iris = sns.load_dataset(<span class="string">&quot;iris&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 四个变量的矩阵图</span></span><br><span class="line">sns.pairplot(iris, hue=<span class="string">&#x27;species&#x27;</span>, height=<span class="number">2.5</span>)</span><br></pre></td></tr></table></figure><br />
<img src="https://i.loli.net/2021/05/25/LHb73OQBySJ9r5t.jpg"
alt="矩阵图.jpg" /></p>
<p><strong>3、分面频次直方图</strong><br />
有时观察数据最好的方法就是借助数据子集的频次直方图。 Seaborn 的
<code>FacetGrid()</code> 函数让这件事变得非常简单。</p>
<p>某个餐厅统计的服务员收取小费的数据<br />
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">tips = sns.load_dataset(<span class="string">&#x27;tips&#x27;</span>)</span><br><span class="line"></span><br><span class="line">tips[<span class="string">&#x27;tip_pct&#x27;</span>] = <span class="number">100</span> * tips[<span class="string">&#x27;tip&#x27;</span>] / tips[<span class="string">&#x27;total_bill&#x27;</span>]</span><br><span class="line"></span><br><span class="line">grid = sns.FacetGrid(tips, row=<span class="string">&quot;sex&quot;</span>, col=<span class="string">&quot;time&quot;</span>, margin_titles=<span class="literal">True</span>)</span><br><span class="line">grid.<span class="built_in">map</span>(plt.hist, <span class="string">&quot;tip_pct&quot;</span>, bins=np.linspace(<span class="number">0</span>, <span class="number">40</span>, <span class="number">15</span>))</span><br></pre></td></tr></table></figure><br />
<img src="https://i.loli.net/2021/05/25/QDKa9k8qvuAF42T.jpg"
alt="分面频次直方图.jpg" /></p>
<p><strong>4、因子图</strong><br />
因子图（factor
plot）也是对数据子集进行可视化的方法。你可以通过它观察一个参数在另一个参数间隔中的分布情况。<br />
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">with</span> sns.axes_style(style=<span class="string">&#x27;ticks&#x27;</span>):</span><br><span class="line">    <span class="comment"># 新版本重命名为catplot</span></span><br><span class="line">    g = sns.factorplot(<span class="string">&quot;day&quot;</span>, <span class="string">&quot;total_bill&quot;</span>, <span class="string">&quot;sex&quot;</span>, data=tips, kind=<span class="string">&quot;box&quot;</span>)</span><br><span class="line">    g.set_axis_labels(<span class="string">&quot;Day&quot;</span>, <span class="string">&quot;Total Bill&quot;</span>)</span><br></pre></td></tr></table></figure><br />
<img src="https://i.loli.net/2021/05/25/7STzpiKFqYl3sRa.jpg"
alt="factorplot/catplot.jpg" /></p>
<p><strong>5、联合分布</strong><br />
与前面介绍的矩阵图类似，可以用 <code>sns.jointplot()</code>
画出不同数据集的联合分布和各数据本身的分布。<br />
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">with</span> sns.axes_style(<span class="string">&#x27;white&#x27;</span>):</span><br><span class="line">    sns.jointplot(<span class="string">&quot;total_bill&quot;</span>, <span class="string">&quot;tip&quot;</span>, data=tips, kind=<span class="string">&#x27;hex&#x27;</span>)</span><br></pre></td></tr></table></figure><br />
<img src="https://i.loli.net/2021/05/25/YQHD938NtKWJLXv.jpg"
alt="联合分布图.jpg" /></p>
<p>联合分布图也可以自动进行 KDE 和回归：<br />
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sns.jointplot(<span class="string">&quot;total_bill&quot;</span>, <span class="string">&quot;tip&quot;</span>, data=tips, kind=<span class="string">&#x27;reg&#x27;</span>)</span><br></pre></td></tr></table></figure><br />
<img src="https://i.loli.net/2021/05/25/PViOUKG93k6WbeI.jpg"
alt="联合分布图回归.jpg" /></p>
<p><strong>6、条形图</strong><br />
时间序列数据可以用 <code>sns.factorplot()</code> 画出条形图。</p>
<p>行星数据来演示：<br />
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">planets = sns.load_dataset(<span class="string">&#x27;planets&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">with</span> sns.axes_style(<span class="string">&#x27;white&#x27;</span>):</span><br><span class="line">    g = sns.factorplot(<span class="string">&quot;year&quot;</span>, data=planets, aspect=<span class="number">2</span>, kind=<span class="string">&quot;count&quot;</span>, color=<span class="string">&#x27;steelblue&#x27;</span>)</span><br><span class="line">    g.set_xticklabels(step=<span class="number">5</span>)</span><br></pre></td></tr></table></figure><br />
<img src="https://i.loli.net/2021/05/25/KeauUM3LJxg8ytB.jpg"
alt="条形图.jpg" /></p>
<p>其他案例：<br />
<strong>0、Seaborn详细教程</strong><br />
<iframe src="https://nbviewer.jupyter.org/github/soundmemories/StudyNotes/blob/0a57cce6189669f35997e1ec3a371336e9f7a757/Cheatsheets/Seaborn_visualization.ipynb" width="1000" height="700"></iframe></p>
<p><strong>1、单维度与关联维度分析</strong><br />
<iframe src="https://nbviewer.jupyter.org/github/soundmemories/StudyNotes/blob/0a57cce6189669f35997e1ec3a371336e9f7a757/Cheatsheets/Seaborn_distribution.ipynb" width="1000" height="700"></iframe></p>
<p><strong>2、连续变量关联分析</strong><br />
<iframe src="https://nbviewer.jupyter.org/github/soundmemories/StudyNotes/blob/0a57cce6189669f35997e1ec3a371336e9f7a757/Cheatsheets/Seaborn_regression.ipynb" width="1000" height="700"></iframe></p>
<p><strong>3、离散变量分析</strong><br />
<iframe src="https://nbviewer.jupyter.org/github/soundmemories/StudyNotes/blob/0a57cce6189669f35997e1ec3a371336e9f7a757/Cheatsheets/Seaborn_statEstimation.ipynb" width="1000" height="700"></iframe></p>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="https://soundmemories.github.io/2020/04/25/ML/03.ML-Pandas/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avstar.png">
      <meta itemprop="name" content="SoundMemories">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="SoundMemories">
      <meta itemprop="description" content="今日事，今日毕">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | SoundMemories">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2020/04/25/ML/03.ML-Pandas/" class="post-title-link" itemprop="url">ML-Pandas</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>

      <time title="创建时间：2020-04-25 00:00:00" itemprop="dateCreated datePublished" datetime="2020-04-25T00:00:00+08:00">2020-04-25</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">分类于</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/ML/" itemprop="url" rel="index"><span itemprop="name">ML</span></a>
        </span>
    </span>

  
    <span class="post-meta-break"></span>
    <span class="post-meta-item" title="本文字数">
      <span class="post-meta-item-icon">
        <i class="far fa-file-word"></i>
      </span>
      <span class="post-meta-item-text">本文字数：</span>
      <span>40k</span>
    </span>
    <span class="post-meta-item" title="阅读时长">
      <span class="post-meta-item-icon">
        <i class="far fa-clock"></i>
      </span>
      <span class="post-meta-item-text">阅读时长 &asymp;</span>
      <span>2:27</span>
    </span>
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <h2 id="pandas概述">Pandas概述</h2>
<p>Pandas 是在 NumPy 基础上建立的新程序库，提供了一种高效的
DataFrame数据结构。 DataFrame
本质上是一种带行标签和列标签、支持相同类型数据和缺失值的多维数组。</p>
<p>NumPy 的 ndarray
数据结构为数值计算任务中常见的干净整齐、组织良好的数据提供了许多不可或缺的功能。虽然它在这方面做得很好，但是当我们需要处理更灵活的数据任务（如为数据添加标签、处理缺失值等），或者需要做一些不是对每个元素都进行广播映射的计算（如分组、透视表等）时，
NumPy
的限制就非常明显了，而这些都是分析各种非结构化数据时很重要的一部分。建立在
NumPy 数组结构上的Pandas，尤其是它的 Series 和 DataFrame
对象，为我们处理那些消耗大量时间的“数据清理”任务提供了捷径。</p>
<p>在安装 Pandas 之前，确保你的操作系统中有
NumPy。可使用<code>pip install pandas</code>安装pandas。如果你使用了
Anaconda，那么 Pandas 就已经安装好了。更详细的安装请参考<span class="exturl" data-url="aHR0cHM6Ly9wYW5kYXMucHlkYXRhLm9yZy9kb2NzL2dldHRpbmdfc3RhcnRlZC9pbnN0YWxsLmh0bWw=">官方文档<i class="fa fa-external-link-alt"></i></span>。<br />
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> pandas <span class="keyword">as</span> pd</span><br><span class="line"></span><br><span class="line"><span class="comment"># 查看包的版本</span></span><br><span class="line">pd.__version__</span><br><span class="line"><span class="comment"># 自动补全</span></span><br><span class="line">pd.&lt;TAB&gt;</span><br><span class="line"><span class="comment"># 内置的文档</span></span><br><span class="line">pd?</span><br></pre></td></tr></table></figure><br />
          <!--noindex-->
            <div class="post-button">
              <a class="btn" href="/2020/04/25/ML/03.ML-Pandas/#more" rel="contents">
                阅读全文 &raquo;
              </a>
            </div>
          <!--/noindex-->
        
      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="https://soundmemories.github.io/2020/04/22/ML/02.ML-NumPy/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avstar.png">
      <meta itemprop="name" content="SoundMemories">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="SoundMemories">
      <meta itemprop="description" content="今日事，今日毕">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | SoundMemories">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2020/04/22/ML/02.ML-NumPy/" class="post-title-link" itemprop="url">ML-NumPy</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>

      <time title="创建时间：2020-04-22 00:00:00" itemprop="dateCreated datePublished" datetime="2020-04-22T00:00:00+08:00">2020-04-22</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">分类于</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/ML/" itemprop="url" rel="index"><span itemprop="name">ML</span></a>
        </span>
    </span>

  
    <span class="post-meta-break"></span>
    <span class="post-meta-item" title="本文字数">
      <span class="post-meta-item-icon">
        <i class="far fa-file-word"></i>
      </span>
      <span class="post-meta-item-text">本文字数：</span>
      <span>18k</span>
    </span>
    <span class="post-meta-item" title="阅读时长">
      <span class="post-meta-item-icon">
        <i class="far fa-clock"></i>
      </span>
      <span class="post-meta-item-text">阅读时长 &asymp;</span>
      <span>1:07</span>
    </span>
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <h2 id="python数据的存储和操作">Python数据的存储和操作</h2>
<p>要实现高效的数据驱动的科学和计算，需要理解数据是如何被存储和操作的。Python
语言中数据数组是如何被处理的，并对比 NumPy
所做的改进。这也是理解其他数据科学工具的数据处理的基础。<br />
          <!--noindex-->
            <div class="post-button">
              <a class="btn" href="/2020/04/22/ML/02.ML-NumPy/#more" rel="contents">
                阅读全文 &raquo;
              </a>
            </div>
          <!--/noindex-->
        
      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="https://soundmemories.github.io/2020/04/21/ML/01.ML-IPython%E5%92%8CJupyter/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avstar.png">
      <meta itemprop="name" content="SoundMemories">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="SoundMemories">
      <meta itemprop="description" content="今日事，今日毕">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | SoundMemories">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2020/04/21/ML/01.ML-IPython%E5%92%8CJupyter/" class="post-title-link" itemprop="url">ML-IPython和Jupyter</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>

      <time title="创建时间：2020-04-21 00:00:00" itemprop="dateCreated datePublished" datetime="2020-04-21T00:00:00+08:00">2020-04-21</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">分类于</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/ML/" itemprop="url" rel="index"><span itemprop="name">ML</span></a>
        </span>
    </span>

  
    <span class="post-meta-break"></span>
    <span class="post-meta-item" title="本文字数">
      <span class="post-meta-item-icon">
        <i class="far fa-file-word"></i>
      </span>
      <span class="post-meta-item-text">本文字数：</span>
      <span>4.5k</span>
    </span>
    <span class="post-meta-item" title="阅读时长">
      <span class="post-meta-item-icon">
        <i class="far fa-clock"></i>
      </span>
      <span class="post-meta-item-text">阅读时长 &asymp;</span>
      <span>16 分钟</span>
    </span>
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <h2 id="ipython">IPython</h2>
<p>IPython（interactive Python 的简称，即交互式Python），由 Fernando
Perez 作为一个增强的 Python 解释器于 2001
年启动，并由此发展为一个项目。用 Perez
的原话来说，该项目致力于提供“科学计算的全生命周期开发工具”。如果将
Python 看作数据科学任务的引擎，那么 IPython 就是一个交互式控制面板。</p>
<p>IPython 除了作为 Python 的一个交互式接口，还提供了一些有用的 Python
语法附加功能（魔法命令），我会介绍其中最有用的一些。</p>
<p>另外，IPython 被紧密地连接在 <span class="exturl" data-url="aHR0cDovL2p1cHl0ZXIub3Jn">Jupyter项目<i class="fa fa-external-link-alt"></i></span> 中。该项目提供一个基于浏览器的
Notebook，它可以开发、协作、分享甚至发布数据科学结果。IPython Notebook
其实只是通用 Jupyter Notebook 结构的特例，而Jupyter Notebook 不仅支持
Python，还包括用于 Julia、 R 和其他编程语言的 Notebook。<br />
          <!--noindex-->
            <div class="post-button">
              <a class="btn" href="/2020/04/21/ML/01.ML-IPython%E5%92%8CJupyter/#more" rel="contents">
                阅读全文 &raquo;
              </a>
            </div>
          <!--/noindex-->
        
      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="https://soundmemories.github.io/2020/04/20/ML/00.ML-%E6%9C%BA%E5%99%A8%E5%AD%A6%E4%B9%A0%EF%BC%9F/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avstar.png">
      <meta itemprop="name" content="SoundMemories">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="SoundMemories">
      <meta itemprop="description" content="今日事，今日毕">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | SoundMemories">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2020/04/20/ML/00.ML-%E6%9C%BA%E5%99%A8%E5%AD%A6%E4%B9%A0%EF%BC%9F/" class="post-title-link" itemprop="url">ML-机器学习？</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>

      <time title="创建时间：2020-04-20 00:00:00" itemprop="dateCreated datePublished" datetime="2020-04-20T00:00:00+08:00">2020-04-20</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">分类于</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/ML/" itemprop="url" rel="index"><span itemprop="name">ML</span></a>
        </span>
    </span>

  
    <span class="post-meta-break"></span>
    <span class="post-meta-item" title="本文字数">
      <span class="post-meta-item-icon">
        <i class="far fa-file-word"></i>
      </span>
      <span class="post-meta-item-text">本文字数：</span>
      <span>1.7k</span>
    </span>
    <span class="post-meta-item" title="阅读时长">
      <span class="post-meta-item-icon">
        <i class="far fa-clock"></i>
      </span>
      <span class="post-meta-item-text">阅读时长 &asymp;</span>
      <span>6 分钟</span>
    </span>
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <h2 id="准备">准备</h2>
<p>数据科学领域常用的是Python，因为它的第三方程序包拥有庞大而活跃的生态系统，需要你有一定的
<span class="exturl" data-url="aHR0cHM6Ly9kb2NzLnB5dGhvbi5vcmcvMy8=">Python<i class="fa fa-external-link-alt"></i></span>
编程经验，而且熟悉Python中的主流科学计算库：<br />
（1）<span class="exturl" data-url="aHR0cHM6Ly9udW1weS5vcmcv">Numpy<i class="fa fa-external-link-alt"></i></span>：可以处理同类型数组型数据。<br />
（2）<span class="exturl" data-url="aHR0cHM6Ly93d3cuc2NpcHkub3JnLw==">SciPy<i class="fa fa-external-link-alt"></i></span>：可以处理多种类型带标签的数据。<br />
（3）<span class="exturl" data-url="aHR0cHM6Ly9wYW5kYXMucHlkYXRhLm9yZy8=">Pandas<i class="fa fa-external-link-alt"></i></span>：可以解决常见的科学计算问题。<br />
（4）<span class="exturl" data-url="aHR0cHM6Ly9tYXRwbG90bGliLm9yZy8=">Matplotlib<i class="fa fa-external-link-alt"></i></span>：可以绘制可用于印刷的可视化图形。<br />
以及Python机器/深度学习框架：<br />
（1）<span class="exturl" data-url="aHR0cHM6Ly9zY2lraXQtbGVhcm4ub3JnLw==">Scikit-Learn<i class="fa fa-external-link-alt"></i></span>：实现了众多机器学习算法。<br />
（2）<span class="exturl" data-url="aHR0cHM6Ly90ZW5zb3JmbG93Lmdvb2dsZS5jbi8=">TensorFlow<i class="fa fa-external-link-alt"></i></span>：使用数据流图进行分布式运算，可在多个GPU服务器上分配运算，针对大型项目和深度学习项目。Google开源框架。<br />
（3）<span class="exturl" data-url="aHR0cHM6Ly93d3cucGFkZGxlcGFkZGxlLm9yZy5jbi8=">PaddlePaddle<i class="fa fa-external-link-alt"></i></span>：同TensorFlow，Baidu开源框架。</p>
<p>编程环境建议使用Python的<span class="exturl" data-url="aHR0cHM6Ly9qdXB5dGVyLm9yZy8=">Jupyter
Notebook<i class="fa fa-external-link-alt"></i></span>，这是一个非常好用的工具，支持多种语言编程，还可以写笔记。它依托的Python底层环境是IPython，所以IPython的魔法命令也可以用在Jupyter上。</p>
<p>另外，如果你想深入理解底层的原理，则需要大学水平的数学知识（微积分、线性代数、概率论和统计学）。</p>
<h2 id="软件安装">软件安装</h2>
<p>安装 Python
和科学计算程序库的方法有很多，推荐使用Anaconda发行版，Windows、Linux 和
Mac OS操作系统的安装和使用方式类似。</p>
<p>Anaconda 发行版有两种：<br />
（1）<span class="exturl" data-url="aHR0cHM6Ly9kb2NzLmNvbmRhLmlvL2VuL2xhdGVzdC9taW5pY29uZGEuaHRtbA==">Miniconda<i class="fa fa-external-link-alt"></i></span>：只包含
Python 解释器和一个名为conda 的命令行工具。 conda
是一个跨平台的程序包管理器，可以管理各种 Python 程序包，类似于 Linux
用户熟悉的 apt 和 yum 程序包管理器。<br />
（2）<span class="exturl" data-url="aHR0cHM6Ly93d3cuYW5hY29uZGEuY29tL3Byb2R1Y3RzL2luZGl2aWR1YWwjRG93bmxvYWRz">Anaconda<i class="fa fa-external-link-alt"></i></span>：除了包含
Python 和 conda
之外，还同时绑定了四五百个科学计算程序包。由于预安装了许多包，因此安装它需要占用几个G字节的存储空间。</p>
<p>如果安装了 Miniconda，所有程序包（包括
Anaconda）都可以手动安装。因此，我推荐先安装
Miniconda，其他包视情况安装。<br />
首先，下载并安装 Miniconda 程序包（确认你选择的是适合 Python 3
的版本），然后安装几个重要程序包。<br />
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[~]$ conda install numpy pandas scikit-learn matplotlib seaborn ipython-notebook</span><br></pre></td></tr></table></figure><br />
若使用其他更专业的 Python 科学计算工具，安装方法同样很简单，就是 conda
install 程序包名称。关于 conda 的更多信息，包括 conda
虚拟环境（强烈推荐）的创建和使用，请参考 <span class="exturl" data-url="aHR0cDovL2NvbmRhLnB5ZGF0YS5vcmcvZG9jcy8=">conda 在线文档<i class="fa fa-external-link-alt"></i></span>。<br />
          <!--noindex-->
            <div class="post-button">
              <a class="btn" href="/2020/04/20/ML/00.ML-%E6%9C%BA%E5%99%A8%E5%AD%A6%E4%B9%A0%EF%BC%9F/#more" rel="contents">
                阅读全文 &raquo;
              </a>
            </div>
          <!--/noindex-->
        
      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="https://soundmemories.github.io/2020/04/01/Java/25.Java%E6%A1%86%E6%9E%B6Spring%E5%92%8CSpringMVC/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avstar.png">
      <meta itemprop="name" content="SoundMemories">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="SoundMemories">
      <meta itemprop="description" content="今日事，今日毕">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | SoundMemories">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2020/04/01/Java/25.Java%E6%A1%86%E6%9E%B6Spring%E5%92%8CSpringMVC/" class="post-title-link" itemprop="url">Java框架Spring和SpringMVC</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>

      <time title="创建时间：2020-04-01 00:00:00" itemprop="dateCreated datePublished" datetime="2020-04-01T00:00:00+08:00">2020-04-01</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">分类于</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/Java/" itemprop="url" rel="index"><span itemprop="name">Java</span></a>
        </span>
    </span>

  
    <span class="post-meta-break"></span>
    <span class="post-meta-item" title="本文字数">
      <span class="post-meta-item-icon">
        <i class="far fa-file-word"></i>
      </span>
      <span class="post-meta-item-text">本文字数：</span>
      <span>19k</span>
    </span>
    <span class="post-meta-item" title="阅读时长">
      <span class="post-meta-item-icon">
        <i class="far fa-clock"></i>
      </span>
      <span class="post-meta-item-text">阅读时长 &asymp;</span>
      <span>1:08</span>
    </span>
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <h2 id="框架">框架</h2>
<p>框架，可看作是具有<strong>约束性</strong>的去支撑我们<strong>实现各种功能</strong>的<strong>半成品</strong>的项目，我们要需要在框架上实现自己的业务逻辑。<br />
SSM模式：<strong>设计型框架（spring）</strong> +
<strong>MVC框架（springMVC）</strong> +
<strong>持久层框架（mybatis）</strong>。</p>
<p><strong>Spring</strong>：轻量级的Java开发框架。<br />
<strong>SpringBoot</strong>：简化Spring应用的开发过程，内部集成了很多第三方库的配置，开箱即用，SpringBoot的约定大于配置。<br />
<strong>SpringCloud</strong>：基于SpringBoot实现的服务治理工具包，在微服务架构中用于管理和协调服务。<br />
<strong>微服务</strong>：把一个单体项目，拆分为多个微服务，每个微服务可以独立技术选型、开发、部署，运维，并且多个服务相互协调，相互配合，最终完成用户的价值。</p>
<h2 id="spring">Spring</h2>
<p>Spring是一个开源框架，其核心特性是<strong>依赖注入(DI)</strong>与<strong>面向切面编程(AOP)</strong>，它们都是基于Java的反射机制。</p>
<h3 id="依赖注入di">依赖注入(DI)</h3>
<p>Java程序中，类是基本的代码组织单位。当某个类要使用另一个类时，自然的做法是创建另一个类的对象，然后调用该对象的方法。这样做在程序规模较小时没什么问题，但当程序规模很大时这些类之间过于紧密的耦合会导致后续开发维护困难。例如要替换其中某个类，就不得不修改所有涉及这个类的所有代码。上面提到类里面创建另外一个类对象会造成耦合太紧，“控制反转IOC”与“依赖注入DI”就是解决这个一个类依赖另一个类导致耦合太紧修改工程量大的问题，Spring框架就把创建类的行为从类中拿出来放到Spring框架里去做，类与类之间创建关系就没有了。</p>
<p><strong>控制反转IOC</strong>：由类控制其所依赖的类对象的创建，现在把创建动作放到Spring框架里了，由框架控制所有类对象的创建。<br />
<strong>依赖注入DI</strong>：框架创建了类所依赖的对象，然后把这些对象传给（注入）依赖它们的类。<br />
所以可以看到，Spring框架中“控制反转”与“依赖注入”实际上讲的是同一个事情，只是角度不同，也可以理解为DI是IOC的具体实现。</p>
<h3 id="面向切面编程aop">面向切面编程(AOP)</h3>
<p>面向切面编程AOP的主要作用是，在不修改源代码的情况下，可以给目标类打补丁，让其执行补丁中的代码。例如，用户类中有个登录方法，现在需要加用户登录日志。使用AOP就不需要修改用户登录方法，只需把日志代码注入到用户登录方法前后，让其执行。日志代码就是“切面”，插入代码的地方（用户类的登录方法）就是“连接点”。通过AOP提供的软件设计，使得核心业务逻辑与系统服务分离。</p>
<h2 id="环境构建">环境构建</h2>
<h3 id="新方式">新方式</h3>
<p>Spring Framework的模块有很多：<br />
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">spring-aop              spring-core        spring-jms        spring-tx</span><br><span class="line">spring-aspects          spring-core-test   spring-messaging  spring-web</span><br><span class="line">spring-beans            spring-expression  spring-orm        spring-webflux</span><br><span class="line">spring-context          spring-instrument  spring-oxm        spring-webmvc</span><br><span class="line">spring-context-indexer  spring-jcl         spring-r2dbc      spring-websocket</span><br><span class="line">spring-context-support  spring-jdbc        spring-test</span><br></pre></td></tr></table></figure></p>
<p>目前引入以上Spring框架的jar包依靠Maven的pom.xml，比如：<br />
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-context<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>6.1.4<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure></p>
<h3 id="旧方式">旧方式</h3>
<p>旧方式是下载Spring开发包，拷贝需要的jar包到项目下创建的lib文件夹里面，选中所有文件后Build
Path即可。</p>
<p>1.创建一个项目把下面jar包拷贝到项目的lib文件夹下，选中所有文件后Build
Path：<br />
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//spring-framework-4.0.0.RELEASE\libs</span></span><br><span class="line">spring-beans-<span class="number">4.0</span><span class="number">.0</span>.RELEASE.jar</span><br><span class="line">spring-context-<span class="number">4.0</span><span class="number">.0</span>.RELE2ASE.jar</span><br><span class="line">spring-core-<span class="number">4.0</span><span class="number">.0</span>.RELEASE.jar</span><br><span class="line">spring-expression-<span class="number">4.0</span><span class="number">.0</span>.RELEASE.jar</span><br><span class="line">commons-logging-<span class="number">1.1</span><span class="number">.1</span>.jar</span><br></pre></td></tr></table></figure></p>
<p>2.src/com.example.bean文件夹下，创建Student类。<br />
3.创建名为conf的source Folder类型文件夹，存放Spring
Bean配置文件applicationContext.xml：<br />
<figure class="highlight xml"><figcaption><span>applicationContext.xml</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version=<span class="string">&quot;1.0&quot;</span> encoding=<span class="string">&quot;UTF-8&quot;</span>?&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">beans</span> <span class="attr">xmlns</span>=<span class="string">&quot;http://www.springframework.org/schema/beans&quot;</span></span></span><br><span class="line"><span class="tag">    <span class="attr">xmlns:xsi</span>=<span class="string">&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span></span></span><br><span class="line"><span class="tag">    <span class="attr">xsi:schemaLocation</span>=<span class="string">&quot;http://www.springframework.org/schema/beans </span></span></span><br><span class="line"><span class="string"><span class="tag">        http://www.springframework.org/schema/beans/spring-beans.xsd</span></span></span><br><span class="line"><span class="string"><span class="tag">        http://www.springframework.org/schema/util </span></span></span><br><span class="line"><span class="string"><span class="tag">        http://www.springframework.org/schema/util/spring-util-4.0.xsd&quot;</span>&gt;</span></span><br><span class="line"><span class="comment">&lt;!-- 使用bean元素定义一个由IOC容器创建的对象 --&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- class属性指定用于创建bean的全类名 --&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- id属性指定用于引用bean实例的标识 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">&quot;student&quot;</span> <span class="attr">class</span>=<span class="string">&quot;com.example.bean.Student&quot;</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!-- 使用property子元素为bean的属性赋值(通过类的setxx方法注入) --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;studentId&quot;</span> <span class="attr">value</span>=<span class="string">&quot;1001&quot;</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;stuName&quot;</span> <span class="attr">value</span>=<span class="string">&quot;Tom2015&quot;</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;age&quot;</span> <span class="attr">value</span>=<span class="string">&quot;20&quot;</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br></pre></td></tr></table></figure></p>
<p>4.通过Spring的IOC容器创建Student类实例：<br />
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//ClassPathXmlApplicationContext：类路径下配置文件，相对路径</span></span><br><span class="line"><span class="comment">//FileSystemXmlApplicationContext：系统路径下配置文件，绝对路径</span></span><br><span class="line"><span class="comment">//1.创建IOC容器对象</span></span><br><span class="line"><span class="type">ApplicationContext</span> <span class="variable">iocContainer</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ClassPathXmlApplicationContext</span>(<span class="string">&quot;applicationContext.xml&quot;</span>);</span><br><span class="line"><span class="comment">//2.根据id值获取bean实例对象（id必须唯一）</span></span><br><span class="line"><span class="type">Student</span> <span class="variable">student</span> <span class="operator">=</span> (Student) iocContainer.getBean(<span class="string">&quot;student&quot;</span>);</span><br><span class="line"><span class="comment">//2.根据id值和类名获取bean实例对象（不用强转了）</span></span><br><span class="line"><span class="type">Student</span> <span class="variable">student</span> <span class="operator">=</span> iocContainer.getBean(<span class="string">&quot;student&quot;</span>, Student.class);</span><br><span class="line"><span class="comment">//3.打印bean</span></span><br><span class="line">System.out.println(student);</span><br></pre></td></tr></table></figure></p>
<h2 id="bean依赖注入">Bean（依赖注入）</h2>
<h3 id="常规注入">常规注入</h3>
<p>value属性只接收基本数据类型和其包装类型，也叫字面量属性。<br />
1.前面【旧方式】中讲解了bean的类、属性配置和注入：<br />
<figure class="highlight xml"><figcaption><span>applicationContext.xml</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version=<span class="string">&quot;1.0&quot;</span> encoding=<span class="string">&quot;UTF-8&quot;</span>?&gt;</span></span><br><span class="line"><span class="comment">&lt;!-- 使用bean元素定义一个由IOC容器创建的对象 --&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- class属性指定用于创建bean的全类名 --&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- id属性指定用于引用bean实例的标识 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">&quot;student&quot;</span> <span class="attr">class</span>=<span class="string">&quot;com.example.bean.Student&quot;</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!-- 使用property子元素为bean的属性赋值(通过类的setxx方法注入) --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;studentId&quot;</span> <span class="attr">value</span>=<span class="string">&quot;1001&quot;</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;stuName&quot;</span> <span class="attr">value</span>=<span class="string">&quot;Tom2015&quot;</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;age&quot;</span> <span class="attr">value</span>=<span class="string">&quot;20&quot;</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br></pre></td></tr></table></figure></p>
<p>2.bean的构造器注入：<br />
<figure class="highlight xml"><figcaption><span>applicationContext.xml</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- 1.自动匹配合适的构造器 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">&quot;book&quot;</span> <span class="attr">class</span>=<span class="string">&quot;com.example.spring.bean.Book&quot;</span> &gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">constructor-arg</span> <span class="attr">value</span>= <span class="string">&quot;10010&quot;</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">constructor-arg</span> <span class="attr">value</span>= <span class="string">&quot;Book01&quot;</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">constructor-arg</span> <span class="attr">value</span>= <span class="string">&quot;Author01&quot;</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">constructor-arg</span> <span class="attr">value</span>= <span class="string">&quot;20.2&quot;</span>/&gt;</span></span><br><span class="line">&lt;/bean &gt;</span><br><span class="line"><span class="comment">&lt;!-- 2.通过索引值指定参数位置 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">&quot;book&quot;</span> <span class="attr">class</span>=<span class="string">&quot;com.example.spring.bean.Book&quot;</span> &gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">constructor-arg</span> <span class="attr">value</span>= <span class="string">&quot;10010&quot;</span> <span class="attr">index</span> =<span class="string">&quot;0&quot;</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">constructor-arg</span> <span class="attr">value</span>= <span class="string">&quot;Book01&quot;</span> <span class="attr">index</span> =<span class="string">&quot;1&quot;</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">constructor-arg</span> <span class="attr">value</span>= <span class="string">&quot;Author01&quot;</span> <span class="attr">index</span> =<span class="string">&quot;2&quot;</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">constructor-arg</span> <span class="attr">value</span>= <span class="string">&quot;20.2&quot;</span> <span class="attr">index</span> =<span class="string">&quot;3&quot;</span>/&gt;</span></span><br><span class="line">&lt;/bean &gt;</span><br><span class="line"><span class="comment">&lt;!-- 3.通过类型区分重载的构造器 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">&quot;book&quot;</span> <span class="attr">class</span>=<span class="string">&quot;com.example.spring.bean.Book&quot;</span> &gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">constructor-arg</span> <span class="attr">value</span>= <span class="string">&quot;10010&quot;</span> <span class="attr">index</span> =<span class="string">&quot;0&quot;</span> <span class="attr">type</span>=<span class="string">&quot;java.lang.Integer&quot;</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">constructor-arg</span> <span class="attr">value</span>= <span class="string">&quot;Book01&quot;</span> <span class="attr">index</span> =<span class="string">&quot;1&quot;</span> <span class="attr">type</span>=<span class="string">&quot;java.lang.String&quot;</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">constructor-arg</span> <span class="attr">value</span>= <span class="string">&quot;Author01&quot;</span> <span class="attr">index</span> =<span class="string">&quot;2&quot;</span> <span class="attr">type</span>=<span class="string">&quot;java.lang.String&quot;</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">constructor-arg</span> <span class="attr">value</span>= <span class="string">&quot;20.2&quot;</span> <span class="attr">index</span> =<span class="string">&quot;3&quot;</span> <span class="attr">type</span>=<span class="string">&quot;java.lang.Double&quot;</span> /&gt;</span></span><br><span class="line">&lt;/bean &gt;</span><br></pre></td></tr></table></figure></p>
<p>除了以上<code>&lt;property&gt;</code>（setter注入）、<code>&lt;constructor-arg&gt;</code>（构造器）注入，还可以使用<code>p名称空间</code>简化使用属性配置方式（前提引入p定义）：<br />
<figure class="highlight xml"><figcaption><span>applicationContext.xml</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- 想使用p，需要在开始引入p定义 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">beans</span> <span class="attr">xmlns</span>=<span class="string">&quot;http://www.springframework.org/schema/beans&quot;</span></span></span><br><span class="line"><span class="tag">    <span class="attr">xmlns:xsi</span>=<span class="string">&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span></span></span><br><span class="line"><span class="tag">    <span class="attr">xmlns:p</span>=<span class="string">&quot;http://www.springframework.org/schema/p&quot;</span></span></span><br><span class="line"><span class="tag">    <span class="attr">xsi:schemaLocation</span>=<span class="string">&quot;http://www.springframework.org/schema/beans </span></span></span><br><span class="line"><span class="string"><span class="tag">        http://www.springframework.org/schema/beans/spring-beans.xsd</span></span></span><br><span class="line"><span class="string"><span class="tag">        http://www.springframework.org/schema/util </span></span></span><br><span class="line"><span class="string"><span class="tag">        http://www.springframework.org/schema/util/spring-util-4.0.xsd&quot;</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">bean</span> </span></span><br><span class="line"><span class="tag">    <span class="attr">id</span>=<span class="string">&quot;studentSuper&quot;</span> </span></span><br><span class="line"><span class="tag">    <span class="attr">class</span>=<span class="string">&quot;com.example.bean.Student&quot;</span></span></span><br><span class="line"><span class="tag">    <span class="attr">p:studentId</span>=<span class="string">&quot;2002&quot;</span> <span class="attr">p:stuName</span>=<span class="string">&quot;Jerry&quot;</span> <span class="attr">p:age</span>=<span class="string">&quot;18&quot;</span> <span class="attr">p:teacher-ref</span>=<span class="string">&quot;teacher&quot;</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br></pre></td></tr></table></figure></p>
<p>3.null值：<br />
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">class</span>=<span class="string">&quot;com.example.spring.bean.Book&quot;</span> <span class="attr">id</span>=<span class="string">&quot;bookNull&quot;</span> &gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>= <span class="string">&quot;bookId&quot;</span> <span class="attr">value</span> =<span class="string">&quot;2000&quot;</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>= <span class="string">&quot;bookName&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">null</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>= <span class="string">&quot;author&quot;</span> <span class="attr">value</span> =<span class="string">&quot;nullAuthor&quot;</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>= <span class="string">&quot;price&quot;</span> <span class="attr">value</span> =<span class="string">&quot;50&quot;</span>/&gt;</span></span><br><span class="line">&lt;/bean &gt;</span><br></pre></td></tr></table></figure></p>
<p>4.引用类型，要通过<code>ref</code>注入，不能通过<code>value</code>注入：<br />
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">&quot;person&quot;</span> <span class="attr">class</span>=<span class="string">&quot;com.example.Person&quot;</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- name的属性值为一个已经实例化的名为teacher的Bean --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;name&quot;</span> <span class="attr">ref</span>=<span class="string">&quot;teacher&quot;</span> /&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- 为级联对象属性tname赋值为Tom --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;name.tname&quot;</span> <span class="attr">value</span>=<span class="string">&quot;Tom&quot;</span> /&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br><span class="line"><span class="comment">&lt;!-- 实例化名为teacher的Bean --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">&quot;teacher&quot;</span> <span class="attr">class</span>=<span class="string">&quot;com.example.Teacher&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;tname&quot;</span> <span class="attr">value</span>=<span class="string">&quot;Alice&quot;</span> /&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br></pre></td></tr></table></figure></p>
<p>5.内部Bean，只能在当前这个Bean内部使用：<br />
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">&quot;person&quot;</span> <span class="attr">class</span>=<span class="string">&quot;com.example.Person&quot;</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- 定义在某个bean内部的bean，只能在当前bean中使用 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;name&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">&quot;tt&quot;</span> <span class="attr">class</span>=<span class="string">&quot;com.example.Teacher&quot;</span> &gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;tname&quot;</span> <span class="attr">value</span>=<span class="string">&quot;Alice&quot;</span> /&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br></pre></td></tr></table></figure></p>
<p>6.在Spring中可以通过一组内置的XML标签来配置集合属性，例如：<code>&lt;list&gt;</code>、<code>&lt;set&gt;</code>、<code>&lt;map&gt;</code>。<br />
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- list和set使用方式一样 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">&quot;shop&quot;</span> <span class="attr">class</span>=<span class="string">&quot;com.example.Shop&quot;</span> &gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>= <span class="string">&quot;categoryList&quot;</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!-- 以字面量为值的List集合 List&lt;String&gt; --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">list</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">value</span>&gt;</span>历史&lt;/value &gt;</span><br><span class="line">            <span class="tag">&lt;<span class="name">value</span>&gt;</span>军事&lt;/value &gt;</span><br><span class="line">        <span class="tag">&lt;/<span class="name">list</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>= <span class="string">&quot;bookList&quot;</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!-- 以bean的引用为值的List集合 List&lt;Book&gt; --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">list</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">ref</span> <span class="attr">bean</span>=<span class="string">&quot;book01&quot;</span>/&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">ref</span> <span class="attr">bean</span>=<span class="string">&quot;book02&quot;</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">list</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">&lt;/bean &gt;</span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">&quot;book01&quot;</span> <span class="attr">class</span>=<span class="string">&quot;com.example.Book&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">&quot;book02&quot;</span> <span class="attr">class</span>=<span class="string">&quot;com.example.Book&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br></pre></td></tr></table></figure></p>
<p>Map类型：<br />
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- bookMap类型为Map&lt;String, String&gt; --&gt;</span></span><br><span class="line"><span class="comment">&lt;!-- 一个&lt;entry&gt;代表一个键值对 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">&quot;cup&quot;</span> <span class="attr">class</span>=<span class="string">&quot;com.example.Cup&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;bookMap&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">map</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">entry</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">key</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">value</span>&gt;</span>bookKey01<span class="tag">&lt;/<span class="name">value</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;/<span class="name">key</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">value</span>&gt;</span>bookValue01<span class="tag">&lt;/<span class="name">value</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">entry</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">entry</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">key</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">value</span>&gt;</span>bookKey02<span class="tag">&lt;/<span class="name">value</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;/<span class="name">key</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">ref</span> <span class="attr">bean</span>=<span class="string">&quot;book02&quot;</span>/&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">entry</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">map</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br></pre></td></tr></table></figure></p>
<p>集合类型：<br />
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- 配置集合类型的bean需要引入util名称空间 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">beans</span> <span class="attr">xmlns</span>=<span class="string">&quot;http://www.springframework.org/schema/beans&quot;</span></span></span><br><span class="line"><span class="tag">    <span class="attr">xmlns:xsi</span>=<span class="string">&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span></span></span><br><span class="line"><span class="tag">    <span class="attr">xmlns:p</span>=<span class="string">&quot;http://www.springframework.org/schema/p&quot;</span></span></span><br><span class="line"><span class="tag">    <span class="attr">xmlns:util</span>=<span class="string">&quot;http://www.springframework.org/schema/util&quot;</span></span></span><br><span class="line"><span class="tag">    <span class="attr">xsi:schemaLocation</span>=<span class="string">&quot;http://www.springframework.org/schema/beans </span></span></span><br><span class="line"><span class="string"><span class="tag">        http://www.springframework.org/schema/beans/spring-beans.xsd</span></span></span><br><span class="line"><span class="string"><span class="tag">        http://www.springframework.org/schema/util </span></span></span><br><span class="line"><span class="string"><span class="tag">        http://www.springframework.org/schema/util/spring-util-4.0.xsd&quot;</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">util:list</span> <span class="attr">id</span>=<span class="string">&quot;categoryList&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">value</span>&gt;</span>相声<span class="tag">&lt;/<span class="name">value</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">value</span>&gt;</span>评书<span class="tag">&lt;/<span class="name">value</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">util:list</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">util:list</span> <span class="attr">id</span>=<span class="string">&quot;bookList&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">ref</span> <span class="attr">bean</span>=<span class="string">&quot;book01&quot;</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">ref</span> <span class="attr">bean</span>=<span class="string">&quot;book02&quot;</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">util:list</span>&gt;</span></span><br></pre></td></tr></table></figure></p>
<h3 id="工厂方式">工厂方式</h3>
<p>工厂bean跟普通bean不同，其返回的对象不是指定类的一个实例，其返回的是该工厂bean的getObject方法所返回的对象：<br />
<div class="tabs" id="factorybean"><ul class="nav-tabs"><li class="tab active"><a href="#factorybean-1">工厂bean定义</a></li><li class="tab"><a href="#factorybean-2">bean配置</a></li></ul><div class="tab-content"><div class="tab-pane active" id="factorybean-1"><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.example.factorybean;</span><br><span class="line"><span class="keyword">import</span> org.springframework.beans.factory.FactoryBean;</span><br><span class="line"><span class="comment">//工厂bean必须实现org.springframework.beans.factory.FactoryBean接口</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">MyFactory</span> <span class="keyword">implements</span> <span class="title class_">FactoryBean</span>&lt;Car&gt; &#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> Car <span class="title function_">getObject</span><span class="params">()</span> <span class="keyword">throws</span> Exception &#123;</span><br><span class="line">        <span class="type">Car</span> <span class="variable">car</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Car</span>();</span><br><span class="line">        car.setBrand(<span class="string">&quot;奥迪&quot;</span>);</span><br><span class="line">        car.setPrice(<span class="number">200000.0</span>);</span><br><span class="line">        <span class="keyword">return</span> car;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> Class&lt;?&gt; getObjectType() &#123;</span><br><span class="line">        <span class="comment">// TODO Auto-generated method stub</span></span><br><span class="line">        <span class="keyword">return</span> Car.class;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="type">boolean</span> <span class="title function_">isSingleton</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="comment">// TODO Auto-generated method stub</span></span><br><span class="line">        <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Car</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> String brand;</span><br><span class="line">    <span class="keyword">private</span> Double price;</span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">getBrand</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> brand;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setBrand</span><span class="params">(String brand)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.brand = brand;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> Double <span class="title function_">getPrice</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> price;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setPrice</span><span class="params">(Double price)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.price = price;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">toString</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;Car [brand=&quot;</span> + brand + <span class="string">&quot;, price=&quot;</span> + price + <span class="string">&quot;]&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div><div class="tab-pane" id="factorybean-2"><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">&quot;product&quot;</span> <span class="attr">class</span>=<span class="string">&quot;com.example.FactoryBean&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br></pre></td></tr></table></figure></div></div></div></p>
<h3 id="作用域">作用域</h3>
<p>1.Bean的作用域：可以在<code>&lt;bean&gt;</code>元素的scope属性里设置bean的作用域，以决定这个bean是单实例的还是多实例的。<br />
2.默认情况下，作用域为单例singleton，Spring只为每个在IOC容器里声明的bean创建唯一一个实例，整个IOC容器范围内都能共享该实例，所有后续的getBean方法调用和bean引用都将返回这个唯一的bean实例。<br />
3.当bean的作用域为单例时，Spring会在IOC容器对象创建时就创建bean的对象实例。而当bean的作用域为prototype时，IOC容器在获取bean的实例时创建bean的实例对象。<br />
<img src="/images/Java/Bean作用域.png" width="60%"></p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- scope指定该实例为单例 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">&quot;student&quot;</span> <span class="attr">class</span>=<span class="string">&quot;com.example.Student&quot;</span> <span class="attr">scope</span>=<span class="string">&quot;singleton&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;sid&quot;</span> <span class="attr">value</span>=<span class="string">&quot;1001&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;sname&quot;</span> <span class="attr">value</span>=<span class="string">&quot;张三&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br></pre></td></tr></table></figure>
<h3 id="生命周期">生命周期</h3>
<p>Spring IOC容器对bean的生命周期进行管理的过程：<br />
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">1.</span>通过构造器、工厂方法创建bean实例。</span><br><span class="line"><span class="number">2.</span>设置bean的属性值、对其他bean的引用。</span><br><span class="line">将bean实例传递给bean后置处理器的postProcessBeforeInitialization方法。</span><br><span class="line"><span class="number">3.</span>调用bean的初始化方法（有此方法会自动调用）。</span><br><span class="line">将bean实例传递给bean后置处理器的postProcessAfterInitialization方法。</span><br><span class="line"><span class="number">4.</span>使用bean。</span><br><span class="line"><span class="number">5.</span>当容器关闭时，会调用bean的销毁方法（需主动调用close才会执行销毁方法）。</span><br></pre></td></tr></table></figure></p>
<p>注意上面过程的第3步，在配置bean时，可通过init-method和destroy-method属性为bean指定初始化和销毁方法：<br />
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">&quot;person&quot;</span> <span class="attr">class</span>=<span class="string">&quot;com.example.Person&quot;</span> <span class="attr">init-method</span>=<span class="string">&quot;init&quot;</span> <span class="attr">destroy-method</span>=<span class="string">&quot;destory&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;id&quot;</span> <span class="attr">value</span>=<span class="string">&quot;1001&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;sex&quot;</span> <span class="attr">value</span>=<span class="string">&quot;男&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br></pre></td></tr></table></figure></p>
<p>bean后置处理器，允许在调用<strong>初始化方法前后</strong>对bean进行额外的处理，<strong>它对所有bean都有效</strong>，需要实现<code>org.springframework.beans.factory.config.BeanPostProcessor</code>接口，在初始化方法被调用前后，Spring将把每个bean实例分别传递给上述接口的以下两个方法：<code>postProcessBeforeInitialization(Object, String)</code>、<code>postProcessAfterInitialization(Object, String)</code>。</p>
<div class="tabs" id="bean后置处理"><ul class="nav-tabs"><li class="tab active"><a href="#bean后置处理-1">后置处理器定义</a></li><li class="tab"><a href="#bean后置处理-2">bean配置</a></li></ul><div class="tab-content"><div class="tab-pane active" id="bean后置处理-1"><figure class="highlight java"><figcaption><span>AfterHandler.java</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> org.springframework.beans.BeansException;</span><br><span class="line"><span class="keyword">import</span> org.springframework.beans.factory.config.BeanPostProcessor;</span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">AfterHandler</span> <span class="keyword">implements</span> <span class="title class_">BeanPostProcessor</span> &#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> Object <span class="title function_">postProcessBeforeInitialization</span><span class="params">(Object bean, String beanName)</span> <span class="keyword">throws</span> BeansException &#123;</span><br><span class="line">        <span class="comment">//当前只有一个Person类型bean，这里直接使用了</span></span><br><span class="line">        <span class="comment">//正常这个bean是对通用bean的处理</span></span><br><span class="line">        <span class="type">Person</span> <span class="variable">person</span> <span class="operator">=</span> (Person) bean;</span><br><span class="line">        <span class="keyword">if</span>(person.getSex().equals(<span class="string">&quot;cat&quot;</span>)) &#123;</span><br><span class="line">            person.setName(<span class="string">&quot;Tom&quot;</span>);</span><br><span class="line">        &#125;<span class="keyword">else</span> &#123;</span><br><span class="line">            person.setName(<span class="string">&quot;Jerry&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> person;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> Object <span class="title function_">postProcessAfterInitialization</span><span class="params">(Object bean, String beanName)</span> <span class="keyword">throws</span> BeansException &#123;</span><br><span class="line">        <span class="comment">// TODO Auto-generated method stub</span></span><br><span class="line">        <span class="keyword">return</span> bean;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div><div class="tab-pane" id="bean后置处理-2"><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">&quot;person&quot;</span> <span class="attr">class</span>=<span class="string">&quot;com.example.Person&quot;</span> <span class="attr">init-method</span>=<span class="string">&quot;init&quot;</span> <span class="attr">destroy-method</span>=<span class="string">&quot;destory&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;id&quot;</span> <span class="attr">value</span>=<span class="string">&quot;1001&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;sex&quot;</span> <span class="attr">value</span>=<span class="string">&quot;男&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br><span class="line"><span class="comment">&lt;!-- 后置处理器不需要id --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">class</span>=<span class="string">&quot;com.example.AfterHandler&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br></pre></td></tr></table></figure></div></div></div>
<h3 id="外部文件">外部文件</h3>
<p>当bean的配置信息逐渐增多时，查找和修改一些bean的配置信息就变得愈加困难。这时可以将一部分信息提取到bean配置文件的外部，以properties格式的属性文件保存起来，同时在bean的配置文件中引用properties属性文件中的内容，从而实现一部分属性值在发生变化时仅修改properties属性文件即可。这种技术多用于连接数据库的基本信息的配置。</p>
<p>1.直接配置：<br />
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">&quot;datasource&quot;</span> <span class="attr">class</span>=<span class="string">&quot;com.alibaba.druid.pool.DruidDataSource&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;driverClassName&quot;</span> <span class="attr">value</span>=<span class="string">&quot;com.mysql.jdbc.Driver&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;url&quot;</span> <span class="attr">value</span>=<span class="string">&quot;jdbc:mysql://localhost:3306/test&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;username&quot;</span> <span class="attr">value</span>=<span class="string">&quot;root&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;password&quot;</span> <span class="attr">value</span>=<span class="string">&quot;123456&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">bean</span>&gt;</span> </span><br></pre></td></tr></table></figure></p>
<p>2.引用外部文件：<br />
<div class="tabs" id="外部文件"><ul class="nav-tabs"><li class="tab active"><a href="#外部文件-1">创建资源文件</a></li><li class="tab"><a href="#外部文件-2">加载和使用资源文件</a></li><li class="tab"><a href="#外部文件-3">java中调用</a></li></ul><div class="tab-content"><div class="tab-pane active" id="外部文件-1"><figure class="highlight txt"><figcaption><span>db.properties</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">jdbc.driver=com.mysql.jdbc.Driver</span><br><span class="line">jdbc.url=jdbc:mysql://localhost:3306/test</span><br><span class="line">jdbc.username=root</span><br><span class="line">jdbc.password=123456</span><br></pre></td></tr></table></figure></div><div class="tab-pane" id="外部文件-2"><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- 引入context名称空间 --&gt;</span></span><br><span class="line"><span class="meta">&lt;?xml version=<span class="string">&quot;1.0&quot;</span> encoding=<span class="string">&quot;UTF-8&quot;</span>?&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">beans</span> <span class="attr">xmlns</span>=<span class="string">&quot;http://www.springframework.org/schema/beans&quot;</span></span></span><br><span class="line"><span class="tag">    <span class="attr">xmlns:xsi</span>=<span class="string">&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span></span></span><br><span class="line"><span class="tag">    <span class="attr">xmlns:context</span>=<span class="string">&quot;http://www.springframework.org/schema/context&quot;</span></span></span><br><span class="line"><span class="tag">    <span class="attr">xsi:schemaLocation</span>=<span class="string">&quot;http://www.springframework.org/schema/beans </span></span></span><br><span class="line"><span class="string"><span class="tag">    http://www.springframework.org/schema/beans/spring-beans.xsd</span></span></span><br><span class="line"><span class="string"><span class="tag">    http://www.springframework.org/schema/context </span></span></span><br><span class="line"><span class="string"><span class="tag">    http://www.springframework.org/schema/context/spring-context-4.0.xsd&quot;</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">&lt;!-- 方式1：非context加载资源文件，value指定路径 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">bean</span> <span class="attr">class</span>=<span class="string">&quot;org.springframework.beans.factory.config.PropertyPlaceholderConfigurer&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;location&quot;</span> <span class="attr">value</span>=<span class="string">&quot;db.properties&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- 方式2：context加载资源文件，location指定路径 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">context:property-placeholder</span> <span class="attr">location</span>=<span class="string">&quot;db.properties&quot;</span>/&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- 使用资源文件中的信息 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">&quot;datasource&quot;</span> <span class="attr">class</span>=<span class="string">&quot;com.alibaba.druid.pool.DruidDataSource&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;driverClassName&quot;</span> <span class="attr">value</span>=<span class="string">&quot;$&#123;jdbc.driver&#125;&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;url&quot;</span> <span class="attr">value</span>=<span class="string">&quot;$&#123;jdbc.url&#125;&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;username&quot;</span> <span class="attr">value</span>=<span class="string">&quot;$&#123;jdbc.username&#125;&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;password&quot;</span> <span class="attr">value</span>=<span class="string">&quot;$&#123;jdbc.password&#125;&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">bean</span>&gt;</span> </span><br><span class="line"><span class="tag">&lt;/<span class="name">beans</span>&gt;</span></span><br></pre></td></tr></table></figure></div><div class="tab-pane" id="外部文件-3"><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> org.springframework.context.ApplicationContext;</span><br><span class="line"><span class="keyword">import</span> org.springframework.context.support.ClassPathXmlApplicationContext;</span><br><span class="line"><span class="keyword">import</span> com.alibaba.druid.pool.DruidDataSource;</span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Test</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> Exception &#123;</span><br><span class="line">        <span class="type">ApplicationContext</span> <span class="variable">ac</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ClassPathXmlApplicationContext</span>(<span class="string">&quot;datasource.xml&quot;</span>);</span><br><span class="line">        <span class="type">DruidDataSource</span> <span class="variable">bean</span> <span class="operator">=</span> ac.getBean(<span class="string">&quot;datasource&quot;</span>, DruidDataSource.class);</span><br><span class="line">        System.out.println(bean.getConnection());</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div></div></div></p>
<h3 id="自动装配">自动装配</h3>
<p>自动装配也叫自动注入，这种注入方式有缺陷，不建议使用。<br />
1.手动装配：以value或ref的方式明确指定属性值都是手动装配。<br />
2.自动装配：根据指定的装配规则，不需要明确指定，Spring自动将匹配的属性值注入bean中。只适用于非字面量属性的bean。<br />
<div class="tabs" id="自动装配（自动注入）"><ul class="nav-tabs"><li class="tab active"><a href="#自动装配（自动注入）-1">类定义</a></li><li class="tab"><a href="#自动装配（自动注入）-2">bean配置</a></li><li class="tab"><a href="#自动装配（自动注入）-3">java使用</a></li></ul><div class="tab-content"><div class="tab-pane active" id="自动装配（自动注入）-1"><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Emp</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> Integer eid;</span><br><span class="line">    <span class="keyword">private</span> String ename;</span><br><span class="line">    <span class="keyword">private</span> CarExtends car;<span class="comment">//引用对象</span></span><br><span class="line">    <span class="keyword">private</span> DeptI dept;<span class="comment">//引用对象</span></span><br><span class="line">    <span class="comment">//get和set省略..</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">DeptI</span> &#123;&#125;</span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Dept</span> <span class="keyword">implements</span> <span class="title class_">DeptI</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> Integer did;</span><br><span class="line">    <span class="keyword">private</span> String dname;</span><br><span class="line">    <span class="keyword">public</span> Integer <span class="title function_">getDid</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> did;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">//get和set省略..</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">CarExtends</span> &#123;&#125;</span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Car</span> <span class="keyword">extends</span> <span class="title class_">CarExtends</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> Integer cid;</span><br><span class="line">    <span class="keyword">private</span> String cname;</span><br><span class="line">    <span class="comment">//get和set省略..</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div><div class="tab-pane" id="自动装配（自动注入）-2"><figure class="highlight xml"><figcaption><span>auto.xml</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version=<span class="string">&quot;1.0&quot;</span> encoding=<span class="string">&quot;UTF-8&quot;</span>?&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">beans</span> <span class="attr">xmlns</span>=<span class="string">&quot;http://www.springframework.org/schema/beans&quot;</span></span></span><br><span class="line"><span class="tag">    <span class="attr">xmlns:xsi</span>=<span class="string">&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span></span></span><br><span class="line"><span class="tag">    <span class="attr">xsi:schemaLocation</span>=<span class="string">&quot;http://www.springframework.org/schema/beans </span></span></span><br><span class="line"><span class="string"><span class="tag">    http://www.springframework.org/schema/beans/spring-beans.xsd&quot;</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">&lt;!-- </span></span><br><span class="line"><span class="comment">        autowire:根据某种策略自动为非字面量属性赋值</span></span><br><span class="line"><span class="comment">        autowire=&quot;byName|byType&quot;</span></span><br><span class="line"><span class="comment">            byName:通过类的属性名和spring容器中bean的id进行比较，若一致则可直接赋值</span></span><br><span class="line"><span class="comment">            byType:通过spring容器中bean的类型为兼容性的属性赋值，哪个bean能为类属性赋值就用哪个bean赋值，</span></span><br><span class="line"><span class="comment">                   要求spring容器中只能有一个能为属性赋值的bean</span></span><br><span class="line"><span class="comment">        选用建议: 当设置autowire属性，会作用于该bean中所有的非字面量属性，因此不建议用autowire这种方式。</span></span><br><span class="line"><span class="comment">     --&gt;</span></span><br><span class="line">    </span><br><span class="line">    <span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">&quot;emp&quot;</span> <span class="attr">class</span>=<span class="string">&quot;com.example.Emp&quot;</span> <span class="attr">autowire</span>=<span class="string">&quot;byType&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;eid&quot;</span> <span class="attr">value</span>=<span class="string">&quot;1001&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;ename&quot;</span> <span class="attr">value</span>=<span class="string">&quot;张三&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!-- Emp的引用属性car、dept自动装配--&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- 自动装配为byType模式，Car类型的bean需唯一 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">&quot;car1&quot;</span> <span class="attr">class</span>=<span class="string">&quot;com.example.Car&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;cid&quot;</span> <span class="attr">value</span>=<span class="string">&quot;666666&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;cname&quot;</span> <span class="attr">value</span>=<span class="string">&quot;霸道&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">&quot;dept1&quot;</span> <span class="attr">class</span>=<span class="string">&quot;com.example.Dept&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;did&quot;</span> <span class="attr">value</span>=<span class="string">&quot;11111&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;dname&quot;</span> <span class="attr">value</span>=<span class="string">&quot;开发部&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;/<span class="name">beans</span>&gt;</span></span><br></pre></td></tr></table></figure></div><div class="tab-pane" id="自动装配（自动注入）-3"><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> org.springframework.context.ApplicationContext;</span><br><span class="line"><span class="keyword">import</span> org.springframework.context.support.ClassPathXmlApplicationContext;</span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Test</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        <span class="type">ApplicationContext</span> <span class="variable">ac</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ClassPathXmlApplicationContext</span>(<span class="string">&quot;auto.xml&quot;</span>);</span><br><span class="line">        <span class="type">Emp</span> <span class="variable">emp</span> <span class="operator">=</span> ac.getBean(<span class="string">&quot;emp&quot;</span>, Emp.class);</span><br><span class="line">        System.out.println(emp);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div></div></div></p>
<h3 id="注解配置">注解配置</h3>
<p>注解注入：通过注解的方式配置bean更加简洁和优雅，而且和MVC组件化开发的理念十分契合，是开发中常用的使用方式。</p>
<p>注解标识组件：<br />
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//组件：指spring中管理的bean。</span></span><br><span class="line">普通组件：<span class="meta">@Component</span>，标识一个受Spring IOC容器管理的组件。</span><br><span class="line">持久化层组件：<span class="meta">@Repository</span>，标识一个受Spring IOC容器管理的持久化层组件。</span><br><span class="line">业务逻辑层组件：<span class="meta">@Service</span>，标识一个受Spring IOC容器管理的业务逻辑层组件。</span><br><span class="line">表述层控制器组件：<span class="meta">@Controller</span>，标识一个受Spring IOC容器管理的表述层控制器组件。</span><br><span class="line"></span><br><span class="line">|-组件命名规则：</span><br><span class="line">    |-默认情况：使用组件的简单类名首字母小写后得到的字符串作为bean的id。</span><br><span class="line">    |-使用组件注解的value属性指定bean的id。</span><br><span class="line"><span class="comment">// 注意：事实上Spring并没有能力识别一个组件到底是不是它所标记的类型，</span></span><br><span class="line"><span class="comment">// 即使将@Respository注解用在一个表述层控制器组件上面也不会产生任何错误，</span></span><br><span class="line"><span class="comment">// 所以@Respository、@Service、@Controller这几个注解仅仅是为了让开发人员自己明确当前的组件扮演的角色。</span></span><br></pre></td></tr></table></figure></p>
<p>请求执行流程：控制层Controller接收请求，调用服务层Service处理业务逻辑，再调用Dao实现数据持久化，把持久化结果返回给Service，Service再返回给Controller，最后Controller返回给客户端。<br />
<div class="tabs" id="注解"><ul class="nav-tabs"><li class="tab active"><a href="#注解-1">controller</a></li><li class="tab"><a href="#注解-2">service</a></li><li class="tab"><a href="#注解-3">dao</a></li><li class="tab"><a href="#注解-4">bean配置</a></li><li class="tab"><a href="#注解-5">java使用</a></li></ul><div class="tab-content"><div class="tab-pane active" id="注解-1"><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//controller/UserController.java</span></span><br><span class="line"><span class="keyword">package</span> com.example.controller;</span><br><span class="line"><span class="keyword">import</span> org.springframework.beans.factory.annotation.Autowired;</span><br><span class="line"><span class="keyword">import</span> org.springframework.stereotype.Controller;</span><br><span class="line"><span class="keyword">import</span> com.example.service.UserService;</span><br><span class="line"><span class="keyword">import</span> com.example.service.UserServiceImpl;</span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment"> * 基于注解的组件化管理：@Component，@Controller（控制层），@Service（业务层），@Repository（持久层）</span></span><br><span class="line"><span class="comment"> * 以上四个注解功能完全相同，都是把被注释的类交给spring管理，不过在实际开发中，要在实现不同功能的类上加上相应的注解。</span></span><br><span class="line"><span class="comment"> * 完成组件化管理的过程：</span></span><br><span class="line"><span class="comment"> * 1.在需要被spring管理的类上加上相应注解。</span></span><br><span class="line"><span class="comment"> * 2.在配置文件中通过&lt;context:component-scan&gt;对所设置的包结构进行扫描，就会将加上注解的类，作为spring的组件进行加载。</span></span><br><span class="line"><span class="comment"> * 组件：指spring中管理的bean</span></span><br><span class="line"><span class="comment">        作为spring的组件进行加载：会自动在spring的配置文件中生成相对应的bean，这些bean的id为类的首字母小写。</span></span><br><span class="line"><span class="comment">        也可以通过@Controller(&quot;beanId&quot;)为自动生成的bean指定id。</span></span><br><span class="line"><span class="comment"> * </span></span><br><span class="line"><span class="comment"> 自动装配：在需要赋值的非字面量属性上，加上@Autowired，就可以在spring容器中，通过不同的方式匹配到相对应的bean。</span></span><br><span class="line"><span class="comment"> * @Autowired装配时，会默认使用byType的方式，此时要求spring容器中只有一个能够为其赋值。</span></span><br><span class="line"><span class="comment"> * 当byType实现不了装配时，会自动切换到byName，此时要求spring容器中，有一个bean的id和属性名一致。</span></span><br><span class="line"><span class="comment"> * 若自动装配时，匹配到多个能够复制的bean，可使用@Qualifier(value=&quot;beanId&quot;)指定使用的bean。</span></span><br><span class="line"><span class="comment"> * @Autowired和@Qualifier(value=&quot;beanId&quot;)可以一起作用域一个带形参的方法上，此时，@Qualifier(value=&quot;beanId&quot;)</span></span><br><span class="line"><span class="comment"> * 所指定的bean作用于形参</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Controller(value=&quot;aaa&quot;)</span><span class="comment">//注解方式，交给spring控制层管理，value为bean的id</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">UserController</span> &#123;</span><br><span class="line">    <span class="meta">@Autowired</span> <span class="comment">//自动装配，不用自己赋值了</span></span><br><span class="line">    <span class="keyword">private</span> UserService userService;</span><br><span class="line">    <span class="comment">// private UserService userService = new UserServiceImpl();//非自动装配，手动赋值</span></span><br><span class="line">    </span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">addUser</span><span class="params">()</span> &#123;</span><br><span class="line">        userService.addUser();<span class="comment">//调用Service</span></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">UserController</span><span class="params">()</span> &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;UserController&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div><div class="tab-pane" id="注解-2"><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//service/UserService.java</span></span><br><span class="line"><span class="keyword">package</span> com.example.service;</span><br><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">UserService</span> &#123;</span><br><span class="line">    <span class="keyword">void</span> <span class="title function_">addUser</span><span class="params">()</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//service/UserServiceImpl.java</span></span><br><span class="line"><span class="keyword">package</span> com.example.service;</span><br><span class="line"><span class="keyword">import</span> org.springframework.beans.factory.annotation.Autowired;</span><br><span class="line"><span class="keyword">import</span> org.springframework.beans.factory.annotation.Qualifier;</span><br><span class="line"><span class="keyword">import</span> org.springframework.stereotype.Service;</span><br><span class="line"><span class="keyword">import</span> com.example.dao.UserDao;</span><br><span class="line"><span class="keyword">import</span> com.example.dao.UserDaoImpl;</span><br><span class="line"><span class="meta">@Service</span> <span class="comment">//注解方式，交给spring服务层管理</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">UserServiceImpl</span> <span class="keyword">implements</span> <span class="title class_">UserService</span> &#123;</span><br><span class="line">    <span class="meta">@Autowired</span><span class="comment">//Autowired自动装配（默认byType方式，有多个可装配的类时会报错，使用@Qualifier指定具体的装配类）</span></span><br><span class="line">    <span class="meta">@Qualifier(value=&quot;userDaoMybatisImpl&quot;)</span><span class="comment">//指定Autowired自动装配的类</span></span><br><span class="line">    <span class="keyword">private</span> UserDao userDao;<span class="comment">//UserDaoImpl和UserDaoMybatisImpl都可以装配给userDao属性</span></span><br><span class="line">    <span class="comment">// private UserDao userDao = new UserDaoImpl();//非自动装配，手动赋值</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setUserDao</span><span class="params">(UserDao userDao)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.userDao = userDao;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">addUser</span><span class="params">()</span> &#123;</span><br><span class="line">        userDao.addUser();<span class="comment">//重写服务，调用Dao持久层</span></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">UserServiceImpl</span><span class="params">()</span> &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;UserServiceImpl&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div><div class="tab-pane" id="注解-3"><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//dao/UserDao.java</span></span><br><span class="line"><span class="keyword">package</span> com.example.dao;</span><br><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">UserDao</span> &#123;</span><br><span class="line">    <span class="keyword">void</span> <span class="title function_">addUser</span><span class="params">()</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//dao/UserDaoImpl.java</span></span><br><span class="line"><span class="keyword">package</span> com.example.dao;</span><br><span class="line"><span class="keyword">import</span> org.springframework.stereotype.Repository;</span><br><span class="line"><span class="meta">@Repository</span> <span class="comment">//注解方式，交给spring持久层管理</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">UserDaoImpl</span> <span class="keyword">implements</span> <span class="title class_">UserDao</span> &#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">addUser</span><span class="params">()</span> &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;UserDaoImpl：添加成功&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">UserDaoImpl</span><span class="params">()</span> &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;UserDaoImpl&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//dao/UserDaoMybatisImpl.java</span></span><br><span class="line"><span class="keyword">package</span> com.example.dao;</span><br><span class="line"><span class="keyword">import</span> org.springframework.stereotype.Repository;</span><br><span class="line"><span class="meta">@Repository</span> <span class="comment">//注解方式，交给spring持久层管理</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">UserDaoMybatisImpl</span> <span class="keyword">implements</span> <span class="title class_">UserDao</span> &#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">addUser</span><span class="params">()</span> &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;UserDaoMybatisImpl:添加成功&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div><div class="tab-pane" id="注解-4"><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- 引入context命名空间 --&gt;</span></span><br><span class="line"><span class="meta">&lt;?xml version=<span class="string">&quot;1.0&quot;</span> encoding=<span class="string">&quot;UTF-8&quot;</span>?&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">beans</span> <span class="attr">xmlns</span>=<span class="string">&quot;http://www.springframework.org/schema/beans&quot;</span></span></span><br><span class="line"><span class="tag">    <span class="attr">xmlns:xsi</span>=<span class="string">&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span></span></span><br><span class="line"><span class="tag">    <span class="attr">xmlns:context</span>=<span class="string">&quot;http://www.springframework.org/schema/context&quot;</span></span></span><br><span class="line"><span class="tag">    <span class="attr">xsi:schemaLocation</span>=<span class="string">&quot;http://www.springframework.org/schema/beans </span></span></span><br><span class="line"><span class="string"><span class="tag">        http://www.springframework.org/schema/beans/spring-beans.xsd</span></span></span><br><span class="line"><span class="string"><span class="tag">        http://www.springframework.org/schema/context </span></span></span><br><span class="line"><span class="string"><span class="tag">        http://www.springframework.org/schema/context/spring-context-4.0.xsd&quot;</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">&lt;!-- </span></span><br><span class="line"><span class="comment">        &lt;context:component-scan&gt;:扫描组件，对设置的包下面的类进行扫描，会将加上注解的类，作为spring的组件进行加载。</span></span><br><span class="line"><span class="comment">        作为spring的组件进行加载：会自动在spring的配置文件中生成相对应的bean，这些bean的id为类的首字母小写。</span></span><br><span class="line"><span class="comment">        &lt;context:include-filter&gt;:在设定的包结构下，再次通过注解annotation/类型assignable具体包含到某个或某几个类。</span></span><br><span class="line"><span class="comment">        注意：在使用包含时，一定要设置use-default-filters=&quot;false&quot;，将默认的过滤（即扫描包下所有的类）关闭。</span></span><br><span class="line"><span class="comment">        &lt;context:exclude-filter&gt;:在设定的包结构下，再次通过注解annotation/类型assignable排除某个或某几个类。</span></span><br><span class="line"><span class="comment">        注意：在使用排除时，一定要设置use-default-filters=&quot;true&quot;，将默认的过滤（即扫描包下所有的类）打开。</span></span><br><span class="line"><span class="comment">        切记：一个&lt;context:component-scan&gt;中可以出现多个include，也可以同时出现多个exclude，但是两个不能同时出现。</span></span><br><span class="line"><span class="comment">     --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">context:component-scan</span> <span class="attr">base-package</span>=<span class="string">&quot;com.example&quot;</span> <span class="attr">use-default-filters</span>=<span class="string">&quot;true&quot;</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!-- &lt;context:include-filter type=&quot;annotation&quot; expression=&quot;org.springframework.stereotype.Controller&quot;/&gt; --&gt;</span></span><br><span class="line">        <span class="comment">&lt;!-- &lt;context:include-filter type=&quot;assignable&quot; expression=&quot;com.example.service.UserServiceImpl&quot;/&gt; --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">context:exclude-filter</span> <span class="attr">type</span>=<span class="string">&quot;annotation&quot;</span> <span class="attr">expression</span>=<span class="string">&quot;org.springframework.stereotype.Repository&quot;</span>/&gt;</span></span><br><span class="line">        <span class="comment">&lt;!-- &lt;context:exclude-filter type=&quot;assignable&quot; expression=&quot;com.example.dao.UserDaoImpl&quot;/&gt; --&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">context:component-scan</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">beans</span>&gt;</span></span><br></pre></td></tr></table></figure></div><div class="tab-pane" id="注解-5"><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> org.springframework.context.ApplicationContext;</span><br><span class="line"><span class="keyword">import</span> org.springframework.context.support.ClassPathXmlApplicationContext;</span><br><span class="line"><span class="keyword">import</span> com.example.controller.UserController;</span><br><span class="line"><span class="keyword">import</span> com.example.dao.UserDao;</span><br><span class="line"><span class="keyword">import</span> com.example.dao.UserDaoImpl;<span class="comment">//实现类</span></span><br><span class="line"><span class="keyword">import</span> com.example.service.UserService;</span><br><span class="line"><span class="keyword">import</span> com.example.service.UserServiceImpl;<span class="comment">//实现类</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Test</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        <span class="type">ApplicationContext</span> <span class="variable">ac</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ClassPathXmlApplicationContext</span>(<span class="string">&quot;user.xml&quot;</span>);</span><br><span class="line">        <span class="type">UserController</span> <span class="variable">uc</span> <span class="operator">=</span> ac.getBean(<span class="string">&quot;aaa&quot;</span>, UserController.class);</span><br><span class="line">        System.out.println(uc);</span><br><span class="line">        <span class="type">UserService</span> <span class="variable">us</span> <span class="operator">=</span> ac.getBean(<span class="string">&quot;userServiceImpl&quot;</span>, UserServiceImpl.class);<span class="comment">//id为首字符小写</span></span><br><span class="line">        System.out.println(us);</span><br><span class="line">        <span class="type">UserDao</span> <span class="variable">ud</span> <span class="operator">=</span> ac.getBean(<span class="string">&quot;userDaoImpl&quot;</span>, UserDaoImpl.class);<span class="comment">//id为首字符小写</span></span><br><span class="line">        System.out.println(ud);</span><br><span class="line">        uc.addUser();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div></div></div></p>
<h2 id="aop">AOP</h2>
<p>概念：<strong>AOP（Aspect-Oriented
Programming，面向切面编程）、OOP(Object-Oriented
Programming，面向对象编程)。</strong><br />
术语：</p>
<p>1.AOP是一种新的方法论，是对传统OOP的补充，OOP是纵向继承机制，AOP横向抽取机制。<br />
2.AOP编程操作的主要对象是切面，而切面用于<strong>模块化横切关注点（公共功能）</strong>。<br />
3.在应用AOP编程时，仍然需要定义公共功能，但可以明确的定义这个功能应用在哪里，以什么方式应用，并且不必修改受影响的类。这样一来横切关注点就被模块化到特殊的类里，这样的类我们通常称之为“切面”。</p>
<p>AOP的优点：<br />
1.每个事物逻辑位于一个位置，代码不分散，便于维护和升级。<br />
2.业务模块更简洁，只包含核心业务代码。<br />
<img src="/images/Java/AOP.png" width="60%"></p>
<p>术语：<br />
1.横切关注点：从每个方法中抽取出来的同一类非核心业务（公共功能）。<br />
2.切面（Aspect）：封装公共功能（横切关注点信息）的类叫做切面。每个关注点体现为一个通知方法。<br />
3.通知（Advice）：类里面定义的公共方法叫做通知，切面必须要完成的各个具体工作。与横切关注点意思一致，只是在不同位置叫法不同。<br />
4.目标（Target）：被通知（被代理）的对象。<br />
5.代理（Proxy）：向目标对象应用通知之后创建的代理对象。<br />
6.连接点（Joinpoint）：横切关注点的具体体现，对应程序执行的某个特定位置。例如：类某个方法调用前、调用后、方法捕获到异常后等。<br />
7.切入点（pointcut）：定位连接点的方式。每个类的方法中都包含多个连接点，所以连接点是类中客观存在的事物。如果把连接点看作数据库中的记录，那么切入点就是查询条件——AOP可以通过切入点定位到特定的连接点。切点通过<code>org.springframework.aop.Pointcut</code>接口进行描述，它使用类和方法作为连接点的查询条件。</p>
<h3 id="一个示例">一个示例</h3>
<p>1.提出问题：写一个执行加减乘除运算，想要在此基础上增加日志功能，记录在程序执行期间追踪正在发生的活动。<br />
2.解决问题：增加日志，想到println方法，但这种方式会造成代码混乱和分散。<br />
3.优化问题：抽取日志功能，代理。<br />
<div class="tabs" id="aop"><ul class="nav-tabs"><li class="tab active"><a href="#aop-1">功能接口和实现类</a></li><li class="tab"><a href="#aop-2">代理</a></li><li class="tab"><a href="#aop-3">java使用</a></li></ul><div class="tab-content"><div class="tab-pane active" id="aop-1"><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//MathI.java</span></span><br><span class="line"><span class="keyword">package</span> com.example.proxy;</span><br><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">MathI</span> &#123;</span><br><span class="line">    <span class="type">int</span> <span class="title function_">add</span><span class="params">(<span class="type">int</span> i, <span class="type">int</span> j)</span>;</span><br><span class="line">    <span class="type">int</span> <span class="title function_">sub</span><span class="params">(<span class="type">int</span> i, <span class="type">int</span> j)</span>;</span><br><span class="line">    <span class="type">int</span> <span class="title function_">mul</span><span class="params">(<span class="type">int</span> i, <span class="type">int</span> j)</span>;</span><br><span class="line">    <span class="type">int</span> <span class="title function_">div</span><span class="params">(<span class="type">int</span> i, <span class="type">int</span> j)</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//MathImpl.java</span></span><br><span class="line"><span class="keyword">package</span> com.example.proxy;</span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">MathImpl</span> <span class="keyword">implements</span> <span class="title class_">MathI</span> &#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="type">int</span> <span class="title function_">add</span><span class="params">(<span class="type">int</span> i, <span class="type">int</span> j)</span> &#123;</span><br><span class="line">        <span class="comment">// System.out.println(&quot;method:add,arguments:&quot;+i+&quot;,&quot;+j);</span></span><br><span class="line">        <span class="type">int</span> <span class="variable">result</span> <span class="operator">=</span> i + j;</span><br><span class="line">        <span class="comment">// System.out.println(&quot;method:add,result:&quot;+result);</span></span><br><span class="line">        <span class="keyword">return</span> result;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="type">int</span> <span class="title function_">sub</span><span class="params">(<span class="type">int</span> i, <span class="type">int</span> j)</span> &#123;</span><br><span class="line">        <span class="comment">// System.out.println(&quot;method:sub,arguments:&quot;+i+&quot;,&quot;+j);</span></span><br><span class="line">        <span class="type">int</span> <span class="variable">result</span> <span class="operator">=</span> i - j;</span><br><span class="line">        <span class="comment">// System.out.println(&quot;method:sub,result:&quot;+result);</span></span><br><span class="line">        <span class="keyword">return</span> result;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="type">int</span> <span class="title function_">mul</span><span class="params">(<span class="type">int</span> i, <span class="type">int</span> j)</span> &#123;</span><br><span class="line">        <span class="comment">// System.out.println(&quot;method:mul,arguments:&quot;+i+&quot;,&quot;+j);</span></span><br><span class="line">        <span class="type">int</span> <span class="variable">result</span> <span class="operator">=</span> i * j;</span><br><span class="line">        <span class="comment">// System.out.println(&quot;method:mul,result:&quot;+result);</span></span><br><span class="line">        <span class="keyword">return</span> result;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="type">int</span> <span class="title function_">div</span><span class="params">(<span class="type">int</span> i, <span class="type">int</span> j)</span> &#123;</span><br><span class="line">        <span class="comment">// System.out.println(&quot;method:div,arguments:&quot;+i+&quot;,&quot;+j);</span></span><br><span class="line">        <span class="type">int</span> <span class="variable">result</span> <span class="operator">=</span> i / j;</span><br><span class="line">        <span class="comment">// System.out.println(&quot;method:div,result:&quot;+result);</span></span><br><span class="line">        <span class="keyword">return</span> result;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div><div class="tab-pane" id="aop-2"><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//CalucatorLoggingHandler.java</span></span><br><span class="line"><span class="keyword">package</span> com.example.proxy;</span><br><span class="line"><span class="keyword">import</span> java.lang.reflect.InvocationHandler;</span><br><span class="line"><span class="keyword">import</span> java.lang.reflect.Method;</span><br><span class="line"><span class="keyword">import</span> java.lang.reflect.Proxy;</span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">CalucatorLoggingHandler</span> <span class="keyword">implements</span> <span class="title class_">InvocationHandler</span>&#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="type">Log</span> <span class="variable">log</span> <span class="operator">=</span> LogFactory.getLog(<span class="built_in">this</span>.getClass());</span><br><span class="line">    <span class="keyword">private</span> Object target; <span class="comment">//Object可以代理任何对象</span></span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">CalucatorLoggingHandler</span><span class="params">(Object target)</span><span class="params">(</span></span><br><span class="line"><span class="params">        <span class="built_in">super</span>()</span>;</span><br><span class="line">        <span class="built_in">this</span>.target = target;</span><br><span class="line">    )</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> Object <span class="title function_">invoke</span><span class="params">(Object proxy, Method method, Object[] args)</span> <span class="keyword">throws</span> Throwable &#123;</span><br><span class="line">        log.info(<span class="string">&quot;The method &quot;</span> + method.getName() + <span class="string">&quot;() begins with &quot;</span> + Arrays.toString(args));</span><br><span class="line">        <span class="type">Object</span> <span class="variable">result</span> <span class="operator">=</span> method.invoke(target, args);</span><br><span class="line">        log.info(<span class="string">&quot;The method &quot;</span> + method.getName() + <span class="string">&quot;() ends with &quot;</span> + result);</span><br><span class="line">        <span class="keyword">return</span> result;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> Object <span class="title function_">createProxy</span><span class="params">(Object target)</span> &#123;</span><br><span class="line">        <span class="type">ClassLoader</span> <span class="variable">loader</span> <span class="operator">=</span> target.getClass().getClassLoader();</span><br><span class="line">        Class[] interfaces = target.getClass().getInterfaces();</span><br><span class="line">        <span class="comment">//JDK中的代理方式</span></span><br><span class="line">        <span class="keyword">return</span> Proxy.newProxyInstance(loader, interfaces, <span class="keyword">new</span> <span class="title class_">CalucatorLoggingHandler</span>(target));</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div><div class="tab-pane" id="aop-3"><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//Test.java</span></span><br><span class="line"><span class="keyword">package</span> com.example.proxy;</span><br><span class="line"><span class="keyword">import</span> com.example.CalucatorLoggingHandler;</span><br><span class="line"><span class="keyword">import</span> com.example.MathImpl;</span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Test</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        <span class="type">MathI</span> <span class="variable">mathimpl</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">MathImpl</span>();</span><br><span class="line">        <span class="comment">//返回的类型要强转为接口，因为只能代理接口中方法。</span></span><br><span class="line">        <span class="type">MathI</span> <span class="variable">mathi</span> <span class="operator">=</span> <span class="keyword">new</span> (MathI) CalucatorLoggingHandler.createProxy(mathimpl);</span><br><span class="line">        System.out.println(mathi.add(-<span class="number">12</span>,<span class="number">13</span>));</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div></div></div></p>
<h3 id="aspectj">AspectJ</h3>
<p>AspectJ：Java社区里最完整最流行的AOP框架。<br />
AspectJ支持5种类型的通知注解：<br />
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Before</span>：前置通知，在方法执行之前执行。</span><br><span class="line"><span class="meta">@After</span>：后置通知，在方法执行之后执行。</span><br><span class="line"><span class="meta">@AfterRunning</span>：返回通知，在方法返回结果之后执行。</span><br><span class="line"><span class="meta">@AfterThrowing</span>：异常通知，在方法抛出异常之后执行。</span><br><span class="line"><span class="meta">@Around</span>：环绕通知，围绕着方法执行。</span><br></pre></td></tr></table></figure></p>
<p>使用前准备：<br />
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//导入JAR包</span></span><br><span class="line">com.springsource.net.sf.cglib-<span class="number">2.2</span><span class="number">.0</span>.jar</span><br><span class="line">com.springsource.org.aopalliance-<span class="number">1.0</span><span class="number">.0</span>.jar</span><br><span class="line">com.springsource.org.aspectj.weaver-<span class="number">1.6</span><span class="number">.8</span>.RELEASE.jar </span><br><span class="line">spring-aop-<span class="number">4.0</span><span class="number">.0</span>.RELEASE.jar</span><br><span class="line">spring-aspects-<span class="number">4.0</span><span class="number">.0</span>.RELEASE.jar</span><br><span class="line"><span class="comment">//引入aop名称空间</span></span><br><span class="line">xmlns:aop=<span class="string">&quot;http://www.springframework.org/schema/aop&quot;</span></span><br><span class="line"><span class="comment">//bean配置</span></span><br><span class="line">&lt;aop:aspectj-autoproxy&gt;：当Spring侦测到bean配置文件中的该标签时，会自动为与AspectJ切面匹配的bean创建代理。</span><br></pre></td></tr></table></figure></p>
<p>1.前面示例的改进写法（Java类方式）：<br />
<div class="tabs" id="aop_new"><ul class="nav-tabs"><li class="tab active"><a href="#aop_new-1">功能接口和实现类</a></li><li class="tab"><a href="#aop_new-2">AspectJ配置</a></li><li class="tab"><a href="#aop_new-3">切面类（5种注解）</a></li><li class="tab"><a href="#aop_new-4">java使用</a></li></ul><div class="tab-content"><div class="tab-pane active" id="aop_new-1"><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//MathI.java</span></span><br><span class="line"><span class="keyword">package</span> com.example.aop;</span><br><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">MathI</span> &#123;</span><br><span class="line">    <span class="type">int</span> <span class="title function_">add</span><span class="params">(<span class="type">int</span> i, <span class="type">int</span> j)</span>;</span><br><span class="line">    <span class="type">int</span> <span class="title function_">sub</span><span class="params">(<span class="type">int</span> i, <span class="type">int</span> j)</span>;</span><br><span class="line">    <span class="type">int</span> <span class="title function_">mul</span><span class="params">(<span class="type">int</span> i, <span class="type">int</span> j)</span>;</span><br><span class="line">    <span class="type">int</span> <span class="title function_">div</span><span class="params">(<span class="type">int</span> i, <span class="type">int</span> j)</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//MathImpl.java</span></span><br><span class="line"><span class="keyword">package</span> com.example.aop;</span><br><span class="line"><span class="keyword">import</span> org.springframework.stereotype.Component;</span><br><span class="line"><span class="meta">@Component</span><span class="comment">//需注入Spring组件管理</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">MathImpl</span> <span class="keyword">implements</span> <span class="title class_">MathI</span> &#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="type">int</span> <span class="title function_">add</span><span class="params">(<span class="type">int</span> i, <span class="type">int</span> j)</span> &#123;</span><br><span class="line">        <span class="type">int</span> <span class="variable">result</span> <span class="operator">=</span> i + j;</span><br><span class="line">        <span class="keyword">return</span> result;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="type">int</span> <span class="title function_">sub</span><span class="params">(<span class="type">int</span> i, <span class="type">int</span> j)</span> &#123;</span><br><span class="line">        <span class="type">int</span> <span class="variable">result</span> <span class="operator">=</span> i - j;</span><br><span class="line">        <span class="keyword">return</span> result;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="type">int</span> <span class="title function_">mul</span><span class="params">(<span class="type">int</span> i, <span class="type">int</span> j)</span> &#123;</span><br><span class="line">        <span class="type">int</span> <span class="variable">result</span> <span class="operator">=</span> i * j;</span><br><span class="line">        <span class="keyword">return</span> result;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="type">int</span> <span class="title function_">div</span><span class="params">(<span class="type">int</span> i, <span class="type">int</span> j)</span> &#123;</span><br><span class="line">        <span class="type">int</span> <span class="variable">result</span> <span class="operator">=</span> i / j;</span><br><span class="line">        <span class="keyword">return</span> result;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div><div class="tab-pane" id="aop_new-2"><figure class="highlight xml"><figcaption><span>aop.xml</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version=<span class="string">&quot;1.0&quot;</span> encoding=<span class="string">&quot;UTF-8&quot;</span>?&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">beans</span> <span class="attr">xmlns</span>=<span class="string">&quot;http://www.springframework.org/schema/beans&quot;</span></span></span><br><span class="line"><span class="tag">    <span class="attr">xmlns:xsi</span>=<span class="string">&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span></span></span><br><span class="line"><span class="tag">    <span class="attr">xmlns:aop</span>=<span class="string">&quot;http://www.springframework.org/schema/aop&quot;</span></span></span><br><span class="line"><span class="tag">    <span class="attr">xmlns:context</span>=<span class="string">&quot;http://www.springframework.org/schema/context&quot;</span></span></span><br><span class="line"><span class="tag">    <span class="attr">xsi:schemaLocation</span>=<span class="string">&quot;http://www.springframework.org/schema/beans </span></span></span><br><span class="line"><span class="string"><span class="tag">        http://www.springframework.org/schema/beans/spring-beans.xsd</span></span></span><br><span class="line"><span class="string"><span class="tag">        http://www.springframework.org/schema/context </span></span></span><br><span class="line"><span class="string"><span class="tag">        http://www.springframework.org/schema/context/spring-context-4.0.xsd</span></span></span><br><span class="line"><span class="string"><span class="tag">        http://www.springframework.org/schema/aop </span></span></span><br><span class="line"><span class="string"><span class="tag">        http://www.springframework.org/schema/aop/spring-aop-4.0.xsd&quot;</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">context:component-scan</span> <span class="attr">base-package</span>=<span class="string">&quot;com.example.aop&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">context:component-scan</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- 开启aspectJ的自动代理功能 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">aop:aspectj-autoproxy</span> /&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">beans</span>&gt;</span></span><br></pre></td></tr></table></figure></div><div class="tab-pane" id="aop_new-3"><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//MyloggerAspect.java</span></span><br><span class="line"><span class="keyword">package</span> com.example.aop;</span><br><span class="line"><span class="keyword">import</span> java.util.Arrays;</span><br><span class="line"><span class="keyword">import</span> org.aspectj.lang.JoinPoint;</span><br><span class="line"><span class="keyword">import</span> org.aspectj.lang.ProceedingJoinPoint;</span><br><span class="line"><span class="keyword">import</span> org.aspectj.lang.annotation.After;</span><br><span class="line"><span class="keyword">import</span> org.aspectj.lang.annotation.AfterReturning;</span><br><span class="line"><span class="keyword">import</span> org.aspectj.lang.annotation.AfterThrowing;</span><br><span class="line"><span class="keyword">import</span> org.aspectj.lang.annotation.Around;</span><br><span class="line"><span class="keyword">import</span> org.aspectj.lang.annotation.Aspect;</span><br><span class="line"><span class="keyword">import</span> org.aspectj.lang.annotation.Before;</span><br><span class="line"><span class="keyword">import</span> org.aspectj.lang.annotation.Pointcut;</span><br><span class="line"><span class="keyword">import</span> org.springframework.core.annotation.Order;</span><br><span class="line"><span class="keyword">import</span> org.springframework.stereotype.Component;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Component</span><span class="comment">//把切面类注入到Spring组件（不然bean中无此类）</span></span><br><span class="line"><span class="meta">@Order(0)</span><span class="comment">//定义切面作用的优先级，值越小优先级越高，默认值为int的最大值（多个Aspect类时使用）</span></span><br><span class="line"><span class="meta">@Aspect</span><span class="comment">//标注当前类为切面</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">MyloggerAspect</span> &#123;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     *<span class="doctag">@Pointcut</span>：公共切入点。</span></span><br><span class="line"><span class="comment">     1.需作用在一个空方法上，5种注解使用时只需写&quot;方法名()&quot;。</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Pointcut(value=&quot;execution(* com.example.aop.*.*(..))&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">test</span><span class="params">()</span> &#123;&#125;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@Before</span>：将方法指定为前置通知，作用于方法执行之前。</span></span><br><span class="line"><span class="comment">     * 1.必须设置value，其值为切入点表达式：<span class="doctag">@Before</span>(value=&quot;execution(* com.example.aop.*.*(..))&quot;)</span></span><br><span class="line"><span class="comment">     * 第一个*代表任意的访问修饰符和返回值类型。</span></span><br><span class="line"><span class="comment">     * 第二个*代表任意类。</span></span><br><span class="line"><span class="comment">     * 第三个*代表类中任意方法。</span></span><br><span class="line"><span class="comment">     * ..代表任意的参数列表。</span></span><br><span class="line"><span class="comment">     * 2.被代理的方法的信息，可通过joinPoint获取：</span></span><br><span class="line"><span class="comment">     * getArgs()：获取方法的参数。</span></span><br><span class="line"><span class="comment">     * getSignature().getName()：获取方法名。</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Before(value=&quot;test()&quot;)</span></span><br><span class="line">    <span class="comment">//@Before(value=&quot;execution(public int com.example.aop.MathImpl.add(int, int))&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">beforeMethod</span><span class="params">(JoinPoint joinPoint)</span> &#123;</span><br><span class="line">        Object[] args = joinPoint.getArgs();<span class="comment">//获取方法的参数</span></span><br><span class="line">        <span class="type">String</span> <span class="variable">methodName</span> <span class="operator">=</span> joinPoint.getSignature().getName();<span class="comment">//获取方法名</span></span><br><span class="line">        System.out.println(<span class="string">&quot;method:&quot;</span>+methodName+<span class="string">&quot;,arguments:&quot;</span>+Arrays.toString(args));</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@AfterReturning</span>：将方法标注为返回通知，作用于方法执行之后。</span></span><br><span class="line"><span class="comment">     * 1.可通过参数returning设置接收方法返回值的变量名。</span></span><br><span class="line"><span class="comment">     * 2.要想在方法中使用，必须在方法的形参中设置和变量名相同的参数名的参数。</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@AfterReturning(value=&quot;test()&quot;, returning=&quot;result&quot;)</span></span><br><span class="line">    <span class="comment">//@AfterReturning(value=&quot;execution(* com.example.aop.*.*(..))&quot;, returning=&quot;result&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">afterReturningMethod</span><span class="params">(JoinPoint joinPoint, Object result)</span> &#123;</span><br><span class="line">        <span class="type">String</span> <span class="variable">methodName</span> <span class="operator">=</span> joinPoint.getSignature().getName();</span><br><span class="line">        System.out.println(<span class="string">&quot;method:&quot;</span>+methodName+<span class="string">&quot;,result:&quot;</span>+result);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@AfterThrowing</span>：将方法标注为异常通知（例外通知），作用于方法抛出异常时。</span></span><br><span class="line"><span class="comment">     * 1.可通过参数throwing设置接收方法返回的异常信息。</span></span><br><span class="line"><span class="comment">     * 2.在参数列表中课通过具体的异常类型，来对指定的异常信息进行操作。</span></span><br><span class="line"><span class="comment">     * 3.注意！AfterThrowing只会处理和设置的ex类型一样的异常，其他异常不会处理，可通过设定异常类型处理指定类型的异常。</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@AfterThrowing(value=&quot;test()&quot;, throwing=&quot;ex&quot;)</span></span><br><span class="line">    <span class="comment">//@AfterThrowing(value=&quot;execution(* com.example.aop.*.*(..))&quot;, throwing=&quot;ex&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">afterThrowingMethod</span><span class="params">(ArithmeticException ex)</span> &#123;<span class="comment">//只会处理ArithmeticException类型异常</span></span><br><span class="line">        System.out.println(<span class="string">&quot;有异常了，messages：&quot;</span>+ex);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@After</span>：将方法标注为后置通知。</span></span><br><span class="line"><span class="comment">     * 后置通知：作用于方法的finally语句块，即不管有没有异常都会执行。</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@After(value=&quot;test()&quot;)</span></span><br><span class="line">    <span class="comment">//@After(value=&quot;execution(* com.example.aop.*.*(..))&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">afterMethod</span><span class="params">()</span> &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;后置通知&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@Around</span>：环绕通知，类似原生代理写法。</span></span><br><span class="line"><span class="comment">     * 1.连接点的参数类型必须是ProceedingJoinPoint，它是JoinPoint的子接口，允许控制何时执行，是否执行连接点。</span></span><br><span class="line"><span class="comment">     * 2.可通过ProceedingJoinPoint的proceed方法来执行被代理的方法，相当于原生代理方法invoke。</span></span><br><span class="line"><span class="comment">     * 3.需要有return返回proceed方法结果，否则会出现空指针异。</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Around(value=&quot;execution(* com.example.aop.*.*(..))&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> Object <span class="title function_">aroundMethod</span><span class="params">(ProceedingJoinPoint joinPoint)</span> &#123;</span><br><span class="line">        <span class="type">Object</span> <span class="variable">result</span> <span class="operator">=</span> <span class="literal">null</span>;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="comment">//此位置，为前置通知</span></span><br><span class="line">            System.out.println(<span class="string">&quot;前置通知&quot;</span>);</span><br><span class="line">            result = joinPoint.proceed();<span class="comment">//执行方法</span></span><br><span class="line">            <span class="comment">//此位置，为返回通知</span></span><br><span class="line">            System.out.println(<span class="string">&quot;返回通知&quot;</span>);</span><br><span class="line">            <span class="keyword">return</span> result;<span class="comment">//返回结果</span></span><br><span class="line">        &#125; <span class="keyword">catch</span> (Throwable e) &#123;</span><br><span class="line">            <span class="comment">//此位置，为异常通知</span></span><br><span class="line">            e.printStackTrace();</span><br><span class="line">            System.out.println(<span class="string">&quot;异常通知&quot;</span>);</span><br><span class="line">        &#125; <span class="keyword">finally</span> &#123;</span><br><span class="line">            <span class="comment">//此位置，为后置通知</span></span><br><span class="line">            System.out.println(<span class="string">&quot;后置通知&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> -<span class="number">1</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div><div class="tab-pane" id="aop_new-4"><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> org.springframework.context.ApplicationContext;</span><br><span class="line"><span class="keyword">import</span> org.springframework.context.support.ClassPathXmlApplicationContext;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Test</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        <span class="type">ApplicationContext</span> <span class="variable">ac</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ClassPathXmlApplicationContext</span>(<span class="string">&quot;aop.xml&quot;</span>);</span><br><span class="line">        <span class="type">MathI</span> <span class="variable">math</span> <span class="operator">=</span> ac.getBean(<span class="string">&quot;mathImpl&quot;</span>, MathI.class);<span class="comment">//id为类名首字母小写，参数为接口类MathI</span></span><br><span class="line">        System.out.println(math.getClass().getName());</span><br><span class="line">        <span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> math.div(<span class="number">4</span>, <span class="number">1</span>);<span class="comment">//测试前置方法</span></span><br><span class="line">        System.out.println(i);</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div></div></div></p>
<p>2.前面示例的改进写法（xml方式）：<br />
<div class="tabs" id="xml"><ul class="nav-tabs"><li class="tab active"><a href="#xml-1">功能接口和实现类</a></li><li class="tab"><a href="#xml-2">AspectJ配置</a></li><li class="tab"><a href="#xml-3">切面类</a></li><li class="tab"><a href="#xml-4">java使用</a></li></ul><div class="tab-content"><div class="tab-pane active" id="xml-1"><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//MathI.java</span></span><br><span class="line"><span class="keyword">package</span> com.example.aopxml;</span><br><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">MathI</span> &#123;</span><br><span class="line">    <span class="type">int</span> <span class="title function_">add</span><span class="params">(<span class="type">int</span> i, <span class="type">int</span> j)</span>;</span><br><span class="line">    <span class="type">int</span> <span class="title function_">sub</span><span class="params">(<span class="type">int</span> i, <span class="type">int</span> j)</span>;</span><br><span class="line">    <span class="type">int</span> <span class="title function_">mul</span><span class="params">(<span class="type">int</span> i, <span class="type">int</span> j)</span>;</span><br><span class="line">    <span class="type">int</span> <span class="title function_">div</span><span class="params">(<span class="type">int</span> i, <span class="type">int</span> j)</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//MathImpl.java</span></span><br><span class="line"><span class="keyword">package</span> com.example.aopxml;</span><br><span class="line"><span class="keyword">import</span> org.springframework.stereotype.Component;</span><br><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">MathImpl</span> <span class="keyword">implements</span> <span class="title class_">MathI</span> &#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="type">int</span> <span class="title function_">add</span><span class="params">(<span class="type">int</span> i, <span class="type">int</span> j)</span> &#123;</span><br><span class="line">        <span class="type">int</span> <span class="variable">result</span> <span class="operator">=</span> i + j;</span><br><span class="line">        <span class="keyword">return</span> result;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="type">int</span> <span class="title function_">sub</span><span class="params">(<span class="type">int</span> i, <span class="type">int</span> j)</span> &#123;</span><br><span class="line">        <span class="type">int</span> <span class="variable">result</span> <span class="operator">=</span> i - j;</span><br><span class="line">        <span class="keyword">return</span> result;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="type">int</span> <span class="title function_">mul</span><span class="params">(<span class="type">int</span> i, <span class="type">int</span> j)</span> &#123;</span><br><span class="line">        <span class="type">int</span> <span class="variable">result</span> <span class="operator">=</span> i * j;</span><br><span class="line">        <span class="keyword">return</span> result;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="type">int</span> <span class="title function_">div</span><span class="params">(<span class="type">int</span> i, <span class="type">int</span> j)</span> &#123;</span><br><span class="line">        <span class="type">int</span> <span class="variable">result</span> <span class="operator">=</span> i / j;</span><br><span class="line">        <span class="keyword">return</span> result;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div><div class="tab-pane" id="xml-2"><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version=<span class="string">&quot;1.0&quot;</span> encoding=<span class="string">&quot;UTF-8&quot;</span>?&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">beans</span> <span class="attr">xmlns</span>=<span class="string">&quot;http://www.springframework.org/schema/beans&quot;</span></span></span><br><span class="line"><span class="tag">    <span class="attr">xmlns:xsi</span>=<span class="string">&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span></span></span><br><span class="line"><span class="tag">    <span class="attr">xmlns:aop</span>=<span class="string">&quot;http://www.springframework.org/schema/aop&quot;</span></span></span><br><span class="line"><span class="tag">    <span class="attr">xmlns:context</span>=<span class="string">&quot;http://www.springframework.org/schema/context&quot;</span></span></span><br><span class="line"><span class="tag">    <span class="attr">xsi:schemaLocation</span>=<span class="string">&quot;http://www.springframework.org/schema/beans </span></span></span><br><span class="line"><span class="string"><span class="tag">        http://www.springframework.org/schema/beans/spring-beans.xsd</span></span></span><br><span class="line"><span class="string"><span class="tag">        http://www.springframework.org/schema/context </span></span></span><br><span class="line"><span class="string"><span class="tag">        http://www.springframework.org/schema/context/spring-context-4.0.xsd</span></span></span><br><span class="line"><span class="string"><span class="tag">        http://www.springframework.org/schema/aop </span></span></span><br><span class="line"><span class="string"><span class="tag">        http://www.springframework.org/schema/aop/spring-aop-4.0.xsd&quot;</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">context:component-scan</span> <span class="attr">base-package</span>=<span class="string">&quot;com.example.aopxml&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">context:component-scan</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- </span></span><br><span class="line"><span class="comment">        需要配置：切面（公共方法的类）、切入点（被代理方法）、通知（公共方法）。</span></span><br><span class="line"><span class="comment">        1.一个切面创建一个&lt;aop:aspect&gt;，id可以不写，但ref必须写（指定bean的id、定义的切面）。</span></span><br><span class="line"><span class="comment">        2.常用注释标签：&lt;aop:before&gt;、&lt;aop:after-returning&gt;、&lt;aop:after-throwing&gt;、&lt;aop:after&gt;、&lt;aop:around&gt;</span></span><br><span class="line"><span class="comment">        3.可直接使用：参数method（需和公共方法名一致） + 参数pointcut + 注释标签。</span></span><br><span class="line"><span class="comment">        4.可先配置&lt;aop:pointcut&gt;，再使用参数pointcut-ref指定切入点...。</span></span><br><span class="line"><span class="comment">    --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">aop:config</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">aop:aspect</span> <span class="attr">id</span>=<span class="string">&quot;loggingAspect&quot;</span> <span class="attr">ref</span>=<span class="string">&quot;myLogger&quot;</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">aop:pointcut</span> <span class="attr">id</span>=<span class="string">&quot;cut&quot;</span> <span class="attr">expression</span>=<span class="string">&quot;execution(* com.example.aopxml.*.*(..))&quot;</span> /&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">aop:before</span> <span class="attr">method</span>=<span class="string">&quot;before&quot;</span> <span class="attr">pointcut-ref</span>=<span class="string">&quot;cut&quot;</span>/&gt;</span></span><br><span class="line">            <span class="comment">&lt;!-- &lt;aop:before method=&quot;before&quot; pointcut=&quot;execution(* com.example.aopxml.*.*(..))&quot;/&gt; --&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">aop:aspect</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">aop:config</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">beans</span>&gt;</span></span><br></pre></td></tr></table></figure></div><div class="tab-pane" id="xml-3"><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//MyLogger.java</span></span><br><span class="line"><span class="keyword">package</span> com.example.aopxml;</span><br><span class="line"><span class="keyword">import</span> org.springframework.stereotype.Component;</span><br><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">MyLogger</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">before</span><span class="params">()</span> &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;前置通知&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div><div class="tab-pane" id="xml-4"><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.example.aopxml;</span><br><span class="line"><span class="keyword">import</span> org.springframework.context.ApplicationContext;</span><br><span class="line"><span class="keyword">import</span> org.springframework.context.support.ClassPathXmlApplicationContext;</span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Test</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        <span class="type">ApplicationContext</span> <span class="variable">ac</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ClassPathXmlApplicationContext</span>(<span class="string">&quot;aop-xml.xml&quot;</span>);</span><br><span class="line">        <span class="type">MathI</span> <span class="variable">math</span> <span class="operator">=</span> ac.getBean(<span class="string">&quot;mathImpl&quot;</span>, MathI.class);</span><br><span class="line">        <span class="type">int</span> <span class="variable">add</span> <span class="operator">=</span> math.add(<span class="number">12</span>, <span class="number">12</span>);</span><br><span class="line">        System.out.println(add);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div></div></div></p>
<h2 id="springmvc">SpringMVC</h2>
<p>SpringMVC是一种轻量级的、基于MVC的Web层应用框架。偏前端而不是基于业务逻辑层。是Spring框架的一个后续产品。<br />
SpringMVC天生与Spring框架集成（IOC、AOP），支持Restful风格，支持灵活的URL到页面控制器的映射等等。<br />
SpringMVC通过一套MVC注解，让POJO（Plain Old Java
Object，原始Java对象）成为处理请求的控制器，而无须实现任何接口。</p>
<p>常用组件：<br />
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">|-DispatcherServlet：前端控制器。</span><br><span class="line">|-Controller：处理器/页面控制器，做的是MVC中的C的事情，但控制逻辑转移到前端控制器了，用于对请求进行处理。</span><br><span class="line">|-HandlerMapping：请求映射到处理器，找谁来处理。</span><br><span class="line">    |-如果映射成功返回一个HandlerExecutionChain对象（包含一个Handler处理器(页面控制器)对象、多个HandlerInterceptor拦截器对象）。</span><br><span class="line">|-View Resolver: 视图解析器，找谁来处理返回的页面。把逻辑视图解析为具体的View,进行这种策略模式，很容易更换其他视图技术；</span><br><span class="line">    |-比如，InternalResourceViewResolver将逻辑视图名映射为JSP视图。</span><br><span class="line">|-LocalResolver：本地化、国际化。</span><br><span class="line">|-MultipartResolver：文件上传解析器。</span><br><span class="line">|-HandlerExceptionResolver：异常处理器。</span><br></pre></td></tr></table></figure></p>
<p>SpringMVC运行流程图：<br />
<img src="/images/Java/SpringMVC运行流程图.png" width="60%"></p>
<h3 id="项目示例">项目示例</h3>
<p>请求流程图：<br />
<img src="/images/Java/请求流程图.png" width="60%"></p>
<p>1.新建Web工程，lib目录下加入jar包：<br />
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">spring-aop-<span class="number">4.0</span><span class="number">.0</span>.RELEASE.jar</span><br><span class="line">spring-beans-<span class="number">4.0</span><span class="number">.0</span>.RELEASE.jar</span><br><span class="line">spring-context-<span class="number">4.0</span><span class="number">.0</span>.RELEASE.jar</span><br><span class="line">spring-core-<span class="number">4.0</span><span class="number">.0</span>.RELEASE.jar</span><br><span class="line">spring-expression-<span class="number">4.0</span><span class="number">.0</span>.RELEASE.jar</span><br><span class="line">commons-logging-<span class="number">1.1</span><span class="number">.3</span>.jar</span><br><span class="line">spring-web-<span class="number">4.0</span><span class="number">.0</span>.RELEASE.jar</span><br><span class="line">spring-webmvc-<span class="number">4.0</span><span class="number">.0</span>.RELEASE.jar</span><br></pre></td></tr></table></figure></p>
<p>DispatcherServlet是用于<strong>拦截匹配请求</strong>的前置控制器，配置在web.xml文件中。拦截匹配<strong>规则要自己定义</strong>，把拦截下来的请求，依据相应的规则分发到目标Controller来处理，是配置springMVC的第一步。<br />
2.在web.xml中配置SpringMVC的核心（前端）控制器DispatcherServlet，指定SpringMVC的配置文件springmvc.xml：<br />
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- WebContent/WEB-INF/web.xml --&gt;</span></span><br><span class="line"><span class="meta">&lt;?xml version=<span class="string">&quot;1.0&quot;</span> encoding=<span class="string">&quot;UTF-8&quot;</span>?&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">web-app</span> <span class="attr">xmlns:xsi</span>=<span class="string">&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span> </span></span><br><span class="line"><span class="tag">         <span class="attr">xmlns</span>=<span class="string">&quot;http://java.sun.com/xml/ns/javaee&quot;</span> </span></span><br><span class="line"><span class="tag">         <span class="attr">xsi:schemaLocation</span>=<span class="string">&quot;http://java.sun.com/xml/ns/javaee </span></span></span><br><span class="line"><span class="string"><span class="tag">            http://java.sun.com/xml/ns/javaee/web-app_2_5.xsd&quot;</span> <span class="attr">id</span>=<span class="string">&quot;WebApp_ID&quot;</span> <span class="attr">version</span>=<span class="string">&quot;2.5&quot;</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">display-name</span>&gt;</span>SpringMVC<span class="tag">&lt;/<span class="name">display-name</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">welcome-file-list</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">welcome-file</span>&gt;</span>index.jsp<span class="tag">&lt;/<span class="name">welcome-file</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">welcome-file-list</span>&gt;</span></span><br><span class="line">  <span class="comment">&lt;!-- 编码过滤器一定放在首位，缓冲问题导致 --&gt;</span></span><br><span class="line">  <span class="comment">&lt;!-- 设置编码过滤器防止接收中文等乱码 --&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">filter</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">filter-name</span>&gt;</span>CharacterEncodingFilter<span class="tag">&lt;/<span class="name">filter-name</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">filter-class</span>&gt;</span>org.springframework.web.filter.CharacterEncodingFilter<span class="tag">&lt;/<span class="name">filter-class</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">init-param</span>&gt;</span></span><br><span class="line">          <span class="tag">&lt;<span class="name">param-name</span>&gt;</span>encoding<span class="tag">&lt;/<span class="name">param-name</span>&gt;</span></span><br><span class="line">          <span class="tag">&lt;<span class="name">param-value</span>&gt;</span>UTF-8<span class="tag">&lt;/<span class="name">param-value</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;/<span class="name">init-param</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">filter</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">filter-mapping</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">filter-name</span>&gt;</span>CharacterEncodingFilter<span class="tag">&lt;/<span class="name">filter-name</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">url-pattern</span>&gt;</span>/*<span class="tag">&lt;/<span class="name">url-pattern</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">filter-mapping</span>&gt;</span></span><br><span class="line">  <span class="comment">&lt;!-- Rest风格控制，支持客户端POST转为PUT、DELETE --&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">filter</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">filter-name</span>&gt;</span>HiddenHttpMethodFilter<span class="tag">&lt;/<span class="name">filter-name</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">filter-class</span>&gt;</span>org.springframework.web.filter.HiddenHttpMethodFilter<span class="tag">&lt;/<span class="name">filter-class</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">filter</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">filter-mapping</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">filter-name</span>&gt;</span>HiddenHttpMethodFilter<span class="tag">&lt;/<span class="name">filter-name</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">url-pattern</span>&gt;</span>/*<span class="tag">&lt;/<span class="name">url-pattern</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">filter-mapping</span>&gt;</span></span><br><span class="line">  <span class="comment">&lt;!-- 配置SpringMVC核心控制器： --&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">servlet</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">servlet-name</span>&gt;</span>springDispatcherServlet<span class="tag">&lt;/<span class="name">servlet-name</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">servlet-class</span>&gt;</span>org.springframework.web.servlet.DispatcherServlet<span class="tag">&lt;/<span class="name">servlet-class</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">init-param</span>&gt;</span></span><br><span class="line">      <span class="comment">&lt;!-- 配置DispatcherServlet的初始化參數：设置文件的路径、文件名称 --&gt;</span></span><br><span class="line">      <span class="comment">&lt;!-- 默认配置文件路径: WebContent/WEB-INF/&lt;servlet-name&gt;-servlet.xml --&gt;</span></span><br><span class="line">      <span class="comment">&lt;!-- 这里配置文件路径改成：conf/springmvc.xml，WebContent和conf同级别 --&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">param-name</span>&gt;</span>contextConfigLocation<span class="tag">&lt;/<span class="name">param-name</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">param-value</span>&gt;</span>classpath:springmvc.xml<span class="tag">&lt;/<span class="name">param-value</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">init-param</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- 设置servlet的加载时间，默认无此标签为第一次访问时加载，有此标签时会将加载时间提前到项目启动时 --&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- 标签中为正整数才有效，值越小优先级越高 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">load-on-startup</span>&gt;</span>1<span class="tag">&lt;/<span class="name">load-on-startup</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">servlet</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">servlet-mapping</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">servlet-name</span>&gt;</span>springDispatcherServlet<span class="tag">&lt;/<span class="name">servlet-name</span>&gt;</span></span><br><span class="line">  <span class="comment">&lt;!-- 一般设置为/ --&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">url-pattern</span>&gt;</span>/<span class="tag">&lt;/<span class="name">url-pattern</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">servlet-mapping</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">web-app</span>&gt;</span></span><br></pre></td></tr></table></figure></p>
<p>3.新增SpringMVC的配置文件springmvc.xml：<br />
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- conf/springmvc.xml --&gt;</span></span><br><span class="line"><span class="meta">&lt;?xml version=<span class="string">&quot;1.0&quot;</span> encoding=<span class="string">&quot;UTF-8&quot;</span>?&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">beans</span> <span class="attr">xmlns</span>=<span class="string">&quot;http://www.springframework.org/schema/beans&quot;</span></span></span><br><span class="line"><span class="tag">    <span class="attr">xmlns:xsi</span>=<span class="string">&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span></span></span><br><span class="line"><span class="tag">    <span class="attr">xmlns:context</span>=<span class="string">&quot;http://www.springframework.org/schema/context&quot;</span></span></span><br><span class="line"><span class="tag">    <span class="attr">xmlns:mvc</span>=<span class="string">&quot;http://www.springframework.org/schema/mvc&quot;</span></span></span><br><span class="line"><span class="tag">    <span class="attr">xsi:schemaLocation</span>=<span class="string">&quot;http://www.springframework.org/schema/beans </span></span></span><br><span class="line"><span class="string"><span class="tag">        http://www.springframework.org/schema/beans/spring-beans.xsd</span></span></span><br><span class="line"><span class="string"><span class="tag">        http://www.springframework.org/schema/context </span></span></span><br><span class="line"><span class="string"><span class="tag">        http://www.springframework.org/schema/context/spring-context-4.0.xsd&quot;</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">&lt;!-- 扫描组件，将加上@Controller注解的类作为springMVC的控制层 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">context:component-scan</span> <span class="attr">base-package</span>=<span class="string">&quot;com.example.springmvc&quot;</span>/&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- 配置视图解析器：如何将控制器返回的结果字符串，转换为一个物理的视图文件--&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- 作用：将prefix + 视图名称 + suffix 确定最终要跳转的页面 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">&quot;internalResourceViewResolver&quot;</span>  <span class="attr">class</span>=<span class="string">&quot;org.springframework.web.servlet.view.InternalResourceViewResolver&quot;</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!-- 设置视图路径 --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;prefix&quot;</span> <span class="attr">value</span>=<span class="string">&quot;/WEB-INF/views/&quot;</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;suffix&quot;</span> <span class="attr">value</span>=<span class="string">&quot;.jsp&quot;</span>/&gt;</span></span><br><span class="line">        <span class="comment">&lt;!-- 设置视图优先级（有多个视图解析器时使用）,越小优先级越大 --&gt;</span></span><br><span class="line">        <span class="comment">&lt;!-- &lt;property name=&quot;order&quot; value=&quot;1&quot;/&gt; --&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- 遇到静态资源，交给Tomcat默认的servlet处理（不写静态资源会当请求获取，从而报错） --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">mvc:default-servlet-handler</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">mvc:annotation-driven</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br></pre></td></tr></table></figure></p>
<p>4.创建一个入口主界面index.jsp：<br />
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- WebContent/index.jsp --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">&quot;$&#123;pageContext.request.contextPath &#125;/helloworld&quot;</span>&gt;</span>Hello World<span class="tag">&lt;/<span class="name">a</span>&gt;</span></span><br></pre></td></tr></table></figure></p>
<p>5.编写处理请求的处理器（POJO，原始类），并标识为处理器：<br />
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.example.springmvc.controller;</span><br><span class="line"><span class="keyword">import</span> org.springframework.stereotype.Controller;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.bind.annotation.RequestMapping;</span><br><span class="line"> </span><br><span class="line"><span class="meta">@Controller</span>  <span class="comment">//声明Bean对象，为一个控制器组件</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">HelloWorldController</span> &#123;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 映射请求的名称：用于客户端请求；类似Struts2中action映射配置的action名称。</span></span><br><span class="line"><span class="comment">     * 1.使用<span class="doctag">@RequestMapping</span>注解来映射请求的URL。</span></span><br><span class="line"><span class="comment">     * 2.返回值会通过视图解析器解析为实际的物理视图，对于InternalResourceViewResolver视图解析器，会做如下的解析:</span></span><br><span class="line"><span class="comment">     *   通过 prefix + returnVal + suffix 这样的方式得到实际的物理视图，然后做转发操作。</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@RequestMapping(value=&quot;/helloworld&quot;,method=RequestMethod.GET)</span></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">helloworld</span><span class="params">()</span>&#123;</span><br><span class="line">         System.out.println(<span class="string">&quot;hello,world&quot;</span>);</span><br><span class="line">         <span class="keyword">return</span> <span class="string">&quot;success&quot;</span>; <span class="comment">//物理视图名称（prefix+returnVal+suffix）：success.jsp</span></span><br><span class="line">    &#125;        </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>6.编写视图子界面、部署测试：<br />
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- WEB-INF/views/success.jsp --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">h4</span>&gt;</span>Sucess Page<span class="tag">&lt;/<span class="name">h4</span>&gt;</span></span><br></pre></td></tr></table></figure></p>
<h3 id="请求匹配">请求匹配</h3>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">|-<span class="string">&quot;@RequestMapping&quot;</span>注解为控制器指定可以处理哪些URL请求，可标注于类、方法上。</span><br><span class="line">    |-标记在类上：提供初步的请求映射信息，该配置对类中所有方法都有效。相对于WEB应用的根目录。</span><br><span class="line">    |-标记在方法上：提供进一步的细分映射信息。相对于标记在类上的URL。</span><br><span class="line">    |-若类上未标注，则方法处标记的URL相对于WEB应用的根目录。</span><br><span class="line">    |-若类和方法都有标注，则先访问类，再访问类中的方法。</span><br><span class="line">作用：DispatcherServlet截获请求后，就通过控制器上<span class="string">&quot;@RequestMapping&quot;</span>提供的映射信息确定请求所对应的处理方法。</span><br><span class="line">|-<span class="string">&quot;@RequestMapping&quot;</span>参数详解：</span><br><span class="line">    |-value：请求URL，除正常字符串，还支持Ant方式：</span><br><span class="line">        |-*：任意长度字符。</span><br><span class="line">        |-?：任意一个字符。</span><br><span class="line">        |-**：任意多层目录。</span><br><span class="line">    |-method：请求方法：</span><br><span class="line">        |-RequestMethod.XXXX：GET查询、POST添加、PUT修改、DELETE删除。</span><br><span class="line">    |-params：请求参数：</span><br><span class="line">        |-param1: 表示请求参数必须包含名为param1。</span><br><span class="line">        |-!param1: 表示请求参数不能包含名为param1。</span><br><span class="line">        |-param1 != value1: 表示请求参数包含名为param1，但其值不能为value1。</span><br><span class="line">        |-&#123;<span class="string">&quot;param1=value1&quot;</span>, <span class="string">&quot;param2&quot;</span>&#125;: 表示请求参数必须包含名为param1和param2，且param1参数的值必须为value1。</span><br><span class="line">    |-heads：请求头的映射条件。</span><br><span class="line">|-<span class="string">&quot;@PathVariable&quot;</span>可以将URL中占位符参数绑定到控制器处理方法的入参中。</span><br></pre></td></tr></table></figure>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.example.controller;</span><br><span class="line"><span class="keyword">import</span> org.springframework.stereotype.Controller;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.bind.annotation.PathVariable;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.bind.annotation.RequestMapping;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.bind.annotation.RequestMethod;</span><br><span class="line"><span class="meta">@Controller</span></span><br><span class="line"><span class="comment">//@RequestMapping(&quot;/mvc&quot;)//相当于多加了一个路径</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">TestController</span> &#123;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * method：用来设置请求方式，只有客户端发送请求的方式和method的值一致，才能处理请求。</span></span><br><span class="line"><span class="comment">     * 请求方式：GET查询、POST添加、PUT修改、DELETE删除。</span></span><br><span class="line"><span class="comment">     * params：用来设置客户端传到服务器的数据，支持表达式。</span></span><br><span class="line"><span class="comment">     * headers：用来设置请求头信息，所发送的请求的请求头信息一定要和headers属性中所设置的一致。</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@RequestMapping(value=&quot;/test&quot;, </span></span><br><span class="line"><span class="meta">                    method=RequestMethod.POST,//POST方式</span></span><br><span class="line"><span class="meta">                    params=&#123;&quot;username&quot;,&quot;age!=12&quot;&#125;,//参数限定</span></span><br><span class="line"><span class="meta">                    headers=&#123;&quot;Accept-Language=en-US,zh;q=0.8&quot;&#125;//请求头限定</span></span><br><span class="line"><span class="meta">                    )</span></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">testPOST</span><span class="params">()</span> &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;SUCCESS:POST&quot;</span>);</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;success&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@RequestMapping(value=&quot;/test&quot;, method=RequestMethod.GET)</span></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">testGET</span><span class="params">()</span> &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;SUCCESS:GET&quot;</span>);</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;success&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 支持Ant方式的请求路径，有3种匹配符：</span></span><br><span class="line"><span class="comment">     * *：任意长度字符</span></span><br><span class="line"><span class="comment">     * ?：任意一个字符</span></span><br><span class="line"><span class="comment">     * **：任意多层目录</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@RequestMapping(value=&quot;/*/ant??/**/testAnt&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">testAnt</span><span class="params">()</span> &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;SUCCESS:testAnt&quot;</span>);</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;success&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@PathVariable</span> 可以将URL中占位符参数绑定到控制器处理方法的入参中：</span></span><br><span class="line"><span class="comment">     * 以前：localhost:8080/springMVC02/testREST?id=1001&amp;username=admin</span></span><br><span class="line"><span class="comment">     * 现在：localhost:8080/springMVC02/testREST/1001/admin</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@RequestMapping(&quot;/testREST/&#123;id&#125;/&#123;username&#125;&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">testREST</span><span class="params">(<span class="meta">@PathVariable(&quot;id&quot;)</span>Integer id, <span class="meta">@PathVariable(&quot;username&quot;)</span>String username)</span> &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;id:&quot;</span>+id+<span class="string">&quot;,username=&quot;</span>+username);</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;success&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>目前浏览器支持REST风格最多，但浏览器form表单只支持GET与POST请求，而DELETE、PUT等并不支持，Spring3.0添加了一个过滤器HiddenHttpMethodFilter，它可以将这些请求转换为标准的http方法，使得支持GET、POST、PUT与DELETE请求。当然如果前端是使用Ajax发送请求，就不用写过滤器了，因为Ajax天然支持GET、POST、PUT与DELETE请求。<br />
<div class="tabs" id="请求处理2"><ul class="nav-tabs"><li class="tab active"><a href="#请求处理2-1">xml配置</a></li><li class="tab"><a href="#请求处理2-2">Rest方式</a></li><li class="tab"><a href="#请求处理2-3">主界面</a></li></ul><div class="tab-content"><div class="tab-pane active" id="请求处理2-1"><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- WEB-INF/web.xml --&gt;</span></span><br><span class="line"><span class="meta">&lt;?xml version=<span class="string">&quot;1.0&quot;</span> encoding=<span class="string">&quot;UTF-8&quot;</span>?&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">web-app</span> <span class="attr">xmlns:xsi</span>=<span class="string">&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span> </span></span><br><span class="line"><span class="tag">         <span class="attr">xmlns</span>=<span class="string">&quot;http://java.sun.com/xml/ns/javaee&quot;</span> </span></span><br><span class="line"><span class="tag">         <span class="attr">xsi:schemaLocation</span>=<span class="string">&quot;http://java.sun.com/xml/ns/javaee </span></span></span><br><span class="line"><span class="string"><span class="tag">         http://java.sun.com/xml/ns/javaee/web-app_2_5.xsd&quot;</span> <span class="attr">id</span>=<span class="string">&quot;WebApp_ID&quot;</span> <span class="attr">version</span>=<span class="string">&quot;2.5&quot;</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">display-name</span>&gt;</span>SpringMVC02<span class="tag">&lt;/<span class="name">display-name</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">welcome-file-list</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">welcome-file</span>&gt;</span>index.jsp<span class="tag">&lt;/<span class="name">welcome-file</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">welcome-file-list</span>&gt;</span></span><br><span class="line">  <span class="comment">&lt;!-- 支持REST风格的过滤器：可以将POST请求转换为PUT或DELETE请求 --&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">filter</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">filter-name</span>&gt;</span>HiddenHttpMethodFilter<span class="tag">&lt;/<span class="name">filter-name</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">filter-class</span>&gt;</span>org.springframework.web.filter.HiddenHttpMethodFilter<span class="tag">&lt;/<span class="name">filter-class</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">filter</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">filter-mapping</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">filter-name</span>&gt;</span>HiddenHttpMethodFilter<span class="tag">&lt;/<span class="name">filter-name</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">url-pattern</span>&gt;</span>/*<span class="tag">&lt;/<span class="name">url-pattern</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">filter-mapping</span>&gt;</span></span><br><span class="line">  <span class="comment">&lt;!-- The front controller of this Spring Web application, responsible for handling all application requests --&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">servlet</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">servlet-name</span>&gt;</span>springMVC<span class="tag">&lt;/<span class="name">servlet-name</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">servlet-class</span>&gt;</span>org.springframework.web.servlet.DispatcherServlet<span class="tag">&lt;/<span class="name">servlet-class</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">servlet</span>&gt;</span></span><br><span class="line">  <span class="comment">&lt;!-- Map all requests to the DispatcherServlet for handling --&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">servlet-mapping</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">servlet-name</span>&gt;</span>springMVC<span class="tag">&lt;/<span class="name">servlet-name</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">url-pattern</span>&gt;</span>/<span class="tag">&lt;/<span class="name">url-pattern</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">servlet-mapping</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">web-app</span>&gt;</span></span><br></pre></td></tr></table></figure></div><div class="tab-pane" id="请求处理2-2"><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.example.controller;</span><br><span class="line"><span class="keyword">import</span> org.springframework.stereotype.Controller;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.bind.annotation.PathVariable;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.bind.annotation.RequestMapping;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.bind.annotation.RequestMethod;</span><br><span class="line"><span class="meta">@Controller</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">RESTController</span> &#123;</span><br><span class="line">    <span class="meta">@RequestMapping(value=&quot;/testREST/&#123;id&#125;&quot;, method=RequestMethod.GET)</span></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">getUserById</span><span class="params">(<span class="meta">@PathVariable(&quot;id&quot;)</span>Integer id)</span> &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;GET,id=&quot;</span>+id);</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;success&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="meta">@RequestMapping(value=&quot;/testREST&quot;, method=RequestMethod.POST)</span></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">insertUser</span><span class="params">()</span> &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;POST&quot;</span>);</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;success&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="meta">@RequestMapping(value=&quot;/testREST&quot;, method=RequestMethod.PUT)</span></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">updateUser</span><span class="params">()</span> &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;PUT&quot;</span>);</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;success&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="meta">@RequestMapping(value=&quot;/testREST/&#123;id&#125;&quot;, method=RequestMethod.DELETE)</span></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">deleteUser</span><span class="params">(<span class="meta">@PathVariable(&quot;id&quot;)</span> Integer id)</span> &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;DELETE,id=&quot;</span>+id);</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;success&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="meta">@RequestMapping(value=&quot;testAjax_DELETE&quot;, method=RequestMethod.DELETE)</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">testAjax_DELETE</span><span class="params">(Integer id)</span> &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;testAjax_DELETE,id=&quot;</span>+id);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div><div class="tab-pane" id="请求处理2-3"><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- WebContent/rest.jsp --&gt;</span></span><br><span class="line"><span class="comment">&lt;!-- 访问路径：localhost:8080/springMVC02/rest.jsp --&gt;</span></span><br><span class="line">&lt;%@ page language=&quot;java&quot; contentType=&quot;text/html; charset=UTF-8&quot; pageEncoding=&quot;UTF-8&quot;%&gt;</span><br><span class="line"><span class="meta">&lt;!DOCTYPE <span class="keyword">html</span> <span class="keyword">PUBLIC</span> <span class="string">&quot;-//W3C//DTD HTML 4.01 Transitional//EN&quot;</span> <span class="string">&quot;http://www.w3.org/TR/html4/loose.dtd&quot;</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">html</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">meta</span> <span class="attr">http-equiv</span>=<span class="string">&quot;Content-Type&quot;</span> <span class="attr">content</span>=<span class="string">&quot;text/html; charset=UTF-8&quot;</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">title</span>&gt;</span>Insert title here<span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line"><span class="comment">&lt;!-- AJAX使用 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span> <span class="attr">type</span>=<span class="string">&quot;text/javascript&quot;</span> <span class="attr">src</span>=<span class="string">&quot;js/jquery-1.8.2.min.js&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span> <span class="attr">type</span>=<span class="string">&quot;text/javascript&quot;</span>&gt;</span><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">    <span class="keyword">function</span> <span class="title function_">test</span>(<span class="params"></span>) &#123;</span></span><br><span class="line"><span class="language-javascript">        $.<span class="title function_">ajax</span>(&#123;</span></span><br><span class="line"><span class="language-javascript">            <span class="attr">url</span>:<span class="string">&quot;testAjax_DELETE&quot;</span>,</span></span><br><span class="line"><span class="language-javascript">            <span class="attr">type</span>:<span class="string">&quot;DELETE&quot;</span>,</span></span><br><span class="line"><span class="language-javascript">            <span class="attr">data</span>:&#123;<span class="attr">id</span>:<span class="number">1001</span>&#125;,</span></span><br><span class="line"><span class="language-javascript">            <span class="attr">dataType</span>:<span class="string">&quot;json&quot;</span>,</span></span><br><span class="line"><span class="language-javascript">            <span class="attr">success</span>:<span class="keyword">function</span> (<span class="params">obj</span>)&#123;</span></span><br><span class="line"><span class="language-javascript">                <span class="title function_">alert</span>(obj);</span></span><br><span class="line"><span class="language-javascript">            &#125;</span></span><br><span class="line"><span class="language-javascript">        &#125;);</span></span><br><span class="line"><span class="language-javascript">    &#125;</span></span><br><span class="line"><span class="language-javascript"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line">  <span class="comment">&lt;!-- </span></span><br><span class="line"><span class="comment">    HiddenHttpMethodFilter会根据几个条件对POST请求做出转换：</span></span><br><span class="line"><span class="comment">    1.method=&quot;POST&quot;</span></span><br><span class="line"><span class="comment">    2.有参数_method</span></span><br><span class="line"><span class="comment">    若不符合条件，走正常POST。</span></span><br><span class="line"><span class="comment">    若符合条件，经过转换之后真正的请求方式为_method的值。</span></span><br><span class="line"><span class="comment">  --&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- 实验1 测试 REST风格 GET 请求 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">&quot;testREST/1&quot;</span>&gt;</span>测试GET<span class="tag">&lt;/<span class="name">a</span>&gt;</span><span class="tag">&lt;<span class="name">br</span>/&gt;</span><span class="tag">&lt;<span class="name">br</span>/&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- 实验2 测试 REST风格 POST 请求 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">form</span> <span class="attr">action</span>=<span class="string">&quot;testREST&quot;</span> <span class="attr">method</span>=<span class="string">&quot;POST&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;submit&quot;</span> <span class="attr">value</span>=<span class="string">&quot;测试POST&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">form</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- 实验3 测试 REST风格 PUT 请求 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">form</span> <span class="attr">action</span>=<span class="string">&quot;testREST&quot;</span> <span class="attr">method</span>=<span class="string">&quot;POST&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;hidden&quot;</span> <span class="attr">name</span>=<span class="string">&quot;_method&quot;</span> <span class="attr">value</span>=<span class="string">&quot;PUT&quot;</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;submit&quot;</span> <span class="attr">value</span>=<span class="string">&quot;测试PUT&quot;</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">form</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- 实验4 测试 REST风格 DELETE 请求 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">form</span> <span class="attr">action</span>=<span class="string">&quot;testREST/1&quot;</span> <span class="attr">method</span>=<span class="string">&quot;POST&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;hidden&quot;</span> <span class="attr">name</span>=<span class="string">&quot;_method&quot;</span> <span class="attr">value</span>=<span class="string">&quot;DELETE&quot;</span> /&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;submit&quot;</span> <span class="attr">value</span>=<span class="string">&quot;测试DELETE&quot;</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">form</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- 实验5 测试AJAX --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;button&quot;</span> <span class="attr">value</span>=<span class="string">&quot;测试AJAX&quot;</span> <span class="attr">onclick</span>=<span class="string">&quot;test()&quot;</span> /&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure></div></div></div></p>
<h3 id="请求处理">请求处理</h3>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//1.使用注解获取客户端请求参数</span></span><br><span class="line">|-<span class="meta">@RequestParam</span>：可将请求参数，传递给请求方法。</span><br><span class="line">    |-value：客户端的参数名。</span><br><span class="line">    |-required：设置形参是否必须被赋值，默认为<span class="literal">true</span>。若为<span class="literal">false</span>，则可不赋值，为默认值<span class="literal">null</span>。</span><br><span class="line">    |-defaultValue: 默认值，当没有传递参数时使用该值。</span><br><span class="line">|-<span class="meta">@RequestHeader</span>：可将请求头中的参数，传递给请求方法。参数同上。</span><br><span class="line">|-<span class="meta">@CookieValue</span>：可将请求的Cookie值，传递给请求方法。参数同上。</span><br><span class="line"><span class="comment">//2.使用POJO获取客户端请求数据</span></span><br><span class="line">|-创建实体类，属性名一定要和页面中form元素的name属性值一致，且支持级联关系（类嵌套，需标签name属性明确级联）。</span><br><span class="line">    |-此方式还可以获取servletAPI，从而获取请求头、cookie等信息。支持的servletAPI类型：</span><br><span class="line">        |-HttpServletRequest：获取request对象。</span><br><span class="line">        |-HttpServletResponse：获取response对象。</span><br><span class="line">        |-HttpSession</span><br><span class="line">        |-Locale</span><br><span class="line">        |-InputStream</span><br><span class="line">        |-OutputStream</span><br><span class="line">        |-Reader</span><br><span class="line">        |-Writer</span><br><span class="line">        |-java.security.Principal</span><br><span class="line"><span class="comment">//向请求中注入参数，三种方式：</span></span><br><span class="line">|-org.springframework.web.servlet.ModelAndView。</span><br><span class="line">|-java.util.Map、org.springframework.ui.ModelMap。</span><br><span class="line">|-org.springframework.ui.Model。</span><br></pre></td></tr></table></figure>
<div class="tabs" id="请求处理"><ul class="nav-tabs"><li class="tab active"><a href="#请求处理-1">获取客户端请求参数</a></li><li class="tab"><a href="#请求处理-2">主页面</a></li><li class="tab"><a href="#请求处理-3">子页面</a></li></ul><div class="tab-content"><div class="tab-pane active" id="请求处理-1"><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.example.controller;</span><br><span class="line"><span class="keyword">import</span> com.example.bean.User;</span><br><span class="line"><span class="keyword">import</span> java.util.Map;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.http.HttpServletRequest;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.http.HttpServletResponse;</span><br><span class="line"><span class="keyword">import</span> org.springframework.stereotype.Controller;</span><br><span class="line"><span class="keyword">import</span> org.springframework.ui.Model;</span><br><span class="line"><span class="keyword">import</span> org.springframework.validation.BindingResult;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.bind.annotation.CookieValue;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.bind.annotation.RequestHeader;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.bind.annotation.RequestMapping;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.bind.annotation.RequestMethod;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.bind.annotation.RequestParam;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.servlet.ModelAndView;</span><br><span class="line"><span class="meta">@Controller</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">ParamController</span> &#123;</span><br><span class="line">    <span class="comment">/*</span></span><br><span class="line"><span class="comment">     * 在SpringMVC获取客户端传递的参数的方式：</span></span><br><span class="line"><span class="comment">     * 1.在处理请求的方法中，形参和客户端传递的参数名称一致，就可以自动赋值。</span></span><br><span class="line"><span class="comment">     * 2.@RequestParam方式：</span></span><br><span class="line"><span class="comment">     *   value：形参和客户端传递的参数名称不一致，可以使用value属性确定客户端参数名称，指定映射关系。</span></span><br><span class="line"><span class="comment">     *   required：设置形参是否必须被赋值，默认为true，若设置为false，则不必须赋值，没赋值时为默认值null。</span></span><br><span class="line"><span class="comment">     *   defaultValue：若形参所获得的值为null，则设置一个默认值，用在分页和模糊查询中。</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@RequestMapping(value=&quot;/param&quot;, method=RequestMethod.POST)</span></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">param</span><span class="params">(<span class="meta">@RequestParam(value=&quot;username&quot;, required=false, defaultValue=&quot;1&quot;)</span>String name, </span></span><br><span class="line"><span class="params">                        String password, String age)</span> &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;username=&quot;</span>+name+<span class="string">&quot;,password=&quot;</span>+password+<span class="string">&quot;,age=&quot;</span>+age);</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;success&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@RequestHeader</span>：在处理请求的方法上，获取请求头信息，用法和<span class="doctag">@RequestParam</span>一致。</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@RequestMapping(value=&quot;/param&quot;, method=RequestMethod.POST)</span></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">param</span><span class="params">(<span class="meta">@RequestHeader(value=&quot;Accept-Language&quot;)</span>String AcceptLanguage)</span> &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;AcceptLanguage=&quot;</span>+AcceptLanguage);</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;success&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@CookieValue</span>：在处理请求的方法上，获取cookie信息，用法和<span class="doctag">@RequestParam</span>一致。</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@RequestMapping(value=&quot;/param&quot;, method=RequestMethod.POST)</span></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">param</span><span class="params">(<span class="meta">@CookieValue(value=&quot;JSESSIONID&quot;)</span>String JSESSIONID)</span> &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;JSESSIONID=&quot;</span>+JSESSIONID);</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;success&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 1.POJO获取客户端数据：要求实体类对象中的属性名一定要和页面中表单元素的name属性值一致，且支持级联关系。</span></span><br><span class="line"><span class="comment">     * 2.可以通过设置形参的方式，获取servletAPI。</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@RequestMapping(value=&quot;/param&quot;, method=RequestMethod.POST)</span></span><br><span class="line">    <span class="comment">//User类属性：id、username、password、age、address(级联类Address属性：provice、city、country)</span></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">param</span><span class="params">(User user, HttpServletRequest request, HttpServletResponse response)</span> &#123;</span><br><span class="line">        <span class="type">String</span> <span class="variable">username</span> <span class="operator">=</span> request.getParameter(<span class="string">&quot;username&quot;</span>);</span><br><span class="line">        <span class="comment">// request.setAttribute()</span></span><br><span class="line">        System.out.println(username);</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;success&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">/*</span></span><br><span class="line"><span class="comment">     * springMVC处理请求过程中，往request作用域中放值有以下三种方式：</span></span><br><span class="line"><span class="comment">     * 1.ModelAndView方式。</span></span><br><span class="line"><span class="comment">     * 2.Map方式（内部实现还是ModelAndView方式）。</span></span><br><span class="line"><span class="comment">     * 3.Model方式（内部实现还是ModelAndView方式）。</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@RequestMapping(value=&quot;/param&quot;, method=RequestMethod.POST)</span></span><br><span class="line">    <span class="keyword">public</span> ModelAndView <span class="title function_">param</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="type">ModelAndView</span> <span class="variable">mav</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ModelAndView</span>();</span><br><span class="line">        mav.addObject(<span class="string">&quot;username&quot;</span>, <span class="string">&quot;root&quot;</span>);<span class="comment">//往request作用域中放值</span></span><br><span class="line">        mav.setViewName(<span class="string">&quot;success&quot;</span>);<span class="comment">//设置视图名称，实现页面跳转</span></span><br><span class="line">        <span class="keyword">return</span> mav;<span class="comment">//返回ModelAndView实例</span></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="meta">@RequestMapping(value=&quot;/param&quot;, method=RequestMethod.POST)</span></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">param</span><span class="params">(Map&lt;String, Object&gt; map)</span> &#123;</span><br><span class="line">        map.put(<span class="string">&quot;username&quot;</span>, <span class="string">&quot;admin&quot;</span>);<span class="comment">//向作用域中放值</span></span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;success&quot;</span>;<span class="comment">//返回视图名称</span></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="meta">@RequestMapping(value=&quot;/param&quot;, method=RequestMethod.POST)</span></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">param</span><span class="params">(Model model, String username)</span> &#123;</span><br><span class="line">        model.addAttribute(<span class="string">&quot;username&quot;</span>, <span class="string">&quot;张三&quot;</span>);<span class="comment">//向作用域中放值</span></span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;success&quot;</span>;<span class="comment">//返回视图名称</span></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">//根据ModelAndView源码调试，不管使用以上哪种方式，最终都会把model数据和view数据封装到一个ModelAndView中。</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div><div class="tab-pane" id="请求处理-2"><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- WebContent/param.jsp --&gt;</span></span><br><span class="line">&lt;%@ page language=&quot;java&quot; contentType=&quot;text/html; charset=UTF-8&quot; pageEncoding=&quot;UTF-8&quot;%&gt;</span><br><span class="line"><span class="meta">&lt;!DOCTYPE <span class="keyword">html</span> <span class="keyword">PUBLIC</span> <span class="string">&quot;-//W3C//DTD HTML 4.01 Transitional//EN&quot;</span> <span class="string">&quot;http://www.w3.org/TR/html4/loose.dtd&quot;</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">html</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">meta</span> <span class="attr">http-equiv</span>=<span class="string">&quot;Content-Type&quot;</span> <span class="attr">content</span>=<span class="string">&quot;text/html; charset=UTF-8&quot;</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">title</span>&gt;</span>Insert title here<span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- 服务启动后进入此主界面，点击submit后向ModelAndView注入参数（名字要一致），</span></span><br><span class="line"><span class="comment">         之后根据return跳转到success.jsp --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">form</span> <span class="attr">action</span>=<span class="string">&quot;param&quot;</span> <span class="attr">method</span>=<span class="string">&quot;post&quot;</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!-- input类型为text时，是输入标签 --&gt;</span></span><br><span class="line">        username:<span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;text&quot;</span> <span class="attr">name</span>=<span class="string">&quot;username&quot;</span> /&gt;</span><span class="tag">&lt;<span class="name">br</span> /&gt;</span></span><br><span class="line">        password:<span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;text&quot;</span> <span class="attr">name</span>=<span class="string">&quot;password&quot;</span> /&gt;</span><span class="tag">&lt;<span class="name">br</span> /&gt;</span></span><br><span class="line">        age:<span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;text&quot;</span> <span class="attr">name</span>=<span class="string">&quot;age&quot;</span> /&gt;</span><span class="tag">&lt;<span class="name">br</span> /&gt;</span></span><br><span class="line">        <span class="comment">&lt;!-- 级联属性address.xxx --&gt;</span></span><br><span class="line">        province:<span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;text&quot;</span> <span class="attr">name</span>=<span class="string">&quot;address.province&quot;</span> /&gt;</span><span class="tag">&lt;<span class="name">br</span> /&gt;</span></span><br><span class="line">        city:<span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;text&quot;</span> <span class="attr">name</span>=<span class="string">&quot;address.city&quot;</span> /&gt;</span><span class="tag">&lt;<span class="name">br</span> /&gt;</span></span><br><span class="line">        country:<span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;text&quot;</span> <span class="attr">name</span>=<span class="string">&quot;address.country&quot;</span> /&gt;</span><span class="tag">&lt;<span class="name">br</span> /&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;submit&quot;</span> <span class="attr">value</span>=<span class="string">&quot;添加&quot;</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">form</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure></div><div class="tab-pane" id="请求处理-3"><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- WEB-INF/views/success.jsp --&gt;</span></span><br><span class="line">&lt;%@ page language=&quot;java&quot; contentType=&quot;text/html; charset=UTF-8&quot; pageEncoding=&quot;UTF-8&quot;%&gt;</span><br><span class="line"><span class="meta">&lt;!DOCTYPE <span class="keyword">html</span> <span class="keyword">PUBLIC</span> <span class="string">&quot;-//W3C//DTD HTML 4.01 Transitional//EN&quot;</span> <span class="string">&quot;http://www.w3.org/TR/html4/loose.dtd&quot;</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">html</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">meta</span> <span class="attr">http-equiv</span>=<span class="string">&quot;Content-Type&quot;</span> <span class="attr">content</span>=<span class="string">&quot;text/html; charset=UTF-8&quot;</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">title</span>&gt;</span>Insert title here<span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">h1</span>&gt;</span>成功<span class="tag">&lt;/<span class="name">h1</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">br</span>/&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- 显示request作用域注入的参数 --&gt;</span></span><br><span class="line">    $&#123;requestScope.username&#125;</span><br><span class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure></div></div></div>
<h3 id="视图解析">视图解析</h3>
<p>不论控制器返回String、ModelAndView、View都会转换为ModelAndView对象，由视图解析器解析视图，然后进行页面的跳转。
 <br />
<img src="/images/Java/视图流程图.png" width="80%"></p>
<p>1.请求处理方法执行完成后，不论控制器返回什么类型，<strong>最终都会将它们装配成一个ModelAndView对象</strong>，它包含了逻辑名和模型对象视图。<br />
2.Spring MVC
借助<strong>视图解析器</strong>（<strong>ViewResolver</strong>）得到最终的<strong>视图对象</strong>（<strong>View</strong>），最终的视图可以是
JSP、Excel、JFreeChart等各种表现形式的视图。<br />
3.对于最终究竟采取何种视图对象对模型数据进行渲染，处理器并不关心，处理器工作重点聚焦在生产模型数据的工作上，从而实现
MVC 的充分解耦。</p>
<p><strong>视图</strong>：<br />
1.<strong>视图</strong>的作用是渲染模型数据，将模型里的数据以某种形式呈现给客户。<br />
2.为了实现视图模型和具体实现技术的解耦，Spring 在
org.springframework.web.servlet 包中定义了一个高度抽象的
<strong>View</strong> 接口。<br />
3.<strong>视图对象由视图解析器负责实例化</strong>。由于视图是<strong>无状态</strong>的，所以他们<strong>不会有线程安全的问题</strong>。</p>
<p>常用的视<strong>图实现类</strong>（View实现类）：<br />
<img src="/images/Java/视图实现类.png" width="70%"></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.example.controller;</span><br><span class="line"><span class="keyword">import</span> org.springframework.stereotype.Controller;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.bind.annotation.PathVariable;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.bind.annotation.RequestMapping;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.bind.annotation.RequestMethod;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Controller</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">TestController</span> &#123;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * View作用：处理模型数据，实现页面跳转（转发，重定向）。</span></span><br><span class="line"><span class="comment">     * View类型：</span></span><br><span class="line"><span class="comment">     *  InernalResourceView：转发视图。</span></span><br><span class="line"><span class="comment">     *  JstlView：支持Jstl的转发视图。</span></span><br><span class="line"><span class="comment">     *  RedirectView：重定向视图。</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@RequestMapping(value=&quot;/test&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">testAnt</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;success&quot;</span> <span class="comment">//转发</span></span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;forward:success.jsp&quot;</span>; <span class="comment">//转发</span></span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;redirect:index.jsp&quot;</span>; <span class="comment">//重定向</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="完整流程">完整流程</h3>
<p>这里做一个Restful方式的CRUD功能项目，功能描述如下：<br />
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">|-显示所有员工信息</span><br><span class="line">    |-URI：emps</span><br><span class="line">    |-请求方式：GET</span><br><span class="line">|-添加员工-跳转到add页面</span><br><span class="line">    |-URI：emp</span><br><span class="line">    |-请求方式：GET</span><br><span class="line">|-添加员工-add页面</span><br><span class="line">    |-URI：emp</span><br><span class="line">    |-请求方式：POST</span><br><span class="line">    |-完成添加，重定向到list页面（重定向而不是直接路由，防止用户以为没有反馈而多次提交数据）。</span><br><span class="line">|-删除员工</span><br><span class="line">    |-URI：emp/&#123;id&#125;</span><br><span class="line">    |-请求方式：DELETE</span><br><span class="line">|-修改员工-跳转到修改页面</span><br><span class="line">    |-URI：emp/&#123;id&#125;</span><br><span class="line">    |-请求方式：GET</span><br><span class="line">    |-回显表单。</span><br><span class="line">|-修改员工-修改页面</span><br><span class="line">    |-URI：emp</span><br><span class="line">    |-请求方式：PUT</span><br><span class="line">    |-完成修改，重定向到list页面。</span><br></pre></td></tr></table></figure></p>
<p>新建项目，结构如下：<br />
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><span class="line">|-RestEmp</span><br><span class="line">    |-build（编译目录）</span><br><span class="line">    |-conf</span><br><span class="line">        |-springMVC.xml</span><br><span class="line">    |-src（源码目录）</span><br><span class="line">        |-com.example.rest.crud（这里省略了service层）</span><br><span class="line">            |-bean</span><br><span class="line">                |-Department.java</span><br><span class="line">                |-Employee.java  </span><br><span class="line">            |-controller</span><br><span class="line">                |-EmpController.java</span><br><span class="line">            |-dao</span><br><span class="line">                |-DepartmentDao.java</span><br><span class="line">                |-EmployeeDao.java  </span><br><span class="line">    |-WebContent</span><br><span class="line">        |-css（.css和.png文件）</span><br><span class="line">            |-img（.png存放目录）</span><br><span class="line">            |-index_like.css</span><br><span class="line">            |-index_work.css</span><br><span class="line">            |-style.css</span><br><span class="line">        |-js</span><br><span class="line">            |-jquery-1.8.2.min.js</span><br><span class="line">        |-META-INF</span><br><span class="line">            |-MANIFEST.MF</span><br><span class="line">        |-WEB-INF</span><br><span class="line">            |-lib（.jar目录，下面引用的包需手动放好）</span><br><span class="line">                |-commons-logging-1.1.3.jar</span><br><span class="line">                |-spring-aop-4.0.0.RELEASE.jar</span><br><span class="line">                |-spring-beans-4.0.0.RELEASE.jar</span><br><span class="line">                |-spring-context-4.0.0.RELEASE.jar</span><br><span class="line">                |-spring-core-4.0.0.RELEASE.jar</span><br><span class="line">                |-spring-expression-4.0.0.RELEASE.jar</span><br><span class="line">                |-spring-web-4.0.0.RELEASE.jar</span><br><span class="line">                |-spring-webmvc-4.0.0.RELEASE.jar</span><br><span class="line">                |-taglibs-standard-impl-1.2.1.jar</span><br><span class="line">                |-taglibs-standard-spec-1.2.1.jar</span><br><span class="line">            |-view</span><br><span class="line">                |-add.jsp</span><br><span class="line">                |-edit.jsp</span><br><span class="line">                |-list.jsp</span><br><span class="line">                |-update.jsp</span><br><span class="line">            |-web.xml</span><br><span class="line">        |-index.jsp</span><br></pre></td></tr></table></figure></p>
<p>配置web.xml和springMVC.xml：<br />
<div class="tabs" id="配置1"><ul class="nav-tabs"><li class="tab active"><a href="#配置1-1">web.xml</a></li><li class="tab"><a href="#配置1-2">springMVC.xml</a></li></ul><div class="tab-content"><div class="tab-pane active" id="配置1-1"><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version=<span class="string">&quot;1.0&quot;</span> encoding=<span class="string">&quot;UTF-8&quot;</span>?&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">web-app</span> <span class="attr">xmlns:xsi</span>=<span class="string">&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span> </span></span><br><span class="line"><span class="tag">         <span class="attr">xmlns</span>=<span class="string">&quot;http://java.sun.com/xml/ns/javaee&quot;</span> </span></span><br><span class="line"><span class="tag">         <span class="attr">xsi:schemaLocation</span>=<span class="string">&quot;http://java.sun.com/xml/ns/javaee http://java.sun.com/xml/ns/javaee/web-app_2_5.xsd&quot;</span> </span></span><br><span class="line"><span class="tag">         <span class="attr">id</span>=<span class="string">&quot;WebApp_ID&quot;</span> </span></span><br><span class="line"><span class="tag">         <span class="attr">version</span>=<span class="string">&quot;2.5&quot;</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">display-name</span>&gt;</span>RestEmp<span class="tag">&lt;/<span class="name">display-name</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">welcome-file-list</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">welcome-file</span>&gt;</span>index.jsp<span class="tag">&lt;/<span class="name">welcome-file</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">welcome-file-list</span>&gt;</span></span><br><span class="line">  <span class="comment">&lt;!-- 编码过滤器一定放在首位，缓冲问题导致 --&gt;</span></span><br><span class="line">  <span class="comment">&lt;!-- 设置编码过滤器防止接收中文等乱码 --&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">filter</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">filter-name</span>&gt;</span>CharacterEncodingFilter<span class="tag">&lt;/<span class="name">filter-name</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">filter-class</span>&gt;</span>org.springframework.web.filter.CharacterEncodingFilter<span class="tag">&lt;/<span class="name">filter-class</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">init-param</span>&gt;</span></span><br><span class="line">          <span class="tag">&lt;<span class="name">param-name</span>&gt;</span>encoding<span class="tag">&lt;/<span class="name">param-name</span>&gt;</span></span><br><span class="line">          <span class="tag">&lt;<span class="name">param-value</span>&gt;</span>UTF-8<span class="tag">&lt;/<span class="name">param-value</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;/<span class="name">init-param</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">filter</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">filter-mapping</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">filter-name</span>&gt;</span>CharacterEncodingFilter<span class="tag">&lt;/<span class="name">filter-name</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">url-pattern</span>&gt;</span>/*<span class="tag">&lt;/<span class="name">url-pattern</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">filter-mapping</span>&gt;</span></span><br><span class="line">  <span class="comment">&lt;!-- Rest风格控制，支持客户端POST转为PUT、DELETE --&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">filter</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">filter-name</span>&gt;</span>HiddenHttpMethodFilter<span class="tag">&lt;/<span class="name">filter-name</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">filter-class</span>&gt;</span>org.springframework.web.filter.HiddenHttpMethodFilter<span class="tag">&lt;/<span class="name">filter-class</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">filter</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">filter-mapping</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">filter-name</span>&gt;</span>HiddenHttpMethodFilter<span class="tag">&lt;/<span class="name">filter-name</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">url-pattern</span>&gt;</span>/*<span class="tag">&lt;/<span class="name">url-pattern</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">filter-mapping</span>&gt;</span></span><br><span class="line">  </span><br><span class="line">  <span class="comment">&lt;!-- 配置SpringMVC核心控制器 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">servlet</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">servlet-name</span>&gt;</span>springDispatcherServlet<span class="tag">&lt;/<span class="name">servlet-name</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">servlet-class</span>&gt;</span>org.springframework.web.servlet.DispatcherServlet<span class="tag">&lt;/<span class="name">servlet-class</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">init-param</span>&gt;</span></span><br><span class="line">            <span class="comment">&lt;!-- 配置DispatcherServlet的初始化參數：设置文件的路径、文件名称 --&gt;</span></span><br><span class="line">            <span class="comment">&lt;!-- 默认配置文件路径: WebContent/WEB-INF/&lt;servlet-name&gt;-servlet.xml --&gt;</span></span><br><span class="line">            <span class="comment">&lt;!-- 这里配置文件路径设置为类路径：conf/springmvc.xml --&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">param-name</span>&gt;</span>contextConfigLocation<span class="tag">&lt;/<span class="name">param-name</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">param-value</span>&gt;</span>classpath:springMVC.xml<span class="tag">&lt;/<span class="name">param-value</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">init-param</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!-- 设置servlet的加载时间，默认无此标签为第一次访问时加载，有此标签时会将加载时间提前到项目启动时 --&gt;</span></span><br><span class="line">        <span class="comment">&lt;!-- 标签中为正整数才有效，值越小优先级越高 --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">load-on-startup</span>&gt;</span>1<span class="tag">&lt;/<span class="name">load-on-startup</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">servlet</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- Map all requests to the DispatcherServlet for handling --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">servlet-mapping</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">servlet-name</span>&gt;</span>springDispatcherServlet<span class="tag">&lt;/<span class="name">servlet-name</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!-- 一般设置为/，而不是/* --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">url-pattern</span>&gt;</span>/<span class="tag">&lt;/<span class="name">url-pattern</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">servlet-mapping</span>&gt;</span></span><br><span class="line">  </span><br><span class="line"><span class="tag">&lt;/<span class="name">web-app</span>&gt;</span></span><br></pre></td></tr></table></figure></div><div class="tab-pane" id="配置1-2"><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- 引入context、mvc命名空间 --&gt;</span></span><br><span class="line"><span class="meta">&lt;?xml version=<span class="string">&quot;1.0&quot;</span> encoding=<span class="string">&quot;UTF-8&quot;</span>?&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">beans</span> <span class="attr">xmlns</span>=<span class="string">&quot;http://www.springframework.org/schema/beans&quot;</span></span></span><br><span class="line"><span class="tag">    <span class="attr">xmlns:xsi</span>=<span class="string">&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span></span></span><br><span class="line"><span class="tag">    <span class="attr">xmlns:context</span>=<span class="string">&quot;http://www.springframework.org/schema/context&quot;</span></span></span><br><span class="line"><span class="tag">    <span class="attr">xmlns:mvc</span>=<span class="string">&quot;http://www.springframework.org/schema/mvc&quot;</span></span></span><br><span class="line"><span class="tag">    <span class="attr">xsi:schemaLocation</span>=<span class="string">&quot;http://www.springframework.org/schema/mvc </span></span></span><br><span class="line"><span class="string"><span class="tag">        http://www.springframework.org/schema/mvc/spring-mvc-4.0.xsd</span></span></span><br><span class="line"><span class="string"><span class="tag">        http://www.springframework.org/schema/beans </span></span></span><br><span class="line"><span class="string"><span class="tag">        http://www.springframework.org/schema/beans/spring-beans.xsd</span></span></span><br><span class="line"><span class="string"><span class="tag">        http://www.springframework.org/schema/context </span></span></span><br><span class="line"><span class="string"><span class="tag">        http://www.springframework.org/schema/context/spring-context-4.0.xsd&quot;</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- 扫描组件 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">context:component-scan</span> <span class="attr">base-package</span>=<span class="string">&quot;com.example.rest.crud&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">context:component-scan</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- 配置视图解析器：如何将控制器返回的结果字符串，转换为一个物理的视图文件--&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- 作用：将prefix + 视图名称 + suffix 确定最终要跳转的页面 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">bean</span> <span class="attr">class</span>=<span class="string">&quot;org.springframework.web.servlet.view.InternalResourceViewResolver&quot;</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!-- 设置视图路径 --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;prefix&quot;</span> <span class="attr">value</span>=<span class="string">&quot;/WEB-INF/view/&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;suffix&quot;</span> <span class="attr">value</span>=<span class="string">&quot;.jsp&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!-- 设置视图优先级（有多个视图解析器时使用），越小优先级越大。一般不用 --&gt;</span></span><br><span class="line">        <span class="comment">&lt;!-- &lt;property name=&quot;order&quot; value=&quot;1&quot;/&gt; --&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- 以下两个标签合一起有才有效--&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- 作用：遇到静态资源，交给Tomcat默认的servlet处理（不写静态资源会当请求获取） --&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- </span></span><br><span class="line"><span class="comment">        配置Tomcat中默认的servlet，即DefaultServlet。</span></span><br><span class="line"><span class="comment">        注意：当DefaultServlet所设置的&lt;url-pattern&gt;的值，和开发人员所配置的servlet的&lt;url-pattern&gt;相同，以开发人员所配置的servlet优先。</span></span><br><span class="line"><span class="comment">        作用：当客户端发送请求，由于DefaultServlet所设置的&lt;url-pattern&gt;的值和开发人员所配置DispatcherServlet的&lt;url-pattern&gt;都是/，</span></span><br><span class="line"><span class="comment">              因此先通过DispatcherServlet处理请求，找该请求是否有相对应的处理器，有则处理，无则交给DefaultServlet处理。</span></span><br><span class="line"><span class="comment">     --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">mvc:default-servlet-handler</span>/&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- mvc驱动 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">mvc:annotation-driven</span> /&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">beans</span>&gt;</span></span><br></pre></td></tr></table></figure></div></div></div></p>
<p>Bean层：<br />
<div class="tabs" id="bean"><ul class="nav-tabs"><li class="tab active"><a href="#bean-1">Department</a></li><li class="tab"><a href="#bean-2">Employee</a></li></ul><div class="tab-content"><div class="tab-pane active" id="bean-1"><figure class="highlight java"><figcaption><span>Department.java</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.example.rest.crud.bean;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Department</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> Integer id;</span><br><span class="line">    <span class="keyword">private</span> String departmentName;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">Department</span><span class="params">()</span> &#123;&#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">Department</span><span class="params">(<span class="type">int</span> i, String string)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.id = i;</span><br><span class="line">        <span class="built_in">this</span>.departmentName = string;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> Integer <span class="title function_">getId</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> id;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setId</span><span class="params">(Integer id)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.id = id;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">getDepartmentName</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> departmentName;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setDepartmentName</span><span class="params">(String departmentName)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.departmentName = departmentName;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">toString</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;Department [id=&quot;</span> + id + <span class="string">&quot;, departmentName=&quot;</span> + departmentName + <span class="string">&quot;]&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div><div class="tab-pane" id="bean-2"><figure class="highlight java"><figcaption><span>Employee.java</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.example.rest.crud.bean;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Employee</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> Integer id;</span><br><span class="line">    <span class="keyword">private</span> String lastName;</span><br><span class="line">    <span class="keyword">private</span> String email;</span><br><span class="line">    <span class="keyword">private</span> Integer gender;<span class="comment">//1 male, 0 female</span></span><br><span class="line">    <span class="keyword">private</span> Department department;<span class="comment">//Department实例</span></span><br><span class="line">    <span class="keyword">public</span> Integer <span class="title function_">getId</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> id;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setId</span><span class="params">(Integer id)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.id = id;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">getLastName</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> lastName;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setLastName</span><span class="params">(String lastName)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.lastName = lastName;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">getEmail</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> email;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setEmail</span><span class="params">(String email)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.email = email;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> Integer <span class="title function_">getGender</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> gender;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setGender</span><span class="params">(Integer gender)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.gender = gender;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> Department <span class="title function_">getDepartment</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> department;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setDepartment</span><span class="params">(Department department)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.department = department;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">toString</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;Employee [id=&quot;</span> + id + <span class="string">&quot;, lastName=&quot;</span> + lastName + <span class="string">&quot;, email=&quot;</span></span><br><span class="line">                + email + <span class="string">&quot;, gender=&quot;</span> + gender + <span class="string">&quot;, department=&quot;</span> + department</span><br><span class="line">                + <span class="string">&quot;]&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">Employee</span><span class="params">(Integer id, String lastName, String email, Integer gender, Department department)</span> &#123;</span><br><span class="line">        <span class="built_in">super</span>();</span><br><span class="line">        <span class="built_in">this</span>.id = id;</span><br><span class="line">        <span class="built_in">this</span>.lastName = lastName;</span><br><span class="line">        <span class="built_in">this</span>.email = email;</span><br><span class="line">        <span class="built_in">this</span>.gender = gender;</span><br><span class="line">        <span class="built_in">this</span>.department = department;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">Employee</span><span class="params">()</span> &#123;&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div></div></div></p>
<p>Dao层：<br />
<div class="tabs" id="dao"><ul class="nav-tabs"><li class="tab active"><a href="#dao-1">DepartmentDao</a></li><li class="tab"><a href="#dao-2">EmployeeDao</a></li></ul><div class="tab-content"><div class="tab-pane active" id="dao-1"><figure class="highlight java"><figcaption><span>DepartmentDao.java</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.example.rest.crud.dao;</span><br><span class="line"><span class="keyword">import</span> com.example.rest.crud.bean.Department;</span><br><span class="line"><span class="keyword">import</span> java.util.Collection;</span><br><span class="line"><span class="keyword">import</span> java.util.HashMap;</span><br><span class="line"><span class="keyword">import</span> java.util.Map;</span><br><span class="line"><span class="keyword">import</span> org.springframework.stereotype.Repository;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Repository</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">DepartmentDao</span> &#123;<span class="comment">//存储所有部门信息</span></span><br><span class="line">    <span class="comment">//创建静态map</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> Map&lt;Integer, Department&gt; departments = <span class="literal">null</span>;</span><br><span class="line">    <span class="comment">//为静态map赋值</span></span><br><span class="line">    <span class="keyword">static</span>&#123;</span><br><span class="line">        departments = <span class="keyword">new</span> <span class="title class_">HashMap</span>&lt;Integer, Department&gt;();</span><br><span class="line">        <span class="comment">//部门id作为key，部门对象作为value。</span></span><br><span class="line">        departments.put(<span class="number">101</span>, <span class="keyword">new</span> <span class="title class_">Department</span>(<span class="number">101</span>, <span class="string">&quot;D-AA&quot;</span>));</span><br><span class="line">        departments.put(<span class="number">102</span>, <span class="keyword">new</span> <span class="title class_">Department</span>(<span class="number">102</span>, <span class="string">&quot;D-BB&quot;</span>));</span><br><span class="line">        departments.put(<span class="number">103</span>, <span class="keyword">new</span> <span class="title class_">Department</span>(<span class="number">103</span>, <span class="string">&quot;D-CC&quot;</span>));</span><br><span class="line">        departments.put(<span class="number">104</span>, <span class="keyword">new</span> <span class="title class_">Department</span>(<span class="number">104</span>, <span class="string">&quot;D-DD&quot;</span>));</span><br><span class="line">        departments.put(<span class="number">105</span>, <span class="keyword">new</span> <span class="title class_">Department</span>(<span class="number">105</span>, <span class="string">&quot;D-EE&quot;</span>));</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">//获取所有部门信息</span></span><br><span class="line">    <span class="keyword">public</span> Collection&lt;Department&gt; <span class="title function_">getDepartments</span><span class="params">()</span>&#123;</span><br><span class="line">        <span class="keyword">return</span> departments.values();</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">//通过id获取部门信息</span></span><br><span class="line">    <span class="keyword">public</span> Department <span class="title function_">getDepartment</span><span class="params">(Integer id)</span>&#123;</span><br><span class="line">        <span class="keyword">return</span> departments.get(id);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div><div class="tab-pane" id="dao-2"><figure class="highlight java"><figcaption><span>EmployeeDao.java</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.example.rest.crud.dao;</span><br><span class="line"><span class="keyword">import</span> com.example.rest.crud.bean.Department;</span><br><span class="line"><span class="keyword">import</span> com.example.rest.crud.bean.Employee;</span><br><span class="line"><span class="keyword">import</span> java.util.Collection;</span><br><span class="line"><span class="keyword">import</span> java.util.HashMap;</span><br><span class="line"><span class="keyword">import</span> java.util.Map;</span><br><span class="line"><span class="keyword">import</span> org.springframework.beans.factory.annotation.Autowired;</span><br><span class="line"><span class="keyword">import</span> org.springframework.stereotype.Repository;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Repository</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">EmployeeDao</span> &#123;<span class="comment">//存储所有员工信息</span></span><br><span class="line">    <span class="meta">@Autowired</span> <span class="comment">//自动装配</span></span><br><span class="line">    <span class="keyword">private</span> DepartmentDao departmentDao;</span><br><span class="line">    <span class="comment">//创建静态map</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> Map&lt;Integer, Employee&gt; employees = <span class="literal">null</span>;</span><br><span class="line">    <span class="comment">//为静态map赋值</span></span><br><span class="line">    <span class="keyword">static</span>&#123;</span><br><span class="line">        employees = <span class="keyword">new</span> <span class="title class_">HashMap</span>&lt;Integer, Employee&gt;();</span><br><span class="line">        employees.put(<span class="number">1001</span>, <span class="keyword">new</span> <span class="title class_">Employee</span>(<span class="number">1001</span>, <span class="string">&quot;E-AA&quot;</span>, <span class="string">&quot;aa@163.com&quot;</span>, <span class="number">1</span>, <span class="keyword">new</span> <span class="title class_">Department</span>(<span class="number">101</span>, <span class="string">&quot;D-AA&quot;</span>)));</span><br><span class="line">        employees.put(<span class="number">1002</span>, <span class="keyword">new</span> <span class="title class_">Employee</span>(<span class="number">1002</span>, <span class="string">&quot;E-BB&quot;</span>, <span class="string">&quot;bb@163.com&quot;</span>, <span class="number">1</span>, <span class="keyword">new</span> <span class="title class_">Department</span>(<span class="number">102</span>, <span class="string">&quot;D-BB&quot;</span>)));</span><br><span class="line">        employees.put(<span class="number">1003</span>, <span class="keyword">new</span> <span class="title class_">Employee</span>(<span class="number">1003</span>, <span class="string">&quot;E-CC&quot;</span>, <span class="string">&quot;cc@163.com&quot;</span>, <span class="number">0</span>, <span class="keyword">new</span> <span class="title class_">Department</span>(<span class="number">103</span>, <span class="string">&quot;D-CC&quot;</span>)));</span><br><span class="line">        employees.put(<span class="number">1004</span>, <span class="keyword">new</span> <span class="title class_">Employee</span>(<span class="number">1004</span>, <span class="string">&quot;E-DD&quot;</span>, <span class="string">&quot;dd@163.com&quot;</span>, <span class="number">0</span>, <span class="keyword">new</span> <span class="title class_">Department</span>(<span class="number">104</span>, <span class="string">&quot;D-DD&quot;</span>)));</span><br><span class="line">        employees.put(<span class="number">1005</span>, <span class="keyword">new</span> <span class="title class_">Employee</span>(<span class="number">1005</span>, <span class="string">&quot;E-EE&quot;</span>, <span class="string">&quot;ee@163.com&quot;</span>, <span class="number">1</span>, <span class="keyword">new</span> <span class="title class_">Department</span>(<span class="number">105</span>, <span class="string">&quot;D-EE&quot;</span>)));</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">//初始id</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="type">Integer</span> <span class="variable">initId</span> <span class="operator">=</span> <span class="number">1006</span>;</span><br><span class="line">    <span class="comment">//添加+修改（添加可不提供id，修改需提供id）</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">save</span><span class="params">(Employee employee)</span>&#123;</span><br><span class="line">        <span class="keyword">if</span>(employee.getId() == <span class="literal">null</span>)&#123;</span><br><span class="line">            employee.setId(initId++);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">//通过部门id，获取部门对象，赋值给员工</span></span><br><span class="line">        employee.setDepartment(departmentDao.getDepartment(employee.getDepartment().getId()));</span><br><span class="line">        employees.put(employee.getId(), employee);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> Collection&lt;Employee&gt; <span class="title function_">getAll</span><span class="params">()</span>&#123;</span><br><span class="line">        <span class="keyword">return</span> employees.values();</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> Employee <span class="title function_">get</span><span class="params">(Integer id)</span>&#123;</span><br><span class="line">        <span class="keyword">return</span> employees.get(id);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">delete</span><span class="params">(Integer id)</span>&#123;</span><br><span class="line">        employees.remove(id);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div></div></div></p>
<p>Controller层：<br />
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.example.rest.crud.controller;</span><br><span class="line"><span class="keyword">import</span> com.example.rest.crud.bean.Department;</span><br><span class="line"><span class="keyword">import</span> com.example.rest.crud.bean.Employee;</span><br><span class="line"><span class="keyword">import</span> com.example.rest.crud.dao.DepartmentDao;</span><br><span class="line"><span class="keyword">import</span> com.example.rest.crud.dao.EmployeeDao;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.util.Collection;</span><br><span class="line"><span class="keyword">import</span> java.util.HashMap;</span><br><span class="line"><span class="keyword">import</span> java.util.Map;</span><br><span class="line"><span class="keyword">import</span> org.springframework.beans.factory.annotation.Autowired;</span><br><span class="line"><span class="keyword">import</span> org.springframework.stereotype.Controller;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.bind.annotation.PathVariable;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.bind.annotation.RequestMapping;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.bind.annotation.RequestMethod;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Controller</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">EmpController</span> &#123;</span><br><span class="line">    <span class="meta">@Autowired</span> <span class="comment">//自动装配</span></span><br><span class="line">    <span class="keyword">private</span> EmployeeDao employeeDao;</span><br><span class="line">    <span class="meta">@Autowired</span> <span class="comment">//自动装配</span></span><br><span class="line">    <span class="keyword">private</span> DepartmentDao departmentDao;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 获取所有的员工信息</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> map</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@RequestMapping(value=&quot;/emps&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">getAll</span><span class="params">(Map&lt;String, Object&gt; map)</span> &#123;</span><br><span class="line">        Collection&lt;Employee&gt; emps = employeeDao.getAll();</span><br><span class="line">        <span class="comment">//这里选择map也会转为ModelAndView对象，从而request能接收注入的参数</span></span><br><span class="line">        map.put(<span class="string">&quot;emps&quot;</span>, emps);<span class="comment">//参数emps传递到list.jsp视图中</span></span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;list&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * Old——跳转到添加页面</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@RequestMapping(value=&quot;/emp&quot;, method=RequestMethod.GET)</span></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">toAdd</span><span class="params">(Map&lt;String, Object&gt; map)</span> &#123;</span><br><span class="line">        Collection&lt;Department&gt; depts = departmentDao.getDepartments();</span><br><span class="line">        map.put(<span class="string">&quot;depts&quot;</span>, depts);<span class="comment">//参数depts传递到add.jsp视图中</span></span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;add&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * Old——添加员工信息</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> employee</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@RequestMapping(value=&quot;/emp&quot;, method=RequestMethod.POST)</span></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">addEmp</span><span class="params">(Employee employee)</span> &#123;</span><br><span class="line">        employeeDao.save(employee);<span class="comment">//调用employeeDao的保存方法</span></span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;redirect:/emps&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * Old——获取要回显的数据id，跳转到修改页面，并回显所有已选项</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> id</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> map</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@RequestMapping(value=&quot;/emp/&#123;id&#125;&quot;, method=RequestMethod.GET)</span></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">toUpdate</span><span class="params">(<span class="meta">@PathVariable(&quot;id&quot;)</span> Integer id, Map&lt;String, Object&gt; map)</span> &#123;</span><br><span class="line">        <span class="comment">//获取要修改的员工信息</span></span><br><span class="line">        <span class="type">Employee</span> <span class="variable">emp</span> <span class="operator">=</span> employeeDao.get(id);</span><br><span class="line">        <span class="comment">//所有的部门信息，供用户选择</span></span><br><span class="line">        Collection&lt;Department&gt; depts = departmentDao.getDepartments();</span><br><span class="line">        map.put(<span class="string">&quot;emp&quot;</span>, emp);</span><br><span class="line">        map.put(<span class="string">&quot;depts&quot;</span>, depts);</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;update&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * New——跳转到添加页面</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@RequestMapping(value=&quot;/emp&quot;, method=RequestMethod.GET)</span></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">toAdd</span><span class="params">(Map&lt;String, Object&gt; map)</span> &#123;</span><br><span class="line">        <span class="comment">//获取所有的部门信息</span></span><br><span class="line">        Collection&lt;Department&gt; depts = departmentDao.getDepartments();</span><br><span class="line">        <span class="comment">//创建存储性别gender的信息</span></span><br><span class="line">        Map&lt;String, String&gt; genders = <span class="keyword">new</span> <span class="title class_">HashMap</span>&lt;&gt;();</span><br><span class="line">        genders.put(<span class="string">&quot;0&quot;</span>, <span class="string">&quot;女&quot;</span>);</span><br><span class="line">        genders.put(<span class="string">&quot;1&quot;</span>, <span class="string">&quot;男&quot;</span>);</span><br><span class="line">        map.put(<span class="string">&quot;depts&quot;</span>, depts);</span><br><span class="line">        map.put(<span class="string">&quot;genders&quot;</span>, genders);</span><br><span class="line">        <span class="comment">//form标签有自动回显的功能，会在页面中能够默认获取request作用于中command属性的值</span></span><br><span class="line">        <span class="comment">//map.put(&quot;command&quot;, new Employee());</span></span><br><span class="line">        <span class="comment">//若在&lt;form:form&gt;设置了modelAttribute，就可以自定义回显对象的属性名</span></span><br><span class="line">        map.put(<span class="string">&quot;emp&quot;</span>, <span class="keyword">new</span> <span class="title class_">Employee</span>());</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;edit&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * New——添加员工信息</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> employee</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@RequestMapping(value=&quot;/emp&quot;, method=RequestMethod.POST)</span></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">addEmp</span><span class="params">(Employee employee)</span> &#123;<span class="comment">//employee接收员工信息</span></span><br><span class="line">        employeeDao.save(employee);</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;redirect:/emps&quot;</span>;<span class="comment">//使用重定向，防止用户多次提交</span></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * New——获取要回显的数据id，跳转到修改页面，并回显所有已选项</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> id</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> map</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@RequestMapping(value=&quot;/emp/&#123;id&#125;&quot;, method=RequestMethod.GET)</span></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">toUpdate</span><span class="params">(<span class="meta">@PathVariable(&quot;id&quot;)</span> Integer id, Map&lt;String, Object&gt; map)</span> &#123;</span><br><span class="line">        <span class="comment">//获取要修改的员工信息</span></span><br><span class="line">        <span class="type">Employee</span> <span class="variable">emp</span> <span class="operator">=</span> employeeDao.get(id);</span><br><span class="line">        <span class="comment">//所有的部门信息，供用户选择</span></span><br><span class="line">        Collection&lt;Department&gt; depts = departmentDao.getDepartments();</span><br><span class="line">        <span class="comment">//设置存储性别的map集合</span></span><br><span class="line">        Map&lt;String, String&gt; genders = <span class="keyword">new</span> <span class="title class_">HashMap</span>&lt;&gt;();</span><br><span class="line">        genders.put(<span class="string">&quot;0&quot;</span>, <span class="string">&quot;女&quot;</span>);</span><br><span class="line">        genders.put(<span class="string">&quot;1&quot;</span>, <span class="string">&quot;男&quot;</span>);</span><br><span class="line">        map.put(<span class="string">&quot;emp&quot;</span>, emp);</span><br><span class="line">        map.put(<span class="string">&quot;depts&quot;</span>, depts);</span><br><span class="line">        map.put(<span class="string">&quot;genders&quot;</span>, genders);</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;edit&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 修改员工信息</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> id</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> map</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@RequestMapping(value=&quot;/emp&quot;, method=RequestMethod.PUT)</span></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">updateEmp</span><span class="params">(Employee employee)</span> &#123;</span><br><span class="line">        employeeDao.save(employee);<span class="comment">//修改</span></span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;redirect:/emps&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 删除员工信息</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> id</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@RequestMapping(value=&quot;/emp/&#123;id&#125;&quot;,method=RequestMethod.DELETE)</span></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">deleteEmp</span><span class="params">(<span class="meta">@PathVariable(&quot;id&quot;)</span> Integer id)</span> &#123;</span><br><span class="line">        employeeDao.delete(id);<span class="comment">//删除</span></span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;redirect:/emps&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>View层：<br />
<div class="tabs" id="view"><ul class="nav-tabs"><li class="tab active"><a href="#view-1">index</a></li><li class="tab"><a href="#view-2">list</a></li><li class="tab"><a href="#view-3">add</a></li><li class="tab"><a href="#view-4">update</a></li><li class="tab"><a href="#view-5">edit</a></li></ul><div class="tab-content"><div class="tab-pane active" id="view-1"><figure class="highlight xml"><figcaption><span>index.jsp</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">&lt;%@ page language=&quot;java&quot; contentType=&quot;text/html; charset=UTF-8&quot; pageEncoding=&quot;UTF-8&quot;%&gt;</span><br><span class="line"><span class="meta">&lt;!DOCTYPE <span class="keyword">html</span> <span class="keyword">PUBLIC</span> <span class="string">&quot;-//W3C//DTD HTML 4.01 Transitional//EN&quot;</span> <span class="string">&quot;http://www.w3.org/TR/html4/loose.dtd&quot;</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">html</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">meta</span> <span class="attr">http-equiv</span>=<span class="string">&quot;Content-Type&quot;</span> <span class="attr">content</span>=<span class="string">&quot;text/html; charset=UTF-8&quot;</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">title</span>&gt;</span>欢迎<span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- 路由到/emps --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">&quot;emps&quot;</span>&gt;</span>员工信息<span class="tag">&lt;/<span class="name">a</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure></div><div class="tab-pane" id="view-2"><figure class="highlight xml"><figcaption><span>list.jsp</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br></pre></td><td class="code"><pre><span class="line">&lt;%@ page language=&quot;java&quot; contentType=&quot;text/html; charset=UTF-8&quot; pageEncoding=&quot;UTF-8&quot;%&gt;</span><br><span class="line"><span class="comment">&lt;!-- 引入taglib --&gt;</span></span><br><span class="line">&lt;%@ taglib uri=&quot;http://java.sun.com/jsp/jstl/core&quot; prefix=&quot;c&quot; %&gt;</span><br><span class="line"><span class="meta">&lt;!DOCTYPE <span class="keyword">html</span> <span class="keyword">PUBLIC</span> <span class="string">&quot;-//W3C//DTD HTML 4.01 Transitional//EN&quot;</span> <span class="string">&quot;http://www.w3.org/TR/html4/loose.dtd&quot;</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">html</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">meta</span> <span class="attr">http-equiv</span>=<span class="string">&quot;Content-Type&quot;</span> <span class="attr">content</span>=<span class="string">&quot;text/html; charset=UTF-8&quot;</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">title</span>&gt;</span>展示员工信息<span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line"><span class="comment">&lt;!-- 引入css --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">link</span> <span class="attr">rel</span>=<span class="string">&quot;stylesheet&quot;</span> <span class="attr">href</span>=<span class="string">&quot;$&#123;pageContext.servletContext.contextPath &#125;/css/index_work.css&quot;</span> /&gt;</span></span><br><span class="line"><span class="comment">&lt;!-- 引入js，通过class属性为删除绑定事件 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span> <span class="attr">type</span>=<span class="string">&quot;text/javascript&quot;</span> <span class="attr">src</span>=<span class="string">&quot;$&#123;pageContext.servletContext.contextPath &#125;/js/jquery-1.8.2.min.js&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span> <span class="attr">type</span>=<span class="string">&quot;text/javascript&quot;</span>&gt;</span><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">    $(<span class="keyword">function</span> (<span class="params"></span>) &#123;</span></span><br><span class="line"><span class="language-javascript">        $(<span class="string">&quot;.del&quot;</span>).<span class="title function_">click</span>(<span class="keyword">function</span> (<span class="params"></span>) &#123;</span></span><br><span class="line"><span class="language-javascript">            <span class="keyword">if</span>(<span class="title function_">confirm</span>(<span class="string">&quot;确认删除吗？&quot;</span>))&#123;</span></span><br><span class="line"><span class="language-javascript">                <span class="comment">//submit()将所获得的form元素提交</span></span></span><br><span class="line"><span class="language-javascript">                $(<span class="string">&quot;form&quot;</span>).<span class="title function_">attr</span>(<span class="string">&quot;action&quot;</span>, <span class="variable language_">this</span>.<span class="property">href</span>).<span class="title function_">submit</span>();<span class="comment">//$(this).attr(&quot;href&quot;)</span></span></span><br><span class="line"><span class="language-javascript">                <span class="keyword">return</span> <span class="literal">false</span>;</span></span><br><span class="line"><span class="language-javascript">            &#125;</span></span><br><span class="line"><span class="language-javascript">            <span class="keyword">return</span> <span class="literal">false</span>;<span class="comment">//将超链接的默认行为取消（不执行href的跳转）</span></span></span><br><span class="line"><span class="language-javascript">        &#125;);</span></span><br><span class="line"><span class="language-javascript">    &#125;);<span class="comment">//预加载函数或文档就绪函数</span></span></span><br><span class="line"><span class="language-javascript"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">table</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">tr</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">th</span>&gt;</span>ID<span class="tag">&lt;/<span class="name">th</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">th</span>&gt;</span>LASTNAME<span class="tag">&lt;/<span class="name">th</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">th</span>&gt;</span>EMAIL<span class="tag">&lt;/<span class="name">th</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">th</span>&gt;</span>GENDER<span class="tag">&lt;/<span class="name">th</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">th</span>&gt;</span>DEPARTMENTNAME<span class="tag">&lt;/<span class="name">th</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">th</span>&gt;</span>OPTION(<span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">&quot;emp&quot;</span>&gt;</span>ADD<span class="tag">&lt;/<span class="name">a</span>&gt;</span>)<span class="tag">&lt;/<span class="name">th</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">tr</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!-- 遍历传递到视图的emps --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">c:forEach</span> <span class="attr">items</span>=<span class="string">&quot;$&#123;emps&#125;&quot;</span> <span class="attr">var</span>=<span class="string">&quot;emp&quot;</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">tr</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">td</span>&gt;</span>$&#123;emp.id &#125;<span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">td</span>&gt;</span>$&#123;emp.lastName &#125;<span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">td</span>&gt;</span>$&#123;emp.email &#125;<span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">td</span>&gt;</span>$&#123;emp.gender==0?&#x27;女&#x27;:&#x27;男&#x27; &#125;<span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">td</span>&gt;</span>$&#123;emp.department.departmentName&#125;<span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">td</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">&quot;emp/$&#123;emp.id&#125;&quot;</span>&gt;</span>UPDATE<span class="tag">&lt;/<span class="name">a</span>&gt;</span></span><br><span class="line">                    <span class="comment">&lt;!-- 增加class属性，用来绑定事件，通过超链接控制form表单的提交 --&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">a</span> <span class="attr">class</span>=<span class="string">&quot;del&quot;</span> <span class="attr">href</span>=<span class="string">&quot;emp/$&#123;emp.id&#125;&quot;</span>&gt;</span>DELETE<span class="tag">&lt;/<span class="name">a</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">tr</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">c:forEach</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">table</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- 绑定的删除事件表单 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">form</span> <span class="attr">method</span>=<span class="string">&quot;post&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;hidden&quot;</span> <span class="attr">name</span>=<span class="string">&quot;_method&quot;</span> <span class="attr">value</span>=<span class="string">&quot;DELETE&quot;</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">form</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure></div><div class="tab-pane" id="view-3"><figure class="highlight xml"><figcaption><span>add.js</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br></pre></td><td class="code"><pre><span class="line">&lt;%@ page language=&quot;java&quot; contentType=&quot;text/html; charset=UTF-8&quot; pageEncoding=&quot;UTF-8&quot;%&gt;</span><br><span class="line">&lt;%@ taglib uri=&quot;http://java.sun.com/jsp/jstl/core&quot; prefix=&quot;c&quot; %&gt;</span><br><span class="line"><span class="meta">&lt;!DOCTYPE <span class="keyword">html</span> <span class="keyword">PUBLIC</span> <span class="string">&quot;-//W3C//DTD HTML 4.01 Transitional//EN&quot;</span> <span class="string">&quot;http://www.w3.org/TR/html4/loose.dtd&quot;</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">html</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">meta</span> <span class="attr">http-equiv</span>=<span class="string">&quot;Content-Type&quot;</span> <span class="attr">content</span>=<span class="string">&quot;text/html; charset=UTF-8&quot;</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">title</span>&gt;</span>添加员工信息<span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">link</span> <span class="attr">rel</span>=<span class="string">&quot;stylesheet&quot;</span> <span class="attr">href</span>=<span class="string">&quot;$&#123;pageContext.servletContext.contextPath &#125;/css/index_work.css&quot;</span> /&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- 表单POST --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">form</span> <span class="attr">action</span>=<span class="string">&quot;emp&quot;</span> <span class="attr">method</span>=<span class="string">&quot;post&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">table</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">tr</span>&gt;</span></span><br><span class="line">                <span class="comment">&lt;!-- 合并2行 --&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">th</span> <span class="attr">colspan</span>=<span class="string">&quot;2&quot;</span>&gt;</span>添加员工信息<span class="tag">&lt;/<span class="name">th</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">tr</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">tr</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">td</span>&gt;</span>LASTNAME<span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">td</span>&gt;</span></span><br><span class="line">                    <span class="comment">&lt;!-- name和员工的属性名要一致 --&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;text&quot;</span> <span class="attr">name</span>=<span class="string">&quot;lastName&quot;</span> /&gt;</span></span><br><span class="line">                <span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">tr</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">tr</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">td</span>&gt;</span>EMAIL<span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">td</span>&gt;</span></span><br><span class="line">                    <span class="comment">&lt;!-- name和员工的属性名要一致 --&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;text&quot;</span> <span class="attr">name</span>=<span class="string">&quot;email&quot;</span> /&gt;</span></span><br><span class="line">                <span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">tr</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">tr</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">td</span>&gt;</span>GENDER<span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">td</span>&gt;</span></span><br><span class="line">                    <span class="comment">&lt;!-- 单选框 --&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;radio&quot;</span> <span class="attr">name</span>=<span class="string">&quot;gender&quot;</span> <span class="attr">value</span>=<span class="string">&quot;1&quot;</span> /&gt;</span>男</span><br><span class="line">                    <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;radio&quot;</span> <span class="attr">name</span>=<span class="string">&quot;gender&quot;</span> <span class="attr">value</span>=<span class="string">&quot;0&quot;</span> /&gt;</span>女</span><br><span class="line">                <span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">tr</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">tr</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">td</span>&gt;</span>DEPARTMENT<span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">td</span>&gt;</span></span><br><span class="line">                    <span class="comment">&lt;!-- 下拉框 --&gt;</span></span><br><span class="line">                    <span class="comment">&lt;!-- department.id级联属性 --&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">select</span> <span class="attr">name</span>=<span class="string">&quot;department.id&quot;</span>&gt;</span></span><br><span class="line">                        <span class="tag">&lt;<span class="name">option</span>&gt;</span>-SELECT DEPARTMENT-<span class="tag">&lt;/<span class="name">option</span>&gt;</span></span><br><span class="line">                        <span class="comment">&lt;!-- 遍历部门depts参数显示可选项 --&gt;</span></span><br><span class="line">                        <span class="tag">&lt;<span class="name">c:forEach</span> <span class="attr">items</span>=<span class="string">&quot;$&#123;depts &#125;&quot;</span> <span class="attr">var</span>=<span class="string">&quot;dept&quot;</span>&gt;</span></span><br><span class="line">                            <span class="tag">&lt;<span class="name">option</span> <span class="attr">value</span>=<span class="string">&quot;$&#123;dept.id &#125;&quot;</span>&gt;</span>$&#123;dept.departmentName &#125;<span class="tag">&lt;/<span class="name">option</span>&gt;</span></span><br><span class="line">                        <span class="tag">&lt;/<span class="name">c:forEach</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;/<span class="name">select</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">tr</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">tr</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">td</span> <span class="attr">colspan</span>=<span class="string">&quot;2&quot;</span>&gt;</span></span><br><span class="line">                    <span class="comment">&lt;!-- 提交表单 --&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;submit&quot;</span> <span class="attr">value</span>=<span class="string">&quot;ADD&quot;</span> /&gt;</span></span><br><span class="line">                <span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">tr</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">table</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">form</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure></div><div class="tab-pane" id="view-4"><figure class="highlight xml"><figcaption><span>update.jsp</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br></pre></td><td class="code"><pre><span class="line">&lt;%@ page language=&quot;java&quot; contentType=&quot;text/html; charset=UTF-8&quot; pageEncoding=&quot;UTF-8&quot;%&gt;</span><br><span class="line">&lt;%@ taglib uri=&quot;http://java.sun.com/jsp/jstl/core&quot; prefix=&quot;c&quot; %&gt;</span><br><span class="line"><span class="meta">&lt;!DOCTYPE <span class="keyword">html</span> <span class="keyword">PUBLIC</span> <span class="string">&quot;-//W3C//DTD HTML 4.01 Transitional//EN&quot;</span> <span class="string">&quot;http://www.w3.org/TR/html4/loose.dtd&quot;</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">html</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">meta</span> <span class="attr">http-equiv</span>=<span class="string">&quot;Content-Type&quot;</span> <span class="attr">content</span>=<span class="string">&quot;text/html; charset=UTF-8&quot;</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">title</span>&gt;</span>修改员工信息<span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">link</span> <span class="attr">rel</span>=<span class="string">&quot;stylesheet&quot;</span> <span class="attr">href</span>=<span class="string">&quot;$&#123;pageContext.servletContext.contextPath &#125;/css/index_work.css&quot;</span> /&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- 表单设置为绝对路径，不然访问的是相对路径/emp/emp了 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">form</span> <span class="attr">action</span>=<span class="string">&quot;$&#123;pageContext.servletContext.contextPath &#125;/emp&quot;</span> <span class="attr">method</span>=<span class="string">&quot;post&quot;</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!-- input标签的hidden隐藏元素，该标签的属性和值随着表填也提交，只是对用户是隐藏的 --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;hidden&quot;</span> <span class="attr">name</span>=<span class="string">&quot;id&quot;</span> <span class="attr">value</span>=<span class="string">&quot;$&#123;emp.id &#125;&quot;</span> /&gt;</span></span><br><span class="line">        <span class="comment">&lt;!-- 添加_method，转换POST为PUT（1.请求为POST; 2.传递一个名为_method的值） --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;hidden&quot;</span> <span class="attr">name</span>=<span class="string">&quot;_method&quot;</span> <span class="attr">value</span>=<span class="string">&quot;PUT&quot;</span> /&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">table</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">tr</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">th</span> <span class="attr">colspan</span>=<span class="string">&quot;2&quot;</span>&gt;</span>修改员工信息<span class="tag">&lt;/<span class="name">th</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">tr</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">tr</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">td</span>&gt;</span>LASTNAME<span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">td</span>&gt;</span></span><br><span class="line">                    <span class="comment">&lt;!-- value显示要修改的信息 --&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;text&quot;</span> <span class="attr">name</span>=<span class="string">&quot;lastName&quot;</span> <span class="attr">value</span>=<span class="string">&quot;$&#123;emp.lastName &#125;&quot;</span> /&gt;</span></span><br><span class="line">                <span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">tr</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">tr</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">td</span>&gt;</span>EMAIL<span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">td</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;text&quot;</span> <span class="attr">name</span>=<span class="string">&quot;email&quot;</span> <span class="attr">value</span>=<span class="string">&quot;$&#123;emp.email &#125;&quot;</span> /&gt;</span></span><br><span class="line">                <span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">tr</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">tr</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">td</span>&gt;</span>GENDER<span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">td</span>&gt;</span></span><br><span class="line">                    <span class="comment">&lt;!-- 增加回显checked --&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;radio&quot;</span> <span class="attr">name</span>=<span class="string">&quot;gender&quot;</span> <span class="attr">value</span>=<span class="string">&quot;1&quot;</span> $&#123;<span class="attr">emp.gender</span> == <span class="string">1?</span>&#x27;<span class="attr">checked</span>&#x27;<span class="attr">:</span>&#x27;&#x27; &#125; /&gt;</span>男</span><br><span class="line">                    <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;radio&quot;</span> <span class="attr">name</span>=<span class="string">&quot;gender&quot;</span> <span class="attr">value</span>=<span class="string">&quot;0&quot;</span> $&#123;<span class="attr">emp.gender</span> == <span class="string">0?</span>&#x27;<span class="attr">checked</span>&#x27;<span class="attr">:</span>&#x27;&#x27; &#125; /&gt;</span>女</span><br><span class="line">                <span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">tr</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">tr</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">td</span>&gt;</span>DEPARTMENT<span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">td</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">select</span> <span class="attr">name</span>=<span class="string">&quot;department.id&quot;</span>&gt;</span></span><br><span class="line">                        <span class="tag">&lt;<span class="name">option</span>&gt;</span>-SELECT DEPARTMENT-<span class="tag">&lt;/<span class="name">option</span>&gt;</span></span><br><span class="line">                        <span class="tag">&lt;<span class="name">c:forEach</span> <span class="attr">items</span>=<span class="string">&quot;$&#123;depts &#125;&quot;</span> <span class="attr">var</span>=<span class="string">&quot;dept&quot;</span>&gt;</span></span><br><span class="line">                            <span class="comment">&lt;!-- 增加回显selected --&gt;</span></span><br><span class="line">                            <span class="tag">&lt;<span class="name">option</span> <span class="attr">value</span>=<span class="string">&quot;$&#123;dept.id &#125;&quot;</span> $&#123;<span class="attr">dept.id</span> == <span class="string">emp.department.id?</span>&#x27;<span class="attr">selected</span>&#x27;<span class="attr">:</span>&#x27;&#x27; &#125;&gt;</span>$&#123;dept.departmentName &#125;<span class="tag">&lt;/<span class="name">option</span>&gt;</span></span><br><span class="line">                        <span class="tag">&lt;/<span class="name">c:forEach</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;/<span class="name">select</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">tr</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">tr</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">td</span> <span class="attr">colspan</span>=<span class="string">&quot;2&quot;</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;submit&quot;</span> <span class="attr">value</span>=<span class="string">&quot;UPDATE&quot;</span> /&gt;</span></span><br><span class="line">                <span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">tr</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">table</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">form</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure></div><div class="tab-pane" id="view-5"><figure class="highlight xml"><figcaption><span>edit.jsp</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br></pre></td><td class="code"><pre><span class="line">&lt;%@ page language=&quot;java&quot; contentType=&quot;text/html; charset=UTF-8&quot; pageEncoding=&quot;UTF-8&quot;%&gt;</span><br><span class="line"><span class="comment">&lt;!-- 引入c和form标签 --&gt;</span></span><br><span class="line">&lt;%@ taglib uri=&quot;http://java.sun.com/jsp/jstl/core&quot; prefix=&quot;c&quot; %&gt;</span><br><span class="line">&lt;%@ taglib uri=&quot;http://www.springframework.org/tags/form&quot; prefix=&quot;form&quot; %&gt;</span><br><span class="line"><span class="meta">&lt;!DOCTYPE <span class="keyword">html</span> <span class="keyword">PUBLIC</span> <span class="string">&quot;-//W3C//DTD HTML 4.01 Transitional//EN&quot;</span> <span class="string">&quot;http://www.w3.org/TR/html4/loose.dtd&quot;</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">html</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">meta</span> <span class="attr">http-equiv</span>=<span class="string">&quot;Content-Type&quot;</span> <span class="attr">content</span>=<span class="string">&quot;text/html; charset=UTF-8&quot;</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">title</span>&gt;</span>编辑员工信息<span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">link</span> <span class="attr">rel</span>=<span class="string">&quot;stylesheet&quot;</span> <span class="attr">href</span>=<span class="string">&quot;$&#123;pageContext.servletContext.contextPath &#125;/css/index_work.css&quot;</span> /&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- modelAttribute可以自定义回显对象的属性名，默认为command --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">form:form</span> <span class="attr">action</span>=<span class="string">&quot;$&#123;pageContext.servletContext.contextPath &#125;/emp&quot;</span> <span class="attr">method</span>=<span class="string">&quot;post&quot;</span> <span class="attr">modelAttribute</span>=<span class="string">&quot;emp&quot;</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!-- 添加不需要回显标签，修改需要有回显标签，使用flag控制标签 --&gt;</span></span><br><span class="line">        <span class="comment">&lt;!-- empty判断后面变量是否为空，并赋值给var指定的变量flag --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">c:if</span> <span class="attr">test</span>=<span class="string">&quot;$&#123;empty emp.id &#125;&quot;</span> <span class="attr">var</span>=<span class="string">&quot;flag&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">c:if</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">c:if</span> <span class="attr">test</span>=<span class="string">&quot;$&#123;!flag &#125;&quot;</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">form:hidden</span> <span class="attr">path</span>=<span class="string">&quot;id&quot;</span>/&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;hidden&quot;</span> <span class="attr">name</span>=<span class="string">&quot;_method&quot;</span> <span class="attr">value</span>=<span class="string">&quot;PUT&quot;</span> /&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">c:if</span>&gt;</span></span><br><span class="line">        </span><br><span class="line">        <span class="tag">&lt;<span class="name">table</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">tr</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">th</span> <span class="attr">colspan</span>=<span class="string">&quot;2&quot;</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">c:if</span> <span class="attr">test</span>=<span class="string">&quot;$&#123;flag &#125;&quot;</span>&gt;</span>添加员工信息<span class="tag">&lt;/<span class="name">c:if</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">c:if</span> <span class="attr">test</span>=<span class="string">&quot;$&#123;!flag &#125;&quot;</span>&gt;</span>修改员工信息<span class="tag">&lt;/<span class="name">c:if</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;/<span class="name">th</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">tr</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">tr</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">td</span>&gt;</span>LASTNAME<span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">td</span>&gt;</span></span><br><span class="line">                    <span class="comment">&lt;!-- path相当于原来的name --&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">form:input</span> <span class="attr">path</span>=<span class="string">&quot;lastName&quot;</span>/&gt;</span></span><br><span class="line">                <span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">tr</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">tr</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">td</span>&gt;</span>EMAIL<span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">td</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">form:input</span> <span class="attr">path</span>=<span class="string">&quot;email&quot;</span>/&gt;</span></span><br><span class="line">                <span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">tr</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">tr</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">td</span>&gt;</span>GENDER<span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">td</span>&gt;</span></span><br><span class="line">                    <span class="comment">&lt;!-- items自动遍历map集合内容，map的key作为原先的标签的value值， map的value作为展示的内容--&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">form:radiobuttons</span> <span class="attr">path</span>=<span class="string">&quot;gender&quot;</span> <span class="attr">items</span>=<span class="string">&quot;$&#123;genders &#125;&quot;</span>/&gt;</span></span><br><span class="line">                <span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">tr</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">tr</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">td</span>&gt;</span>DEPARTMENT<span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">td</span>&gt;</span></span><br><span class="line">                    <span class="comment">&lt;!-- itemValue为原先标签的value，itemLabel为展示内容 --&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">form:select</span> <span class="attr">path</span>=<span class="string">&quot;department.id&quot;</span> <span class="attr">items</span>=<span class="string">&quot;$&#123;depts &#125;&quot;</span> <span class="attr">itemValue</span>=<span class="string">&quot;id&quot;</span> <span class="attr">itemLabel</span>=<span class="string">&quot;departmentName&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">form:select</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">tr</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">tr</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">td</span> <span class="attr">colspan</span>=<span class="string">&quot;2&quot;</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">c:if</span> <span class="attr">test</span>=<span class="string">&quot;$&#123;flag &#125;&quot;</span>&gt;</span></span><br><span class="line">                        <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;submit&quot;</span> <span class="attr">value</span>=<span class="string">&quot;ADD&quot;</span> /&gt;</span></span><br><span class="line">                    <span class="tag">&lt;/<span class="name">c:if</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">c:if</span> <span class="attr">test</span>=<span class="string">&quot;$&#123;!flag &#125;&quot;</span>&gt;</span></span><br><span class="line">                        <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;submit&quot;</span> <span class="attr">value</span>=<span class="string">&quot;UPDATE&quot;</span> /&gt;</span></span><br><span class="line">                    <span class="tag">&lt;/<span class="name">c:if</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">tr</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">table</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">form:form</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure></div></div></div></p>
<h3 id="处理json">处理JSON</h3>
<p>1.加入处理JSON的jar包：<br />
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">jackson-annotations-2.1.5.jar</span><br><span class="line">jackson-core-2.1.5.jar</span><br><span class="line">jackson-databind-2.1.5.jar</span><br></pre></td></tr></table></figure></p>
<p>2.springMVC.xml开启mvc驱动：<br />
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">mvc:annotation-driven</span> /&gt;</span></span><br></pre></td></tr></table></figure></p>
<p>3.处理方法，使其返回JSON对应的对象或集合：<br />
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.example.test;</span><br><span class="line"><span class="keyword">import</span> com.example.bean.Employee;</span><br><span class="line"><span class="keyword">import</span> com.example.dao.EmployeeDao;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.util.Collection;</span><br><span class="line"><span class="keyword">import</span> org.springframework.beans.factory.annotation.Autowired;</span><br><span class="line"><span class="keyword">import</span> org.springframework.stereotype.Controller;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.bind.annotation.RequestMapping;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.bind.annotation.ResponseBody;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Controller</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">TestJsonController</span> &#123;</span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> EmployeeDao dao;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * springMVC处理json的四个条件：</span></span><br><span class="line"><span class="comment">     * 1.导入jackson的jar</span></span><br><span class="line"><span class="comment">     * 2.在springMVC的配置文件中开启MVC驱动，&lt;mvc:annotation-driven /&gt;</span></span><br><span class="line"><span class="comment">     * 3.在处理ajax请求的方法上加上注解<span class="doctag">@ResponseBody</span></span></span><br><span class="line"><span class="comment">     * 4.将要转换为json且响应到客户端的数据，直接作为该方法的返回值返回</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@ResponseBody</span></span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@RequestMapping(&quot;/testJson&quot;)</span></span><br><span class="line">    <span class="meta">@ResponseBody</span> <span class="comment">//加上后，return返回的不被当作视图处理，而是但当作body信息返回</span></span><br><span class="line">    <span class="keyword">public</span> Collection&lt;Employee&gt; <span class="title function_">testJson</span><span class="params">()</span> &#123;</span><br><span class="line">        Collection&lt;Employee&gt; emps = dao.getAll();</span><br><span class="line">        <span class="keyword">return</span> emps; <span class="comment">//jackson会自动把java对象转为json</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<h3 id="上传下载拦截">上传下载拦截</h3>
<p>自定义拦截器：<br />
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">|-实现HandlerInterceptor接口（<span class="number">3</span>个方法都要重写）/继承HandlerInterceptorAdapter适配器类（<span class="number">3</span>个方法不需要都重写）。</span><br><span class="line">    |-preHandle()：在业务处理器处理请求之前被调用，在该方法中对用户请求 request 进行处理。</span><br><span class="line">        |-如果觉得该拦截器对请求进行拦截处理后，还要调用其他的拦截器/业务处理器去进行处理，则返回<span class="literal">true</span>；</span><br><span class="line">        |-如果觉得不需要再调用其他的组件去处理请求，则返回<span class="literal">false</span>。</span><br><span class="line">    |-postHandle()：在业务处理器处理完请求后，但是DispatcherServlet向客户端返回响应前被调用，在该方法中对用户请求request进行处理。</span><br><span class="line">    |-afterCompletion()：在DispatcherServlet完全处理完请求后被调用（类似<span class="keyword">finally</span>），可以在该方法中进行一些资源清理的操作。</span><br></pre></td></tr></table></figure></p>
<div class="tabs" id="上传下载"><ul class="nav-tabs"><li class="tab active"><a href="#上传下载-1">springMVC配置</a></li><li class="tab"><a href="#上传下载-2">前端页面</a></li><li class="tab"><a href="#上传下载-3">下载上传</a></li><li class="tab"><a href="#上传下载-4">拦截器（单个）</a></li><li class="tab"><a href="#上传下载-5">拦截器（多个）</a></li><li class="tab"><a href="#上传下载-6">测试拦截器（执行顺序）</a></li></ul><div class="tab-content"><div class="tab-pane active" id="上传下载-1"><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version=<span class="string">&quot;1.0&quot;</span> encoding=<span class="string">&quot;UTF-8&quot;</span>?&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">beans</span> <span class="attr">xmlns</span>=<span class="string">&quot;http://www.springframework.org/schema/beans&quot;</span></span></span><br><span class="line"><span class="tag">    <span class="attr">xmlns:xsi</span>=<span class="string">&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span></span></span><br><span class="line"><span class="tag">    <span class="attr">xmlns:context</span>=<span class="string">&quot;http://www.springframework.org/schema/context&quot;</span></span></span><br><span class="line"><span class="tag">    <span class="attr">xmlns:mvc</span>=<span class="string">&quot;http://www.springframework.org/schema/mvc&quot;</span></span></span><br><span class="line"><span class="tag">    <span class="attr">xsi:schemaLocation</span>=<span class="string">&quot;http://www.springframework.org/schema/mvc </span></span></span><br><span class="line"><span class="string"><span class="tag">        http://www.springframework.org/schema/mvc/spring-mvc-4.0.xsd</span></span></span><br><span class="line"><span class="string"><span class="tag">        http://www.springframework.org/schema/beans </span></span></span><br><span class="line"><span class="string"><span class="tag">        http://www.springframework.org/schema/beans/spring-beans.xsd</span></span></span><br><span class="line"><span class="string"><span class="tag">        http://www.springframework.org/schema/context </span></span></span><br><span class="line"><span class="string"><span class="tag">        http://www.springframework.org/schema/context/spring-context-4.0.xsd&quot;</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- 1 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">context:component-scan</span> <span class="attr">base-package</span>=<span class="string">&quot;com.example&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">context:component-scan</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- 2 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">bean</span> <span class="attr">class</span>=<span class="string">&quot;org.springframework.web.servlet.view.InternalResourceViewResolver&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;prefix&quot;</span> <span class="attr">value</span>=<span class="string">&quot;/WEB-INF/view/&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;suffix&quot;</span> <span class="attr">value</span>=<span class="string">&quot;.jsp&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- 3 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">mvc:default-servlet-handler</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">mvc:annotation-driven</span> /&gt;</span></span><br><span class="line">    </span><br><span class="line">    <span class="comment">&lt;!-- </span></span><br><span class="line"><span class="comment">        4.上传下载：将客户端上传的File文件，转换为MultipartFile。</span></span><br><span class="line"><span class="comment">        注意：文件解析器的bean中id必须设置为multipartResolver。</span></span><br><span class="line"><span class="comment">     --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">&quot;multipartResolver&quot;</span> <span class="attr">class</span>=<span class="string">&quot;org.springframework.web.multipart.commons.CommonsMultipartResolver&quot;</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!-- 设置文件解析的编码，注意：一定要和页面的pageEncoding保持一致 --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;defaultEncoding&quot;</span> <span class="attr">value</span>=<span class="string">&quot;UTF-8&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!-- 设置最大上传文件大小，一定是具体的值，不能1024*1024这种写法，单位为字节 --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;maxUploadSize&quot;</span> <span class="attr">value</span>=<span class="string">&quot;88888888&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">&lt;!-- 5.拦截器配置 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">mvc:interceptors</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!-- 1.第一种：默认拦截所有请求 --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">bean</span> <span class="attr">class</span>=<span class="string">&quot;com.example.interceptor.FirstInterceptor&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">bean</span> <span class="attr">class</span>=<span class="string">&quot;com.example.interceptor.SecondInterceptor&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!-- 2.第二种：默认拦截所有请求，要求拦截器类上必须加注解@Component --&gt;</span></span><br><span class="line">        <span class="comment">&lt;!-- &lt;ref bean=&quot;firstInterceptor&quot;/&gt; --&gt;</span></span><br><span class="line">        </span><br><span class="line">        <span class="comment">&lt;!-- 3.设置自定义拦截方式 --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">mvc:interceptor</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">bean</span>&gt;</span><span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br><span class="line">            <span class="comment">&lt;!-- 需要映射拦截的请求 --&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">mvc:mapping</span> <span class="attr">path</span>=<span class="string">&quot;&quot;</span>/&gt;</span></span><br><span class="line">            <span class="comment">&lt;!-- 不需要映射拦截的请求 --&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">mvc:exclude-mapping</span> <span class="attr">path</span>=<span class="string">&quot;&quot;</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">mvc:interceptor</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">mvc:interceptors</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">beans</span>&gt;</span></span><br></pre></td></tr></table></figure></div><div class="tab-pane" id="上传下载-2"><figure class="highlight xml"><figcaption><span>WebContent/file.jsp</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">&lt;%@ page language=&quot;java&quot; contentType=&quot;text/html; charset=UTF-8&quot; pageEncoding=&quot;UTF-8&quot;%&gt;</span><br><span class="line"><span class="meta">&lt;!DOCTYPE <span class="keyword">html</span> <span class="keyword">PUBLIC</span> <span class="string">&quot;-//W3C//DTD HTML 4.01 Transitional//EN&quot;</span> <span class="string">&quot;http://www.w3.org/TR/html4/loose.dtd&quot;</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">html</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">meta</span> <span class="attr">http-equiv</span>=<span class="string">&quot;Content-Type&quot;</span> <span class="attr">content</span>=<span class="string">&quot;text/html; charset=UTF-8&quot;</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">title</span>&gt;</span>Insert title here<span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- 上传 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">&quot;down&quot;</span>&gt;</span>下载图片<span class="tag">&lt;/<span class="name">a</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- 下载 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">form</span> <span class="attr">action</span>=<span class="string">&quot;up&quot;</span> <span class="attr">method</span>=<span class="string">&quot;post&quot;</span> <span class="attr">enctype</span>=<span class="string">&quot;multipart/form-data&quot;</span>&gt;</span></span><br><span class="line">        头像1：<span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;file&quot;</span> <span class="attr">name</span>=<span class="string">&quot;uploadFile&quot;</span> /&gt;</span></span><br><span class="line">        <span class="comment">&lt;!-- 头像2：&lt;input type=&quot;file&quot; name=&quot;uploadFile&quot; /&gt; --&gt;</span></span><br><span class="line">        描述：<span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;text&quot;</span> <span class="attr">name</span>=<span class="string">&quot;desc&quot;</span> /&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;submit&quot;</span> <span class="attr">value</span>=<span class="string">&quot;上传&quot;</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">form</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure></div><div class="tab-pane" id="上传下载-3"><figure class="highlight java"><figcaption><span>TestUploadAndDownController.java</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.example.test;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.io.File;</span><br><span class="line"><span class="keyword">import</span> java.io.FileInputStream;</span><br><span class="line"><span class="keyword">import</span> java.io.FileOutputStream;</span><br><span class="line"><span class="keyword">import</span> java.io.IOException;</span><br><span class="line"><span class="keyword">import</span> java.io.InputStream;</span><br><span class="line"><span class="keyword">import</span> java.io.OutputStream;</span><br><span class="line"><span class="keyword">import</span> java.util.UUID;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.http.HttpSession;</span><br><span class="line"><span class="keyword">import</span> org.springframework.http.HttpHeaders;</span><br><span class="line"><span class="keyword">import</span> org.springframework.http.HttpStatus;</span><br><span class="line"><span class="keyword">import</span> org.springframework.http.ResponseEntity;</span><br><span class="line"><span class="keyword">import</span> org.springframework.stereotype.Controller;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.bind.annotation.RequestMapping;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.bind.annotation.RequestMethod;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.multipart.MultipartFile;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Controller</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">TestUploadAndDownController</span> &#123;</span><br><span class="line">    <span class="comment">//返回一个响应实体ResponseEntity，把图片当成实体返回给客户端，就可以实现下载功能</span></span><br><span class="line">    <span class="meta">@RequestMapping(&quot;/down&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> ResponseEntity&lt;<span class="type">byte</span>[]&gt; down(HttpSession session) <span class="keyword">throws</span> IOException&#123;</span><br><span class="line">        <span class="comment">//获取下载文件的路径（需通过session获取服务器图片路径）</span></span><br><span class="line">        <span class="comment">//getServletContext获取serverlet上下文</span></span><br><span class="line">        <span class="comment">//getRealPath(&quot;&quot;)获取项目路径（..\SpringMVC04）</span></span><br><span class="line">        <span class="comment">//getRealPath(&quot;img&quot;)获取项目下文件路径（..\SpringMVC04\img）</span></span><br><span class="line">        <span class="type">String</span> <span class="variable">realPath</span> <span class="operator">=</span> session.getServletContext().getRealPath(<span class="string">&quot;img&quot;</span>);<span class="comment">//文件夹路径</span></span><br><span class="line">        <span class="type">String</span> <span class="variable">finalPath</span> <span class="operator">=</span> realPath + File.separator + <span class="string">&quot;2.jpg&quot;</span>;<span class="comment">//最终路径</span></span><br><span class="line">        <span class="type">InputStream</span> <span class="variable">is</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">FileInputStream</span>(finalPath);</span><br><span class="line">        </span><br><span class="line">        <span class="type">byte</span>[] b = <span class="keyword">new</span> <span class="title class_">byte</span>[is.available()];<span class="comment">//available():获取输入流所读取的文件的最大字节数</span></span><br><span class="line">        is.read(b);<span class="comment">//将输入流读入到b数组中</span></span><br><span class="line">        <span class="type">HttpHeaders</span> <span class="variable">headers</span> <span class="operator">=</span> <span class="keyword">new</span>  <span class="title class_">HttpHeaders</span>();<span class="comment">//设置请求头</span></span><br><span class="line">        headers.add(<span class="string">&quot;Content-Disposition&quot;</span>, <span class="string">&quot;attachment;filename=zzz.jpg&quot;</span>);<span class="comment">//添加请求头信息，默认下载名字为zzz.jpg</span></span><br><span class="line">        <span class="type">HttpStatus</span> <span class="variable">statusCode</span> <span class="operator">=</span> HttpStatus.OK;<span class="comment">//设置响应状态</span></span><br><span class="line">        ResponseEntity&lt;<span class="type">byte</span>[]&gt; entity = <span class="keyword">new</span> <span class="title class_">ResponseEntity</span>&lt;<span class="type">byte</span>[]&gt;(b, headers, statusCode);</span><br><span class="line">        <span class="keyword">return</span> entity;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">//上传需springMVC配置MultipartResolver</span></span><br><span class="line">    <span class="comment">//如果有多个重复的input标签，可以用&quot;MultipartFile[] uploadFile&quot;数组方式接收，之后遍历即可</span></span><br><span class="line">    <span class="meta">@RequestMapping(value=&quot;/up&quot;, method=RequestMethod.POST)</span></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">up</span><span class="params">(String desc, MultipartFile uploadFile, HttpSession session)</span> <span class="keyword">throws</span> IOException &#123;</span><br><span class="line">        <span class="type">String</span> <span class="variable">fileName</span> <span class="operator">=</span> uploadFile.getOriginalFilename();<span class="comment">//获取上传文件的名字</span></span><br><span class="line">        <span class="type">String</span> <span class="variable">finalFileName</span> <span class="operator">=</span> UUID.randomUUID() + fileName.substring(fileName.lastIndexOf(<span class="string">&quot;.&quot;</span>));<span class="comment">//随机名+.后缀，防止文件重名</span></span><br><span class="line">        <span class="type">String</span> <span class="variable">path</span> <span class="operator">=</span> session.getServletContext().getRealPath(<span class="string">&quot;photo&quot;</span>) + File.separator + finalFileName;<span class="comment">//文件输出路径</span></span><br><span class="line"></span><br><span class="line">        <span class="type">File</span> <span class="variable">file</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">File</span>(path);<span class="comment">//需要通过路径</span></span><br><span class="line">        uploadFile.transferTo(file);<span class="comment">//上传：把uploadFile转换为file路径</span></span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;success&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">//上传需springMVC配置MultipartResolver</span></span><br><span class="line">    <span class="meta">@RequestMapping(value=&quot;/up_old&quot;, method=RequestMethod.POST)</span></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">up_old</span><span class="params">(String desc, MultipartFile uploadFile, HttpSession session)</span> <span class="keyword">throws</span> IOException &#123;</span><br><span class="line">        <span class="type">String</span> <span class="variable">fileName</span> <span class="operator">=</span> uploadFile.getOriginalFilename();<span class="comment">//获取上传文件的名字</span></span><br><span class="line">        <span class="type">String</span> <span class="variable">path</span> <span class="operator">=</span> session.getServletContext().getRealPath(<span class="string">&quot;photo&quot;</span>) + File.separator + fileName;<span class="comment">//文件输出路径</span></span><br><span class="line">        </span><br><span class="line">        <span class="type">InputStream</span> <span class="variable">is</span> <span class="operator">=</span> uploadFile.getInputStream();<span class="comment">//获取输入流</span></span><br><span class="line">        <span class="type">File</span> <span class="variable">file</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">File</span>(path);<span class="comment">//FileOutputStream通过路径创建</span></span><br><span class="line">        <span class="type">OutputStream</span> <span class="variable">os</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">FileOutputStream</span>(file);<span class="comment">//获取输出流</span></span><br><span class="line"></span><br><span class="line">        <span class="comment">//第一种：从输入流每次一个字节写入到输出流</span></span><br><span class="line">        <span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">while</span>((i = is.read()) != -<span class="number">1</span>) &#123;</span><br><span class="line">            os.write(i);</span><br><span class="line">        &#125;</span><br><span class="line">        </span><br><span class="line">        <span class="comment">//第二种：从输入流每次一个数组字节写入到输出流</span></span><br><span class="line">        <span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>;</span><br><span class="line">        <span class="type">byte</span>[] b = <span class="keyword">new</span> <span class="title class_">byte</span>[<span class="number">1024</span>];</span><br><span class="line">        <span class="keyword">while</span>((i = is.read(b)) != -<span class="number">1</span>) &#123;</span><br><span class="line">            os.write(b, <span class="number">0</span>, i);</span><br><span class="line">        &#125;</span><br><span class="line">        </span><br><span class="line">        os.close();</span><br><span class="line">        is.close();</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;success&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div><div class="tab-pane" id="上传下载-4"><figure class="highlight java"><figcaption><span>FirstInterceptor.java</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.example.interceptor;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.http.HttpServletRequest;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.http.HttpServletResponse;</span><br><span class="line"><span class="keyword">import</span> org.springframework.stereotype.Component;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.servlet.HandlerInterceptor;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.servlet.ModelAndView;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">FirstInterceptor</span> <span class="keyword">implements</span> <span class="title class_">HandlerInterceptor</span> &#123;<span class="comment">//重写HandlerInterceptor</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="type">boolean</span> <span class="title function_">preHandle</span><span class="params">(HttpServletRequest request, HttpServletResponse response, Object handler)</span></span><br><span class="line">            <span class="keyword">throws</span> Exception &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;First:preHandle&quot;</span>);</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">postHandle</span><span class="params">(HttpServletRequest request, HttpServletResponse response, Object handler,</span></span><br><span class="line"><span class="params">            ModelAndView modelAndView)</span> <span class="keyword">throws</span> Exception &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;First:postHandle&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">afterCompletion</span><span class="params">(HttpServletRequest request, HttpServletResponse response, Object handler, </span></span><br><span class="line"><span class="params">            Exception ex)</span> <span class="keyword">throws</span> Exception &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;First:afterCompletion&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div><div class="tab-pane" id="上传下载-5"><figure class="highlight java"><figcaption><span>SecondInterceptor.java</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.example.interceptor;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.http.HttpServletRequest;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.http.HttpServletResponse;</span><br><span class="line"><span class="keyword">import</span> org.springframework.stereotype.Component;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.servlet.HandlerInterceptor;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.servlet.ModelAndView;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">SecondInterceptor</span> <span class="keyword">implements</span> <span class="title class_">HandlerInterceptor</span> &#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="type">boolean</span> <span class="title function_">preHandle</span><span class="params">(HttpServletRequest request, HttpServletResponse response, Object handler)</span></span><br><span class="line">            <span class="keyword">throws</span> Exception &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;Second:preHandle&quot;</span>);</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">postHandle</span><span class="params">(HttpServletRequest request, HttpServletResponse response, Object handler,</span></span><br><span class="line"><span class="params">            ModelAndView modelAndView)</span> <span class="keyword">throws</span> Exception &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;Second:postHandle&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">afterCompletion</span><span class="params">(HttpServletRequest request, HttpServletResponse response, Object handler, </span></span><br><span class="line"><span class="params">            Exception ex)</span> <span class="keyword">throws</span> Exception &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;Second:afterCompletion&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div><div class="tab-pane" id="上传下载-6"><figure class="highlight java"><figcaption><span>TestInterceptorController.java</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.example.test;</span><br><span class="line"><span class="keyword">import</span> org.springframework.stereotype.Controller;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.bind.annotation.RequestMapping;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Controller</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">TestInterceptorController</span> &#123;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 当有&quot;多个&quot;拦截器时：</span></span><br><span class="line"><span class="comment">     * 1.preHandle：按照拦截器数组的&quot;正向&quot;顺序执行。</span></span><br><span class="line"><span class="comment">     * 2.postHandle：按照拦截器数组的&quot;反向&quot;顺序执行。</span></span><br><span class="line"><span class="comment">     * 3.afterCompletion：按照拦截器数组的&quot;反向&quot;顺序执行。</span></span><br><span class="line"><span class="comment">     * </span></span><br><span class="line"><span class="comment">     * 当&quot;多个&quot;拦截器的preHandle有不同的值时：</span></span><br><span class="line"><span class="comment">     * 1.第一个返回false，第二个返回false：只有第一个preHandle会执行。</span></span><br><span class="line"><span class="comment">     * 2.第一个返回true，第二个返回false：两个（全部）拦截器的preHandle都会执行。</span></span><br><span class="line"><span class="comment">     *   此时（全部）postHandle都不会执行，</span></span><br><span class="line"><span class="comment">     *   而afterCompletion只有第一个（返回false的拦截器之前的所有afterCompletion）会执行。</span></span><br><span class="line"><span class="comment">     * 3.第一个返回false，第二个返回truee：只有第一个的preHandle会执行。</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@RequestMapping(&quot;/testInterceptor&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">testInterceptor</span><span class="params">()</span> &#123;</span><br><span class="line">        System.out.println(<span class="number">1</span>/<span class="number">0</span>); <span class="comment">//测试单个拦截器，走了preHandle、afterCompletion，代码报错不会走postHandle</span></span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;success&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div></div></div>
<h3 id="异常处理">异常处理</h3>
<p>SpringMVC通过<strong>HandlerExceptionResolver</strong>接口处理程序的异常，包括Handler映射、数据绑定以及目标方法执行时发生的异常。<br />
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">|-HandlerExceptionResolver常用实现类：</span><br><span class="line">    |-DefaultHandlerExceptionResolver：默认实现类，处理常见的SpringMVC异常。</span><br><span class="line">        |-NoSuchRequestHandlingMethodException：请求的URL没有对应的处理方法。</span><br><span class="line">        |-HttpRequestMethodNotSupportedException：请求的方法不支持。</span><br><span class="line">        |-HttpMediaTypeNotSupportedException：请求的媒体类型不支持。</span><br><span class="line">        |-HttpMessageNotReadableException：请求的消息不能读取。</span><br><span class="line">        |-HttpMessageNotWritableException：响应的消息不能写入。</span><br><span class="line">        |-MethodArgumentNotValidException：方法参数验证失败。</span><br><span class="line">        |-MissingServletRequestParameterException：缺少请求参数。</span><br><span class="line">        |-MissingServletRequestPartException：缺少请求部分。</span><br><span class="line">        |-BindException：数据绑定失败。</span><br><span class="line">        |-ConversionNotSupportedException：数据转换失败。</span><br><span class="line">        |-TypeMismatchException：类型不匹配。</span><br><span class="line">    |-SimpleMappingExceptionResolver：根据异常类型映射到错误视图（需springMVC配置），希望对所有异常进行统一处理时使用。</span><br><span class="line">    |-AnnotationMethodHandlerExceptionResolver：处理带有<span class="string">&quot;@ExceptionHandler&quot;</span>注解的方法的异常。</span><br></pre></td></tr></table></figure></p>
<div class="tabs" id="异常处理"><ul class="nav-tabs"><li class="tab active"><a href="#异常处理-1">springMVC配置</a></li><li class="tab"><a href="#异常处理-2">index主页面</a></li><li class="tab"><a href="#异常处理-3">success响应页面</a></li><li class="tab"><a href="#异常处理-4">error响应页面</a></li><li class="tab"><a href="#异常处理-5">异常测试</a></li></ul><div class="tab-content"><div class="tab-pane active" id="异常处理-1"><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version=<span class="string">&quot;1.0&quot;</span> encoding=<span class="string">&quot;UTF-8&quot;</span>?&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">beans</span> <span class="attr">xmlns</span>=<span class="string">&quot;http://www.springframework.org/schema/beans&quot;</span></span></span><br><span class="line"><span class="tag">    <span class="attr">xmlns:xsi</span>=<span class="string">&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span></span></span><br><span class="line"><span class="tag">    <span class="attr">xmlns:context</span>=<span class="string">&quot;http://www.springframework.org/schema/context&quot;</span></span></span><br><span class="line"><span class="tag">    <span class="attr">xmlns:mvc</span>=<span class="string">&quot;http://www.springframework.org/schema/mvc&quot;</span></span></span><br><span class="line"><span class="tag">    <span class="attr">xsi:schemaLocation</span>=<span class="string">&quot;http://www.springframework.org/schema/mvc </span></span></span><br><span class="line"><span class="string"><span class="tag">        http://www.springframework.org/schema/mvc/spring-mvc-4.0.xsd</span></span></span><br><span class="line"><span class="string"><span class="tag">        http://www.springframework.org/schema/beans </span></span></span><br><span class="line"><span class="string"><span class="tag">        http://www.springframework.org/schema/beans/spring-beans.xsd</span></span></span><br><span class="line"><span class="string"><span class="tag">        http://www.springframework.org/schema/context </span></span></span><br><span class="line"><span class="string"><span class="tag">        http://www.springframework.org/schema/context/spring-context-4.0.xsd&quot;</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- 1 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">context:component-scan</span> <span class="attr">base-package</span>=<span class="string">&quot;com.example&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">context:component-scan</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- 2 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">bean</span> <span class="attr">class</span>=<span class="string">&quot;org.springframework.web.servlet.view.InternalResourceViewResolver&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;prefix&quot;</span> <span class="attr">value</span>=<span class="string">&quot;/WEB-INF/view/&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;suffix&quot;</span> <span class="attr">value</span>=<span class="string">&quot;.jsp&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- 3 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">mvc:default-servlet-handler</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">mvc:annotation-driven</span> /&gt;</span></span><br><span class="line">    </span><br><span class="line">    <span class="comment">&lt;!-- </span></span><br><span class="line"><span class="comment">        4.上传下载：将客户端上传的File文件，转换为MultipartFile。</span></span><br><span class="line"><span class="comment">        注意：文件解析器的bean中id必须设置为multipartResolver。</span></span><br><span class="line"><span class="comment">     --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">&quot;multipartResolver&quot;</span> <span class="attr">class</span>=<span class="string">&quot;org.springframework.web.multipart.commons.CommonsMultipartResolver&quot;</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!-- 设置文件解析的编码，注意：一定要和页面的pageEncoding保持一致 --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;defaultEncoding&quot;</span> <span class="attr">value</span>=<span class="string">&quot;UTF-8&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!-- 设置最大上传文件大小，一定是具体的值，不能1024*1024这种写法，单位为字节 --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;maxUploadSize&quot;</span> <span class="attr">value</span>=<span class="string">&quot;88888888&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">&lt;!-- 6.异常处理配置 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">bean</span> <span class="attr">class</span>=<span class="string">&quot;org.springframework.web.servlet.handler.SimpleMappingExceptionResolver&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;exceptionMappings&quot;</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">props</span>&gt;</span></span><br><span class="line">                <span class="comment">&lt;!-- 出现此异常跳转到error.jsp --&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">prop</span> <span class="attr">key</span>=<span class="string">&quot;java.lang.NullPointerException&quot;</span>&gt;</span>error<span class="tag">&lt;/<span class="name">prop</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">props</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">&lt;!-- 5.拦截器配置 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">mvc:interceptors</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!-- 1.第一种：默认拦截所有请求 --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">bean</span> <span class="attr">class</span>=<span class="string">&quot;com.example.interceptor.FirstInterceptor&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">bean</span> <span class="attr">class</span>=<span class="string">&quot;com.example.interceptor.SecondInterceptor&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!-- 2.第二种：默认拦截所有请求，要求拦截器类上必须加注解@Component --&gt;</span></span><br><span class="line">        <span class="comment">&lt;!-- &lt;ref bean=&quot;firstInterceptor&quot;/&gt; --&gt;</span></span><br><span class="line">        </span><br><span class="line">        <span class="comment">&lt;!-- 3.设置自定义拦截方式 --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">mvc:interceptor</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">bean</span>&gt;</span><span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br><span class="line">            <span class="comment">&lt;!-- 需要映射拦截的请求 --&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">mvc:mapping</span> <span class="attr">path</span>=<span class="string">&quot;&quot;</span>/&gt;</span></span><br><span class="line">            <span class="comment">&lt;!-- 不需要映射拦截的请求 --&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">mvc:exclude-mapping</span> <span class="attr">path</span>=<span class="string">&quot;&quot;</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">mvc:interceptor</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">mvc:interceptors</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">beans</span>&gt;</span></span><br></pre></td></tr></table></figure></div><div class="tab-pane" id="异常处理-2"><figure class="highlight xml"><figcaption><span>WebContent/index.jsp</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">&lt;%@ page language=&quot;java&quot; contentType=&quot;text/html; charset=UTF-8&quot; pageEncoding=&quot;UTF-8&quot;%&gt;</span><br><span class="line"><span class="meta">&lt;!DOCTYPE <span class="keyword">html</span> <span class="keyword">PUBLIC</span> <span class="string">&quot;-//W3C//DTD HTML 4.01 Transitional//EN&quot;</span> <span class="string">&quot;http://www.w3.org/TR/html4/loose.dtd&quot;</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">html</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">meta</span> <span class="attr">http-equiv</span>=<span class="string">&quot;Content-Type&quot;</span> <span class="attr">content</span>=<span class="string">&quot;text/html; charset=UTF-8&quot;</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">title</span>&gt;</span>Insert title here<span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">&quot;testException&quot;</span>&gt;</span>测试异常<span class="tag">&lt;/<span class="name">a</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure></div><div class="tab-pane" id="异常处理-3"><figure class="highlight xml"><figcaption><span>WebContent/WEB-INF/view/success.jsp</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">&lt;%@ page language=&quot;java&quot; contentType=&quot;text/html; charset=UTF-8&quot; pageEncoding=&quot;UTF-8&quot;%&gt;</span><br><span class="line"><span class="meta">&lt;!DOCTYPE <span class="keyword">html</span> <span class="keyword">PUBLIC</span> <span class="string">&quot;-//W3C//DTD HTML 4.01 Transitional//EN&quot;</span> <span class="string">&quot;http://www.w3.org/TR/html4/loose.dtd&quot;</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">html</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">meta</span> <span class="attr">http-equiv</span>=<span class="string">&quot;Content-Type&quot;</span> <span class="attr">content</span>=<span class="string">&quot;text/html; charset=UTF-8&quot;</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">title</span>&gt;</span>Insert title here<span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">h1</span>&gt;</span>SUCCESS<span class="tag">&lt;/<span class="name">h1</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure></div><div class="tab-pane" id="异常处理-4"><figure class="highlight xml"><figcaption><span>WebContent/WEB-INF/view/error.jsp</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">&lt;%@ page language=&quot;java&quot; contentType=&quot;text/html; charset=UTF-8&quot;</span><br><span class="line">    pageEncoding=&quot;UTF-8&quot;%&gt;</span><br><span class="line"><span class="meta">&lt;!DOCTYPE <span class="keyword">html</span> <span class="keyword">PUBLIC</span> <span class="string">&quot;-//W3C//DTD HTML 4.01 Transitional//EN&quot;</span> <span class="string">&quot;http://www.w3.org/TR/html4/loose.dtd&quot;</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">html</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">meta</span> <span class="attr">http-equiv</span>=<span class="string">&quot;Content-Type&quot;</span> <span class="attr">content</span>=<span class="string">&quot;text/html; charset=UTF-8&quot;</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">title</span>&gt;</span>Insert title here<span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">&quot;#&quot;</span>&gt;</span>操作异常，请稍后重试<span class="tag">&lt;/<span class="name">a</span>&gt;</span></span><br><span class="line">    $&#123;exception&#125;</span><br><span class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure></div><div class="tab-pane" id="异常处理-5"><figure class="highlight java"><figcaption><span>TestExceptionController.java</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.example.controller;</span><br><span class="line"><span class="keyword">import</span> org.springframework.stereotype.Controller;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.bind.annotation.RequestMapping;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.bind.annotation.RequestMethod;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Controller</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">TestExceptionController</span> &#123;</span><br><span class="line">    <span class="meta">@RequestMapping(value=&quot;/testException&quot;, method=RequestMethod.GET)</span></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">testException</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;success&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div></div></div>
<h3 id="整合问题">整合问题</h3>
<p>通常情况下，类似于数据源、事务、整合其他框架都是放在Spring的配置文件中，视图相关的都是放在SpringMVC配置文件中。<br />
对于完整的项目，就需要Spring和SpringMVC整合起来，一般在SpringMVC项目上进行整合，那么启动顺序就是，先启动SpringMVC，然后再启动Spring，而SpringMVC中有配置扫描组件，自动扫描和装配，如果遇到装配对象bean是在Spring中配置的，此时Spring还未启动，就会报错。这就需要在SpringMVC加载DispatcherServlet前加载Spring，前面讲过的有filer可在DispatcherServlet前执行，但它是每个请求都处理的，也就是每个请求都会出发创建Spring对象，这是不对的。所以符合要求的是监听器，监听器会加载Spring的配置文件，然后SpringMVC的DispatcherServlet会加载SpringMVC的配置文件。</p>
<p>监听器是在web.xml中配置的：<br />
<figure class="highlight xml"><figcaption><span>WebContent/WEB-INF/web.xml</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version=<span class="string">&quot;1.0&quot;</span> encoding=<span class="string">&quot;UTF-8&quot;</span>?&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">web-app</span> <span class="attr">xmlns:xsi</span>=<span class="string">&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span> </span></span><br><span class="line"><span class="tag">         <span class="attr">xmlns</span>=<span class="string">&quot;http://java.sun.com/xml/ns/javaee&quot;</span> </span></span><br><span class="line"><span class="tag">         <span class="attr">xsi:schemaLocation</span>=<span class="string">&quot;http://java.sun.com/xml/ns/javaee </span></span></span><br><span class="line"><span class="string"><span class="tag">         http://java.sun.com/xml/ns/javaee/web-app_2_5.xsd&quot;</span> <span class="attr">id</span>=<span class="string">&quot;WebApp_ID&quot;</span> <span class="attr">version</span>=<span class="string">&quot;2.5&quot;</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">display-name</span>&gt;</span>SpringMVC<span class="tag">&lt;/<span class="name">display-name</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">welcome-file-list</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">welcome-file</span>&gt;</span>index.jsp<span class="tag">&lt;/<span class="name">welcome-file</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">welcome-file-list</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">filter</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">filter-name</span>&gt;</span>CharacterEncodingFilter<span class="tag">&lt;/<span class="name">filter-name</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">filter-class</span>&gt;</span>org.springframework.web.filter.CharacterEncodingFilter<span class="tag">&lt;/<span class="name">filter-class</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">init-param</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">param-name</span>&gt;</span>encoding<span class="tag">&lt;/<span class="name">param-name</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">param-value</span>&gt;</span>UTF-8<span class="tag">&lt;/<span class="name">param-value</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">init-param</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">filter</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">filter-mapping</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">filter-name</span>&gt;</span>CharacterEncodingFilter<span class="tag">&lt;/<span class="name">filter-name</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">url-pattern</span>&gt;</span>/*<span class="tag">&lt;/<span class="name">url-pattern</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">filter-mapping</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">servlet</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">servlet-name</span>&gt;</span>springDispatcherServlet<span class="tag">&lt;/<span class="name">servlet-name</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">servlet-class</span>&gt;</span>org.springframework.web.servlet.DispatcherServlet<span class="tag">&lt;/<span class="name">servlet-class</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">init-param</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">param-name</span>&gt;</span>contextConfigLocation<span class="tag">&lt;/<span class="name">param-name</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">param-value</span>&gt;</span>classpath:springMVC.xml<span class="tag">&lt;/<span class="name">param-value</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">init-param</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">load-on-startup</span>&gt;</span>1<span class="tag">&lt;/<span class="name">load-on-startup</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">servlet</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">servlet-mapping</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">servlet-name</span>&gt;</span>springDispatcherServlet<span class="tag">&lt;/<span class="name">servlet-name</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">url-pattern</span>&gt;</span>/<span class="tag">&lt;/<span class="name">url-pattern</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">servlet-mapping</span>&gt;</span></span><br><span class="line">  </span><br><span class="line">    <span class="comment">&lt;!-- servlet初始化前执行监听器，spring提供的监听器：ContextLoaderListener --&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- 监听器可以在servletContext加载时，通过监听器加载spring的配置文件，创建spring容器 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">listener</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">listener-class</span>&gt;</span>org.springframework.web.context.ContextLoaderListener<span class="tag">&lt;/<span class="name">listener-class</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">listener</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- 配置ContextLoaderListener --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">context-param</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">param-name</span>&gt;</span>contextConfigLocation<span class="tag">&lt;/<span class="name">param-name</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">param-value</span>&gt;</span>classpath:spring.xml<span class="tag">&lt;/<span class="name">param-value</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">context-param</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">web-app</span>&gt;</span></span><br></pre></td></tr></table></figure></p>
<p>配置好监听器后，在Spring和SpringMVC的配置文件中配置扫描组件：<br />
<figure class="highlight xml"><figcaption><span>conf/spring.xml, conf/springMVC.xml,</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version=<span class="string">&quot;1.0&quot;</span> encoding=<span class="string">&quot;UTF-8&quot;</span>?&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">beans</span> <span class="attr">xmlns</span>=<span class="string">&quot;http://www.springframework.org/schema/beans&quot;</span></span></span><br><span class="line"><span class="tag">    <span class="attr">xmlns:xsi</span>=<span class="string">&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span></span></span><br><span class="line"><span class="tag">    <span class="attr">xmlns:context</span>=<span class="string">&quot;http://www.springframework.org/schema/context&quot;</span></span></span><br><span class="line"><span class="tag">    <span class="attr">xsi:schemaLocation</span>=<span class="string">&quot;http://www.springframework.org/schema/beans </span></span></span><br><span class="line"><span class="string"><span class="tag">        http://www.springframework.org/schema/beans/spring-beans.xsd</span></span></span><br><span class="line"><span class="string"><span class="tag">        http://www.springframework.org/schema/context </span></span></span><br><span class="line"><span class="string"><span class="tag">        http://www.springframework.org/schema/context/spring-context-4.0.xsd&quot;</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">&lt;!-- 组件扫描可以使用排除和包含，方便Spring和springMVC扫描管理不同的bean --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">context:component-scan</span> <span class="attr">base-package</span>=<span class="string">&quot;com.example&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">context:exclude-filter</span> <span class="attr">type</span>=<span class="string">&quot;annotation&quot;</span> <span class="attr">expression</span>=<span class="string">&quot;org.springframework.stereotype.Controller&quot;</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">context:component-scan</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;/<span class="name">beans</span>&gt;</span></span><br></pre></td></tr></table></figure></p>
<p>Spring是父容器，SpringMVC是子容器：子容器可以访问父容器的bean，父容器不能访问子容器的bean，子容器可以管理父容器的bean，父容器不能管理子容器的bean。</p>
<h2 id="springboost">SpringBoost</h2>
<p>Spring有很多子项目，它们解决实际开发中不同的问题，比如：<strong>Spring
Framework</strong>（核心功能）、<strong>Spring
Data</strong>（数据获取）、<strong>Spring
Security</strong>（认证授权）、<strong>Spring
AMQP</strong>（消息传递）、<strong>Spring
Cloud</strong>（服务治理）。<strong>Spring
Boost</strong>（项目构建）也是Spring提供的一个子项目，用于快速构建Spring应用程序。</p>
<p><strong>传统构建、SpringBoost构建区别：</strong><br />
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">传统方式：</span><br><span class="line"><span class="number">1.</span>导入依赖繁琐：需手动导入，各jar包之间还可能出现冲突问题。</span><br><span class="line"><span class="number">2.</span>项目配置繁琐：需手动写配置文件：</span><br><span class="line">               |-Spring的配置文件applicationContext.xml。</span><br><span class="line">               |-Web应用的配置文件web.xml。</span><br><span class="line">               |-SpringMVC的配置文件springMVC.xml。</span><br><span class="line">SpringBoost：</span><br><span class="line"><span class="number">1.</span>起步依赖：本质上就是一个Maven坐标，它整合了完成一个功能需要的所有坐标（依赖）。</span><br><span class="line"><span class="number">2.</span>自动配置：在boot程序启动后，起步依赖的一些bean对象会自动注入到ioc容器，不需要手动声明。</span><br><span class="line"><span class="number">3.</span>其他特性：内嵌Tomcat、Jetty（无需部署WAR文件），外部化配置，不需要xml配置（使用properties/yml）。</span><br></pre></td></tr></table></figure></p>
<h2 id="参考资料">参考资料</h2>
<p><span class="exturl" data-url="aHR0cHM6Ly9wZGFpLnRlY2gvbWQvc3ByaW5nL3NwcmluZy14LWZyYW1ld29yay1pbnRyb2R1Y2UuaHRtbA==">Spring框架知识体系<i class="fa fa-external-link-alt"></i></span><br />
<span class="exturl" data-url="aHR0cHM6Ly9naXRodWIuY29tL3NwcmluZy1wcm9qZWN0cy9zcHJpbmctZnJhbWV3b3Jr">Spring
github<i class="fa fa-external-link-alt"></i></span><br />
<span class="exturl" data-url="aHR0cHM6Ly9zcHJpbmcuaW8v">Spring官网<i class="fa fa-external-link-alt"></i></span></p>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="https://soundmemories.github.io/2020/03/17/Java/24.Java%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avstar.png">
      <meta itemprop="name" content="SoundMemories">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="SoundMemories">
      <meta itemprop="description" content="今日事，今日毕">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | SoundMemories">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2020/03/17/Java/24.Java%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F/" class="post-title-link" itemprop="url">Java设计模式</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>

      <time title="创建时间：2020-03-17 00:00:00" itemprop="dateCreated datePublished" datetime="2020-03-17T00:00:00+08:00">2020-03-17</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">分类于</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/Java/" itemprop="url" rel="index"><span itemprop="name">Java</span></a>
        </span>
    </span>

  
    <span class="post-meta-break"></span>
    <span class="post-meta-item" title="本文字数">
      <span class="post-meta-item-icon">
        <i class="far fa-file-word"></i>
      </span>
      <span class="post-meta-item-text">本文字数：</span>
      <span>2.9k</span>
    </span>
    <span class="post-meta-item" title="阅读时长">
      <span class="post-meta-item-icon">
        <i class="far fa-clock"></i>
      </span>
      <span class="post-meta-item-text">阅读时长 &asymp;</span>
      <span>10 分钟</span>
    </span>
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <h2 id="设计模式">设计模式</h2>
<p>设计模式就是解决问题的模板框架，在Java中常用的设计模式有23种，JavaSE阶段常见的几个：<br />
1.模板设计模式（做到能模仿（3星））<br />
2.单例设计模式（做到脱稿能写（5星））<br />
3.工厂设计模式（做到会调用工厂类的方法（2星））<br />
4.代理设计模式（做到能模仿（3星））<br />
5.迭代器设计模式（了解）<br />
6.装饰者设计模式（了解）<br />
其他复杂设计模式，做到能看懂代码，能认识。</p>
<h3 id="模板设计模式抽象类">模板设计模式（抽象类）</h3>
<p>当你解决一下问题时，总体的算法的结构/步骤是确定的，但是其中的一步或几步的代码的具体实现是不确定的，需使用者自己来确定。</p>
<p>举例：编写一个类，包含一个方法，可以统计你执行任意代码的运行时间（时间的单位：毫秒）。<br />
<figure class="highlight java"><figcaption><span>TestTemplate.java</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//模板类</span></span><br><span class="line"><span class="keyword">abstract</span> <span class="keyword">class</span> <span class="title class_">CalTime</span>&#123;</span><br><span class="line">    <span class="comment">//可以计算任意一段代码的运行时间</span></span><br><span class="line">    <span class="comment">//这里加final的目的是不希望子类重写，防止改写我的算法的结构</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">final</span> <span class="type">long</span> <span class="title function_">getTime</span><span class="params">()</span>&#123;</span><br><span class="line">        <span class="comment">//（1）获取开始时系统时间</span></span><br><span class="line">        <span class="type">long</span> <span class="variable">start</span> <span class="operator">=</span> System.currentTimeMillis();</span><br><span class="line">        <span class="comment">//（2）执行xxxx</span></span><br><span class="line">        doWork();</span><br><span class="line">        <span class="comment">//（3）获取结束时系统时间</span></span><br><span class="line">        <span class="type">long</span> <span class="variable">end</span> <span class="operator">=</span> System.currentTimeMillis();</span><br><span class="line">        <span class="comment">//（4）计算时间差</span></span><br><span class="line">        <span class="keyword">return</span> end - start;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">//protected的目的，希望只是子类中进行访问和重写，防止子类直接调用</span></span><br><span class="line">    <span class="keyword">protected</span> <span class="keyword">abstract</span> <span class="keyword">void</span> <span class="title function_">doWork</span><span class="params">()</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//继承重写（2）部分</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">MyCalTime</span> <span class="keyword">extends</span> <span class="title class_">CalTime</span>&#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">protected</span> <span class="keyword">void</span> <span class="title function_">doWork</span><span class="params">()</span> &#123;<span class="comment">//从1加到100000</span></span><br><span class="line">        <span class="type">long</span> <span class="variable">sum</span> <span class="operator">=</span> <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">1</span>; i&lt;=<span class="number">100000</span>; i++)&#123;</span><br><span class="line">            sum += i;</span><br><span class="line">        &#125;</span><br><span class="line">        System.out.println(<span class="string">&quot;sum = &quot;</span> + sum);</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">TestTemplate</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        <span class="type">MyCalTime</span> <span class="variable">my</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">MyCalTime</span>();</span><br><span class="line">        <span class="type">long</span> <span class="variable">time</span> <span class="operator">=</span> my.getTime();</span><br><span class="line">        System.out.println(<span class="string">&quot;耗时：&quot;</span> + time + <span class="string">&quot;毫秒&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<h3 id="单例设计模式多线程">单例设计模式（多线程）</h3>
<p>单例：某个类只能有唯一的一个实例对象。比如，枚举中只有一个对象，就是最简单的单例。<br />
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">|-饿汉式：不管是否需要这个对象，它都上来先给你创建好这个唯一的对象。</span><br><span class="line">    |-<span class="number">1.5</span>之后，用<span class="keyword">enum</span>直接创建。</span><br><span class="line">    |-构造器私有化-&gt;用一个<span class="string">&quot;全局&quot;</span>的静态常量，来保存这个唯一的实例对象。</span><br><span class="line">    |-构造器私有化-&gt;用一个<span class="string">&quot;私有&quot;</span>的静态常量，来保存这个唯一的实例对象-&gt;提供一个静态方法，来返回这个常量对象。</span><br><span class="line">|-懒汉式：延迟创建对象。当使用者来或者这个对象，要用到对象时，再创建。</span><br><span class="line">    |-构造器私有化-&gt;创建一个私有的静态常量，但此时不创建唯一的实例对象给它</span><br><span class="line">                 -&gt;提供一个静态方法，当使用这个静态方法时，来创建实例对象给私有的静态的常量，然后返回这个常量对象；</span><br><span class="line">                 或之前创建过实例对象给私有的静态的常量，此时直接返回这个常量对象。</span><br><span class="line">    |-内部类形式。</span><br><span class="line"></span><br><span class="line">|-线程安全问题：多个线程时，可能几个线程都能判断没有实例对象，需要新建，此时返回的对象就不是同一个了。</span><br><span class="line">    |-解决办法：把这个方法锁上，但性能较差。</span><br><span class="line">|-性能问题：安全问题只在第一次新建出现，如果把这个方法锁上，之后每次线程判断都要等锁，性能较差。</span><br><span class="line">    |-解决办法：使用“当前类的Class对象”作为锁，外面再加一层判断有没有实例对象。外层的判断就是优化性能。</span><br></pre></td></tr></table></figure></p>
<div class="tabs" id="dan"><ul class="nav-tabs"><li class="tab active"><a href="#dan-1">饿汉式</a></li><li class="tab"><a href="#dan-2">懒汉式1</a></li><li class="tab"><a href="#dan-3">懒汉式2</a></li></ul><div class="tab-content"><div class="tab-pane active" id="dan-1"><figure class="highlight java"><figcaption><span>TestSingle1.java</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//1.5之后实现枚举，形式一</span></span><br><span class="line"><span class="keyword">enum</span> <span class="title class_">SingleEnum</span>&#123;</span><br><span class="line">    INSTANCE;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">test</span><span class="params">()</span>&#123;&#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//1.5之前实现枚举，全局常量，形式二</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">SingleClass</span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">SingleClass</span> <span class="variable">INSTANCE</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">SingleClass</span>();</span><br><span class="line">    <span class="keyword">private</span> <span class="title function_">SingleClass</span><span class="params">()</span>&#123;&#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//1.5之前实现枚举，私有常量，形式三</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Single</span>&#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">Single</span> <span class="variable">INSTANCE</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Single</span>();</span><br><span class="line">    <span class="keyword">private</span> <span class="title function_">Single</span><span class="params">()</span>&#123;&#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> Single <span class="title function_">getInstance</span><span class="params">()</span>&#123;</span><br><span class="line">        <span class="keyword">return</span> INSTANCE;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">TestSingle1</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">test1</span><span class="params">()</span>&#123;</span><br><span class="line">        <span class="type">SingleEnum</span> <span class="variable">s1</span> <span class="operator">=</span> SingleEnum.INSTANCE;</span><br><span class="line">        <span class="type">SingleEnum</span> <span class="variable">s2</span> <span class="operator">=</span> SingleEnum.INSTANCE;</span><br><span class="line">        System.out.println(s1 == s2);<span class="comment">//true</span></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">test2</span><span class="params">()</span>&#123;</span><br><span class="line">    <span class="comment">// SingleEnum.test();//恶汉式，此时我并没有需要用到这个对象，但是它也创建出来了</span></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">test3</span><span class="params">()</span>&#123;</span><br><span class="line">        <span class="type">SingleClass</span> <span class="variable">s1</span> <span class="operator">=</span> SingleClass.INSTANCE;</span><br><span class="line">        <span class="type">SingleClass</span> <span class="variable">s2</span> <span class="operator">=</span> SingleClass.INSTANCE;</span><br><span class="line">        System.out.println(s1==s2);<span class="comment">//true</span></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">test4</span><span class="params">()</span>&#123;</span><br><span class="line">        <span class="type">Single</span> <span class="variable">s1</span> <span class="operator">=</span> Single.getInstance();</span><br><span class="line">        <span class="type">Single</span> <span class="variable">s2</span> <span class="operator">=</span> Single.getInstance();</span><br><span class="line">        System.out.println(s1 == s2);<span class="comment">//true</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div><div class="tab-pane" id="dan-2"><figure class="highlight java"><figcaption><span>TestSingle2.java</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">LazyClass</span>&#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> LazyClass instance;<span class="comment">//不加final，可等到用的时候再赋值</span></span><br><span class="line">    <span class="keyword">private</span> <span class="title function_">LazyClass</span><span class="params">()</span>&#123;&#125;<span class="comment">//构造器私有化</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> LazyClass <span class="title function_">getInstance</span><span class="params">()</span>&#123;</span><br><span class="line">        <span class="keyword">if</span>(instance == <span class="literal">null</span>)&#123;<span class="comment">//提高效率</span></span><br><span class="line">            <span class="keyword">synchronized</span>(LazyClass.class)&#123;<span class="comment">//当前类的Class对象</span></span><br><span class="line">                <span class="keyword">if</span>(instance == <span class="literal">null</span>)&#123;<span class="comment">//安全判断，之前没创建过，就新建</span></span><br><span class="line">                    <span class="keyword">try</span> &#123;</span><br><span class="line">                        Thread.sleep(<span class="number">100</span>);</span><br><span class="line">                    &#125; <span class="keyword">catch</span> (InterruptedException e) &#123;</span><br><span class="line">                        e.printStackTrace();</span><br><span class="line">                    &#125;</span><br><span class="line">                    instance = <span class="keyword">new</span> <span class="title class_">LazyClass</span>();</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> instance;<span class="comment">//之前创建过对象，就返回之前的对象</span></span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">//安全没问题，但是认为不是最优的</span></span><br><span class="line">    <span class="comment">// public synchronized static LazyClass getInstance()&#123;</span></span><br><span class="line">    <span class="comment">//     if(instance == null)&#123;</span></span><br><span class="line">    <span class="comment">//         try &#123;</span></span><br><span class="line">    <span class="comment">//             Thread.sleep(100);</span></span><br><span class="line">    <span class="comment">//         &#125; catch (InterruptedException e) &#123;</span></span><br><span class="line">    <span class="comment">//             e.printStackTrace();</span></span><br><span class="line">    <span class="comment">//         &#125;</span></span><br><span class="line">    <span class="comment">//         instance = new LazyClass();</span></span><br><span class="line">    <span class="comment">//     &#125;</span></span><br><span class="line">    <span class="comment">//     return instance;</span></span><br><span class="line">    <span class="comment">// &#125;</span></span><br><span class="line">    </span><br><span class="line">    <span class="comment">//有安全问题</span></span><br><span class="line">    <span class="comment">// public static LazyClass getInstance()&#123;&#125;</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">TestSingle2</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">test1</span><span class="params">()</span>&#123;</span><br><span class="line">        <span class="type">LazyClass</span> <span class="variable">s1</span> <span class="operator">=</span> LazyClass.getInstance();</span><br><span class="line">        <span class="type">LazyClass</span> <span class="variable">s2</span> <span class="operator">=</span> LazyClass.getInstance();</span><br><span class="line">        System.out.println(s2 == s1);<span class="comment">//true</span></span><br><span class="line">    &#125;</span><br><span class="line">    LazyClass s1;</span><br><span class="line">    LazyClass s2;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">test2</span><span class="params">()</span>&#123;</span><br><span class="line">        <span class="comment">//匿名的内部类，继承Thread类</span></span><br><span class="line">        <span class="type">Thread</span> <span class="variable">t1</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Thread</span>()&#123;</span><br><span class="line">            <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">run</span><span class="params">()</span>&#123;</span><br><span class="line">                s1 = LazyClass.getInstance();</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;;</span><br><span class="line">        <span class="type">Thread</span> <span class="variable">t2</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Thread</span>()&#123;</span><br><span class="line">            <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">run</span><span class="params">()</span>&#123;</span><br><span class="line">                s2 = LazyClass.getInstance();</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;;</span><br><span class="line">        t1.start();</span><br><span class="line">        t2.start();</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="comment">//这里用join的目的是，为了两个子线程都执行完，再执行主线程的System.out.println(s1);</span></span><br><span class="line">            t1.join();</span><br><span class="line">            t2.join();</span><br><span class="line">        &#125; <span class="keyword">catch</span> (InterruptedException e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125;</span><br><span class="line">        System.out.println(s1 == s2);<span class="comment">//true</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div><div class="tab-pane" id="dan-3"><figure class="highlight java"><figcaption><span>TestSingle3.java</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Lazy</span>&#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="title function_">Lazy</span><span class="params">()</span>&#123;&#125;</span><br><span class="line">    <span class="comment">//内部类方式，在内部类中，创建外部类的唯一对象</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">class</span> <span class="title class_">Inner</span>&#123;</span><br><span class="line">        <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">Lazy</span> <span class="variable">INSTANCE</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Lazy</span>();</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> Lazy <span class="title function_">getInstance</span><span class="params">()</span>&#123;</span><br><span class="line">        <span class="keyword">return</span> Inner.INSTANCE;<span class="comment">//只有在使用的时候才会创建实例</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">TestSingle3</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">test1</span><span class="params">()</span>&#123;</span><br><span class="line">        <span class="type">Lazy</span> <span class="variable">s1</span> <span class="operator">=</span> Lazy.getInstance();</span><br><span class="line">        <span class="type">Lazy</span> <span class="variable">s2</span> <span class="operator">=</span> Lazy.getInstance();</span><br><span class="line">        System.out.println(s2 == s1);<span class="comment">//true</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div></div></div>
<h3 id="工厂设计模式反射">工厂设计模式（反射）</h3>
<p>Java中为了解耦合，把对象的创建者、对象的使用者分开，批量生产对象。<br />
在反射一章中讲解的，如果要用反射创建一个对象，代码可能非常复杂，此时就可以使用工厂设计模式来批量创建对象。<br />
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">|-简单工厂模式：</span><br><span class="line">    |-使用工厂类，可以<span class="keyword">new</span>相应类的对象，使用者和这个对象之间没有直接关联，解耦合。</span><br><span class="line">    |-优点：代码比较简洁。</span><br><span class="line">    |-缺点：<span class="string">&quot;如果增加新的产品类型，需要修改工厂类&quot;</span>，违反了面向对象的一个开发原则：对扩展开放，对修改关闭。</span><br><span class="line">|-工厂方法模式</span><br><span class="line">    |-<span class="string">&quot;一个产品就对应一个工厂类，如果增加新产品，就不需要修改原来的工厂类&quot;</span>。</span><br><span class="line">    |-优点：遵循了增加新产品，不修改原来的类的原则。</span><br><span class="line">    |-缺点：类太多了。建议使用反射，更灵活，只需要更改配置文件即可。</span><br></pre></td></tr></table></figure></p>
<div class="tabs" id="工厂模式"><ul class="nav-tabs"><li class="tab active"><a href="#工厂模式-1">简单工厂模式</a></li><li class="tab"><a href="#工厂模式-2">工厂方法模式</a></li><li class="tab"><a href="#工厂模式-3">工厂方法模式-反射</a></li></ul><div class="tab-content"><div class="tab-pane active" id="工厂模式-1"><figure class="highlight java"><figcaption><span>TestFactory.java</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//接口</span></span><br><span class="line"><span class="keyword">interface</span> <span class="title class_">Car</span>&#123;</span><br><span class="line">    <span class="keyword">void</span> <span class="title function_">run</span><span class="params">()</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//车类</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">BMW</span> <span class="keyword">implements</span> <span class="title class_">Car</span>&#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">run</span><span class="params">()</span> &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;BMW&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Benz</span> <span class="keyword">implements</span> <span class="title class_">Car</span>&#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">run</span><span class="params">()</span> &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;Benz&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//工厂类（创建）</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">SimpleFactory1</span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> Car <span class="title function_">getCar</span><span class="params">()</span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">BMW</span>();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">class</span> <span class="title class_">SimpleFactory2</span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> Car <span class="title function_">getCar</span><span class="params">(String type)</span>&#123;</span><br><span class="line">        <span class="keyword">if</span>(<span class="string">&quot;宝马&quot;</span>.equals(type))&#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">BMW</span>();</span><br><span class="line">        &#125;<span class="keyword">else</span> <span class="keyword">if</span>(<span class="string">&quot;奔驰&quot;</span>.equals(type))&#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">Benz</span>();</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">null</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">TestFactory</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">test</span><span class="params">()</span>&#123;</span><br><span class="line">        <span class="comment">//工厂类创建，main使用，功能分开</span></span><br><span class="line">        <span class="type">Car</span> <span class="variable">c</span> <span class="operator">=</span> SimpleFactory1.getCar();</span><br><span class="line">        c.run();<span class="comment">//BMW</span></span><br><span class="line"></span><br><span class="line">        <span class="type">Car</span> <span class="variable">c1</span> <span class="operator">=</span> SimpleFactory2.getCar(<span class="string">&quot;奔驰&quot;</span>);</span><br><span class="line">        <span class="type">Car</span> <span class="variable">c2</span> <span class="operator">=</span> SimpleFactory2.getCar(<span class="string">&quot;宝马&quot;</span>);</span><br><span class="line">        c1.run();<span class="comment">//Benz</span></span><br><span class="line">        c2.run();<span class="comment">//BMW</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div><div class="tab-pane" id="工厂模式-2"><figure class="highlight java"><figcaption><span>TestFactory1.java</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//接口</span></span><br><span class="line"><span class="keyword">interface</span> <span class="title class_">Che</span>&#123;</span><br><span class="line">    <span class="keyword">void</span> <span class="title function_">run</span><span class="params">()</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">interface</span> <span class="title class_">GongChang</span>&#123;</span><br><span class="line">    Che <span class="title function_">getChe</span><span class="params">()</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//车类</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">BaoMa</span> <span class="keyword">implements</span> <span class="title class_">Che</span>&#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">run</span><span class="params">()</span> &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;BaoMa&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">class</span> <span class="title class_">BenChi</span> <span class="keyword">implements</span> <span class="title class_">Che</span>&#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">run</span><span class="params">()</span> &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;BenChi&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//工厂类（一种车一个工厂类）</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">BaoMaFactory</span> <span class="keyword">implements</span> <span class="title class_">GongChang</span>&#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> Che <span class="title function_">getChe</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">BaoMa</span>();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">class</span> <span class="title class_">BenChiFactory</span> <span class="keyword">implements</span>  <span class="title class_">GongChang</span>&#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> Che <span class="title function_">getChe</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">BenChi</span>();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">TestFactory1</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        <span class="type">BaoMaFactory</span> <span class="variable">bf</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">BaoMaFactory</span>();</span><br><span class="line">        <span class="type">Che</span> <span class="variable">c</span> <span class="operator">=</span> bf.getChe();</span><br><span class="line">        c.run();</span><br><span class="line"></span><br><span class="line">        <span class="type">BenChiFactory</span> <span class="variable">bf2</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">BenChiFactory</span>();</span><br><span class="line">        <span class="type">Che</span> <span class="variable">c2</span> <span class="operator">=</span> bf2.getChe();</span><br><span class="line">        c2.run();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div><div class="tab-pane" id="工厂模式-3"><figure class="highlight java"><figcaption><span>TestFactory2.java</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//接口</span></span><br><span class="line"><span class="keyword">interface</span> <span class="title class_">Vehicle</span>&#123;</span><br><span class="line">    <span class="keyword">void</span> <span class="title function_">run</span><span class="params">()</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//车类</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">QQ</span> <span class="keyword">implements</span> <span class="title class_">Vehicle</span>&#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">run</span><span class="params">()</span> &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;QQ&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Aoto</span> <span class="keyword">implements</span>  <span class="title class_">Vehicle</span>&#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">run</span><span class="params">()</span> &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;Aoto&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//工厂类，使用反射</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">SimpleFactory2</span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> Vehicle <span class="title function_">getVehicle</span><span class="params">(String className)</span> <span class="keyword">throws</span> Exception&#123;</span><br><span class="line">        <span class="comment">//获取反射类</span></span><br><span class="line">        <span class="type">Class</span> <span class="variable">clazz</span> <span class="operator">=</span> Class.forName(className);</span><br><span class="line">        <span class="comment">//反射创建类对象</span></span><br><span class="line">        <span class="keyword">return</span> (Vehicle) clazz.newInstance();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">TestFactory2</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span><span class="keyword">throws</span> Exception &#123;</span><br><span class="line">        <span class="comment">//使用哪个类创建对象，只需输入名字即可</span></span><br><span class="line">        <span class="comment">//如果把类名用配置文件记录，创建更灵活</span></span><br><span class="line">        <span class="type">Vehicle</span> <span class="variable">c</span> <span class="operator">=</span> SimpleFactory2.getVehicle(<span class="string">&quot;QQ&quot;</span>);</span><br><span class="line">        c.run();</span><br><span class="line">        <span class="type">Vehicle</span> <span class="variable">c2</span> <span class="operator">=</span> SimpleFactory2.getVehicle(<span class="string">&quot;Aoto&quot;</span>);</span><br><span class="line">        c2.run();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div></div></div>
<h3 id="代理设计模式">代理设计模式</h3>
<p>当前这个类做的是<strong>多变的、重复的、没有要用的资源</strong>，那么可以交给代理。代理模式要求：<br />
1.主题接口：要求代理类与被代理类实现同一个接口。<br />
2.代理者：必须持有被代理者的引用。<br />
3.被代理者：核心类。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">|-静态代理模式：一个代理类只能替一个代理主题（接口）代理工作。</span><br><span class="line">|-动态代理模式：一个代理工作处理器，可以替多个代理主题代理工作，只有代理工作内容一样就可以。</span><br><span class="line">    |-编写一个代理工作处理器的类，这个类必须实现InvocationHandler接口的invoke方法。</span><br><span class="line">    |-用JDK中提供了一个Proxy类，来创建代理类的对象。</span><br><span class="line">    |-调用方法。</span><br><span class="line">    <span class="comment">//测试类代码，就可以使用代理，方便后期上线。动态代理在Spring中很常见。</span></span><br></pre></td></tr></table></figure>
<div class="tabs" id="testagent"><ul class="nav-tabs"><li class="tab active"><a href="#testagent-1">静态代理</a></li><li class="tab"><a href="#testagent-2">动态代理</a></li></ul><div class="tab-content"><div class="tab-pane active" id="testagent-1"><figure class="highlight java"><figcaption><span>TestAgent.java</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//接口</span></span><br><span class="line"><span class="keyword">interface</span> <span class="title class_">DAO</span>&#123;</span><br><span class="line">    <span class="keyword">void</span> <span class="title function_">add</span><span class="params">()</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//代理类</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">DAOProxy</span> <span class="keyword">implements</span> <span class="title class_">DAO</span>&#123;</span><br><span class="line">    <span class="comment">//持有被代理者的引用，因为核心业务逻辑仍然交给被代理者自己完成</span></span><br><span class="line">    <span class="keyword">private</span> DAO dao;</span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">DAOProxy</span><span class="params">(DAO dao)</span> &#123;</span><br><span class="line">        <span class="built_in">super</span>();</span><br><span class="line">        <span class="built_in">this</span>.dao = dao;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">add</span><span class="params">()</span>&#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;add方法开始执行&quot;</span>);<span class="comment">//测试代码，上线不用的</span></span><br><span class="line">        <span class="type">long</span> <span class="variable">start</span> <span class="operator">=</span> System.currentTimeMillis();<span class="comment">//测试代码，上线不用的</span></span><br><span class="line">        dao.add();<span class="comment">//添加商品，核心业务逻辑交给被代理者自己执行</span></span><br><span class="line">        <span class="type">long</span> <span class="variable">end</span> <span class="operator">=</span> System.currentTimeMillis();<span class="comment">//测试代码，上线不用的</span></span><br><span class="line">        System.out.println(<span class="string">&quot;运行时间：&quot;</span> + (end-start));<span class="comment">//测试代码，上线不用的</span></span><br><span class="line">        System.out.println(<span class="string">&quot;add方法执行结束&quot;</span>);<span class="comment">//测试代码，上线不用的</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//被代理类</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">UserDAOImpl</span> <span class="keyword">implements</span> <span class="title class_">DAO</span>&#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">add</span><span class="params">()</span> &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;添加用户&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">class</span> <span class="title class_">GoodsDAOImpl</span> <span class="keyword">implements</span> <span class="title class_">DAO</span>&#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">add</span><span class="params">()</span> &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;添加商品&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">TestAgent</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        <span class="comment">//正式代码，上线可直接使用</span></span><br><span class="line">        <span class="type">GoodsDAOImpl</span> <span class="variable">dao</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">GoodsDAOImpl</span>();</span><br><span class="line">        dao.add();</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">test02</span><span class="params">()</span>&#123;</span><br><span class="line">        <span class="comment">//测试代码，使用代理类进行测试</span></span><br><span class="line">        <span class="type">DAO</span> <span class="variable">d</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">DAOProxy</span>(<span class="keyword">new</span> <span class="title class_">GoodsDAOImpl</span>());</span><br><span class="line">        d.add();</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">test01</span><span class="params">()</span>&#123;</span><br><span class="line">        <span class="comment">//测试代码，使用代理类进行测试</span></span><br><span class="line">        <span class="type">DAO</span> <span class="variable">d</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">DAOProxy</span>(<span class="keyword">new</span> <span class="title class_">UserDAOImpl</span>());</span><br><span class="line">        d.add();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div><div class="tab-pane" id="testagent-2"><figure class="highlight java"><figcaption><span>TestProxy.java</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//主题1</span></span><br><span class="line"><span class="keyword">interface</span> <span class="title class_">A</span>&#123;</span><br><span class="line">    <span class="keyword">void</span> <span class="title function_">a</span><span class="params">()</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//被代理者1</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">AImpl</span> <span class="keyword">implements</span> <span class="title class_">A</span>&#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">a</span><span class="params">()</span> &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;a方法被执行&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//主题2</span></span><br><span class="line"><span class="keyword">interface</span> <span class="title class_">B</span>&#123;</span><br><span class="line">    <span class="keyword">void</span> <span class="title function_">b</span><span class="params">()</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//被代理者2</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">BImpl</span> <span class="keyword">implements</span> <span class="title class_">B</span>&#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">b</span><span class="params">()</span> &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;b方法被执行&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//代理处理器类</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Handler</span> <span class="keyword">implements</span> <span class="title class_">InvocationHandler</span>&#123;</span><br><span class="line">    <span class="keyword">private</span> Object target;<span class="comment">//被代理者对象</span></span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">Handler</span><span class="params">(Object target)</span> &#123;</span><br><span class="line">        <span class="built_in">super</span>();</span><br><span class="line">        <span class="built_in">this</span>.target = target;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">//invoke方法执行代理类对象的方法时自动调用</span></span><br><span class="line">    <span class="comment">//proxy：代理类的对象</span></span><br><span class="line">    <span class="comment">//method：被代理者要执行的方法</span></span><br><span class="line">    <span class="comment">//args：被代理者要执行的方法需要的实参列表</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> Object <span class="title function_">invoke</span><span class="params">(Object proxy, Method method, Object[] args)</span> <span class="keyword">throws</span> Throwable &#123;</span><br><span class="line">        System.out.println(method.getName() + <span class="string">&quot;方法开始执行&quot;</span>);<span class="comment">//反射方法</span></span><br><span class="line">        <span class="type">long</span> <span class="variable">start</span> <span class="operator">=</span> System.currentTimeMillis();</span><br><span class="line">        <span class="comment">//method.invoke(obj, args);//obj是要求写被代理者对象</span></span><br><span class="line">        <span class="type">Object</span> <span class="variable">value</span> <span class="operator">=</span> method.invoke(target, args);<span class="comment">//反射方法执行</span></span><br><span class="line">        <span class="type">long</span> <span class="variable">end</span> <span class="operator">=</span> System.currentTimeMillis();</span><br><span class="line">        System.out.println(<span class="string">&quot;运行时间：&quot;</span> + (end-start));</span><br><span class="line">        System.out.println(method.getName() + <span class="string">&quot;方法执行结束&quot;</span>);</span><br><span class="line">        <span class="keyword">return</span> value;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">TestProxy</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">test01</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="type">AImpl</span> <span class="variable">a</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">AImpl</span>();<span class="comment">//被代理者</span></span><br><span class="line">        <span class="type">ClassLoader</span> <span class="variable">loader</span> <span class="operator">=</span> a.getClass().getClassLoader();<span class="comment">//被代理者的，类加载器对象</span></span><br><span class="line">        Class&lt;?&gt;[] interfaces = a.getClass().getInterfaces();<span class="comment">//被代理者实现的，接口们</span></span><br><span class="line">        <span class="type">Handler</span> <span class="variable">h</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Handler</span>(a);<span class="comment">//处理器对象</span></span><br><span class="line">        <span class="comment">// ProxyInstance(ClassLoader loader,Class&lt;?&gt;[] interfaces,InvocationHandler h)</span></span><br><span class="line">        <span class="comment">// loader：被代理者的类加载器对象</span></span><br><span class="line">        <span class="comment">// interfaces：被代理者实现的接口们</span></span><br><span class="line">        <span class="comment">// h：代理者替被代理者要完成的工作的处理器对象</span></span><br><span class="line">        <span class="type">A</span> <span class="variable">proxy</span> <span class="operator">=</span> (A) Proxy.newProxyInstance(loader, interfaces, h);</span><br><span class="line">        proxy.a();</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">test02</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="type">BImpl</span> <span class="variable">b</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">BImpl</span>();</span><br><span class="line">        <span class="type">ClassLoader</span> <span class="variable">loader</span> <span class="operator">=</span> b.getClass().getClassLoader();</span><br><span class="line">        Class&lt;?&gt;[] interfaces = b.getClass().getInterfaces();</span><br><span class="line">        <span class="type">Handler</span> <span class="variable">h</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Handler</span>(b);</span><br><span class="line">        <span class="comment">//也可以代理B</span></span><br><span class="line">        <span class="type">B</span> <span class="variable">proxy</span> <span class="operator">=</span> (B) Proxy.newProxyInstance(loader, interfaces, h);</span><br><span class="line">        proxy.b();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div></div></div>
<h3 id="迭代器设计模式集合">迭代器设计模式（集合）</h3>
<p>在集合的内部设计迭代器类型，就体现了迭代器设计模式，参考[Java集合]。</p>
<h3 id="装饰者设计模式io流">装饰者设计模式（IO流）</h3>
<p>IO流体系结构就体现了装饰者设计模式，参考[JavaIO流]。</p>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="https://soundmemories.github.io/2020/03/14/Java/23.Java%20Lambda%E4%B8%8E%E5%87%BD%E6%95%B0%E5%BC%8F%E6%8E%A5%E5%8F%A3/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avstar.png">
      <meta itemprop="name" content="SoundMemories">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="SoundMemories">
      <meta itemprop="description" content="今日事，今日毕">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | SoundMemories">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2020/03/14/Java/23.Java%20Lambda%E4%B8%8E%E5%87%BD%E6%95%B0%E5%BC%8F%E6%8E%A5%E5%8F%A3/" class="post-title-link" itemprop="url">Java Lambda与函数式接口</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>

      <time title="创建时间：2020-03-14 00:00:00" itemprop="dateCreated datePublished" datetime="2020-03-14T00:00:00+08:00">2020-03-14</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">分类于</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/Java/" itemprop="url" rel="index"><span itemprop="name">Java</span></a>
        </span>
    </span>

  
    <span class="post-meta-break"></span>
    <span class="post-meta-item" title="本文字数">
      <span class="post-meta-item-icon">
        <i class="far fa-file-word"></i>
      </span>
      <span class="post-meta-item-text">本文字数：</span>
      <span>6.5k</span>
    </span>
    <span class="post-meta-item" title="阅读时长">
      <span class="post-meta-item-icon">
        <i class="far fa-clock"></i>
      </span>
      <span class="post-meta-item-text">阅读时长 &asymp;</span>
      <span>24 分钟</span>
    </span>
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <h2 id="lambda表达式">Lambda表达式</h2>
<p>Lambda表达式不是Java最早使用的，很多语言就支持Lambda表达式，例如：C++，C#，Python，Scala等。<br />
lambda表达式其实就是实现<strong>Single、Abstract、Method</strong>接口的语法糖，使得Java也算是支持函数式编程的语言。<br />
Lambda写的好可以极大的减少代码冗余，同时可读性也好过冗长的匿名内部类。</p>
<div class="tabs" id="示例"><ul class="nav-tabs"><li class="tab active"><a href="#示例-1">Runnable实现线程</a></li><li class="tab"><a href="#示例-2">foreach遍历</a></li><li class="tab"><a href="#示例-3">FileFilter文件过滤</a></li></ul><div class="tab-content"><div class="tab-pane active" id="示例-1"><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//Runnable接口符合SAM接口特征：Single单一的、Abstract抽象的、Method方法</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">test1</span><span class="params">()</span>&#123;</span><br><span class="line">    <span class="comment">//匿名实现多线程</span></span><br><span class="line">    <span class="keyword">new</span> <span class="title class_">Thread</span>(<span class="keyword">new</span> <span class="title class_">Runnable</span>()&#123;</span><br><span class="line">        <span class="meta">@Override</span></span><br><span class="line">        <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">run</span><span class="params">()</span>&#123;</span><br><span class="line">            System.out.println(<span class="string">&quot;do something..&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;).start();</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">test2</span><span class="params">()</span>&#123;</span><br><span class="line">    <span class="comment">//使用Lambda表达式实现多线程</span></span><br><span class="line">    <span class="comment">//Lambda体中只有一句，可以省略&#123;&#125;和;</span></span><br><span class="line">    <span class="keyword">new</span> <span class="title class_">Thread</span>(() -&gt; System.out.println(<span class="string">&quot;do something..&quot;</span>)).start();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div><div class="tab-pane" id="示例-2"><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">test1</span><span class="params">()</span>&#123;</span><br><span class="line">    List&lt;String&gt; list = Arrays.asList(<span class="string">&quot;hello&quot;</span>,<span class="string">&quot;java&quot;</span>,<span class="string">&quot;world&quot;</span>,<span class="string">&quot;lambda&quot;</span>);</span><br><span class="line">    <span class="keyword">for</span> (String string : list) &#123;</span><br><span class="line">        System.out.println(string);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">test2</span><span class="params">()</span>&#123;</span><br><span class="line">    List&lt;String&gt; list = Arrays.asList(<span class="string">&quot;hello&quot;</span>,<span class="string">&quot;java&quot;</span>,<span class="string">&quot;world&quot;</span>,<span class="string">&quot;lambda&quot;</span>);</span><br><span class="line">    <span class="comment">//forEach最优化写法</span></span><br><span class="line">    list.forEach(System.out::println);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div><div class="tab-pane" id="示例-3"><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">test1</span><span class="params">()</span>&#123;</span><br><span class="line">    <span class="comment">//1.文件目录</span></span><br><span class="line">    <span class="type">File</span> <span class="variable">fileDir</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">File</span>(<span class="string">&quot;D:/resource&quot;</span>);</span><br><span class="line">    <span class="comment">//2.创建筛选规则，帅选出所有.java文件</span></span><br><span class="line">    <span class="type">FileFilter</span> <span class="variable">filter</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">FileFilter</span>() &#123;</span><br><span class="line">        <span class="meta">@Override</span></span><br><span class="line">        <span class="keyword">public</span> <span class="type">boolean</span> <span class="title function_">accept</span><span class="params">(File file)</span> &#123;</span><br><span class="line">            <span class="keyword">if</span>(!file.isDirectory()&amp;&amp;file.getName().endsWith(<span class="string">&quot;.java&quot;</span>))&#123;</span><br><span class="line">                <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;;</span><br><span class="line">    <span class="comment">//3.得到筛选文件</span></span><br><span class="line">    File[] files = fileDir.listFiles(filter);</span><br><span class="line">    <span class="keyword">for</span> (File file : files) &#123;</span><br><span class="line">        System.out.println(file);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">test2</span><span class="params">()</span>&#123;</span><br><span class="line">    <span class="comment">//1.文件目录</span></span><br><span class="line">    <span class="type">File</span> <span class="variable">fileDir</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">File</span>(<span class="string">&quot;D:/resource&quot;</span>);</span><br><span class="line">    <span class="comment">//2.得到筛选文件，帅选出所有.java文件</span></span><br><span class="line">    File[] files = fileDir.listFiles((file) -&gt; !file.isDirectory() &amp;&amp; file.getName().endsWith(<span class="string">&quot;.java&quot;</span>));</span><br><span class="line">    <span class="comment">//3、遍历查看结果</span></span><br><span class="line">    Arrays.asList(files).forEach(System.out::println);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div></div></div>
<h3 id="函数式接口">函数式接口</h3>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br></pre></td><td class="code"><pre><span class="line">Lambda表达式，本质是用来<span class="string">&quot;实现SAM接口（函数式接口）&quot;</span>。</span><br><span class="line">SAM接口就是<span class="string">&quot;Single Abstract Method&quot;</span>，即该接口中<span class="string">&#x27;只有一个抽象方法需要实现&#x27;</span>，当然该接口可以包含其他非抽象方法。</span><br><span class="line">如果要更明确些，最好在声明自定义接口时，加上<span class="string">&quot;@FunctionalInterface&quot;</span>。</span><br><span class="line"></span><br><span class="line">核心类库中存在很多SAM接口：java.lang.Runnable、java.lang.Iterable、java.lang.Comparable...</span><br><span class="line">java.util.function包中有很多SAM接口，分类为消费型接口、供给型接口、功能型接口、判断型接口，一共<span class="number">43</span>个。</span><br><span class="line">开发中需要设计函数式接口，请先从以上接口中选择是否有满足需求的，如果有几不需要重新设计了。</span><br><span class="line"></span><br><span class="line"><span class="number">1.</span>消费型接口：有形参，但是返回值类型是<span class="keyword">void</span>。</span><br><span class="line">接口名                        抽象方法                           描述</span><br><span class="line">Consumer&lt;T&gt;               <span class="keyword">void</span> <span class="title function_">accept</span><span class="params">(T t)</span>                 接收一个对象用于完成功能</span><br><span class="line">BiConsumer&lt;T,U&gt;           <span class="keyword">void</span> <span class="title function_">accept</span><span class="params">(T t, U u)</span>            接收一个对象用于完成功能</span><br><span class="line">DoubleConsumer            <span class="keyword">void</span> <span class="title function_">accept</span><span class="params">(<span class="type">double</span> value)</span>        接收一个<span class="type">double</span>值</span><br><span class="line">IntConsumer               <span class="keyword">void</span> <span class="title function_">accept</span><span class="params">(<span class="type">int</span> value)</span>           接收一个<span class="type">int</span>值</span><br><span class="line">LongConsumer              <span class="keyword">void</span> <span class="title function_">accept</span><span class="params">(<span class="type">long</span> value)</span>          接收一个<span class="type">long</span>值</span><br><span class="line">ObjDoubleConsumer&lt;T&gt;      <span class="keyword">void</span> <span class="title function_">accept</span><span class="params">(T t, <span class="type">double</span> value)</span>   接收一个对象和一个<span class="type">double</span>值</span><br><span class="line">ObjIntConsumer&lt;T&gt;         <span class="keyword">void</span> <span class="title function_">accept</span><span class="params">(T t, <span class="type">int</span> value)</span>      接收一个对象和一个<span class="type">int</span>值</span><br><span class="line">ObjLongConsumer&lt;T&gt;        <span class="keyword">void</span> <span class="title function_">accept</span><span class="params">(T t, <span class="type">long</span> value)</span>     接收一个对象和一个<span class="type">long</span>值</span><br><span class="line"></span><br><span class="line"><span class="number">2.</span>供给型接口：无参，有返回值。</span><br><span class="line">接口名                        抽象方法                           描述</span><br><span class="line">Supplier&lt;T&gt;               T <span class="title function_">get</span><span class="params">()</span>                          返回一个对象</span><br><span class="line">BooleanSupplier           <span class="type">boolean</span> <span class="title function_">getAsBoolean</span><span class="params">()</span>           返回一个<span class="type">boolean</span>值</span><br><span class="line">DoubleSupplier            <span class="type">double</span> <span class="title function_">getAsDouble</span><span class="params">()</span>             返回一个<span class="type">double</span>值</span><br><span class="line">IntSupplier               <span class="type">int</span> <span class="title function_">getAsInt</span><span class="params">()</span>                   返回一个<span class="type">int</span>值</span><br><span class="line">LongSupplier              <span class="type">long</span> <span class="title function_">getAsLong</span><span class="params">()</span>                 返回一个<span class="type">long</span>值</span><br><span class="line"></span><br><span class="line"><span class="number">3.</span>判断型接口：有参，返回值类型是<span class="type">boolean</span>。</span><br><span class="line">接口名                        抽象方法                           描述</span><br><span class="line">Predicate&lt;T&gt;              <span class="type">boolean</span> <span class="title function_">test</span><span class="params">(T t)</span>                接收一个对象</span><br><span class="line">BiPredicate&lt;T,U&gt;          <span class="type">boolean</span> <span class="title function_">test</span><span class="params">(T t, U u)</span>           接收两个对象</span><br><span class="line">DoublePredicate           <span class="type">boolean</span> <span class="title function_">test</span><span class="params">(<span class="type">double</span> value)</span>       接收一个<span class="type">double</span>值</span><br><span class="line">IntPredicate              <span class="type">boolean</span> <span class="title function_">test</span><span class="params">(<span class="type">int</span> value)</span>          接收一个<span class="type">int</span>值</span><br><span class="line">LongPredicate             <span class="type">boolean</span> <span class="title function_">test</span><span class="params">(<span class="type">long</span> value)</span>         接收一个<span class="type">long</span>值</span><br><span class="line"></span><br><span class="line"><span class="number">4.</span>功能型接口：有参数、有返回值。</span><br><span class="line">接口名                        抽象方法                                                描述</span><br><span class="line">Function&lt;T,R&gt;             R <span class="title function_">apply</span><span class="params">(T t)</span>                                     接收一个T类型对象，返回一个R类型对象结果</span><br><span class="line">UnaryOperator&lt;T&gt;          T <span class="title function_">apply</span><span class="params">(T t)</span>                                     接收一个T类型对象，返回一个T类型对象结果</span><br><span class="line">DoubleFunction&lt;R&gt;         R <span class="title function_">apply</span><span class="params">(<span class="type">double</span> value)</span>                            接收一个<span class="type">double</span>值，返回一个R类型对象</span><br><span class="line">IntFunction&lt;R&gt;            R <span class="title function_">apply</span><span class="params">(<span class="type">int</span> value)</span>                               接收一个<span class="type">int</span>值，返回一个R类型对象</span><br><span class="line">LongFunction&lt;R&gt;           R <span class="title function_">apply</span><span class="params">(<span class="type">long</span> value)</span>                              接收一个<span class="type">long</span>值，返回一个R类型对象</span><br><span class="line">ToDoubleFunction&lt;T&gt;       <span class="type">double</span> <span class="title function_">applyAsDouble</span><span class="params">(T value)</span>                    接收一个T类型对象，返回一个<span class="type">double</span></span><br><span class="line">ToIntFunction&lt;T&gt;          <span class="type">int</span> <span class="title function_">applyAsInt</span><span class="params">(T value)</span>                          接收一个T类型对象，返回一个<span class="type">int</span></span><br><span class="line">ToLongFunction&lt;T&gt;         <span class="type">long</span> <span class="title function_">applyAsLong</span><span class="params">(T value)</span>                        接收一个T类型对象，返回一个<span class="type">long</span></span><br><span class="line">DoubleToIntFunction       <span class="type">int</span> <span class="title function_">applyAsInt</span><span class="params">(<span class="type">double</span> value)</span>                     接收一个<span class="type">double</span>值，返回一个<span class="type">int</span>结果</span><br><span class="line">DoubleToLongFunction      <span class="type">long</span> <span class="title function_">applyAsLong</span><span class="params">(<span class="type">double</span> value)</span>                   接收一个<span class="type">double</span>值，返回一个<span class="type">long</span>结果</span><br><span class="line">IntToDoubleFunction       <span class="type">double</span> <span class="title function_">applyAsDouble</span><span class="params">(<span class="type">int</span> value)</span>                  接收一个<span class="type">int</span>值，返回一个<span class="type">double</span>结果</span><br><span class="line">IntToLongFunction         <span class="type">long</span> <span class="title function_">applyAsLong</span><span class="params">(<span class="type">int</span> value)</span>                      接收一个<span class="type">int</span>值，返回一个<span class="type">long</span>结果</span><br><span class="line">LongToDoubleFunction      <span class="type">double</span> <span class="title function_">applyAsDouble</span><span class="params">(<span class="type">long</span> value)</span>                 接收一个<span class="type">long</span>值，返回一个<span class="type">double</span>结果</span><br><span class="line">LongToIntFunction         <span class="type">int</span> <span class="title function_">applyAsInt</span><span class="params">(<span class="type">long</span> value)</span>                       接收一个<span class="type">long</span>值，返回一个<span class="type">int</span>结果</span><br><span class="line">DoubleUnaryOperator       <span class="type">double</span> <span class="title function_">applyAsDouble</span><span class="params">(<span class="type">double</span> operand)</span>             接收一个<span class="type">double</span>值，返回一个<span class="type">double</span></span><br><span class="line">IntUnaryOperator          <span class="type">int</span> <span class="title function_">applyAsInt</span><span class="params">(<span class="type">int</span> operand)</span>                      接收一个<span class="type">int</span>值，返回一个<span class="type">int</span>结果</span><br><span class="line">LongUnaryOperator         <span class="type">long</span> <span class="title function_">applyAsLong</span><span class="params">(<span class="type">long</span> operand)</span>                   接收一个<span class="type">long</span>值，返回一个<span class="type">long</span>结果</span><br><span class="line">BiFunction&lt;T,U,R&gt;         R <span class="title function_">apply</span><span class="params">(T t, U u)</span>                                接收一个T类型和一个U类型对象，返回一个R类型对象结果</span><br><span class="line">BinaryOperator&lt;T&gt;         T <span class="title function_">apply</span><span class="params">(T t, T u)</span>                                接收两个T类型对象，返回一个T类型对象结果</span><br><span class="line">ToDoubleBiFunction&lt;T,U&gt;   <span class="type">double</span> <span class="title function_">applyAsDouble</span><span class="params">(T t, U u)</span>                   接收一个T类型和一个U类型对象，返回一个<span class="type">double</span></span><br><span class="line">ToIntBiFunction&lt;T,U&gt;      <span class="type">int</span> <span class="title function_">applyAsInt</span><span class="params">(T t, U u)</span>                         接收一个T类型和一个U类型对象，返回一个<span class="type">int</span></span><br><span class="line">ToLongBiFunction&lt;T,U&gt;     <span class="type">long</span> <span class="title function_">applyAsLong</span><span class="params">(T t, U u)</span>                       接收一个T类型和一个U类型对象，返回一个<span class="type">long</span></span><br><span class="line">DoubleBinaryOperator      <span class="type">double</span> <span class="title function_">applyAsDouble</span><span class="params">(<span class="type">double</span> left, <span class="type">double</span> right)</span>  接收两个<span class="type">double</span>值，返回一个<span class="type">double</span>结果</span><br><span class="line">IntBinaryOperator         <span class="type">int</span> <span class="title function_">applyAsInt</span><span class="params">(<span class="type">int</span> left, <span class="type">int</span> right)</span>              接收两个<span class="type">int</span>值，返回一个<span class="type">int</span>结果</span><br><span class="line">LongBinaryOperator        <span class="type">long</span> <span class="title function_">applyAsLong</span><span class="params">(<span class="type">long</span> left, <span class="type">long</span> right)</span>          接收两个<span class="type">long</span>值，返回一个<span class="type">long</span>结果</span><br></pre></td></tr></table></figure>
<p><strong>自定义函数接口</strong><br />
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 1.声明一个接口，只能包含一个抽象方法</span></span><br><span class="line"><span class="comment">// 2.给这个接口加@FunctionalInterface</span></span><br><span class="line"><span class="meta">@FunctionalInterface</span></span><br><span class="line"><span class="keyword">interface</span> <span class="title class_">IntCalc</span>&#123;</span><br><span class="line">    <span class="type">int</span> <span class="title function_">cal</span><span class="params">(<span class="type">int</span> a , <span class="type">int</span> b)</span>;<span class="comment">//计算方法</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">TestDefineFunctionalInterface</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        getProduct(<span class="number">1</span>,<span class="number">2</span>, (<span class="type">int</span> a, <span class="type">int</span> b) -&gt; &#123;<span class="keyword">return</span> a+b;&#125;);<span class="comment">//Lambda实现IntCalc抽象方法</span></span><br><span class="line">        getProduct(<span class="number">1</span>,<span class="number">2</span>, (a, b) -&gt; a+b);<span class="comment">//优化</span></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">getProduct</span><span class="params">(<span class="type">int</span> a, <span class="type">int</span> b, IntCalc tools)</span>&#123;</span><br><span class="line">        <span class="type">int</span> <span class="variable">result</span> <span class="operator">=</span> tools.cal(a, b);</span><br><span class="line">        System.out.println(<span class="string">&quot;结果：&quot;</span> + result);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<h3 id="实现接口">实现接口</h3>
<p>Lambda表达式是用来实现SAM接口的，它相当于一个匿名函数，语法格式如下：<br />
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//(形参列表) -&gt; &#123;Lambda体&#125;</span></span><br><span class="line">(Type1 param1, Type2 param2, ..., TypeN paramN) -&gt; &#123;</span><br><span class="line">  statment1;</span><br><span class="line">  statment2;</span><br><span class="line">  <span class="comment">//...</span></span><br><span class="line">  <span class="keyword">return</span> statmentM;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">Lambda操作符<span class="string">&quot;-&gt;&quot;</span>将Lambda分为两个部分：</span><br><span class="line"><span class="number">1.</span>左侧：指定了Lambda形参列表，它其实就是函数式接口的抽象方法的形参列表。</span><br><span class="line"><span class="number">2.</span>右侧：指定了Lambda体，它其实就是实现函数式接口的抽象方法的方法体。</span><br><span class="line">Lambda形参列表：</span><br><span class="line"><span class="number">1.</span>如果无形参，那么()不可以省略；</span><br><span class="line"><span class="number">2.</span>如果有形参，并且形参只有一个，并且形参类型已知或可推断，那么可以省略()和数据类型，只写形参名；</span><br><span class="line"><span class="number">3.</span>如果形参不止一个，那么()不可以省略，但是如果形参类型已知或可推断，那么可以省略数据类型。</span><br><span class="line">Lambda体：</span><br><span class="line"><span class="number">1.</span>如果函数式接口的抽象方法有返回值（非<span class="keyword">void</span>），那么Lambda体必须要有<span class="string">&quot;return 返回值;&quot;</span>语句；</span><br><span class="line"><span class="number">2.</span>如果只有一个语句，那么&#123;&#125;可以省略，如果&#123;&#125;省略了，那么语句后面的<span class="string">&quot;;&quot;</span>也要省略。</span><br><span class="line"><span class="number">3.</span>如果只有一个<span class="string">&quot;return 返回值;&quot;</span>语句，那么<span class="string">&quot;&#123;&#125;、return、;&quot;</span>都可以省略，Lambda体只写返回值即可。</span><br></pre></td></tr></table></figure>
<div class="tabs" id="lambda操作符"><ul class="nav-tabs"><li class="tab active"><a href="#lambda操作符-1">无参、无返回值</a></li><li class="tab"><a href="#lambda操作符-2">有参、无返回值</a></li><li class="tab"><a href="#lambda操作符-3">无参、有返回值</a></li><li class="tab"><a href="#lambda操作符-4">有参、有返回值1</a></li><li class="tab"><a href="#lambda操作符-5">有参、有返回值2</a></li></ul><div class="tab-content"><div class="tab-pane active" id="lambda操作符-1"><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">TestLambda1</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">test1</span><span class="params">()</span>&#123;</span><br><span class="line">        <span class="comment">//不使用Lambda表达式</span></span><br><span class="line">        <span class="keyword">new</span> <span class="title class_">Thread</span>(<span class="keyword">new</span> <span class="title class_">Runnable</span>()&#123;</span><br><span class="line">            <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">run</span><span class="params">()</span>&#123;</span><br><span class="line">                System.out.println(<span class="string">&quot;do something..&quot;</span>);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;).start();</span><br><span class="line">        <span class="comment">//使用Lambda表达式</span></span><br><span class="line">        <span class="keyword">new</span> <span class="title class_">Thread</span>(() -&gt; &#123;System.out.println(<span class="string">&quot;do something..&quot;</span>);&#125;).start();</span><br><span class="line">        <span class="comment">//Lambda简化，空参，只有一个语句省略&#123;&#125;和;</span></span><br><span class="line">        <span class="keyword">new</span> <span class="title class_">Thread</span>(() -&gt; System.out.println(<span class="string">&quot;do something..&quot;</span>)).start();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div><div class="tab-pane" id="lambda操作符-2"><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> java.util.Arrays;</span><br><span class="line"><span class="keyword">import</span> java.util.HashMap;</span><br><span class="line"><span class="keyword">import</span> java.util.List;</span><br><span class="line"><span class="keyword">import</span> java.util.Map.Entry;</span><br><span class="line"><span class="keyword">import</span> java.util.Set;</span><br><span class="line"><span class="comment">//Iterable接口方法void forEach(Consumer&lt;? super T&gt; action)：遍历Collection集合的每个元素，执行“xxx消费型”操作。</span></span><br><span class="line"><span class="comment">//Map接口方法void forEach(BiConsumer&lt;? super K,? super V&gt; action)：遍历Map集合的每对映射关系，执行“xxx消费型”操作。</span></span><br><span class="line"><span class="comment">//这里Lambda实现了上面方法的Consumer、BiConsumer接口。</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">TestLambda2</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">test1</span><span class="params">()</span>&#123;</span><br><span class="line">        List&lt;String&gt; list = Arrays.asList(<span class="string">&quot;hello&quot;</span>,<span class="string">&quot;java&quot;</span>);</span><br><span class="line">        HashMap&lt;Integer,String&gt; map = <span class="keyword">new</span> <span class="title class_">HashMap</span>&lt;&gt;();</span><br><span class="line">        map.put(<span class="number">1</span>, <span class="string">&quot;hello&quot;</span>);</span><br><span class="line">        map.put(<span class="number">2</span>, <span class="string">&quot;java&quot;</span>);</span><br><span class="line">        Set&lt;Entry&lt;Integer, String&gt;&gt; entrySet = map.entrySet();</span><br><span class="line">        <span class="comment">//不使用Lambda表达式</span></span><br><span class="line">        <span class="keyword">for</span> (String string : list) &#123;</span><br><span class="line">            System.out.println(string);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">for</span> (Entry&lt;Integer, String&gt; entry : entrySet) &#123;</span><br><span class="line">            System.out.println(entry.getKey() + <span class="string">&quot;-&gt;&quot;</span> + entry.getValue());</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">//使用Lambda表达式</span></span><br><span class="line">        map.forEach((Integer k,String v) -&gt; &#123;System.out.println(k+<span class="string">&quot;-&gt;&quot;</span>+v);&#125;);</span><br><span class="line">        list.forEach((String s) -&gt; &#123;System.out.println(s);&#125;);</span><br><span class="line">        <span class="comment">//Lambda简化，有参，只有一个语句省略&#123;&#125;和;</span></span><br><span class="line">        map.forEach((k,v) -&gt; System.out.println(k+<span class="string">&quot;-&gt;&quot;</span>+v));</span><br><span class="line">        list.forEach(s -&gt; System.out.println(s));</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div><div class="tab-pane" id="lambda操作符-3"><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> java.util.stream.Stream;</span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">TestLambda3</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">test1</span><span class="params">()</span>&#123;</span><br><span class="line">        <span class="comment">//随机产生一个[0,1)小数，返回类型为Double</span></span><br><span class="line">        Stream&lt;Double&gt; stream = Stream.generate(() -&gt; &#123;<span class="keyword">return</span> Math.random();&#125;);</span><br><span class="line">        stream.forEach((Double num) -&gt; &#123;System.out.println(num);&#125;);</span><br><span class="line">        <span class="comment">//Lambda简化，无参，只有一个语句省略&#123;&#125;和;</span></span><br><span class="line">        Stream&lt;Double&gt; stream = Stream.generate(() -&gt; Math.random());</span><br><span class="line">        stream.forEach(num -&gt; System.out.println(num));</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div><div class="tab-pane" id="lambda操作符-4"><figure class="highlight java"><figcaption><span>TestLambda4.java</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//Map接口的void replaceAll(BiFunction&lt;? super K,? super V,? extends V&gt; function)：按照function操作替换map中的value。</span></span><br><span class="line"><span class="comment">//这里Lambda实现了上面方法的BiFunction接口。</span></span><br><span class="line"><span class="keyword">import</span> java.util.HashMap;</span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Employee</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> String name;</span><br><span class="line">    <span class="keyword">private</span> <span class="type">double</span> salary;</span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">Employee</span><span class="params">(String name, <span class="type">double</span> salary)</span> &#123;</span><br><span class="line">        <span class="built_in">super</span>();</span><br><span class="line">        <span class="built_in">this</span>.name = name;</span><br><span class="line">        <span class="built_in">this</span>.salary = salary;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">Employee</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="built_in">super</span>();</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">getName</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> name;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setName</span><span class="params">(String name)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.name = name;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="type">double</span> <span class="title function_">getSalary</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> salary;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setSalary</span><span class="params">(<span class="type">double</span> salary)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.salary = salary;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">toString</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;Employee [name=&quot;</span> + name + <span class="string">&quot;, salary=&quot;</span> + salary + <span class="string">&quot;]&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">TestLambda4</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">test1</span><span class="params">()</span>&#123;</span><br><span class="line">        HashMap&lt;String,Employee&gt; map = <span class="keyword">new</span> <span class="title class_">HashMap</span>&lt;&gt;();</span><br><span class="line">        map.put(<span class="string">&quot;张三&quot;</span>, <span class="keyword">new</span> <span class="title class_">Employee</span>(<span class="string">&quot;张三&quot;</span>, <span class="number">8000</span>));</span><br><span class="line">        map.put(<span class="string">&quot;王五&quot;</span>, <span class="keyword">new</span> <span class="title class_">Employee</span>(<span class="string">&quot;王五&quot;</span>, <span class="number">12000</span>));</span><br><span class="line">        <span class="comment">//把薪资低于1w的工资修改为1w</span></span><br><span class="line">        map.replaceAll((String k, Employee v) -&gt; &#123;</span><br><span class="line">            <span class="keyword">if</span>(v.getSalary() &lt; <span class="number">10000</span>)&#123;</span><br><span class="line">                v.setSalary(<span class="number">10000</span>);</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">return</span> v;</span><br><span class="line">        &#125;);</span><br><span class="line">        map.forEach((String k, Employee v) -&gt; &#123;System.out.println(k+<span class="string">&quot;-&gt;&quot;</span>+v);&#125;);</span><br><span class="line">        <span class="comment">//Lambda简化，省略k，v类型，if的中括号</span></span><br><span class="line">        map.replaceAll((k,v) -&gt; &#123;<span class="keyword">if</span>(v.getSalary() &lt; <span class="number">10000</span>) v.setSalary(<span class="number">10000</span>); <span class="keyword">return</span> v;&#125;);</span><br><span class="line">        map.forEach((k, v) -&gt; System.out.println(k+<span class="string">&quot;-&gt;&quot;</span>+v));</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div><div class="tab-pane" id="lambda操作符-5"><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//Collecton接口的boolean removeIf(Predicate&lt;? super E&gt; filter)：用于删除集合中满足filter指定的条件判断的。</span></span><br><span class="line"><span class="comment">//这里Lambda实现了上面方法的Predicate接口。</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">TestLambda4</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">test3</span><span class="params">()</span>&#123;</span><br><span class="line">        ArrayList&lt;Employee&gt; list = <span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;&gt;();</span><br><span class="line">        list.add(<span class="keyword">new</span> <span class="title class_">Employee</span>(<span class="string">&quot;张三&quot;</span>, <span class="number">8000</span>));</span><br><span class="line">        list.add(<span class="keyword">new</span> <span class="title class_">Employee</span>(<span class="string">&quot;王五&quot;</span>, <span class="number">12000</span>));</span><br><span class="line">        <span class="comment">//删除那些薪资低于10000的</span></span><br><span class="line">        list.removeIf((Employee e) -&gt; &#123;<span class="keyword">return</span> e.getSalary() &gt; <span class="number">10000</span>;&#125;);</span><br><span class="line">        list.forEach((Employee e) -&gt; &#123;System.out.println(e);&#125;);</span><br><span class="line">        <span class="comment">//省略了()、数据类型、&#123;&#125;、;</span></span><br><span class="line">        list.removeIf(e -&gt; e.getSalary() &gt; <span class="number">10000</span>);</span><br><span class="line">        list.forEach(e -&gt; System.out.println(e));</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div></div></div>
<h3 id="方法和构造器引用">方法和构造器引用</h3>
<p>当Lambda体的实现，是通过调用一个现有的方法来完成功能时，那么可以考虑再次简化代码，使用方法引用和构造器引用。<br />
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">满足其中一个要求：</span><br><span class="line"><span class="number">1.</span>函数式接口的<span class="string">&quot;抽象方法的形参列表与返回值类型&quot;</span>与<span class="string">&quot;该方法的形参列表与返回值类型&quot;</span>要对应。</span><br><span class="line"><span class="number">2.</span>函数式接口的<span class="string">&quot;抽象方法的形参列表的第一个形参是作为调用方法的实例，剩余的形参正好对应这个方法的实参列表&quot;</span>。</span><br><span class="line"></span><br><span class="line">方法引用：<span class="string">&quot;类/对象::方法名&quot;</span></span><br><span class="line">构造器引用：<span class="string">&quot;类名/数组类型::new&quot;</span></span><br></pre></td></tr></table></figure></p>
<div class="tabs" id="方法和构造器"><ul class="nav-tabs"><li class="tab active"><a href="#方法和构造器-1">对象::实例方法名</a></li><li class="tab"><a href="#方法和构造器-2">类::静态方法名</a></li><li class="tab"><a href="#方法和构造器-3">类::实例方法名</a></li><li class="tab"><a href="#方法和构造器-4">类名::new</a></li><li class="tab"><a href="#方法和构造器-5">数组类型::new</a></li></ul><div class="tab-content"><div class="tab-pane active" id="方法和构造器-1"><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> java.text.Collator;</span><br><span class="line"><span class="keyword">import</span> java.util.HashMap;</span><br><span class="line"><span class="keyword">import</span> java.util.TreeSet;</span><br><span class="line"><span class="comment">//Consumer&lt;T&gt;的抽象方法void accept(T t)，它的Lambda体是通过调用System.out.println(Object x)来完成，它们都是有参无返回值。</span></span><br><span class="line"><span class="comment">//Comparator&lt;T&gt;的抽象方法int compare(T t1,T t2)，它的Lambda体是通过调用Collator文本校对器对象的compare(t1,t2)方法来完成，</span></span><br><span class="line"><span class="comment">//他们的形参列表和返回值类型完成可以对上。</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">test1</span><span class="params">()</span>&#123;</span><br><span class="line">    List&lt;String&gt; list = Arrays.asList(<span class="string">&quot;hello&quot;</span>,<span class="string">&quot;java&quot;</span>);</span><br><span class="line">    <span class="comment">//使用Lambda表达式</span></span><br><span class="line">    list.forEach(e -&gt; System.out.println(e));</span><br><span class="line">    <span class="comment">//使用方法引用</span></span><br><span class="line">    list.forEach(System.out::println);</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">test2</span><span class="params">()</span>&#123;</span><br><span class="line">    <span class="comment">//使用Lambda表达式</span></span><br><span class="line">    TreeSet&lt;String&gt; set = <span class="keyword">new</span> <span class="title class_">TreeSet</span>&lt;&gt;((t1,t2) -&gt; Collator.getInstance().compare(t1, t2));</span><br><span class="line">    set.add(<span class="string">&quot;张三&quot;</span>);</span><br><span class="line">    set.add(<span class="string">&quot;李四&quot;</span>);</span><br><span class="line">    set.forEach(e -&gt; System.out.println(e));</span><br><span class="line">    <span class="comment">//使用方法引用</span></span><br><span class="line">    <span class="comment">//Consumer&lt;T&gt;           public void accept(T t)</span></span><br><span class="line">    <span class="comment">//PrintStream out对象的  public void println(Object x)</span></span><br><span class="line">    TreeSet&lt;String&gt; set = <span class="keyword">new</span> <span class="title class_">TreeSet</span>&lt;&gt;(Collator.getInstance()::compare);</span><br><span class="line">    set.add(<span class="string">&quot;张三&quot;</span>);</span><br><span class="line">    set.add(<span class="string">&quot;李四&quot;</span>);</span><br><span class="line">    set.forEach(System.out::println);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div><div class="tab-pane" id="方法和构造器-2"><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> java.util.stream.Stream;</span><br><span class="line"><span class="comment">//Supplier&lt;T&gt;的抽象方法T get()，它的lambda体是通过调用Math.random()来完成的，它们都是无参有返回值。</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">test1</span><span class="params">()</span>&#123;</span><br><span class="line">    <span class="comment">//使用Lambda表达式</span></span><br><span class="line">    Stream&lt;Double&gt; stream = Stream.generate(() -&gt; Math.random());</span><br><span class="line">    stream.forEach(num -&gt; System.out.println(num));</span><br><span class="line">    <span class="comment">//使用方法引用</span></span><br><span class="line">    <span class="comment">//Supplier&lt;T&gt;            T  get() </span></span><br><span class="line">    <span class="comment">//java.lang.Math类的   double random()  </span></span><br><span class="line">    Stream&lt;Double&gt; stream = Stream.generate(Math::random);</span><br><span class="line">    stream.forEach(System.out::println);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div><div class="tab-pane" id="方法和构造器-3"><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//Comparator&lt;T&gt;的抽象方法int compare(T t1,T t2)的的Lambda体是通过调用String对象的compareToIgnoreCase(String o)来完成的。</span></span><br><span class="line"><span class="comment">//第一个参数t1调用compareToIgnoreCase，compare剩下的参数正好是给compareToIgnoreCase的实参，它俩的返回值类型都是int。</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">test1</span><span class="params">()</span>&#123;</span><br><span class="line">    String[] arr = &#123;<span class="string">&quot;Hello&quot;</span>,<span class="string">&quot;java&quot;</span>&#125;;</span><br><span class="line">    <span class="comment">//使用generate</span></span><br><span class="line">    Arrays.sort(arr, (s1,s2) -&gt; s1.compareToIgnoreCase(s2));</span><br><span class="line">    System.out.println(Arrays.toString(arr));</span><br><span class="line">    <span class="comment">//使用方法引用</span></span><br><span class="line">    <span class="comment">//Comparator&lt;String&gt;  int compare(String s1, String s2)</span></span><br><span class="line">    <span class="comment">//String类的          int compareToIgnoreCase(String str) </span></span><br><span class="line">    <span class="comment">//此处s1正好是调用compareToIgnoreCase的对象，s2是给它的参数</span></span><br><span class="line">    Arrays.sort(arr, String::compareToIgnoreCase);</span><br><span class="line">    System.out.println(Arrays.toString(arr));</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div><div class="tab-pane" id="方法和构造器-4"><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//工具类Optional&lt;T&gt;，它是一个容器，可以用来包装一个对象。</span></span><br><span class="line"><span class="comment">//如果所包装的对象非null，通过get()方法可以获取到这个对象。</span></span><br><span class="line"><span class="comment">//如果所包装的对象是null，调用get()方法会报异常，所以需要调用orElseGet(Supplier&lt;? extends T&gt; other)来获取对象。</span></span><br><span class="line"><span class="comment">//即如果该对象存在，就返回该对象，否则返回由Supplier接口实现所提供的对象。</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">test1</span><span class="params">()</span>&#123;</span><br><span class="line">    HashMap&lt;String,Employee&gt; map = <span class="keyword">new</span> <span class="title class_">HashMap</span>&lt;&gt;();</span><br><span class="line">    map.put(<span class="string">&quot;张三&quot;</span>, <span class="keyword">new</span> <span class="title class_">Employee</span>(<span class="string">&quot;张三&quot;</span>, <span class="number">8000</span>));</span><br><span class="line">    map.put(<span class="string">&quot;李四&quot;</span>, <span class="keyword">new</span> <span class="title class_">Employee</span>(<span class="string">&quot;李四&quot;</span>, <span class="number">9000</span>));</span><br><span class="line">    Optional&lt;Employee&gt; opt = Optional.ofNullable(map.get(<span class="string">&quot;王五&quot;</span>));</span><br><span class="line">    <span class="comment">//使用Lambda表达式</span></span><br><span class="line">    <span class="type">Employee</span> <span class="variable">emp</span> <span class="operator">=</span> opt.orElseGet(() -&gt; <span class="keyword">new</span> <span class="title class_">Employee</span>());</span><br><span class="line">    System.out.println(emp);</span><br><span class="line">    <span class="comment">//使用构造器引用</span></span><br><span class="line">    <span class="type">Employee</span> <span class="variable">emp</span> <span class="operator">=</span> opt.orElseGet(Employee::<span class="keyword">new</span>);</span><br><span class="line">    System.out.println(emp);</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">test2</span><span class="params">()</span>&#123;</span><br><span class="line">    <span class="comment">//lambda表达式也可以用于给SAM接口的变量赋值，这里要new一个String的空对象</span></span><br><span class="line">    <span class="comment">//使用Lambda表达式</span></span><br><span class="line">    Supplier&lt;String&gt; s = () -&gt; <span class="keyword">new</span> <span class="title class_">String</span>();</span><br><span class="line">    <span class="comment">//使用构造器引用，来创建对象</span></span><br><span class="line">    <span class="comment">//Supplier&lt;T&gt;   T get()</span></span><br><span class="line">    Supplier&lt;String&gt; s = String::<span class="keyword">new</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div><div class="tab-pane" id="方法和构造器-5"><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//public &lt;R&gt; R[] createArray(Function&lt;Integer,R[]&gt; fun,int length)：fun是SAM接口，可以赋值为Lambda表达式。</span></span><br><span class="line"><span class="comment">//Function&lt;T,R&gt;       R apply(T t)</span></span><br><span class="line"><span class="keyword">public</span> &lt;R&gt; R[] createArray(Function&lt;Integer,R[]&gt; fun,<span class="type">int</span> length)&#123;</span><br><span class="line">    <span class="comment">//模仿HashMap的源码实现的一个方法，创建一个2的n次方长度的数组</span></span><br><span class="line">    <span class="comment">//这个length是你希望的数组的长度，但是它可能不是2的n次方，那么对length进行处理，纠正为一个2的n次方长度，并且创建这个数组</span></span><br><span class="line">    <span class="type">int</span> <span class="variable">n</span> <span class="operator">=</span> length - <span class="number">1</span>;</span><br><span class="line">    n |= n &gt;&gt;&gt; <span class="number">1</span>;</span><br><span class="line">    n |= n &gt;&gt;&gt; <span class="number">2</span>;</span><br><span class="line">    n |= n &gt;&gt;&gt; <span class="number">4</span>;</span><br><span class="line">    n |= n &gt;&gt;&gt; <span class="number">8</span>;</span><br><span class="line">    n |= n &gt;&gt;&gt; <span class="number">16</span>;</span><br><span class="line">    length = n &lt; <span class="number">0</span> ? <span class="number">1</span> : n + <span class="number">1</span>;</span><br><span class="line">    <span class="keyword">return</span> fun.apply(length);</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">test1</span><span class="params">()</span>&#123;</span><br><span class="line">    <span class="comment">//使用Lambda表达式</span></span><br><span class="line">    Object[] arr1 = createArray(len -&gt; <span class="keyword">new</span> <span class="title class_">Object</span>[len], <span class="number">5</span>);</span><br><span class="line">    System.out.println(arr1.length);</span><br><span class="line">    <span class="comment">//使用构造器引用</span></span><br><span class="line">    Object[] arr2 = createArray(Object[]::<span class="keyword">new</span>, <span class="number">5</span>);</span><br><span class="line">    System.out.println(arr2.length);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div></div></div>
<p><strong>补充：Optional类</strong><br />
到目前为止，臭名昭著的空指针异常是导致Java应用程序失败的最常见原因。以前，为了解决空指针异常，Google公司著名的Guava项目引入了Optional类，Guava通过使用检查空值的方式来防止代码污染，它鼓励程序员写更干净的代码。受到Google
Guava的启发，Optional类已经成为Java 8类库的一部分。</p>
<p>Optional实际上是个容器：它可以保存类型T的值，或者仅仅保存null。<br />
Optional提供很多有用的方法，这样我们就不用显式进行空值检测。<br />
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">创建Optional类对象的方法（构造器私有化了）：</span><br><span class="line">|-Optional.of(T t): 创建一个Optional实例，t必须非<span class="literal">null</span>，t为<span class="literal">null</span>会报错。</span><br><span class="line">|-Optional.empty(): 创建一个空的Optional实例。</span><br><span class="line">|-Optional.ofNullable(T t)：创建一个Optional实例，t可以为<span class="literal">null</span>。</span><br><span class="line">判断Optional容器中是否包含对象：</span><br><span class="line">|-<span class="type">boolean</span> <span class="title function_">isPresent</span><span class="params">()</span>: 判断是否包含对象。</span><br><span class="line">|-<span class="keyword">void</span> <span class="title function_">ifPresent</span><span class="params">(Consumer&lt;? <span class="built_in">super</span> T&gt; consumer)</span>：如果有值，就执行Consumer接口的实现代码，并且该值会作为参数传给它。</span><br><span class="line">获取Optional容器的对象：</span><br><span class="line">|-T <span class="title function_">get</span><span class="params">()</span>: 如果调用对象包含非<span class="literal">null</span>值，返回该值，否则抛异常。必须配合of(xx)使用，因为这里面的对象不能是<span class="literal">null</span>。</span><br><span class="line">|-T <span class="title function_">orElse</span><span class="params">(T other)</span>：为<span class="literal">null</span>对象设置一个默认值other。如果有值则将其返回，否则返回指定的other对象。</span><br><span class="line">|-T <span class="title function_">orElseGet</span><span class="params">(Supplier&lt;? extends T&gt; other)</span>：如果有值则将其返回，否则返回由Supplier接口实现提供的对象。</span><br><span class="line">|-T <span class="title function_">orElseThrow</span><span class="params">(Supplier&lt;? extends X&gt; exceptionSupplier)</span>：如果有值则将其返回，否则抛出由Supplier接口实现提供的异常。</span><br><span class="line">对Optional中的对象进行操作：</span><br><span class="line">|-Optional&lt;T&gt; <span class="title function_">filter</span><span class="params">(Predicate&lt;? <span class="built_in">super</span> T&gt; predicate)</span>：如果有值，就判断该值是否满足predicate的条件，否则返回空的Optional。</span><br><span class="line">|-Optional&lt;U&gt; <span class="title function_">map</span><span class="params">(Function&lt;? <span class="built_in">super</span> T,? extends U&gt; mapper)</span>：</span><br><span class="line">    |-如果有值，对该值执行Function接口的实现代码，并返回一个Optional的结果，否则报空指针异常。</span><br><span class="line">|-Optional&lt;U&gt; <span class="title function_">flatMap</span><span class="params">(Function&lt;? <span class="built_in">super</span> T,Optional&lt;U&gt;&gt; mapper)</span>：</span><br><span class="line">    |-如果有值，对该值执行Function接口的实现代码，并返回一个Optional的结果，否则报空指针异常。该方法和map方法的区别是：</span><br><span class="line">    |-map方法的Function接口的实现不负责把结果包装为Optional对象，该操作由map方法自己完成。</span><br><span class="line">    |-而flatMap方法的Function接口的实现直接把结果包装为Optional对象了，flatMap方法不需要再次包装了。</span><br></pre></td></tr></table></figure></p>
<div class="tabs" id="optional"><ul class="nav-tabs"><li class="tab active"><a href="#optional-1">创建、判断</a></li><li class="tab"><a href="#optional-2">创建、操作</a></li></ul><div class="tab-content"><div class="tab-pane active" id="optional-1"><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">test1</span><span class="params">()</span>&#123;</span><br><span class="line">    <span class="type">Boy</span> <span class="variable">b</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Boy</span>(<span class="string">&quot;张三&quot;</span>);</span><br><span class="line">    Optional&lt;Girl&gt; opt = Optional.ofNullable(b.getGrilFriend());</span><br><span class="line">    <span class="comment">//如果女朋友存在就打印女朋友的信息</span></span><br><span class="line">    opt.ifPresent(System.out::println);</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">test2</span><span class="params">()</span>&#123;</span><br><span class="line">    <span class="type">Boy</span> <span class="variable">b</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Boy</span>(<span class="string">&quot;张三&quot;</span>);</span><br><span class="line">    Optional&lt;Girl&gt; opt = Optional.ofNullable(b.getGrilFriend());</span><br><span class="line">    <span class="comment">//如果有女朋友就返回他的女朋友，否则只能欣赏“嫦娥”了</span></span><br><span class="line">    <span class="type">Girl</span> <span class="variable">girl</span> <span class="operator">=</span> opt.orElse(<span class="keyword">new</span> <span class="title class_">Girl</span>(<span class="string">&quot;嫦娥&quot;</span>));</span><br><span class="line">    System.out.println(<span class="string">&quot;他的女朋友是：&quot;</span> + girl.getName());</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div><div class="tab-pane" id="optional-2"><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">test3</span><span class="params">()</span>&#123;</span><br><span class="line">    Optional&lt;Employee&gt; opt = Optional.of(<span class="keyword">new</span> <span class="title class_">Employee</span>(<span class="string">&quot;张三&quot;</span>, <span class="number">8888</span>));</span><br><span class="line">    <span class="comment">//判断opt中员工对象是否满足条件，如果满足就保留，否则返回空</span></span><br><span class="line">    Optional&lt;Employee&gt; emp = opt.filter(e -&gt; e.getSalary()&gt;<span class="number">10000</span>);</span><br><span class="line">    System.out.println(emp);</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">test4</span><span class="params">()</span>&#123;</span><br><span class="line">    Optional&lt;Employee&gt; opt = Optional.of(<span class="keyword">new</span> <span class="title class_">Employee</span>(<span class="string">&quot;张三&quot;</span>, <span class="number">8888</span>));</span><br><span class="line">    <span class="comment">//如果opt中员工对象不为空，就涨薪10%</span></span><br><span class="line">    Optional&lt;Employee&gt; emp = opt.map(e -&gt; &#123;e.setSalary(e.getSalary()%<span class="number">1.1</span>);<span class="keyword">return</span> e;&#125;);</span><br><span class="line">    System.out.println(emp);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div></div></div>
<h2 id="stream-api">Stream API</h2>
<p>Stream
API（java.util.stream）提供了一种高效且易于使用的处理数据的方式，可对集合数据进行操作，可以执行非常复杂的查找、过滤和映射数据等操作，就类似于使用
SQL 执行的数据库查询。</p>
<p><strong>1.Stream特点</strong>：<br />
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//集合存储数据，Stream流是数据渠道，负责处理数据。</span></span><br><span class="line">Stream 自己不会存储元素。</span><br><span class="line">Stream 不会改变源对象。每次处理都会返回一个持有结果的新Stream。</span><br><span class="line">Stream 操作是延迟执行的。这意味着他们会等到需要结果的时候才执行。</span><br></pre></td></tr></table></figure></p>
<p><strong>2.Stream操作三个步骤</strong>：<br />
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">创建流：通过一个数据源（如集合、数组），获取一个流。</span><br><span class="line">中间操作：操作链，对数据源的数据进行n次处理，但是在终结操作前，并不会真正执行。</span><br><span class="line">终止操作：一旦执行终止操作，就执行中间操作链，最终产生结果并结束Stream。</span><br></pre></td></tr></table></figure></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Employee</span>&#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="type">int</span> id;</span><br><span class="line">    <span class="keyword">private</span> String name;</span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">Employee</span><span class="params">(<span class="type">int</span> id, String name)</span> &#123;</span><br><span class="line">        <span class="built_in">super</span>();</span><br><span class="line">        <span class="built_in">this</span>.id = id;</span><br><span class="line">        <span class="built_in">this</span>.name = name;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">Employee</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="built_in">super</span>();</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="type">int</span> <span class="title function_">getId</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> id;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setId</span><span class="params">(<span class="type">int</span> id)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.id = id;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">getName</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> name;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setName</span><span class="params">(String name)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.name = name;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">toString</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;Employee [id=&quot;</span> + id + <span class="string">&quot;, name=&quot;</span> + name + <span class="string">&quot;]&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="type">int</span> <span class="title function_">hashCode</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">final</span> <span class="type">int</span> <span class="variable">prime</span> <span class="operator">=</span> <span class="number">31</span>;</span><br><span class="line">        <span class="type">int</span> <span class="variable">result</span> <span class="operator">=</span> <span class="number">1</span>;</span><br><span class="line">        result = prime * result + id;</span><br><span class="line">        result = prime * result + ((name == <span class="literal">null</span>) ? <span class="number">0</span> : name.hashCode());</span><br><span class="line">        <span class="keyword">return</span> result;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="type">boolean</span> <span class="title function_">equals</span><span class="params">(Object obj)</span> &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;比较....&quot;</span>);</span><br><span class="line">        <span class="keyword">if</span> (<span class="built_in">this</span> == obj)</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">        <span class="keyword">if</span> (obj == <span class="literal">null</span>)</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">        <span class="keyword">if</span> (getClass() != obj.getClass())</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">        <span class="type">Employee</span> <span class="variable">other</span> <span class="operator">=</span> (Employee) obj;</span><br><span class="line">        <span class="keyword">if</span> (id != other.id)</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">        <span class="keyword">if</span> (name == <span class="literal">null</span>) &#123;</span><br><span class="line">            <span class="keyword">if</span> (other.name != <span class="literal">null</span>)</span><br><span class="line">                <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">        &#125; <span class="keyword">else</span> <span class="keyword">if</span> (!name.equals(other.name))</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">TestStream</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">test01</span><span class="params">()</span>&#123;</span><br><span class="line">        ArrayList&lt;Employee&gt; list= <span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;&gt;();</span><br><span class="line">        list.add(<span class="keyword">new</span> <span class="title class_">Employee</span>(<span class="number">1</span>,<span class="string">&quot;张三&quot;</span>));</span><br><span class="line">        list.add(<span class="keyword">new</span> <span class="title class_">Employee</span>(<span class="number">1</span>,<span class="string">&quot;张三&quot;</span>));</span><br><span class="line"></span><br><span class="line">        Stream&lt;Employee&gt; stream = list.stream();</span><br><span class="line">        stream = stream.distinct();<span class="comment">//中间操作，去重</span></span><br><span class="line">        <span class="type">long</span> <span class="variable">count</span> <span class="operator">=</span> stream.count();<span class="comment">//终结操作，统计</span></span><br><span class="line">        System.out.println(count);<span class="comment">//1</span></span><br><span class="line">        <span class="comment">//重新遍历，不影响原list</span></span><br><span class="line">        <span class="keyword">for</span> (Employee employee : list) &#123;</span><br><span class="line">            System.out.println(employee);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="创建流">创建流</h3>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">1.</span>通过集合：Java8中的Collection接口被扩展，提供了两个获取流的方法：</span><br><span class="line">|-Stream&lt;E&gt; <span class="title function_">stream</span><span class="params">()</span>：返回一个顺序流。</span><br><span class="line">|-Stream&lt;E&gt; <span class="title function_">parallelStream</span><span class="params">()</span>：返回一个并行流。</span><br><span class="line"><span class="number">2.</span>通过数组：Java8中的Arrays的静态方法stream()可以获取数组流：</span><br><span class="line">|-<span class="keyword">static</span>&lt;T&gt; Stream&lt;T&gt; <span class="title function_">stream</span><span class="params">(T[] array)</span>：返回一个流。</span><br><span class="line">|-IntStream <span class="title function_">stream</span><span class="params">(<span class="type">int</span>[] array)</span>：返回一个整型数据流。</span><br><span class="line">|-LongStream <span class="title function_">stream</span><span class="params">(<span class="type">long</span>[] array)</span>：返回一个长整型数据流。</span><br><span class="line">|-DoubleStream <span class="title function_">stream</span><span class="params">(<span class="type">double</span>[] array)</span>：返回一个浮点型数据流。</span><br><span class="line"><span class="number">3.</span>通过Stream的静态方法of()：</span><br><span class="line">|-<span class="keyword">static</span>&lt;T&gt; Stream&lt;T&gt; <span class="title function_">of</span><span class="params">(T... values)</span>：通过显示值创建一个流。它可以接收任意数量的参数。返回一个顺序流。</span><br><span class="line"><span class="number">4.</span>创建无限流：</span><br><span class="line">|-<span class="keyword">static</span>&lt;T&gt; Stream&lt;T&gt; <span class="title function_">iterate</span><span class="params">(<span class="keyword">final</span> T seed, <span class="keyword">final</span> UnaryOperator&lt;T&gt; f)</span>：返回一个无限流。</span><br><span class="line">|-<span class="keyword">static</span>&lt;T&gt; Stream&lt;T&gt; <span class="title function_">generate</span><span class="params">(Supplier&lt;T&gt; s)</span>：返回一个无限流。</span><br></pre></td></tr></table></figure>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.memories.stream;</span><br><span class="line"><span class="keyword">import</span> java.util.Arrays;</span><br><span class="line"><span class="keyword">import</span> java.util.List;</span><br><span class="line"><span class="keyword">import</span> java.util.stream.Stream;</span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">TestCreateStream</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">test1</span><span class="params">()</span> &#123;</span><br><span class="line">        List&lt;String&gt; list = Arrays.asList(<span class="string">&quot;hello&quot;</span>, <span class="string">&quot;world&quot;</span>);</span><br><span class="line">        Stream&lt;String&gt; stream = list.stream();<span class="comment">//创建stream</span></span><br><span class="line">        stream.forEach(System.out::println);<span class="comment">//终结，遍历stream流中的数据</span></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">test2</span><span class="params">()</span> &#123;</span><br><span class="line">        String[] array = &#123; <span class="string">&quot;hello&quot;</span>, <span class="string">&quot;world&quot;</span>&#125;;</span><br><span class="line">        Stream&lt;String&gt; stream = Arrays.stream(array);<span class="comment">//创建stream</span></span><br><span class="line">        stream.forEach(System.out::println);<span class="comment">//终结，遍历stream流中的数据</span></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">test3</span><span class="params">()</span> &#123;</span><br><span class="line">        Stream&lt;String&gt; stream = Stream.of(<span class="string">&quot;hello&quot;</span>, <span class="string">&quot;world&quot;</span>);<span class="comment">//创建stream</span></span><br><span class="line">        stream.forEach(System.out::println);<span class="comment">//终结，遍历stream流中的数据</span></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">test4</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="comment">//UnaryOperator&lt;T&gt; extends Function&lt;T,T&gt;     T apply(T t)</span></span><br><span class="line">        Stream&lt;Integer&gt; stream = Stream.iterate(<span class="number">1</span>, num-&gt;num+<span class="number">2</span>);<span class="comment">//创建stream，由奇数组成</span></span><br><span class="line">        stream.forEach(System.out::println);<span class="comment">//终结，遍历stream流中的数据</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="中间操作">中间操作</h3>
<p>多个中间操作可连接形成一个流水线，只有触发终止操作时一次性全部处理，否则中间操作不会执行任何处理！这种情况称为“惰性求值”。<br />
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">方法                                        描述</span><br><span class="line">filter(Predicate p)                 接收Lambda，从流中排除某些元素。</span><br><span class="line">distinct()                          筛选，通过流所生成元素的equals()去除重复元素。</span><br><span class="line">limit(<span class="type">long</span> maxSize)                 截断流，使其元素不超过给定数量。</span><br><span class="line">skip(<span class="type">long</span> n)                        跳过元素，返回一个扔掉了前n个元素的流。若流中元素不足n个，则返回一个空流。与limit(n)互补。</span><br><span class="line">peek(Consumer action)               接收Lambda，对流中的每个数据执行Lambda体操作。</span><br><span class="line">sorted()                            产生一个新流，其中按自然顺序排序。</span><br><span class="line">sorted(Comparator com)              产生一个新流，其中按比较器顺序排序。</span><br><span class="line">map(Function f)                     接收一个函数作为参数，该函数会被应用到每个元素上，并将其映射成一个新的元素。</span><br><span class="line">mapToDouble(ToDoubleFunction f)     接收一个函数作为参数，该函数会被应用到每个元素上，产生一个新的DoubleStream。</span><br><span class="line">mapToInt(ToIntFunction f)           接收一个函数作为参数，该函数会被应用到每个元素上，产生一个新的IntStream。</span><br><span class="line">mapToLong(ToLongFunction f)         接收一个函数作为参数，该函数会被应用到每个元素上，产生一个新的LongStream。</span><br><span class="line">flatMap(Function f)                 接收一个函数作为参数，将流中的每个值都换成另一个流，然后把所有流连接成一个流。</span><br><span class="line"><span class="comment">// map(Function&lt;? super T,? extends R&gt; mapper)： </span></span><br><span class="line"><span class="comment">//     map操作流中的把T对象变成R对象，由R对象构成新的流。</span></span><br><span class="line"><span class="comment">// flatMap(Function&lt;? super T,? extends Stream&lt;? extends R&gt;&gt; mapper)：</span></span><br><span class="line"><span class="comment">//     flatMap把流中的数据T对象压扁变成一个Stream，然后把一个个的Stream最后再合成一个大的Stream。</span></span><br></pre></td></tr></table></figure></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//取出所有偶数，并且要求不重复</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">test1</span><span class="params">()</span>&#123;</span><br><span class="line">    Stream.of(<span class="number">1</span>,<span class="number">1</span>,<span class="number">3</span>,<span class="number">3</span>,<span class="number">4</span>,<span class="number">4</span>,<span class="number">6</span>,<span class="number">6</span>)</span><br><span class="line">    .filter(num -&gt; num%<span class="number">2</span>==<span class="number">0</span>)<span class="comment">//Predicate接口，抽象方法boolean test(T t)</span></span><br><span class="line">    .distinct()</span><br><span class="line">    .forEach(System.out::println);</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//随机产生10个100以内整数，遍历显示，并找出最大值</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">test2</span><span class="params">()</span>&#123;</span><br><span class="line">    <span class="type">Random</span> <span class="variable">random</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Random</span>();</span><br><span class="line">    Optional&lt;Integer&gt; max = Stream.generate(() -&gt; random.nextInt(<span class="number">100</span>))</span><br><span class="line">            .limit(<span class="number">10</span>)</span><br><span class="line">            .peek(System.out::println)<span class="comment">//Consumer接口，抽象方法void accept(T t)</span></span><br><span class="line">            .max(Integer::compareTo);</span><br><span class="line">    System.out.println(<span class="string">&quot;max = &quot;</span> + max.get());</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//按照薪资排序</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">test3</span><span class="params">()</span>&#123;</span><br><span class="line">    ArrayList&lt;Employee&gt; list = <span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;&gt;();</span><br><span class="line">    list.add(<span class="keyword">new</span> <span class="title class_">Employee</span>(<span class="string">&quot;张三&quot;</span>,<span class="number">8888</span>));</span><br><span class="line">    list.add(<span class="keyword">new</span> <span class="title class_">Employee</span>(<span class="string">&quot;王五&quot;</span>,<span class="number">10000</span>));</span><br><span class="line">    list.add(<span class="keyword">new</span> <span class="title class_">Employee</span>(<span class="string">&quot;钱七&quot;</span>,<span class="number">7777</span>));</span><br><span class="line">    <span class="comment">//Comparator接口，抽象方法int compare(T t1, T t2)</span></span><br><span class="line">    list.stream()</span><br><span class="line">    .sorted((e1,e2)-&gt;e1.getSalary()==e2.getSalary()?<span class="number">0</span>:(<span class="type">int</span>)Math.ceil(e1.getSalary()-e2.getSalary()))</span><br><span class="line">    .forEach(System.out::println);</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//给每个员工涨薪10%</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">test4</span><span class="params">()</span>&#123;</span><br><span class="line">    ArrayList&lt;Employee&gt; list = <span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;&gt;();</span><br><span class="line">    list.add(<span class="keyword">new</span> <span class="title class_">Employee</span>(<span class="string">&quot;张三&quot;</span>,<span class="number">8888</span>));</span><br><span class="line">    list.add(<span class="keyword">new</span> <span class="title class_">Employee</span>(<span class="string">&quot;王五&quot;</span>,<span class="number">10000</span>));</span><br><span class="line">    list.add(<span class="keyword">new</span> <span class="title class_">Employee</span>(<span class="string">&quot;钱七&quot;</span>,<span class="number">7777</span>));</span><br><span class="line">    list.stream()</span><br><span class="line">    .map(e-&gt;&#123;e.setSalary(e.getSalary()*<span class="number">1.1</span>);<span class="keyword">return</span> e;&#125;)</span><br><span class="line">    .forEach(System.out::println);</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//求每个数的平方根</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">test5</span><span class="params">()</span>&#123;</span><br><span class="line">    Stream.of(<span class="number">4</span>,<span class="number">9</span>,<span class="number">16</span>,<span class="number">25</span>,<span class="number">49</span>)</span><br><span class="line">    .mapToDouble(num -&gt; Math.sqrt(num))</span><br><span class="line">    .forEach(System.out::println);</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//把首字母变成大写</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">test6</span><span class="params">()</span>&#123;</span><br><span class="line">    Stream.of(<span class="string">&quot;hello&quot;</span>,<span class="string">&quot;world&quot;</span>).</span><br><span class="line">    map(s -&gt; Character.toUpperCase(s.charAt(<span class="number">0</span>)) + s.substring(<span class="number">1</span>))</span><br><span class="line">    .forEach(System.out::println);</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//把每个单词拆成一个个字母</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">test7</span><span class="params">()</span>&#123;</span><br><span class="line">    Stream.of(<span class="string">&quot;hello&quot;</span>,<span class="string">&quot;world&quot;</span>)</span><br><span class="line">    .flatMap(t -&gt; Stream.of(t.split(<span class="string">&quot;|&quot;</span>)))<span class="comment">//Function&lt;T,R&gt;接口，抽象方法 R apply(T t)</span></span><br><span class="line">    .forEach(System.out::println);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="终止操作">终止操作</h3>
<p>终止操作会从流的流水线生成结果，流进行了终止操作后，不能再次使用。<br />
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">        方法                                描述</span><br><span class="line"><span class="type">boolean</span> <span class="title function_">allMatch</span><span class="params">(Predicate p)</span>         检查是否匹配所有元素</span><br><span class="line"><span class="type">boolean</span> <span class="title function_">anyMatch</span><span class="params">(Predicate p)</span>         检查是否至少匹配一个元素</span><br><span class="line"><span class="type">boolean</span> <span class="title function_">noneMatch</span><span class="params">(Predicate p)</span>        检查是否没有匹配所有元素</span><br><span class="line">Optional&lt;T&gt; <span class="title function_">findFirst</span><span class="params">()</span>               返回第一个元素</span><br><span class="line">Optional&lt;T&gt; <span class="title function_">findAny</span><span class="params">()</span>                 返回当前流中的任意元素</span><br><span class="line"><span class="type">long</span> <span class="title function_">count</span><span class="params">()</span>                          返回流中元素总数</span><br><span class="line">Optional&lt;T&gt; <span class="title function_">max</span><span class="params">(Comparator c)</span>         返回流中最大值</span><br><span class="line">Optional&lt;T&gt; <span class="title function_">min</span><span class="params">(Comparator c)</span>         返回流中最小值</span><br><span class="line"><span class="keyword">void</span> <span class="title function_">forEach</span><span class="params">(Consumer c)</span>              迭代</span><br><span class="line">T <span class="title function_">reduce</span><span class="params">(T iden, BinaryOperator b)</span>    可以将流中元素反复结合起来，得到一个值。返回 T</span><br><span class="line">U <span class="title function_">reduce</span><span class="params">(BinaryOperator b)</span>            可以将流中元素反复结合起来，得到一个值。返回 Optional&lt;T&gt;</span><br><span class="line">R <span class="title function_">collect</span><span class="params">(Collector c)</span>                将流转换为其他形式。接收一个 Collector接口的实现，用于给Stream中元素做汇总的方法</span><br><span class="line"><span class="comment">//Collector接口中方法的实现，决定了如何对流执行收集的操作(如收集到 List、Set、Map)。</span></span><br><span class="line"><span class="comment">//另外，Collectors实用类提供了很多静态方法，可以方便地创建常见收集器实例。</span></span><br></pre></td></tr></table></figure></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//是否所有员工的薪资都低于10000</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">test1</span><span class="params">()</span>&#123;</span><br><span class="line">    ArrayList&lt;Employee&gt; list = <span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;&gt;();</span><br><span class="line">    list.add(<span class="keyword">new</span> <span class="title class_">Employee</span>(<span class="string">&quot;张三&quot;</span>,<span class="number">8888</span>));</span><br><span class="line">    list.add(<span class="keyword">new</span> <span class="title class_">Employee</span>(<span class="string">&quot;王五&quot;</span>,<span class="number">10000</span>));</span><br><span class="line">    <span class="type">boolean</span> <span class="variable">result</span> <span class="operator">=</span> list.stream().allMatch(e -&gt; e.getSalary()&lt;<span class="number">10000</span>);</span><br><span class="line">    System.out.println(<span class="string">&quot;所有员工的薪资都低于10000：&quot;</span> + result);</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//是否有员工薪资低于10000</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">test2</span><span class="params">()</span>&#123;</span><br><span class="line">    ArrayList&lt;Employee&gt; list = <span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;&gt;();</span><br><span class="line">    list.add(<span class="keyword">new</span> <span class="title class_">Employee</span>(<span class="string">&quot;张三&quot;</span>,<span class="number">8888</span>));</span><br><span class="line">    list.add(<span class="keyword">new</span> <span class="title class_">Employee</span>(<span class="string">&quot;王五&quot;</span>,<span class="number">10000</span>));</span><br><span class="line">    <span class="type">boolean</span> <span class="variable">result</span> <span class="operator">=</span> list.stream().anyMatch(e -&gt; e.getSalary()&lt;<span class="number">10000</span>);</span><br><span class="line">    System.out.println(<span class="string">&quot;是否有员工的薪资都低于10000：&quot;</span> + result);</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//薪资最高的员工</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">test3</span><span class="params">()</span>&#123;</span><br><span class="line">    ArrayList&lt;Employee&gt; list = <span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;&gt;();</span><br><span class="line">    list.add(<span class="keyword">new</span> <span class="title class_">Employee</span>(<span class="string">&quot;张三&quot;</span>,<span class="number">8888</span>));</span><br><span class="line">    list.add(<span class="keyword">new</span> <span class="title class_">Employee</span>(<span class="string">&quot;王五&quot;</span>,<span class="number">10000</span>));</span><br><span class="line">    Optional&lt;Employee&gt; max = list.stream()</span><br><span class="line">    .max((e1,e2)-&gt;e1.getSalary()==e2.getSalary() ? <span class="number">0</span> : (<span class="type">int</span>)Math.ceil(e1.getSalary()-e2.getSalary()));</span><br><span class="line">    <span class="comment">// .max((e1, e2) -&gt; Double.compare(e1.getSalary(), e2.getSalary()));//另一种方式</span></span><br><span class="line">    System.out.println(<span class="string">&quot;薪资最高的员工是：&quot;</span> + max.get());</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//求累加和</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">test4</span><span class="params">()</span>&#123;</span><br><span class="line">    Optional&lt;Integer&gt; sum = Stream.of(<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>,<span class="number">4</span>,<span class="number">5</span>,<span class="number">6</span>,<span class="number">7</span>,<span class="number">8</span>,<span class="number">9</span>,<span class="number">10</span>)</span><br><span class="line">    .reduce((t1,t2) -&gt; t1+t2);</span><br><span class="line">    System.out.println(<span class="string">&quot;和：&quot;</span> + sum.get());</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//找出薪资高于10000的员工放到新的List集合中</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">test5</span><span class="params">()</span>&#123;</span><br><span class="line">    ArrayList&lt;Employee&gt; list = <span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;&gt;();</span><br><span class="line">    list.add(<span class="keyword">new</span> <span class="title class_">Employee</span>(<span class="string">&quot;张三&quot;</span>,<span class="number">8888</span>));</span><br><span class="line">    list.add(<span class="keyword">new</span> <span class="title class_">Employee</span>(<span class="string">&quot;王五&quot;</span>,<span class="number">10000</span>));</span><br><span class="line">    list.add(<span class="keyword">new</span> <span class="title class_">Employee</span>(<span class="string">&quot;赵六&quot;</span>,<span class="number">11111</span>));</span><br><span class="line">    List&lt;Employee&gt; collect = list.stream()</span><br><span class="line">    .filter(e-&gt;e.getSalary()&gt;<span class="number">10000</span>)</span><br><span class="line">    .collect(Collectors.toList());</span><br><span class="line">    collect.forEach(System.out::println);</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//按照男女分组</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">test6</span><span class="params">()</span>&#123;</span><br><span class="line">    ArrayList&lt;Student&gt; list = <span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;&gt;();</span><br><span class="line">    list.add(<span class="keyword">new</span> <span class="title class_">Student</span>(<span class="string">&quot;张三&quot;</span>,<span class="string">&#x27;男&#x27;</span>));</span><br><span class="line">    list.add(<span class="keyword">new</span> <span class="title class_">Student</span>(<span class="string">&quot;李四&quot;</span>,<span class="string">&#x27;女&#x27;</span>));</span><br><span class="line">    list.add(<span class="keyword">new</span> <span class="title class_">Student</span>(<span class="string">&quot;王五&quot;</span>,<span class="string">&#x27;男&#x27;</span>));</span><br><span class="line">    list.add(<span class="keyword">new</span> <span class="title class_">Student</span>(<span class="string">&quot;赵六&quot;</span>,<span class="string">&#x27;女&#x27;</span>));</span><br><span class="line">    list.add(<span class="keyword">new</span> <span class="title class_">Student</span>(<span class="string">&quot;钱七&quot;</span>,<span class="string">&#x27;男&#x27;</span>));</span><br><span class="line">    Map&lt;Character, List&lt;Student&gt;&gt; collect = list.stream()</span><br><span class="line">    .collect(Collectors.groupingBy(s -&gt; s.getGender()));</span><br><span class="line">    collect.forEach((k,v) -&gt; System.out.println(k+<span class="string">&quot;-&gt;&quot;</span> + v));</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="https://soundmemories.github.io/2020/03/10/Java/22.Java%E5%8F%8D%E5%B0%84/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avstar.png">
      <meta itemprop="name" content="SoundMemories">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="SoundMemories">
      <meta itemprop="description" content="今日事，今日毕">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | SoundMemories">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2020/03/10/Java/22.Java%E5%8F%8D%E5%B0%84/" class="post-title-link" itemprop="url">Java反射</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>

      <time title="创建时间：2020-03-10 00:00:00" itemprop="dateCreated datePublished" datetime="2020-03-10T00:00:00+08:00">2020-03-10</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">分类于</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/Java/" itemprop="url" rel="index"><span itemprop="name">Java</span></a>
        </span>
    </span>

  
    <span class="post-meta-break"></span>
    <span class="post-meta-item" title="本文字数">
      <span class="post-meta-item-icon">
        <i class="far fa-file-word"></i>
      </span>
      <span class="post-meta-item-text">本文字数：</span>
      <span>9.2k</span>
    </span>
    <span class="post-meta-item" title="阅读时长">
      <span class="post-meta-item-icon">
        <i class="far fa-clock"></i>
      </span>
      <span class="post-meta-item-text">阅读时长 &asymp;</span>
      <span>33 分钟</span>
    </span>
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <h2 id="类的生命">类的生命</h2>
<p>当程序主动使用某个类时，如果该类还未被加载到JVM内存中，系统会通过<strong>加载、连接、初始化</strong>三个步骤来对该类进行初始化，正常情况JVM将会连续完成这三个步骤，所以也把这三个步骤统称为类加载或类初始化。但有些时候这三个步骤也不是连续完成。<br />
<img src="/images/Java/类的生命.png" width="50%"></p>
<h3 id="加载">加载</h3>
<p>加载可能出现在第一次使用某个类时加载该类、也可能采用预先加载机制来预加载某个类，不管怎样，类的加载必须由<strong>类加载器</strong>完成，类加载器通常由JVM提供，由JVM提供的这些类加载器被称为系统类加载器。此外，开发者可以通过继承ClassLoader基类来创建自己的类加载器。通过使用不同的类加载器，可以从不同来源加载类的二进制数据，通常有如下几种来源：<br />
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">从本地系统直接读取.class文件，这是绝大部分类的加载方法。</span><br><span class="line">从zip、jar等文件中加载.class文件，这种方式也是很常见的。</span><br><span class="line">从网络下载.class文件或数据。</span><br><span class="line">从数据库提取.class数据。</span><br><span class="line">将.java上传到服务器中动态编译为.class数据，并执行加载。</span><br></pre></td></tr></table></figure></p>
<p>但是，不管类的字节码内容从哪里加载，加载的结果都一样，这些字节码内容加载到内存后，都会将这些静态数据转换成方法区的运行时数据结构，然后生成一个代表这个类的java.lang.Class对象，作为方法区中类数据的访问入口（即引用地址），所有需要访问和使用类数据只能通过这个Class对象。</p>
<h3 id="连接">连接</h3>
<p>当类被加载后，系统为其生成一个对应的Class对象，接着进入连接阶段，此阶段负责把类的二进制数据合并到JVM的运行状态之中。连接阶段有如下三个步骤：<br />
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">验证：确保加载的类信息符合JVM规范，例如：以cafe开头，没有安全方面的问题。</span><br><span class="line">准备：准备对应内存（方法区），创建Class对象，为类变量（<span class="keyword">static</span>）赋<span class="string">&quot;默认初始值&quot;</span>，为静态常量（<span class="keyword">static</span> <span class="keyword">final</span>）赋<span class="string">&quot;初始值&quot;</span>。</span><br><span class="line">解析：虚拟机常量池内的符号引用（常量名）替换为直接引用（地址）的过程。</span><br></pre></td></tr></table></figure></p>
<h3 id="初始化">初始化</h3>
<p>类的初始化，主要就是对<strong>静态变量</strong><br />
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">1.</span>执行类构造器&lt;clinit&gt;()方法的过程。&lt;clinit&gt;()是由类变量的显式赋值动作和静态代码块中的语句合并产生。</span><br><span class="line"><span class="number">2.</span>当初始化一个类的时候，如果发现其父类还没有进行初始化，则需要先触发其父类的初始化。</span><br><span class="line"><span class="number">3.</span>虚拟机会保证一个类的&lt;clinit&gt;()方法在多线程环境中被正确加锁和同步，即每一个类在内存中都只有唯一的Class对象。</span><br></pre></td></tr></table></figure></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Base</span>&#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="type">int</span> <span class="variable">a</span> <span class="operator">=</span> getNum();</span><br><span class="line">    <span class="keyword">static</span>&#123;</span><br><span class="line">        ++a;</span><br><span class="line">        System.out.println(<span class="string">&quot;2.a = &quot;</span> + a);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">static</span>&#123;</span><br><span class="line">        ++a;</span><br><span class="line">        System.out.println(<span class="string">&quot;3.a = &quot;</span> + a);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="type">int</span> <span class="title function_">getNum</span><span class="params">()</span>&#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;1.a = &quot;</span> + a);</span><br><span class="line">        <span class="keyword">return</span> <span class="number">1</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">TestClinit</span> <span class="keyword">extends</span> <span class="title class_">Base</span>&#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="type">int</span> <span class="variable">b</span> <span class="operator">=</span> getNum();</span><br><span class="line">    <span class="keyword">static</span>&#123;</span><br><span class="line">        ++b;</span><br><span class="line">        System.out.println(<span class="string">&quot;5.b = &quot;</span> + b);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">static</span>&#123;</span><br><span class="line">        ++b;</span><br><span class="line">        System.out.println(<span class="string">&quot;6.b = &quot;</span> + b);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="type">int</span> <span class="title function_">getNum</span><span class="params">()</span>&#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;4.b = &quot;</span> + b);</span><br><span class="line">        <span class="keyword">return</span> <span class="number">1</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;&#125;</span><br><span class="line">    <span class="comment">// 1.a = 0</span></span><br><span class="line">    <span class="comment">// 2.a = 2</span></span><br><span class="line">    <span class="comment">// 3.a = 3</span></span><br><span class="line">    <span class="comment">// 4.b = 0</span></span><br><span class="line">    <span class="comment">// 5.b = 2</span></span><br><span class="line">    <span class="comment">// 6.b = 3</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>类的加载不一定就会触发类的初始化，当Java程序<strong>首次</strong>通过下面5种方式来使用某个类时，系统就会初始化该类：<br />
<div class="tabs" id="init1"><ul class="nav-tabs"><li class="tab active"><a href="#init1-1">1</a></li><li class="tab"><a href="#init1-2">2</a></li><li class="tab"><a href="#init1-3">3</a></li><li class="tab"><a href="#init1-4">4</a></li><li class="tab"><a href="#init1-5">5</a></li></ul><div class="tab-content"><div class="tab-pane active" id="init1-1"><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//1.当虚拟机启动，先初始化main方法所在的类。</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">A</span> &#123;</span><br><span class="line">    <span class="keyword">static</span>&#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;init...A&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div><div class="tab-pane" id="init1-2"><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//2.new一个类的对象。</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">B</span>&#123;</span><br><span class="line">    <span class="keyword">static</span>&#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;init...B&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">TestB</span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        <span class="keyword">new</span> <span class="title class_">B</span>();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div><div class="tab-pane" id="init1-3"><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//3.调用该类的静态成员（包含静态变量和静态方法），但final的常量除外。</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">C</span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="type">int</span> <span class="variable">num</span> <span class="operator">=</span> <span class="number">10</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">test</span><span class="params">()</span>&#123;&#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">TestC</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        System.out.println(C.num);</span><br><span class="line">        C.test();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div><div class="tab-pane" id="init1-4"><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//4.使用java.lang.reflect包的方法对类进行反射调用。</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">D</span>&#123;</span><br><span class="line">    <span class="keyword">static</span>&#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;init...D&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">TestD</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> ClassNotFoundException &#123;</span><br><span class="line">        <span class="type">ClassLoader</span> <span class="variable">cl</span> <span class="operator">=</span> ClassLoader.getSystemClassLoader();</span><br><span class="line">        cl.loadClass(<span class="string">&quot;D&quot;</span>);<span class="comment">//该句不会造成类初始化，只是加载类</span></span><br><span class="line">        System.out.println(<span class="string">&quot;类加载已完成...&quot;</span>);</span><br><span class="line">        Class.forName(<span class="string">&quot;D&quot;</span>);<span class="comment">//会导致类初始化</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div><div class="tab-pane" id="init1-5"><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//5.当初始化一个类，如果其父类没有被初始化，则先会初始化他的父类。</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">EBase</span>&#123;</span><br><span class="line">    <span class="keyword">static</span>&#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;父类初始化&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">TestE</span> <span class="keyword">extends</span> <span class="title class_">EBase</span> &#123;</span><br><span class="line">    <span class="keyword">static</span>&#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;子类初始化&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div></div></div></p>
<p>类的加载过程中，不会发生类的初始化：<br />
<div class="tabs" id="init2"><ul class="nav-tabs"><li class="tab active"><a href="#init2-1">1</a></li><li class="tab"><a href="#init2-2">2</a></li><li class="tab"><a href="#init2-3">3</a></li></ul><div class="tab-content"><div class="tab-pane active" id="init2-1"><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//1.引用final静态常量不会触发此类的初始化，final常量在链接阶段的准备步骤中，就存入调用类的常量池中了。</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">NBase</span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">int</span> <span class="variable">MAX_VALUE</span> <span class="operator">=</span> <span class="number">100</span>;</span><br><span class="line">    <span class="keyword">static</span>&#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;父类初始化&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">class</span> <span class="title class_">NSub</span> <span class="keyword">extends</span> <span class="title class_">NBase</span>&#123;</span><br><span class="line">    <span class="keyword">static</span>&#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;子类初始化&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">TestNoInitialize</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        System.out.println(NSub.MAX_VALUE);<span class="comment">//100</span></span><br><span class="line">        System.out.println(NBase.MAX_VALUE);<span class="comment">//100</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div><div class="tab-pane" id="init2-2"><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//2.当访问一个静态成员时，只有真正声明这个成员的类才会被初始化。</span></span><br><span class="line"><span class="comment">//即当通过子类引用父类的静态变量，不会导致子类初始化。</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">NBase</span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="type">int</span> <span class="variable">num</span> <span class="operator">=</span> <span class="number">10</span>;</span><br><span class="line">    <span class="keyword">static</span>&#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;父类初始化&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">class</span> <span class="title class_">NSub</span> <span class="keyword">extends</span> <span class="title class_">NBase</span>&#123;</span><br><span class="line">    <span class="keyword">static</span>&#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;子类初始化&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">TestNoInitialize</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        System.out.println(NSub.num);<span class="comment">//父类初始化</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div><div class="tab-pane" id="init2-3"><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//3.通过数组定义类引用，不会触发此类的初始化。</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">NBase</span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="type">int</span> <span class="variable">num</span> <span class="operator">=</span> <span class="number">10</span>;</span><br><span class="line">    <span class="keyword">static</span>&#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;父类初始化&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">class</span> <span class="title class_">NSub</span> <span class="keyword">extends</span> <span class="title class_">NBase</span>&#123;</span><br><span class="line">    <span class="keyword">static</span>&#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;子类初始化&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">TestNoInitialize</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        NSub[] arr = <span class="keyword">new</span> <span class="title class_">NSub</span>[<span class="number">5</span>];</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div></div></div></p>
<h2 id="类加载器">类加载器</h2>
<p>类加载的过程由类加载器来完成。很多开发人员都遇到过java.lang.ClassNotFoundException或java.lang.NoClassDefError，想要更好的解决这类问题，或者在一些特殊的应用场景，比如需要支持类的动态加载、需要对编译后的字节码文件进行加密解密操作，那么需要你自定义类加载器，因此了解类加载器及其类加载机制也就成了每一个Java开发人员的必备技能之一。</p>
<p><strong>1.四种类加载器</strong>：<br />
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//引导类-&gt;扩展类-&gt;应用程序类-&gt;自定义类</span></span><br><span class="line">|-引导类（Bootstrap Classloader）：又称为根类加载器。</span><br><span class="line">    |-负责加载Java的核心库，如JAVA_HOME/jre/lib/rt.jar、sun.boot.class.path下的内容）。</span><br><span class="line">    |-原生代码（C/C++）实现的，并不继承自java.lang.ClassLoder，所以通过Java代码获取引导类的加载器对象将会得到<span class="literal">null</span>。</span><br><span class="line">|-扩展类（Extension ClassLoader）：它由sun.misc.Launcher$ExtClassLoader实现，是java.lang.ClassLoader的子类。</span><br><span class="line">    |-负责加载Java的扩展库，如JAVA_HOME/jre/ext/x.jar、java.ext.dirs下的内容。</span><br><span class="line">|-应用程序类（Application Classloader）：它由sun.misc.Launcher$AppClassLoader实现，是java.lang.ClassLoader的子类。</span><br><span class="line">    |-负责加载Java应用程序classpath类路径、java.class.path下的内容。</span><br><span class="line">    |-即项目路径bin文件夹下的字节码，以及自己配置了的环境变量classpath。</span><br><span class="line">|-自定义类：通过继承java.lang.ClassLoader类的方式实现自己的类加载器。满足一些特殊的需求，例如：</span><br><span class="line">    |-对字节码进行加密来避免class文件被反编译。</span><br><span class="line">    |-加载特殊目录下的字节码数据（例如Tomcat的.class文件就不在bin目录下）。</span><br></pre></td></tr></table></figure></p>
<p><strong>2.Java的类加载过程是经典委托模式</strong>：<br />
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">|-类加载器负责加载所有的类，系统为所有被载入内存中的类生成一个java.lang.Class实例。</span><br><span class="line">    |-一个类被载入JVM中，同一个类就不会被再次载入了。</span><br><span class="line">    |-类用其<span class="string">&quot;全限定类名+类加载器&quot;</span>作为其唯一标识。类加载器不同，会被视为“不同的类”。</span><br><span class="line">|-类加载器在执行类加载任务的时候，确保一个类的全局唯一性：</span><br><span class="line">    |-双亲委派模型（Parent Delegation Model）的委派机制来约定类加载器的加载机制。</span><br><span class="line">        |-除了引导类加载器之外，程序中的每一个类加载器都应该拥有一个超类加载器，如下图所示。</span><br><span class="line">        |-类加载任务，先检测此类是否加载过，即在方法区寻找该类对应的Class对象是否存在：</span><br><span class="line">            |-存在，表示加载过，直接返回该Class对象。</span><br><span class="line">            |-不存在，将加载任务委派给它的超类加载器去执行，直到引导类加载器。</span><br><span class="line">                |-若超类加载器无法加载委派给它的类时，将加载任务退回低一级。</span><br><span class="line">                |-若所有加载器都失败，报ClassNotFoundException/NoClassDefFoundError。</span><br><span class="line"><span class="comment">//数组类型本身并不是由类加载器负责创建，而是由JVM在运行时根据需要而直接创建的，但数组的元素类型仍然需要依靠类加载器去创建。</span></span><br><span class="line"><span class="comment">//因此，JVM会把数组元素类型的类加载器记录为数组类型的类加载器。</span></span><br></pre></td></tr></table></figure></p>
<p><img src="/images/Java/类加载器1.png" width="50%"><br />
<img src="/images/Java/类加载器2.png" width="50%"></p>
<p><strong>3.自定义类加载器</strong>：<br />
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">|-java.lang.ClassLoader：抽象类。</span><br><span class="line">    |-ClassLoader <span class="title function_">getParent</span><span class="params">()</span>：返回委托的父类加载器。一些实现可能使用<span class="literal">null</span>来表示引导类加载器。 </span><br><span class="line">    |-ClassLoader <span class="title function_">getSystemClassLoader</span><span class="params">()</span>：返回委托的系统类加载器。</span><br><span class="line">    |-Class&lt;?&gt; loadClass(String name)：使用指定类的全限定名来加载类。例如：java.lang.String。注意内部类的名称：</span><br><span class="line">        |-匿名内部类（外部类的全限定名$编号）</span><br><span class="line">        |-局部内部类（外部类的全限定名$编号+类名）</span><br><span class="line">        |-成员/静态内部类（外部类的全限定名$+类名）</span><br><span class="line">    |-Class&lt;?&gt; findClass(String name)：使用指定类的全限定名来查找类。</span><br><span class="line">        |-此方法应该被重写，会按照委托模型来加载类。</span><br><span class="line">        |-在通过父类加载器检查所请求的类后，此方法将被loadClass方法调用。</span><br><span class="line">    |-Class&lt;?&gt; findLoadedClass(String name)：返回Class对象，如果类没有被加载，则返回<span class="literal">null</span>。</span><br><span class="line">    |-Class&lt;?&gt; defineClass(String name,<span class="type">byte</span>[] b,<span class="type">int</span> off,<span class="type">int</span> len)：将一个<span class="type">byte</span>数组转换为Class类的实例。</span><br></pre></td></tr></table></figure></p>
<div class="tabs" id="fileclassloader"><ul class="nav-tabs"><li class="tab active"><a href="#fileclassloader-1">自定义加载器</a></li><li class="tab"><a href="#fileclassloader-2">使用自定义加载器</a></li></ul><div class="tab-content"><div class="tab-pane active" id="fileclassloader-1"><figure class="highlight java"><figcaption><span>FileClassLoader.java</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.memories.loader;</span><br><span class="line"><span class="keyword">import</span> java.io.ByteArrayOutputStream;</span><br><span class="line"><span class="keyword">import</span> java.io.File;</span><br><span class="line"><span class="keyword">import</span> java.io.FileInputStream;</span><br><span class="line"><span class="keyword">import</span> java.io.FileNotFoundException;</span><br><span class="line"><span class="keyword">import</span> java.io.IOException;</span><br><span class="line"><span class="keyword">import</span> java.io.InputStream;</span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">FileClassLoader</span> <span class="keyword">extends</span> <span class="title class_">ClassLoader</span>&#123;</span><br><span class="line">    <span class="keyword">private</span> String rootDir;<span class="comment">//指定加载路径</span></span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">FileClassLoader</span><span class="params">(String rootDir)</span>&#123;</span><br><span class="line">        <span class="built_in">this</span>.rootDir = rootDir;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">protected</span> Class&lt;?&gt; findClass(String name) <span class="keyword">throws</span> ClassNotFoundException &#123;</span><br><span class="line">        <span class="comment">//首先检查请求的类型，是否已经被这个类装载器装载到命名空间中了，如果已经被装载，直接返回</span></span><br><span class="line">        Class&lt;?&gt; c = findLoadedClass(name);</span><br><span class="line">        <span class="keyword">if</span>(c == <span class="literal">null</span>)&#123;</span><br><span class="line">            <span class="comment">//委派类加载器请求给父类加载器，如果父类加载器能够完成，则返回父类加载器加载的Class实例</span></span><br><span class="line">            <span class="type">ClassLoader</span> <span class="variable">parent</span> <span class="operator">=</span> <span class="built_in">this</span>.getParent();</span><br><span class="line">            <span class="keyword">try</span> &#123;</span><br><span class="line">                c = parent.loadClass(name);<span class="comment">//加异常处理，父类加载不到，然后自己加载</span></span><br><span class="line">            &#125; <span class="keyword">catch</span> (Exception e) &#123;&#125;</span><br><span class="line">            <span class="comment">//调用本类加载器的findClass()，试图获取对应的字节码，若获取的到则调用defineClass()导入类型到方法区</span></span><br><span class="line">            <span class="comment">//如果获取不到对应的字节码或其他原因失败，则异常，终止加载过程</span></span><br><span class="line">            <span class="keyword">if</span>(c == <span class="literal">null</span>)&#123;</span><br><span class="line">                <span class="type">byte</span>[] classData = getClassData(name);</span><br><span class="line">                <span class="keyword">if</span>(classData == <span class="literal">null</span>)&#123;</span><br><span class="line">                    <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">ClassNotFoundException</span>();</span><br><span class="line">                &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">                    c = defineClass(name, classData, <span class="number">0</span>, classData.length);</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> c;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">//把.class文件的内容读取到一个字节数组中</span></span><br><span class="line">    <span class="comment">//为什么要读取的字节数组中，因为protected final Class&lt;?&gt; defineClass(String name,byte[] b,int off,int len)</span></span><br><span class="line">    <span class="keyword">private</span> <span class="type">byte</span>[] getClassData(String name) &#123;</span><br><span class="line">        <span class="type">String</span> <span class="variable">path</span> <span class="operator">=</span> rootDir + File.separator + name.replace(<span class="string">&quot;.&quot;</span>, File.separator)+<span class="string">&quot;.class&quot;</span>;</span><br><span class="line">        <span class="type">InputStream</span> <span class="variable">is</span> <span class="operator">=</span> <span class="literal">null</span>;</span><br><span class="line">        <span class="type">ByteArrayOutputStream</span> <span class="variable">baos</span> <span class="operator">=</span> <span class="literal">null</span>;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            is = <span class="keyword">new</span> <span class="title class_">FileInputStream</span>(path);</span><br><span class="line">            baos =<span class="keyword">new</span> <span class="title class_">ByteArrayOutputStream</span>(); </span><br><span class="line">            <span class="type">byte</span>[] buffer = <span class="keyword">new</span> <span class="title class_">byte</span>[<span class="number">1024</span>];</span><br><span class="line">            <span class="type">int</span> len;</span><br><span class="line">            <span class="keyword">while</span>((len = is.read(buffer))!=-<span class="number">1</span>)&#123;</span><br><span class="line">                baos.write(buffer, <span class="number">0</span>, len);</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">return</span> baos.toByteArray();</span><br><span class="line">        &#125; <span class="keyword">catch</span> (FileNotFoundException e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125; <span class="keyword">catch</span> (IOException e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125;<span class="keyword">finally</span>&#123;</span><br><span class="line">            <span class="keyword">try</span> &#123;</span><br><span class="line">                <span class="keyword">if</span>(is!=<span class="literal">null</span>)&#123;</span><br><span class="line">                    is.close();</span><br><span class="line">                &#125;</span><br><span class="line">            &#125; <span class="keyword">catch</span> (IOException e) &#123;</span><br><span class="line">                e.printStackTrace();</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">null</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div><div class="tab-pane" id="fileclassloader-2"><figure class="highlight java"><figcaption><span>TestFileClassLoader.java</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.memories.loader;</span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">TestFileClassLoader</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> ClassNotFoundException &#123;</span><br><span class="line">        <span class="type">FileClassLoader</span> <span class="variable">fsc</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">FileClassLoader</span>(<span class="string">&quot;D:/memories/code&quot;</span>);</span><br><span class="line">        Class&lt;?&gt; uc = fsc.loadClass(<span class="string">&quot;com.memories.UserManager&quot;</span>);</span><br><span class="line">        System.out.println(uc);</span><br><span class="line">        Class&lt;?&gt; sc = fsc.loadClass(<span class="string">&quot;java.lang.String&quot;</span>);</span><br><span class="line">        System.out.println(sc);</span><br><span class="line">        System.out.println(sc.getClassLoader());<span class="comment">//null,因为委托给父类加载器...一直到引导类加载器</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div></div></div>
<p><strong>4.类加载器加载资源文件</strong>：<br />
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">|-类加载器的作用：</span><br><span class="line">    |-基本职责：根据一个指定的类的名称，找到/生成其对应的字节码，然后从这些字节码中定义出一个Java类，即java.lang.Class类的一个实例。</span><br><span class="line">    |-除此之外：还可以负责加载Java应用所需的资源，如图像文件、配置文件等。</span><br><span class="line">        |-这些资源和类，通过类加载器关联，避免在不同环境加载地址不一样而引起的错误。</span><br></pre></td></tr></table></figure></p>
<div class="tabs" id="加载"><ul class="nav-tabs"><li class="tab active"><a href="#加载-1">资源文件</a></li><li class="tab"><a href="#加载-2">加载器</a></li><li class="tab"><a href="#加载-3">tomcat加载器</a></li></ul><div class="tab-content"><div class="tab-pane active" id="加载-1"><figure class="highlight java"><figcaption><span>jdbc.properties</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//加载类路径下jdbc.properties资源文件，例如类路径是src，其编译后对应bin：</span></span><br><span class="line">username=root</span><br><span class="line">password=<span class="number">123456</span></span><br><span class="line">url=jdbc:mysql:<span class="comment">//localhost:3306/test</span></span><br></pre></td></tr></table></figure></div><div class="tab-pane" id="加载-2"><figure class="highlight java"><figcaption><span>TestLoaderProperties.java</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> java.io.IOException;</span><br><span class="line"><span class="keyword">import</span> java.util.Properties;</span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">TestLoaderProperties</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        <span class="type">Properties</span> <span class="variable">pro</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Properties</span>();</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="comment">//如果地址是包：&quot;com/memories/test/jdbc.properties&quot;</span></span><br><span class="line">            <span class="comment">//如果地址是项目的根路径下，不在src里面：pro.load(new FileInputStream(&quot;out.properties&quot;));</span></span><br><span class="line">            pro.load(ClassLoader.getSystemResourceAsStream(<span class="string">&quot;jdbc.properties&quot;</span>));</span><br><span class="line">            System.out.println(pro);</span><br><span class="line">        &#125; <span class="keyword">catch</span> (IOException e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div><div class="tab-pane" id="加载-3"><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//如果发布在tomcat中web应用，使用前面代码是无法加载src类路径下的资源文件的：</span></span><br><span class="line"><span class="comment">//src下的资源文件会随着类被发布到web应用的WEB-INF\classes目录下，而tomcat使用自定义类加载器加载该路径下的内容。</span></span><br><span class="line"><span class="comment">//那么就需要通过该路径下的类先获取到该自定义加载器对象，然后再调用getSystemResourceAsStream(String name)去加载。</span></span><br><span class="line"><span class="type">Properties</span> <span class="variable">pro</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Properties</span>();</span><br><span class="line"><span class="keyword">try</span> &#123;</span><br><span class="line">    <span class="type">ClassLoader</span> <span class="variable">loader</span> <span class="operator">=</span> DBUtils.class.getClassLoader();</span><br><span class="line">    <span class="type">InputStream</span> <span class="variable">is</span> <span class="operator">=</span> loader.getResourceAsStream(<span class="string">&quot;druid.properties&quot;</span>);</span><br><span class="line">    pro.load(is);</span><br><span class="line">    System.out.println(pro);</span><br><span class="line">&#125; <span class="keyword">catch</span> (IOException e) &#123;</span><br><span class="line">    e.printStackTrace();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div></div></div>
<h2 id="反射">反射</h2>
<p>Java中所有的对象都有两种类型：<strong>编译时类型、运行时类型</strong>，而很多时候对象的编译时类型和运行时类型不一致。<br />
为了Java也<strong>支持动态型</strong>，需<strong>在运行期间，确定某个类型的功能</strong>，才引入了反射机制，Java是准动态语言，只是延迟了确定对象的类型。</p>
<p>某些变量的编译类型是Object类型，但是程序却需要调用该变量存储的对象运行时类型的方法，该方法不是Object中方法，如何解决呢？<br />
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">|-在编译和运行时都完全知道类型的具体信息：</span><br><span class="line">    |-先使用<span class="keyword">instanceof</span>运算符进行判断，再利用强制类型转换符将其转换成运行时类型的变量。</span><br><span class="line">|-在编译时根本无法预知该对象和类的真实信息：</span><br><span class="line">    |-依靠运行时信息来发现该对象和类的真实信息，这就必须使用反射。</span><br></pre></td></tr></table></figure></p>
<p>因为加载完类之后，在堆内存的方法区中就产生了一个Class类型的对象（一个类只有一个Class对象），这个对象就包含了完整的类的结构信息。我们可以通过这个对象看到类的结构。这个对象就像一面镜子，透过这个镜子看到类的结构，所以，我们形象的称之为“反射”。</p>
<h3 id="反射类对象">反射类对象</h3>
<p><strong>1.哪些类型有Class对象</strong><br />
java.lang.Class类的实例表示正在运行的Java应用程序中的类和接口。事实上，所有类型都可以表示为Class的实例对象：<br />
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">class：外部类，内部类</span><br><span class="line">interface：接口</span><br><span class="line">[]：数组，所有具有相同元素类型和维数的数组共享同一个Class 对象</span><br><span class="line"><span class="keyword">enum</span>：枚举</span><br><span class="line">annotation：注解<span class="meta">@interface</span></span><br><span class="line">primitive type：<span class="number">8</span>种基本数据类型</span><br><span class="line"><span class="keyword">void</span></span><br></pre></td></tr></table></figure></p>
<p><strong>2.Java程序中可以通过以下4种方式获得Class对象</strong>：<br />
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">1.</span>编译期间已知任意类型：<span class="string">&quot;类型名.class&quot;</span>。</span><br><span class="line"><span class="number">2.</span>获取该对象的运行时类型的Class对象：<span class="string">&quot;对象.getClass()&quot;</span>。</span><br><span class="line"><span class="number">3.</span>Class类的静态方法：<span class="string">&quot;forName(String name)&quot;</span>。</span><br><span class="line"><span class="number">4.</span>类加载对象的<span class="string">&quot;loadClass(String name)&quot;</span>。</span><br><span class="line"><span class="comment">//String name是某个类的全限定名（完整的包.类型名）</span></span><br><span class="line"><span class="comment">//方式1，基本数据类型只能通过该方式获得Class对象。</span></span><br><span class="line"><span class="comment">//方式3，适用于除了数组以外的任意引用数据类型。</span></span><br><span class="line"><span class="comment">//方式3、4运行期间仍然无法加载该类的话，会报ClassNotFoundException。</span></span><br></pre></td></tr></table></figure></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Test</span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> ClassNotFoundException &#123;</span><br><span class="line">        <span class="comment">//1.类型名.class</span></span><br><span class="line">        Class&lt;?&gt; c1 = String.class;</span><br><span class="line">        <span class="comment">//2.getClass()</span></span><br><span class="line">        Class&lt;?&gt; c2 = <span class="string">&quot;hello&quot;</span>.getClass();</span><br><span class="line">        <span class="comment">//3.Class.forName(String name)</span></span><br><span class="line">        Class&lt;?&gt; c3 = Class.forName(<span class="string">&quot;java.lang.String&quot;</span>);</span><br><span class="line">        <span class="comment">//4.ClassLoader.loadClass(String name)</span></span><br><span class="line">        Class&lt;?&gt; c4 = ClassLoader.getSystemClassLoader().loadClass(<span class="string">&quot;java.lang.String&quot;</span>);</span><br><span class="line">        System.out.println(c1 == c2);<span class="comment">//true</span></span><br><span class="line">        System.out.println(c1 == c3);<span class="comment">//true</span></span><br><span class="line">        System.out.println(c1 == c4);<span class="comment">//true</span></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">test1</span><span class="params">()</span>&#123;</span><br><span class="line">        Class&lt;?&gt; c1 = <span class="type">int</span>.class;<span class="comment">//基本数据类型</span></span><br><span class="line">        Class&lt;?&gt; c2 = <span class="keyword">void</span>.class;<span class="comment">//void类型</span></span><br><span class="line">        Class&lt;?&gt; c3 = String.class;<span class="comment">//String类</span></span><br><span class="line">        Class&lt;?&gt; c4 = Object.class;<span class="comment">//Object类</span></span><br><span class="line">        Class&lt;?&gt; c5 = Class.class;<span class="comment">//Class类</span></span><br><span class="line">        Class&lt;?&gt; c6 = Comparable.class;<span class="comment">//接口</span></span><br><span class="line">        Class&lt;?&gt; c7 = <span class="type">int</span>[].class;<span class="comment">//int数组，只要元素类型与维度一样，就是同一个Class</span></span><br><span class="line">        Class&lt;?&gt; c8 = <span class="type">int</span>[][].class;<span class="comment">//int二维数组</span></span><br><span class="line">        Class&lt;?&gt; c9 = String[].class;<span class="comment">//String数组</span></span><br><span class="line">        Class&lt;?&gt; c10 = Override.class;<span class="comment">//注解</span></span><br><span class="line">        Class&lt;?&gt; c11 = ElementType.class;<span class="comment">//枚举</span></span><br><span class="line">        <span class="type">int</span>[] arr1 = <span class="keyword">new</span> <span class="title class_">int</span>[<span class="number">5</span>];</span><br><span class="line"></span><br><span class="line">        System.out.println(arr1.getClass() == c7);<span class="comment">//true</span></span><br><span class="line">        System.out.println(c7 == c8);<span class="comment">//false</span></span><br><span class="line">        System.out.println(c7 == c9);<span class="comment">//false</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="获取反射类信息">获取反射类信息</h3>
<p>Class类提供了大量实例方法来获取该Class对象所对应类的详细信息。每种方法都可能包含多个重载的版本：包、修饰符、类名、父类、父接口、注解，及成员（属性、构造器、方法）等。反射相关的API主要是java.lang.Class和java.lang.reflect包的内容。</p>
<div class="tabs" id="class类"><ul class="nav-tabs"><li class="tab active"><a href="#class类-1">类加载器</a></li><li class="tab"><a href="#class类-2">包名、类型名</a></li><li class="tab"><a href="#class类-3">类型修饰符</a></li><li class="tab"><a href="#class类-4">父类/父接口</a></li><li class="tab"><a href="#class类-5">内/外部类信息</a></li><li class="tab"><a href="#class类-6">属性</a></li><li class="tab"><a href="#class类-7">构造器</a></li><li class="tab"><a href="#class类-8">方法</a></li><li class="tab"><a href="#class类-9">泛型</a></li><li class="tab"><a href="#class类-10">注解</a></li></ul><div class="tab-content"><div class="tab-pane active" id="class类-1"><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">1.</span>获取类加载器：</span><br><span class="line">|-ClassLoader <span class="title function_">getClassLoader</span><span class="params">()</span>：返回该类的类加载器。</span><br><span class="line">    |-有些实现可能使用<span class="literal">null</span>来表示引导类加载器。如果此对象表示一个基本类型/<span class="keyword">void</span>，则返回<span class="literal">null</span>。</span><br></pre></td></tr></table></figure></div><div class="tab-pane" id="class类-2"><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">2.</span>获取包名、类型名：</span><br><span class="line">|-Package <span class="title function_">getPackage</span><span class="params">()</span>：获取此类的包。然后可以通过Package实例对象的getName()获取包名。</span><br><span class="line">|-String <span class="title function_">getName</span><span class="params">()</span>：以String的形式返回此Class对象所表示的实体（类、接口、数组类、基本类型、<span class="keyword">void</span>）名称。 </span><br><span class="line">    |-如果此类对象表示的是<span class="string">&quot;非数组类型的引用类型&quot;</span>，则返回该类的二进制名称，即<span class="string">&quot;包.类名&quot;</span>。</span><br><span class="line">    |-如果此类对象表示一个<span class="string">&quot;基本类型/void&quot;</span>，则返回其所对应的Java语言关键字相同的字符串名称。 </span><br><span class="line">    |-如果此类对象表示一个<span class="string">&quot;数组类&quot;</span>，则返回该数组嵌套深度的<span class="string">&quot;[字符+元素类型名&quot;</span>。</span><br></pre></td></tr></table></figure></div><div class="tab-pane" id="class类-3"><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">3.</span>获取类型修饰符：</span><br><span class="line">|-<span class="type">int</span> <span class="title function_">getModifiers</span><span class="params">()</span>：返回此类或接口<span class="string">&quot;整数编码&quot;</span>的修饰符。得到的整数编码应当使用Modifier类的toString()方法来解码。</span><br><span class="line">    |-如果底层类是数组类，则其<span class="keyword">public</span>、<span class="keyword">private</span>和<span class="keyword">protected</span>修饰符与其组件类型的修饰符相同。</span><br><span class="line">    |-如果此Class表示一个基本类型/<span class="keyword">void</span>，则其<span class="keyword">public</span>修饰符始终为<span class="literal">true</span>，<span class="keyword">protected</span>和<span class="keyword">private</span>修饰符始终为<span class="literal">false</span>。</span><br><span class="line">    |-如果此对象表示一个数组类、一个基本类型/<span class="keyword">void</span>，则其<span class="keyword">final</span>修饰符始终为<span class="literal">true</span>，其接口修饰符始终为<span class="literal">false</span>。</span><br><span class="line">        |-该规范没有给定其他修饰符的值。</span><br></pre></td></tr></table></figure></div><div class="tab-pane" id="class类-4"><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">4.</span>获取父类/父接口：</span><br><span class="line">|-Class&lt;? <span class="built_in">super</span> T&gt; getSuperclass()：返回表示此Class所表示的实体（类、接口、基本类型或 <span class="keyword">void</span>）的超类Class。</span><br><span class="line">    |-如果此Class表示Object 类、一个接口、一个基本类型/<span class="keyword">void</span>，则返回<span class="literal">null</span>。</span><br><span class="line">    |-如果此对象表示一个数组类，则返回表示该Object类的Class对象。</span><br><span class="line">|-Class&lt;?&gt;[] getInterfaces()：确定此对象所表示的类或接口实现的接口。</span><br><span class="line">    |-如果此对象表示一个类，则返回值是一个数组，它包含了表示该类所实现的所有接口的对象。</span><br><span class="line">        |-数组中接口对象顺序与此对象所表示的类的声明的implements子句中接口名顺序一致。</span><br><span class="line">    |-如果此对象表示一个接口，则该数组包含表示该接口扩展的所有接口的对象。</span><br><span class="line">        |-数组中接口对象顺序与此对象所表示的接口的声明的extends子句中接口名顺序一致。 </span><br><span class="line">    |-如果此对象表示一个不实现任何接口的类或接口，则此方法返回一个长度为<span class="number">0</span>的数组。</span><br><span class="line">    |-如果此对象表示一个基本类型/<span class="keyword">void</span>，则此方法返回一个长度为<span class="number">0</span>的数组。</span><br></pre></td></tr></table></figure></div><div class="tab-pane" id="class类-5"><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">5.</span>获取内部类/外部类信息：</span><br><span class="line">|-Class&lt;?&gt;[] getClasses()：返回所有公共内部类和内部接口。包括从超类继承的。</span><br><span class="line">|-Class&lt;?&gt;[] getDeclaredClasses()：返回Class对象的一个数组，所有声明的内部类和内部接口。</span><br><span class="line">    |-包括该类所声明的公共、保护、默认（包）访问及私有类和接口，但不包括继承的类和接口。</span><br><span class="line">|-Class&lt;?&gt; getDeclaringClass()：如果此Class对象所表示的类/接口是内部类/内部接口，则返回它的外部类/外部接口，否则返回<span class="literal">null</span>。</span><br></pre></td></tr></table></figure></div><div class="tab-pane" id="class类-6"><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">6.</span>获取属性：所有的属性都被抽象为Field类，那么一个属性被加载到内存后，是用一个Field对象表示的。</span><br><span class="line">|-Field[] getFields()：返回一个包含某些Field对象的无序数组。</span><br><span class="line">    |-这些对象反映此Class对象所表示的类或接口的所有可访问公共字段。</span><br><span class="line">        |-包括继承的公共字段，即得到所有公共的属性。</span><br><span class="line">|-Field <span class="title function_">getField</span><span class="params">(String name)</span>：同上，name指定所需公共成员字段。</span><br><span class="line">|-Field[] getDeclaredFields()：返回Field对象的一个无序数组。</span><br><span class="line">    |-这些对象反映此Class对象所表示的类或接口所声明的所有字段。</span><br><span class="line">        |-包括公共、保护、默认（包）访问和私有字段，但不包括继承的字段，即得到所有声明的属性。</span><br><span class="line">|-Field <span class="title function_">getDeclaredField</span><span class="params">(String name)</span>：同上，name指定所需已声明成员字段。</span><br></pre></td></tr></table></figure></div><div class="tab-pane" id="class类-7"><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">7.</span>获取构造器：所有的构造器都被抽象为Constructor类，那么一个构造器被加载到内存后，是用一个Constructor对象表示的。</span><br><span class="line">|-Constructor&lt;T&gt; <span class="title function_">getDeclaredConstructor</span><span class="params">(Class&lt;?&gt;... parameterTypes)</span>：得到指定声明构造器。</span><br><span class="line">    |-构造器名称无需指定，因为它和类名一致。</span><br><span class="line">    |-parameterTypes参数是Class对象的一个数组，它按顺序匹配构造方法的形参类型。</span><br><span class="line">        |-如果此Class对象表示声明的非静态内部类，则默认第一个形参是外部类的实例对象。</span><br><span class="line">|-Constructor&lt;?&gt;[] getDeclaredConstructors()：得到所有声明的构造器。</span><br><span class="line">|-Constructor&lt;T&gt; <span class="title function_">getConstructor</span><span class="params">(Class&lt;?&gt;... parameterTypes)</span>：得到指定公共构造器。</span><br><span class="line">|-Constructor&lt;?&gt;[] getConstructors()：得到所有公共构造器。</span><br></pre></td></tr></table></figure></div><div class="tab-pane" id="class类-8"><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">8.</span>获取方法：所有的方法都被抽象为Method类，那么一个构造器被加载到内存后，是用一个Method对象表示的。</span><br><span class="line">|-Method <span class="title function_">getDeclaredMethod</span><span class="params">(String name,Class&lt;?&gt;... parameterTypes)</span>：指定声明的成员方法，但不包括继承的方法。</span><br><span class="line">    |-name指定所需声明方法。</span><br><span class="line">    |-parameterTypes参数是Class对象的一个数组或<span class="number">0</span>~n个Class对象，它按声明顺序标识该方法的形参类型。</span><br><span class="line">        |-如果是无参方法，那么parameterTypes可以不传或者传<span class="literal">null</span>。</span><br><span class="line">            |-因为可能存在重载的方法，所以在一个类中唯一确定一个方法，需要方法名和形参类型列表。</span><br><span class="line">|-Method[] getDeclaredMethods()：所有声明的成员方法，但不包括继承的方法。</span><br><span class="line">|-Method <span class="title function_">getMethod</span><span class="params">(String name,Class&lt;?&gt;... parameterTypes)</span>：指定的公共成员方法。包括继承的公共方法。</span><br><span class="line">|-Method[] getMethods()：所有公共成员方法。包括继承的公共方法。</span><br><span class="line"><span class="comment">//CompareTo可能会出现2个方法，Object是旧版本遗留下来的，编译器实际使用的还是自己写的CompareTo。</span></span><br></pre></td></tr></table></figure></div><div class="tab-pane" id="class类-9"><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">9.</span>获取泛型父类：</span><br><span class="line">|-Type <span class="title function_">getGenericSuperclass</span><span class="params">()</span>：返回表示此Class所表示的实体（类、接口、基本类型/<span class="keyword">void</span>）的直接超类的Type。</span><br><span class="line">    |-Type：代表Java的所有类型。</span><br><span class="line">        |-Class：代表是普通的类型，没有泛型信息。</span><br><span class="line">        |-ParameterizedType：带参数化泛型，例如：Base&lt;T, U&gt;</span><br><span class="line">        |-GenericArrayType：带数组类型泛型，例如：T[]</span><br><span class="line">        |-TypeVariable：带类型变量泛型，例如：T</span><br><span class="line">        |-WildcardType：带 ? 通配符的泛型，例如：Base&lt;?&gt;、Base&lt;? <span class="built_in">super</span> 下限&gt;、Base&lt;? extends 上限&gt;</span><br></pre></td></tr></table></figure></div><div class="tab-pane" id="class类-10"><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">10.</span>获取注解信息：</span><br><span class="line">|-Annotation[] getAnnotations()：返回此元素上存在的所有注释，包括继承的注解。</span><br><span class="line">|-Annotation[] getDeclaredAnnotations()：获取某元素上存在的所有注释。该方法将忽略继承的注释。</span><br><span class="line">|-&lt;T <span class="keyword">extends</span> <span class="title class_">Annotation</span>&gt; T <span class="title function_">getAnnotation</span><span class="params">(Class&lt;T&gt; annotationClass)</span>：</span><br><span class="line">    |-如果存在该元素的指定类型的注释，则返回这些注释，否则返回<span class="literal">null</span>。</span><br><span class="line"><span class="comment">//若用反射获取到某个注解的信息，该注解声明时必加@Retention(RetentionPolicy.RUNTIME)元注解，表明滞留注解信息到运行时。</span></span><br></pre></td></tr></table></figure></div></div></div>
<div class="tabs" id="class信息"><ul class="nav-tabs"><li class="tab active"><a href="#class信息-1">类加载器</a></li><li class="tab"><a href="#class信息-2">包名、类型名</a></li><li class="tab"><a href="#class信息-3">类型修饰符</a></li><li class="tab"><a href="#class信息-4">父类/父接口</a></li><li class="tab"><a href="#class信息-5">内/外部类信息</a></li><li class="tab"><a href="#class信息-6">属性</a></li><li class="tab"><a href="#class信息-7">构造器</a></li><li class="tab"><a href="#class信息-8">方法</a></li><li class="tab"><a href="#class信息-9">泛型1</a></li><li class="tab"><a href="#class信息-10">泛型2</a></li><li class="tab"><a href="#class信息-11">注解</a></li></ul><div class="tab-content"><div class="tab-pane active" id="class信息-1"><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Test</span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> ClassNotFoundException &#123;</span><br><span class="line">        Class&lt;?&gt; clazz = String.class;</span><br><span class="line">        <span class="comment">//获取它的类加载器对象</span></span><br><span class="line">        <span class="type">ClassLoader</span> <span class="variable">loader</span> <span class="operator">=</span> clazz.getClassLoader();</span><br><span class="line">        System.out.println(<span class="string">&quot;当前类的加载器：&quot;</span> + loader);<span class="comment">//当前类的加载器：null</span></span><br><span class="line">        <span class="type">ClassLoader</span> <span class="variable">parent</span> <span class="operator">=</span> loader.getParent();</span><br><span class="line">        System.out.println(<span class="string">&quot;父加载器：&quot;</span> + parent);</span><br><span class="line">        <span class="type">ClassLoader</span> <span class="variable">grand</span> <span class="operator">=</span> parent.getParent();</span><br><span class="line">        System.out.println(<span class="string">&quot;爷爷加载器：&quot;</span> + grand);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div><div class="tab-pane" id="class信息-2"><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Test</span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> ClassNotFoundException &#123;</span><br><span class="line">        <span class="comment">//获取类型名</span></span><br><span class="line">        System.out.println(String.class.getName());<span class="comment">//java.lang.String</span></span><br><span class="line">        System.out.println(<span class="type">int</span>.class.getName());<span class="comment">//int</span></span><br><span class="line">        System.out.println(<span class="type">int</span>[].class.getName()); <span class="comment">//[I</span></span><br><span class="line">        System.out.println(<span class="type">int</span>[][][].class.getName());<span class="comment">//[[[I</span></span><br><span class="line">        System.out.println(Object[].class.getName());<span class="comment">//[Ljava.lang.Object;</span></span><br><span class="line">        <span class="comment">//获取包名</span></span><br><span class="line">        System.out.println(String.class.getPackage().getName());<span class="comment">//java.lang</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//[I中字符I表示元素类型是int，常见编码如下：</span></span><br><span class="line"><span class="comment">// Element              Type Encoding</span></span><br><span class="line"><span class="comment">// byte                     B</span></span><br><span class="line"><span class="comment">// short                    S</span></span><br><span class="line"><span class="comment">// int                      I</span></span><br><span class="line"><span class="comment">// long                     L</span></span><br><span class="line"><span class="comment">// float                    F</span></span><br><span class="line"><span class="comment">// double                   D</span></span><br><span class="line"><span class="comment">// boolean                  Z</span></span><br><span class="line"><span class="comment">// char                     C</span></span><br><span class="line"><span class="comment">// class or interface   Lclassname;</span></span><br></pre></td></tr></table></figure></div><div class="tab-pane" id="class信息-3"><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> java.lang.reflect.Modifier;</span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Test</span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> ClassNotFoundException &#123;</span><br><span class="line">        Class&lt;?&gt; clazz = String.class;</span><br><span class="line">        <span class="type">int</span> <span class="variable">mod</span> <span class="operator">=</span> clazz.getModifiers();</span><br><span class="line">        System.out.println(<span class="string">&quot;修饰符的值：&quot;</span> + mod);<span class="comment">//修饰符的值：17</span></span><br><span class="line">        System.out.println(<span class="string">&quot;修饰符：&quot;</span> + Modifier.toString(mod));<span class="comment">//修饰符：public final</span></span><br><span class="line">        System.out.println(Modifier.isPublic(mod));<span class="comment">//true</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div><div class="tab-pane" id="class信息-4"><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Test</span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> ClassNotFoundException &#123;</span><br><span class="line">        System.out.println(Integer.class.getSuperclass());<span class="comment">//java.lang.Number</span></span><br><span class="line">        System.out.println(<span class="type">int</span>.class.getSuperclass());<span class="comment">//null</span></span><br><span class="line">        System.out.println(Runnable.class.getSuperclass());<span class="comment">//null</span></span><br><span class="line">        System.out.println(<span class="type">int</span>[].class.getSuperclass());<span class="comment">//java.lang.Object</span></span><br><span class="line">        System.out.println(String[].class.getSuperclass());<span class="comment">//java.lang.Object</span></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">test1</span><span class="params">()</span>&#123;</span><br><span class="line">        Class&lt;?&gt; clazz = String.class;</span><br><span class="line">        Class&lt;?&gt;[] interfaces = clazz.getInterfaces();</span><br><span class="line">        <span class="comment">//打印clzz所有实现的接口</span></span><br><span class="line">        <span class="keyword">for</span> (Class&lt;?&gt; inter : interfaces) &#123;</span><br><span class="line">            System.out.println(inter);</span><br><span class="line">            <span class="comment">//java.io.Serializable</span></span><br><span class="line">            <span class="comment">//java.lang.Comparable</span></span><br><span class="line">            <span class="comment">//java.lang.CharSequence</span></span><br><span class="line">            <span class="comment">//java.lang.constant.Constable</span></span><br><span class="line">            <span class="comment">//java.lang.constant.ConstantDes</span></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div><div class="tab-pane" id="class信息-5"><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> java.util.Map;</span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Test</span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> ClassNotFoundException &#123;</span><br><span class="line">        Class&lt;?&gt; clazz = Map.class;</span><br><span class="line">        Class&lt;?&gt;[] inners = clazz.getDeclaredClasses();<span class="comment">//返回所有内部类、接口数组</span></span><br><span class="line">        <span class="keyword">for</span> (Class&lt;?&gt; inner : inners) &#123;</span><br><span class="line">            System.out.println(inner);<span class="comment">//java.util.Map$Entry</span></span><br><span class="line">        &#125;</span><br><span class="line">        </span><br><span class="line">        Class&lt;?&gt; ec = Map.Entry.class;<span class="comment">//内部类</span></span><br><span class="line">        Class&lt;?&gt; outer = ec.getDeclaringClass();<span class="comment">//返回外部类/接口</span></span><br><span class="line">        System.out.println(outer);<span class="comment">//java.util.Map</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div><div class="tab-pane" id="class信息-6"><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> java.lang.reflect.Field;</span><br><span class="line"><span class="keyword">import</span> java.lang.reflect.Modifier;</span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Test</span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> ClassNotFoundException &#123;</span><br><span class="line">        Class&lt;?&gt; clazz = String.class;</span><br><span class="line">        Field[] fields = clazz.getDeclaredFields();</span><br><span class="line">        <span class="comment">//clzz所有属性信息</span></span><br><span class="line">        <span class="keyword">for</span> (Field field : fields) &#123;</span><br><span class="line">            <span class="type">int</span> <span class="variable">mod</span> <span class="operator">=</span> field.getModifiers();<span class="comment">//属性的修饰符</span></span><br><span class="line">            Class&lt;?&gt; type = field.getType();<span class="comment">//属性的数据类型</span></span><br><span class="line">            <span class="type">String</span> <span class="variable">name</span> <span class="operator">=</span> field.getName();<span class="comment">//属性的名称</span></span><br><span class="line">            System.out.print(Modifier.toString(mod) + <span class="string">&quot;\t&quot;</span>);</span><br><span class="line">            System.out.println(type.getName()+ <span class="string">&quot;\t&quot;</span> + name);</span><br><span class="line">            <span class="comment">// private final   [B      value</span></span><br><span class="line">            <span class="comment">// private final   byte    coder</span></span><br><span class="line">            <span class="comment">// private int     hash</span></span><br><span class="line">            <span class="comment">// ...</span></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div><div class="tab-pane" id="class信息-7"><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> java.lang.reflect.Constructor;</span><br><span class="line"><span class="keyword">import</span> java.lang.reflect.Modifier;</span><br><span class="line"><span class="keyword">import</span> java.util.Arrays;</span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Outer</span>&#123;</span><br><span class="line">    <span class="keyword">class</span> <span class="title class_">Inner</span>&#123;&#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Test</span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> NoSuchMethodException, SecurityException &#123;</span><br><span class="line">        Class&lt;?&gt; clazz = Outer.class;</span><br><span class="line">        Constructor&lt;?&gt; constructor = clazz.getDeclaredConstructor();</span><br><span class="line">        System.out.println(constructor);<span class="comment">//Outer()</span></span><br><span class="line">        </span><br><span class="line">        Class&lt;?&gt; c = Outer.Inner.class;</span><br><span class="line">        <span class="comment">//因为Inner是非静态的内部类，所以它的构造器，默认第一个形参是外部类的实例对象</span></span><br><span class="line">        Constructor&lt;?&gt; cs = c.getDeclaredConstructor(Outer.class);</span><br><span class="line">        System.out.println(cs);<span class="comment">//Outer$Inner(Outer)</span></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">test</span><span class="params">()</span>&#123;</span><br><span class="line">        Class&lt;?&gt; clazz = String.class;</span><br><span class="line">        Constructor&lt;?&gt;[] constructors = clazz.getConstructors();</span><br><span class="line">        <span class="comment">//clzz所有构造器信息</span></span><br><span class="line">        <span class="keyword">for</span> (Constructor&lt;?&gt; constructor : constructors) &#123;</span><br><span class="line">            <span class="type">int</span> <span class="variable">mod</span> <span class="operator">=</span> constructor.getModifiers();<span class="comment">//构造器的修饰符</span></span><br><span class="line">            <span class="type">String</span> <span class="variable">name</span> <span class="operator">=</span> constructor.getName();<span class="comment">//构造器的名称</span></span><br><span class="line">            Class&lt;?&gt;[] parameterTypes = constructor.getParameterTypes();<span class="comment">//构造器的形参列表</span></span><br><span class="line"></span><br><span class="line">            System.out.print(Modifier.toString(mod)+<span class="string">&quot;\t&quot;</span> + name + <span class="string">&quot;(&quot;</span>);</span><br><span class="line">            System.out.println(Arrays.toString(parameterTypes)+<span class="string">&quot;)&quot;</span>);</span><br><span class="line">            <span class="comment">// public  java.lang.String([class java.lang.StringBuilder])</span></span><br><span class="line">            <span class="comment">// public  java.lang.String([class [B, int, int, class java.nio.charset.Charset])</span></span><br><span class="line">            <span class="comment">// ...</span></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div><div class="tab-pane" id="class信息-8"><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> java.lang.reflect.Method;</span><br><span class="line"><span class="keyword">import</span> java.lang.reflect.Modifier;</span><br><span class="line"><span class="keyword">import</span> java.util.Arrays;</span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Test</span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span>&#123;</span><br><span class="line">        Class&lt;?&gt; clazz = String.class;</span><br><span class="line">        Method[] methods = clazz.getMethods();</span><br><span class="line">        <span class="comment">//clzz所有方法信息</span></span><br><span class="line">        <span class="keyword">for</span> (Method method : methods) &#123;</span><br><span class="line">            <span class="type">int</span> <span class="variable">mod</span> <span class="operator">=</span> method.getModifiers();<span class="comment">//方法的修饰符</span></span><br><span class="line">            Class&lt;?&gt; returnType = method.getReturnType();<span class="comment">//方法的返回值类型</span></span><br><span class="line">            <span class="type">String</span> <span class="variable">name</span> <span class="operator">=</span> method.getName();<span class="comment">//方法的名称</span></span><br><span class="line">            Class&lt;?&gt;[] parameterTypes = method.getParameterTypes();<span class="comment">//方法的形参列表</span></span><br><span class="line">            Class&lt;?&gt;[] exceptionTypes = method.getExceptionTypes();<span class="comment">//抛出的异常类型们</span></span><br><span class="line"></span><br><span class="line">            System.out.print(Modifier.toString(mod)+ <span class="string">&quot;\t&quot;</span> + returnType + <span class="string">&quot;\t&quot;</span> + name + <span class="string">&quot;(&quot;</span>);</span><br><span class="line">            System.out.print(Arrays.toString(parameterTypes)+ <span class="string">&quot;)&quot;</span> + <span class="string">&quot;\t&quot;</span>);</span><br><span class="line">            System.out.println(Arrays.toString(exceptionTypes));</span><br><span class="line">            <span class="comment">// public  boolean equals([class java.lang.Object])        []</span></span><br><span class="line">            <span class="comment">// public  int     length([])      []</span></span><br><span class="line">            <span class="comment">// ...</span></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div><div class="tab-pane" id="class信息-9"><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> java.lang.reflect.ParameterizedType;</span><br><span class="line"><span class="keyword">import</span> java.lang.reflect.Type;</span><br><span class="line"><span class="keyword">import</span> java.lang.reflect.TypeVariable;</span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Base</span>&lt;T <span class="keyword">extends</span> <span class="title class_">Number</span>, U&gt;&#123;&#125;</span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Sub</span> <span class="keyword">extends</span> <span class="title class_">Base</span>&lt;Integer, String&gt;&#123;&#125;</span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">TestGenericSuperClass</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        Class&lt;?&gt; c = Base.class;</span><br><span class="line">        <span class="comment">//获取类型泛型形参</span></span><br><span class="line">        TypeVariable&lt;?&gt;[] typeParameters = c.getTypeParameters();</span><br><span class="line">        <span class="keyword">for</span> (TypeVariable&lt;?&gt; typeVariable : typeParameters) &#123;</span><br><span class="line">            System.out.println(typeVariable + <span class="string">&quot;，上限：&quot;</span> + typeVariable.getBounds()[<span class="number">0</span>]);</span><br><span class="line">            <span class="comment">//T，上限：class java.lang.Number</span></span><br><span class="line">            <span class="comment">//U，上限：class java.lang.Object</span></span><br><span class="line">        &#125;</span><br><span class="line">        Class&lt;Sub&gt; clazz = Sub.class;</span><br><span class="line">        <span class="type">Type</span> <span class="variable">gs</span> <span class="operator">=</span> clazz.getGenericSuperclass();</span><br><span class="line">        <span class="type">ParameterizedType</span> <span class="variable">gt</span> <span class="operator">=</span> (ParameterizedType)gs;</span><br><span class="line">        <span class="comment">//获取类型泛型实参</span></span><br><span class="line">        Type[] types = gt.getActualTypeArguments();</span><br><span class="line">        <span class="keyword">for</span> (Type type : types) &#123;</span><br><span class="line">            System.out.println(type);</span><br><span class="line">            <span class="comment">//class java.lang.Integer</span></span><br><span class="line">            <span class="comment">//class java.lang.String</span></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div><div class="tab-pane" id="class信息-10"><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Tools</span>&lt;T&gt;&#123;</span><br><span class="line">    <span class="keyword">private</span> Class type;</span><br><span class="line">    <span class="comment">//构造器中获取子类泛型</span></span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">Tools</span><span class="params">()</span> &#123;<span class="comment">//在创建子类对象时，来确定type的代表类型</span></span><br><span class="line">        <span class="comment">//(1)获取正在new的对象的类型Class对象</span></span><br><span class="line">        <span class="type">Class</span> <span class="variable">clazz</span> <span class="operator">=</span> <span class="built_in">this</span>.getClass();</span><br><span class="line">        <span class="comment">//(2)获取泛型父类的信息</span></span><br><span class="line">        <span class="type">ParameterizedType</span> <span class="variable">t</span> <span class="operator">=</span> (ParameterizedType) clazz.getGenericSuperclass();</span><br><span class="line">        <span class="comment">//(3)获取类型实参</span></span><br><span class="line">        type = (Class) t.getActualTypeArguments()[<span class="number">0</span>];</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">test</span><span class="params">()</span>&#123;</span><br><span class="line">        <span class="comment">//这个方法中需要用到T的类型对象，即T的Class对象</span></span><br><span class="line">        <span class="comment">//Class c = T.class;//此时无法确定T的类型</span></span><br><span class="line">        System.out.println(type);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">class</span> <span class="title class_">MyTools</span> <span class="keyword">extends</span> <span class="title class_">Tools</span>&lt;String&gt;&#123;&#125;</span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">TestGenericSuperClass</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        <span class="type">MyTools</span> <span class="variable">my</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">MyTools</span>();</span><br><span class="line">        my.test();<span class="comment">//class java.lang.String</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div><div class="tab-pane" id="class信息-11"><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> java.lang.annotation.Retention;</span><br><span class="line"><span class="keyword">import</span> java.lang.annotation.RetentionPolicy;</span><br><span class="line"><span class="comment">//声明注解</span></span><br><span class="line"><span class="meta">@Retention(RetentionPolicy.RUNTIME)</span><span class="comment">//只有生命周期为“运行时”才能被反射回去，不然运行时报错</span></span><br><span class="line"><span class="meta">@interface</span> MyAnnotation&#123;</span><br><span class="line">    String <span class="title function_">value</span><span class="params">()</span> <span class="keyword">default</span> <span class="string">&quot;hello&quot;</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//使用注解</span></span><br><span class="line"><span class="meta">@MyAnnotation</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">MyClass</span>&#123;</span><br><span class="line">    <span class="meta">@MyAnnotation</span></span><br><span class="line">    <span class="keyword">private</span> String info;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">TestAnnotation</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        Class&lt;?&gt; clazz = MyClass.class;</span><br><span class="line">        <span class="comment">//获取clazz类的所有注解</span></span><br><span class="line">        <span class="type">MyAnnotation</span> <span class="variable">my</span> <span class="operator">=</span> clazz.getAnnotation(MyAnnotation.class);</span><br><span class="line">        <span class="comment">//获取注解配置参数的值</span></span><br><span class="line">        System.out.println(my.value());<span class="comment">//hello</span></span><br><span class="line">        <span class="comment">//获取clazz类的info属性</span></span><br><span class="line">        <span class="type">Field</span> <span class="variable">infoField</span> <span class="operator">=</span> clazz.getDeclaredField(<span class="string">&quot;info&quot;</span>);</span><br><span class="line">        <span class="comment">//获取info属性的所有注解</span></span><br><span class="line">        <span class="type">MyAnnotation</span> <span class="variable">infomy</span> <span class="operator">=</span> infoField.getAnnotation(MyAnnotation.class);</span><br><span class="line">        <span class="comment">//获取注解配置参数的值</span></span><br><span class="line">        System.out.println(infomy.value());<span class="comment">//hello</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div></div></div>
<h3 id="使用反射">使用反射</h3>
<div class="tabs" id="使用反射1"><ul class="nav-tabs"><li class="tab active"><a href="#使用反射1-1">创建对象</a></li><li class="tab"><a href="#使用反射1-2">获取/设置对象的属性值</a></li><li class="tab"><a href="#使用反射1-3">使用方法</a></li></ul><div class="tab-content"><div class="tab-pane active" id="使用反射1-1"><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">1.</span>创建对象：</span><br><span class="line">|-使用Class对象的<span class="string">&quot;newInstance()&quot;</span>方法来创建该Class对象对应类的实例。</span><br><span class="line">    |-这种方式要求该Class对象的对应类<span class="string">&quot;必须有默认构造器&quot;</span>，而执行该方法时实际上是利用默认构造器来创建该类的实例。</span><br><span class="line">|-先使用Class对象获取指定的Constructor对象，再调用该对象的<span class="string">&quot;newInstance(Object... args)&quot;</span>方法来创建该Class对象对应类的实例。</span><br><span class="line">    |-通过这种方式可以选择使用某个类的<span class="string">&quot;指定构造器&quot;</span>来创建实例。</span><br><span class="line"><span class="comment">//方式1，常用于根据配置文件记录类名的字符串来创建实例对象，这种情况必须使用反射。</span></span><br></pre></td></tr></table></figure></div><div class="tab-pane" id="使用反射1-2"><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">2.</span>获取/设置对象的属性值：</span><br><span class="line">|-先通过Class对象的getFields()等方法可以获取该类所包括的全部Field/指定Field。</span><br><span class="line">    |-xxx <span class="title function_">getXxx</span><span class="params">(Object obj)</span>：获取obj对象该Field的属性值。</span><br><span class="line">        |-此处的Xxx对应<span class="number">8</span>种基本数据类型，如果该属性的类型是引用数据类型，则直接使用get(Object obj)方法。</span><br><span class="line">    |-<span class="keyword">void</span> <span class="title function_">setXxx</span><span class="params">(Object obj,Xxx value)</span>：设置obj对象该Field的属性值为value。</span><br><span class="line">        |-此处的Xxx对应<span class="number">8</span>种基本数据类型，如果该属性的类型是引用数据类型，则直接使用set(Object obj, Object value)方法。</span><br><span class="line">    |-<span class="keyword">void</span> <span class="title function_">setAccessible</span><span class="params">(<span class="type">boolean</span> flag)</span>：启动和禁用访问安全检查的开关。</span><br><span class="line">        |-值为<span class="literal">true</span>，则指示反射的对象在使用时取消Java语言访问检查，比如外部可以访问<span class="keyword">private</span>属性。</span><br><span class="line">            |-如果代码中必须用反射，且该句代码需要频繁的被调用，那么请设置为<span class="literal">true</span>；</span><br><span class="line">            |-使得原本无法访问的<span class="keyword">private</span>成员也可以访问；</span><br><span class="line">        |-值为<span class="literal">false</span>，则指示反射的对象实施Java语言访问检查。</span><br></pre></td></tr></table></figure></div><div class="tab-pane" id="使用反射1-3"><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">3.</span>使用方法：</span><br><span class="line">|-通过该Class对象的<span class="string">&quot;getMethods()&quot;</span>等方法获取全部方法/指定方法。</span><br><span class="line">|-每个Method对象对应一个方法，获得Method对象后，程序就可以通过该Method对象的<span class="string">&quot;invoke()&quot;</span>方法来调用对应方法。</span><br></pre></td></tr></table></figure></div></div></div>
<div class="tabs" id="使用反射2"><ul class="nav-tabs"><li class="tab active"><a href="#使用反射2-1">创建对象</a></li><li class="tab"><a href="#使用反射2-2">获取/设置对象的属性值</a></li><li class="tab"><a href="#使用反射2-3">使用方法</a></li></ul><div class="tab-content"><div class="tab-pane active" id="使用反射2-1"><figure class="highlight java"><figcaption><span>TestNewInstance.java</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> java.lang.reflect.Constructor;</span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Student</span>&#123;</span><br><span class="line">    <span class="keyword">private</span> String name;</span><br><span class="line">    <span class="keyword">private</span> <span class="type">int</span> age;</span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">Student</span><span class="params">(String name, <span class="type">int</span> age)</span> &#123;</span><br><span class="line">        <span class="built_in">super</span>();</span><br><span class="line">        <span class="built_in">this</span>.name = name;</span><br><span class="line">        <span class="built_in">this</span>.age = age;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">Student</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="built_in">super</span>();</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">toString</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;Student [name=&quot;</span> + name + <span class="string">&quot; age=&quot;</span> + age +<span class="string">&quot;]&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">TestNewInstance</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">test1</span><span class="params">()</span> <span class="keyword">throws</span> Exception&#123;</span><br><span class="line">        Class&lt;?&gt; clazz = Class.forName(<span class="string">&quot;Student&quot;</span>);<span class="comment">//根据字符串反射得到类</span></span><br><span class="line">        <span class="comment">//根据反射得到的类，获取无参构造器，创建对象（使用默认构造器）</span></span><br><span class="line">        <span class="type">Object</span> <span class="variable">obj</span> <span class="operator">=</span> clazz.getDeclaredConstructor().newInstance();</span><br><span class="line">        System.out.println(obj);<span class="comment">//Student [name=null age=0]</span></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">test2</span><span class="params">()</span> <span class="keyword">throws</span> Exception&#123;</span><br><span class="line">        Class&lt;?&gt; clazz = Class.forName(<span class="string">&quot;Student&quot;</span>);</span><br><span class="line">        <span class="comment">//反射创建对象，按顺序指定形参类型，来匹配指定构造器</span></span><br><span class="line">        Constructor&lt;?&gt; constructor = clazz.getDeclaredConstructor(String.class, <span class="type">int</span>.class);</span><br><span class="line">        <span class="type">Object</span> <span class="variable">obj</span> <span class="operator">=</span> constructor.newInstance(<span class="string">&quot;张三&quot;</span>, <span class="number">18</span>);</span><br><span class="line">        System.out.println(obj);<span class="comment">//Student [name=张三 age=18]</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div><div class="tab-pane" id="使用反射2-2"><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> java.lang.reflect.Field;</span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Circle</span>&#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="type">double</span> radius;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">TestField</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span><span class="keyword">throws</span> Exception &#123;</span><br><span class="line">        Class&lt;?&gt; clazz = Class.forName(<span class="string">&quot;Circle&quot;</span>);<span class="comment">//获取反射类型</span></span><br><span class="line">        <span class="type">Object</span> <span class="variable">obj</span> <span class="operator">=</span> clazz.newInstance();<span class="comment">//反射创建对象</span></span><br><span class="line">        <span class="type">Field</span> <span class="variable">field</span> <span class="operator">=</span> clazz.getDeclaredField(<span class="string">&quot;radius&quot;</span>);<span class="comment">//反射获取属性</span></span><br><span class="line">        field.setAccessible(<span class="literal">true</span>);<span class="comment">//取消权限检查</span></span><br><span class="line">        field.set(obj, <span class="number">1.2</span>);<span class="comment">//为obj对象的Field对象表示的属性，赋值</span></span><br><span class="line">        <span class="type">Object</span> <span class="variable">value</span> <span class="operator">=</span> field.get(obj);<span class="comment">//获取obj对象的Field对象表示的属性的值</span></span><br><span class="line">        System.out.println(value);<span class="comment">//1.2</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div><div class="tab-pane" id="使用反射2-3"><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> java.lang.reflect.Method;</span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Utils</span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="type">boolean</span> <span class="title function_">check</span><span class="params">(String user,String password)</span>&#123;</span><br><span class="line">        <span class="keyword">if</span>(<span class="string">&quot;admin&quot;</span>.equals(user) &amp;&amp; <span class="string">&quot;123&quot;</span>.equals(password))&#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">        &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="type">boolean</span> <span class="title function_">check2</span><span class="params">(String user,String password)</span>&#123;</span><br><span class="line">        <span class="keyword">if</span>(<span class="string">&quot;admin&quot;</span>.equals(user) &amp;&amp; <span class="string">&quot;666&quot;</span>.equals(password))&#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">        &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Test</span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> ClassNotFoundException, InstantiationException, </span><br><span class="line">    IllegalAccessException, NoSuchFieldException, SecurityException, IllegalArgumentException,</span><br><span class="line">    InvocationTargetException, NoSuchMethodException&#123;</span><br><span class="line">        Class&lt;?&gt; clazz = Class.forName(<span class="string">&quot;Utils&quot;</span>);</span><br><span class="line">        <span class="type">Object</span> <span class="variable">obj</span> <span class="operator">=</span> clazz.getDeclaredConstructor().newInstance();</span><br><span class="line">        <span class="comment">//获取clazz对象check方法</span></span><br><span class="line">        <span class="type">Method</span> <span class="variable">method</span> <span class="operator">=</span> clazz.getMethod(<span class="string">&quot;check&quot;</span>,String.class,String.class);</span><br><span class="line">        <span class="comment">//调用clazz对象check方法</span></span><br><span class="line">        <span class="type">Object</span> <span class="variable">value</span> <span class="operator">=</span> method.invoke(obj,<span class="string">&quot;admin&quot;</span>,<span class="string">&quot;666&quot;</span>);</span><br><span class="line">        System.out.println(value);<span class="comment">//false</span></span><br><span class="line">        <span class="comment">//获取clazz对象check2方法</span></span><br><span class="line">        <span class="type">Method</span> <span class="variable">method2</span> <span class="operator">=</span> clazz.getMethod(<span class="string">&quot;check2&quot;</span>, String.class,String.class);</span><br><span class="line">        <span class="comment">//调用clazz对象check2方法，obj位置传入null，表示调用静态方法</span></span><br><span class="line">        <span class="type">Object</span> <span class="variable">value2</span> <span class="operator">=</span> method2.invoke(<span class="literal">null</span>,<span class="string">&quot;admin&quot;</span>,<span class="string">&quot;666&quot;</span>);</span><br><span class="line">        System.out.println(value2);<span class="comment">//true</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div></div></div>
<h3 id="操作数组">操作数组</h3>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">java.lang.reflect包下提供了一个Array类，Array实例可代表所有类型数组，可用于动态创建数组、操作数组元素。</span><br><span class="line">|-Object <span class="title function_">newInstance</span><span class="params">(Class&lt;?&gt; componentType, <span class="type">int</span>... dimensions)</span>：创建一个具有指定的组件类型和维度的新数组。</span><br><span class="line">|-<span class="keyword">void</span> <span class="title function_">setXxx</span><span class="params">(Object array,<span class="type">int</span> index,xxx value)</span>：将array数组中[index]元素的值修改为value。</span><br><span class="line">    |-此处的Xxx对应<span class="number">8</span>种基本数据类型，如果该属性的类型是引用数据类型，则直接使用set(Object array,<span class="type">int</span> index, Object value)方法。</span><br><span class="line">|-xxx <span class="title function_">getXxx</span><span class="params">(Object array,<span class="type">int</span> index,xxx value)</span>：将array数组中[index]元素的值返回。</span><br><span class="line">    |-此处的Xxx对应<span class="number">8</span>种基本数据类型，如果该属性的类型是引用数据类型，则直接使用get(Object array,<span class="type">int</span> index)方法。</span><br></pre></td></tr></table></figure>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> java.lang.reflect.Array;</span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">TestArray</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        <span class="type">Object</span> <span class="variable">arr</span> <span class="operator">=</span> Array.newInstance(String.class, <span class="number">5</span>);</span><br><span class="line">        Array.set(arr, <span class="number">0</span>, <span class="string">&quot;hello&quot;</span>);</span><br><span class="line">        Array.set(arr, <span class="number">1</span>, <span class="string">&quot;world&quot;</span>);</span><br><span class="line">        System.out.println(Array.get(arr, <span class="number">0</span>));</span><br><span class="line">        System.out.println(Array.get(arr, <span class="number">1</span>));</span><br><span class="line">        System.out.println(Array.get(arr, <span class="number">2</span>));</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="动态代理">动态代理</h3>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">java.lang.reflect包下提供了Proxy类、InvocationHandler接口，通过它们以生成JDK动态代理类、动态代理对象。</span><br><span class="line">|-InvocationHandler接口：代理类需继承该接口。</span><br><span class="line">|-Proxy类：提供创建动态代理类、代理对象的静态方法，它也是所有动态代理类的父类。</span><br><span class="line">    |-如果为一个或多个接口动态地生成实现类，就可以使用Proxy来创建动态代理类或它们的实例。</span><br><span class="line">    |-Class&lt;?&gt; getProxyClass(ClassLoader loader, Class&lt;?&gt;... interfaces)：创建一个动态代理类所对应的Class对象。</span><br><span class="line">    |-Object <span class="title function_">newProxyInstance</span><span class="params">(ClassLoader loader, Class&lt;?&gt;[] interfaces, InvocationHandler h)</span>：直接创建一个动态代理对象。</span><br><span class="line">        |-loader为被代理类的类加载器对象。</span><br><span class="line">        |-interfaces为被代理类实现的接口们。</span><br><span class="line">        |-h为代理类代理工作处理器对象。h接口的invoke方法需要实现：</span><br><span class="line">            |-invoke方法的三个参数分别是proxy代表动态代理对象，method代表正在执行的方法，args代表执行代理对象的方法时传入的实参。</span><br></pre></td></tr></table></figure>
<p>案例需求：我需要在所有的Dog，Bird等接口的实现类所有实现方法加上统计方法的执行时间，并要求不修改这些实现类的代码。<br />
<div class="tabs" id="dog"><ul class="nav-tabs"><li class="tab active"><a href="#dog-1">定义接口</a></li><li class="tab"><a href="#dog-2">实现接口</a></li><li class="tab"><a href="#dog-3">代理类处理器</a></li><li class="tab"><a href="#dog-4">动态创建代理对象</a></li></ul><div class="tab-content"><div class="tab-pane active" id="dog-1"><figure class="highlight java"><figcaption><span>Dog.java</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.memories.proxy;</span><br><span class="line"><span class="keyword">interface</span> <span class="title class_">Dog</span> &#123;</span><br><span class="line">    <span class="keyword">void</span> <span class="title function_">bark</span><span class="params">()</span>;</span><br><span class="line">    <span class="keyword">void</span> <span class="title function_">run</span><span class="params">()</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">interface</span> <span class="title class_">Bird</span> &#123;</span><br><span class="line">    <span class="keyword">void</span> <span class="title function_">jump</span><span class="params">()</span>;</span><br><span class="line">    <span class="keyword">void</span> <span class="title function_">fly</span><span class="params">()</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div><div class="tab-pane" id="dog-2"><figure class="highlight java"><figcaption><span>Person.java</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.memories.proxy;</span><br><span class="line"><span class="keyword">class</span> <span class="title class_">TibetanMastiff</span> <span class="keyword">implements</span> <span class="title class_">Dog</span>&#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">bark</span><span class="params">()</span> &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;藏獒在叫&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">run</span><span class="params">()</span> &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;藏獒在跑&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Magpie</span> <span class="keyword">implements</span> <span class="title class_">Bird</span>&#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">jump</span><span class="params">()</span> &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;喜鹊在跳来跳去&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">fly</span><span class="params">()</span> &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;喜鹊飞来了&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div><div class="tab-pane" id="dog-3"><figure class="highlight java"><figcaption><span>TimeInvocationHandler.java</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.memories.proxy;</span><br><span class="line"><span class="keyword">import</span> java.lang.reflect.InvocationHandler;</span><br><span class="line"><span class="keyword">import</span> java.lang.reflect.Method;</span><br><span class="line"><span class="comment">//必须实现InvocationHandler接口的invoke方法</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">TimeInvocationHandler</span> <span class="keyword">implements</span> <span class="title class_">InvocationHandler</span>&#123;</span><br><span class="line">    <span class="keyword">private</span> Object target;</span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">TimeInvocationHandler</span><span class="params">(Object target)</span> &#123;</span><br><span class="line">        <span class="built_in">super</span>();</span><br><span class="line">        <span class="built_in">this</span>.target = target;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="meta">@Override</span><span class="comment">//为每个方法增加时间统计</span></span><br><span class="line">    <span class="keyword">public</span> Object <span class="title function_">invoke</span><span class="params">(Object proxy, Method method, Object[] args)</span> <span class="keyword">throws</span> Throwable &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;开始计时...&quot;</span>);</span><br><span class="line">        <span class="type">long</span> <span class="variable">start</span> <span class="operator">=</span> System.currentTimeMillis();</span><br><span class="line">        <span class="type">Object</span> <span class="variable">returnValue</span> <span class="operator">=</span> method.invoke(target, args);</span><br><span class="line">        <span class="type">long</span> <span class="variable">end</span> <span class="operator">=</span> System.currentTimeMillis();</span><br><span class="line">        System.out.println(<span class="string">&quot;方法执行时间：&quot;</span> + (end-start));</span><br><span class="line">        <span class="keyword">return</span> returnValue;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div><div class="tab-pane" id="dog-4"><figure class="highlight java"><figcaption><span>TestProxy.java</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.memories.proxy;</span><br><span class="line"><span class="keyword">import</span> java.lang.reflect.Proxy;</span><br><span class="line"><span class="keyword">import</span> org.junit.Test;</span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">TestProxy</span> &#123;</span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">test1</span><span class="params">()</span>&#123;</span><br><span class="line">        Class&lt;?&gt; clazz = TibetanMastiff.class;</span><br><span class="line">        <span class="type">TibetanMastiff</span> <span class="variable">target</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">TibetanMastiff</span>();</span><br><span class="line">        <span class="type">TimeInvocationHandler</span> <span class="variable">handler</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">TimeInvocationHandler</span>(target);</span><br><span class="line">        <span class="type">Dog</span> <span class="variable">dog</span> <span class="operator">=</span> (Dog) Proxy.newProxyInstance(clazz.getClassLoader(), clazz.getInterfaces(), handler);</span><br><span class="line">        dog.bark();</span><br><span class="line">        dog.run();</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">test2</span><span class="params">()</span>&#123;</span><br><span class="line">        Class&lt;?&gt; clazz = Magpie.class;</span><br><span class="line">        <span class="type">Magpie</span> <span class="variable">target</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Magpie</span>();</span><br><span class="line">        <span class="type">TimeInvocationHandler</span> <span class="variable">handler</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">TimeInvocationHandler</span>(target);</span><br><span class="line">        <span class="type">Bird</span> <span class="variable">bird</span> <span class="operator">=</span> (Bird) Proxy.newProxyInstance(clazz.getClassLoader(), clazz.getInterfaces(), handler);</span><br><span class="line">        bird.jump();</span><br><span class="line">        bird.fly();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div></div></div></p>
<p>动态代理对象需要实现一个或多个接口的方法时，它是如何知道怎么实现这些方法的呢？实际上它实现的方法体，其实就是执行InvocationHandler对象的invoke()方法。<br />
不难发现，使用动态代理可以非常灵活的实现解耦合，这种动态代理在Spring框架体系的AOP（Aspect
Orient
Program，即面向切面编程）里被称为AOP代理，AOP代理可替代目标对象，AOP代理包含了目标对象的全部方法。但AOP代理中的方法与目标对象的方法存在差异：AOP代理里的方法可以在执行目标方法之前、后插入一下通用处理。</p>
<h2 id="小结">小结</h2>
<p>本文详细介绍了Java反射的相关知识，本文对于普通Java学习者来说，确实显得有点深入，并且会感觉不太实用。但随着学习的深入，知识的积累，当读者需要开发出更多基础的、适应性更广的的、灵活性更强的代码时，就会想到使用反射知识了。本文从类的加载、初始化开始介绍，深入介绍了Java类加载器的原理和机制。本文重点介绍了Class、Field、Constructor、Method等，包括动态创建Java实例和动态操作对象的属性和方法。本文还介绍了在Spring框架中核心使用的动态代理原理。</p>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="https://soundmemories.github.io/2020/03/07/Java/21.Java%E7%BD%91%E7%BB%9C%E7%BC%96%E7%A8%8B/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avstar.png">
      <meta itemprop="name" content="SoundMemories">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="SoundMemories">
      <meta itemprop="description" content="今日事，今日毕">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | SoundMemories">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2020/03/07/Java/21.Java%E7%BD%91%E7%BB%9C%E7%BC%96%E7%A8%8B/" class="post-title-link" itemprop="url">Java网络编程</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>

      <time title="创建时间：2020-03-07 00:00:00" itemprop="dateCreated datePublished" datetime="2020-03-07T00:00:00+08:00">2020-03-07</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">分类于</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/Java/" itemprop="url" rel="index"><span itemprop="name">Java</span></a>
        </span>
    </span>

  
    <span class="post-meta-break"></span>
    <span class="post-meta-item" title="本文字数">
      <span class="post-meta-item-icon">
        <i class="far fa-file-word"></i>
      </span>
      <span class="post-meta-item-text">本文字数：</span>
      <span>8.5k</span>
    </span>
    <span class="post-meta-item" title="阅读时长">
      <span class="post-meta-item-icon">
        <i class="far fa-clock"></i>
      </span>
      <span class="post-meta-item-text">阅读时长 &asymp;</span>
      <span>31 分钟</span>
    </span>
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <h2 id="基础知识">基础知识</h2>
<p>Java程序可以非常方便的访问互联网上的HTTP服务、FTP服务等，并可以直接取得互联网上的远程资源，还可以向远程资源发送GET、POST请求。</p>
<h3 id="网络概念">网络概念</h3>
<p>计算机网络：把分布在不同地理区域的计算机与专门的外部设备用通信线路互连成一个规模大、功能强的网络系统，从而使众多的计算机可以方便地互相传递信息、共享硬件、软件、数据信息等资源。</p>
<p>计算机网络有多种分类：<br />
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">|-传输介质：双绞线网、同轴电缆网、光纤网、卫星网等。还有无线传输，例如Wifi的介质是红外线，蓝牙的介质是无线电波，都是电磁波的一种。</span><br><span class="line">|-拓扑结构：星型网络、总线网络、环线网络、树型网络、网状网络、混合型网等。</span><br><span class="line">|-网络规模：</span><br><span class="line">    |-局域网LAN：某一区域内由多台计算机互联成的计算机组。一般是方圆几千米以内。</span><br><span class="line">        |-局域网可以实现文件管理、应用软件共享、打印机共享、工作组内的日程安排、电子邮件通信等功能。</span><br><span class="line">        |-局域网是封闭型的，可以由办公室内的两台计算机组成，也可以由一个公司内的上千台计算机组成。</span><br><span class="line">    |-城域网MAN：在一个城市范围内所建立的计算机通信网，属宽带局域网。</span><br><span class="line">        |-传输媒介主要采用光缆，传输速率在<span class="number">100</span>兆比特/秒以上。</span><br><span class="line">        |-主要用作骨干网，通过它将位于同一城市内不同地点的主机、数据库，以及LAN等互相联接起来。</span><br><span class="line">    |-广域网WAN：又称外网、公网，是连接不同地区局域网或城域网计算机通信的远程网。</span><br><span class="line">        |-覆盖的范围从几十公里到几千公里，它能连接多个地区、城市和国家，提供远距离通信，形成国际性的远程网络。</span><br></pre></td></tr></table></figure></p>
<p>拓扑结构：<br />
<img src="/images/Java/网络.png" width="60%"></p>
<h3 id="通信协议">通信协议</h3>
<p>国际标准化组织ISO于1978年提出了著名的OSI（Open System
Interconnection）开放系统互连参考模型：<br />
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">|-应用层：网络服务与最终用户的一个接口。协议有：HTTP、FTP、SMTP、DNS、TELNET、HTTPS、POP3等等。</span><br><span class="line">|-表示层：数据的表示、安全、压缩。格式有：JPEG、ASCll、DECOIC、加密格式等。</span><br><span class="line">|-会话层：建立、管理、终止会话。对应主机进程，指本地主机与远程主机正在进行的会话</span><br><span class="line">|-传输层：定义传输数据的协议端口号，以及流控和差错校验。协议有：TCP、UDP。</span><br><span class="line">|-网络层：进行逻辑地址寻址，实现不同网络之间的路径选择。协议有：ICMP、IGMP、IP（IPV4 IPV6）、ARP、RARP。</span><br><span class="line">|-数据链路层：建立逻辑连接、进行硬件地址寻址、差错校验等功能。将比特组合成字节再组合成帧，用MAC地址访问介质，错误可被发现但不能纠正。</span><br><span class="line">|-物理层：建立、维护、断开物理连接。</span><br></pre></td></tr></table></figure></p>
<p><strong>通信协议</strong>：对速率、传输代码、代码结构、传输控制步骤、出错控制等制定标准。<br />
<strong>IP协议</strong>：internet
protocal，互联网协议。IP的责任就是把数据从源传送到目的地。它在源地址和目的地址之间传送一种称之为数据包的东西，它还提供对数据大小的重新组装功能，以适应不同网络对包大小的要求。<br />
<strong>TCP协议</strong>：Transmission Control
Protocol，传输控制协议，是一种连接的、可靠的、基于字节流的传输层通信协议，适用于大数据量的传输。通常我们说的TCP/IP协议，其实是指TCP/IP协议族。<br />
<strong>UDP协议</strong>：User Datagram
Protocol，用户数据报协议。是一种非连接的，不可靠的，基于用户数据报文，只支持64k以内的数据发送。</p>
<p>按照TCP/IP协议模型，网络分为四层：网络访问层、互联网层、传输层、应用层。<br />
<img src="/images/Java/TCP.IP.png" width="40%"></p>
<h3 id="ip地址">IP地址</h3>
<p><strong>IP地址</strong>：基于IP协议网络中，用于标识网络中的一个通信实体，通信实体可以是计算机、打印机等。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">|-IPV4：<span class="number">32</span>位，<span class="string">&quot;X.X.X.X&quot;</span>，每个X表示地址中的<span class="number">8</span>位，以十进制[<span class="number">0</span>,<span class="number">255</span>]之间的值表示。</span><br><span class="line">|-IPV6：<span class="number">128</span>位，<span class="string">&quot;X:X:X:X:X:X:X:X&quot;</span>，每个X表示地址中的<span class="number">16</span>位，以十六进制表示。</span><br></pre></td></tr></table></figure>
<p>Internet委员会定义了A~E类，5种IP地址类型以适合不同容量的网络。前3类由Internet
NIC在全球范围内统一分配，D、E类为特殊地址：<br />
<img src="/images/Java/IP.png" width="70%"></p>
<p><strong>域名</strong>：和IP地址是相对应的，方便人们记忆，比如百度的域名是www.baidu.com。<br />
<strong>网域名称系统</strong>（DNS，Domain Name
System）：因特网的一项核心服务，它是一个分布式数据库，记录域名和IP地址相互映射，输入的域名自动解析为IP地址。</p>
<h3 id="端口号">端口号</h3>
<p>IP地址可以确定网络上唯一的一个通信实体，但是一个通信实体可以有多个通信程序同时提供网络服务，而端口号能确定和哪个通信程序。<br />
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">|-端口号：<span class="number">16</span>位，以十进制[<span class="number">0</span>,<span class="number">65535</span>]之间的值表示。</span><br><span class="line">    |-公认端口：[<span class="number">0</span>,<span class="number">1023</span>]，一般为固定服务，比如<span class="number">21</span>分配给FTP服务、<span class="number">25</span>分配给SMTP服务、<span class="number">80</span>分配给HTTP服务。</span><br><span class="line">    |-注册端口：[<span class="number">1024</span>,<span class="number">49151</span>]，松散地绑定于一些服务，比如Tomcat:<span class="number">8080</span>、Oracle:<span class="number">1521</span>、MySQL:<span class="number">3306</span>、SQL Server:<span class="number">1433</span>、QQ:<span class="number">1080</span>。</span><br><span class="line">    |-动态端口：[<span class="number">49152</span>,<span class="number">65535</span>]，一般不固定分配给某个服务，只要服务提出网络申请，系统会从这些端口号中分配一个供程序使用。</span><br></pre></td></tr></table></figure></p>
<h2 id="网络开发">网络开发</h2>
<h3 id="ip相关">IP相关</h3>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">|-InetAddress：IP地址类，有两个子类：IPV4的Inet4Address、IPV6的Inet6Address。</span><br><span class="line">    |-InetAddress <span class="title function_">getLocalHost</span><span class="params">()</span>：返回本地主机。不可靠，不建议多网卡、windows环境使用。</span><br><span class="line">    |-InetAddress <span class="title function_">getByAddress</span><span class="params">(<span class="type">byte</span>[] addr)</span>：给定原始IP地址，返回InetAddress对象。</span><br><span class="line">    |-InetAddress <span class="title function_">getByName</span><span class="params">(String host)</span>：给定主机名，返回InetAddress对象。</span><br><span class="line">    |-String <span class="title function_">getHostAddress</span><span class="params">()</span>：返回IP地址字符串（以文本表现形式）。</span><br><span class="line">    |-String <span class="title function_">getHostName</span><span class="params">()</span>：获取此IP地址的主机名。</span><br><span class="line">    |-String <span class="title function_">getCanonicalHostName</span><span class="params">()</span>：获取此IP地址的完全限定域名。</span><br><span class="line">    |-<span class="type">boolean</span> <span class="title function_">isReachable</span><span class="params">(<span class="type">int</span> timeout)</span>：测试是否可以达到该地址。</span><br></pre></td></tr></table></figure>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> java.io.UnsupportedEncodingException;</span><br><span class="line"><span class="keyword">import</span> java.net.InetAddress;</span><br><span class="line"><span class="keyword">import</span> java.net.UnknownHostException;</span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">TestInetAddress</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> UnknownHostException&#123;</span><br><span class="line">        <span class="type">InetAddress</span> <span class="variable">ip1</span> <span class="operator">=</span> InetAddress.getLocalHost();</span><br><span class="line">        System.out.println(ip1);<span class="comment">// LAPTOP/192.168.1.107</span></span><br><span class="line">        <span class="type">InetAddress</span> <span class="variable">ip2</span> <span class="operator">=</span> InetAddress.getByName(<span class="string">&quot;www.baidu.com&quot;</span>);</span><br><span class="line">        System.out.println(ip2);<span class="comment">// www.baidu.com/220.181.38.150</span></span><br><span class="line">        <span class="type">byte</span>[] ip = &#123;(<span class="type">byte</span>) <span class="number">222</span>,(<span class="type">byte</span>) <span class="number">222</span>,<span class="number">88</span>,<span class="number">102</span>&#125;;</span><br><span class="line">        <span class="type">InetAddress</span> <span class="variable">ip3</span> <span class="operator">=</span> InetAddress.getByAddress(ip);</span><br><span class="line">        System.out.println(ip3);<span class="comment">// /222.222.88.102</span></span><br><span class="line">        <span class="comment">//如果这个IP地址不存在或DNS服务器不允许&quot;ip-&gt;域名&quot;的映射，那么getHostName方法就直接返回这个IP地址</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="url相关">URL相关</h3>
<p><strong>URI</strong>（Uniform resource
identifier）：统一资源标识符，用来唯一的标识一个资源。不能定位资源，只能解析。<br />
<strong>URL</strong>（Uniform Resource
Locator）：统一资源定位符，它是指向互联网“资源”的指针。资源可以是文件、目录、复杂对象的引用，例如对数据库、搜索引擎的查询。URL的基本结构由5部分组成：<br />
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">&quot;&lt;传输协议&gt;://&lt;主机名&gt;:&lt;端口号&gt;/&lt;文件名&gt;#片段名&quot;</span></span><br><span class="line"><span class="string">&quot;&lt;传输协议&gt;://&lt;主机名&gt;:&lt;端口号&gt;/&lt;文件名&gt;?参数列表&quot;</span></span><br><span class="line"><span class="comment">//&quot;#片段名&quot;：即锚点，例如看小说，直接定位到章节。</span></span><br><span class="line"><span class="comment">//&quot;参数列表&quot;：参数名=参数值&amp;参数名=参数值....。</span></span><br></pre></td></tr></table></figure></p>
<p>URL方法：<br />
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line">构造方法：</span><br><span class="line">|-URL (String spec)：根据String表示形式创建URL对象。</span><br><span class="line">|-URL(URL context, String spec)：通过基URL和相对URL构造一个URL对象。</span><br><span class="line">|-URL(String protocol, String host, String file)：根据指定的protocol、host、file创建URL对象。</span><br><span class="line">|-URL(String protocol, String host, <span class="type">int</span> port, String file)：根据指定protocol、host、port、file创建URL对象。</span><br><span class="line">常用方法：</span><br><span class="line">|-String <span class="title function_">getProtocol</span><span class="params">()</span>：获取该URL的协议名。</span><br><span class="line">|-String <span class="title function_">getHost</span><span class="params">()</span>：获取该URL的主机名。</span><br><span class="line">|-String <span class="title function_">getPort</span><span class="params">()</span>：获取该URL的端口号。</span><br><span class="line">|-String <span class="title function_">getPath</span><span class="params">()</span>：获取该URL的文件路径，即tomcat的webapps目录下级目录名也就是资源路径名。</span><br><span class="line">|-String <span class="title function_">getFile</span><span class="params">()</span>：获取该URL的文件名。</span><br><span class="line">|-String <span class="title function_">getRef</span><span class="params">()</span>：获取该URL在文件中的相对位置。</span><br><span class="line">|-String <span class="title function_">getQuery</span><span class="params">()</span>：获取该URL的查询名。</span><br><span class="line">读取、传输方法：</span><br><span class="line">|-InputStream <span class="title function_">openStream</span><span class="params">()</span>：返回一个用于从该连接读入的InputStream。</span><br><span class="line">|-openConnection()：创建传输实例。</span><br><span class="line">    |-<span class="keyword">void</span> <span class="title function_">setDoOutput</span><span class="params">(<span class="type">boolean</span> dooutput)</span>：所有get和connect方法之首。默认<span class="literal">false</span>，若使用URL连接传递数据，则将DoOutput设置为<span class="literal">true</span>。</span><br><span class="line">    |-String <span class="title function_">getContentEncoding</span><span class="params">()</span>：返回content-encoding头字段的值。</span><br><span class="line">    |-<span class="type">int</span> <span class="title function_">getContentLength</span><span class="params">()</span>：返回content-length头字段的值。 </span><br><span class="line">    |-String <span class="title function_">getContentType</span><span class="params">()</span>：返回content-type头字段的值。 </span><br><span class="line">    |-<span class="type">long</span> <span class="title function_">getDate</span><span class="params">()</span>：返回date头字段的值。</span><br><span class="line">    |-<span class="type">long</span> <span class="title function_">getLastModified</span><span class="params">()</span>：返回last-modified头字段的值。结果为距离格林威治标准时间<span class="number">1970</span>年<span class="number">1</span>月<span class="number">1</span>日的毫秒数。</span><br><span class="line">    |-String <span class="title function_">getHeaderField</span><span class="params">(String name)</span>：返回指定的头字段的值。 </span><br><span class="line">    |-InputStream <span class="title function_">getInputStream</span><span class="params">()</span>：返回从此打开的连接读取的输入流。</span><br><span class="line">    |-OutputStream <span class="title function_">getOutputStream</span><span class="params">()</span>：返回写入到此连接的输出流。</span><br></pre></td></tr></table></figure></p>
<div class="tabs" id="url"><ul class="nav-tabs"><li class="tab active"><a href="#url-1">构造方法</a></li><li class="tab"><a href="#url-2">常用方法</a></li><li class="tab"><a href="#url-3">读取数据</a></li><li class="tab"><a href="#url-4">传输数据</a></li></ul><div class="tab-content"><div class="tab-pane active" id="url-1"><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">URL</span> <span class="variable">url</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">URL</span> (<span class="string">&quot;http://www.baidu.com/&quot;</span>);</span><br><span class="line"><span class="type">URL</span> <span class="variable">downloadUrl</span> <span class="operator">=</span>  <span class="keyword">new</span> <span class="title class_">URL</span>(url, <span class="string">&quot;download.html&quot;</span>);</span><br><span class="line"><span class="keyword">new</span> <span class="title class_">URL</span>(<span class="string">&quot;http&quot;</span>, <span class="string">&quot;www.baidu.com&quot;</span>, <span class="string">&quot;download.html&quot;</span>);</span><br><span class="line"><span class="keyword">new</span> <span class="title class_">URL</span>(<span class="string">&quot;http&quot;</span>, <span class="string">&quot;www.baidu.com&quot;</span>, <span class="number">80</span>, <span class="string">&quot;download.html&quot;</span>);</span><br></pre></td></tr></table></figure></div><div class="tab-pane" id="url-2"><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> java.net.MalformedURLException;</span><br><span class="line"><span class="keyword">import</span> java.net.URL;</span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">TestURL</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> MalformedURLException &#123;</span><br><span class="line">        <span class="type">URL</span> <span class="variable">url</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">URL</span>(<span class="string">&quot;http://www.baidu.com:80/index.html?keyword=java&quot;</span>);</span><br><span class="line">        System.out.println(<span class="string">&quot;协议:&quot;</span> + url.getProtocol());<span class="comment">//协议:http</span></span><br><span class="line">        System.out.println(<span class="string">&quot;主机名:&quot;</span> + url.getHost());<span class="comment">//主机名:www.baidu.com</span></span><br><span class="line">        System.out.println(<span class="string">&quot;端口号:&quot;</span> + url.getPort());<span class="comment">//端口号:8</span></span><br><span class="line">        System.out.println(<span class="string">&quot;路径名:&quot;</span> + url.getPath());<span class="comment">//路径名:/index.html</span></span><br><span class="line">        System.out.println(<span class="string">&quot;文件名:&quot;</span> + url.getFile());<span class="comment">//文件名:/index.html?keyword=java</span></span><br><span class="line">        System.out.println(<span class="string">&quot;锚点:&quot;</span> + url.getRef());<span class="comment">//锚点:null</span></span><br><span class="line">        System.out.println(<span class="string">&quot;查询名:&quot;</span> + url.getQuery());<span class="comment">//查询名:keyword=java</span></span><br><span class="line">        <span class="comment">//如果存在锚点，那么查询名返回null，因为#后面全部当做锚点了</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div><div class="tab-pane" id="url-3"><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> java.io.InputStream;</span><br><span class="line"><span class="keyword">import</span> java.net.URL;</span><br><span class="line"><span class="comment">//获取百度首页的资源</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">TestURLRead</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span><span class="keyword">throws</span> Exception &#123;</span><br><span class="line">        <span class="comment">//html标签（格式化数据）、css：皮肤（美化数据）、js：互动（交互数据）</span></span><br><span class="line">        <span class="type">URL</span> <span class="variable">url</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">URL</span>(<span class="string">&quot;http://www.baidu.com/index.html&quot;</span>);</span><br><span class="line">        <span class="type">InputStream</span> <span class="variable">input</span> <span class="operator">=</span> url.openStream();</span><br><span class="line">        <span class="type">byte</span>[] data = <span class="keyword">new</span> <span class="title class_">byte</span>[<span class="number">1024</span>];</span><br><span class="line">        <span class="type">int</span> len;</span><br><span class="line">        <span class="keyword">while</span>((len=input.read(data)) != -<span class="number">1</span>)&#123;</span><br><span class="line">            System.out.println(<span class="keyword">new</span> <span class="title class_">String</span>(data,<span class="number">0</span>,len,<span class="string">&quot;UTF-8&quot;</span>));</span><br><span class="line">        &#125;</span><br><span class="line">        input.close();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div><div class="tab-pane" id="url-4"><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> java.io.BufferedReader;</span><br><span class="line"><span class="keyword">import</span> java.io.InputStream;</span><br><span class="line"><span class="keyword">import</span> java.io.InputStreamReader;</span><br><span class="line"><span class="keyword">import</span> java.net.URL;</span><br><span class="line"><span class="keyword">import</span> java.net.URLConnection;</span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">TestURLConnection</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> Exception&#123;</span><br><span class="line">        <span class="type">URL</span> <span class="variable">url</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">URL</span>(<span class="string">&quot;http://localhost/web1/denglu&quot;</span>);</span><br><span class="line">        <span class="comment">//通过URL对象调用openConnection方法创建连接对象</span></span><br><span class="line">        <span class="type">URLConnection</span> <span class="variable">uc</span> <span class="operator">=</span> url.openConnection();</span><br><span class="line">        <span class="comment">//处理设置参数</span></span><br><span class="line">        uc.setDoOutput(<span class="literal">true</span>);</span><br><span class="line">        <span class="comment">//给服务器发送请求参数</span></span><br><span class="line">        uc.getOutputStream().write(<span class="string">&quot;username=admin&amp;password=123&quot;</span>.getBytes());</span><br><span class="line">        <span class="comment">//使用connect方法建立到远程对象的实际连接</span></span><br><span class="line">        uc.connect();</span><br><span class="line">        <span class="comment">//获取资源</span></span><br><span class="line">        <span class="type">InputStream</span> <span class="variable">is</span> <span class="operator">=</span> uc.getInputStream();</span><br><span class="line">        <span class="type">BufferedReader</span> <span class="variable">br</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">BufferedReader</span>(<span class="keyword">new</span> <span class="title class_">InputStreamReader</span>(is,<span class="string">&quot;UTF-8&quot;</span>));</span><br><span class="line">        String str;</span><br><span class="line">        <span class="keyword">while</span>((str=br.readLine()) != <span class="literal">null</span>)&#123;</span><br><span class="line">            System.out.println(str);</span><br><span class="line">        &#125;</span><br><span class="line">        br.close();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div></div></div>
<h3 id="socket相关">Socket相关</h3>
<p><strong>Socket</strong>：套接字，应用层和传输层之间定义的一种编程接口，使得应用程序可以通过它发送或接收数据。Socket分为两种类型：<br />
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//通信的两端都要有Socket，是两台机器间通信的端点。</span></span><br><span class="line">|-流套接字（stream socket）：面向连接的，使用TCP提供可靠的字节流服务。Java中使用ServerSocket类和Socket类。</span><br><span class="line">|-数据报套接字（datagram socket）：使用UDP提供“尽力而为”的数据报服务。Java中使用DatagramSocket类。</span><br></pre></td></tr></table></figure><br />
<img src="/images/Java/Socket.png" width="70%"></p>
<p>Socket方法：<br />
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">构造方法：</span><br><span class="line">|-Socket(InetAddress address,<span class="type">int</span> port)：创建一个流套接字并将其连接到指定IP地址的指定端口号。</span><br><span class="line">|-Socket(String host,<span class="type">int</span> port)：创建一个流套接字并将其连接到指定主机上的指定端口号。</span><br><span class="line">常用方法：</span><br><span class="line">|-InputStream <span class="title function_">getInputStream</span><span class="params">()</span>：返回此套接字的输入流，可以用于接收消息。</span><br><span class="line">|-OutputStream <span class="title function_">getOutputStream</span><span class="params">()</span>：返回此套接字的输出流，可以用于发送消息。</span><br><span class="line">|-InetAddress <span class="title function_">getInetAddress</span><span class="params">()</span>：此套接字连接到的远程IP地址；如果套接字是未连接的，则返回<span class="literal">null</span>。</span><br><span class="line">|-InetAddress <span class="title function_">getLocalAddress</span><span class="params">()</span>：获取套接字绑定的本地地址。</span><br><span class="line">|-<span class="type">int</span> <span class="title function_">getPort</span><span class="params">()</span>：此套接字连接到的远程端口号，如果尚未连接套接字，则返回<span class="number">0</span>。</span><br><span class="line">|-<span class="type">int</span> <span class="title function_">getLocalPort</span><span class="params">()</span>：返回此套接字绑定到的本地端口。如果尚未绑定套接字，则返回-<span class="number">1</span>。</span><br><span class="line">|-<span class="keyword">void</span> <span class="title function_">close</span><span class="params">()</span>：关闭此套接字，释放Socket占用的资源，比如端口号。</span><br><span class="line">|-<span class="keyword">void</span> <span class="title function_">shutdownInput</span><span class="params">()</span>：禁用此套接字的输入流。在套接字上调用此方法后，从套接字输入流读取内容，将返回EOF（文件结束符）。</span><br><span class="line">|-<span class="keyword">void</span> <span class="title function_">shutdownOutput</span><span class="params">()</span>：禁用此套接字的输出流。对于TCP套接字，以前写入的数据都将被发送，之后链接终止，再调用输出会报IOException。</span><br><span class="line"><span class="comment">//先后调用shutdownInput、和shutdownOutput方法，仅仅关闭了输入流和输出流，并不等于close方法。</span></span><br></pre></td></tr></table></figure></p>
<h5 id="基于tcp协议">基于TCP协议</h5>
<p><strong>TCP</strong>（Transmission Control
Protocol）：传输控制协议，也被称作一种端对端协议。是一种面向连接的、可靠的、基于字节流的传输层的通信协议，可以连续传输大量的数据。当一台计算机想要连接另一台计算机时，TCP协议会采用<strong>三次握手</strong>方式让它们建立一个连接用于发送和接收数据，数据传输完毕TCP协议会采用<strong>四次挥手</strong>方式断开连接。</p>
<p>Java基于Socket的TCP编程，分为<strong>服务端</strong>编程、<strong>客户端</strong>编程，其通信模型如图所示：<br />
<img src="/images/Java/TCP.png" width="60%"></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">服务端：</span><br><span class="line">|-ServerSocket(<span class="type">int</span> port)：创建一个服务器端套接字，并绑定到指定端口上，用于监听客户端的请求。</span><br><span class="line">|-Socket <span class="title function_">accept</span><span class="params">()</span>：监听连接请求，若客户端请求连接，则接受连接，创建与该客户端的Socket对象。否则它将一直处于等待状态。</span><br><span class="line">|-InputStream <span class="title function_">getInputStream</span><span class="params">()</span>：获取输入流，开始网络数据的接收。</span><br><span class="line">|-OutputStream <span class="title function_">getOutputStream</span><span class="params">()</span>：获取输出流，开始网络数据的发送。</span><br><span class="line">|-关闭Socket实例：某客户端访问结束，关闭与之通信的套接字。</span><br><span class="line">|-关闭ServerSocket实例：如果不再接收任何客户端的连接的话，调用close()进行关闭。</span><br><span class="line">客户端：</span><br><span class="line">|-创建Socket实例：根据指定服务端的IP地址/端口号构造Socket实例，创建的同时会自动向服务器方发起连接。</span><br><span class="line">   |-若服务器端响应，则建立客户端到服务器的通信线路。</span><br><span class="line">   |-若连接失败，会出现异常。</span><br><span class="line">|-InputStream <span class="title function_">getInputStream</span><span class="params">()</span>：获取输入流，开始网络数据的接收。</span><br><span class="line">|-OutputStream <span class="title function_">getOutputStream</span><span class="params">()</span>：获取输出流，开始网络数据的发送。</span><br><span class="line">|-进行读/写操作：通过输入流读取服务器发送的信息，通过输出流将信息发送给服务器。</span><br><span class="line">|-关闭Socket实例：断开客户端到服务器的连接。</span><br><span class="line"><span class="comment">//客户端、服务器端在获取输入流和输出流时要一入对应一出，否则容易死锁。</span></span><br></pre></td></tr></table></figure>
<div class="tabs" id="socket1"><ul class="nav-tabs"><li class="tab active"><a href="#socket1-1">单客户端+单服务端（服务端）</a></li><li class="tab"><a href="#socket1-2">单客户端+单服务端（客户端）</a></li></ul><div class="tab-content"><div class="tab-pane active" id="socket1-1"><figure class="highlight java"><figcaption><span>Server.java</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.memories.tcp.one;</span><br><span class="line"><span class="keyword">import</span> java.io.InputStream;</span><br><span class="line"><span class="keyword">import</span> java.io.OutputStream;</span><br><span class="line"><span class="keyword">import</span> java.net.ServerSocket;</span><br><span class="line"><span class="keyword">import</span> java.net.Socket;</span><br><span class="line"><span class="comment">//客户端连接服务器，连接成功后给服务发送“lalala”，服务器收到消息后，给客户端返回“欢迎登录”</span></span><br><span class="line"><span class="comment">//运行程序时，必须先启动服务器端程序，主动接收客户端程序的连接请求。</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Server</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span><span class="keyword">throws</span> Exception &#123;</span><br><span class="line">        <span class="comment">//1.准备ServerSocket对象，并绑定8888端口</span></span><br><span class="line">        <span class="type">ServerSocket</span> <span class="variable">server</span> <span class="operator">=</span>  <span class="keyword">new</span> <span class="title class_">ServerSocket</span>(<span class="number">8888</span>);</span><br><span class="line">        System.out.println(<span class="string">&quot;等待连接....&quot;</span>);</span><br><span class="line">        <span class="comment">//2.在8888端口监听客户端的连接，该方法是个阻塞方法，若没有客户端连接，将一直等待</span></span><br><span class="line">        <span class="type">Socket</span> <span class="variable">socket</span> <span class="operator">=</span> server.accept();</span><br><span class="line">        System.out.println(<span class="string">&quot;一个客户端连接成功！！&quot;</span>);</span><br><span class="line">        <span class="comment">//3.获取输入流，用来接收该客户端发送给服务器的数据，</span></span><br><span class="line">        <span class="type">InputStream</span> <span class="variable">input</span> <span class="operator">=</span> socket.getInputStream();</span><br><span class="line">        <span class="type">byte</span>[] data = <span class="keyword">new</span> <span class="title class_">byte</span>[<span class="number">1024</span>];<span class="comment">//接收byte数据</span></span><br><span class="line">        <span class="type">StringBuilder</span> <span class="variable">s</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">StringBuilder</span>();</span><br><span class="line">        <span class="type">int</span> len;</span><br><span class="line">        <span class="keyword">while</span> ((len=input.read(data)) != -<span class="number">1</span>) &#123;</span><br><span class="line">            s.append(<span class="keyword">new</span> <span class="title class_">String</span>(data, <span class="number">0</span>, len));</span><br><span class="line">        &#125;</span><br><span class="line">        System.out.println(<span class="string">&quot;客户端发送的消息是：&quot;</span> + s);</span><br><span class="line">        <span class="comment">//4.获取输出流，用来发送数据给该客户端</span></span><br><span class="line">        <span class="type">OutputStream</span> <span class="variable">out</span> <span class="operator">=</span> socket.getOutputStream();</span><br><span class="line">        <span class="comment">//发送数据</span></span><br><span class="line">        out.write(<span class="string">&quot;欢迎登录&quot;</span>.getBytes());<span class="comment">//转成byte数据发送</span></span><br><span class="line">        out.flush();</span><br><span class="line">        <span class="comment">//5.关闭socket，不再与该客户端通信</span></span><br><span class="line">        socket.close();<span class="comment">//socket关闭，意味着InputStream和OutputStream也关闭了</span></span><br><span class="line">        <span class="comment">//6.如果服务端不再接收任何客户端通信，可以关闭ServerSocket</span></span><br><span class="line">        server.close();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div><div class="tab-pane" id="socket1-2"><figure class="highlight java"><figcaption><span>Client.java</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.memories.tcp.one;</span><br><span class="line"><span class="keyword">import</span> java.io.InputStream;</span><br><span class="line"><span class="keyword">import</span> java.io.OutputStream;</span><br><span class="line"><span class="keyword">import</span> java.net.Socket;</span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Client</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> Exception &#123;</span><br><span class="line">        <span class="comment">//1.准备Socket，连接服务器，需要指定服务器的IP地址和端口号</span></span><br><span class="line">        <span class="type">Socket</span> <span class="variable">socket</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Socket</span>(<span class="string">&quot;127.0.0.1&quot;</span>, <span class="number">8888</span>);</span><br><span class="line">        <span class="comment">//2.获取输出流，用来发送数据给服务器</span></span><br><span class="line">        <span class="type">OutputStream</span> <span class="variable">out</span> <span class="operator">=</span> socket.getOutputStream();</span><br><span class="line">        out.write(<span class="string">&quot;lalala&quot;</span>.getBytes());<span class="comment">//转成byte数据发送</span></span><br><span class="line">        <span class="comment">//会在流末尾写入一个“流的末尾”标记，对方才能读到-1，否则对方的读取方法会一致阻塞</span></span><br><span class="line">        socket.shutdownOutput();</span><br><span class="line">        <span class="comment">//3.获取输入流，用来接收服务器发送给该客户端的数据</span></span><br><span class="line">        <span class="type">InputStream</span> <span class="variable">input</span> <span class="operator">=</span> socket.getInputStream();</span><br><span class="line">        <span class="type">byte</span>[] data = <span class="keyword">new</span> <span class="title class_">byte</span>[<span class="number">1024</span>];<span class="comment">//接收byte数据</span></span><br><span class="line">        <span class="type">StringBuilder</span> <span class="variable">s</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">StringBuilder</span>();</span><br><span class="line">        <span class="type">int</span> len;</span><br><span class="line">        <span class="keyword">while</span> ((len=input.read(data)) != -<span class="number">1</span>) &#123;</span><br><span class="line">            s.append(<span class="keyword">new</span> <span class="title class_">String</span>(data, <span class="number">0</span>, len));</span><br><span class="line">        &#125;</span><br><span class="line">        System.out.println(<span class="string">&quot;服务器返回的消息是：&quot;</span> + s);</span><br><span class="line">        <span class="comment">//4.关闭socket，不再与服务器通信，即断开与服务器的连接</span></span><br><span class="line">        socket.close();<span class="comment">//socket关闭，意味着InputStream和OutputStream也关闭了</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div></div></div>
<div class="tabs" id="socket2"><ul class="nav-tabs"><li class="tab active"><a href="#socket2-1">多客户端+单服务端（主服务端）</a></li><li class="tab"><a href="#socket2-2">多客户端+单服务端（次服务端）</a></li><li class="tab"><a href="#socket2-3">多客户端+单服务端（客户端）</a></li></ul><div class="tab-content"><div class="tab-pane active" id="socket2-1"><figure class="highlight java"><figcaption><span>Server.java</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.memories.tcp.echo;</span><br><span class="line"><span class="keyword">import</span> java.net.ServerSocket;</span><br><span class="line"><span class="keyword">import</span> java.net.Socket;</span><br><span class="line"><span class="comment">//案例需求：多个客户端连接服务器，并进行多次通信。</span></span><br><span class="line"><span class="comment">//1.每一个客户端连接成功后，从键盘输入单词或成语，发送给服务器。</span></span><br><span class="line"><span class="comment">//2.服务器收到客户端的消息后，把词语“反转”后返回给客户端。</span></span><br><span class="line"><span class="comment">//3.客户端接收服务器返回的“词语”，打印显示。</span></span><br><span class="line"><span class="comment">//4.当客户端输入“stop”时断开与服务器的连接。</span></span><br><span class="line"><span class="comment">//5.多个客户端可以同时给服务器发送“词语”，服务器可以“同时”处理多个客户端的请求。</span></span><br><span class="line"><span class="comment">//提示：服务器端要“同时”处理多个客户端的请求，那么必须使用多线程，每一个客户端的通信需要单独的线程来处理。</span></span><br><span class="line"><span class="comment">//提示：IO流中提到可通过包装类把流包装成处理流。</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Server</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span><span class="keyword">throws</span> Exception &#123;</span><br><span class="line">        <span class="comment">//1.准备一个ServerSocket</span></span><br><span class="line">        <span class="type">ServerSocket</span> <span class="variable">server</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ServerSocket</span>(<span class="number">8888</span>);</span><br><span class="line">        System.out.println(<span class="string">&quot;等待连接...&quot;</span>);</span><br><span class="line">        <span class="type">int</span> <span class="variable">count</span> <span class="operator">=</span> <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">while</span>(<span class="literal">true</span>)&#123;<span class="comment">//2.循环监听客户端的连接</span></span><br><span class="line">            <span class="type">Socket</span> <span class="variable">socket</span> <span class="operator">=</span> server.accept();</span><br><span class="line">            System.out.println(<span class="string">&quot;第&quot;</span> + ++count + <span class="string">&quot;个客户端连接成功！！&quot;</span>);</span><br><span class="line">            <span class="type">ClientHandlerThread</span> <span class="variable">ct</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ClientHandlerThread</span>(socket);</span><br><span class="line">            ct.start();<span class="comment">//启动一个处理线程</span></span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">//这里没有关闭server，永远监听</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div><div class="tab-pane" id="socket2-2"><figure class="highlight java"><figcaption><span>ClientHandlerThread.java</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.memories.tcp.echo;</span><br><span class="line"><span class="keyword">import</span> java.io.BufferedReader;</span><br><span class="line"><span class="keyword">import</span> java.io.IOException;</span><br><span class="line"><span class="keyword">import</span> java.io.InputStreamReader;</span><br><span class="line"><span class="keyword">import</span> java.io.PrintStream;</span><br><span class="line"><span class="keyword">import</span> java.net.Socket;</span><br><span class="line"><span class="comment">//使用包装类，包装输入、输出流</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">ClientHandlerThread</span> <span class="keyword">extends</span> <span class="title class_">Thread</span>&#123;</span><br><span class="line">    <span class="keyword">private</span> Socket socket;</span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">ClientHandlerThread</span><span class="params">(Socket socket)</span> &#123;</span><br><span class="line">        <span class="built_in">super</span>();</span><br><span class="line">        <span class="built_in">this</span>.socket = socket;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">run</span><span class="params">()</span>&#123;</span><br><span class="line">        <span class="keyword">try</span>&#123;</span><br><span class="line">            <span class="comment">//1.获取输入流，用来接收该客户端发送给服务器的数据</span></span><br><span class="line">            <span class="type">BufferedReader</span> <span class="variable">br</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">BufferedReader</span>(<span class="keyword">new</span> <span class="title class_">InputStreamReader</span>(socket.getInputStream()));</span><br><span class="line">            <span class="comment">//2.获取输出流，用来发送数据给该客户端</span></span><br><span class="line">            <span class="type">PrintStream</span> <span class="variable">ps</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">PrintStream</span>(socket.getOutputStream());</span><br><span class="line">            String str;</span><br><span class="line">            <span class="comment">//3.接收数据</span></span><br><span class="line">            <span class="keyword">while</span> ((str=br.readLine()) != <span class="literal">null</span>) &#123;</span><br><span class="line">                <span class="type">StringBuilder</span> <span class="variable">word</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">StringBuilder</span>(str);</span><br><span class="line">                word.reverse();<span class="comment">//4.反转</span></span><br><span class="line">                ps.println(word);<span class="comment">//5.返回给客户端</span></span><br><span class="line">            &#125;</span><br><span class="line">        &#125;<span class="keyword">catch</span>(Exception  e)&#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125;<span class="keyword">finally</span>&#123;</span><br><span class="line">            <span class="keyword">try</span> &#123;</span><br><span class="line">                socket.close();<span class="comment">//6.断开连接</span></span><br><span class="line">            &#125; <span class="keyword">catch</span> (IOException e) &#123;</span><br><span class="line">                e.printStackTrace();</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div><div class="tab-pane" id="socket2-3"><figure class="highlight java"><figcaption><span>Client.java</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.memories.tcp.echo;</span><br><span class="line"><span class="keyword">import</span> java.io.BufferedReader;</span><br><span class="line"><span class="keyword">import</span> java.io.InputStream;</span><br><span class="line"><span class="keyword">import</span> java.io.InputStreamReader;</span><br><span class="line"><span class="keyword">import</span> java.io.OutputStream;</span><br><span class="line"><span class="keyword">import</span> java.io.PrintStream;</span><br><span class="line"><span class="keyword">import</span> java.net.Socket;</span><br><span class="line"><span class="keyword">import</span> java.util.Scanner;</span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Client</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> Exception &#123;</span><br><span class="line">        <span class="comment">//1.准备Socket，连接服务器，需要指定服务器的IP地址和端口号</span></span><br><span class="line">        <span class="type">Socket</span> <span class="variable">socket</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Socket</span>(<span class="string">&quot;127.0.0.1&quot;</span>, <span class="number">8888</span>);</span><br><span class="line">        <span class="comment">//2.获取输出流，用来发送数据给服务器</span></span><br><span class="line">        <span class="type">PrintStream</span> <span class="variable">ps</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">PrintStream</span>(socket.getOutputStream());</span><br><span class="line">        <span class="comment">//3.获取输入流，用来接收服务器发送给该客户端的数据</span></span><br><span class="line">        <span class="type">BufferedReader</span> <span class="variable">br</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">BufferedReader</span>(<span class="keyword">new</span> <span class="title class_">InputStreamReader</span>(socket.getInputStream()));</span><br><span class="line">        <span class="comment">//4.准备数据</span></span><br><span class="line">        <span class="type">Scanner</span> <span class="variable">scanner</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Scanner</span>(System.in);</span><br><span class="line">        <span class="keyword">while</span>(<span class="literal">true</span>)&#123;</span><br><span class="line">            System.out.println(<span class="string">&quot;输入发送给服务器的单词或成语：&quot;</span>);</span><br><span class="line">            <span class="type">String</span> <span class="variable">message</span> <span class="operator">=</span> scanner.nextLine();</span><br><span class="line">            <span class="keyword">if</span>(message.equals(<span class="string">&quot;stop&quot;</span>))&#123;</span><br><span class="line">                socket.shutdownOutput();<span class="comment">//发送断开连接</span></span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">            &#125;</span><br><span class="line">            ps.println(message);<span class="comment">//5.发送数据</span></span><br><span class="line">            <span class="type">String</span> <span class="variable">feedback</span>  <span class="operator">=</span> br.readLine();<span class="comment">//6.接收数据</span></span><br><span class="line">            System.out.println(<span class="string">&quot;从服务器收到的反馈是：&quot;</span> + feedback);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">//7.关闭socket，断开与服务器的连接</span></span><br><span class="line">        scanner.close();</span><br><span class="line">        socket.close();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div></div></div>
<div class="tabs" id="socket3"><ul class="nav-tabs"><li class="tab active"><a href="#socket3-1">多客户端+单服务端（主服务端）</a></li><li class="tab"><a href="#socket3-2">多客户端+单服务端（次服务端）</a></li><li class="tab"><a href="#socket3-3">多客户端+单服务端（客户端）</a></li></ul><div class="tab-content"><div class="tab-pane active" id="socket3-1"><figure class="highlight java"><figcaption><span>Server.java</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.memories.tcp.fileupload;</span><br><span class="line"><span class="keyword">import</span> java.net.ServerSocket;</span><br><span class="line"><span class="keyword">import</span> java.net.Socket;</span><br><span class="line"><span class="comment">//案例需求：每一个客户端启动后都可以给服务器上传一个文件，服务器接收到文件后保存到一个upload目录中。</span></span><br><span class="line"><span class="comment">//1.可以同时接收多个客户端的文件上传。</span></span><br><span class="line"><span class="comment">//2.每个客户端给服务器发送的文件可能重名，所以需要保证文件名的唯一，可使用“时间戳”作为文件名，而后缀名不变。</span></span><br><span class="line"><span class="comment">//3.客户端需要给服务器上传文件全名（字符串）、文件内容（不确定）。可选择DataOutputStream和DataInputStream。</span></span><br><span class="line"><span class="comment">//提示：服务器端要“同时”处理多个客户端的请求，那么必须使用多线程，每一个客户端的通信需要单独的线程来处理。</span></span><br><span class="line"><span class="comment">//提示：IO流中提到可通过包装类把流包装成处理流。</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Server</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> Exception&#123;</span><br><span class="line">        <span class="comment">//1.准备一个ServerSocket</span></span><br><span class="line">        <span class="type">ServerSocket</span> <span class="variable">server</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ServerSocket</span>(<span class="number">8888</span>);</span><br><span class="line">        <span class="keyword">while</span>(<span class="literal">true</span>)&#123;<span class="comment">//2.循环监听客户端的连接</span></span><br><span class="line">            <span class="type">Socket</span> <span class="variable">accept</span> <span class="operator">=</span> server.accept();</span><br><span class="line">            <span class="type">FileUploadThread</span> <span class="variable">ft</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">FileUploadThread</span>(accept);</span><br><span class="line">            ft.start();<span class="comment">//启动一个处理线程</span></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div><div class="tab-pane" id="socket3-2"><figure class="highlight java"><figcaption><span>FileUploadThread.java</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.atguigu.tcp.fileupload;</span><br><span class="line"><span class="keyword">import</span> java.io.DataInputStream;</span><br><span class="line"><span class="keyword">import</span> java.io.FileNotFoundException;</span><br><span class="line"><span class="keyword">import</span> java.io.FileOutputStream;</span><br><span class="line"><span class="keyword">import</span> java.io.IOException;</span><br><span class="line"><span class="keyword">import</span> java.io.InputStream;</span><br><span class="line"><span class="keyword">import</span> java.io.OutputStream;</span><br><span class="line"><span class="keyword">import</span> java.io.PrintStream;</span><br><span class="line"><span class="keyword">import</span> java.net.Socket;</span><br><span class="line"><span class="keyword">import</span> java.text.SimpleDateFormat;</span><br><span class="line"><span class="keyword">import</span> java.util.Date;</span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">FileUploadThread</span> <span class="keyword">extends</span> <span class="title class_">Thread</span>&#123;</span><br><span class="line">    <span class="keyword">private</span> Socket socket;</span><br><span class="line">    <span class="keyword">private</span> <span class="type">String</span> <span class="variable">dir</span> <span class="operator">=</span> <span class="string">&quot;upload/&quot;</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">FileUploadThread</span><span class="params">(Socket socket)</span> &#123;</span><br><span class="line">        <span class="built_in">super</span>();</span><br><span class="line">        <span class="built_in">this</span>.socket = socket;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">run</span><span class="params">()</span>&#123;</span><br><span class="line">        <span class="type">FileOutputStream</span> <span class="variable">fos</span> <span class="operator">=</span> <span class="literal">null</span>;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="comment">//1.获取文件输入流，用来接收该客户端发送给服务器的数据</span></span><br><span class="line">            <span class="type">DataInputStream</span> <span class="variable">dis</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">DataInputStream</span>(socket.getInputStream());</span><br><span class="line">            <span class="comment">//2.生成时间戳作为文件名</span></span><br><span class="line">            <span class="type">String</span> <span class="variable">filename</span> <span class="operator">=</span> dis.readUTF();<span class="comment">//读取文件名</span></span><br><span class="line">            <span class="type">String</span> <span class="variable">ext</span> <span class="operator">=</span> filename.substring(filename.lastIndexOf(<span class="string">&quot;.&quot;</span>));<span class="comment">//获取后缀名</span></span><br><span class="line">            <span class="type">SimpleDateFormat</span> <span class="variable">sf</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">SimpleDateFormat</span>(<span class="string">&quot;yyyyMMddHHmmssSSS&quot;</span>);</span><br><span class="line">            filename = sf.format(<span class="keyword">new</span> <span class="title class_">Date</span>());</span><br><span class="line">            <span class="comment">//3.获取文件输出流，写文件到本地</span></span><br><span class="line">            fos = <span class="keyword">new</span> <span class="title class_">FileOutputStream</span>(dir + filename + ext);<span class="comment">//文件名改为：时间戳.后缀</span></span><br><span class="line">            <span class="comment">//4.接收文件内容</span></span><br><span class="line">            <span class="type">int</span> len;</span><br><span class="line">            <span class="type">byte</span>[] data = <span class="keyword">new</span> <span class="title class_">byte</span>[<span class="number">1024</span>];</span><br><span class="line">            <span class="keyword">while</span>((len=is.read(data)) != -<span class="number">1</span>)&#123;</span><br><span class="line">                fos.write(data, <span class="number">0</span>, len);</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="comment">//5.获取文件输出流，用来发送数据给该客户端</span></span><br><span class="line">            <span class="type">PrintStream</span> <span class="variable">ps</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">PrintStream</span>(socket.getOutputStream());</span><br><span class="line">            ps.println(filename + ext + <span class="string">&quot;：已上传完毕&quot;</span>);</span><br><span class="line">        &#125; <span class="keyword">catch</span> (FileNotFoundException e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125; <span class="keyword">catch</span> (IOException e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125;<span class="keyword">finally</span>&#123;</span><br><span class="line">            <span class="keyword">try</span> &#123;</span><br><span class="line">                fos.close();</span><br><span class="line">                socket.close();<span class="comment">//6.关闭socket，断开与服务器的连接</span></span><br><span class="line">            &#125; <span class="keyword">catch</span> (IOException e) &#123;</span><br><span class="line">                e.printStackTrace();</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div><div class="tab-pane" id="socket3-3"><figure class="highlight java"><figcaption><span>Client.java</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.memories.tcp.fileupload;</span><br><span class="line"><span class="keyword">import</span> java.io.BufferedReader;</span><br><span class="line"><span class="keyword">import</span> java.io.DataOutputStream;</span><br><span class="line"><span class="keyword">import</span> java.io.File;</span><br><span class="line"><span class="keyword">import</span> java.io.FileInputStream;</span><br><span class="line"><span class="keyword">import</span> java.io.InputStream;</span><br><span class="line"><span class="keyword">import</span> java.io.InputStreamReader;</span><br><span class="line"><span class="keyword">import</span> java.io.OutputStream;</span><br><span class="line"><span class="keyword">import</span> java.net.Socket;</span><br><span class="line"><span class="keyword">import</span> java.util.Scanner;</span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Client</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> Exception &#123;</span><br><span class="line">        <span class="comment">//1.准备Socket，连接服务器，需要指定服务器的IP地址和端口号</span></span><br><span class="line">        <span class="type">Socket</span> <span class="variable">socket</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Socket</span>(<span class="string">&quot;192.168.34.53&quot;</span>, <span class="number">8888</span>);</span><br><span class="line">        <span class="comment">//2.从键盘输入文件的路径和名称</span></span><br><span class="line">        <span class="type">Scanner</span> <span class="variable">input</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Scanner</span>(System.in);</span><br><span class="line">        System.out.print(<span class="string">&quot;请选择要上传的文件：&quot;</span>);</span><br><span class="line">        <span class="type">String</span> <span class="variable">path</span> <span class="operator">=</span> input.nextLine();</span><br><span class="line">        <span class="type">File</span> <span class="variable">file</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">File</span>(path);</span><br><span class="line">        <span class="comment">//3.获取输出流，用来发送数据给服务器（DataOutputStream可发字符，也可发字节）</span></span><br><span class="line">        <span class="type">DataOutputStream</span> <span class="variable">dos</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">DataOutputStream</span>(socket.getOutputStream());</span><br><span class="line">        dos.writeUTF(file.getName());<span class="comment">//先发送文件全名</span></span><br><span class="line">        <span class="comment">//4.获取文件输入流，读取本地文件</span></span><br><span class="line">        <span class="type">FileInputStream</span> <span class="variable">fis</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">FileInputStream</span>(file);</span><br><span class="line">        <span class="type">int</span> len</span><br><span class="line">        <span class="type">byte</span>[] data = <span class="keyword">new</span> <span class="title class_">byte</span>[<span class="number">1024</span>];</span><br><span class="line">        <span class="keyword">while</span>((len=fis.read(data)) != -<span class="number">1</span>)&#123;</span><br><span class="line">                fos.write(data, <span class="number">0</span>, len);</span><br><span class="line">            &#125;</span><br><span class="line">        socket.shutdownOutput();</span><br><span class="line">        <span class="comment">//5.获取输入流，接收服务器返回的结果</span></span><br><span class="line">        <span class="type">BufferedReader</span> <span class="variable">br</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">BufferedReader</span>(<span class="keyword">new</span> <span class="title class_">InputStreamReader</span>(socket.getInputStream()));</span><br><span class="line">        <span class="type">String</span> <span class="variable">result</span> <span class="operator">=</span> br.readLine();</span><br><span class="line">        System.out.println(result);</span><br><span class="line">        <span class="comment">//6.关闭socket，断开与服务器的连接</span></span><br><span class="line">        fis.close();</span><br><span class="line">        input.close();</span><br><span class="line">        socket.close();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div></div></div>
<p>需求：模拟聊天室群聊。客户端要先登录，登录成功之后才能发送和接收消息。<br />
1.服务端，需要为每个客户端开启一个线程通信，这样才能实现多个客户端“同时”与服务器通信。<br />
2.客户端，需要把收消息功能与发消息功能分开两个线程，这样才能“同时收发”，即可以发消息，也可以接收其他客户端的聊天消息。<br />
3.服务端，要分别处理客户端的“登录”、“退出”、“聊天”的消息，所以设计了Code常量类，用状态值区分“登录”、“退出”、“聊天”。<br />
4.设计Message类，用来传输信息，属性包含code记录“登录”、“退出”、“聊天”状态，username用户名，content存储消息内容，如果是登录，就用来存储密码。<br />
5.客户端与服务器之间传输的是Message实例，所以选择ObjectOutputStream和ObjectInputStream。<br />
6.Message类与Code类是服务器端和客户端“共享”的，要保持一致。特别注意包名和序列化版本ID。<br />
<div class="tabs" id="socket4"><ul class="nav-tabs"><li class="tab active"><a href="#socket4-1">定义常量</a></li><li class="tab"><a href="#socket4-2">定义消息类</a></li><li class="tab"><a href="#socket4-3">主服务端</a></li><li class="tab"><a href="#socket4-4">服务端-用户管理类</a></li><li class="tab"><a href="#socket4-5">服务端-通信线程</a></li><li class="tab"><a href="#socket4-6">主客户端</a></li><li class="tab"><a href="#socket4-7">客户端-发送</a></li><li class="tab"><a href="#socket4-8">客户端-接收</a></li></ul><div class="tab-content"><div class="tab-pane active" id="socket4-1"><figure class="highlight java"><figcaption><span>Code.java</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.memories.tcp.chat.bean;</span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Code</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">int</span> <span class="variable">LOGIN</span> <span class="operator">=</span> <span class="number">1</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">int</span> <span class="variable">CHAT</span> <span class="operator">=</span> <span class="number">2</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">int</span> <span class="variable">LOGOUT</span> <span class="operator">=</span> <span class="number">3</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">int</span> <span class="variable">SUCCESS</span> <span class="operator">=</span> <span class="number">1</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">int</span> <span class="variable">FAIL</span> <span class="operator">=</span> <span class="number">2</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div><div class="tab-pane" id="socket4-2"><figure class="highlight java"><figcaption><span>Message.java</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.memories.tcp.chat.bean;</span><br><span class="line"><span class="keyword">import</span> java.io.Serializable;</span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Message</span> <span class="keyword">implements</span> <span class="title class_">Serializable</span>&#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">long</span> <span class="variable">serialVersionUID</span> <span class="operator">=</span> <span class="number">1L</span>;</span><br><span class="line">    <span class="keyword">private</span> <span class="type">int</span> code;</span><br><span class="line">    <span class="keyword">private</span> String username;</span><br><span class="line">    <span class="keyword">private</span> String content;</span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">Message</span><span class="params">(<span class="type">int</span> code, String username, String content)</span> &#123;</span><br><span class="line">        <span class="built_in">super</span>();</span><br><span class="line">        <span class="built_in">this</span>.code = code;</span><br><span class="line">        <span class="built_in">this</span>.username = username;</span><br><span class="line">        <span class="built_in">this</span>.content = content;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">Message</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="built_in">super</span>();</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="type">int</span> <span class="title function_">getCode</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> code;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setCode</span><span class="params">(<span class="type">int</span> code)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.code = code;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">getUsername</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> username;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setUsername</span><span class="params">(String username)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.username = username;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">getContent</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> content;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setContent</span><span class="params">(String content)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.content = content;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div><div class="tab-pane" id="socket4-3"><figure class="highlight java"><figcaption><span>Server.java</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.memories.tcp.chat.server;</span><br><span class="line"><span class="keyword">import</span> java.net.ServerSocket;</span><br><span class="line"><span class="keyword">import</span> java.net.Socket;</span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Server</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span><span class="keyword">throws</span> Exception &#123;</span><br><span class="line">        <span class="type">ServerSocket</span> <span class="variable">server</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ServerSocket</span>(<span class="number">9999</span>);</span><br><span class="line">        <span class="keyword">while</span>(<span class="literal">true</span>)&#123;</span><br><span class="line">            <span class="type">Socket</span> <span class="variable">socket</span> <span class="operator">=</span> server.accept();</span><br><span class="line">            <span class="type">ClientHandlerThread</span> <span class="variable">ct</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ClientHandlerThread</span>(socket);</span><br><span class="line">            ct.start();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div><div class="tab-pane" id="socket4-4"><figure class="highlight java"><figcaption><span>UserManager.java</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.memories.tcp.chat.server;</span><br><span class="line"><span class="keyword">import</span> java.util.HashMap;</span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">UserManager</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> HashMap&lt;String,String&gt; allUsers = <span class="keyword">new</span> <span class="title class_">HashMap</span>&lt;String,String&gt;();</span><br><span class="line">    <span class="keyword">static</span>&#123;</span><br><span class="line">        allUsers.put(<span class="string">&quot;gangge&quot;</span>, <span class="string">&quot;123&quot;</span>);</span><br><span class="line">        allUsers.put(<span class="string">&quot;xiaobai&quot;</span>, <span class="string">&quot;456&quot;</span>);</span><br><span class="line">        allUsers.put(<span class="string">&quot;gujie&quot;</span>, <span class="string">&quot;789&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">//登录验证</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="type">boolean</span> <span class="title function_">login</span><span class="params">(String username, String password)</span>&#123;</span><br><span class="line">        <span class="keyword">if</span>(allUsers.get(username)!=<span class="literal">null</span> &amp;&amp; allUsers.get(username).equals(password))&#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">        &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div><div class="tab-pane" id="socket4-5"><figure class="highlight java"><figcaption><span>ClientHandlerThread.java</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.memories.tcp.chat.server;</span><br><span class="line"><span class="keyword">import</span> com.memories.tcp.chat.bean.Code;</span><br><span class="line"><span class="keyword">import</span> com.memories.tcp.chat.bean.Message;</span><br><span class="line"><span class="keyword">import</span> java.io.IOException;</span><br><span class="line"><span class="keyword">import</span> java.io.ObjectInputStream;</span><br><span class="line"><span class="keyword">import</span> java.io.ObjectOutputStream;</span><br><span class="line"><span class="keyword">import</span> java.net.Socket;</span><br><span class="line"><span class="keyword">import</span> java.util.ArrayList;</span><br><span class="line"><span class="keyword">import</span> java.util.Collections;</span><br><span class="line"><span class="keyword">import</span> java.util.HashSet;</span><br><span class="line"><span class="keyword">import</span> java.util.Set;</span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">ClientHandlerThread</span> <span class="keyword">extends</span> <span class="title class_">Thread</span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> Set&lt;ObjectOutputStream&gt; online = Collections.synchronizedSet(<span class="keyword">new</span> <span class="title class_">HashSet</span>&lt;ObjectOutputStream&gt;());</span><br><span class="line">    <span class="keyword">private</span> Socket socket;</span><br><span class="line">    <span class="keyword">private</span> String username;</span><br><span class="line">    <span class="keyword">private</span> ObjectInputStream ois;</span><br><span class="line">    <span class="keyword">private</span> ObjectOutputStream oos;</span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">ClientHandlerThread</span><span class="params">(Socket socket)</span> &#123;</span><br><span class="line">        <span class="built_in">super</span>();</span><br><span class="line">        <span class="built_in">this</span>.socket = socket;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">run</span><span class="params">()</span>&#123;</span><br><span class="line">        <span class="type">Message</span> <span class="variable">message</span> <span class="operator">=</span> <span class="literal">null</span>;</span><br><span class="line">        <span class="keyword">try</span>&#123;</span><br><span class="line">            ois = <span class="keyword">new</span> <span class="title class_">ObjectInputStream</span>(socket.getInputStream());</span><br><span class="line">            oos = <span class="keyword">new</span> <span class="title class_">ObjectOutputStream</span>(socket.getOutputStream());</span><br><span class="line">            <span class="comment">//根据状态确定做什么</span></span><br><span class="line">            <span class="keyword">while</span> (<span class="literal">true</span>) &#123;</span><br><span class="line">                message = (Message) ois.readObject();</span><br><span class="line">                <span class="comment">//1.如果是登录，则验证用户名密码</span></span><br><span class="line">                <span class="keyword">if</span>(message.getCode() == Code.LOGIN)&#123;</span><br><span class="line">                    username = message.getUsername();</span><br><span class="line">                    <span class="type">String</span> <span class="variable">password</span> <span class="operator">=</span> message.getContent();</span><br><span class="line">                    <span class="keyword">if</span>(UserManager.login(username, password))&#123;</span><br><span class="line">                        message.setCode(Code.SUCCESS);</span><br><span class="line">                        oos.writeObject(message);</span><br><span class="line">                        <span class="comment">//并将该用户添加到在线人员名单中</span></span><br><span class="line">                        online.add(oos);</span><br><span class="line">                        message.setCode(Code.CHAT);</span><br><span class="line">                        message.setContent(<span class="string">&quot;上线了&quot;</span>);</span><br><span class="line">                        <span class="comment">//通知其他人，xx上线了</span></span><br><span class="line">                        sendToOther(message);</span><br><span class="line">                    &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">                        message.setCode(Code.FAIL);</span><br><span class="line">                        oos.writeObject(message);</span><br><span class="line">                    &#125;</span><br><span class="line">                <span class="comment">//2.如果是聊天信息，把消息转发给其他在线客户端</span></span><br><span class="line">                &#125;<span class="keyword">else</span> <span class="keyword">if</span>(message.getCode() == Code.CHAT)&#123;</span><br><span class="line">                    sendToOther(message);</span><br><span class="line">                <span class="comment">//3.如果是登出，通知其他人，xx下线了</span></span><br><span class="line">                &#125;<span class="keyword">else</span> <span class="keyword">if</span>(message.getCode() == Code.LOGOUT)&#123;</span><br><span class="line">                    message.setContent(<span class="string">&quot;下线了&quot;</span>);</span><br><span class="line">                    sendToOther(message);</span><br><span class="line">                    <span class="keyword">break</span>;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;<span class="keyword">catch</span>(Exception  e)&#123; <span class="comment">//掉线情况，通知其他人，xx掉线了</span></span><br><span class="line">            <span class="keyword">if</span>(message!=<span class="literal">null</span> &amp;&amp; username!=<span class="literal">null</span>)&#123;</span><br><span class="line">                message.setCode(Code.LOGOUT);</span><br><span class="line">                message.setContent(<span class="string">&quot;掉线了&quot;</span>);</span><br><span class="line">                sendToOther(message);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;<span class="keyword">finally</span>&#123;<span class="comment">//不管退出、掉线，最后都从在线人员中移除+断开当前客户端</span></span><br><span class="line">            <span class="keyword">try</span> &#123;</span><br><span class="line">                online.remove(oos);</span><br><span class="line">                socket.close();</span><br><span class="line">            &#125; <span class="keyword">catch</span> (IOException e) &#123;</span><br><span class="line">                e.printStackTrace();</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">void</span> <span class="title function_">sendToOther</span><span class="params">(Message message)</span> &#123;</span><br><span class="line">        ArrayList&lt;ObjectOutputStream&gt; offline = <span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;ObjectOutputStream&gt;();</span><br><span class="line">        <span class="keyword">for</span> (ObjectOutputStream on : online) &#123;</span><br><span class="line">            <span class="keyword">if</span>(!on.equals(oos))&#123;<span class="comment">//只给其他客户端转发</span></span><br><span class="line">                <span class="keyword">try</span> &#123;</span><br><span class="line">                    on.writeObject(message);</span><br><span class="line">                &#125; <span class="keyword">catch</span> (IOException e) &#123;<span class="comment">//说明on这个客户端要么下线了，要么掉线了</span></span><br><span class="line">                    offline.add(on);</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">//把下线人员从在线人员中删除</span></span><br><span class="line">        <span class="keyword">for</span> (ObjectOutputStream off : offline) &#123;</span><br><span class="line">            online.remove(off);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// //遍历所有online的客户端</span></span><br><span class="line">        <span class="comment">// Iterator&lt;ObjectOutputStream&gt; iterator = online.iterator();</span></span><br><span class="line">        <span class="comment">// while(iterator.hasNext())&#123;</span></span><br><span class="line">        <span class="comment">//     ObjectOutputStream on = iterator.next();</span></span><br><span class="line">        <span class="comment">//     if(!on.equals(oos))&#123;//只给其他客户端转发</span></span><br><span class="line">        <span class="comment">//         try &#123;</span></span><br><span class="line">        <span class="comment">//             on.writeObject(message);</span></span><br><span class="line">        <span class="comment">//         &#125; catch (IOException e) &#123;</span></span><br><span class="line">        <span class="comment">//             //说明on这个客户端要么下线了，要么掉线了</span></span><br><span class="line">        <span class="comment">//             //把下线人员从在线人员中删除</span></span><br><span class="line">        <span class="comment">//             iterator.remove();</span></span><br><span class="line">        <span class="comment">//         &#125;</span></span><br><span class="line">        <span class="comment">//     &#125;</span></span><br><span class="line">        <span class="comment">// &#125;</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div><div class="tab-pane" id="socket4-6"><figure class="highlight java"><figcaption><span>Client.java</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.memories.tcp.chat.client;</span><br><span class="line"><span class="keyword">import</span> com.memories.tcp.chat.bean.Code;</span><br><span class="line"><span class="keyword">import</span> com.memories.tcp.chat.bean.Message;</span><br><span class="line"><span class="keyword">import</span> java.io.ObjectInputStream;</span><br><span class="line"><span class="keyword">import</span> java.io.ObjectOutputStream;</span><br><span class="line"><span class="keyword">import</span> java.net.Socket;</span><br><span class="line"><span class="keyword">import</span> java.util.Scanner;</span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Client</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> Exception&#123;</span><br><span class="line">        <span class="type">Socket</span> <span class="variable">socket</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Socket</span>(<span class="string">&quot;192.168.1.107&quot;</span>, <span class="number">9999</span>);</span><br><span class="line">        <span class="type">ObjectOutputStream</span> <span class="variable">oos</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ObjectOutputStream</span>(socket.getOutputStream());</span><br><span class="line">        <span class="type">ObjectInputStream</span> <span class="variable">ois</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ObjectInputStream</span>(socket.getInputStream());</span><br><span class="line">        <span class="comment">//先登录</span></span><br><span class="line">        <span class="type">Scanner</span> <span class="variable">scanner</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Scanner</span>(System.in);</span><br><span class="line">        String username;</span><br><span class="line">        <span class="keyword">while</span>(<span class="literal">true</span>)&#123;</span><br><span class="line">            <span class="comment">//输入登录信息</span></span><br><span class="line">            System.out.println(<span class="string">&quot;用户名：&quot;</span>);</span><br><span class="line">            username = scanner.nextLine();</span><br><span class="line">            System.out.println(<span class="string">&quot;密码：&quot;</span>);</span><br><span class="line">            <span class="type">String</span> <span class="variable">password</span> <span class="operator">=</span> scanner.nextLine();</span><br><span class="line">            <span class="type">Message</span> <span class="variable">msg</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Message</span>(Code.LOGIN, username, password);</span><br><span class="line">            <span class="comment">//发送登录数据</span></span><br><span class="line">            oos.writeObject(msg);</span><br><span class="line">            <span class="comment">//接收登录结果</span></span><br><span class="line">            msg = (Message) ois.readObject();</span><br><span class="line">            <span class="keyword">if</span>(msg.getCode() == Code.SUCCESS)&#123;</span><br><span class="line">                System.out.println(<span class="string">&quot;登录成功！&quot;</span>);</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">            &#125;<span class="keyword">else</span> <span class="keyword">if</span>(msg.getCode() == Code.FAIL)&#123;</span><br><span class="line">                System.out.println(<span class="string">&quot;用户名或密码错误，登录失败，重新输入&quot;</span>);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">//启动收消息和发消息线程</span></span><br><span class="line">        <span class="type">SendThread</span> <span class="variable">s</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">SendThread</span>(oos,username);</span><br><span class="line">        <span class="type">ReceiveThread</span> <span class="variable">r</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ReceiveThread</span>(ois);</span><br><span class="line">        s.start();</span><br><span class="line">        r.start();</span><br><span class="line"></span><br><span class="line">        s.join();<span class="comment">//等待s线程终止</span></span><br><span class="line">        r.setFlag(<span class="literal">false</span>);<span class="comment">//s终止，r也终止</span></span><br><span class="line">        r.join();<span class="comment">//等待r线程终止</span></span><br><span class="line">        </span><br><span class="line">        scanner.close();</span><br><span class="line">        socket.close();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div><div class="tab-pane" id="socket4-7"><figure class="highlight java"><figcaption><span>SendThread.java</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.memories.tcp.chat.client;</span><br><span class="line"><span class="keyword">import</span> com.memories.tcp.chat.bean.Code;</span><br><span class="line"><span class="keyword">import</span> com.memories.tcp.chat.bean.Message;</span><br><span class="line"><span class="keyword">import</span> java.io.IOException;</span><br><span class="line"><span class="keyword">import</span> java.io.ObjectOutputStream;</span><br><span class="line"><span class="keyword">import</span> java.util.Scanner;</span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">SendThread</span> <span class="keyword">extends</span> <span class="title class_">Thread</span>&#123;</span><br><span class="line">    <span class="keyword">private</span> ObjectOutputStream oos;</span><br><span class="line">    <span class="keyword">private</span> String username;</span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">SendThread</span><span class="params">(ObjectOutputStream oos,String username)</span> &#123;</span><br><span class="line">        <span class="built_in">super</span>();</span><br><span class="line">        <span class="built_in">this</span>.oos = oos;</span><br><span class="line">        <span class="built_in">this</span>.username = username;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">run</span><span class="params">()</span>&#123;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="type">Scanner</span> <span class="variable">scanner</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Scanner</span>(System.in);</span><br><span class="line">            <span class="keyword">while</span>(<span class="literal">true</span>)&#123;</span><br><span class="line">                System.out.println(<span class="string">&quot;请输入消息内容：&quot;</span>);</span><br><span class="line">                <span class="type">String</span> <span class="variable">content</span> <span class="operator">=</span> scanner.nextLine();</span><br><span class="line">                Message msg;</span><br><span class="line">                <span class="keyword">if</span>(<span class="string">&quot;bye&quot;</span>.equals(content))&#123;</span><br><span class="line">                    msg = <span class="keyword">new</span> <span class="title class_">Message</span>(Code.LOGOUT, username, content);</span><br><span class="line">                    oos.writeObject(msg);</span><br><span class="line">                    scanner.close();</span><br><span class="line">                    <span class="keyword">break</span>;</span><br><span class="line">                &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">                    msg = <span class="keyword">new</span> <span class="title class_">Message</span>(Code.CHAT, username, content);</span><br><span class="line">                    oos.writeObject(msg);</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125; <span class="keyword">catch</span> (IOException e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div><div class="tab-pane" id="socket4-8"><figure class="highlight java"><figcaption><span>ReceiveThread.java</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.memories.tcp.chat.client;</span><br><span class="line"><span class="keyword">import</span> com.memories.tcp.chat.bean.Message;</span><br><span class="line"><span class="keyword">import</span> java.io.ObjectInputStream;</span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">ReceiveThread</span> <span class="keyword">extends</span> <span class="title class_">Thread</span>&#123;</span><br><span class="line">    <span class="keyword">private</span> ObjectInputStream ois;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">volatile</span> <span class="type">boolean</span> <span class="variable">flag</span> <span class="operator">=</span> <span class="literal">true</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">ReceiveThread</span><span class="params">(ObjectInputStream ois)</span> &#123;</span><br><span class="line">        <span class="built_in">super</span>();</span><br><span class="line">        <span class="built_in">this</span>.ois = ois;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">run</span><span class="params">()</span>&#123;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="keyword">while</span>(flag)&#123;</span><br><span class="line">                <span class="type">Message</span> <span class="variable">msg</span> <span class="operator">=</span> (Message) ois.readObject();</span><br><span class="line">                System.out.println(msg.getUsername() + <span class="string">&quot;:&quot;</span> + msg.getContent());</span><br><span class="line">            &#125;</span><br><span class="line">        &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">            System.out.println(<span class="string">&quot;请重新登录&quot;</span>);</span><br><span class="line">        &#125; </span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setFlag</span><span class="params">(<span class="type">boolean</span> flag)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.flag = flag;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div></div></div></p>
<h5 id="基于udp协议">基于UDP协议</h5>
<p><strong>UDP</strong>（User Datagram
Protocol）：用户数据报协议，是<strong>无连接</strong>的传输层协议、提供面向事务的简单<strong>不可靠</strong>的信息传送服务，类似于短信。</p>
<p>UDP协议是一种<strong>面向非连接</strong>的协议，在正式通信前不必与对方先建立连接，不管对方状态就直接发送，至于对方是否可以接收到这些数据内容，UDP协议无法控制，因此说，UDP协议是一种<strong>不可靠</strong>的协议。无连接的好处就是快，省内存空间和流量，因为维护连接需要创建大量的数据结构。UDP会尽最大努力交付数据，但不保证可靠交付，没有TCP的确认机制、重传机制，如果因为网络原因没有传送到对端，UDP也不会给应用层返回错误信息。</p>
<p><strong>UDP在发送端无缓冲区</strong>，报文不会进行合并，也不会进行拆分，而是一次交付一个完整的报文。比如我们要发送100个字节的报文，我们调用一次send()方法就会发送100字节，接收方也需要用receive()方法一次性接收100字节，不能使用循环每次获取10个字节，获取十次这样的做法。</p>
<p><strong>UDP在接收端有缓冲区</strong>，但是这个缓冲区只负责接收，并不会保证UDP报文的到达顺序是否和发送的顺序一致。因为由于网络拥塞可能导致先发的报文比后发的报文晚到达，此时缓冲区满了，后面到达的报文将直接被丢弃。实时应用，比如视频通话、直播等避免使用。但因为没有拥塞控制，所以当网络出现的拥塞不会导致主机发送数据的速率降低。UDP适用于一次只传送少量数据、对可靠性要求不高的应用环境，数据报大小限制在64K以下</p>
<p><strong>基于UDP协议的网络编程</strong>：仍然需要在通信实例的两端各建立一个Socket，但这两个Socket之间并没有虚拟链路，这两个Socket只是发送、接收数据报的对象，Java使用DatagramPacket代表DatagramSocket发送、接收的数据报，DatagramSocket作为基于UDP协议的Socket。<br />
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//Datagram只允许数据报发送给指定的目标地址，不能多点广播</span></span><br><span class="line">|-DatagramPacket：</span><br><span class="line">    |-DatagramPacket(<span class="type">byte</span>[] buf,<span class="type">int</span> length)：构造数据报包，用来<span class="string">&quot;接收&quot;</span>长度为length的数据包。</span><br><span class="line">        |-length参数必须&lt;=buf.length。</span><br><span class="line">    |-DatagramPacket(<span class="type">byte</span>[] buf,<span class="type">int</span> length,InetAddress address,<span class="type">int</span> port)：构造数据报包，将length长的包<span class="string">&quot;发送&quot;</span>到指定主机和端口。</span><br><span class="line">        |-length参数必须&lt;=buf.length。</span><br><span class="line">    |-<span class="type">int</span> <span class="title function_">getLength</span><span class="params">()</span>：返回将要发送或接收到的数据的长度。 </span><br><span class="line">|-DatagramSocket：</span><br><span class="line">    |-DatagramSocket(<span class="type">int</span> port)：创建数据报套接字并将其绑定到本地主机上的指定端口。套接字将被绑定到通配符地址，IP地址由内核来选择。</span><br><span class="line">    |-DatagramSocket(<span class="type">int</span> port, InetAddress laddr)：创建数据报套接字，将其绑定到指定的本地地址。</span><br><span class="line">        |-本地端口必须在[<span class="number">0</span>,<span class="number">65535</span>]。</span><br><span class="line">        |-如果IP地址为<span class="number">0.0</span><span class="number">.0</span><span class="number">.0</span>，套接字将被绑定到通配符地址，IP地址由内核选择。 </span><br><span class="line">    |-<span class="keyword">void</span> <span class="title function_">close</span><span class="params">()</span>：关闭此数据报套接字。</span><br><span class="line">    |-<span class="keyword">void</span> <span class="title function_">send</span><span class="params">(DatagramPacket p)</span>：从此套接字发送数据报包。</span><br><span class="line">        |-DatagramPacket包含的信息指示：将要发送的数据、其长度、远程主机的 IP 地址和远程主机的端口号。 </span><br><span class="line">    |-<span class="keyword">void</span> <span class="title function_">receive</span><span class="params">(DatagramPacket p)</span>：从此套接字接收数据报包。DatagramPacket的缓冲区填充了接收的数据。</span><br><span class="line">        |-数据报包也包含发送方的 IP 地址和发送方机器上的端口号。 </span><br><span class="line">        |-此方法在接收到数据报前一直阻塞。</span><br><span class="line">        |-数据报包对象的length字段包含所接收信息的长度，如果信息比包的长度长，该信息将被截短。 </span><br></pre></td></tr></table></figure></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">|-发送端：</span><br><span class="line">    |-建立发送端DatagramSocket，需要指定本端的端口号。</span><br><span class="line">    |-建立数据包DatagramPacket，数据、接收端的IP地址、接收端的端口号。</span><br><span class="line">    |-调用DatagramSocket的发送方法。</span><br><span class="line">    |-关闭DatagramSocket。</span><br><span class="line">|-接收端：</span><br><span class="line">    |-建立接收端DatagramSocket，需要指定本端的IP地址和端口号。</span><br><span class="line">    |-建立数据包DatagramPacket，需要指定装数据的数组。</span><br><span class="line">    |-调用Socket的接收方法。</span><br><span class="line">    |-拆封数据。</span><br><span class="line">    |-关闭Socke。</span><br><span class="line">|-MulticastSocket多点广播：</span><br><span class="line">    |-IP协议为多点广播提供了这批特殊的IP地址，这些IP地址的范围是<span class="number">224.0</span><span class="number">.0</span><span class="number">.0</span>~<span class="number">239.255</span><span class="number">.255</span><span class="number">.255</span>。</span><br><span class="line">    |-MulticastSocket(<span class="type">int</span> port)：创建多播套接字，并将其绑定到特定端口。</span><br><span class="line">        |-创建一个MulticastSocket对象后，还需要将其加入到指定的多点广播地址，结束也需要脱离多点广播地址。</span><br><span class="line">    |-<span class="keyword">void</span> <span class="title function_">joinGroup</span><span class="params">(InetAddress mcastaddr)</span>：加入多播组。 </span><br><span class="line">    |-<span class="keyword">void</span> <span class="title function_">leaveGroup</span><span class="params">(InetAddress mcastaddr)</span>：离开多播组。 </span><br><span class="line">    |-<span class="keyword">void</span> <span class="title function_">setLoopbackMode</span><span class="params">(<span class="type">boolean</span> disable)</span>：<span class="literal">false</span>启用/<span class="literal">true</span>禁用多播数据报的本地回送。</span><br></pre></td></tr></table></figure>
<div class="tabs" id="udp"><ul class="nav-tabs"><li class="tab active"><a href="#udp-1">发送端</a></li><li class="tab"><a href="#udp-2">接收端</a></li><li class="tab"><a href="#udp-3">多点广播</a></li></ul><div class="tab-content"><div class="tab-pane active" id="udp-1"><figure class="highlight java"><figcaption><span>Send.java</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.memories.udp;</span><br><span class="line"><span class="keyword">import</span> java.net.DatagramPacket;</span><br><span class="line"><span class="keyword">import</span> java.net.DatagramSocket;</span><br><span class="line"><span class="keyword">import</span> java.net.InetAddress;</span><br><span class="line"><span class="keyword">import</span> java.util.ArrayList;</span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Send</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span><span class="keyword">throws</span> Exception &#123;</span><br><span class="line">        <span class="comment">//1.建立发送端的DatagramSocket</span></span><br><span class="line">        <span class="type">DatagramSocket</span> <span class="variable">ds</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">DatagramSocket</span>();</span><br><span class="line">        ArrayList&lt;String&gt; all = <span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;String&gt;();<span class="comment">//要发送的数据</span></span><br><span class="line">        all.add(<span class="string">&quot;hello&quot;</span>);</span><br><span class="line">        all.add(<span class="string">&quot;world&quot;</span>);</span><br><span class="line">        <span class="type">InetAddress</span> <span class="variable">ip</span> <span class="operator">=</span> InetAddress.getByName(<span class="string">&quot;127.0.0.1&quot;</span>);<span class="comment">//接收方的IP地址</span></span><br><span class="line">        <span class="type">int</span> <span class="variable">port</span> <span class="operator">=</span> <span class="number">9999</span>;<span class="comment">//接收方的监听端口号</span></span><br><span class="line">        <span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">0</span>; i&lt;all.size(); i++) &#123;<span class="comment">//发送数据报</span></span><br><span class="line">            <span class="comment">//2.建立数据包DatagramPacket</span></span><br><span class="line">            <span class="type">byte</span>[] data = all.get(i).getBytes();</span><br><span class="line">            <span class="type">DatagramPacket</span> <span class="variable">dp</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">DatagramPacket</span>(data, data.length, ip, port);</span><br><span class="line">            <span class="comment">//3.调用Socket的发送方法</span></span><br><span class="line">            ds.send(dp);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">//4.关闭Socket</span></span><br><span class="line">        ds.close();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div><div class="tab-pane" id="udp-2"><figure class="highlight java"><figcaption><span>Receive.java</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.memories.udp;</span><br><span class="line"><span class="keyword">import</span> java.net.DatagramPacket;</span><br><span class="line"><span class="keyword">import</span> java.net.DatagramSocket;</span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Receive</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> Exception &#123;</span><br><span class="line">        <span class="comment">//1.建立接收端的DatagramSocket，需要指定本端的监听端口号</span></span><br><span class="line">        <span class="type">DatagramSocket</span> <span class="variable">ds</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">DatagramSocket</span>(<span class="number">9999</span>);</span><br><span class="line">        <span class="keyword">while</span>(<span class="literal">true</span>)&#123; <span class="comment">//一直监听数据</span></span><br><span class="line">            <span class="comment">//2.建立数据包DatagramPacket</span></span><br><span class="line">            <span class="type">byte</span>[] buffer = <span class="keyword">new</span> <span class="title class_">byte</span>[<span class="number">1024</span>*<span class="number">64</span>];</span><br><span class="line">            <span class="type">DatagramPacket</span> <span class="variable">dp</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">DatagramPacket</span>(buffer, buffer.length);</span><br><span class="line">            <span class="comment">//3.调用Socket的接收方法</span></span><br><span class="line">            ds.receive(dp);</span><br><span class="line">            <span class="comment">//4.拆封数据</span></span><br><span class="line">            <span class="type">String</span> <span class="variable">str</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">String</span>(buffer, <span class="number">0</span>, dp.getLength());</span><br><span class="line">            System.out.println(str);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div><div class="tab-pane" id="udp-3"><figure class="highlight java"><figcaption><span>Chat.java</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.memories.udp.multi;</span><br><span class="line"><span class="keyword">import</span> java.util.Scanner;</span><br><span class="line"><span class="keyword">import</span> java.io.IOException;</span><br><span class="line"><span class="keyword">import</span> java.net.DatagramPacket;</span><br><span class="line"><span class="keyword">import</span> java.net.InetAddress;</span><br><span class="line"><span class="keyword">import</span> java.net.MulticastSocket;</span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Chat</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">volatile</span> <span class="keyword">static</span> <span class="type">boolean</span> <span class="variable">exit</span> <span class="operator">=</span> <span class="literal">false</span>;<span class="comment">//volatile同步</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="type">Scanner</span> <span class="variable">input</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Scanner</span>(System.in);</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> String username;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> IOException &#123;</span><br><span class="line">        <span class="type">MulticastSocket</span> <span class="variable">socket</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">MulticastSocket</span>(<span class="number">9999</span>);</span><br><span class="line">        <span class="type">InetAddress</span> <span class="variable">ip</span> <span class="operator">=</span> InetAddress.getByName(<span class="string">&quot;230.0.0.1&quot;</span>);</span><br><span class="line">        socket.joinGroup(ip);<span class="comment">//设定ip</span></span><br><span class="line">        socket.setLoopbackMode(<span class="literal">false</span>);<span class="comment">//启用本地回送</span></span><br><span class="line">        System.out.print(<span class="string">&quot;请输入用户名：&quot;</span>);</span><br><span class="line">        username = input.nextLine();<span class="comment">//设定用户</span></span><br><span class="line">        <span class="type">SendThread</span> <span class="variable">s</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">SendThread</span>(socket, ip);<span class="comment">//发送</span></span><br><span class="line">        <span class="type">ReceiveThread</span> <span class="variable">r</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ReceiveThread</span>(socket);<span class="comment">//接收</span></span><br><span class="line">        s.start();</span><br><span class="line">        r.start();</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            s.join();</span><br><span class="line">        &#125; <span class="keyword">catch</span> (InterruptedException e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125;</span><br><span class="line">        socket.close();</span><br><span class="line">        input.close();</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">static</span> <span class="keyword">class</span> <span class="title class_">SendThread</span> <span class="keyword">extends</span> <span class="title class_">Thread</span>&#123;<span class="comment">//静态内部类</span></span><br><span class="line">        <span class="keyword">private</span> MulticastSocket socket;</span><br><span class="line">        <span class="keyword">private</span> InetAddress ip;</span><br><span class="line">        <span class="keyword">public</span> <span class="title function_">SendThread</span><span class="params">(MulticastSocket socket, InetAddress ip)</span> &#123;</span><br><span class="line">            <span class="built_in">super</span>();</span><br><span class="line">            <span class="built_in">this</span>.socket = socket;</span><br><span class="line">            <span class="built_in">this</span>.ip = ip;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">run</span><span class="params">()</span>&#123;</span><br><span class="line">            <span class="keyword">try</span> &#123;</span><br><span class="line">                <span class="keyword">while</span>(!exit)&#123;</span><br><span class="line">                    System.out.print(<span class="string">&quot;输入广播消息：&quot;</span>);</span><br><span class="line">                    <span class="type">String</span> <span class="variable">message</span> <span class="operator">=</span> input.nextLine();</span><br><span class="line">                    <span class="keyword">if</span> (<span class="string">&quot;bye&quot;</span>.equals(message)) &#123;</span><br><span class="line">                        exit = <span class="literal">true</span>;</span><br><span class="line">                        <span class="keyword">break</span>;</span><br><span class="line">                    &#125;</span><br><span class="line">                    <span class="type">byte</span>[] data = (username+<span class="string">&quot;:&quot;</span>+message).getBytes();</span><br><span class="line">                    <span class="type">DatagramPacket</span> <span class="variable">dp</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">DatagramPacket</span>(data, data.length, ip, <span class="number">9999</span>);</span><br><span class="line">                    socket.send(dp);<span class="comment">//发送</span></span><br><span class="line">                &#125;</span><br><span class="line">            &#125; <span class="keyword">catch</span> (IOException e) &#123;</span><br><span class="line">                e.printStackTrace();</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">static</span> <span class="keyword">class</span> <span class="title class_">ReceiveThread</span> <span class="keyword">extends</span> <span class="title class_">Thread</span>&#123;</span><br><span class="line">        <span class="keyword">private</span> MulticastSocket socket;</span><br><span class="line">        <span class="keyword">public</span> <span class="title function_">ReceiveThread</span><span class="params">(MulticastSocket socket)</span> &#123;</span><br><span class="line">            <span class="built_in">super</span>();</span><br><span class="line">            <span class="built_in">this</span>.socket = socket;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">run</span><span class="params">()</span>&#123;</span><br><span class="line">            <span class="keyword">try</span> &#123;</span><br><span class="line">                <span class="keyword">while</span> (!exit) &#123;</span><br><span class="line">                    <span class="type">byte</span>[] data = <span class="keyword">new</span> <span class="title class_">byte</span>[<span class="number">1024</span>];</span><br><span class="line">                    <span class="type">DatagramPacket</span> <span class="variable">dp</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">DatagramPacket</span>(data, data.length);</span><br><span class="line">                    socket.receive(dp);<span class="comment">//接收</span></span><br><span class="line">                    <span class="type">String</span> <span class="variable">str</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">String</span>(data, <span class="number">0</span>, dp.getLength());</span><br><span class="line">                    System.out.println(str);</span><br><span class="line">                &#125;</span><br><span class="line">            &#125; <span class="keyword">catch</span> (IOException e) &#123;</span><br><span class="line">                exit = <span class="literal">false</span>;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div></div></div>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




  <nav class="pagination">
    <a class="extend prev" rel="prev" title="上一页" aria-label="上一页" href="/page/7/"><i class="fa fa-angle-left"></i></a><a class="page-number" href="/">1</a><span class="space">&hellip;</span><a class="page-number" href="/page/7/">7</a><span class="page-number current">8</span><a class="page-number" href="/page/9/">9</a><span class="space">&hellip;</span><a class="page-number" href="/page/13/">13</a><a class="extend next" rel="next" title="下一页" aria-label="下一页" href="/page/9/"><i class="fa fa-angle-right"></i></a>
  </nav>

</div>
  </main>

  <footer class="footer">
    <div class="footer-inner">

  <div class="copyright">
    &copy; 2019 – 
    <span itemprop="copyrightYear">2025</span>
    <span class="with-love">
      <i class="fa fa-heart"></i>
    </span>
    <span class="author" itemprop="copyrightHolder">SoundMemories</span>
  </div>
  <div class="powered-by">由 <span class="exturl" data-url="aHR0cHM6Ly9oZXhvLmlv">Hexo</span> & <span class="exturl" data-url="aHR0cHM6Ly90aGVtZS1uZXh0LmpzLm9yZy9tdXNlLw==">NexT.Muse</span> 强力驱动
  </div>

    </div>
  </footer>

  
  <div class="toggle sidebar-toggle" role="button">
    <span class="toggle-line"></span>
    <span class="toggle-line"></span>
    <span class="toggle-line"></span>
  </div>
  <div class="sidebar-dimmer"></div>
  <div class="back-to-top" role="button" aria-label="返回顶部">
    <i class="fa fa-arrow-up fa-lg"></i>
    <span>0%</span>
  </div>
  <a role="button" class="book-mark-link book-mark-link-fixed"></a>

<noscript>
  <div class="noscript-warning">Theme NexT works best with JavaScript enabled</div>
</noscript>


  
  <script src="https://cdnjs.cloudflare.com/ajax/libs/animejs/3.2.1/anime.min.js" integrity="sha256-XL2inqUJaslATFnHdJOi9GfQ60on8Wx1C2H8DYiN1xY=" crossorigin="anonymous"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/next-theme-pjax/0.6.0/pjax.min.js" integrity="sha256-vxLn1tSKWD4dqbMRyv940UYw4sXgMtYcK6reefzZrao=" crossorigin="anonymous"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.7.0/jquery.min.js" integrity="sha256-2Pmvv0kuTBOenSvLm6bvfBSSHrUJ+3A7x6P5Ebd07/g=" crossorigin="anonymous"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/fancybox/3.5.7/jquery.fancybox.min.js" integrity="sha256-yt2kYMy0w8AbtF89WXb2P1rfjcP/HTHLT7097U8Y5b8=" crossorigin="anonymous"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/medium-zoom/1.0.8/medium-zoom.min.js" integrity="sha256-7PhEpEWEW0XXQ0k6kQrPKwuoIomz8R8IYyuU1Qew4P8=" crossorigin="anonymous"></script>
<script src="/js/comments.js"></script><script src="/js/utils.js"></script><script src="/js/motion.js"></script><script src="/js/schemes/muse.js"></script><script src="/js/next-boot.js"></script><script src="/js/bookmark.js"></script><script src="/js/pjax.js"></script>

  <script src="https://cdnjs.cloudflare.com/ajax/libs/hexo-generator-searchdb/1.4.1/search.js" integrity="sha256-1kfA5uHPf65M5cphT2dvymhkuyHPQp5A53EGZOnOLmc=" crossorigin="anonymous"></script>
<script src="/js/third-party/search/local-search.js"></script>

  <script class="next-config" data-name="pdf" type="application/json">{"object_url":{"url":"https://cdnjs.cloudflare.com/ajax/libs/pdfobject/2.2.12/pdfobject.min.js","integrity":"sha256-g2xji1rlE3KsGVClvuxTbcR0Kn2+wtQADSff2Tbb4zA="},"url":"/lib/pdf/web/viewer.html"}</script>
  <script src="/js/third-party/tags/pdf.js"></script>

  <script class="next-config" data-name="mermaid" type="application/json">{"enable":true,"theme":{"light":"neutral","dark":"neutral"},"js":{"url":"https://cdnjs.cloudflare.com/ajax/libs/mermaid/10.2.3/mermaid.min.js","integrity":"sha256-JFptYy4KzJ5OQP+Q9fubNf3cxpPPmZKqUOovyEONKrQ="}}</script>
  <script src="/js/third-party/tags/mermaid.js"></script>


  <script src="/js/third-party/fancybox.js"></script>



  




  

  <script class="next-config" data-name="enableMath" type="application/json">true</script><script class="next-config" data-name="mathjax" type="application/json">{"enable":true,"tags":"none","js":{"url":"https://cdnjs.cloudflare.com/ajax/libs/mathjax/3.2.2/es5/tex-mml-chtml.js","integrity":"sha256-MASABpB4tYktI2Oitl4t+78w/lyA+D7b/s9GEP0JOGI="}}</script>
<script src="/js/third-party/math/mathjax.js"></script>


  <script src="https://cdnjs.cloudflare.com/ajax/libs/quicklink/2.3.0/quicklink.umd.js" integrity="sha256-yvJQOINiH9fWemHn0vCA5lsHWJaHs6/ZmO+1Ft04SvM=" crossorigin="anonymous"></script>
  <script class="next-config" data-name="quicklink" type="application/json">{"enable":true,"home":true,"archive":true,"delay":true,"timeout":3000,"priority":true,"url":"https://soundmemories.github.io/page/8/"}</script>
  <script src="/js/third-party/quicklink.js"></script>

</body>
</html>
