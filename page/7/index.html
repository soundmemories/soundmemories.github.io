<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width">
<meta name="theme-color" content="#222" media="(prefers-color-scheme: light)">
<meta name="theme-color" content="#222" media="(prefers-color-scheme: dark)"><meta name="generator" content="Hexo 6.3.0">

  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png">
  <link rel="mask-icon" href="/images/logo.svg" color="#222">

<link rel="stylesheet" href="/css/main.css">

<link rel="stylesheet" href="https://fonts.loli.net/css?family=Monda:300,300italic,400,400italic,700,700italic&display=swap&subset=latin,latin-ext">

<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" integrity="sha256-HtsXJanqjKTc8vVQjO4YMhiqFoXkfBsjBWcX91T1jr8=" crossorigin="anonymous">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/animate.css/3.1.1/animate.min.css" integrity="sha256-PR7ttpcvz8qrF57fur/yAx1qXMFJeJFiA6pSzWi0OIE=" crossorigin="anonymous">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/fancybox/3.5.7/jquery.fancybox.min.css" integrity="sha256-Vzbj7sDDS/woiFS3uNKo8eIuni59rjyNGtXfstRzStA=" crossorigin="anonymous">

<script class="next-config" data-name="main" type="application/json">{"hostname":"soundmemories.github.io","root":"/","images":"/images","scheme":"Muse","darkmode":true,"version":"8.17.1","exturl":true,"sidebar":{"position":"left","display":"always","padding":18,"offset":12},"copycode":{"enable":true,"style":null},"bookmark":{"enable":true,"color":"#222","save":"auto"},"mediumzoom":true,"lazyload":false,"pangu":false,"comments":{"style":"tabs","active":null,"storage":true,"lazyload":false,"nav":null},"stickytabs":false,"motion":{"enable":true,"async":false,"transition":{"menu_item":"fadeInDown","post_block":"fadeIn","post_header":"fadeInDown","post_body":"fadeInDown","coll_header":"fadeInLeft","sidebar":"fadeInUp"}},"prism":false,"i18n":{"placeholder":"搜索...","empty":"没有找到任何搜索结果：${query}","hits_time":"找到 ${hits} 个搜索结果（用时 ${time} 毫秒）","hits":"找到 ${hits} 个搜索结果"},"path":"/search.xml","localsearch":{"enable":true,"trigger":"auto","top_n_per_article":1,"unescape":false,"preload":false}}</script><script src="/js/config.js"></script>

    <meta name="description" content="今日事，今日毕">
<meta property="og:type" content="website">
<meta property="og:title" content="SoundMemories">
<meta property="og:url" content="https://soundmemories.github.io/page/7/index.html">
<meta property="og:site_name" content="SoundMemories">
<meta property="og:description" content="今日事，今日毕">
<meta property="og:locale" content="zh_CN">
<meta property="article:author" content="SoundMemories">
<meta name="twitter:card" content="summary">


<link rel="canonical" href="https://soundmemories.github.io/page/7/">



<script class="next-config" data-name="page" type="application/json">{"sidebar":"","isHome":true,"isPost":false,"lang":"zh-CN","comments":"","permalink":"","path":"page/7/index.html","title":""}</script>

<script class="next-config" data-name="calendar" type="application/json">""</script>
<title>SoundMemories</title>
  








  <noscript>
    <link rel="stylesheet" href="/css/noscript.css">
  </noscript>
</head>

<body itemscope itemtype="http://schema.org/WebPage" class="use-motion">
  <div class="headband"></div>

  <main class="main">
    <div class="column">
      <header class="header" itemscope itemtype="http://schema.org/WPHeader"><div class="site-brand-container">
  <div class="site-nav-toggle">
    <div class="toggle" aria-label="切换导航栏" role="button">
        <span class="toggle-line"></span>
        <span class="toggle-line"></span>
        <span class="toggle-line"></span>
    </div>
  </div>

  <div class="site-meta">

    <a href="/" class="brand" rel="start">
      <i class="logo-line"></i>
      <h1 class="site-title">SoundMemories</h1>
      <i class="logo-line"></i>
    </a>
  </div>

  <div class="site-nav-right">
    <div class="toggle popup-trigger" aria-label="搜索" role="button">
        <i class="fa fa-search fa-fw fa-lg"></i>
    </div>
  </div>
</div>



<nav class="site-nav">
  <ul class="main-menu menu"><li class="menu-item menu-item-home"><a href="/" rel="section"><i class="fa fa-home fa-fw"></i>首页</a></li><li class="menu-item menu-item-tags"><a href="/tags/" rel="section"><i class="fa fa-tags fa-fw"></i>标签<span class="badge">10</span></a></li><li class="menu-item menu-item-categories"><a href="/categories/" rel="section"><i class="fa fa-th fa-fw"></i>分类<span class="badge">10</span></a></li><li class="menu-item menu-item-archives"><a href="/archives/" rel="section"><i class="fa fa-archive fa-fw"></i>归档<span class="badge">127</span></a></li>
      <li class="menu-item menu-item-search">
        <a role="button" class="popup-trigger"><i class="fa fa-search fa-fw"></i>搜索
        </a>
      </li>
  </ul>
</nav>



  <div class="search-pop-overlay">
    <div class="popup search-popup"><div class="search-header">
  <span class="search-icon">
    <i class="fa fa-search"></i>
  </span>
  <div class="search-input-container">
    <input autocomplete="off" autocapitalize="off" maxlength="80"
           placeholder="搜索..." spellcheck="false"
           type="search" class="search-input">
  </div>
  <span class="popup-btn-close" role="button">
    <i class="fa fa-times-circle"></i>
  </span>
</div>
<div class="search-result-container no-result">
  <div class="search-result-icon">
    <i class="fa fa-spinner fa-pulse fa-5x"></i>
  </div>
</div>

    </div>
  </div>

</header>
        
  
  <aside class="sidebar">

    <div class="sidebar-inner sidebar-overview-active">
      <ul class="sidebar-nav">
        <li class="sidebar-nav-toc">
          文章目录
        </li>
        <li class="sidebar-nav-overview">
          站点概览
        </li>
      </ul>

      <div class="sidebar-panel-container">
        <!--noindex-->
        <div class="post-toc-wrap sidebar-panel">
        </div>
        <!--/noindex-->

        <div class="site-overview-wrap sidebar-panel">
          <div class="site-author animated" itemprop="author" itemscope itemtype="http://schema.org/Person">
    <img class="site-author-image" itemprop="image" alt="SoundMemories"
      src="/images/avstar.png">
  <p class="site-author-name" itemprop="name">SoundMemories</p>
  <div class="site-description" itemprop="description">今日事，今日毕</div>
</div>
<div class="site-state-wrap animated">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
        <a href="/archives/">
          <span class="site-state-item-count">127</span>
          <span class="site-state-item-name">日志</span>
        </a>
      </div>
      <div class="site-state-item site-state-categories">
          <a href="/categories/">
        <span class="site-state-item-count">10</span>
        <span class="site-state-item-name">分类</span></a>
      </div>
      <div class="site-state-item site-state-tags">
          <a href="/tags/">
        <span class="site-state-item-count">10</span>
        <span class="site-state-item-name">标签</span></a>
      </div>
  </nav>
</div>
  <div class="links-of-author animated">
      <span class="links-of-author-item">
        <span class="exturl" data-url="aHR0cHM6Ly9naXRodWIuY29tL3NvdW5kbWVtb3JpZXM=" title="GitHub → https:&#x2F;&#x2F;github.com&#x2F;soundmemories"><i class="fab fa-github fa-fw"></i>GitHub</span>
      </span>
      <span class="links-of-author-item">
        <span class="exturl" data-url="bWFpbHRvOnNvdW5kbWVtb3JpZXNAMTYzLmNvbQ==" title="E-Mail → mailto:soundmemories@163.com"><i class="fa fa-envelope fa-fw"></i>E-Mail</span>
      </span>
  </div>
  <div class="cc-license animated" itemprop="license">
    <span class="exturl cc-opacity" data-url="aHR0cHM6Ly9jcmVhdGl2ZWNvbW1vbnMub3JnL2xpY2Vuc2VzL2J5LW5jLXNhLzQuMC8="><img src="https://cdnjs.cloudflare.com/ajax/libs/creativecommons-vocabulary/2020.11.3/assets/license_badges/small/by_nc_sa.svg" alt="Creative Commons"></span>
  </div>

        </div>
      </div>
    </div>

    
        <div class="pjax">
        </div>
  </aside>


    </div>

    <div class="main-inner index posts-expand">

    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="https://soundmemories.github.io/2020/05/10/ML/07.ML-Spark/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avstar.png">
      <meta itemprop="name" content="SoundMemories">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="SoundMemories">
      <meta itemprop="description" content="今日事，今日毕">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | SoundMemories">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2020/05/10/ML/07.ML-Spark/" class="post-title-link" itemprop="url">ML-Spark</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>

      <time title="创建时间：2020-05-10 00:00:00" itemprop="dateCreated datePublished" datetime="2020-05-10T00:00:00+08:00">2020-05-10</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">分类于</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/ML/" itemprop="url" rel="index"><span itemprop="name">ML</span></a>
        </span>
    </span>

  
    <span class="post-meta-break"></span>
    <span class="post-meta-item" title="本文字数">
      <span class="post-meta-item-icon">
        <i class="far fa-file-word"></i>
      </span>
      <span class="post-meta-item-text">本文字数：</span>
      <span>36k</span>
    </span>
    <span class="post-meta-item" title="阅读时长">
      <span class="post-meta-item-icon">
        <i class="far fa-clock"></i>
      </span>
      <span class="post-meta-item-text">阅读时长 &asymp;</span>
      <span>2:10</span>
    </span>
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <h1 id="概述">概述</h1>
<p><strong>1、什么是spark？</strong><br />
基于内存的计算引擎，它的计算速度非常快。但是仅仅只涉及到数据的计算，并没有涉及到数据的存储。</p>
<p><strong>2、为什么要学习spark？</strong><br />
MapReduce框架局限性：<br />
（1）Map结果写磁盘，Reduce写HDFS，多个MR之间通过HDFS交换数据。<br />
（2）任务调度和启动开销大。<br />
（3）无法充分利用内存。<br />
（4）不适合迭代计算（如机器学习、图计算等等），交互式处理（数据挖掘）。<br />
（5）不适合流式处理（点击日志分析）。<br />
（6）MapReduce编程不够灵活，仅支持Map和Reduce两种操作。</p>
<p><strong>3、生态圈</strong><br />
Hadoop提供的一套服务：<br />
离线计算/交互式计算：MapReduce、Hive、Pig。<br />
实时计算/流式计算：Storm、flink。<br />
交互式计算：Impala、presto。</p>
<p>需要一种灵活的框架可同时进行批处理、流式计算、交互式计算---&gt;Spark：<br />
（1）内存计算引擎，提供cache机制来支持需要反复迭代计算或者多次数据共享，减少数据读取的IO开销。<br />
（2）DAG引擎，较少多次计算之间中间结果写到HDFS的开销。<br />
（3）使用多线程模型来减少task启动开销，shuffle过程中避免不必要的sort操作以及减少磁盘IO。<br />
Spark缺点：吃内存，不太稳定。</p>
<p>Spark提供的一套完整的服务：<br />
离线计算/交互式计算：Spark core（类似mapreduce，基于rdd）、Spark
SQL（类似hive，基于dataframe）。<br />
实时计算/流式计算：Spark Streaming（类似storm、flink）。<br />
机器学习：Spark MLlib（基于dataframe）。</p>
<p><strong>4、Spark特点</strong><br />
（1）速度快：比mapreduce在内存中快100倍，在磁盘中快10倍。Spark中的job中间结果可以不落地，可以存放在内存中。mapreduce中map和reduce任务都是以进程的方式运行着，而spark中的job是以线程方式运行在进程中。<br />
（2）易用性：可以通过java/scala/python/R开发spark应用程序。<br />
（3）通用性：可以使用spark sql/spark streaming/mlib/Graphx。<br />
（4）兼容性：spark程序可以运行在standalone/yarn/mesos。</p>
<h1 id="安装使用">安装使用</h1>
<p><strong>安装和配置（Win）</strong><br />
首先要保证安装了Java(JDK)。</p>
<p>其次，从<span class="exturl" data-url="aHR0cDovL3NwYXJrLmFwYWNoZS5vcmcvZG93bmxvYWRzLmh0bWw=">官方下载地址<i class="fa fa-external-link-alt"></i></span>下载<code>Pre-built Apache Hadoop xx and later</code>的版本<br />
解压即可，在系统变量中加入<code>SPARK_HOME</code>路径为文件地址，在PATH中添加<code>%SPARK_HOME%\bin</code>和<code>%SPARK_HOME%\sbin</code><br />
注意Spark的不同版本要求了不同的Scala和Hadoop版本，一定要在后续安装Scala和Hadoop时注意。</p>
<p>对于Scala，从<span class="exturl" data-url="aHR0cHM6Ly93d3cuc2NhbGEtbGFuZy5vcmcvZG93bmxvYWQvYWxsLmh0bWw=">官方下载地址<i class="fa fa-external-link-alt"></i></span>下载安装包，默认安装即可。</p>
<p>对于Hadoop，从<span class="exturl" data-url="aHR0cHM6Ly9hcmNoaXZlLmFwYWNoZS5vcmcvZGlzdC9oYWRvb3AvY29tbW9uLw==">官方下载地址<i class="fa fa-external-link-alt"></i></span>需要的版本解压即可，在系统变量中加入<code>HADOOP_HOME</code>路径为文件地址，在PATH中添加<code>%HADOOP_HOME%\bin</code>。<br />
下载<span class="exturl" data-url="aHR0cHM6Ly9naXRodWIuY29tL3N0ZXZlbG91Z2hyYW4vd2ludXRpbHM=">winutils<i class="fa fa-external-link-alt"></i></span>，找到对应版本的Hadoop，替换原版Hadoop的bin文件夹即可。winutils用于改变文件或文件夹读写权限的工具。</p>
<p>测试以上程序是否安装成功，启动cmd：<br />
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">java -version</span><br><span class="line">&#x27;&#x27;&#x27;</span><br><span class="line">java version &quot;1.8.0_211&quot;</span><br><span class="line">...</span><br><span class="line">&#x27;&#x27;&#x27;</span><br><span class="line">hadoop</span><br><span class="line">&#x27;&#x27;&#x27;</span><br><span class="line">Usage: hadoop [--config confdir] [--loglevel loglevel] COMMAND</span><br><span class="line">...</span><br><span class="line">&#x27;&#x27;&#x27;</span><br></pre></td></tr></table></figure><br />
以上证明安装成功！</p>
<p>如果使用pyspark，需要<code>pip install py4j</code>和<code>pip install findspark</code>。<br />
在程序中使用：<br />
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> findspark</span><br><span class="line">findspark.intit()</span><br></pre></td></tr></table></figure><br />
执行一次以上两句，以后就可以<code>import pysaprk</code>了。</p>
<p>如果你想把python脚本提交到Spark上执行，使用Spark自带的<code>bin/spark-submit</code>脚本来运行：<br />
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">bin/spark-submit my_script.py</span><br></pre></td></tr></table></figure><br />
spark-submit 会帮助我们引入python程序的Spark依赖。<br />
注意，这种方法和调用pyspark一样需要你自己初始化SparkContext，一般这么写：<br />
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> pyspark <span class="keyword">import</span> SparkConf, SparkContext</span><br><span class="line"><span class="comment"># 首先创建一个SparkConf对象来配置应用，然后基于该SparkConf来创建一个SparkContext对象</span></span><br><span class="line"><span class="comment"># .setMaster()给出了集群的URL，告诉spark如何连接到集群上。这里&#x27;local&#x27;表示让spark运行在单机单线程上</span></span><br><span class="line"><span class="comment"># .setAppName()给出了应用的名字。当连接到一个集群上时，这个值可以帮助你在集群管理器的用户界面上找到你的应用</span></span><br><span class="line">conf = SparkConf().setMaster(<span class="string">&#x27;local&#x27;</span>).setAppName(<span class="string">&#x27;My App&#x27;</span>)</span><br><span class="line">sc = SparkContext(conf = conf)</span><br></pre></td></tr></table></figure><br />
只有在终端使用<code>pyspark</code>和<code>spark-shell</code>命令启动spark，不需要自己初始化SparkContext，它在启动时自动初始化SparkContext为sc。</p>
<p><strong>local模式启动</strong>：<br />
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">在<span class="variable">$SPARK_HOME</span>/sbin目录下执行pyspark</span></span><br><span class="line"><span class="meta prompt_">$ </span><span class="language-bash">pyspark</span></span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">直接启动spark用下面命令，默认scala语言。</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">建议使用上面的pyspark</span></span><br><span class="line"><span class="meta prompt_">$ </span><span class="language-bash">spark-shell</span></span><br></pre></td></tr></table></figure><br />
<img src="/images/Spark/pyspark.png"></p>
<h1 id="spark-core">Spark-Core</h1>
<p>Spark支持多种运行模式。单机部署下，既可以用本地（Local）模式运行，也可以使用伪分布式模式来运行；当以分布式集群部署的时候，可以根据实际情况选择Spark自带的独立（Standalone）运行模式、YARN运行模式或者Mesos模式。虽然模式多，但是Spark的运行架构基本由三部分组成，包括<strong>SparkContext（驱动程序）</strong>、<strong>ClusterManager（集群资源管理器）</strong>和<strong>Executor（任务执行进程）</strong>。　<br />
<img src="/images/Spark/spark-core.png"></p>
<ul>
<li>SparkContext提交作业，向ClusterManager申请资源；后面会用SparkContext进行初始化。</li>
<li>ClusterManager（资源管理和调度）会根据当前集群的资源使用情况，进行有条件的FIFO策略：
<ul>
<li>先分配的应用程序尽可能多地获取资源；</li>
<li>后分配的应用程序则在剩余资源中筛选；</li>
<li>没有合适资源的应用程序只能等待其他应用程序释放资源；</li>
</ul></li>
<li>ClusterManager有两种分配方法：
<ul>
<li>默认情况下会将应用程序分布在尽可能多的Worker(资源节点)上，这种分配算法有利于充分利用集群资源，适合内存使用多的场景，以便更好地做到数据处理的本地性；</li>
<li>另一种则是分布在尽可能少的Worker上，这种适合CPU密集型且内存使用较少的场景；</li>
</ul></li>
<li>ClusterManager分配到worker上就会创建Excutor：
<ul>
<li>Excutor创建后与SparkContext保持通讯，SparkContext分配任务集给Excutor，Excutor按照一定的调度策略执行任务集。</li>
</ul></li>
</ul>
<p>Spark包含1个<strong>driver(笔记本电脑/集群网关机器上)</strong>和若干个<strong>executor(在各个节点上)</strong>，通过SparkContext(简称sc)连接<strong>Spark集群、创建RDD、累加器（accumlator）、广播变量（broadcast
variables）</strong>，简单可以认为SparkContext（驱动程序）是Spark程序的根本。<br />
<img src="/images/Spark/SparkComponents.png" width="40%"></p>
<p><strong>Driver</strong>会把计算任务分成一系列小的<strong>task</strong>，然后送到<strong>executor</strong>执行。executor之间可以通信，在每个executor完成自己的task以后，所有的信息会被传回。</p>
<p><strong>Spark集群架构(Standalone模式)</strong><br />
<img src="/images/Spark/spark1.png" width="80%"></p>
<ul>
<li>Application：用户自己写的Spark应用程序，批处理作业的集合。Application的main方法为应用程序的入口，用户通过Spark的API，定义了RDD和对RDD的操作。</li>
<li>Master和Worker：整个集群分为 Master 节点和 Worker 节点，相当于
Hadoop 的 Master 和 Slave 节点。
<ul>
<li>Master：Standalone模式中主控节点，负责接收Client提交的作业，管理Worker，并命令Worker启动Driver和Executor。</li>
<li>Worker：Standalone模式中slave节点上的守护进程，负责管理本节点的资源，定期向Master汇报心跳，接收Master的命令，启动Driver和Executor。</li>
</ul></li>
<li>Client：客户端进程，负责提交作业到Master。</li>
<li>Driver：
一个Spark作业运行时包括一个Driver进程，也是作业的主进程，负责作业的解析、生成Stage并调度Task到Executor上。包括DAGScheduler，TaskScheduler。</li>
<li>Executor：即真正执行作业的地方，一个集群一般包含多个Executor，每个Executor接收Driver的命令Launch
Task，一个Executor可以执行一到多个Task。<br />
          <!--noindex-->
            <div class="post-button">
              <a class="btn" href="/2020/05/10/ML/07.ML-Spark/#more" rel="contents">
                阅读全文 &raquo;
              </a>
            </div>
          <!--/noindex-->
        
      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="https://soundmemories.github.io/2020/05/07/ML/06.ML-Hive%E3%80%81Hbase/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avstar.png">
      <meta itemprop="name" content="SoundMemories">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="SoundMemories">
      <meta itemprop="description" content="今日事，今日毕">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | SoundMemories">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2020/05/07/ML/06.ML-Hive%E3%80%81Hbase/" class="post-title-link" itemprop="url">ML-Hive、Hbase</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>

      <time title="创建时间：2020-05-07 00:00:00" itemprop="dateCreated datePublished" datetime="2020-05-07T00:00:00+08:00">2020-05-07</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">分类于</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/ML/" itemprop="url" rel="index"><span itemprop="name">ML</span></a>
        </span>
    </span>

  
    <span class="post-meta-break"></span>
    <span class="post-meta-item" title="本文字数">
      <span class="post-meta-item-icon">
        <i class="far fa-file-word"></i>
      </span>
      <span class="post-meta-item-text">本文字数：</span>
      <span>13k</span>
    </span>
    <span class="post-meta-item" title="阅读时长">
      <span class="post-meta-item-icon">
        <i class="far fa-clock"></i>
      </span>
      <span class="post-meta-item-text">阅读时长 &asymp;</span>
      <span>45 分钟</span>
    </span>
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <h1 id="数据库和数据仓库">数据库和数据仓库？</h1>
<p>数据库：<br />
（1）传统的关系型数据库的主要应用，主要是基本的、日常的事务处理，例如银行交易。<br />
（2）一般只保存数据的最新状态，极个别重要的值会保存历史版本。</p>
<p>数据仓库：<br />
（1）主要应用是OLAP（On-Line Analytical
Processing），支持复杂的分析操作，侧重决策支持，并且提供直观易懂的查询结果。<br />
（2）会保存所有历史版本，只记录，很少更新、删除等。</p>
<p>以电商为例：基本每家电商公司都会经历，从只需要业务数据库到要数据仓库的阶段。</p>
<ul>
<li>第一阶段，电商早期启动非常容易，入行门槛低。“一个可下单的网页前端 +
几台服务器 + 一个MySQL”，就能开门迎客了。这好比手工作坊时期。</li>
<li>第二阶段，流量来了，客户和订单都多起来了，普通查询已经有压力了，这个时候就需要升级架构变成多台服务器和多个业务数据库（量大+分库分表），这个阶段的业务数字和指标还可以勉强从业务数据库里查询。初步进入工业化。</li>
<li>第三个阶段，一般需要 3-5
年左右的时间，随着业务指数级的增长，数据量的会陡增，公司角色也开始多了起来，开始有了
CEO、CMO、CIO，大家需要面临的问题越来越复杂，越来越深入。高管们关心的问题，从最初非常粗放的：“昨天的收入是多少”、“上个月的
PV、UV
是多少”，逐渐演化到非常精细化和具体的用户的集群分析，特定用户在某种使用场景中，例如“某年龄段某性别用户群体，在过去五年的第一季度某类商品的购买行为与公司进行的促销活动方案之间的关系”。</li>
</ul>
<p>第三个阶段，这种非常具体，且能够对公司决策起到关键性作用的问题，基本很难从<strong>业务数据库</strong>从调取出来。原因在于：<br />
（1）业务数据库中的数据结构是为了完成交易而设计的，不是为了而查询和分析的便利设计的。<br />
（2）业务数据库大多是读写优化的，即又要读（查看商品信息），也要写（产生订单，完成支付）。因此对于大量数据的读（查询指标，一般是复杂的只读类型查询）是支持不足的。</p>
<p>而怎么解决这个问题，此时我们就需要<strong>建立一个数据仓库</strong>了，公司也算开始进入信息化阶段了。数据仓库的作用在于：<br />
（1）数据结构为了分析和查询的便利；<br />
（2）只读优化的数据库，即不需要它写入速度多么快，只要做大量数据的复杂查询的速度足够快就行了。</p>
<p>那么在这里前一种业务数据库（读写都优化）的是业务性数据库，后一种是分析性数据库，即数据仓库。<br />
数据库：MySQL、Oracle、SqlServer、Hbase等。<br />
数据仓库：Hive、Greenplum等。</p>
<p>ETL（Extract-Transform-Load，抽取-转换-加载）：数据从<strong>业务性的数据库</strong>中提取、加工、导入<strong>分析性的数据库</strong>的工作。<br />
常见的ETL工具：Spark。</p>
<h1 id="hive概述">Hive概述</h1>
<p>（1）Hive 由 Facebook 实现并开源，是基于 Hadoop
的一个数据仓库工具，可以将结构化的数据映射为一张数据库表，并提供
HQL(Hive SQL)查询功能，底层数据是存储在 HDFS 上。<br />
（2）Hive 本质: 将 SQL 语句转换为 MapReduce 任务运行，使不熟悉 MapReduce
的用户很方便地利用 HQL 处理和计算 HDFS 上的结构化的数据，是一款基于 HDFS
的 MapReduce <strong>计算框架</strong>。<br />
（3）主要用途：用来做离线数据分析，比直接用 MapReduce 开发效率更高。</p>
<p><strong>1、为什么使用Hive？</strong><br />
（1）需要保存大量历史数据、支持快速查询、数据分析，传统的数据库很难做到。<br />
（2）直接使用 Hadoop MapReduce
处理数据所面临的问题：人员学习成本太高、MapReduce
实现复杂查询逻辑开发难度太大。<br />
（3）使用 Hive：操作接口采用类 SQL 语法，提供快速开发的能力、避免了去写
MapReduce，减少开发人员的学习成本、功能扩展很方便。</p>
<p><strong>2、Hive 与 Hadoop 的关系？</strong><br />
Hive 利用 HDFS 存储数据，利用 MapReduce 查询分析数据。</p>
<p>Hive 是数据仓库工具，没有集群的概念，如果想提交 Hive 作业只需要在
hadoop 集群 Master 节点上装 Hive 就可以了。</p>
<p><strong>3、 Hive 与传统数据库对比</strong><br />
Hive 用于海量数据的离线数据分析。</p>
<table>
<tr>
<th>
</th>
<th>
Hive
</th>
<th>
关系型数据库
</th>
</tr>
<tr>
<td>
ANSI SQL
</td>
<td>
不完全支持
</td>
<td>
支持
</td>
</tr>
<tr>
<td>
更新
</td>
<td>
INSERT OVERWRITETABLE(默认)
</td>
<td>
UPDATE
</td>
</tr>
<tr>
<td>
事务
</td>
<td>
不支持(默认)
</td>
<td>
支持
</td>
</tr>
<tr>
<td>
模式
</td>
<td>
读模式
</td>
<td>
写模式
</td>
</tr>
<tr>
<td>
查询语言
</td>
<td>
HQL
</td>
<td>
SQL
</td>
</tr>
<tr>
<td>
数据存储
</td>
<td>
HDFS
</td>
<td>
Raw Device or Local FS
</td>
</tr>
<tr>
<td>
执行
</td>
<td>
MapReduce
</td>
<td>
Executor
</td>
</tr>
<tr>
<td>
执行延迟
</td>
<td>
高
</td>
<td>
低
</td>
</tr>
<tr>
<td>
子查询
</td>
<td>
只能用在From子句中
</td>
<td>
完全支持
</td>
</tr>
<tr>
<td>
处理数据规模
</td>
<td>
大
</td>
<td>
小
</td>
</tr>
<tr>
<td>
可扩展性
</td>
<td>
高
</td>
<td>
低
</td>
</tr>
<tr>
<td>
索引
</td>
<td>
0.8版本后加入位图索引
</td>
<td>
有复杂的索引
</td>
</tr>
</table>
<ul>
<li>Hive支持的数据类型
<ul>
<li>原子数据类型：TINYINT SMALLINT INT BIGINT BOOLEAN FLOAT DOUBLE
STRING BINARY TIMESTAMP DECIMAL CHAR VARCHAR DATE<br />
</li>
<li>复杂数据类型：ARRAY MAP STRUCT</li>
</ul></li>
<li>Hive中表的类型
<ul>
<li>托管表 (managed table) (内部表)</li>
<li>外部表</li>
</ul></li>
</ul>
<h2 id="hive-架构">Hive 架构</h2>
<p><img src="/images/Hive、Hbase/hive2.jpg"></p>
<ul>
<li>用户接口：包括 CLI、JDBC/ODBC、WebGUI。
<ul>
<li>CLI（command line interface）是 shell 命令行。</li>
<li>JDBC/ODBC 是 Hive 的 JAVA 实现，与传统数据库 JDBC 类似。</li>
<li>WebGUI 是通过浏览器访问 Hive。</li>
<li>HiveServer2基于Thrift，允许远程客户端使用多种编程语言如Java、Python
向 Hive 提交请求</li>
</ul></li>
<li>元数据存储：通常是存储在关系数据库如 mysql/derby 中。
<ul>
<li>Hive 将元数据存储在数据库中。</li>
<li>Hive 中的元数据包括：
<ul>
<li>表的名字</li>
<li>表的列</li>
<li>分区及其属性</li>
<li>表的属性（是否为外部表等）</li>
<li>表的数据所在目录等。</li>
</ul></li>
</ul></li>
<li>解释器、编译器、优化器、执行器：完成 HQL
查询语句从词法分析、语法分析、编译、优化以及查询计划的生成。生成的查询计划存储在
HDFS 中，并在随后由 MapReduce 调用执行。</li>
</ul>
<h2 id="hive数据模型">Hive数据模型</h2>
<ul>
<li>Hive 中所有的数据都存储在 HDFS 中，没有专门的数据存储格式。</li>
<li>在创建表时指定数据中的分隔符，Hive 就可以映射成功，解析数据。</li>
<li>Hive 中包含以下数据模型：
<ul>
<li>db：在 hdfs 中表现为 hive.metastore.warehouse.dir
目录下一个文件夹。</li>
<li>table：在 hdfs 中表现所属 db 目录下一个文件夹。</li>
<li>external table：数据存放位置可以在 hdfs 任意指定路径。</li>
<li>partition：在 hdfs 中表现为 table 目录下的子目录。</li>
<li>bucket：在 hdfs 中表现为同一个表目录下根据 hash
散列之后的多个文件。</li>
</ul></li>
</ul>
<h2 id="hive安装部署">Hive安装部署</h2>
<p>Hive 安装前需要安装好 JDK 和 Hadoop。配置好环境变量。</p>
<p>下载Hive的安装包 http://archive.cloudera.com/cdh5/cdh/5/
并解压：<br />
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_">$ </span><span class="language-bash">tar -zxvf hive-1.1.0-cdh5.7.0.tar.gz  -C ~/app/</span></span><br></pre></td></tr></table></figure></p>
<p>进入到 解压后的hive目录 找到 conf目录, 修改配置文件：<br />
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_">$ </span><span class="language-bash"><span class="built_in">cp</span> hive-env.sh.template hive-env.sh</span></span><br><span class="line"><span class="meta prompt_">$ </span><span class="language-bash">vi hive-env.sh</span></span><br></pre></td></tr></table></figure></p>
<p>在hive-env.sh中指定hadoop的路径：<br />
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">HADOOP_HOME=/home/hadoop/app/hadoop-2.6.0-cdh5.7.0</span><br></pre></td></tr></table></figure></p>
<p>配置环境变量：<br />
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_">$ </span><span class="language-bash">vi ~/.bash_profile</span></span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">添加环境变量</span></span><br><span class="line">export HIVE_HOME=/home/hadoop/app/hive-1.1.0-cdh5.7.0</span><br><span class="line">export PATH=$HIVE_HOME/bin:$PATH</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_">$ </span><span class="language-bash"><span class="built_in">source</span> ~/.bash_profile</span></span><br></pre></td></tr></table></figure></p>
<p>根据元数据存储的介质不同，分为下面两个版本，其中 derby
属于内嵌模式。实际生产环境中则使用 mysql 来进行元数据的存储。<br />
（1）内置 derby 版： bin/hive 启动即可使用。缺点：不同路径启动
hive，每一个 hive 拥有一套自己的元数据，无法共享。<br />
（2）mysql
版：上传mysql驱动<code>mysql-connector-java-5.*.jar</code>到hive安装目录的lib目录下。配置
Mysql 元数据库信息<code>vi conf/hive-site.xml</code>：<br />
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version=<span class="string">&quot;1.0&quot;</span> encoding=<span class="string">&quot;UTF-8&quot;</span> standalone=<span class="string">&quot;no&quot;</span>?&gt;</span></span><br><span class="line"><span class="meta">&lt;?xml-stylesheet type=<span class="string">&quot;text/xsl&quot;</span> href=<span class="string">&quot;configuration.xsl&quot;</span>?&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">configuration</span>&gt;</span></span><br><span class="line"><span class="comment">&lt;!-- 插入以下代码 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">name</span>&gt;</span>javax.jdo.option.ConnectionUserName<span class="tag">&lt;/<span class="name">name</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">value</span>&gt;</span>hive<span class="tag">&lt;/<span class="name">value</span>&gt;</span><span class="comment">&lt;!-- 指定mysql用户名 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">name</span>&gt;</span>javax.jdo.option.ConnectionPassword<span class="tag">&lt;/<span class="name">name</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">value</span>&gt;</span>hive<span class="tag">&lt;/<span class="name">value</span>&gt;</span><span class="comment">&lt;!-- 指定mysql密码 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">name</span>&gt;</span>javax.jdo.option.ConnectionURL<span class="tag">&lt;/<span class="name">name</span>&gt;</span>mysql</span><br><span class="line">        <span class="tag">&lt;<span class="name">value</span>&gt;</span>jdbc:mysql://127.0.0.1:3306/hive<span class="tag">&lt;/<span class="name">value</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">property</span>&gt;</span><span class="comment">&lt;!-- 指定mysql数据库地址 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">name</span>&gt;</span>javax.jdo.option.ConnectionDriverName<span class="tag">&lt;/<span class="name">name</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">value</span>&gt;</span>com.mysql.jdbc.Driver<span class="tag">&lt;/<span class="name">value</span>&gt;</span><span class="comment">&lt;!-- 指定mysql驱动 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!-- 到此结束代码 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">property</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">name</span>&gt;</span>hive.exec.script.wrapper<span class="tag">&lt;/<span class="name">name</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">value</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">description</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">configuration</span>&gt;</span></span><br></pre></td></tr></table></figure></p>
<ul>
<li>hive启动
<ul>
<li>启动docker：<code>service docker start</code></li>
<li>通过docker，启动mysql：<code>docker start mysql</code></li>
<li>启动hive的metastore元数据服务：<code>hive --service metastore</code></li>
<li>启动hive：<code>hive</code></li>
</ul></li>
</ul>
<h2 id="hive基本操作">Hive基本操作</h2>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- 创建数据库</span></span><br><span class="line"><span class="keyword">CREATE</span> DATABASE test;</span><br><span class="line"><span class="comment">-- 显示所有数据库</span></span><br><span class="line"><span class="keyword">SHOW</span> DATABASES;</span><br><span class="line"><span class="comment">-- 创建表</span></span><br><span class="line"><span class="comment">-- 默认表创建在hadoop的user/hive/warehouse下</span></span><br><span class="line"><span class="keyword">CREATE</span> <span class="keyword">TABLE</span> student(classNo string, stuNo string, score <span class="type">int</span>) <span class="type">row</span> format delimited fields terminated <span class="keyword">by</span> <span class="string">&#x27;,&#x27;</span>;</span><br></pre></td></tr></table></figure>
<p><code>row format delimited fields terminated by ','</code>：指定了字段的分隔符为逗号，所以load数据的时候，load的文本也要为逗号，否则加载后为NULL。hive只支持单个字符的分隔符，hive默认的分隔符是\001。</p>
<ul>
<li>将数据load到表中
<ul>
<li>在本地文件系统创建一个如下的文本文件：/home/hadoop/tmp/student.txt<br />
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">C01,N0101,82</span><br><span class="line">C01,N0102,59</span><br><span class="line">C01,N0103,65</span><br><span class="line">C02,N0201,81</span><br><span class="line">C02,N0202,82</span><br><span class="line">C02,N0203,79</span><br><span class="line">C03,N0301,56</span><br><span class="line">C03,N0302,92</span><br><span class="line">C03,N0306,72</span><br></pre></td></tr></table></figure></li>
<li>在hive中执行下面语句导入文件：<br />
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">load data <span class="keyword">local</span> inpath <span class="string">&#x27;/home/hadoop/tmp/student.txt&#x27;</span>overwrite <span class="keyword">into</span> <span class="keyword">table</span> student;</span><br><span class="line"><span class="comment">-- 等价于 hadoop fs -put /home/hadoop/tmp/student.txt /user/hive/warehouse/student </span></span><br></pre></td></tr></table></figure></li>
<li>这个命令将student.txt文件复制到hive的warehouse目录中，这个目录由hive.metastore.warehouse.dir配置项设置，默认值为/user/hive/warehouse。Overwrite选项将导致Hive事先删除student目录下所有的文件,
并将文件内容映射到表中。<br />
Hive不会对student.txt做任何格式处理，因为Hive本身并不强调数据的存储格式。</li>
</ul></li>
</ul>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- 查询表中的数据，跟SQL类似</span></span><br><span class="line"><span class="keyword">select</span> <span class="operator">*</span> <span class="keyword">from</span> student;</span><br><span class="line"><span class="comment">-- 分组查询group by和统计count</span></span><br><span class="line"><span class="keyword">select</span> classNo,<span class="built_in">count</span>(score) <span class="keyword">from</span> student <span class="keyword">where</span> score<span class="operator">&gt;=</span><span class="number">60</span> <span class="keyword">group</span> <span class="keyword">by</span> classNo;</span><br></pre></td></tr></table></figure>
<p>从执行结果可以看出hive把查询的结果变成了MapReduce作业通过hadoop执行。</p>
<h2 id="hive的内部表和外部表">Hive的内部表和外部表</h2>
<table>
<tr>
<th>
</th>
<th>
内部表(managed table)
</th>
<th>
外部表(external table)
</th>
</tr>
<tr>
<td>
概念
</td>
<td>
创建表时无external修饰
</td>
<td>
创建表时被external修饰
</td>
</tr>
<tr>
<td>
数据管理
</td>
<td>
由Hive自身管理
</td>
<td>
由HDFS管理
</td>
</tr>
<tr>
<td>
数据保存位置
</td>
<td>
hive.metastore.warehouse.dir<br>默认位置：/user/hive/warehouse
</td>
<td>
hdfs中任意位置
</td>
</tr>
<tr>
<td>
删除时影响
</td>
<td>
直接删除元数据（metadata）及存储数据
</td>
<td>
仅会删除元数据，HDFS上的文件并不会被删除
</td>
</tr>
<tr>
<td>
表结构修改时影响
</td>
<td>
修改会将修改直接同步给元数据
</td>
<td>
表结构和分区进行修改，则需要修复（MSCK REPAIR TABLE table_name;）
</td>
</tr>
</table>
<p><strong>案例:</strong><br />
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- 创建一个外部表student2，位置指定为hdfs上的/tmp/student</span></span><br><span class="line"><span class="comment">-- TABLE 表名(字段名 字段类型，...)  </span></span><br><span class="line"><span class="comment">-- location &#x27;数据在hdfs上的路径&#x27;;</span></span><br><span class="line"><span class="keyword">CREATE</span> <span class="keyword">EXTERNAL</span> <span class="keyword">TABLE</span> student2 (classNo string, stuNo string, score <span class="type">int</span>) <span class="type">row</span> format delimited fields terminated <span class="keyword">by</span> <span class="string">&#x27;,&#x27;</span> location <span class="string">&#x27;/tmp/student2&#x27;</span>;</span><br><span class="line"><span class="comment">-- 装载数据</span></span><br><span class="line">load data <span class="keyword">local</span> inpath <span class="string">&#x27;/home/hadoop/tmp/student.txt&#x27;</span> overwrite <span class="keyword">into</span> <span class="keyword">table</span> student2;</span><br><span class="line"><span class="comment">-- 显示表信息</span></span><br><span class="line"><span class="keyword">desc</span> formatted table_name;</span><br><span class="line"><span class="comment">-- 删除表查看结果</span></span><br><span class="line"><span class="keyword">drop</span> <span class="keyword">table</span> student;</span><br><span class="line"><span class="keyword">select</span> <span class="operator">*</span> <span class="keyword">from</span> student2;</span><br><span class="line"><span class="comment">-- 再次创建外部表student2</span></span><br><span class="line"><span class="keyword">CREATE</span> <span class="keyword">EXTERNAL</span> <span class="keyword">TABLE</span> student2 (classNo string, stuNo string, score <span class="type">int</span>) <span class="type">row</span> format delimited fields terminated <span class="keyword">by</span> <span class="string">&#x27;,&#x27;</span> location <span class="string">&#x27;/tmp/student2&#x27;</span>;</span><br><span class="line"><span class="comment">-- 不装载数据直接查询查看结果</span></span><br><span class="line"><span class="keyword">select</span> <span class="operator">*</span> <span class="keyword">from</span> student2;</span><br></pre></td></tr></table></figure></p>
<h2 id="分区表">分区表</h2>
<p><strong>什么是分区表？</strong><br />
（1）随着表的不断增大，对于新纪录的增加，查找，删除等(DML)的维护也更加困难。对于数据库中的超大型表，可以通过把它的数据分成若干个小表，从而简化数据库的管理活动，对于每一个简化后的小表，我们称为一个单个的分区。<br />
（2）hive中分区表实际就是对应hdfs文件系统上独立的文件夹，该文件夹内的文件是该分区所有数据文件。<br />
（3）分区可以理解为分类，通过分类把不同类型的数据放到不同的目录下。<br />
（4）分类的标准就是分区字段，可以一个，也可以多个。<br />
（5）分区表的意义在于优化查询。查询时尽量利用分区字段。如果不使用分区字段，就会全部扫描。</p>
<p>创建一个employee.txt：<br />
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">tom,4300</span><br><span class="line">jerry,12000</span><br><span class="line">mike,13000</span><br><span class="line">jake,11000</span><br><span class="line">rob,10000</span><br></pre></td></tr></table></figure></p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- 创建分区表</span></span><br><span class="line"><span class="comment">-- partitioned by (分区字段名 分区字段类型)</span></span><br><span class="line"><span class="keyword">create</span> <span class="keyword">table</span> employee (name string,salary <span class="type">bigint</span>) partitioned <span class="keyword">by</span> (date1 string) <span class="type">row</span> format delimited fields terminated <span class="keyword">by</span> <span class="string">&#x27;,&#x27;</span> lines terminated <span class="keyword">by</span> <span class="string">&#x27;\n&#x27;</span> stored <span class="keyword">as</span> textfile;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 查看表的分区</span></span><br><span class="line"><span class="keyword">show</span> partitions employee;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 添加分区：分区是表文件夹的子文件夹</span></span><br><span class="line"><span class="comment">-- 就是更新hive原数据，使分区生效</span></span><br><span class="line"><span class="comment">-- partition(分区字段名字=&#x27;分区的具体值&#x27;)</span></span><br><span class="line"><span class="keyword">alter</span> <span class="keyword">table</span> employee <span class="keyword">add</span> if <span class="keyword">not</span> <span class="keyword">exists</span> <span class="keyword">partition</span>(date1<span class="operator">=</span><span class="string">&#x27;2018-12-01&#x27;</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 加载数据到分区</span></span><br><span class="line"><span class="comment">-- 如果重复加载同名文件，不会报错，会自动创建一个*_copy_1.txt</span></span><br><span class="line">load data <span class="keyword">local</span> inpath <span class="string">&#x27;/home/hadoop/tmp/employee.txt&#x27;</span> <span class="keyword">into</span> <span class="keyword">table</span> employee <span class="keyword">partition</span>(date1<span class="operator">=</span><span class="string">&#x27;2018-12-01&#x27;</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 查看数据</span></span><br><span class="line"><span class="comment">-- 分区字段也会显示出来，也可以作为查询条件，但它不是原数据内容</span></span><br><span class="line"><span class="keyword">select</span> <span class="operator">*</span> <span class="keyword">from</span> employee;</span><br><span class="line"><span class="keyword">select</span> <span class="operator">*</span> <span class="keyword">from</span> employee <span class="keyword">where</span> date1<span class="operator">=</span><span class="string">&#x27;2018-12-01&#x27;</span>;</span><br></pre></td></tr></table></figure>
<p>如果是外部分区表即使有分区的目录结构, 也必须要添加分区,
才能看到相应的数据：<br />
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">手动创建一个分区，并添加数据</span></span><br><span class="line">hadoop fs -mkdir /user/hive/warehouse/employee/dt=2018-12-04</span><br><span class="line">hadoop fs -copyFromLocal /tmp/employee.txt /user/hive/warehouse/employee/dt=2018-12-04/employee.txt</span><br></pre></td></tr></table></figure></p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- 此时查看表中数据发现没有新的分区</span></span><br><span class="line"><span class="keyword">select</span> <span class="operator">*</span> <span class="keyword">from</span> employee;</span><br><span class="line"><span class="comment">-- 需要更新hive原数据，使分区生效</span></span><br><span class="line"><span class="keyword">alter</span> <span class="keyword">table</span> employee <span class="keyword">add</span> if <span class="keyword">not</span> <span class="keyword">exists</span> <span class="keyword">partition</span>(dt<span class="operator">=</span><span class="string">&#x27;2018-12-04&#x27;</span>);</span><br><span class="line"><span class="comment">-- 此时再次查看才能看到新加入的数据</span></span><br><span class="line"><span class="keyword">select</span> <span class="operator">*</span> <span class="keyword">from</span> employee;</span><br></pre></td></tr></table></figure>
<p>分区表目的：利用分区表方式减少查询时需要扫描的数据量<br />
（1）分区字段不是表中的列，数据文件中没有对应的列<br />
（2）分区仅仅是一个目录名<br />
（3）查看数据时，hive会自动添加分区列<br />
（4）支持多级分区，多级子目录</p>
<p><strong>动态分区：在写入数据时自动创建分区(包括目录结构)</strong><br />
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- 创建表</span></span><br><span class="line"><span class="keyword">create</span> <span class="keyword">table</span> employee2 (name string,salary <span class="type">bigint</span>) partitioned <span class="keyword">by</span> (date1 string) <span class="type">row</span> format delimited fields terminated <span class="keyword">by</span> <span class="string">&#x27;,&#x27;</span> lines terminated <span class="keyword">by</span> <span class="string">&#x27;\n&#x27;</span> stored <span class="keyword">as</span> textfile;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 使用动态分区需要设置参数</span></span><br><span class="line"><span class="keyword">set</span> hive.exec.dynamic.partition.mode<span class="operator">=</span>nonstrict;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 导入数据时指定分区date1</span></span><br><span class="line"><span class="keyword">insert</span> <span class="keyword">into</span> <span class="keyword">table</span> employee2 <span class="keyword">partition</span>(date1) <span class="keyword">select</span> name,salary,date1 <span class="keyword">from</span> employee;</span><br></pre></td></tr></table></figure></p>
<h2 id="hive函数">Hive函数</h2>
<p>在 Hive
有四种类型的运算符：关系运算符、算术运算符、逻辑运算符、复杂运算。和SQL中的运算符差异不大，不讲了。</p>
<p><strong>1、内置函数：<span class="exturl" data-url="aHR0cHM6Ly9jd2lraS5hcGFjaGUub3JnL2NvbmZsdWVuY2UvZGlzcGxheS9IaXZlL0xhbmd1YWdlTWFudWFsK1VERg==">参考手册<i class="fa fa-external-link-alt"></i></span></strong><br />
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- 显示所有函数</span></span><br><span class="line"><span class="keyword">show</span> functions;</span><br><span class="line"><span class="comment">-- 描述函数用途</span></span><br><span class="line"><span class="keyword">desc</span> <span class="keyword">function</span> 函数名;</span><br><span class="line"><span class="comment">-- 详细描述函数用法</span></span><br><span class="line"><span class="keyword">desc</span> <span class="keyword">function</span> extended 函数名;</span><br></pre></td></tr></table></figure></p>
<ul>
<li>简单函数：日期函数、字符串函数、类型转换...</li>
<li>统计函数：sum、avg、distinct...</li>
<li>集合函数</li>
<li>分析函数</li>
</ul>
<p><strong>2、自定义函数和Transform</strong><br />
当 Hive
提供的内置函数无法满足你的业务处理需要时，此时就可以考虑使用用户自定义函数（UDF：user-defined
function）。</p>
<p><strong>TRANSFORM</strong>、
<strong>UDF</strong>、<strong>UDAF</strong>：<br />
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">it is possible to plug in your own custom mappers and reducers</span><br><span class="line"></span><br><span class="line">A UDF is basically only a transformation done by a mapper meaning that each row should be </span><br><span class="line">mapped to exactly one row. A UDAF on the other hand allows us to transform a group of rows </span><br><span class="line">into one or more rows, meaning that we can reduce the number of input rows to </span><br><span class="line">a single output row by some custom aggregation.</span><br></pre></td></tr></table></figure></p>
<p><strong>UDF</strong>：就是做一个mapper，对每一条输入数据，映射为一条输出数据。<br />
<strong>UDAF</strong>：就是一个reducer，把一组输入数据映射为一条(或多条)输出数据。<br />
一个脚本至于是做mapper还是做reducer，又或者是做udf还是做udaf，取决于我们把它放在什么样的hive操作符中。放在select中的基本就是udf，放在distribute
by和cluster by中的就是reducer。<br />
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">We can control if the script is run in a mapper or reducer </span><br><span class="line">step by the way we formulate our HiveQL query.</span><br><span class="line"></span><br><span class="line">The statements DISTRIBUTE BY and CLUSTER BY allow us to </span><br><span class="line">indicate that we want to actually perform an aggregation.</span><br><span class="line"></span><br><span class="line">User-Defined Functions (UDFs) for transformations and </span><br><span class="line">even aggregations which are therefore called User-Defined Aggregation Functions (UDAFs)</span><br></pre></td></tr></table></figure></p>
<p><strong>UDF示例(运行java已经编写好的UDF)：</strong><br />
jar加载到hive环境中，jar可以在hdfs上，也可以在本地上。<br />
如果想永久使用，创建FUNCTION时指定jar地址。<br />
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">在hdfs中创建 /user/hive/lib目录</span></span><br><span class="line">hadoop fs -mkdir /user/hive/lib</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">把 hive目录下 lib/hive-contrib-hive-contrib-1.1.0-cdh5.7.0.jar 放到hdfs中</span></span><br><span class="line">hadoop fs -put hive-contrib-1.1.0-cdh5.7.0.jar /user/hive/lib/</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">把集群中jar包的位置添加到hive中</span></span><br><span class="line"><span class="meta prompt_">hive&gt; </span><span class="language-bash">add jar hdfs:///user/hive/lib/hive-contrib-1.1.0-cdh5.7.0.jar;</span></span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">在hive中创建**临时**UDF</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">CREATE TEMPORARY FUNCTION 自定义函数名字 as 自定义函数在jar包中的包名</span></span><br><span class="line"><span class="meta prompt_">hive&gt; </span><span class="language-bash">CREATE TEMPORARY FUNCTION row_sequence as <span class="string">&#x27;org.apache.hadoop.hive.contrib.udf.UDFRowSequence&#x27;</span></span></span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">在之前的案例中使用**临时**自定义函数(函数功能: 添加自增长的行号)</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">注意，临时的自定义函数，在退出hive后再进入hive就无效了</span></span><br><span class="line"><span class="meta prompt_">hive&gt; </span><span class="language-bash">Select row_sequence(),* from employee;</span></span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">创建**永久的**自定义函数</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">CREATE FUNCTION 自定义函数名字 as <span class="string">&#x27;自定义函数在jar包中的包名&#x27;</span> using jar <span class="string">&#x27;jar位置&#x27;</span>;</span></span><br><span class="line"><span class="meta prompt_">hive&gt; </span><span class="language-bash">CREATE FUNCTION row_sequence as <span class="string">&#x27;org.apache.hadoop.hive.contrib.udf.UDFRowSequence&#x27;</span> \</span></span><br><span class="line"><span class="language-bash">using jar <span class="string">&#x27;hdfs:///user/hive/lib/hive-contrib-1.1.0-cdh5.7.0.jar&#x27;</span>;</span></span><br></pre></td></tr></table></figure></p>
<p><strong>Python写UDF：</strong><br />
准备案例环境：<br />
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- 创建表</span></span><br><span class="line"><span class="keyword">CREATE</span> <span class="keyword">table</span> u2(fname STRING,lname STRING);</span><br><span class="line"><span class="comment">-- 向表中插入数据</span></span><br><span class="line"><span class="keyword">insert</span> <span class="keyword">into</span> <span class="keyword">table</span> u2 <span class="keyword">values</span>(<span class="string">&#x27;George&#x27;</span>,<span class="string">&#x27;washington&#x27;</span>);</span><br><span class="line"><span class="keyword">insert</span> <span class="keyword">into</span> <span class="keyword">table</span> u2 <span class="keyword">values</span>(<span class="string">&#x27;George&#x27;</span>,<span class="string">&#x27;bush&#x27;</span>);</span><br><span class="line"><span class="keyword">insert</span> <span class="keyword">into</span> <span class="keyword">table</span> u2 <span class="keyword">values</span>(<span class="string">&#x27;Bill&#x27;</span>,<span class="string">&#x27;clinton&#x27;</span>);</span><br><span class="line"><span class="keyword">insert</span> <span class="keyword">into</span> <span class="keyword">table</span> u2 <span class="keyword">values</span>(<span class="string">&#x27;Bill&#x27;</span>,<span class="string">&#x27;gates&#x27;</span>);</span><br></pre></td></tr></table></figure></p>
<p>编写map风格脚本：<br />
<figure class="highlight python"><figcaption><span>udf.py</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> sys</span><br><span class="line"><span class="keyword">for</span> line <span class="keyword">in</span> sys.stdin:</span><br><span class="line">    line = line.strip()</span><br><span class="line">    fname , lname = line.split(<span class="string">&#x27;\t&#x27;</span>)</span><br><span class="line">    l_name = lname.upper()</span><br><span class="line">    <span class="built_in">print</span> <span class="string">&#x27;\t&#x27;</span>.join([fname, <span class="built_in">str</span>(l_name)])</span><br></pre></td></tr></table></figure></p>
<p>通过hdfs向hive中ADD file：<br />
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">第一种方式</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">加载文件到hdfs</span></span><br><span class="line">hadoop fs -put udf.py /user/hive/lib/</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">hive从hdfs中加载python脚本</span></span><br><span class="line">ADD FILE hdfs:///user/hive/lib/udf.py;</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">第二种方式</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">直接本地加载脚本</span></span><br><span class="line">ADD FILE /root/tmp/udf1.py;</span><br></pre></td></tr></table></figure></p>
<p>Transform使用Python udf脚本：<br />
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> TRANSFORM(fname, lname) <span class="keyword">USING</span> <span class="string">&#x27;python udf1.py&#x27;</span> <span class="keyword">AS</span> (fname, l_name) <span class="keyword">FROM</span> u2;</span><br></pre></td></tr></table></figure></p>
<h2 id="hive综合案例">Hive综合案例</h2>
<p>内容推荐数据处理：<br />
<img src="/images/Hive、Hbase/hive3.png"></p>
<p>需求：根据用户行为、文章标签，筛选出用户最感兴趣(阅读最多)的标签</p>
<p>用户行为数据（用户什么时间阅读了哪篇文章）：<br />
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">user_id article_id event_time</span><br><span class="line">11,101,2018-12-01 06:01:10</span><br><span class="line">22,102,2018-12-01 07:28:12</span><br><span class="line">33,103,2018-12-01 07:50:14</span><br><span class="line">11,104,2018-12-01 09:08:12</span><br><span class="line">22,103,2018-12-01 13:37:12</span><br><span class="line">33,102,2018-12-02 07:09:12</span><br><span class="line">11,101,2018-12-02 18:42:12</span><br><span class="line">35,105,2018-12-03 09:21:12</span><br><span class="line">22,104,2018-12-03 16:42:12</span><br><span class="line">77,103,2018-12-03 18:31:12</span><br><span class="line">99,102,2018-12-04 00:04:12</span><br><span class="line">33,101,2018-12-04 19:10:12</span><br><span class="line">11,101,2018-12-05 09:07:12</span><br><span class="line">35,102,2018-12-05 11:00:12</span><br><span class="line">22,103,2018-12-05 12:11:12</span><br><span class="line">77,104,2018-12-05 18:02:02</span><br><span class="line">99,105,2018-12-05 20:09:11</span><br></pre></td></tr></table></figure></p>
<p>文章数据：<br />
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">artical_id,artical_url,artical_keywords</span><br><span class="line">101,http://www.itcast.cn/1.html,kw8|kw1</span><br><span class="line">102,http://www.itcast.cn/2.html,kw6|kw3</span><br><span class="line">103,http://www.itcast.cn/3.html,kw7</span><br><span class="line">104,http://www.itcast.cn/4.html,kw5|kw1|kw4|kw9</span><br><span class="line">105,http://www.itcast.cn/5.html,</span><br></pre></td></tr></table></figure></p>
<p>数据上传hdfs：<br />
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">hadoop fs -mkdir /tmp/demo</span><br><span class="line">hadoop fs -mkdir /tmp/demo/user_action</span><br></pre></td></tr></table></figure></p>
<p>创建外部表：<br />
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- 用户行为表user_actions</span></span><br><span class="line"><span class="keyword">drop</span> <span class="keyword">table</span> if <span class="keyword">exists</span> user_actions;</span><br><span class="line"><span class="keyword">CREATE</span> <span class="keyword">EXTERNAL</span> <span class="keyword">TABLE</span> user_actions(</span><br><span class="line">    user_id STRING,</span><br><span class="line">    article_id STRING,</span><br><span class="line">    time_stamp STRING</span><br><span class="line">)</span><br><span class="line"><span class="type">ROW</span> FORMAT delimited fields terminated <span class="keyword">by</span> <span class="string">&#x27;,&#x27;</span></span><br><span class="line">LOCATION <span class="string">&#x27;/tmp/demo/user_action&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 文章表articles</span></span><br><span class="line"><span class="keyword">drop</span> <span class="keyword">table</span> if <span class="keyword">exists</span> articles;</span><br><span class="line">  <span class="keyword">CREATE</span> <span class="keyword">EXTERNAL</span> <span class="keyword">TABLE</span> articles(</span><br><span class="line">      article_id STRING,</span><br><span class="line">      url STRING,</span><br><span class="line">      key_words <span class="keyword">array</span><span class="operator">&lt;</span>STRING<span class="operator">&gt;</span></span><br><span class="line">  )</span><br><span class="line">  <span class="type">ROW</span> FORMAT delimited fields terminated <span class="keyword">by</span> <span class="string">&#x27;,&#x27;</span> </span><br><span class="line">  COLLECTION ITEMS terminated <span class="keyword">BY</span> <span class="string">&#x27;|&#x27;</span> </span><br><span class="line">  LOCATION <span class="string">&#x27;/tmp/demo/article_keywords&#x27;</span>;</span><br><span class="line">  <span class="comment">/*</span></span><br><span class="line"><span class="comment">  key_words array&lt;STRING&gt;  数组的数据类型</span></span><br><span class="line"><span class="comment">  COLLECTION ITEMS terminated BY &#x27;|&#x27;  数组的元素之间用&#x27;|&#x27;分割</span></span><br><span class="line"><span class="comment">  */</span></span><br></pre></td></tr></table></figure></p>
<p>查看数据：<br />
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> <span class="operator">*</span> <span class="keyword">from</span> user_actions;</span><br><span class="line"><span class="keyword">select</span> <span class="operator">*</span> <span class="keyword">from</span> articles;</span><br></pre></td></tr></table></figure></p>
<p>分组查询每个用户的浏览记录：<br />
collect_set/collect_list：将group
by中的某列转为一个数组返回。collect_list<strong>不去重</strong>而collect_set<strong>去重</strong>。<br />
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- collect_set</span></span><br><span class="line"><span class="keyword">select</span> user_id,collect_set(article_id) </span><br><span class="line"><span class="keyword">from</span> user_actions <span class="keyword">group</span> <span class="keyword">by</span> user_id;</span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">11      [&quot;101&quot;,&quot;104&quot;]</span></span><br><span class="line"><span class="string">22      [&quot;102&quot;,&quot;103&quot;,&quot;104&quot;]</span></span><br><span class="line"><span class="string">33      [&quot;103&quot;,&quot;102&quot;,&quot;101&quot;]</span></span><br><span class="line"><span class="string">35      [&quot;105&quot;,&quot;102&quot;]</span></span><br><span class="line"><span class="string">77      [&quot;103&quot;,&quot;104&quot;]</span></span><br><span class="line"><span class="string">99      [&quot;102&quot;,&quot;105&quot;]</span></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br></pre></td></tr></table></figure></p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- collect_list</span></span><br><span class="line"><span class="keyword">select</span> user_id,collect_list(article_id) </span><br><span class="line"><span class="keyword">from</span> user_actions <span class="keyword">group</span> <span class="keyword">by</span> user_id;</span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">11      [&quot;101&quot;,&quot;104&quot;,&quot;101&quot;,&quot;101&quot;]</span></span><br><span class="line"><span class="string">22      [&quot;102&quot;,&quot;103&quot;,&quot;104&quot;,&quot;103&quot;]</span></span><br><span class="line"><span class="string">33      [&quot;103&quot;,&quot;102&quot;,&quot;101&quot;]</span></span><br><span class="line"><span class="string">35      [&quot;105&quot;,&quot;102&quot;]</span></span><br><span class="line"><span class="string">77      [&quot;103&quot;,&quot;104&quot;]</span></span><br><span class="line"><span class="string">99      [&quot;102&quot;,&quot;105&quot;]</span></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br></pre></td></tr></table></figure>
<p>对数组排序：<br />
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- 对数组排序：sort_array</span></span><br><span class="line"><span class="keyword">select</span> user_id,sort_array(collect_list(article_id)) <span class="keyword">as</span> contents </span><br><span class="line"><span class="keyword">from</span> user_actions <span class="keyword">group</span> <span class="keyword">by</span> user_id;</span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">11      [&quot;101&quot;,&quot;101&quot;,&quot;101&quot;,&quot;104&quot;]</span></span><br><span class="line"><span class="string">22      [&quot;102&quot;,&quot;103&quot;,&quot;103&quot;,&quot;104&quot;]</span></span><br><span class="line"><span class="string">33      [&quot;101&quot;,&quot;102&quot;,&quot;103&quot;]</span></span><br><span class="line"><span class="string">35      [&quot;102&quot;,&quot;105&quot;]</span></span><br><span class="line"><span class="string">77      [&quot;103&quot;,&quot;104&quot;]</span></span><br><span class="line"><span class="string">99      [&quot;102&quot;,&quot;105&quot;]</span></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br></pre></td></tr></table></figure></p>
<p>查看每一篇文章的关键字，按标签拆分：lateral view explode<br />
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- explode函数 将 array 拆分</span></span><br><span class="line"><span class="keyword">select</span> explode(key_words) <span class="keyword">from</span> articles;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- lateral view 和 explode 配合使用,将一行数据拆分成多行数据,在此基础上可以对拆分的数据进行聚合</span></span><br><span class="line"><span class="keyword">select</span> article_id,kw <span class="keyword">from</span> articles <span class="keyword">lateral</span> <span class="keyword">view</span> explode(key_words) t <span class="keyword">as</span> kw;</span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">101     kw8</span></span><br><span class="line"><span class="string">101     kw1</span></span><br><span class="line"><span class="string">102     kw6</span></span><br><span class="line"><span class="string">102     kw3</span></span><br><span class="line"><span class="string">103     kw7</span></span><br><span class="line"><span class="string">104     kw5</span></span><br><span class="line"><span class="string">104     kw1</span></span><br><span class="line"><span class="string">104     kw4</span></span><br><span class="line"><span class="string">104     kw9</span></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="comment">-- outer保留空array</span></span><br><span class="line"><span class="keyword">select</span> article_id,kw <span class="keyword">from</span> articles <span class="keyword">lateral</span> <span class="keyword">view</span> <span class="keyword">outer</span> explode(key_words) t <span class="keyword">as</span> kw;</span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">101     kw8</span></span><br><span class="line"><span class="string">101     kw1</span></span><br><span class="line"><span class="string">102     kw6</span></span><br><span class="line"><span class="string">102     kw3</span></span><br><span class="line"><span class="string">103     kw7</span></span><br><span class="line"><span class="string">104     kw5</span></span><br><span class="line"><span class="string">104     kw1</span></span><br><span class="line"><span class="string">104     kw4</span></span><br><span class="line"><span class="string">104     kw9</span></span><br><span class="line"><span class="string">105     NULL</span></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br></pre></td></tr></table></figure></p>
<p>根据文章id找到用户查看文章的关键字：<br />
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">原始数据</span></span><br><span class="line">101     http://www.itcast.cn/1.html     [&quot;kw8&quot;,&quot;kw1&quot;]</span><br><span class="line">102     http://www.itcast.cn/2.html     [&quot;kw6&quot;,&quot;kw3&quot;]</span><br><span class="line">103     http://www.itcast.cn/3.html     [&quot;kw7&quot;]</span><br><span class="line">104     http://www.itcast.cn/4.html     [&quot;kw5&quot;,&quot;kw1&quot;,&quot;kw4&quot;,&quot;kw9&quot;]</span><br><span class="line">105     http://www.itcast.cn/5.html     []</span><br></pre></td></tr></table></figure></p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> a.user_id, b.kw <span class="keyword">from</span> user_actions </span><br><span class="line"><span class="keyword">as</span> a <span class="keyword">left</span> <span class="keyword">outer</span> <span class="keyword">JOIN</span> (<span class="keyword">select</span> article_id,kw <span class="keyword">from</span> articles</span><br><span class="line"><span class="keyword">lateral</span> <span class="keyword">view</span> <span class="keyword">outer</span> explode(key_words) t <span class="keyword">as</span> kw) b</span><br><span class="line"><span class="keyword">on</span> (a.article_id <span class="operator">=</span> b.article_id)</span><br><span class="line"><span class="keyword">order</span> <span class="keyword">by</span> a.user_id;</span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">11      kw1</span></span><br><span class="line"><span class="string">11      kw8</span></span><br><span class="line"><span class="string">11      kw5</span></span><br><span class="line"><span class="string">11      kw1</span></span><br><span class="line"><span class="string">11      kw4</span></span><br><span class="line"><span class="string">11      kw1</span></span><br><span class="line"><span class="string">11      kw9</span></span><br><span class="line"><span class="string">11      kw8</span></span><br><span class="line"><span class="string">11      kw1</span></span><br><span class="line"><span class="string">11      kw8</span></span><br><span class="line"><span class="string">22      kw1</span></span><br><span class="line"><span class="string">22      kw7</span></span><br><span class="line"><span class="string">22      kw9</span></span><br><span class="line"><span class="string">22      kw4</span></span><br><span class="line"><span class="string">22      kw5</span></span><br><span class="line"><span class="string">22      kw7</span></span><br><span class="line"><span class="string">22      kw3</span></span><br><span class="line"><span class="string">22      kw6</span></span><br><span class="line"><span class="string">33      kw8</span></span><br><span class="line"><span class="string">33      kw1</span></span><br><span class="line"><span class="string">33      kw3</span></span><br><span class="line"><span class="string">33      kw6</span></span><br><span class="line"><span class="string">33      kw7</span></span><br><span class="line"><span class="string">35      NULL</span></span><br><span class="line"><span class="string">35      kw6</span></span><br><span class="line"><span class="string">35      kw3</span></span><br><span class="line"><span class="string">77      kw9</span></span><br><span class="line"><span class="string">77      kw1</span></span><br><span class="line"><span class="string">77      kw7</span></span><br><span class="line"><span class="string">77      kw4</span></span><br><span class="line"><span class="string">77      kw5</span></span><br><span class="line"><span class="string">99      kw3</span></span><br><span class="line"><span class="string">99      kw6</span></span><br><span class="line"><span class="string">99      NULL</span></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br></pre></td></tr></table></figure>
<p>根据文章id找到用户查看文章的关键字并统计频率：<br />
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> a.user_id, b.kw,<span class="built_in">count</span>(<span class="number">1</span>) <span class="keyword">as</span> weight </span><br><span class="line"><span class="keyword">from</span> user_actions <span class="keyword">as</span> a </span><br><span class="line"><span class="keyword">left</span> <span class="keyword">outer</span> <span class="keyword">JOIN</span> (<span class="keyword">select</span> article_id,kw <span class="keyword">from</span> articles</span><br><span class="line"><span class="keyword">lateral</span> <span class="keyword">view</span> <span class="keyword">outer</span> explode(key_words) t <span class="keyword">as</span> kw) b</span><br><span class="line"><span class="keyword">on</span> (a.article_id <span class="operator">=</span> b.article_id)</span><br><span class="line"><span class="keyword">group</span> <span class="keyword">by</span> a.user_id,b.kw </span><br><span class="line"><span class="keyword">order</span> <span class="keyword">by</span> a.user_id,weight <span class="keyword">desc</span>;</span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">11      kw1     4</span></span><br><span class="line"><span class="string">11      kw8     3</span></span><br><span class="line"><span class="string">11      kw5     1</span></span><br><span class="line"><span class="string">11      kw9     1</span></span><br><span class="line"><span class="string">11      kw4     1</span></span><br><span class="line"><span class="string">22      kw7     2</span></span><br><span class="line"><span class="string">22      kw9     1</span></span><br><span class="line"><span class="string">22      kw1     1</span></span><br><span class="line"><span class="string">22      kw3     1</span></span><br><span class="line"><span class="string">22      kw4     1</span></span><br><span class="line"><span class="string">22      kw5     1</span></span><br><span class="line"><span class="string">22      kw6     1</span></span><br><span class="line"><span class="string">33      kw3     1</span></span><br><span class="line"><span class="string">33      kw8     1</span></span><br><span class="line"><span class="string">33      kw7     1</span></span><br><span class="line"><span class="string">33      kw6     1</span></span><br><span class="line"><span class="string">33      kw1     1</span></span><br><span class="line"><span class="string">35      NULL    1</span></span><br><span class="line"><span class="string">35      kw3     1</span></span><br><span class="line"><span class="string">35      kw6     1</span></span><br><span class="line"><span class="string">77      kw1     1</span></span><br><span class="line"><span class="string">77      kw4     1</span></span><br><span class="line"><span class="string">77      kw5     1</span></span><br><span class="line"><span class="string">77      kw7     1</span></span><br><span class="line"><span class="string">77      kw9     1</span></span><br><span class="line"><span class="string">99      NULL    1</span></span><br><span class="line"><span class="string">99      kw3     1</span></span><br><span class="line"><span class="string">99      kw6     1</span></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br></pre></td></tr></table></figure></p>
<p>CONCAT：返回结果为连接参数产生的字符串。如有任何一个参数为NULL
，则返回值为NULL。<br />
CONCAT_WS：CONCAT With
Separator，是CONCAT()的特殊形式。第一个参数是其它参数的分隔符。分隔符的位置放在要连接的两个字符串之间。分隔符可以是一个字符串，也可以是其它参数。如果分隔符为
NULL，则结果为 NULL。<br />
比如，用户id和文章id做成kv对，使用下面任意一种方法都可以：<br />
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- CONCAT(str1,str2,…)  </span></span><br><span class="line"><span class="keyword">select</span> concat(user_id,<span class="string">&#x27;:&#x27;</span>,article_id) <span class="keyword">from</span> user_actions;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- CONCAT_WS(separator,str1,str2,…)</span></span><br><span class="line"><span class="keyword">select</span> concat_ws(<span class="string">&#x27;:&#x27;</span>,user_id,article_id) <span class="keyword">from</span> user_actions;</span><br></pre></td></tr></table></figure></p>
<p>现在将用户查看的关键字和频率合并成kv对形式：<br />
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> a.user_id, concat_ws(<span class="string">&#x27;:&#x27;</span>,b.kw,<span class="built_in">cast</span> (<span class="built_in">count</span>(<span class="number">1</span>) <span class="keyword">as</span> string)) <span class="keyword">as</span> kw_w </span><br><span class="line"><span class="keyword">from</span> user_actions <span class="keyword">as</span> a </span><br><span class="line"><span class="keyword">left</span> <span class="keyword">outer</span> <span class="keyword">JOIN</span> (<span class="keyword">select</span> article_id,kw <span class="keyword">from</span> articles</span><br><span class="line"><span class="keyword">lateral</span> <span class="keyword">view</span> <span class="keyword">outer</span> explode(key_words) t <span class="keyword">as</span> kw) b</span><br><span class="line"><span class="keyword">on</span> (a.article_id <span class="operator">=</span> b.article_id)</span><br><span class="line"><span class="keyword">group</span> <span class="keyword">by</span> a.user_id,b.kw;</span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">11      kw1:4</span></span><br><span class="line"><span class="string">11      kw4:1</span></span><br><span class="line"><span class="string">11      kw5:1</span></span><br><span class="line"><span class="string">11      kw8:3</span></span><br><span class="line"><span class="string">11      kw9:1</span></span><br><span class="line"><span class="string">22      kw1:1</span></span><br><span class="line"><span class="string">22      kw3:1</span></span><br><span class="line"><span class="string">22      kw4:1</span></span><br><span class="line"><span class="string">22      kw5:1</span></span><br><span class="line"><span class="string">22      kw6:1</span></span><br><span class="line"><span class="string">22      kw7:2</span></span><br><span class="line"><span class="string">22      kw9:1</span></span><br><span class="line"><span class="string">33      kw1:1</span></span><br><span class="line"><span class="string">33      kw3:1</span></span><br><span class="line"><span class="string">33      kw6:1</span></span><br><span class="line"><span class="string">33      kw7:1</span></span><br><span class="line"><span class="string">33      kw8:1</span></span><br><span class="line"><span class="string">35      1</span></span><br><span class="line"><span class="string">35      kw3:1</span></span><br><span class="line"><span class="string">35      kw6:1</span></span><br><span class="line"><span class="string">77      kw1:1</span></span><br><span class="line"><span class="string">77      kw4:1</span></span><br><span class="line"><span class="string">77      kw5:1</span></span><br><span class="line"><span class="string">77      kw7:1</span></span><br><span class="line"><span class="string">77      kw9:1</span></span><br><span class="line"><span class="string">99      1</span></span><br><span class="line"><span class="string">99      kw3:1</span></span><br><span class="line"><span class="string">99      kw6:1</span></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br></pre></td></tr></table></figure></p>
<p>将用户查看的关键字和频率合并成kv对形式并按用户id聚合：<br />
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> cc.user_id,concat_ws(<span class="string">&#x27;,&#x27;</span>,collect_set(cc.kw_w))</span><br><span class="line"><span class="keyword">from</span>(</span><br><span class="line"><span class="keyword">select</span> a.user_id, concat_ws(<span class="string">&#x27;:&#x27;</span>,b.kw,<span class="built_in">cast</span> (<span class="built_in">count</span>(<span class="number">1</span>) <span class="keyword">as</span> string)) <span class="keyword">as</span> kw_w </span><br><span class="line"><span class="keyword">from</span> user_actions <span class="keyword">as</span> a </span><br><span class="line"><span class="keyword">left</span> <span class="keyword">outer</span> <span class="keyword">JOIN</span> (<span class="keyword">select</span> article_id,kw <span class="keyword">from</span> articles</span><br><span class="line"><span class="keyword">lateral</span> <span class="keyword">view</span> <span class="keyword">outer</span> explode(key_words) t <span class="keyword">as</span> kw) b </span><br><span class="line"><span class="keyword">on</span> (a.article_id <span class="operator">=</span> b.article_id)</span><br><span class="line"><span class="keyword">group</span> <span class="keyword">by</span> a.user_id,b.kw</span><br><span class="line">) <span class="keyword">as</span> cc </span><br><span class="line"><span class="keyword">group</span> <span class="keyword">by</span> cc.user_id;</span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">11      kw1:4,kw4:1,kw5:1,kw8:3,kw9:1</span></span><br><span class="line"><span class="string">22      kw1:1,kw3:1,kw4:1,kw5:1,kw6:1,kw7:2,kw9:1</span></span><br><span class="line"><span class="string">33      kw1:1,kw3:1,kw6:1,kw7:1,kw8:1</span></span><br><span class="line"><span class="string">35      1,kw3:1,kw6:1</span></span><br><span class="line"><span class="string">77      kw1:1,kw4:1,kw5:1,kw7:1,kw9:1</span></span><br><span class="line"><span class="string">99      1,kw3:1,kw6:1</span></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br></pre></td></tr></table></figure></p>
<p>将上面聚合结果转换成map：<br />
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- str_to_map转换成map</span></span><br><span class="line"><span class="keyword">select</span> cc.user_id,str_to_map(concat_ws(<span class="string">&#x27;,&#x27;</span>,collect_set(cc.kw_w))) <span class="keyword">as</span> wm</span><br><span class="line"><span class="keyword">from</span>(</span><br><span class="line"><span class="keyword">select</span> a.user_id, concat_ws(<span class="string">&#x27;:&#x27;</span>,b.kw,<span class="built_in">cast</span> (<span class="built_in">count</span>(<span class="number">1</span>) <span class="keyword">as</span> string)) <span class="keyword">as</span> kw_w </span><br><span class="line"><span class="keyword">from</span> user_actions <span class="keyword">as</span> a </span><br><span class="line"><span class="keyword">left</span> <span class="keyword">outer</span> <span class="keyword">JOIN</span> (<span class="keyword">select</span> article_id,kw <span class="keyword">from</span> articles</span><br><span class="line"><span class="keyword">lateral</span> <span class="keyword">view</span> <span class="keyword">outer</span> explode(key_words) t <span class="keyword">as</span> kw) b</span><br><span class="line"><span class="keyword">on</span> (a.article_id <span class="operator">=</span> b.article_id)</span><br><span class="line"><span class="keyword">group</span> <span class="keyword">by</span> a.user_id,b.kw</span><br><span class="line">) <span class="keyword">as</span> cc </span><br><span class="line"><span class="keyword">group</span> <span class="keyword">by</span> cc.user_id;</span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">11      &#123;&quot;kw1&quot;:&quot;4&quot;,&quot;kw4&quot;:&quot;1&quot;,&quot;kw5&quot;:&quot;1&quot;,&quot;kw8&quot;:&quot;3&quot;,&quot;kw9&quot;:&quot;1&quot;&#125;</span></span><br><span class="line"><span class="string">22      &#123;&quot;kw1&quot;:&quot;1&quot;,&quot;kw3&quot;:&quot;1&quot;,&quot;kw4&quot;:&quot;1&quot;,&quot;kw5&quot;:&quot;1&quot;,&quot;kw6&quot;:&quot;1&quot;,&quot;kw7&quot;:&quot;2&quot;,&quot;kw9&quot;:&quot;1&quot;&#125;</span></span><br><span class="line"><span class="string">33      &#123;&quot;kw1&quot;:&quot;1&quot;,&quot;kw3&quot;:&quot;1&quot;,&quot;kw6&quot;:&quot;1&quot;,&quot;kw7&quot;:&quot;1&quot;,&quot;kw8&quot;:&quot;1&quot;&#125;</span></span><br><span class="line"><span class="string">35      &#123;&quot;1&quot;:null,&quot;kw3&quot;:&quot;1&quot;,&quot;kw6&quot;:&quot;1&quot;&#125;</span></span><br><span class="line"><span class="string">77      &#123;&quot;kw1&quot;:&quot;1&quot;,&quot;kw4&quot;:&quot;1&quot;,&quot;kw5&quot;:&quot;1&quot;,&quot;kw7&quot;:&quot;1&quot;,&quot;kw9&quot;:&quot;1&quot;&#125;</span></span><br><span class="line"><span class="string">99      &#123;&quot;1&quot;:null,&quot;kw3&quot;:&quot;1&quot;,&quot;kw6&quot;:&quot;1&quot;&#125;</span></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br></pre></td></tr></table></figure></p>
<p>将用户的阅读偏好结果保存到表中：<br />
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">create</span> <span class="keyword">table</span> user_kws <span class="keyword">as</span> </span><br><span class="line"><span class="keyword">select</span> cc.user_id,str_to_map(concat_ws(<span class="string">&#x27;,&#x27;</span>,collect_set(cc.kw_w))) <span class="keyword">as</span> wm</span><br><span class="line"><span class="keyword">from</span>(</span><br><span class="line"><span class="keyword">select</span> a.user_id, concat_ws(<span class="string">&#x27;:&#x27;</span>,b.kw,<span class="built_in">cast</span> (<span class="built_in">count</span>(<span class="number">1</span>) <span class="keyword">as</span> string)) <span class="keyword">as</span> kw_w </span><br><span class="line"><span class="keyword">from</span> user_actions <span class="keyword">as</span> a </span><br><span class="line"><span class="keyword">left</span> <span class="keyword">outer</span> <span class="keyword">JOIN</span> (<span class="keyword">select</span> article_id,kw <span class="keyword">from</span> articles</span><br><span class="line"><span class="keyword">lateral</span> <span class="keyword">view</span> <span class="keyword">outer</span> explode(key_words) t <span class="keyword">as</span> kw) b</span><br><span class="line"><span class="keyword">on</span> (a.article_id <span class="operator">=</span> b.article_id)</span><br><span class="line"><span class="keyword">group</span> <span class="keyword">by</span> a.user_id,b.kw</span><br><span class="line">) <span class="keyword">as</span> cc </span><br><span class="line"><span class="keyword">group</span> <span class="keyword">by</span> cc.user_id;</span><br></pre></td></tr></table></figure></p>
<p>从表中通过key查询map中的值：<br />
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> user_id, wm[<span class="string">&#x27;kw1&#x27;</span>] <span class="keyword">from</span> user_kws;</span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">11      4</span></span><br><span class="line"><span class="string">22      1</span></span><br><span class="line"><span class="string">33      1</span></span><br><span class="line"><span class="string">35      NULL</span></span><br><span class="line"><span class="string">77      1</span></span><br><span class="line"><span class="string">99      NULL</span></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br></pre></td></tr></table></figure></p>
<p>从表中获取map中所有的 key 和 所有的value :<br />
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> user_id,map_keys(wm),map_values(wm) <span class="keyword">from</span> user_kws;</span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">11      [&quot;kw1&quot;,&quot;kw4&quot;,&quot;kw5&quot;,&quot;kw8&quot;,&quot;kw9&quot;] [&quot;4&quot;,&quot;1&quot;,&quot;1&quot;,&quot;3&quot;,&quot;1&quot;]</span></span><br><span class="line"><span class="string">22      [&quot;kw1&quot;,&quot;kw3&quot;,&quot;kw4&quot;,&quot;kw5&quot;,&quot;kw6&quot;,&quot;kw7&quot;,&quot;kw9&quot;]     [&quot;1&quot;,&quot;1&quot;,&quot;1&quot;,&quot;1&quot;,&quot;1&quot;,&quot;2&quot;,&quot;1&quot;]</span></span><br><span class="line"><span class="string">33      [&quot;kw1&quot;,&quot;kw3&quot;,&quot;kw6&quot;,&quot;kw7&quot;,&quot;kw8&quot;] [&quot;1&quot;,&quot;1&quot;,&quot;1&quot;,&quot;1&quot;,&quot;1&quot;]</span></span><br><span class="line"><span class="string">35      [&quot;1&quot;,&quot;kw3&quot;,&quot;kw6&quot;]       [null,&quot;1&quot;,&quot;1&quot;]</span></span><br><span class="line"><span class="string">77      [&quot;kw1&quot;,&quot;kw4&quot;,&quot;kw5&quot;,&quot;kw7&quot;,&quot;kw9&quot;] [&quot;1&quot;,&quot;1&quot;,&quot;1&quot;,&quot;1&quot;,&quot;1&quot;]</span></span><br><span class="line"><span class="string">99      [&quot;1&quot;,&quot;kw3&quot;,&quot;kw6&quot;]       [null,&quot;1&quot;,&quot;1&quot;]</span></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br></pre></td></tr></table></figure></p>
<p>用lateral view explode把map中的数据转换成多列：<br />
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> user_id,keyword,weight <span class="keyword">from</span> user_kws <span class="keyword">lateral</span> <span class="keyword">view</span> explode(wm) t <span class="keyword">as</span> keyword,weight;</span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">11      kw1     4</span></span><br><span class="line"><span class="string">11      kw4     1</span></span><br><span class="line"><span class="string">11      kw5     1</span></span><br><span class="line"><span class="string">11      kw8     3</span></span><br><span class="line"><span class="string">11      kw9     1</span></span><br><span class="line"><span class="string">22      kw1     1</span></span><br><span class="line"><span class="string">22      kw3     1</span></span><br><span class="line"><span class="string">22      kw4     1</span></span><br><span class="line"><span class="string">22      kw5     1</span></span><br><span class="line"><span class="string">22      kw6     1</span></span><br><span class="line"><span class="string">22      kw7     2</span></span><br><span class="line"><span class="string">22      kw9     1</span></span><br><span class="line"><span class="string">33      kw1     1</span></span><br><span class="line"><span class="string">33      kw3     1</span></span><br><span class="line"><span class="string">33      kw6     1</span></span><br><span class="line"><span class="string">33      kw7     1</span></span><br><span class="line"><span class="string">33      kw8     1</span></span><br><span class="line"><span class="string">35      1       NULL</span></span><br><span class="line"><span class="string">35      kw3     1</span></span><br><span class="line"><span class="string">35      kw6     1</span></span><br><span class="line"><span class="string">77      kw1     1</span></span><br><span class="line"><span class="string">77      kw4     1</span></span><br><span class="line"><span class="string">77      kw5     1</span></span><br><span class="line"><span class="string">77      kw7     1</span></span><br><span class="line"><span class="string">77      kw9     1</span></span><br><span class="line"><span class="string">99      1       NULL</span></span><br><span class="line"><span class="string">99      kw3     1</span></span><br><span class="line"><span class="string">99      kw6     1</span></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br></pre></td></tr></table></figure></p>
<h1 id="sqoop概述">Sqoop概述</h1>
<p>什么是Sqoop？<br />
（1）Sqoop
是一款进行数据传输的工具，可在hadoop的hdfs&lt;==&gt;关系型数据库之间传输数据。<br />
（2）Sqoop把数据从MySQL或Oracle导入到hdfs中，也可以把数据从hdfs导入到MySQL或Oracle中。<br />
（3）Sqoop可自动执行数据传输的大部分过程，它会把sqoop命令翻译成MapReduce来连接各种数据源实现数据的传递，使用MapReduce导入和导出数据，提供并行操作和容错。</p>
<p>为什么要使用sqoop?<br />
（1）快速实现Hadoop(HDFS/hive/hbase)与mysql/Oracle等关系型数据库之间的数据传递。<br />
（2）Sqoop提供多种数据传输方式。</p>
<p>Sqoop原理：<br />
<img src="/images/Hive、Hbase/sqoop.png" width="50%" height="50%"></p>
<h2 id="sqoop安装">Sqoop安装</h2>
<p>下载<span class="exturl" data-url="aHR0cDovL2FyY2hpdmUuY2xvdWRlcmEuY29tL2NkaDUvY2RoLzUvc3Fvb3AtMS40LjYtY2RoNS43LjAudGFyLmd6">安装包<i class="fa fa-external-link-alt"></i></span>
，解压到centos中：<br />
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ tar -zxvf /home/hadoop/software/sqoop-1.4.6-cdh5.7.0.tar.gz  -C ~/app/</span><br></pre></td></tr></table></figure></p>
<p>配置环境变量：<br />
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_">$ </span><span class="language-bash">vi ~/.bash_profile</span></span><br><span class="line">export SQOOP_HOME=/home/hadoop/app/sqoop-1.4.6-cdh5.7.0</span><br><span class="line">export PATH=$SQOOP_HOME/bin:$PATH</span><br></pre></td></tr></table></figure></p>
<p>激活环境变量：<br />
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">source ~/.bash_profile</span><br></pre></td></tr></table></figure></p>
<p>到 <code>$SQOOP_HOME/conf</code>
目录下配置<code>sqoop_env.sh</code>：<br />
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_">$ </span><span class="language-bash"><span class="built_in">cp</span> sqoop-env-template.sh sqoop-env.sh</span></span><br><span class="line"><span class="meta prompt_">$ </span><span class="language-bash">vi sqoop-env.sh</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">在sqoop_env.sh中添加：</span></span><br><span class="line">export HADOOP_COMMON_HOME=/home/hadoop/app/hadoop-2.6.0-cdh5.7.0/</span><br><span class="line">export HADOOP_MAPRED_HOME=/home/hadoop/app/hadoop-2.6.0-cdh5.7.0/</span><br><span class="line">export HIVE_HOME=/home/hadoop/app/hive-1.1.0-cdh5.7.0/</span><br></pre></td></tr></table></figure></p>
<p>拷贝mysql驱动到<code>$SQOOP_HOME/lib</code>目录下：<br />
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_">$ </span><span class="language-bash"><span class="built_in">cp</span> /home/hadoop/app/hive-1.1.0-cdh5.7.0/lib/mysql-connector-java-5.1.47.jar /home/hadoop/app/sqoop-1.4.6-cdh5.7.0/lib/</span></span><br></pre></td></tr></table></figure></p>
<p>测试sqoop环境：<br />
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">sqoop-version</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">看到如下输出 说明sqoop安装成功</span></span><br><span class="line">&#x27;&#x27;&#x27;</span><br><span class="line">Sqoop 1.4.6-cdh5.7.0</span><br><span class="line">git commit id</span><br><span class="line">Compiled by jenkins on ******</span><br><span class="line">&#x27;&#x27;&#x27;</span><br></pre></td></tr></table></figure></p>
<h2 id="使用sqoop导入数据到hdfs中">使用Sqoop导入数据到hdfs中</h2>
<p>准备mysql数据:<br />
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- 建表u</span></span><br><span class="line"><span class="keyword">CREATE</span> <span class="keyword">table</span> u3(id <span class="type">int</span> <span class="keyword">PRIMARY</span> KEY AUTO_INCREMENT,fname <span class="type">varchar</span>(<span class="number">20</span>),lname <span class="type">varchar</span>(<span class="number">20</span>));</span><br><span class="line"></span><br><span class="line"><span class="comment">--插入数据</span></span><br><span class="line"><span class="keyword">insert</span> <span class="keyword">into</span> u3 (fname, lname) <span class="keyword">values</span>(<span class="string">&#x27;George&#x27;</span>,<span class="string">&#x27;washington&#x27;</span>);</span><br><span class="line"><span class="keyword">insert</span> <span class="keyword">into</span> u3 (fname, lname) <span class="keyword">values</span>(<span class="string">&#x27;George&#x27;</span>,<span class="string">&#x27;bush&#x27;</span>);</span><br><span class="line"><span class="keyword">insert</span> <span class="keyword">into</span> u3 (fname, lname) <span class="keyword">values</span>(<span class="string">&#x27;Bill&#x27;</span>,<span class="string">&#x27;clinton&#x27;</span>);</span><br><span class="line"><span class="keyword">insert</span> <span class="keyword">into</span> u3 (fname, lname) <span class="keyword">values</span>(<span class="string">&#x27;Bill&#x27;</span>,<span class="string">&#x27;gates&#x27;</span>);</span><br></pre></td></tr></table></figure></p>
<ul>
<li>Sqoop导入命令
<ul>
<li>命令语法：<code>sqoop import (控制参数) (导入参数)</code></li>
<li>命令元素：导入操作, 数据源, 访问方式, 导入控制, 目标地址</li>
<li>命令理解：数据从哪里来, 有什么控制, 到哪里去</li>
</ul></li>
</ul>
<p>使用Sqoop命令把表u3导入到hdfs上，默认导入到hdfs的<code>/user/linux用户名</code>文件夹下。<br />
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">jdbc:mysql://mysql数据库地址:3306/数据库名字</span> </span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">--table 要导出数据的表名</span> </span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">-m mrjob的数量，文件分成几份存储在hdfs上</span></span><br><span class="line"><span class="meta prompt_">$ </span><span class="language-bash">sqoop import --connect jdbc:mysql://127.0.0.1:3306/test --username root --password 123456 --table u3 -m 1</span></span><br></pre></td></tr></table></figure></p>
<p>添加<code>--target-dir</code>指定导出到hdfs上的地址：<br />
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">jdbc:mysql://mysql数据库地址:3306/数据库名字</span> </span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">--table 要导出数据的表名 -m mrjob的数量</span></span><br><span class="line"><span class="meta prompt_">$ </span><span class="language-bash">sqoop import --connect jdbc:mysql://127.0.0.1:3306/test --username root --password 123456 --table u3 --target-dir /tmp/u1 -m 1</span></span><br></pre></td></tr></table></figure></p>
<p>导入可能出现的问题：<br />
<img src="/images/Hive、Hbase/error.png"></p>
<p>解决方法1：上传<code>java-json.jar</code>到<code>$SQOOP_HOME/lib</code>目录下。注意,默认数据上传到hdfs的路径是<code>/user/当前linux用户名/mysql表名/</code>。<br />
解决方法2：通过hive建立外表导入数据到hive。<br />
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">CREATE</span> <span class="keyword">EXTERNAL</span> <span class="keyword">TABLE</span> u4(</span><br><span class="line">    id <span class="type">INT</span>,</span><br><span class="line">    fname STRING,</span><br><span class="line">    lname STRING</span><br><span class="line">)</span><br><span class="line"><span class="type">ROW</span> FORMAT delimited fields terminated <span class="keyword">by</span> <span class="string">&#x27;,&#x27;</span> </span><br><span class="line">LOCATION <span class="string">&#x27;/user/hadoop/u/&#x27;</span>;</span><br></pre></td></tr></table></figure></p>
<h1 id="hbase概述">HBase概述</h1>
<p><strong>1、什么是HBase？</strong><br />
（1）HBase是一个<strong>分布式的、面向列</strong>的开源数据库。<br />
（2）HBase是Google BigTable的开源实现。<br />
（3）HBase不同于一般的关系数据库, 适合非结构化数据存储。</p>
<p><strong>2、BigTable</strong><br />
（1）BigTable是Google设计的分布式数据存储系统，用来处理海量的数据的一种非关系型的数据库。<br />
（2）适合大规模海量数据，PB级数据；<br />
（3）分布式、并发数据处理，效率极高（可以支撑在线业务）；<br />
（4）易于扩展，支持动态伸缩；<br />
（5）适用于廉价设备；<br />
（6）不适用于传统关系型数据的存储；</p>
<p><strong>3、什么是非结构化数据存储？</strong><br />
（1）结构化数据：可预定义的数据模型，模型一旦确定不会经常变化（表结构不会频繁调整）；适合用二维表来展示的数据<br />
（2）非结构化数据：没有预定义的数据模型；数据结构不规则或不完整的；不方便用数据库二维逻辑表来表现；办公文档、文本、图片、XML,
HTML、各类报表、图像和音频/视频信息等</p>
<p><strong>4、HBase在Hadoop生态中的地位</strong><br />
（1）HBase是Apache基金会顶级项目<br />
（2）HBase基于HDFS进行数据存储<br />
（3）HBase可以存储超大数据并适合用来进行大数据的实时查询<br />
<img src="/images/Hive、Hbase/hbase&hive.png" width="50%" height="50%"></p>
<p><strong>5、Hive和Hbase共同点、区别？</strong><br />
（1）共同点：都可以处理海量数据；文件都是保存到hdfs上<br />
（2）区别：hive通过mapreduce实现数据查询功能，而hbase计算则不是，它自己实现的CRUD功能；hive只能做离线计算，hbase提供对数据的随机实时读/写访问功能；hbase可以有集群，集群的管理是通过zookeeper实现；HBase
对事务的支持，只支持行级别的事务；CAP定理；分区容错性，分布式系统都要有的特性，任何时候都要能提供服务P保证；HBase
CP系统 强一致性</p>
<p><strong>6、HBase与HDFS</strong><br />
（1）HBase建立在Hadoop文件系统上, 利用了HDFS的容错能力<br />
（2）HBase提供对数据的随机实时读/写访问功能<br />
（3）HBase内部使用哈希表, 并存储索引, 可以快速查找HDFS中数据</p>
<p><strong>7、HBase使用场景</strong><br />
（1）瞬间写入量很大<br />
（2）大量数据需要长期保存, 且数量会持续增长<br />
（3）HBase不适合有join, 多级索引, 表关系复杂的数据模型</p>
<h2 id="hbase与关系型数据库的区别">HBase与关系型数据库的区别</h2>
<table>
<tr>
<th>
</th>
<th>
HBase
</th>
<th>
关系型数据库
</th>
</tr>
<tr>
<td>
数据库大小
</td>
<td>
PB级别
</td>
<td>
GB TB
</td>
</tr>
<tr>
<td>
数据类型
</td>
<td>
Bytes
</td>
<td>
丰富的数据类型
</td>
</tr>
<tr>
<td>
事务支持
</td>
<td>
ACID只支持单个Row级别
</td>
<td>
全面的ACID支持, 对Row和表
</td>
</tr>
<tr>
<td>
索引
</td>
<td>
只支持Row-key
</td>
<td>
支持
</td>
</tr>
<tr>
<td>
吞吐量
</td>
<td>
百万写入/秒
</td>
<td>
数千写入/秒
</td>
</tr>
</table>
关系型数据库中：<br />

<table>
<tr>
<th>
ID
</th>
<th>
FILE NAME
</th>
<th>
FILE PATH
</th>
<th>
FILE TYPE
</th>
<th>
FILE SIZE
</th>
<th>
CREATOR
</th>
</tr>
<tr>
<td>
1
</td>
<td>
file1.txt
</td>
<td>
/home
</td>
<td>
txt
</td>
<td>
1024
</td>
<td>
tom
</td>
</tr>
<tr>
<td>
2
</td>
<td>
file2.txt
</td>
<td>
/home/pics
</td>
<td>
jpg
</td>
<td>
5032
</td>
<td>
jerry
</td>
</tr>
</table>
列式数据库中：<br />

<table>
<tr>
<th>
RowKey
</th>
<th>
FILE INFO
</th>
<th>
SAVE INFO
</th>
</tr>
<tr>
<td>
1
</td>
<td>
name:file1.txt<br><br />
type:txt<br><br />
size:1024
</td>
<td>
path:/home/pics<br><br />
creator:Jerry<br>
</td>
</tr>
<tr>
<td>
2
</td>
<td>
name:file2.jpg<br><br />
type:jpg<br><br />
size:5032
</td>
<td>
path:/home<br><br />
creator:Tom
</td>
</tr>
</table>
<p>行数据库、列数据库，存储方式比较：<br />
<img src="/images/Hive、Hbase/hbase4.png" width="60%" height="60%"></p>
<p><strong>1、ACID定义</strong><br />
指数据库事务正确执行的四个基本要素的缩写：<br />
（1）原子性
A：整个事务中的所有操作，要么全部完成，要么全部不完成，不可能停滞在中间某个环节。事务在执行过程中发生错误，会被回滚（Rollback）到事务开始前的状态，就像这个事务从来没有执行过一样。<br />
（2）一致性
C：一个事务可以封装状态改变（除非它是一个只读的）。事务必须始终保持系统处于一致的状态，不管在任何给定的时间[<strong>并发</strong>事务有多少。<br />
（3）隔离性
I：隔离状态执行事务，使它们好像是系统在给定时间内执行的唯一操作。如果有两个事务，运行在相同的时间内，执行相同的功能，事务的隔离性将确保每一事务在系统中认为只有该事务在使用系统。这种属性有时称为串行化，为了防止事务操作间的混淆，必须串行化或序列化请求，使得在同一时间仅有一个请求用于同一数据。<br />
（4）持久性
D：在事务完成以后，该事务对数据库所作的更改便持久的保存在数据库之中，并不会被回滚。</p>
<p><strong>HBase 支持特定场景下的 ACID，即对行级别的 操作保证完全的
ACID</strong>。</p>
<p><strong>2、cap定理</strong><br />
分布式系统的最大难点，就是各个节点的状态如何同步。CAP
定理是这方面的基本定理，也是理解分布式系统的起点。</p>
<p><strong>hbase是CAP中的CP系统,即hbase是强一致性的，牺牲了一定可用性（即会有延时）。</strong></p>
<ul>
<li><p><strong>一致性</strong>：所有节点在同一时间具有相同的数据。会牺牲一定可用性，因为需要一定时间同步数据。<br />
<img src="/images/Hive、Hbase/Consistency.png" width="30%" height="30%"></p></li>
<li><p><strong>可用性</strong>：保证每个请求不管成功或失败都有响应,但不保证获取的数据的正确性。如果请求立即响应，会牺牲一定一致性，因为立即响应返回的数据，不一定是同步的数据。</p></li>
<li><p><strong>分区容错性</strong>：系统中任意信息的丢失或失败不会影响系统的运行,系统如果不能在某个时限内达成数据一致性,就必须在上面两个操作之间做出选择。<br />
<img src="/images/Hive、Hbase/cap.jpg" width="30%" height="30%"></p></li>
</ul>
<h2 id="hbase的数据模型">HBase的数据模型</h2>
<ul>
<li><strong>NameSpace</strong>：关系型数据库的"数据库"(database)。</li>
<li><strong>表(table)</strong>：用于存储管理数据，具有稀疏的、面向列的特点。HBase中的每一张表，就是所谓的大表。(Bigtable)，可以有上亿行，上百万列。对于为值为空的列，并不占用存储空间，因此表可以设计的非常稀疏。</li>
<li><strong>行(Row)</strong>：在表里面,每一行代表着一个数据对象,每一行都是以一个行键(Row
Key)来进行唯一标识的, 行键并没有什么特定的数据类型,
以二进制的字节来存储。</li>
<li><strong>列(Column)</strong>：HBase的列由 Column family 和 Column
qualifier 指定, 由冒号:进行行间隔, 格式为 family: qualifier:
value。</li>
<li><strong>行键(RowKey)</strong>：类似于MySQL中的主键，HBase根据行键来快速检索数据，一个行键对应一条记录。与MySQL主键不同的是，HBase的行键是天然固有的，每一行数据都存在行键。</li>
<li><strong>列族(ColumnFamily)</strong>：是列的集合。列族在表定义时需要指定，而列在插入数据时动态指定。列中的数据都是以二进制形式存在，没有数据类型。在物理存储结构上，每个表中的每个列族单独以一个文件存储。一个表可以有多个列簇。</li>
<li><strong>列修饰符(Column
Qualifier)</strong>：列族中的数据通过列标识来进行映射,
可以理解为一个键值对。(key-value), 列修饰符(Column Qualifier) 就是key
对应关系型数据库的列。</li>
<li><strong>时间戳(TimeStamp)</strong>：是列的一个属性，是一个64位整数。由行键和列确定的单元格，可以存储多个数据，每个数据含有时间戳属性，数据具有版本特性。可根据版本(VERSIONS)或时间戳来指定查询历史版本数据，如果都不指定，则默认返回最新版本的数据。</li>
<li><strong>区域(Region)</strong>：HBase自动把表水平划分成的多个区域，划分的区域随着数据的增大而增多。</li>
<li>HBase支持特定场景下的 ACID，即对行级别的 操作保证完全的 ACID。</li>
</ul>
<h2 id="hbase基础架构">HBase基础架构</h2>
<p><img src="/images/Hive、Hbase/structure.jpg" width="90%" height="90%"></p>
<p><strong>Client</strong><br />
（1）与zookeeper通信, 找到数据入口地址<br />
（2）使用HBase RPC机制与HMaster和HRegionServer进行通信；<br />
（3）Client与HMaster进行通信进行管理类操作；<br />
（4）Client与HRegionServer进行数据读写类操作。</p>
<p><strong>Zookeeper</strong><br />
（1）保证任何时候，集群中只有一个running
master，避免单点问题。即保证HMaster有一个活着；<br />
（2）所有HRegionServer、HMaster地址存储；<br />
（3）实时监控Region Server的状态，将Region
server的上线和下线信息，实时通知给Master；<br />
（4）存储Hbase的schema，即元数据存储。包括有哪些table，每个table有哪些column
family。</p>
<p><strong>HMaster</strong><br />
可以启动多个HMaster，通过Zookeeper的Master
Election机制保证总有一个Master运行。</p>
<p>角色功能：<br />
（1）为Region server分配region；<br />
（2）负责region server的负载均衡；<br />
（3）发现失效的region serve并重新分配其上的region；<br />
（4）HDFS上的垃圾文件回收；<br />
（5）处理用户对表的增删改查操作。</p>
<p><strong>HRegionServer</strong><br />
HBase中最核心的模块，主要负责响应用户I/O请求，向HDFS文件系统中读写数据。</p>
<p>作用：<br />
（1）维护Master分配给它的region，处理对这些region的IO请求；<br />
（2）负责切分在运行过程中变得过大的region。<br />
（3）此外，HRegionServer管理一系列HRegion对象，每个HRegion对应Table中一个Region，HRegion由多个HStore组成，每个HStore对应Table中一个Column
Family的存储，Column
Family就是一个集中的存储单元，故将具有相同IO特性的Column放在一个Column
Family会更高效。</p>
<p><strong>HStore</strong><br />
HBase存储的核心，由MemStore和StoreFile组成。每一个column family
对应了一个HStore。<br />
<img src="/images/Hive、Hbase/2.png" width="60%" height="60%"></p>
<p>用户写入数据的流程为：client访问ZK-&gt;ZK返回RegionServer地址-&gt;client访问RegionServer写入数据-&gt;
数据存入MemStore，一直到MemStore满-&gt;Flush成StoreFile。</p>
<p><strong>HRegion</strong><br />
（1）一个表最开始存储的时候，是一个region。<br />
（2）一个Region中会有个多个store，每个store用来存储一个列簇。如果只有一个column
family，就只有一个store。<br />
（3）region会随着插入的数据越来越多，会进行拆分。默认大小是10G一个。</p>
<p><strong>HLog</strong><br />
在分布式系统环境中，无法避免系统出错或者宕机，一旦HRegionServer意外退出，MemStore中的内存数据就会丢失，引入HLog就是防止这种情况。</p>
<h2 id="hbase模块协作">HBase模块协作</h2>
<ul>
<li>HBase启动
<ul>
<li>HMaster启动, 注册到Zookeeper, 等待RegionServer汇报</li>
<li>RegionServer注册到Zookeeper, 并向HMaster汇报</li>
<li>对各个RegionServer(包括失效的)的数据进行整理,
分配Region和meta信息</li>
</ul></li>
<li>RegionServer失效
<ul>
<li>HMaster将失效RegionServer上的Region分配到其他节点</li>
<li>HMaster更新hbase: meta 表以保证数据正常访问</li>
</ul></li>
<li>HMaster失效
<ul>
<li>处于Backup状态的其他HMaster节点推选出一个转为Active状态</li>
<li>数据能正常读写, 但是不能创建删除表, 也不能更改表结构</li>
</ul></li>
</ul>
<h2 id="hbase的安装">HBase的安装</h2>
<p>下载<span class="exturl" data-url="aHR0cDovL2FyY2hpdmUuY2xvdWRlcmEuY29tL2NkaDUvY2RoLzUvaGJhc2UtMS4yLjAtY2RoNS43LjAudGFyLmd6">安装包<i class="fa fa-external-link-alt"></i></span>，配置伪分布式环境：<br />
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">环境变量配置</span></span><br><span class="line">export HBASE_HOME=/usr/local/development/hbase-1.2.4</span><br><span class="line">export PATH=$HBASE_HOME/bin:$PATH</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">配置hbase-env.sh</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">HBASE_MANAGES_ZK：如果你是使用hbase自带的zk就是<span class="literal">true</span>，如果使用自己的zk就是<span class="literal">false</span></span></span><br><span class="line">export JAVA_HOME=/usr/local/development/jdk1.7.0_15</span><br><span class="line">export HBASE_MANAGES_ZK=false  </span><br></pre></td></tr></table></figure><br />
配置hbase-site.xml：<br />
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">property</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">name</span>&gt;</span>hbase.rootdir<span class="tag">&lt;/<span class="name">name</span>&gt;</span>　　--hbase持久保存的目录</span><br><span class="line">    <span class="tag">&lt;<span class="name">value</span>&gt;</span>hdfs://hadoop001:8020/opt/hbase<span class="tag">&lt;/<span class="name">value</span>&gt;</span>   </span><br><span class="line"><span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">property</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">name</span>&gt;</span>hbase.cluster.distributed<span class="tag">&lt;/<span class="name">name</span>&gt;</span>  --是否是分布式</span><br><span class="line">    <span class="tag">&lt;<span class="name">value</span>&gt;</span>true<span class="tag">&lt;/<span class="name">value</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">property</span>&gt;</span>     </span><br><span class="line">    <span class="tag">&lt;<span class="name">name</span>&gt;</span>hbase.zookeeper.property.clientPort<span class="tag">&lt;/<span class="name">name</span>&gt;</span>    --指定要连接zk的端口</span><br><span class="line">    <span class="tag">&lt;<span class="name">value</span>&gt;</span>2181<span class="tag">&lt;/<span class="name">value</span>&gt;</span>    </span><br><span class="line"><span class="tag">&lt;/<span class="name">property</span>&gt;</span>    </span><br><span class="line"><span class="tag">&lt;<span class="name">property</span>&gt;</span>        </span><br><span class="line">    <span class="tag">&lt;<span class="name">name</span>&gt;</span>hbase.zookeeper.property.dataDir<span class="tag">&lt;/<span class="name">name</span>&gt;</span>            </span><br><span class="line">    <span class="tag">&lt;<span class="name">value</span>&gt;</span>/home/hadoop/app/hbase/zkData<span class="tag">&lt;/<span class="name">value</span>&gt;</span>    </span><br><span class="line"><span class="tag">&lt;/<span class="name">property</span>&gt;</span>          </span><br></pre></td></tr></table></figure><br />
启动hbase（启动的hbase的时候要保证hadoop集群已经启动）：<br />
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">/hbase/bin/start-hbase.sh</span><br></pre></td></tr></table></figure><br />
输入hbase shell（进入shell命令行）。</p>
<h2 id="hbase-shell">HBase shell</h2>
HBase DDL 和 DML 命令：<br />

<table>
<tr>
<th>
名称
</th>
<th>
命令表达式
</th>
</tr>
<tr>
<td>
创建表
</td>
<td>
create '表名', '列族名1','列族名2','列族名n'
</td>
</tr>
<tr>
<td>
添加记录
</td>
<td>
put '表名','行名','列名:','值
</td>
</tr>
<tr>
<td>
查看记录
</td>
<td>
get '表名','行名'
</td>
</tr>
<tr>
<td>
查看表中的记录总数
</td>
<td>
count '表名'
</td>
</tr>
<tr>
<td>
删除记录
</td>
<td>
delete '表名', '行名','列名'
</td>
</tr>
<tr>
<td>
删除一张表
</td>
<td>
第一步 disable '表名' 第二步 drop '表名'
</td>
</tr>
<tr>
<td>
查看所有记录
</td>
<td>
scan "表名称"
</td>
</tr>
<tr>
<td>
查看指定表指定列所有数据
</td>
<td>
scan '表名' ,{COLUMNS=&gt;'列族名:列名'}
</td>
</tr>
<tr>
<td>
更新记录
</td>
<td>
重写覆盖
</td>
</tr>
</table>
<p>连接集群：<br />
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">hbase shell</span><br></pre></td></tr></table></figure><br />
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- 创建表</span></span><br><span class="line"><span class="comment">-- create 表名 列族</span></span><br><span class="line"><span class="keyword">create</span> <span class="string">&#x27;user&#x27;</span>,<span class="string">&#x27;base_info&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">-- 删除表</span></span><br><span class="line">disable <span class="string">&#x27;user&#x27;</span></span><br><span class="line"><span class="keyword">drop</span> <span class="string">&#x27;user&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">-- 创建名称空间</span></span><br><span class="line">create_namespace <span class="string">&#x27;test&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">-- 展示现有名称空间</span></span><br><span class="line">list_namespace</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 创建表的时候添加namespace</span></span><br><span class="line"><span class="keyword">create</span> <span class="string">&#x27;test:user&#x27;</span>,<span class="string">&#x27;base_info&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">-- 显示某个名称空间下有哪些表</span></span><br><span class="line">list_namespace_tables <span class="string">&#x27;test&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">-- 插入数据：put &#x27;表名&#x27;,&#x27;rowkey的值&#x27;,&#x27;列族:列标识符&#x27;,&#x27;值&#x27;</span></span><br><span class="line">put <span class="string">&#x27;user&#x27;</span>,<span class="string">&#x27;rowkey_10&#x27;</span>,<span class="string">&#x27;base_info:username&#x27;</span>,<span class="string">&#x27;Tom&#x27;</span></span><br><span class="line">put <span class="string">&#x27;user&#x27;</span>,<span class="string">&#x27;rowkey_10&#x27;</span>,<span class="string">&#x27;base_info:birthday&#x27;</span>,<span class="string">&#x27;2014-07-10&#x27;</span></span><br><span class="line">put <span class="string">&#x27;user&#x27;</span>,<span class="string">&#x27;rowkey_10&#x27;</span>,<span class="string">&#x27;base_info:sex&#x27;</span>,<span class="string">&#x27;1&#x27;</span></span><br><span class="line">put <span class="string">&#x27;user&#x27;</span>,<span class="string">&#x27;rowkey_10&#x27;</span>,<span class="string">&#x27;base_info:address&#x27;</span>,<span class="string">&#x27;Tokyo&#x27;</span></span><br><span class="line"></span><br><span class="line">put <span class="string">&#x27;user&#x27;</span>,<span class="string">&#x27;rowkey_16&#x27;</span>,<span class="string">&#x27;base_info:username&#x27;</span>,<span class="string">&#x27;Mike&#x27;</span></span><br><span class="line">put <span class="string">&#x27;user&#x27;</span>,<span class="string">&#x27;rowkey_16&#x27;</span>,<span class="string">&#x27;base_info:birthday&#x27;</span>,<span class="string">&#x27;2014-07-10&#x27;</span></span><br><span class="line">put <span class="string">&#x27;user&#x27;</span>,<span class="string">&#x27;rowkey_16&#x27;</span>,<span class="string">&#x27;base_info:sex&#x27;</span>,<span class="string">&#x27;1&#x27;</span></span><br><span class="line">put <span class="string">&#x27;user&#x27;</span>,<span class="string">&#x27;rowkey_16&#x27;</span>,<span class="string">&#x27;base_info:address&#x27;</span>,<span class="string">&#x27;beijing&#x27;</span></span><br><span class="line"></span><br><span class="line">put <span class="string">&#x27;user&#x27;</span>,<span class="string">&#x27;rowkey_22&#x27;</span>,<span class="string">&#x27;base_info:username&#x27;</span>,<span class="string">&#x27;Jerry&#x27;</span></span><br><span class="line">put <span class="string">&#x27;user&#x27;</span>,<span class="string">&#x27;rowkey_22&#x27;</span>,<span class="string">&#x27;base_info:birthday&#x27;</span>,<span class="string">&#x27;2014-07-10&#x27;</span></span><br><span class="line">put <span class="string">&#x27;user&#x27;</span>,<span class="string">&#x27;rowkey_22&#x27;</span>,<span class="string">&#x27;base_info:sex&#x27;</span>,<span class="string">&#x27;1&#x27;</span></span><br><span class="line">put <span class="string">&#x27;user&#x27;</span>,<span class="string">&#x27;rowkey_22&#x27;</span>,<span class="string">&#x27;base_info:address&#x27;</span>,<span class="string">&#x27;Newyork&#x27;</span></span><br><span class="line"></span><br><span class="line">put <span class="string">&#x27;user&#x27;</span>,<span class="string">&#x27;rowkey_24&#x27;</span>,<span class="string">&#x27;base_info:username&#x27;</span>,<span class="string">&#x27;Nico&#x27;</span></span><br><span class="line">put <span class="string">&#x27;user&#x27;</span>,<span class="string">&#x27;rowkey_24&#x27;</span>,<span class="string">&#x27;base_info:birthday&#x27;</span>,<span class="string">&#x27;2014-07-10&#x27;</span></span><br><span class="line">put <span class="string">&#x27;user&#x27;</span>,<span class="string">&#x27;rowkey_24&#x27;</span>,<span class="string">&#x27;base_info:sex&#x27;</span>,<span class="string">&#x27;1&#x27;</span></span><br><span class="line">put <span class="string">&#x27;user&#x27;</span>,<span class="string">&#x27;rowkey_24&#x27;</span>,<span class="string">&#x27;base_info:address&#x27;</span>,<span class="string">&#x27;shanghai&#x27;</span></span><br><span class="line"></span><br><span class="line">put <span class="string">&#x27;user&#x27;</span>,<span class="string">&#x27;rowkey_25&#x27;</span>,<span class="string">&#x27;base_info:username&#x27;</span>,<span class="string">&#x27;Rose&#x27;</span></span><br><span class="line">put <span class="string">&#x27;user&#x27;</span>,<span class="string">&#x27;rowkey_25&#x27;</span>,<span class="string">&#x27;base_info:birthday&#x27;</span>,<span class="string">&#x27;2014-07-10&#x27;</span></span><br><span class="line">put <span class="string">&#x27;user&#x27;</span>,<span class="string">&#x27;rowkey_25&#x27;</span>,<span class="string">&#x27;base_info:sex&#x27;</span>,<span class="string">&#x27;1&#x27;</span></span><br><span class="line">put <span class="string">&#x27;user&#x27;</span>,<span class="string">&#x27;rowkey_25&#x27;</span>,<span class="string">&#x27;base_info:address&#x27;</span>,<span class="string">&#x27;Soul&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">-- 查询表中的所有数据</span></span><br><span class="line">scan <span class="string">&#x27;user&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">-- 查询某个rowkey的数据</span></span><br><span class="line"><span class="keyword">get</span> <span class="string">&#x27;user&#x27;</span>,<span class="string">&#x27;rowkey_16&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">-- 查询某个列簇的数据</span></span><br><span class="line"><span class="keyword">get</span> <span class="string">&#x27;user&#x27;</span>,<span class="string">&#x27;rowkey_16&#x27;</span>,<span class="string">&#x27;base_info&#x27;</span></span><br><span class="line"><span class="keyword">get</span> <span class="string">&#x27;user&#x27;</span>,<span class="string">&#x27;rowkey_16&#x27;</span>,<span class="string">&#x27;base_info:username&#x27;</span></span><br><span class="line"><span class="keyword">get</span> <span class="string">&#x27;user&#x27;</span>, <span class="string">&#x27;rowkey_16&#x27;</span>, &#123;<span class="keyword">COLUMN</span> <span class="operator">=</span><span class="operator">&gt;</span> [<span class="string">&#x27;base_info:username&#x27;</span>,<span class="string">&#x27;base_info:sex&#x27;</span>]&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 删除表中的数据</span></span><br><span class="line"><span class="keyword">delete</span> <span class="string">&#x27;user&#x27;</span>, <span class="string">&#x27;rowkey_16&#x27;</span>, <span class="string">&#x27;base_info:username&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">-- 清空数据</span></span><br><span class="line"><span class="keyword">truncate</span> <span class="string">&#x27;user&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">-- 操作列簇</span></span><br><span class="line"><span class="keyword">alter</span> <span class="string">&#x27;user&#x27;</span>, NAME <span class="operator">=</span><span class="operator">&gt;</span> <span class="string">&#x27;f2&#x27;</span></span><br><span class="line"><span class="keyword">alter</span> <span class="string">&#x27;user&#x27;</span>, <span class="string">&#x27;delete&#x27;</span> <span class="operator">=</span><span class="operator">&gt;</span> <span class="string">&#x27;f2&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">-- 修改数据</span></span><br><span class="line">put <span class="string">&#x27;user&#x27;</span>,<span class="string">&#x27;rowkey_10&#x27;</span>,<span class="string">&#x27;base_info:username&#x27;</span>,<span class="string">&#x27;Tom&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">-- 指定显示多个版本</span></span><br><span class="line"><span class="keyword">get</span> <span class="string">&#x27;user&#x27;</span>,<span class="string">&#x27;rowkey_10&#x27;</span>,&#123;<span class="keyword">COLUMN</span><span class="operator">=</span><span class="operator">&gt;</span><span class="string">&#x27;base_info:username&#x27;</span>,VERSIONS<span class="operator">=</span><span class="operator">&gt;</span><span class="number">2</span>&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 修改可以显示的版本数量</span></span><br><span class="line"><span class="keyword">alter</span> <span class="string">&#x27;user&#x27;</span>,NAME<span class="operator">=</span><span class="operator">&gt;</span><span class="string">&#x27;base_info&#x27;</span>,VERSIONS<span class="operator">=</span><span class="operator">&gt;</span><span class="number">10</span></span><br></pre></td></tr></table></figure><br />
HBase追加型数据库，会保留多个版本数据：<br />
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- VERSIONS=&gt;&#x27;1&#x27;  &#x27;1&#x27;说明最多可以显示一个版本</span></span><br><span class="line"><span class="keyword">desc</span> <span class="string">&#x27;user&#x27;</span></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">Table user is ENABLED</span></span><br><span class="line"><span class="string">user</span></span><br><span class="line"><span class="string">COLUMN FAMILIES DESCRIPTION</span></span><br><span class="line"><span class="string">&#123;NAME =&gt; &#x27;</span>base_info<span class="string">&#x27;, VERSIONS =&gt; &#x27;</span><span class="number">1</span><span class="string">&#x27;, EVICT_BLOCKS_ON_CLOSE =&gt; &#x27;</span><span class="literal">false</span><span class="string">&#x27;, NEW_VERSION_B</span></span><br><span class="line"><span class="string">HE_DATA_ON_WRITE =&gt; &#x27;</span><span class="literal">false</span><span class="string">&#x27;, DATA_BLOCK_ENCODING =&gt; &#x27;</span><span class="keyword">NONE</span><span class="string">&#x27;, TTL =&gt; &#x27;</span>FOREVER<span class="string">&#x27;, MI</span></span><br><span class="line"><span class="string">ER =&gt; &#x27;</span><span class="keyword">NONE</span><span class="string">&#x27;, CACHE_INDEX_ON_WRITE =&gt; &#x27;</span><span class="literal">false</span><span class="string">&#x27;, IN_MEMORY =&gt; &#x27;</span><span class="literal">false</span><span class="string">&#x27;, CACHE_BLOOM</span></span><br><span class="line"><span class="string">se&#x27;</span>, COMPRESSION <span class="operator">=</span><span class="operator">&gt;</span> <span class="string">&#x27;NONE&#x27;</span>, BLOCKCACHE <span class="operator">=</span><span class="operator">&gt;</span> <span class="string">&#x27;false&#x27;</span>, BLOCKSIZE <span class="operator">=</span><span class="operator">&gt;</span> <span class="string">&#x27;65536&#x27;</span>&#125;</span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br></pre></td></tr></table></figure><br />
命令表：<br />
<img src="/images/Hive、Hbase/Hbase命令表.jpg" width="60%" height="60%"></p>
<p>可以通过HbaseUi界面查看表的信息，端口60010打不开的情况，是因为hbase
1.0 以后的版本，需要自己手动配置，在文件hbase-site中。<br />
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">&lt;property&gt;  </span><br><span class="line">&lt;name&gt;hbase.master.info.port&lt;/name&gt;  </span><br><span class="line">&lt;value&gt;60010&lt;/value&gt;  </span><br><span class="line">&lt;/property&gt; </span><br></pre></td></tr></table></figure><br />
## Hive on HBase<br />
（1）HBase 用于在线业务服务, 不适合做统计分析<br />
（2）Hive 适合数据分析 统计<br />
Hive on
HBase适合数据导入查询，不适合数据分析（涉及到MapReduce速度会慢下来）。</p>
<p>Hive表与HBase表之间需要建立映射关系：<br />
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">CREATE</span> <span class="keyword">TABLE</span> hbase_table_1(key <span class="type">int</span>, <span class="keyword">value</span> string) </span><br><span class="line">STORED <span class="keyword">BY</span> <span class="string">&#x27;org.apache.hadoop.hive.hbase.HBaseStorageHandler&#x27;</span> </span><br><span class="line"><span class="keyword">WITH</span> SERDEPROPERTIES (&quot;hbase.columns.mapping&quot;<span class="operator">=</span>&quot;:key,cf1:val&quot;) </span><br><span class="line">TBLPROPERTIES(&quot;hbase.table.name&quot;<span class="operator">=</span>&quot;xyz&quot;);</span><br></pre></td></tr></table></figure><br />
不支持load data导入数据, 要用insert 方式创建新表加载数据<br />
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">load data <span class="keyword">local</span> inpath <span class="string">&#x27;/home/1.txt&#x27;</span> overwrite <span class="keyword">into</span> <span class="keyword">table</span> a;</span><br><span class="line"><span class="keyword">insert</span> overwrite tabale hbase_a <span class="keyword">select</span> <span class="operator">*</span> <span class="keyword">from</span> a;</span><br></pre></td></tr></table></figure></p>
<p><strong>Hive on HBase示例</strong><br />
创建student1表，通过hive中创建在hbase中也会同时创建：<br />
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">CREATE</span> <span class="keyword">TABLE</span> student1</span><br><span class="line">(<span class="keyword">no</span> string,</span><br><span class="line">classno string,</span><br><span class="line">stuno string,</span><br><span class="line">score <span class="type">int</span></span><br><span class="line">)</span><br><span class="line">STORED <span class="keyword">BY</span> <span class="string">&#x27;org.apache.hadoop.hive.hbase.HBaseStorageHandler&#x27;</span> </span><br><span class="line"><span class="keyword">WITH</span> SERDEPROPERTIES </span><br><span class="line">(&quot;hbase.columns.mapping&quot; <span class="operator">=</span> &quot;:key,stuinfo:classno,stuinfo:stuno,stuinfo:score&quot;)</span><br><span class="line">TBLPROPERTIES (&quot;hbase.table.name&quot;<span class="operator">=</span>&quot;student&quot;);</span><br><span class="line"><span class="comment">-- Hbase中创建的表，表名为student</span></span><br></pre></td></tr></table></figure><br />
将查询的数据insert到student1表中：<br />
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">insert</span> overwrite <span class="keyword">table</span> student1</span><br><span class="line"><span class="keyword">select</span> reverse(classno) <span class="keyword">as</span> key,classno,stuno,score <span class="keyword">from</span> student;</span><br></pre></td></tr></table></figure></p>
<h2 id="happybase操作hbase">HappyBase操作Hbase</h2>
<p>什么是HappyBase？<br />
HappyBase是FaceBook员工开发的操作HBase的Python库, 其基于Python Thrift,
但使用方式比Thrift简单。官网介绍为：</p>
<p><strong>HappyBase</strong> is a developer-friendly <span class="exturl" data-url="aHR0cDovL3B5dGhvbi5vcmcv">Python<i class="fa fa-external-link-alt"></i></span> library to interact with <span class="exturl" data-url="aHR0cDovL2hiYXNlLmFwYWNoZS5vcmcv">Apache HBase<i class="fa fa-external-link-alt"></i></span>. HappyBase is designed
for use in standard HBase setups, and offers application developers a
Pythonic API to interact with HBase. Below the surface, HappyBase uses
the <span class="exturl" data-url="aHR0cDovL3B5cGkucHl0aG9uLm9yZy9weXBpL3RocmlmdA==">Python Thrift
library<i class="fa fa-external-link-alt"></i></span> to connect to HBase using its <span class="exturl" data-url="aHR0cDovL3RocmlmdC5hcGFjaGUub3JnLw==">Thrift<i class="fa fa-external-link-alt"></i></span> gateway, which is included
in the standard HBase 0.9x releases.</p>
<p>使用前，先pip安装下<code>pip install happybase</code>。然后就可以启动第三方服务使用了：<br />
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">启动hbase thrift server</span></span><br><span class="line">hbase-daemon.sh start thrift</span><br></pre></td></tr></table></figure><br />
windows系统问题：happybase1.0在win下不支持绝对路径。<br />
解决办法：将出问题的文件488行的url_scheme == ”改为url_scheme in
(‘代码盘符’, ”)</p>
<p><strong>如何使用HappyBase？</strong><br />
<strong>建立连接：</strong><br />
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> happybase</span><br><span class="line">connection = happybase.Connection(<span class="string">&#x27;somehost&#x27;</span>)</span><br></pre></td></tr></table></figure><br />
当连接建立时，会自动创建一个与 HBase Thrift server的socket链接。<br />
可以通过参数禁止自动链接，然后再需要连接是调用 <a
target="_blank" rel="noopener" href="https://happybase.readthedocs.io/en/latest/api.html#happybase.Connection.open"><code>Connection.open()</code></a>:<br />
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">connection = happybase.Connection(<span class="string">&#x27;somehost&#x27;</span>, autoconnect=<span class="literal">False</span>)</span><br><span class="line"><span class="comment"># before first use:</span></span><br><span class="line">connection.<span class="built_in">open</span>()</span><br></pre></td></tr></table></figure><br />
<a
target="_blank" rel="noopener" href="https://happybase.readthedocs.io/en/latest/api.html#happybase.Connection"><code>Connection</code></a>
这个类提供了一个与HBase交互的入口， 比如获取HBase中所有的表：<a
target="_blank" rel="noopener" href="https://happybase.readthedocs.io/en/latest/api.html#happybase.Connection.tables"><code>Connection.tables()</code></a>:<br />
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">print</span>(connection.tables())</span><br></pre></td></tr></table></figure><br />
<strong>操作表：</strong><br />
Table类提供了大量API, 这些API用于检索和操作HBase中的数据。<br />
在上面的示例中，已经使用<code>Connection.tables()</code>方法查询HBase中的表。
如果还没有任何表，可使用<code>Connection.create_table()</code>创建一个新表：<br />
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">connection.create_table(<span class="string">&#x27;users&#x27;</span>,&#123;<span class="string">&#x27;cf1&#x27;</span>: <span class="built_in">dict</span>()&#125;)</span><br></pre></td></tr></table></figure><br />
创建表之后可以传入表名获取到Table类的实例:<br />
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">table = connection.table(&#x27;mytable&#x27;)</span><br></pre></td></tr></table></figure><br />
查询操作：<br />
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># api</span></span><br><span class="line">table.scan() <span class="comment">#全表查询</span></span><br><span class="line">table.row(row_keys[<span class="number">0</span>]) <span class="comment"># 查询一行</span></span><br><span class="line">table.rows(row_keys) <span class="comment"># 查询多行</span></span><br><span class="line"><span class="comment">#封装函数</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">show_rows</span>(<span class="params">table, row_keys=<span class="literal">None</span></span>):</span><br><span class="line">    <span class="keyword">if</span> row_keys:</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&#x27;show value of row named %s&#x27;</span> % row_keys)</span><br><span class="line">        <span class="keyword">if</span> <span class="built_in">len</span>(row_keys) == <span class="number">1</span>:</span><br><span class="line">            <span class="built_in">print</span>(table.row(row_keys[<span class="number">0</span>]))</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            <span class="built_in">print</span>(table.rows(row_keys))</span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&#x27;show all row values of table named %s&#x27;</span> % table.name)</span><br><span class="line">        <span class="keyword">for</span> key, value <span class="keyword">in</span> table.scan():</span><br><span class="line">            <span class="built_in">print</span>(key, value)</span><br></pre></td></tr></table></figure><br />
插入数据：<br />
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#api</span></span><br><span class="line">table.put(row_key, &#123;cf:cq:value&#125;)</span><br><span class="line"><span class="keyword">def</span> <span class="title function_">put_row</span>(<span class="params">table, column_family, row_key, value</span>):</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&#x27;insert one row to hbase&#x27;</span>)</span><br><span class="line">    <span class="comment">#put &#x27;user&#x27;,&#x27;rowkey_10&#x27;,&#x27;base_info:username&#x27;,&#x27;Tom&#x27;</span></span><br><span class="line">    <span class="comment">#&#123;&#x27;cf:cq&#x27;:’数据‘&#125;</span></span><br><span class="line">    table.put(row_key, &#123;<span class="string">&#x27;%s:name&#x27;</span> % column_family:<span class="string">&#x27;name_%s&#x27;</span> % value&#125;)</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">put_rows</span>(<span class="params">table, column_family, row_lines=<span class="number">30</span></span>):</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&#x27;insert rows to hbase now&#x27;</span>)</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(row_lines):</span><br><span class="line">        put_row(table, column_family, <span class="string">&#x27;row_%s&#x27;</span> % i, i)</span><br></pre></td></tr></table></figure><br />
删除数据：<br />
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#api</span></span><br><span class="line">table.delete(row_key, cf_list)</span><br><span class="line">    </span><br><span class="line"><span class="comment">#函数封装    </span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">delete_row</span>(<span class="params">table, row_key, column_family=<span class="literal">None</span>, keys=<span class="literal">None</span></span>):</span><br><span class="line">    <span class="keyword">if</span> keys:</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&#x27;delete keys:%s from row_key:%s&#x27;</span> % (keys, row_key))</span><br><span class="line">        key_list = [<span class="string">&#x27;%s:%s&#x27;</span> % (column_family, key) <span class="keyword">for</span> key <span class="keyword">in</span> keys]</span><br><span class="line">        table.delete(row_key, key_list)</span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&#x27;delete row(column_family:) from hbase&#x27;</span>)</span><br><span class="line">        table.delete(row_key)</span><br></pre></td></tr></table></figure><br />
删除表：<br />
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#api</span></span><br><span class="line">conn.delete_table(table_name, <span class="literal">True</span>)</span><br><span class="line"><span class="comment">#函数封装</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">delete_table</span>(<span class="params">table_name</span>):</span><br><span class="line">    pretty_print(<span class="string">&#x27;delete table %s now.&#x27;</span> % table_name)</span><br><span class="line">    conn.delete_table(table_name, <span class="literal">True</span>)</span><br></pre></td></tr></table></figure><br />
完整代码：<br />
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> happybase</span><br><span class="line"></span><br><span class="line">hostname = <span class="string">&#x27;192.168.199.188&#x27;</span></span><br><span class="line">table_name = <span class="string">&#x27;users&#x27;</span></span><br><span class="line">column_family = <span class="string">&#x27;cf&#x27;</span></span><br><span class="line">row_key = <span class="string">&#x27;row_1&#x27;</span></span><br><span class="line"></span><br><span class="line">conn = happybase.Connection(hostname)</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">show_tables</span>():</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&#x27;show all tables now&#x27;</span>)</span><br><span class="line">    tables =  conn.tables()</span><br><span class="line">    <span class="keyword">for</span> t <span class="keyword">in</span> tables:</span><br><span class="line">        <span class="built_in">print</span> t</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">create_table</span>(<span class="params">table_name, column_family</span>):</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&#x27;create table %s&#x27;</span> % table_name)</span><br><span class="line">    conn.create_table(table_name, &#123;column_family:<span class="built_in">dict</span>()&#125;)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">show_rows</span>(<span class="params">table, row_keys=<span class="literal">None</span></span>):</span><br><span class="line">    <span class="keyword">if</span> row_keys:</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&#x27;show value of row named %s&#x27;</span> % row_keys)</span><br><span class="line">        <span class="keyword">if</span> <span class="built_in">len</span>(row_keys) == <span class="number">1</span>:</span><br><span class="line">            <span class="built_in">print</span> table.row(row_keys[<span class="number">0</span>])</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            <span class="built_in">print</span> table.rows(row_keys)</span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&#x27;show all row values of table named %s&#x27;</span> % table.name)</span><br><span class="line">        <span class="keyword">for</span> key, value <span class="keyword">in</span> table.scan():</span><br><span class="line">            <span class="built_in">print</span> key, value</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">put_row</span>(<span class="params">table, column_family, row_key, value</span>):</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&#x27;insert one row to hbase&#x27;</span>)</span><br><span class="line">    table.put(row_key, &#123;<span class="string">&#x27;%s:name&#x27;</span> % column_family:<span class="string">&#x27;name_%s&#x27;</span> % value&#125;)</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">put_rows</span>(<span class="params">table, column_family, row_lines=<span class="number">30</span></span>):</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&#x27;insert rows to hbase now&#x27;</span>)</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(row_lines):</span><br><span class="line">        put_row(table, column_family, <span class="string">&#x27;row_%s&#x27;</span> % i, i)</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">delete_row</span>(<span class="params">table, row_key, column_family=<span class="literal">None</span>, keys=<span class="literal">None</span></span>):</span><br><span class="line">    <span class="keyword">if</span> keys:</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&#x27;delete keys:%s from row_key:%s&#x27;</span> % (keys, row_key))</span><br><span class="line">        key_list = [<span class="string">&#x27;%s:%s&#x27;</span> % (column_family, key) <span class="keyword">for</span> key <span class="keyword">in</span> keys]</span><br><span class="line">        table.delete(row_key, key_list)</span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&#x27;delete row(column_family:) from hbase&#x27;</span>)</span><br><span class="line">        table.delete(row_key)</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">delete_table</span>(<span class="params">table_name</span>):</span><br><span class="line">    pretty_print(<span class="string">&#x27;delete table %s now.&#x27;</span> % table_name)</span><br><span class="line">    conn.delete_table(table_name, <span class="literal">True</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">pool</span>():</span><br><span class="line">    pretty_print(<span class="string">&#x27;test pool connection now.&#x27;</span>)</span><br><span class="line">    pool = happybase.ConnectionPool(size=<span class="number">3</span>, host=hostname)</span><br><span class="line">    <span class="keyword">with</span> pool.connection() <span class="keyword">as</span> connection:</span><br><span class="line">        <span class="built_in">print</span> connection.tables()</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">main</span>():</span><br><span class="line">    <span class="comment"># show_tables()</span></span><br><span class="line">    <span class="comment"># create_table(table_name, column_family)</span></span><br><span class="line">    <span class="comment"># show_tables()</span></span><br><span class="line"></span><br><span class="line">    table = conn.table(table_name)</span><br><span class="line">    show_rows(table)</span><br><span class="line">    put_rows(table, column_family)</span><br><span class="line">    show_rows(table)</span><br><span class="line">    <span class="comment">#</span></span><br><span class="line">    <span class="comment"># # 更新操作</span></span><br><span class="line">    <span class="comment"># put_row(table, column_family, row_key, &#x27;xiaoh.me&#x27;)</span></span><br><span class="line">    <span class="comment"># show_rows(table, [row_key])</span></span><br><span class="line">    <span class="comment">#</span></span><br><span class="line">    <span class="comment"># # 删除数据</span></span><br><span class="line">    <span class="comment"># delete_row(table, row_key)</span></span><br><span class="line">    <span class="comment"># show_rows(table, [row_key])</span></span><br><span class="line">    <span class="comment">#</span></span><br><span class="line">    <span class="comment"># delete_row(table, row_key, column_family, [&#x27;name&#x27;])</span></span><br><span class="line">    <span class="comment"># show_rows(table, [row_key])</span></span><br><span class="line">    <span class="comment">#</span></span><br><span class="line">    <span class="comment"># counter(table, row_key, column_family)</span></span><br><span class="line">    <span class="comment">#</span></span><br><span class="line">    <span class="comment"># delete_table(table_name)</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&quot;__main__&quot;</span>:</span><br><span class="line">    main()</span><br></pre></td></tr></table></figure></p>
<h2 id="hbase表设计">HBase表设计</h2>
<ul>
<li>设计HBase表时需要注意的特点
<ul>
<li>HBase中表的索引是通过rowkey实现的</li>
<li>在表中是通过Row key的字典顺序来对数据进行排序的,
表中Region的划分通过起始Rowkey和结束Rowkey来决定的</li>
<li>所有存储在HBase中的数据都是二进制字节, 没有数据类型</li>
<li>原子性只在行内保证, HBase表中没有多行事务</li>
<li>列族(Column Family)在表创建之前就要定义好</li>
<li>列族中的列标识(Column
Qualifier)可以在表创建后动态插入数据的时候添加</li>
<li>不同的column family保存在不同的文件中。</li>
</ul></li>
<li>如何设计HBase表
<ul>
<li>Row key的结构该如何设置, Row key中又该包含什么样的信息</li>
<li>表中应该有多少的列族</li>
<li>列族中应该存储什么样的数据</li>
<li>每个列族中存储多少列数据</li>
<li>列的名字分别是什么</li>
<li>cell中应该存储什么样的信息</li>
<li>每个cell中存储多少个版本信息</li>
</ul></li>
<li>DDI 目的是为了克服HBase架构上的缺陷(join繁琐 只有row key索引等)
<ul>
<li>Denormalization (反规范化, 解决join麻烦的问题)</li>
<li>Duplication (数据冗余)</li>
<li>Intelligent keys(通过row key设计实现 索引 排序对读写优化)</li>
</ul></li>
</ul>
<h2 id="hbase表设计案例-社交应用互粉信息表">HBase表设计案例:
社交应用互粉信息表</h2>
<p>设计表保存应用中用户互粉的信息：<br />
（1）读场景：某用户都关注了哪些用户、用户A有没有关注用户B、谁关注了用户A<br />
（2）写场景：用户关注了某个用户、用户取消关注了某个用户</p>
<p>某用户都关注了哪些用户：<br />
<img src="/images/Hive、Hbase/table1.png" width="60%" height="60%"></p>
<p><img src="/images/Hive、Hbase/table2.png" width="80%" height="80%"></p>
<p>解决 用户A有没有关注用户B 问题，防止像上面那样全表扫描：<br />
<img src="/images/Hive、Hbase/table3.png" width="80%" height="80%"></p>
<p>解决谁关注了用户A问题：<br />
（1）设计一张新表, 里面保存某个用户和他的粉丝。涉及到跨表事务。<br />
（2）在同一张表中同时记录粉丝列表的和用户关注的列表,
并通过Rowkey来区分（01_userid: 用户关注列表、02_userid:
粉丝列表）。涉及到跨行事务。<br />
（3）上两种设计方案的问题(事务)，可能不同步。</p>
<p>案例总结：<br />
（1）Rowkey是HBase表结构设计中很重要的环节,
直接影响到HBase的效率和性能。<br />
（2）HBase的表结构比传统关系型数据库更灵活,
能存储任何二进制数据,无需考虑数据类型。<br />
（3）利用列标识(Column Qualifier)来存储数据。<br />
（4）衡量设计好坏的简单标准 是否会全表查询。</p>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="https://soundmemories.github.io/2020/05/02/ML/05.ML-Hadoop/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avstar.png">
      <meta itemprop="name" content="SoundMemories">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="SoundMemories">
      <meta itemprop="description" content="今日事，今日毕">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | SoundMemories">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2020/05/02/ML/05.ML-Hadoop/" class="post-title-link" itemprop="url">ML-Hadoop</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>

      <time title="创建时间：2020-05-02 00:00:00" itemprop="dateCreated datePublished" datetime="2020-05-02T00:00:00+08:00">2020-05-02</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">分类于</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/ML/" itemprop="url" rel="index"><span itemprop="name">ML</span></a>
        </span>
    </span>

  
    <span class="post-meta-break"></span>
    <span class="post-meta-item" title="本文字数">
      <span class="post-meta-item-icon">
        <i class="far fa-file-word"></i>
      </span>
      <span class="post-meta-item-text">本文字数：</span>
      <span>19k</span>
    </span>
    <span class="post-meta-item" title="阅读时长">
      <span class="post-meta-item-icon">
        <i class="far fa-clock"></i>
      </span>
      <span class="post-meta-item-text">阅读时长 &asymp;</span>
      <span>1:09</span>
    </span>
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <h1 id="大数据">大数据</h1>
<p>大数据：指<strong>无法在一定时间范围</strong>内用常规软件工具进行捕捉、管理和处理的数据集合，是需要新处理模式才能具有更强的决策力、洞察发现力和流程优化能力的<strong>海量、高增长率和多样化的信息资产</strong>。主要解决，海量数据的<strong>存储</strong>和海量数据的<strong>分析计算</strong>问题。</p>
<p>一般数据存储单位：bit、Byte、KB、MB、GB、TB、PB、EB、ZB、YB、BB、NB、DB。<br />
<div class="note info"><p>1Byte = 8bit、1K = 1024Byte、1MB = 1024K、1G = 1024M、1T = 1024G、1P
= 1024T...</p>
</div></p>
<p><strong>1、大数据的特点：</strong><br />
（1）<strong>大量（Volume）</strong>：截至目前，人类生产的所有印刷材料的数据量是200PB，而历史上全人类总共说过的话的数据量大约是5EB。当前，典型个人计算机硬盘的容量为TB量级，而一些大企业的数据量已经接近EB量级。<br />
（2）<strong>高速（Velocity）</strong>：这是大数据区分于传统数据挖掘的最显著特征。预计到2022年，全球数据使用量将达到40ZB。在如此海量的数据面前，处理数据的效率就是企业的生命。<br />
（3）<strong>多样（Variety）</strong>：类型的多样性也让数据被分为<strong>结构化数据</strong>和<strong>非结构化数据</strong>。相对于以往便于存储的以数据库/文本为主的结构化数据，非结构化数据越来越多，包括网络日志、音频、视频、图片、地理位置信息等，这些多类型的数据对数据的处理能力提出了更高要求。<br />
（4）<strong>低价值密度（Value）</strong>：价值密度的高低与数据总量的大小成反比。比如，在某一天的监控视频中，我们只关心出事故的那一分钟。如何快速对有价值数据“提纯”成为目前大数据背景下待解决的难题。<br />
          <!--noindex-->
            <div class="post-button">
              <a class="btn" href="/2020/05/02/ML/05.ML-Hadoop/#more" rel="contents">
                阅读全文 &raquo;
              </a>
            </div>
          <!--/noindex-->
        
      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="https://soundmemories.github.io/2020/04/30/ML/04.ML-Matplolib/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avstar.png">
      <meta itemprop="name" content="SoundMemories">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="SoundMemories">
      <meta itemprop="description" content="今日事，今日毕">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | SoundMemories">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2020/04/30/ML/04.ML-Matplolib/" class="post-title-link" itemprop="url">ML-Matplotlib</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>

      <time title="创建时间：2020-04-30 00:00:00" itemprop="dateCreated datePublished" datetime="2020-04-30T00:00:00+08:00">2020-04-30</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">分类于</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/ML/" itemprop="url" rel="index"><span itemprop="name">ML</span></a>
        </span>
    </span>

  
    <span class="post-meta-break"></span>
    <span class="post-meta-item" title="本文字数">
      <span class="post-meta-item-icon">
        <i class="far fa-file-word"></i>
      </span>
      <span class="post-meta-item-text">本文字数：</span>
      <span>33k</span>
    </span>
    <span class="post-meta-item" title="阅读时长">
      <span class="post-meta-item-icon">
        <i class="far fa-clock"></i>
      </span>
      <span class="post-meta-item-text">阅读时长 &asymp;</span>
      <span>1:59</span>
    </span>
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <h1 id="matplotlib概述">Matplotlib概述</h1>
<p>Matplotlib 是建立在 NumPy
数组基础上的多平台数据可视化程序库，最初被设计用于完善 SciPy
的生态环境。 John Hunter 希望能画出类似 MATLAB 风格的交互式图形，之后
John 就把补丁做成了 Matplotlib 程序包。</p>
<p>Matplotlib
支持几十种图形显示接口与输出格式，这使得用户无论在哪种操作系统上都可以输出自己想要的图形格式。这种跨平台、面面俱到的特点已经成为
Matplotlib 最强大的功能之一，新版的 Matplotlib
已经可以轻松实现主流的绘图风格，人们不断在 Matplotlib
的基础上开发出新的程序包，实现更加简洁、现代化的 API，例如
Seaborn、ggplot、HoloViews、Altair，以 及 Pandas 对 Matplotlib 的 API
封装的画图功能。虽然已经有了封装后的高级工具，但是掌握 Matplotlib
的语法更能让你灵活地控制最终的图形结果。</p>
<p>和Pandas一样，使用<code>pip install matplotlib</code>进行安装，可查看和引用它：<br />
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> matplotlib <span class="keyword">as</span> mpl</span><br><span class="line"><span class="keyword">import</span> matplotlib.pyplot <span class="keyword">as</span> plt</span><br><span class="line"></span><br><span class="line"><span class="comment"># 查看包的版本</span></span><br><span class="line">mpl.__version__</span><br><span class="line"><span class="comment"># 自动补全</span></span><br><span class="line">mpl.&lt;TAB&gt;</span><br><span class="line"><span class="comment"># 内置的文档</span></span><br><span class="line">mpl?</span><br></pre></td></tr></table></figure></p>
<h1 id="matplotlib三层结构">Matplotlib三层结构</h1>
<h2 id="容器层">容器层</h2>
<p>容器层主要由Canvas、Figure、Axes组成。<br />
（1）Canvas是位于最底层的系统层，在绘图的过程中充当<strong>画板</strong>的角色，即放置画布（Figure）的工具。<br />
（2）Figure是Canvas上面的一层，也是需要用户来操作的应用层的第一层，在绘图的过程中充当<strong>画布</strong>的角色。<br />
（3）Axes是Figure之上的一层，是应用层的第二层，在绘图的过程中相当于画布上的<strong>绘图区</strong>角色。</p>
<div class="note info"><p>Figure：指整个图形（可以通过plt.figure()设置画布的大小和分辨率等。<br />
Axes：指坐标系，数据的绘图区。<br />
Axis指坐标轴，坐标系中的一条轴，包含大小限制、刻度和刻度标签。</p>
<p>一个figure（画布）可以包含多个axes（绘图区/坐标系），但是一个axes只能属于一个figure。<br />
一个axes（绘图区/坐标系）可以包含多个axis（坐标轴），包含两个即为2d坐标系，3个即为3d坐标系。</p>
</div>
<p><img src="https://i.loli.net/2021/05/20/kQxnK39Ar1wbIYJ.jpg" width="50%" height="50%"></p>
<h2 id="图像层">图像层</h2>
<p>图像层建立建立在Axes上面，是指Axes内通过plot、scatter、bar、histogram、pie等函数<strong>根据数据绘制出的图像</strong>。<br />
<img src="https://i.loli.net/2021/05/20/9QKgsyWvTEdS7kf.png" width="70%" height="70%"></p>
<h2 id="辅助显示层">辅助显示层</h2>
<p>辅助显示层也是建立在Axes上面，为Axes（绘图区）内的，<strong>除了根据数据绘制出的图像以外的内容</strong>，主要包括Axes外观(facecolor)、边框线(spines)、坐标轴(axis)、坐标轴名称(axis
label)、坐标轴刻度(tick)、坐标轴刻度标签(tick
label)、网格线(grid)、图例(legend)、标题(title)等内容。该层的设置可使图像显示更加直观更加容易被用户理解，但又不会对图像产生实质的影响。<br />
<img src="https://i.loli.net/2021/05/20/xw5SpbBa6J81Mqo.png" /></p>
<h1 id="matplotlib配置和技巧">Matplotlib配置和技巧</h1>
<h2 id="数据格式">数据格式</h2>
<p>matplotlib的所有plotting
function期待输入numpy.array或者numpy.ma.masked_array类型的数据作为输入。某些长得像numpy.array的数据比如numpy.matrix类型的输入数据可能会导致matplotlib工作异常。如果确实需要使用numpy.matrix，你应该首先将它转换为numpy.array。</p>
<h2 id="pyplotpylab">pyplot、pylab</h2>
<p><strong>matplotlib.pyplot</strong>：位于matplotlib的顶层，它为底层的面向对象接口提供了一个state-machine
interface。这个state-machine必要的时候隐式创建Figure和Axes，并维护current
Figure和current
Axes。该模块中的很多函数是用于给当前Figure的当前Axes添加plot
element，比如line、text、image等。它非常类似于Matlab的用法。常用方法参考<span class="exturl" data-url="aHR0cHM6Ly9tYXRwbG90bGliLm9yZy9zdGFibGUvYXBpL19hc19nZW4vbWF0cGxvdGxpYi5weXBsb3QuaHRtbD9oaWdobGlnaHQ9bWF0cGxvdGxpYiUyMHB5cGxvdCNtb2R1bGUtbWF0cGxvdGxpYi5weXBsb3Q=">pyplot<i class="fa fa-external-link-alt"></i></span></p>
<p>matplotlib.pyplot的下一层是面向对象的接口：在这一层pyplot只是用部分函数来创建Figure，然后通过该Figure显式的创建Axes，然后通过面向对象的接口在该Axes上添加图形。极端情况下用户可以完全抛弃pyplot而完全使用面向对象的接口。</p>
<p><strong>matplotlib.pylab</strong>：是一个便利的module，它导入了matplotlib.pyplot以及numpy，它只是为了plot以及math方便而用。<strong>官方文档不推荐使用它。</strong></p>
<h2 id="配置">配置</h2>
<p>官网<span class="exturl" data-url="aHR0cHM6Ly9tYXRwbG90bGliLm9yZy9zdGFibGUvdHV0b3JpYWxzL2ludHJvZHVjdG9yeS9jdXN0b21pemluZy5odG1s">customizing<i class="fa fa-external-link-alt"></i></span>。<br />
matplotlib配置信息是从配置文件<code>.matplotlibrc</code>中读取的。<br />
在配置文件中可以为matplotlib几乎所有的属性指定永久有效的默认值。<br />
你可以通过索引字典改变这些设置，可通过<code>mpl.rcdefaults()</code>恢复初始值。使用
plt.style 来选择图形的绘图风格。<br />
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 查看配置</span></span><br><span class="line">mpl.rcParams</span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">RcParams(&#123;&#x27;_internal.classic_mode&#x27;: False,</span></span><br><span class="line"><span class="string">          &#x27;agg.path.chunksize&#x27;: 0,</span></span><br><span class="line"><span class="string">          &#x27;animation.avconv_args&#x27;: [],</span></span><br><span class="line"><span class="string">          &#x27;animation.avconv_path&#x27;: &#x27;avconv&#x27;,</span></span><br><span class="line"><span class="string">          &#x27;animation.bitrate&#x27;: -1,</span></span><br><span class="line"><span class="string">          &#x27;animation.codec&#x27;: &#x27;h264&#x27;,</span></span><br><span class="line"><span class="string">          &#x27;animation.convert_args&#x27;: [],</span></span><br><span class="line"><span class="string">          &#x27;animation.convert_path&#x27;: &#x27;convert&#x27;,</span></span><br><span class="line"><span class="string">          &#x27;animation.embed_limit&#x27;: 20.0,</span></span><br><span class="line"><span class="string">          &#x27;animation.ffmpeg_args&#x27;: [],</span></span><br><span class="line"><span class="string">          &#x27;animation.ffmpeg_path&#x27;: &#x27;ffmpeg&#x27;,</span></span><br><span class="line"><span class="string">          &#x27;animation.frame_format&#x27;: &#x27;png&#x27;,</span></span><br><span class="line"><span class="string">          &#x27;animation.html&#x27;: &#x27;none&#x27;,</span></span><br><span class="line"><span class="string">          ...</span></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="comment"># 字典修改所有已经加载的配置项</span></span><br><span class="line">mpl.rcParams[<span class="string">&#x27;lines.color&#x27;</span>] = <span class="string">&#x27;r&#x27;</span></span><br><span class="line">mpl.rcParams[<span class="string">&#x27;lines.color&#x27;</span>]</span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">&#x27;r&#x27;</span></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="comment"># 恢复初始值</span></span><br><span class="line">mpl.rcdefaults()</span><br><span class="line">mpl.rcParams[<span class="string">&#x27;lines.color&#x27;</span>]</span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">&#x27;C0&#x27;</span></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="comment"># 配置绘图样式，经典风格classic</span></span><br><span class="line">plt.style.use(<span class="string">&#x27;classic&#x27;</span>)</span><br></pre></td></tr></table></figure><br />
如果你不希望在每次代码开始时进行参数配置，则可以在项目中给出配置文件。配置文件有三个位置：<br />
（1）系统级配置文件。通常在 python 的 site-packages 目录下。每次重装
matplotlib 之后该配置文件就会被覆盖。<br />
（2）用户级配置文件。通常在<code>$HOME</code>目录下。可以用<code>mpl.get_configdir()</code>函数来查找当前用户的配置文件目录。可以通过<code>MATPLOTLIBRC</code>修改它的位置。<br />
（3）当前工作目录。即项目的目录。在当前目录下，可以为目录所包含的当前项目给出配置文件，文件名为<code>.matplotlibrc</code>。<br />
优先级：<code>当前工作目录 &gt; 用户级配置文件 &gt; 系统级配置文件</code>。查看当前使用的配置文件的路径为：<code>mpl.matplotlib_fname()</code>。</p>
<p>配置文件的内容常见的有以下几种：<br />
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">axes            设置坐标轴边界和表面的颜色、坐标刻度值大小和网格的显示</span><br><span class="line">backend         设置目标输出TkAgg和GTKAgg</span><br><span class="line">figure          控制dpi、边界颜色、图像大小和子区(subplot)设置</span><br><span class="line">font            字体(font family)、字体大小和样式设置</span><br><span class="line">grid            设置网格颜色和线型</span><br><span class="line">legend          设置图例以及其中的文本显示</span><br><span class="line">line            设置线条（颜色、线型、宽度等）和标记</span><br><span class="line">patch           填充2D空间的图形图像，如多边形和圆。控制线宽、颜色和抗锯齿设置等。</span><br><span class="line">savefig         对保存的图形进行单独设置。如渲染的文件背景为白色。</span><br><span class="line">text            设置字体颜色、文本解析（纯文本和latex标记）等。</span><br><span class="line">verbose:        设置matplotlib执行期间的信息输出，如silent、helpful、debug和debug--annoying</span><br><span class="line">xticks、yticks  为x、y轴的主刻度和次刻度设置颜色、大小、方向以及标签大小</span><br></pre></td></tr></table></figure></p>
<p>Matplotlib
每次加载时，都会定义一个<strong>运行时配置</strong>（runtime
configuration，rc），其中包含了所有你创建的图形元素的默认风格。你可以用
<code>plt.rc()</code>
简便方法随时修改这个配置。这些配置会保存在<code>.matplotlibrc</code>文件中。<br />
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line">%matplotlib inline</span><br><span class="line"><span class="keyword">import</span> numpy <span class="keyword">as</span> np</span><br><span class="line"><span class="keyword">import</span> matplotlib.pyplot <span class="keyword">as</span> plt</span><br><span class="line"><span class="keyword">from</span> matplotlib <span class="keyword">import</span> cycler</span><br><span class="line"></span><br><span class="line"><span class="comment"># 先复制一下目前的 rcParams 字典，这样可以在修改之后再还原回来</span></span><br><span class="line">IPython_default = plt.rcParams.copy()</span><br><span class="line"></span><br><span class="line">colors = cycler(<span class="string">&#x27;color&#x27;</span>,[<span class="string">&#x27;#EE6666&#x27;</span>, <span class="string">&#x27;#3388BB&#x27;</span>, <span class="string">&#x27;#9988DD&#x27;</span>,<span class="string">&#x27;#EECC55&#x27;</span>, <span class="string">&#x27;#88BB44&#x27;</span>, <span class="string">&#x27;#FFBBBB&#x27;</span>])</span><br><span class="line"></span><br><span class="line">plt.rc(<span class="string">&#x27;axes&#x27;</span>, facecolor=<span class="string">&#x27;#E6E6E6&#x27;</span>, edgecolor=<span class="string">&#x27;none&#x27;</span>,axisbelow=<span class="literal">True</span>, grid=<span class="literal">True</span>, prop_cycle=colors)</span><br><span class="line">plt.rc(<span class="string">&#x27;grid&#x27;</span>, color=<span class="string">&#x27;w&#x27;</span>, linestyle=<span class="string">&#x27;solid&#x27;</span>)</span><br><span class="line">plt.rc(<span class="string">&#x27;xtick&#x27;</span>, direction=<span class="string">&#x27;out&#x27;</span>, color=<span class="string">&#x27;gray&#x27;</span>)</span><br><span class="line">plt.rc(<span class="string">&#x27;ytick&#x27;</span>, direction=<span class="string">&#x27;out&#x27;</span>, color=<span class="string">&#x27;gray&#x27;</span>)</span><br><span class="line">plt.rc(<span class="string">&#x27;patch&#x27;</span>, edgecolor=<span class="string">&#x27;#E6E6E6&#x27;</span>)</span><br><span class="line">plt.rc(<span class="string">&#x27;lines&#x27;</span>, linewidth=<span class="number">2</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 直方图</span></span><br><span class="line">x = np.random.randn(<span class="number">1000</span>)</span><br><span class="line">plt.hist(x)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 不用时，还原默认配置</span></span><br><span class="line"><span class="comment"># plt.rcParams.update(IPython_default)</span></span><br></pre></td></tr></table></figure><br />
<img src="https://i.loli.net/2021/05/25/EiDR8KCS5XTZVzU.jpg" /><br />
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 折线图</span></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">4</span>):</span><br><span class="line">    plt.plot(np.random.rand(<span class="number">10</span>))</span><br></pre></td></tr></table></figure><br />
<img src="https://i.loli.net/2021/05/25/QeFNs14KUYZkBgA.jpg" /></p>
<h2 id="样式表">样式表</h2>
<p>手动用<code>plt.rc()</code>修改配置，太麻烦，Matplotlib
中增加了一个非常好用的 style
模块里面包含了大量的新式默认样式表，还支持创建和打包你自己的风格。虽然这些样式表实现的格式功能与前面介绍的<code>.matplotlibrc</code>文件类似，但是它的文件扩展名是<code>.mplstyle</code>。通过<code>plt.style.available</code>
命令可以看到所有可用的风格：<br />
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 查看前5个样式</span></span><br><span class="line">plt.style.available[:<span class="number">5</span>]</span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">[&#x27;fivethirtyeight&#x27;,</span></span><br><span class="line"><span class="string">&#x27;seaborn-pastel&#x27;,</span></span><br><span class="line"><span class="string">&#x27;seaborn-whitegrid&#x27;,</span></span><br><span class="line"><span class="string">&#x27;ggplot&#x27;,</span></span><br><span class="line"><span class="string">&#x27;grayscale&#x27;]</span></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br></pre></td></tr></table></figure><br />
使用某一个样式：<code>plt.style.use('stylename')</code>，但需要注意的是，这样会改变后面所有的风格！如果需要，你可以使用风格上下文管理器临时更换至另一种风格：<br />
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">with</span> plt.style.context(<span class="string">&#x27;stylename&#x27;</span>):</span><br><span class="line">    <span class="comment">#...</span></span><br></pre></td></tr></table></figure><br />
常用的是seaborn风格，除了<code>plt.style.use('seaborn-pastel')</code>这种方式导入样式，还能用<code>import seaborn</code>，在
Notebook 导入 Seaborn 程序库后会自动加载seaborn样式。</p>
<h2 id="绘图显示">绘图显示</h2>
<p>如何显示你的图形，就取决于具体的开发环境了。 Matplotlib
的最佳实践与你使用的开发环境有关。简单来说，就是有三种开发环境，分别是<strong>脚本</strong>、
<strong>IPython shell</strong> 和 <strong>IPython
Notebook</strong>。<br />
（1）<strong>脚本</strong>文件中使用Matplotlib，那么显示图形的时候<strong>必须使用<code>plt.show()</code></strong>。<br />
（2）<strong>IPython
shell</strong>中<strong>交互式</strong>地使用Matplotlib，需使用<code>%matplotlib</code>魔法命令启动Matplotlib模式。<br />
（3）<strong>IPython
Notebook</strong>中使用Matplotlib有两种方式：<code>%matplotlib notebook</code>
启动<strong>交互式</strong>图形；<code>%matplotlib inline</code>
启动<strong>静态</strong>图形。<br />
之后的所有Notebook中的例子都会使用静态模式。<br />
<div class="note info"><p>plt.show() 会启动一个事件循环（event
loop），并找到所有当前可用的图形对象，然后打开一个或多个交互式窗口显示图形。但一个
Python 会话中只能使用一次 plt.show()，因此通常都把它放在脚本的最后。</p>
<p>IPython shell中启动Matplotlib 模式后，任何 plt
命令都会自动打开一个图形窗口，增加新的命令，图形就会更新，所以不需要使用
plt.show()。有一些变化（例如改变已经画好的线条属性）不会自动及时更新；对于这些变化，可以使用plt.draw()
强制更新。</p>
<p>IPython Notebook 中，静态模式时，运行单元格中的命令之后（每一个
Notebook 核心任务 / 会话只需要运行一次），在每一个 Notebook
的单元中创建图形就会直接将 PNG 格式图形文件嵌入在单元中。</p>
</div></p>
<h2 id="图形保存">图形保存</h2>
<p>Matplotlib 的一个优点是能够将图形保存为各种不同的数据格式。你可以用
<code>savefig()</code> 命令将图形保存为文件。例如，如果要将图形保存为
PNG 格式，你可以运行这行代码：<br />
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> numpy <span class="keyword">as</span> np</span><br><span class="line"><span class="keyword">import</span> matplotlib <span class="keyword">as</span> mpl</span><br><span class="line"><span class="keyword">import</span> matplotlib.pyplot <span class="keyword">as</span> plt</span><br><span class="line">x = np.linspace(<span class="number">0</span>, <span class="number">10</span>, <span class="number">100</span>)</span><br><span class="line"></span><br><span class="line">fig = plt.figure()</span><br><span class="line">plt.plot(x, np.sin(x), <span class="string">&#x27;-&#x27;</span>)</span><br><span class="line">plt.plot(x, np.cos(x), <span class="string">&#x27;--&#x27;</span>)</span><br><span class="line"><span class="comment"># 保存图形</span></span><br><span class="line">fig.savefig(<span class="string">&#x27;my_figure.png&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 显示保存的图形</span></span><br><span class="line"><span class="keyword">from</span> IPython.display <span class="keyword">import</span> Image</span><br><span class="line">Image(<span class="string">&#x27;my_figure.png&#x27;</span>)</span><br></pre></td></tr></table></figure><br />
在 savefig() 里面，保存的图片文件格式就是文件的扩展名。 你可以通过
canvas 对象的方法查看系统支持的文件格式：<br />
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">fig.canvas.get_supported_filetypes()</span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">&#123;&#x27;ps&#x27;: &#x27;Postscript&#x27;,</span></span><br><span class="line"><span class="string"> &#x27;eps&#x27;: &#x27;Encapsulated Postscript&#x27;,</span></span><br><span class="line"><span class="string"> &#x27;pdf&#x27;: &#x27;Portable Document Format&#x27;,</span></span><br><span class="line"><span class="string"> &#x27;pgf&#x27;: &#x27;PGF code for LaTeX&#x27;,</span></span><br><span class="line"><span class="string"> &#x27;png&#x27;: &#x27;Portable Network Graphics&#x27;,</span></span><br><span class="line"><span class="string"> &#x27;raw&#x27;: &#x27;Raw RGBA bitmap&#x27;,</span></span><br><span class="line"><span class="string"> &#x27;rgba&#x27;: &#x27;Raw RGBA bitmap&#x27;,</span></span><br><span class="line"><span class="string"> &#x27;svg&#x27;: &#x27;Scalable Vector Graphics&#x27;,</span></span><br><span class="line"><span class="string"> &#x27;svgz&#x27;: &#x27;Scalable Vector Graphics&#x27;&#125;</span></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br></pre></td></tr></table></figure></p>
<h2 id="两种画图接口">两种画图接口</h2>
<p>Matplotlib
有一个容易让人混淆的特性，就是它的两种画图接口：一个是便捷的<strong>MATLAB风格接口</strong>，另一个是功能更强大的<strong>面向对象接口</strong>。下面来快速对比一下两种接口的主要差异。<br />
（1）MATLAB风格接口：许多语法都和MATLAB类似。MATLAB风格的工具位于
<code>pyplot（plt）</code>接口中。这种接口最重要的特性是有状态的：它会持续跟踪“当前的”图形和坐标轴，所有
plt 命令都可以应用。你可以用
<code>plt.gcf()</code>（获取当前图形，figure对象）和
<code>plt.gca()</code>（获取当前坐标轴，Axes对象）来查看具体信息。虽然这个有状态的接口画起图来又快又方便，但是也很容易出问题，例如，当创建上面的第二个子图时，想回到第一个子图，并增加新内容，这在MATLAB风格接口中实现就非常复杂了。<br />
（2）面向对象接口：画图函数不再受到当前“活动”图形或坐标轴的限制，而变成了显式的
Figure 和 Axes
的方法。可以适应更复杂的场景，更好地控制你自己的图形。</p>
<p>虽然在画简单图形时，选择哪种绘图风格主要看个人喜好，但是在画比较复杂的图形时，面向对象方法会更方便。在绝大多数场景中，<code>plt.plot()</code>
与 <code>ax.plot()</code>
的差异非常小，但是后文会重点指出其中的一些陷阱。</p>
<div class="tabs" id="f1"><ul class="nav-tabs"><li class="tab active"><a href="#f1-1">MATLAB风格接口</a></li><li class="tab"><a href="#f1-2">面向对象接口</a></li></ul><div class="tab-content"><div class="tab-pane active" id="f1-1"><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">plt.figure() <span class="comment"># 创建图形</span></span><br><span class="line"><span class="comment"># 创建两个子图中的第一个，设置坐标轴</span></span><br><span class="line">plt.subplot(<span class="number">2</span>, <span class="number">1</span>, <span class="number">1</span>) <span class="comment"># (行、列、子图编号)</span></span><br><span class="line">plt.plot(x, np.sin(x))</span><br><span class="line"><span class="comment"># 创建两个子图中的第二个，设置坐标轴</span></span><br><span class="line">plt.subplot(<span class="number">2</span>, <span class="number">1</span>, <span class="number">2</span>)</span><br><span class="line">plt.plot(x, np.cos(x))</span><br></pre></td></tr></table></figure></div><div class="tab-pane" id="f1-2"><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 先创建图形网格</span></span><br><span class="line"><span class="comment"># ax是一个包含两个Axes对象的数组</span></span><br><span class="line">fig, ax = plt.subplots(<span class="number">2</span>)</span><br><span class="line"><span class="comment"># 在每个对象上调用plot()方法</span></span><br><span class="line">ax[<span class="number">0</span>].plot(x, np.sin(x))</span><br><span class="line">ax[<span class="number">1</span>].plot(x, np.cos(x))</span><br><span class="line"></span><br><span class="line"><span class="comment"># 或者用pylab接口画图，但官方不建议使用！</span></span><br><span class="line">plt.plot(x, np.sin(x))</span><br></pre></td></tr></table></figure></div></div></div>
<p>对于非交互式绘图，官方文档推荐用pyplot创建Figure，然后使用面向对象接口来绘图。</p>
<h2 id="颜色相关">颜色相关</h2>
<p>可以通过<code>matplotlib.pyplot.colors()</code>方法获取matplotlib支持的所有颜色。该方法不做任何事情，就是提供一个帮助文档。<br />
或者参考官方提供的颜色代码：<span class="exturl" data-url="aHR0cHM6Ly94a2NkLmNvbS9jb2xvci9yZ2Iv">colors<i class="fa fa-external-link-alt"></i></span>。<br />
<strong>Ⅰ、字符串</strong><br />
matplotlib提供了下面颜色的别名：'b'：蓝色；'g'：绿色；'r'：红色；'y'：黄色；'c'：青色；'k'：黑色；'m'：洋红色；'w'：白色。</p>
<p>你也可以定制自己的颜色。有两种方法：<br />
（1）使用HTML十六进制字符串/颜色名字：如'#eeefff'，如'red'<br />
（2）使用一个归一化到闭区间[0-1]的RGB元组：如color=(0.3,0.3,0.4)</p>
<p><strong>Ⅱ、颜色代码转换</strong><br />
matplotlib.colors是一个模块，用于转换数字或者颜色参数到 RGB 或者
RGBA。<br />
RGB：一个浮点数元组，有3个浮点数。每个数都是 0-1之间。<br />
RGBA：一个浮点数元组，有4个浮点数。每个数都是 0-1之间。</p>
<p>colors.cnames是个字典，它给出了常用颜色的字符串和对应的#FFFFFF形式。<br />
<code>colors.rgb2hex(rgb)</code>：给出了rgb元组到#FFFFFF形式。
而<code>hex2color(s)</code>给出了#FFFFFF到rgb形式。</p>
<p>colors.ColorConverter类是个颜色转换器类。它提供了下面方法用于转换颜色：<br />
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">.to_rgb(arg)：转换其他类型的颜色到标准的rgb三元组。</span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">arg: 可以为一个rgb/rgba序列/一个字符串，字符串格式为：</span></span><br><span class="line"><span class="string">    一个代表颜色的字符，如&#x27;rgbcmykw&#x27;</span></span><br><span class="line"><span class="string">    一个十六进制的颜色字符串，如&#x27;#0FFFFFF&#x27;</span></span><br><span class="line"><span class="string">    一个标准的颜色的名字，如&#x27;red&#x27;</span></span><br><span class="line"><span class="string">    一个代表浮点数的字符串，如&#x27;0.5&#x27;</span></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line">.to_rgba(arg, alpha=<span class="literal">None</span>)：转换其他类型的颜色到标准的rgba四元组</span><br><span class="line">.to_rgba_array(c, alpha=<span class="literal">None</span>)：它返回一个ndarray，而不是一个元组</span><br><span class="line">colors.colorConverter是模块提供的一个默认的实例。</span><br></pre></td></tr></table></figure><br />
<strong>Ⅲ、颜色条</strong><br />
通过 plt.colorbar() 函数就可以创建最简单的颜色条：<br />
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> matplotlib.pyplot <span class="keyword">as</span> plt</span><br><span class="line">%matplotlib inline</span><br><span class="line"><span class="keyword">import</span> numpy <span class="keyword">as</span> np</span><br><span class="line">plt.style.use(<span class="string">&#x27;classic&#x27;</span>)</span><br><span class="line"></span><br><span class="line">x = np.linspace(<span class="number">0</span>, <span class="number">10</span>, <span class="number">1000</span>)</span><br><span class="line">I = np.sin(x) * np.cos(x[:, np.newaxis])</span><br><span class="line">plt.imshow(I)</span><br><span class="line">plt.colorbar()</span><br></pre></td></tr></table></figure><br />
可以通过 cmap 参数配置调色盘，下面详细介绍下调色盘和配色方案等。<br />
<strong>1、调色盘</strong><br />
参考调色盘：<span class="exturl" data-url="aHR0cHM6Ly9tYXRwbG90bGliLm9yZy8yLjAuMi9leGFtcGxlcy9jb2xvci9jb2xvcm1hcHNfcmVmZXJlbmNlLmh0bWw=">colormaps<i class="fa fa-external-link-alt"></i></span>。</p>
<p>matplotlib.cm模块包含了一系列的colormap，以及相关的函数。它主要有两个函数：<br />
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line">matplotlib.cm.get_cmap(name=<span class="literal">None</span>, lut=<span class="literal">None</span>)：获取一个colormap实例。</span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">name：指定了colormap的名字。如果为None，则使用rc配置。如果它已经是colormap实例，则直接返回该实例。</span></span><br><span class="line"><span class="string">      注意：register_cmap注册的colormap优先查询</span></span><br><span class="line"><span class="string">lut：一个整数。如果非None，则指定了查询表的number of entries</span></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line">matplotlib.cm.register_cmap(name=<span class="literal">None</span>, cmap=<span class="literal">None</span>, data=<span class="literal">None</span>, lut=<span class="literal">None</span>)：注册一个colormap。有两种使用方式：</span><br><span class="line">    register_cmap(name=<span class="string">&#x27;swirly&#x27;</span>, cmap=swirly_cmap)：此时cmap参数必须是mpl.colors.Colormap实例。</span><br><span class="line">                                                    name默认为该Colormap实例的.name属性。</span><br><span class="line">    register_cmap(name=<span class="string">&#x27;choppy&#x27;</span>, data=choppydata, lut=<span class="number">128</span>)：</span><br><span class="line">                    此时这三个参数传递给mpl.colors.LinearSegementedColormap初始化函数。</span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">配色方案都在 plt.cm 命名空间（name）里面，如下:</span></span><br><span class="line"><span class="string">&#x27;Perceptually Uniform Sequential&#x27;:[&#x27;viridis&#x27;, &#x27;inferno&#x27;, &#x27;plasma&#x27;, &#x27;magma&#x27;]</span></span><br><span class="line"><span class="string">  &#x27;Sequential&#x27;:[&#x27;Blues&#x27;, &#x27;BuGn&#x27;, &#x27;BuPu&#x27;,&#x27;GnBu&#x27;, &#x27;Greens&#x27;, &#x27;Greys&#x27;, &#x27;Oranges&#x27;, &#x27;OrRd&#x27;,</span></span><br><span class="line"><span class="string">  &#x27;PuBu&#x27;, &#x27;PuBuGn&#x27;, &#x27;PuRd&#x27;, &#x27;Purples&#x27;, &#x27;RdPu&#x27;,&#x27;Reds&#x27;, &#x27;YlGn&#x27;, &#x27;YlGnBu&#x27;, </span></span><br><span class="line"><span class="string">  &#x27;YlOrBr&#x27;, &#x27;YlOrRd&#x27;]</span></span><br><span class="line"><span class="string">  &#x27;Sequential (2)&#x27;:[&#x27;afmhot&#x27;, &#x27;autumn&#x27;, &#x27;bone&#x27;, &#x27;cool&#x27;,&#x27;copper&#x27;, &#x27;gist_heat&#x27;, &#x27;gray&#x27;, </span></span><br><span class="line"><span class="string">  &#x27;hot&#x27;,&#x27;pink&#x27;, &#x27;spring&#x27;, &#x27;summer&#x27;, &#x27;winter&#x27;] </span></span><br><span class="line"><span class="string">  &#x27;Diverging&#x27;:[&#x27;BrBG&#x27;, &#x27;bwr&#x27;, &#x27;coolwarm&#x27;, &#x27;PiYG&#x27;, &#x27;PRGn&#x27;, &#x27;PuOr&#x27;,</span></span><br><span class="line"><span class="string">  &#x27;RdBu&#x27;, &#x27;RdGy&#x27;, &#x27;RdYlBu&#x27;, &#x27;RdYlGn&#x27;, &#x27;Spectral&#x27;,&#x27;seismic&#x27;] </span></span><br><span class="line"><span class="string">  &#x27;Qualitative&#x27;:[&#x27;Accent&#x27;, &#x27;Dark2&#x27;, &#x27;Paired&#x27;, &#x27;Pastel1&#x27;, &#x27;Pastel2&#x27;,</span></span><br><span class="line"><span class="string">  &#x27;Set1&#x27;, &#x27;Set2&#x27;, &#x27;Set3&#x27;] </span></span><br><span class="line"><span class="string">  &#x27;Miscellaneous&#x27;:[&#x27;gist_earth&#x27;, &#x27;terrain&#x27;, &#x27;ocean&#x27;, &#x27;gist_stern&#x27;,&#x27;brg&#x27;,</span></span><br><span class="line"><span class="string">  &#x27;CMRmap&#x27;, &#x27;cubehelix&#x27;,&#x27;gnuplot&#x27;, &#x27;gnuplot2&#x27;,   </span></span><br><span class="line"><span class="string">  &#x27;gist_ncar&#x27;,&#x27;nipy_spectral&#x27;, &#x27;jet&#x27;, &#x27;rainbow&#x27;,</span></span><br><span class="line"><span class="string">  &#x27;gist_rainbow&#x27;, &#x27;hsv&#x27;, &#x27;flag&#x27;, &#x27;prism&#x27;] </span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">可使用 plt.cm.&lt;TAB&gt; 查看这些配色方案。</span></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br></pre></td></tr></table></figure><br />
可以使用cm.get_cmap('winter')来使用，也可以直接用cm.winter来使用。</p>
<p>很多函数中有 cmap 参数，就是使用的调色盘。<br />
<strong>2、配色方案</strong><br />
一般情况下，你只需要重点关注三种不同的配色方案：<br />
（1）顺序配色方案：由一组连续的颜色构成的配色方案（例如 binary 或
viridis）。<br />
（2）互逆配色方案：通常由两种互补的颜色构成，表示正反两种含义（例如 RdBu
或 PuOr）。<br />
（3）定性配色方案：随机顺序的一组颜色（例如 rainbow 或 jet）</p>
<p>jet 是一种定性配色方案，曾是 Matplotlib 2.0
之前所有版本的默认配色方案。把它作为默认配色方案实在不是个好主意，因为定性配色方案在对定性数据进行可视化时的选择空间非常有限。随着图形亮度的提高，经常会出现颜色无法区分的问题。</p>
<p>更好的配色方案是 viridis，已经成为 Matplotlib 2.0
的默认配色方案。它采用了精心设计的亮度渐变方式，这样不仅便于视觉观察，而且转换成灰度图后也更清晰。<br />
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># jet 转换为黑白的灰度图看看具体的颜色</span></span><br><span class="line"><span class="keyword">from</span> matplotlib.colors <span class="keyword">import</span> LinearSegmentedColormap</span><br><span class="line"><span class="keyword">def</span> <span class="title function_">grayscale_cmap</span>(<span class="params">cmap</span>):</span><br><span class="line">    <span class="string">&quot;&quot;&quot;为配色方案显示灰度图&quot;&quot;&quot;</span></span><br><span class="line">    cmap = plt.cm.get_cmap(cmap)</span><br><span class="line">    colors = cmap(np.arange(cmap.N))</span><br><span class="line"></span><br><span class="line">    <span class="comment"># 将RGBA色转换为不同亮度的灰度值</span></span><br><span class="line">    <span class="comment"># 参考链接http://alienryderflex.com/hsp.html</span></span><br><span class="line">    RGB_weight = [<span class="number">0.299</span>, <span class="number">0.587</span>, <span class="number">0.114</span>]</span><br><span class="line">    luminance = np.sqrt(np.dot(colors[:, :<span class="number">3</span>] ** <span class="number">2</span>, RGB_weight))</span><br><span class="line">    colors[:, :<span class="number">3</span>] = luminance[:, np.newaxis]</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> LinearSegmentedColormap.from_list(cmap.name + <span class="string">&quot;_gray&quot;</span>, colors, cmap.N)</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">view_colormap</span>(<span class="params">cmap</span>):</span><br><span class="line">    <span class="string">&quot;&quot;&quot;用等价的灰度图表示配色方案&quot;&quot;&quot;</span></span><br><span class="line">    cmap = plt.cm.get_cmap(cmap)</span><br><span class="line">    colors = cmap(np.arange(cmap.N))</span><br><span class="line"></span><br><span class="line">    cmap = grayscale_cmap(cmap)</span><br><span class="line">    grayscale = cmap(np.arange(cmap.N))</span><br><span class="line"></span><br><span class="line">    fig, ax = plt.subplots(<span class="number">2</span>, figsize=(<span class="number">6</span>, <span class="number">2</span>), subplot_kw=<span class="built_in">dict</span>(xticks=[], yticks=[]))</span><br><span class="line"></span><br><span class="line">    <span class="comment"># 每个配色方案都有2个图：色彩图、灰度图</span></span><br><span class="line">    ax[<span class="number">0</span>].imshow([colors], extent=[<span class="number">0</span>, <span class="number">10</span>, <span class="number">0</span>, <span class="number">1</span>])</span><br><span class="line">    ax[<span class="number">1</span>].imshow([grayscale], extent=[<span class="number">0</span>, <span class="number">10</span>, <span class="number">0</span>, <span class="number">1</span>])</span><br><span class="line"></span><br><span class="line"><span class="comment"># jet 黑白</span></span><br><span class="line">view_colormap(<span class="string">&#x27;jet&#x27;</span>)</span><br><span class="line"><span class="comment"># viridis</span></span><br><span class="line">view_colormap(<span class="string">&#x27;viridis&#x27;</span>)</span><br><span class="line"><span class="comment"># cubehelix 彩虹色</span></span><br><span class="line">view_colormap(<span class="string">&#x27;cubehelix&#x27;</span>)</span><br><span class="line"><span class="comment"># 要用两种颜色表示正反两种含义时，可以使用 RdBu 双色配色方案，红色-蓝色（Red-Blue简称）</span></span><br><span class="line">view_colormap(<span class="string">&#x27;RdBu&#x27;</span>)</span><br></pre></td></tr></table></figure><br />
<img src="https://i.loli.net/2021/05/24/gD14zfP3vbuY8ds.jpg" /></p>
<p><strong>3、颜色条刻度等设置</strong><br />
Matplotlib 提供了丰富的颜色条配置功能。由于可以将颜色条本身仅看作是一个
plt.Axes实例，因此所有关于坐标轴和刻度值的格式配置技巧都可以派上用场。<br />
例如，我们可以缩短颜色取值的上下限，对于超出上下限的数据，通过 extend
参数用三角箭头表示比上限大的数或者比下限小的数。比如你想展示一张噪点图：<br />
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 为图形像素设置1%噪点</span></span><br><span class="line">x = np.linspace(<span class="number">0</span>, <span class="number">10</span>, <span class="number">1000</span>)</span><br><span class="line">I = np.sin(x) * np.cos(x[:, np.newaxis])</span><br><span class="line">speckles = (np.random.random(I.shape) &lt; <span class="number">0.01</span>)</span><br><span class="line">I[speckles] = np.random.normal(<span class="number">0</span>, <span class="number">3</span>, np.count_nonzero(speckles))</span><br><span class="line"></span><br><span class="line">plt.figure(figsize=(<span class="number">10</span>, <span class="number">3.5</span>))</span><br><span class="line"></span><br><span class="line">plt.subplot(<span class="number">1</span>, <span class="number">2</span>, <span class="number">1</span>)</span><br><span class="line">plt.imshow(I, cmap=<span class="string">&#x27;RdBu&#x27;</span>)</span><br><span class="line">plt.colorbar()</span><br><span class="line"></span><br><span class="line">plt.subplot(<span class="number">1</span>, <span class="number">2</span>, <span class="number">2</span>)</span><br><span class="line">plt.imshow(I, cmap=<span class="string">&#x27;RdBu&#x27;</span>)</span><br><span class="line">plt.colorbar(extend=<span class="string">&#x27;both&#x27;</span>)</span><br><span class="line">plt.clim(-<span class="number">1</span>, <span class="number">1</span>)</span><br></pre></td></tr></table></figure><br />
<img src="https://i.loli.net/2021/05/24/OJdV6aQhq7iGgKl.jpg" /><br />
左边那幅图是用默认的颜色条刻度限制实现的效果，噪点的范围完全覆盖了我们感兴趣的数据。而右边的图形设置了颜色条的刻度上下限，并在上下限之外增加了扩展功能，这样的数据可视化图形显然更有效果。</p>
<p><strong>4、离散型颜色条</strong><br />
虽然颜色条默认都是连续的，但有时你可能也需要表示离散数据。最简单的做法就是使用<code>plt.cm.get_cmap()</code>函数，将适当的配色方案的名称以及需要的区间数量传进去即可。<br />
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">plt.imshow(I, cmap=plt.cm.get_cmap(<span class="string">&#x27;Blues&#x27;</span>, <span class="number">6</span>))</span><br><span class="line">plt.colorbar()</span><br><span class="line">plt.clim(-<span class="number">1</span>, <span class="number">1</span>) <span class="comment"># 设置颜色区间</span></span><br></pre></td></tr></table></figure><br />
<img src="https://i.loli.net/2021/05/24/odkw4xtLuQbl9hK.jpg"
alt="离散颜色条.jpg" /></p>
<h2 id="点的形状">点的形状</h2>
<p>参考<span class="exturl" data-url="aHR0cHM6Ly9tYXRwbG90bGliLm9yZy9zdGFibGUvYXBpL21hcmtlcnNfYXBpLmh0bWw=">matplotlib.markers<i class="fa fa-external-link-alt"></i></span>。<br />
<img src="https://i.loli.net/2021/05/24/4WHxe6LDfpvOzEu.png"
alt="marker形状.jpg" /></p>
<h2 id="子图布局">子图布局</h2>
<p><code>pyplot.subplot2grid()</code>：创建网格布局。你只需要提供网格形状以及SubPlot位置即可，如：<br />
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">plt.subplot2grid((<span class="number">2</span>,<span class="number">2</span>),(<span class="number">0</span>,<span class="number">0</span>))</span><br><span class="line"><span class="comment"># 它等价于ax=pyplot.subplot(2,2,1)。其中subplot2grid()的位置坐标从0开始。</span></span><br></pre></td></tr></table></figure><br />
<code>subplot2grid()</code>支持SubPlot横跨或者纵跨多个单元格。colspan关键字参数指定纵向的跨度；rowspanguan尖子参数指定横向的跨度。<br />
<strong>1、单个子图</strong><br />
<code>Figure.add_subplot(*args,**kwargs)</code>/<code>pyplot.subplot(*args,**kwargs)</code>方法做一个子图布局，它返回的是Axes实例。SubPlot类是Axes类的子类。因此SubPlot对象也是Axes对象。<br />
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">matplotlib.pyplot.subplot(nrows,ncols,plot_number)：创建子图</span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">nrows和ncols将图表划分成nrows*ncols大小的网格区域，每一个区域都能存放一个子图；</span></span><br><span class="line"><span class="string">plot_number子图位置。从1开始，从左到右，从上到下，最大值为nrows*ncols。</span></span><br><span class="line"><span class="string">如果nrows、ncols、plot_number都是个位数，则你可以指定一个三位数来简化函数调用plt.subplot(integer)：</span></span><br><span class="line"><span class="string">    其中百分位代表nrows，十分位代表ncols，各位代表plot_number。</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">其他参数：</span></span><br><span class="line"><span class="string">axisbg：指定subplot的背景色</span></span><br><span class="line"><span class="string">polar：指定subplot是否是极坐标。默认为False</span></span><br><span class="line"><span class="string">projection：指定坐标方式。值可以为：</span></span><br><span class="line"><span class="string">            &#x27;aitoff&#x27;、&#x27;hammer&#x27;、&#x27;lambert&#x27;、&#x27;mollweide&#x27;、</span></span><br><span class="line"><span class="string">            &#x27;polar&#x27;、 &#x27;rectilinear&#x27;。当projection=&#x27;polar&#x27;等价于ploar=True</span></span><br><span class="line"><span class="string">sharex关键字参数：指定subplot与其他Axes(由该参数值指定）共享xaxis attribute</span></span><br><span class="line"><span class="string">sharey关键字参数：指定subplot是否与其他Axes(由该参数值指定）共享yaxis attribute</span></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br></pre></td></tr></table></figure><br />
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># subplot，下图左</span></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">1</span>, <span class="number">7</span>):</span><br><span class="line">    plt.subplot(<span class="number">2</span>, <span class="number">3</span>, i)</span><br><span class="line">    plt.text(<span class="number">0.5</span>, <span class="number">0.5</span>, <span class="built_in">str</span>((<span class="number">2</span>, <span class="number">3</span>, i)), fontsize=<span class="number">18</span>, ha=<span class="string">&#x27;center&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># subplots_adjust 调整位置和间距，下图右</span></span><br><span class="line">fig = plt.figure()</span><br><span class="line">fig.subplots_adjust(hspace=<span class="number">0.4</span>, wspace=<span class="number">0.4</span>)</span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">1</span>, <span class="number">7</span>):</span><br><span class="line">    ax = fig.add_subplot(<span class="number">2</span>, <span class="number">3</span>, i)</span><br><span class="line">    ax.text(<span class="number">0.5</span>, <span class="number">0.5</span>, <span class="built_in">str</span>((<span class="number">2</span>, <span class="number">3</span>, i)), fontsize=<span class="number">18</span>, ha=<span class="string">&#x27;center&#x27;</span>)</span><br></pre></td></tr></table></figure><br />
<div class="group-picture"><div class="group-picture-row"><div class="group-picture-column"><img src="https://i.loli.net/2021/05/24/kf7Dix3pEBbK4lj.jpg" /></div><div class="group-picture-column"><img src="https://i.loli.net/2021/05/24/SowXgFQlE1di23M.jpg" /></div></div></div></p>
<p><strong>2、多个子图</strong><br />
可以通过<code>pyplot.subplots()</code>函数一次性的创建多个SubPlot。<br />
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line">matplotlib.pyplot.subplots(*args,**kwargs)</span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">nrows：行数，默认为1</span></span><br><span class="line"><span class="string">ncols：列数，默认为1</span></span><br><span class="line"><span class="string">sharex：</span></span><br><span class="line"><span class="string">        如果为True，则所有SubPlot的X axis被共享。此时只有最后一行的X轴可见。</span></span><br><span class="line"><span class="string">        如果为False，则SubPlot的X axis不共享，每一个SbuPlot的X轴可见。</span></span><br><span class="line"><span class="string">        如果为字符串all，则等效于True</span></span><br><span class="line"><span class="string">        如果为字符串none，则当小于False</span></span><br><span class="line"><span class="string">        如果为字符串row，则每一行的SubPlot共享一个X轴（与False等效）</span></span><br><span class="line"><span class="string">        如果为字符串col，则每一列的SubPlot共享一个X轴（与True等效）</span></span><br><span class="line"><span class="string">sharey：</span></span><br><span class="line"><span class="string">        如果为True，则所有SubPlot的Y axis被共享。此时只有第一列的Y轴可见。</span></span><br><span class="line"><span class="string">        如果为False，则SubPlot的Y axis不共享，每一个SbuPlot的Y轴可见。</span></span><br><span class="line"><span class="string">        如果为字符串all，则等效于True</span></span><br><span class="line"><span class="string">        如果为字符串none，则当小于False</span></span><br><span class="line"><span class="string">        如果为字符串row，则每一行的SubPlot共享一个Y轴（与True等效）</span></span><br><span class="line"><span class="string">        如果为字符串col，则每一列的SubPlot共享一个Y轴（与False等效）</span></span><br><span class="line"><span class="string">squeeze：</span></span><br><span class="line"><span class="string">        如果为True：</span></span><br><span class="line"><span class="string">                    如果只创建了一个SubPlot，则返回一个变量（创建的SubPlot对象)</span></span><br><span class="line"><span class="string">                    如果创建了N*1或者1*N个SubPlot，则返回一个1维向量</span></span><br><span class="line"><span class="string">                    如果创建了N*M个SubPlot（其中N&gt;1,M&gt;1），则返回一个2维向量</span></span><br><span class="line"><span class="string">                    如果为False则始终返回一个2维向量</span></span><br><span class="line"><span class="string">        如果为False则始终返回一个2维向量</span></span><br><span class="line"><span class="string">subplot_kw：一个字典参数，用于传递给Axes.add_subplot()来创建SubPlot</span></span><br><span class="line"><span class="string">gridspec_kw：一个字典参数，用于传递给GridSpec构造函数来创建SubPlot存放的网格</span></span><br><span class="line"><span class="string">fig_kw：一个字典参数，用于传递给pyplot.figure()函数。所有前述未能识别的感激案子参数都会传到这里。</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">其返回值为figure,ax。其中figure是一个Figure对象；ax取决于squeeze参数。</span></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br></pre></td></tr></table></figure><br />
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 创建一个 2×3 网格子图，每行的3个子图使用相同的y轴坐标，每列的2个子图使用相同的x轴坐标</span></span><br><span class="line"><span class="comment"># 设置 sharex 与 sharey 参数之后，我们就可以自动去掉网格内部子图的标签，让图形看起来更整洁</span></span><br><span class="line">fig, ax = plt.subplots(<span class="number">2</span>, <span class="number">3</span>, sharex=<span class="string">&#x27;col&#x27;</span>, sharey=<span class="string">&#x27;row&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 坐标轴存放在一个NumPy数组中，按照[row, col]取值</span></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">2</span>):</span><br><span class="line">    <span class="keyword">for</span> j <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">3</span>):</span><br><span class="line">        ax[i, j].text(<span class="number">0.5</span>, <span class="number">0.5</span>, <span class="built_in">str</span>((i, j)), fontsize=<span class="number">18</span>, ha=<span class="string">&#x27;center&#x27;</span>)</span><br></pre></td></tr></table></figure><br />
<img src="https://i.loli.net/2021/05/24/ngr1q8p6bUwlRTH.jpg"
alt="subplots.jpg" /></p>
<p><strong>3、不规则子图</strong><br />
实现不规则的多行多列子图网格，<code>plt.GridSpec()</code>是最好的工具。<code>plt.GridSpec()</code>对象本身不能直接创建一个图形，它只是<code>plt.subplot()</code>命令可以识别的简易接口。<br />
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 一个带行列间距的2×3网格</span></span><br><span class="line">grid = plt.GridSpec(<span class="number">2</span>, <span class="number">3</span>, wspace=<span class="number">0.4</span>, hspace=<span class="number">0.3</span>)</span><br><span class="line"><span class="comment"># 类似 Python 切片的语法设置子图的位置和扩展尺寸</span></span><br><span class="line">plt.subplot(grid[<span class="number">0</span>, <span class="number">0</span>])</span><br><span class="line">plt.subplot(grid[<span class="number">0</span>, <span class="number">1</span>:])</span><br><span class="line">plt.subplot(grid[<span class="number">1</span>, :<span class="number">2</span>])</span><br><span class="line">plt.subplot(grid[<span class="number">1</span>, <span class="number">2</span>])</span><br></pre></td></tr></table></figure><br />
<img src="https://i.loli.net/2021/05/24/3XnAv6cjaQxEdiZ.jpg" /></p>
<p>这种灵活的网格排列方式用途十分广泛，我经常会用它来创建多轴频次直方图：<br />
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 创建一些正态分布数据</span></span><br><span class="line">mean = [<span class="number">0</span>, <span class="number">0</span>]</span><br><span class="line">cov = [[<span class="number">1</span>, <span class="number">1</span>], [<span class="number">1</span>, <span class="number">2</span>]]</span><br><span class="line">x, y = np.random.multivariate_normal(mean, cov, <span class="number">3000</span>).T</span><br><span class="line"></span><br><span class="line"><span class="comment"># 设置坐标轴和网格配置方式</span></span><br><span class="line">fig = plt.figure(figsize=(<span class="number">6</span>, <span class="number">6</span>))</span><br><span class="line">grid = plt.GridSpec(<span class="number">4</span>, <span class="number">4</span>, hspace=<span class="number">0.2</span>, wspace=<span class="number">0.2</span>)</span><br><span class="line">main_ax = fig.add_subplot(grid[:-<span class="number">1</span>, <span class="number">1</span>:])</span><br><span class="line">y_hist = fig.add_subplot(grid[:-<span class="number">1</span>, <span class="number">0</span>], xticklabels=[], sharey=main_ax)</span><br><span class="line">x_hist = fig.add_subplot(grid[-<span class="number">1</span>, <span class="number">1</span>:], yticklabels=[], sharex=main_ax)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 主坐标轴画散点图</span></span><br><span class="line">main_ax.plot(x, y, <span class="string">&#x27;ok&#x27;</span>, markersize=<span class="number">3</span>, alpha=<span class="number">0.2</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 次坐标轴画频次直方图</span></span><br><span class="line">x_hist.hist(x, <span class="number">40</span>, histtype=<span class="string">&#x27;stepfilled&#x27;</span>, orientation=<span class="string">&#x27;vertical&#x27;</span>, color=<span class="string">&#x27;gray&#x27;</span>)</span><br><span class="line">x_hist.invert_yaxis()</span><br><span class="line"></span><br><span class="line">y_hist.hist(y, <span class="number">40</span>, histtype=<span class="string">&#x27;stepfilled&#x27;</span>, orientation=<span class="string">&#x27;horizontal&#x27;</span>, color=<span class="string">&#x27;gray&#x27;</span>)</span><br><span class="line">y_hist.invert_xaxis()</span><br></pre></td></tr></table></figure><br />
<img src="https://i.loli.net/2021/05/24/bGk2wdTjIY14KyP.jpg" /></p>
<h2 id="坐标变换">坐标变换</h2>
<p>matplotlib中有四个坐标系：<br />
（1）data坐标系：坐标转换对象为ax.transData。它是用户级坐标系，由xlim和ylim控制。<br />
（2）Axes坐标系：坐标转换对象为ax.transAxes。它是Axes的坐标系，(0,0)为Axes的左下角，(1,1)为Axes的右上角。<br />
（3）Figure坐标系：坐标转换对象为fig.transFigure。它是Figure的坐标系，(0,0)为Figure的左下角，(1,1)为Figure的右上角。<br />
（4）display坐标系：它没有坐标转换对象。它显示的是display的像素坐标系，(0,0)为display左下角、(width,height)为display右上角。</p>
<p>前面三个坐标系的坐标转换对象有方法执行坐标转换，这些方法接受输入并产生输出：<strong>输入为本坐标系内的坐标点，输出为display坐标系中的坐标</strong>。（因此display坐标系没有坐标转换对象）。当然他们也有相关方法将来自于display坐标系中的坐标转换回本坐标系内的坐标。</p>
<p>一共有三种预定义的坐标变换方式：<br />
（1）ax.transData：以数据为基准的坐标变换。改变了坐标轴上下限，那么只有transData坐标会受影响。<br />
（2）ax.transAxes：以坐标轴为基准的坐标变换（以坐标轴维度为单位）。<br />
（3）fig.transFigure：以图形为基准的坐标变换（以图形维度为单位）。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">fig, ax = plt.subplots(facecolor=<span class="string">&#x27;lightgray&#x27;</span>)</span><br><span class="line">ax.axis([<span class="number">0</span>, <span class="number">10</span>, <span class="number">0</span>, <span class="number">10</span>])</span><br><span class="line"><span class="comment"># 在Artist的构造函数中传入 transform 关键字参数（其值为坐标转换对象），就能够切换坐标系</span></span><br><span class="line"><span class="comment"># 虽然transform=ax.transData是默认值，但还是设置一下</span></span><br><span class="line">ax.text(<span class="number">1</span>, <span class="number">5</span>, <span class="string">&quot;. Data: (1, 5)&quot;</span>, transform=ax.transData)</span><br><span class="line"><span class="comment"># 将Text放置于Axes坐标系中的(0.5,0.1)位置处</span></span><br><span class="line">ax.text(<span class="number">0.5</span>, <span class="number">0.1</span>, <span class="string">&quot;. Axes: (0.5, 0.1)&quot;</span>, transform=ax.transAxes)</span><br><span class="line">ax.text(<span class="number">0.2</span>, <span class="number">0.2</span>, <span class="string">&quot;. Figure: (0.2, 0.2)&quot;</span>, transform=fig.transFigure)</span><br><span class="line">plt.grid()</span><br></pre></td></tr></table></figure>
<p><img src="https://i.loli.net/2021/05/24/u8ACsBVSK7DeZjG.jpg" /><br />
transData坐标用x轴与y轴的标签作为数据坐标。<br />
transAxes坐标以坐标轴（图中白色矩形）左下角的位置为原点，按坐标轴尺寸的比例呈现坐标。<br />
transFigure坐标与之类似，不过是以图形（图中灰色矩形）左下角的位置为原点，按图形尺寸的比例呈现坐标。</p>
<p>通常不建议直接使用display坐标系。因为它固定了绝对坐标，导致resize图表时你必须重新定位坐标。所以必须监听resize事件，非常麻烦。<br />
<strong>1、 用户的 data 坐标系</strong><br />
当调用<code>ax.set_xlimit(x_min,x_max)</code>以及<code>ax.set_ylimit(y_min,y_max)</code>时，即建立起了用户data坐标系。左下角坐标为<code>(x_min,y_min)</code>，右上角坐标为<code>(x_max,y_max)</code>。<br />
有时候你可能并没有显式调用<code>.set_xlimit()</code>以及<code>.set_ylimit()</code>。其实matplotlib会隐式调用它们来设置坐标轴的数据范围。</p>
<p>可以调用ax.transData返回data坐标系的坐标转换对象。<br />
对该坐标转换对象调用<code>.transform(point)</code>方法会返回point在display坐标系下的坐标。其中point是点在data坐标系下的坐标(x,y)。你也可以给<code>.transform()</code>方法一次传入多个点的坐标，此时输出也是对应于display坐标系下的一系列坐标。<br />
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> matplotlib.pyplot <span class="keyword">as</span> plt</span><br><span class="line"></span><br><span class="line">fig = plt.figure()</span><br><span class="line">ax = fig.add_subplot(<span class="number">111</span>)</span><br><span class="line">ax.set_xlim(<span class="number">0</span>, <span class="number">10</span>)</span><br><span class="line">ax.set_ylim(-<span class="number">1</span>, <span class="number">1</span>)</span><br><span class="line"><span class="comment"># type(ax.transData)</span></span><br><span class="line">ax.transData.transform((<span class="number">5</span>, <span class="number">0</span>))</span><br></pre></td></tr></table></figure><br />
可以对ax.trandData返回的坐标转换对象调用<code>.inverted()</code>方法。该方法返回的是一个坐标逆转换对象。对该坐标逆转换对象调用<code>.transform(point)</code>方法会返回point在data坐标系下的坐标。其中point是点在display坐标系下的坐标(x,y)。你也可以给<code>.transform()</code>方法一次传入多个点的坐标，此时输出也是对应于data坐标系下的一系列坐标。</p>
<p>当你调用了<code>ax.set_xlim()</code>或者<code>ax.set_ylim()</code>时，坐标转换对象会实时更新。</p>
<p><strong>2、Axes 坐标系</strong><br />
在Axes坐标系中，(0,0)位于Axes的左下角，(1,1)位于Axes的右上角，(0.5,0.5)位于Axes的中心。当然你可以引用位于这之外的点，如(-0.1,1.1)。</p>
<p>通常如果你需要在Axes中放置一些文字说明，那么一般都是采用Axes坐标系来定位。这样无论图形怎么缩放，这些Text都能位于正确的位置。</p>
<p>你也可以在Axes中通过Axes坐标系添加一些Patch，但是通常建议在data坐标系下添加。因为你在Axes中添加的图表当图表缩放时可能会出现问题。</p>
<p><strong>3、混合坐标系</strong><br />
有时候你需要混合data坐标系和Axes坐标系。通过<code>matplotlib.transforms.blended_transform_factory(ax.transData, ax.transAxes)</code>能够返回一个混合坐标系，该坐标系中：x坐标为data坐标系，y坐标为Axes坐标系。因此该坐标系中(1,1)表示的是data坐标系中x=1但是y位于最上方的点。</p>
<p>有两个函数返回特定的混合坐标系：<br />
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">matplotlib.axes.Axes.get_xaxis_transform():</span><br><span class="line"><span class="comment"># 等价于matplotlib.transforms.blended_transform_factory(ax.transData, ax.transAxes)</span></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">x坐标为data坐标系，y坐标为Axes坐标系。常用于绘制x轴的label、tick、gridline。</span></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line">matplotlib.axes.Axes.get_yaxis_transform():</span><br><span class="line"><span class="comment"># 等价于matplotlib.transforms.blended_transform_factory(ax.transAxes,ax.transData)</span></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">x坐标为Axes坐标系，y坐标为data坐标系。常用于绘制y轴的label、tick、gridline。</span></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br></pre></td></tr></table></figure><br />
<strong>4、其他坐标系</strong><br />
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 下面2个方法，可以设置x轴/y轴是否对数坐标</span></span><br><span class="line">Axes.set_xscale(value,**kwargs)</span><br><span class="line">Axes.set_yscale(value,**kwargs)</span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">其中value可以为:</span></span><br><span class="line"><span class="string">    linear：线性</span></span><br><span class="line"><span class="string">    log：对数。其中basex|basey关键字指定对数的基</span></span><br><span class="line"><span class="string">    logit：以2为底的对数</span></span><br><span class="line"><span class="string">    symlog：对数，其中basex|basey关键字指定对数的基</span></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="comment"># 你也可以通过下面2个方法，来设置对数坐标。一定要先添加数据后设置对数坐标。</span></span><br><span class="line">matplotlib.pyplot.xscale()</span><br><span class="line">matplotlib.pyplot.yscale()</span><br></pre></td></tr></table></figure><br />
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 下面2个方法，可以创建一个极坐标的Axes。</span></span><br><span class="line"><span class="comment"># Figure.add_subplot(...)也是同样的设置</span></span><br><span class="line">Figure.add_axes((left,bottom,width,height),projection=<span class="string">&#x27;polar&#x27;</span>)</span><br><span class="line">Figure.add_axes((left,bottom,width,height), polar=<span class="literal">True</span>)</span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">projection: 不仅可以设置极坐标，还可以设置自定义坐标（它将坐标统一为映射关系）。</span></span><br><span class="line"><span class="string">polar: 为了兼容旧代码，新代码推荐用projection关键字</span></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br></pre></td></tr></table></figure></p>
<h2 id="箭头注释">箭头注释</h2>
<p>虽然有一个<code>plt.arrow()</code>函数可以实现这个功能，但是我不推荐使用它，因为它创建出的箭头是
SVG
向量图对象，会随着图形分辨率的变化而改变，最终的结果可能完全不是用户想要的。我要推荐的是<code>plt.annotate()</code>函数。这个函数既可以创建文字，也可以创建箭头，而且它创建的箭头能够进行非常灵活的配置。<br />
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">%matplotlib inline</span><br><span class="line">fig, ax = plt.subplots()</span><br><span class="line">x = np.linspace(<span class="number">0</span>, <span class="number">20</span>, <span class="number">1000</span>)</span><br><span class="line">ax.plot(x, np.cos(x))</span><br><span class="line">ax.axis(<span class="string">&#x27;equal&#x27;</span>)</span><br><span class="line">ax.annotate(<span class="string">&#x27;local maximum&#x27;</span>, xy=(<span class="number">6.28</span>, <span class="number">1</span>), xytext=(<span class="number">10</span>, <span class="number">4</span>), arrowprops=<span class="built_in">dict</span>(facecolor=<span class="string">&#x27;black&#x27;</span>, shrink=<span class="number">0.05</span>))</span><br><span class="line">ax.annotate(<span class="string">&#x27;local minimum&#x27;</span>, xy=(<span class="number">5</span> * np.pi, -<span class="number">1</span>), xytext=(<span class="number">2</span>, -<span class="number">6</span>), arrowprops=<span class="built_in">dict</span>(arrowstyle=<span class="string">&quot;-&gt;&quot;</span>,</span><br><span class="line">             connectionstyle=<span class="string">&quot;angle3,angleA=0,angleB=-90&quot;</span>))</span><br></pre></td></tr></table></figure><br />
<img src="https://i.loli.net/2021/05/25/Q6W3yDgvTPrEOV7.jpg"
alt="箭头注释.jpg" /></p>
<h2 id="自定义坐标轴刻度">自定义坐标轴刻度</h2>
<p>虽然 Matplotlib
默认的坐标轴定位器（locator）与格式生成器（formatter）可以满足大部分需求，但是并非对每一幅图都合适。通过其他的定位器和格式器，可以将坐标轴刻度调整为你需要的位置与格式。</p>
<p>常用的定位器：<br />
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">NullLocator         无刻度</span><br><span class="line">FixedLocator        刻度位置固定</span><br><span class="line">IndexLocator        用索引作为定位器（如 x = range(len(y)) ）</span><br><span class="line">LinearLocator       从 min 到 max 均匀分布刻度</span><br><span class="line">LogLocator          从 min 到 max 按对数分布刻度</span><br><span class="line">MultipleLocator     刻度和范围都是基数（base）的倍数</span><br><span class="line">MaxNLocator         为最大刻度找到最优位置</span><br><span class="line">AutoLocator        （默认）以 MaxNLocator 进行简单配置</span><br><span class="line">AutoMinorLocator    次要刻度的定位器</span><br></pre></td></tr></table></figure><br />
常用的和格式器：<br />
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">NullFormatter         刻度上无标签</span><br><span class="line">IndexFormatter        将一组标签设置为字符串</span><br><span class="line">FixedFormatter        手动为刻度设置标签</span><br><span class="line">FuncFormatter         用自定义函数设置标签</span><br><span class="line">FormatStrFormatter    为每个刻度值设置字符串格式</span><br><span class="line">ScalarFormatter       （默认）为标量值设置标签</span><br><span class="line">LogFormatter          对数坐标轴的默认格式生成器</span><br></pre></td></tr></table></figure></p>
<p>figure 对象，它其实就是一个盛放图形元素（子对象）的容器，例如每个
figure 都会包含一个或多个 axes 对象，每个 axes
对象又会包含其他表示图形内容的对象。坐标轴刻度线也不例外，每个 axes 都有
xaxis 和 yaxis
属性，每个属性同样包含构成坐标轴的线条、刻度和标签的全部属性。</p>
<p>每一个坐标轴都有<strong>主要</strong>刻度线与<strong>次要</strong>刻度线。<br />
在Matplotlib中，默认的刻度是由locator类控制，其中子类MultipleLocator和FormatStrFormatter负责位置和标签。</p>
<p>使用MultipleLocator自定义刻度位置，通过<code>set_xxx_locator()</code>设置：<br />
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">%matplotlib inline</span><br><span class="line"><span class="keyword">import</span> matplotlib.pyplot <span class="keyword">as</span> plt</span><br><span class="line"></span><br><span class="line"><span class="keyword">from</span> matplotlib.ticker <span class="keyword">import</span> MultipleLocator, FormatStrFormatter</span><br><span class="line">plt.figure(figsize=(<span class="number">7</span>,<span class="number">6</span>),dpi=<span class="number">100</span>)</span><br><span class="line">ax = plt.gca()</span><br><span class="line"></span><br><span class="line"><span class="comment"># 设置x，y轴上下限</span></span><br><span class="line">ax.set_xlim(<span class="number">0</span>,<span class="number">5</span>)</span><br><span class="line">ax.set_ylim(<span class="number">0</span>,<span class="number">5</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 设置x，y轴的主刻度器</span></span><br><span class="line"><span class="comment"># 隐藏刻度：plt.NullLocator()</span></span><br><span class="line">ax.xaxis.set_major_locator(MultipleLocator(<span class="number">1</span>))</span><br><span class="line">ax.yaxis.set_major_locator(MultipleLocator(<span class="number">1</span>))</span><br><span class="line"><span class="comment"># 设置x，y轴次刻度器</span></span><br><span class="line">ax.xaxis.set_minor_locator(MultipleLocator(<span class="number">0.25</span>))</span><br><span class="line">ax.yaxis.set_minor_locator(MultipleLocator(<span class="number">0.25</span>))</span><br></pre></td></tr></table></figure><br />
<img src="https://i.loli.net/2021/05/25/tyD9weG5VZh2RmP.jpg" /></p>
<p>通过FormatStrFormatter自定义刻度标签，通过<code>set_xxx_formatter()</code>设置：<br />
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 设置x轴主刻度标签格式</span></span><br><span class="line"><span class="comment"># 隐藏标签：plt.NullFormatter() </span></span><br><span class="line">ax.xaxis.set_major_formatter(plt.NullFormatter()) <span class="comment"># 主刻度隐藏，避免和次刻度标签重复显示</span></span><br><span class="line"><span class="comment"># 设置x，y轴次刻度标签格式</span></span><br><span class="line">ax.xaxis.set_minor_formatter(FormatStrFormatter(<span class="string">&#x27;%0.1f&#x27;</span>))</span><br><span class="line"></span><br><span class="line"><span class="comment"># 主次刻度线，标签长度</span></span><br><span class="line">ax.tick_params(which=<span class="string">&#x27;major&#x27;</span>,length=<span class="number">8</span>,labelsize=<span class="number">10</span>)</span><br><span class="line">ax.tick_params(which=<span class="string">&#x27;minor&#x27;</span>,length=<span class="number">4</span>)</span><br></pre></td></tr></table></figure><br />
必要时，可以用<code>plt.NullFormatter()</code>隐藏刻度。<br />
为了显示效果，用<code>tick_params()</code>设置了刻度长度和标签大小。<br />
<img src="https://i.loli.net/2021/05/25/7PHlOintrv6KfGI.jpg" /></p>
<p>还可以用<code>set_major_locator(plt.MaxNLocator(3))</code>设置刻度显示数量（这里是3），Matplotlib
会自动为刻度安排恰当的位置。<br />
还可以用<code>set_major_formatter(plt.FuncFormatter(format_func))</code>自定义标签格式。比如正弦余弦曲线刻度用<span
class="math inline">\(\pi\)</span>效果更改好：<br />
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line">%matplotlib inline</span><br><span class="line"><span class="keyword">import</span> matplotlib.pyplot <span class="keyword">as</span> plt</span><br><span class="line"><span class="keyword">import</span> numpy <span class="keyword">as</span> np</span><br><span class="line"></span><br><span class="line"><span class="comment"># 画正弦曲线和余弦曲线</span></span><br><span class="line">fig, ax = plt.subplots()</span><br><span class="line">x = np.linspace(<span class="number">0</span>, <span class="number">3</span> * np.pi, <span class="number">1000</span>)</span><br><span class="line">ax.plot(x, np.sin(x), lw=<span class="number">3</span>, label=<span class="string">&#x27;Sine&#x27;</span>)</span><br><span class="line">ax.plot(x, np.cos(x), lw=<span class="number">3</span>, label=<span class="string">&#x27;Cosine&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 设置网格、图例和坐标轴上下限</span></span><br><span class="line">ax.grid(<span class="literal">True</span>)</span><br><span class="line">ax.legend(frameon=<span class="literal">False</span>)</span><br><span class="line">ax.axis(<span class="string">&#x27;equal&#x27;</span>)</span><br><span class="line">ax.set_xlim(<span class="number">0</span>, <span class="number">3</span> * np.pi)</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">format_func</span>(<span class="params">value, tick_number</span>):</span><br><span class="line">    <span class="comment"># 找到π/2的倍数刻度</span></span><br><span class="line">    N = <span class="built_in">int</span>(np.<span class="built_in">round</span>(<span class="number">2</span> * value / np.pi))</span><br><span class="line">    <span class="keyword">if</span> N == <span class="number">0</span>:</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;0&quot;</span></span><br><span class="line">    <span class="keyword">elif</span> N == <span class="number">1</span>:</span><br><span class="line">        <span class="keyword">return</span> <span class="string">r&quot;$\pi/2$&quot;</span></span><br><span class="line">    <span class="keyword">elif</span> N == <span class="number">2</span>:</span><br><span class="line">        <span class="keyword">return</span> <span class="string">r&quot;$\pi$&quot;</span></span><br><span class="line">    <span class="keyword">elif</span> N % <span class="number">2</span> &gt; <span class="number">0</span>:</span><br><span class="line">        <span class="keyword">return</span> <span class="string">r&quot;$&#123;0&#125;\pi/2$&quot;</span>.<span class="built_in">format</span>(N)</span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        <span class="keyword">return</span> <span class="string">r&quot;$&#123;0&#125;\pi$&quot;</span>.<span class="built_in">format</span>(N // <span class="number">2</span>)</span><br><span class="line">ax.xaxis.set_major_formatter(plt.FuncFormatter(format_func))</span><br></pre></td></tr></table></figure><br />
<img src="https://i.loli.net/2021/05/25/styFqfZB8VRTdKW.jpg" /></p>
<h2 id="d绘图">3D绘图</h2>
<p>3D绘图与2D绘图的调用方法几乎相同，除了增加一个
<code>projection='3d'</code>
的关键字参数，<strong>使用projection参数，必须导入mplot3d模块</strong>。<br />
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> matplotlib.pyplot <span class="keyword">as</span> plt</span><br><span class="line"><span class="keyword">from</span> mpl_toolkits <span class="keyword">import</span> mplot3d</span><br><span class="line"><span class="keyword">from</span> mpl_toolkits.mplot3d <span class="keyword">import</span> Axes3D</span><br><span class="line"></span><br><span class="line">fig = plt.figure()</span><br><span class="line"><span class="comment"># 旧式写法</span></span><br><span class="line">ax = plt.axes(projection=<span class="string">&#x27;3d&#x27;</span>) </span><br><span class="line"><span class="comment"># 新式写法</span></span><br><span class="line">ax = Axes3D(fig) </span><br></pre></td></tr></table></figure><br />
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line">Axes3D.plot(xs, ys, *args, **kwargs): 绘制直线。</span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">xs,ys：点的 x,y坐标</span></span><br><span class="line"><span class="string">zs：点的z坐标。该值可以是一个标量（表示对所有点都取同一个值）；也可以是个数组或列表，表示每个点一个值</span></span><br><span class="line"><span class="string">zdir：指定那个是z轴。其值可以是&#x27;x&#x27;或者&#x27;y&#x27;或者&#x27;z&#x27;</span></span><br><span class="line"><span class="string">剩下的关键字参数与Axes.plot()相同</span></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line">Axes3D.scatter(xs, ys, zs=<span class="number">0</span>, zdir=’z’, s=<span class="number">20</span>, c=’b’, </span><br><span class="line">                depthshade=<span class="literal">True</span>, *args, **kwargs)：绘制散点图。</span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">xs,ys：点的 x,y坐标</span></span><br><span class="line"><span class="string">zs：点的z坐标。该值可以是一个标量（表示对所有点都取同一个值）；也可以是个数组或列表，表示每个点一个值</span></span><br><span class="line"><span class="string">zdir：指定那个是z轴。其值可以是&#x27;x&#x27;或者&#x27;y&#x27;或者&#x27;z&#x27;</span></span><br><span class="line"><span class="string">s：散点的大小（单位为 point^2).该值可以是一个标量（表示对所有点都取同一个值）；也可以是个数组或列表，表示每个点一个值</span></span><br><span class="line"><span class="string">c：散点的颜色。你可以将它设为一个颜色字符串，表示所有的点都是一个颜色。或者是个 cmap，指定颜色图</span></span><br><span class="line"><span class="string">depthshade：一个布尔值。如果为True，则通过对marker设置阴影来展示层次关系</span></span><br><span class="line"><span class="string">剩下的关键字参数与Axes.scatter()相同</span></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line">Axes3D.plot_wireframe(X, Y, Z, *args, **kwargs): 绘制线框。</span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">X,Y：点的 x,y坐标</span></span><br><span class="line"><span class="string">Z：点的z坐标。该值可以是一个标量（表示对所有点都取同一个值）；也可以是个数组或列表，表示每个点一个值</span></span><br><span class="line"><span class="string">rstride：行的步长</span></span><br><span class="line"><span class="string">cstride：列的步长</span></span><br><span class="line"><span class="string">剩下的关键字传递给LineCollection</span></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br></pre></td></tr></table></figure><br />
<strong>1、三维点图和线图</strong><br />
最基本的三维图是由<code>(x , y , z )</code>三维坐标点构成的线图与散点图。与二维图类似，可以用
<code>ax.plot3D</code> 与 <code>ax.scatter3D</code>
函数来创建它们。<br />
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">%matplotlib notebook</span><br><span class="line"><span class="keyword">import</span> numpy <span class="keyword">as</span> np</span><br><span class="line"><span class="keyword">import</span> matplotlib.pyplot <span class="keyword">as</span> plt </span><br><span class="line"><span class="keyword">from</span> mpl_toolkits.mplot3d <span class="keyword">import</span> Axes3D</span><br><span class="line"></span><br><span class="line">fig = plt.figure()</span><br><span class="line"><span class="comment"># 创建三维坐标轴</span></span><br><span class="line">ax = Axes3D(fig)</span><br><span class="line"><span class="comment"># 三维线的数据</span></span><br><span class="line">zline = np.linspace(<span class="number">0</span>, <span class="number">15</span>, <span class="number">1000</span>)</span><br><span class="line">xline = np.sin(zline)</span><br><span class="line">yline = np.cos(zline)</span><br><span class="line">ax.plot3D(xline, yline, zline, <span class="string">&#x27;gray&#x27;</span>)</span><br><span class="line"><span class="comment"># 三维散点的数据</span></span><br><span class="line">zdata = <span class="number">15</span> * np.random.random(<span class="number">100</span>)</span><br><span class="line">xdata = np.sin(zdata) + <span class="number">0.1</span> * np.random.randn(<span class="number">100</span>)</span><br><span class="line">ydata = np.cos(zdata) + <span class="number">0.1</span> * np.random.randn(<span class="number">100</span>)</span><br><span class="line">ax.scatter3D(xdata, ydata, zdata, c=zdata, cmap=<span class="string">&#x27;Greens&#x27;</span>)</span><br></pre></td></tr></table></figure><br />
<img src="https://i.loli.net/2021/05/25/6FqUkXK1TSMtRaH.jpg"
alt="三维点图和线图.jpg" /><br />
默认情况下，散点会自动改变透明度，以在平面上呈现出立体感。有时在静态图形上观察三维效果很费劲，通过交互视图就可以让所有数据点呈现出极佳的视觉效果。</p>
<p><strong>2、三维等高线图</strong><br />
与二维 <code>ax.contour()</code>
图形一样，<code>ax.contour3D()</code>要求所有数据都是二维网格数据的形式，并且由函数计算
z 轴数值。<br />
用三维正弦函数画的三维等高线图：<br />
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line">%matplotlib notebook</span><br><span class="line"><span class="keyword">import</span> numpy <span class="keyword">as</span> np</span><br><span class="line"><span class="keyword">import</span> matplotlib.pyplot <span class="keyword">as</span> plt </span><br><span class="line"><span class="keyword">from</span> mpl_toolkits.mplot3d <span class="keyword">import</span> Axes3D</span><br><span class="line"></span><br><span class="line">fig = plt.figure()</span><br><span class="line"><span class="comment"># 创建三维坐标轴</span></span><br><span class="line">ax = Axes3D(fig)</span><br><span class="line"><span class="comment"># 三维线的数据</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">f</span>(<span class="params">x, y</span>):</span><br><span class="line">    <span class="keyword">return</span> np.sin(np.sqrt(x ** <span class="number">2</span> + y ** <span class="number">2</span>))</span><br><span class="line"></span><br><span class="line">x = np.linspace(-<span class="number">6</span>, <span class="number">6</span>, <span class="number">30</span>)</span><br><span class="line">y = np.linspace(-<span class="number">6</span>, <span class="number">6</span>, <span class="number">30</span>)</span><br><span class="line"></span><br><span class="line">X, Y = np.meshgrid(x, y)</span><br><span class="line">Z = f(X, Y)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 三维等高线图</span></span><br><span class="line">ax.contour3D(X, Y, Z, <span class="number">50</span>, cmap=<span class="string">&#x27;binary&#x27;</span>)</span><br><span class="line">ax.set_xlabel(<span class="string">&#x27;x&#x27;</span>)</span><br><span class="line">ax.set_ylabel(<span class="string">&#x27;y&#x27;</span>)</span><br><span class="line">ax.set_zlabel(<span class="string">&#x27;z&#x27;</span>)</span><br></pre></td></tr></table></figure><br />
<img src="https://i.loli.net/2021/05/25/k3TDlJqXHmtAdhf.jpg"
alt="三维等高线图.jpg" /></p>
<p><code>iew_init</code> 可以调整观察角度与方位角，比如把俯仰角调整为 60
度（这里的 60 度是 x-y 平面的旋转角度），方位角调整为 35 度（就是绕 z
轴顺时针旋转 35 度）：<code>ax.view_init(60, 35)</code>。<br />
<strong>3、线框图和曲面图</strong><br />
它们都是将网格数据映射成三维曲面，比如线框图：<br />
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">%matplotlib notebook</span><br><span class="line"><span class="keyword">import</span> numpy <span class="keyword">as</span> np</span><br><span class="line"><span class="keyword">import</span> matplotlib.pyplot <span class="keyword">as</span> plt </span><br><span class="line"><span class="keyword">from</span> mpl_toolkits.mplot3d <span class="keyword">import</span> Axes3D</span><br><span class="line"></span><br><span class="line">fig = plt.figure()</span><br><span class="line"><span class="comment"># 创建三维坐标轴</span></span><br><span class="line">ax = Axes3D(fig)</span><br><span class="line"><span class="comment"># 三维线的数据</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">f</span>(<span class="params">x, y</span>):</span><br><span class="line">    <span class="keyword">return</span> np.sin(np.sqrt(x ** <span class="number">2</span> + y ** <span class="number">2</span>))</span><br><span class="line"></span><br><span class="line">x = np.linspace(-<span class="number">6</span>, <span class="number">6</span>, <span class="number">30</span>)</span><br><span class="line">y = np.linspace(-<span class="number">6</span>, <span class="number">6</span>, <span class="number">30</span>)</span><br><span class="line"></span><br><span class="line">X, Y = np.meshgrid(x, y)</span><br><span class="line">Z = f(X, Y)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 线框图</span></span><br><span class="line">ax.plot_wireframe(X, Y, Z, color=<span class="string">&#x27;black&#x27;</span>)</span><br><span class="line">ax.set_title(<span class="string">&#x27;wireframe&#x27;</span>)</span><br></pre></td></tr></table></figure><br />
<img src="https://i.loli.net/2021/05/25/d6NL94mRnUhCWuP.jpg"
alt="三维线框图.jpg" /><br />
曲面图与线框图类似，只不过线框图的每个面都是由多边形构成的。只要增加一个配色方案来填充这些多边形，就可以让读者感受到可视化图形表面的拓扑结构了：<br />
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">%matplotlib notebook</span><br><span class="line"><span class="keyword">import</span> numpy <span class="keyword">as</span> np</span><br><span class="line"><span class="keyword">import</span> matplotlib.pyplot <span class="keyword">as</span> plt </span><br><span class="line"><span class="keyword">from</span> mpl_toolkits.mplot3d <span class="keyword">import</span> Axes3D</span><br><span class="line"></span><br><span class="line">fig = plt.figure()</span><br><span class="line"><span class="comment"># 创建三维坐标轴</span></span><br><span class="line">ax = Axes3D(fig)</span><br><span class="line"><span class="comment"># 三维线的数据</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">f</span>(<span class="params">x, y</span>):</span><br><span class="line">    <span class="keyword">return</span> np.sin(np.sqrt(x ** <span class="number">2</span> + y ** <span class="number">2</span>))</span><br><span class="line"></span><br><span class="line">x = np.linspace(-<span class="number">6</span>, <span class="number">6</span>, <span class="number">30</span>)</span><br><span class="line">y = np.linspace(-<span class="number">6</span>, <span class="number">6</span>, <span class="number">30</span>)</span><br><span class="line"></span><br><span class="line">X, Y = np.meshgrid(x, y)</span><br><span class="line">Z = f(X, Y)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 线框图</span></span><br><span class="line">ax.plot_surface(X, Y, Z, rstride=<span class="number">1</span>, cstride=<span class="number">1</span>, cmap=<span class="string">&#x27;viridis&#x27;</span>, edgecolor=<span class="string">&#x27;none&#x27;</span>)</span><br><span class="line">ax.set_title(<span class="string">&#x27;surface&#x27;</span>)</span><br></pre></td></tr></table></figure><br />
<img src="https://i.loli.net/2021/05/25/y4Q5rl8pV3UIWBm.jpg"
alt="三维曲面图.jpg" /></p>
<p>需要注意的是，画曲面图需要二维数据，但可以不是直角坐标系（也可以用极坐标）。<br />
下面示例，创建了一个局部的极坐标网格，当我们把它画成 surface3D
图形时，可以获得一种使用了切片的可视化效果。<br />
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">%matplotlib notebook</span><br><span class="line"><span class="keyword">import</span> numpy <span class="keyword">as</span> np</span><br><span class="line"><span class="keyword">import</span> matplotlib.pyplot <span class="keyword">as</span> plt </span><br><span class="line"><span class="keyword">from</span> mpl_toolkits.mplot3d <span class="keyword">import</span> Axes3D</span><br><span class="line"></span><br><span class="line">fig = plt.figure()</span><br><span class="line"><span class="comment"># 创建三维坐标轴</span></span><br><span class="line">ax = Axes3D(fig)</span><br><span class="line"><span class="comment"># 三维线的数据</span></span><br><span class="line">r = np.linspace(<span class="number">0</span>, <span class="number">6</span>, <span class="number">20</span>)</span><br><span class="line">theta = np.linspace(-<span class="number">0.9</span> * np.pi, <span class="number">0.8</span> * np.pi, <span class="number">40</span>)</span><br><span class="line"><span class="comment"># 极坐标网格</span></span><br><span class="line">r, theta = np.meshgrid(r, theta)</span><br><span class="line"></span><br><span class="line">X = r * np.sin(theta)</span><br><span class="line">Y = r * np.cos(theta)</span><br><span class="line">Z = f(X, Y)</span><br><span class="line"></span><br><span class="line">ax.plot_surface(X, Y, Z, rstride=<span class="number">1</span>, cstride=<span class="number">1</span>,cmap=<span class="string">&#x27;viridis&#x27;</span>, edgecolor=<span class="string">&#x27;none&#x27;</span>)</span><br><span class="line">ax.set_title(<span class="string">&#x27;surface-polar&#x27;</span>)</span><br></pre></td></tr></table></figure><br />
<img src="https://i.loli.net/2021/05/25/zYx1yXmSIWNktVw.jpg"
alt="曲面图-极坐标.jpg" /></p>
<p><strong>4、曲面三角剖分</strong><br />
曲面图数据不是均匀且完整的，如何绘图呢？可以使用三角剖分图形：</p>
<p>先绘制一个散点图，看看数据分布：<br />
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">%matplotlib notebook</span><br><span class="line"><span class="keyword">import</span> numpy <span class="keyword">as</span> np</span><br><span class="line"><span class="keyword">import</span> matplotlib.pyplot <span class="keyword">as</span> plt </span><br><span class="line"><span class="keyword">from</span> mpl_toolkits.mplot3d <span class="keyword">import</span> Axes3D</span><br><span class="line"></span><br><span class="line">fig = plt.figure()</span><br><span class="line"><span class="comment"># 创建三维坐标轴</span></span><br><span class="line">ax = Axes3D(fig)</span><br><span class="line"><span class="comment"># 三维线的数据</span></span><br><span class="line">theta = <span class="number">2</span> * np.pi * np.random.random(<span class="number">1000</span>)</span><br><span class="line">r = <span class="number">6</span> * np.random.random(<span class="number">1000</span>)</span><br><span class="line"></span><br><span class="line">x = np.ravel(r * np.sin(theta))</span><br><span class="line">y = np.ravel(r * np.cos(theta))</span><br><span class="line">z = f(x, y)</span><br><span class="line"></span><br><span class="line">ax.scatter(x, y, z, c=z, cmap=<span class="string">&#x27;viridis&#x27;</span>, linewidth=<span class="number">0.5</span>)</span><br><span class="line">ax.set_title(<span class="string">&#x27;surface-scatter&#x27;</span>)</span><br></pre></td></tr></table></figure><br />
<img src="https://i.loli.net/2021/05/25/23Nn8UQfxMpgrFK.jpg"
alt="三维曲面散点图.jpg" /></p>
<p>还有许多地方需要修补，这些工作可以由 <code>ax.plot_trisurf()</code>
函数帮助我们完成。它首先找到一组所有点都连接起来的三角形，然后用这些三角形创建曲面：<br />
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">ax.plot_trisurf(x, y, z, cmap=<span class="string">&#x27;viridis&#x27;</span>, edgecolor=<span class="string">&#x27;none&#x27;</span>)</span><br><span class="line">ax.set_title(<span class="string">&#x27;surface-trisurf&#x27;</span>)</span><br><span class="line">fig</span><br></pre></td></tr></table></figure><br />
<img src="https://i.loli.net/2021/05/25/K2OpVmW5Cs8ay4v.jpg"
alt="三维曲面图三角切面.jpg" /><br />
虽然结果肯定没有之前用均匀网格画的图完美，但是这种三角剖分方法很灵活。</p>
<h2 id="其他技巧">其他技巧</h2>
<p><strong>1、设置中文</strong><br />
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 为了支持中文，在开头设置：</span></span><br><span class="line"><span class="keyword">import</span> matplotlib.pyplot <span class="keyword">as</span> plt</span><br><span class="line">plt.rcParams[<span class="string">&#x27;font.sans-serif&#x27;</span>] = [<span class="string">&#x27;SimHei&#x27;</span>]  <span class="comment">#matplotlib 中文字体</span></span><br></pre></td></tr></table></figure></p>
<p><strong>2、共享坐标轴</strong><br />
当你通过<code>pyplot.subplot()</code>、<code>pyplot.axes()</code>函数或者<code>Figure.add_subplot()</code>、<code>Figure.add_axes()</code>方法创建一个Axes时，你可以通过sharex关键字参数传入另一个Axes表示共享X轴；或者通过sharey关键字参数传入另一个Axes表示共享Y轴。共享轴线时，当你缩放某个Axes时，另一个Axes也跟着缩放。</p>
<p><strong>3、创建多个subplot</strong><br />
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 旧式风格</span></span><br><span class="line">fig=plt.figure()</span><br><span class="line">ax1=fig.add_subplot(<span class="number">221</span>)</span><br><span class="line">ax2=fig.add_subplot(<span class="number">222</span>,sharex=ax1,sharey=ax1)</span><br><span class="line">ax3=fig.add_subplot(<span class="number">223</span>,sharex=ax1,sharey=ax1)</span><br><span class="line">ax4=fig.add_subplot(<span class="number">224</span>,sharex=ax1,sharey=ax1)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 新式风格的代码</span></span><br><span class="line">fig,((ax1,ax2),(ax3,ax4))=plt.subplots(<span class="number">2</span>,<span class="number">2</span>,sharex=<span class="literal">True</span>,sharey=<span class="literal">True</span>)</span><br><span class="line">ax1.plot(...)</span><br><span class="line">ax2.plot(...)</span><br><span class="line"><span class="comment"># 也可以直接用，不解包</span></span><br><span class="line">fig,axs=plt.subplots(<span class="number">2</span>,<span class="number">2</span>,sharex=<span class="literal">True</span>,sharey=<span class="literal">True</span>)</span><br><span class="line">ax1=axs[<span class="number">0</span>,<span class="number">0</span>]</span><br><span class="line">ax2=axs[<span class="number">0</span>,<span class="number">1</span>]</span><br><span class="line">ax3=axs[<span class="number">1</span>,<span class="number">0</span>]</span><br><span class="line">ax4=axs[<span class="number">1</span>,<span class="number">1</span>]</span><br><span class="line"><span class="comment"># 返回的axs是一个nrows*ncols的array，支持numpy的索引。</span></span><br></pre></td></tr></table></figure></p>
<p><strong>4、调整日期显示</strong><br />
当x轴为时间日期时，有可能间隔太密集导致显示都叠加在一起。此时可以用<code>matplotlib.figure.Figure.autofmt_xdate()</code>函数来自动调整X轴日期的显式。</p>
<p>你也可以调整X轴的显示格式。当X轴为时间时，其显示由Axes.fmt_xdata属性来提供。该属性是一个函数对象或者函数，接受一个日期参数，返回该日期的显示字符串。<br />
matplotlib已经提供了许多date
formatter，你可以直接使用<code>ax.fmt_xdata=matplotlib.dates.DateFormatter('%Y-%m-%d')</code>。</p>
<p><strong>5、放置text box</strong><br />
当你在Axes中放置text box时，你最好将它放置在axes
coordinates下，这样当你调整X轴或者Y轴时，它能够自动调整位置。</p>
<p>你也可以使用Text的.bbox属性来让这个Text始终放在某个Patch中。其中.bbox是个字典，它存放的是该Patch实例的属性。</p>
<p><strong>6、Latex文字</strong><br />
要想在文本中使用Latex，你需要使用<code>'$...$'</code>这种字符串（即使用<code>'$'</code>作为界定符）。通常建议使用raw字符串，即<code>r'$...$'</code>的格式，因为原生字符串不会转义''，从而使得大量的Latex词法能够正确解析。</p>
<p><strong>7、平移坐标轴：</strong><br />
Axes.spines是个字典，它存放了四个键，分别为：<br />
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">Axes.spines[&#x27;left],</span><br><span class="line">Axes.spines[&#x27;right],</span><br><span class="line">Axes.spines[&#x27;top],</span><br><span class="line">Axes.spines[&#x27;bottom] </span><br></pre></td></tr></table></figure><br />
他们都是一个matplotlib.spines.Spine对象，该对象继承自matplotlib.patches.Patch对象，主要是设置图形边界的边框。<br />
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">Spine.set_color(<span class="string">&#x27;none&#x27;</span>)：不显示这条边线</span><br><span class="line">Spine.set_position((position))：将边线移动到指定坐标。</span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">position是一个二元元组，指定了 (position type,amount)，position type可以是：</span></span><br><span class="line"><span class="string">        outward：在绘图区域之外放置边线，离开绘图区域的距离由 amount指定（负值则在会去区域内绘制）</span></span><br><span class="line"><span class="string">        axes：在 Axes coordinate内放置边线（从 0.0 到 1.0 ）</span></span><br><span class="line"><span class="string">        data：在 data coordinate 内放置边线</span></span><br><span class="line"><span class="string">你也可以指定position为 ： &#x27;center&#x27;，等价于 (&#x27;axes&#x27;,0.5)；或者 &#x27;zero&#x27;，等价于 (&#x27;data&#x27;,0.0)</span></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br></pre></td></tr></table></figure></p>
<p><strong>8、清除</strong><br />
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 通过pyplot来清除绘图</span></span><br><span class="line">pyplot.cla()：清除current axis。非当前axis不受影响</span><br><span class="line">pyplot.clf()：清除current figure。但是它不关闭window</span><br><span class="line">pyplot.close()：关闭window</span><br><span class="line"><span class="comment"># 通过面向对象的方法清除绘图</span></span><br><span class="line">Figure.clf()：清除该Figure对象的所有内容。</span><br></pre></td></tr></table></figure><br />
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 清除X坐标和Y坐标：</span></span><br><span class="line">Axes.set_xticks(())</span><br><span class="line">Axes.set_yticks(())</span><br><span class="line">Axes.set_axis_off() <span class="comment">#清除 tick 和边框</span></span><br></pre></td></tr></table></figure></p>
<h1 id="matplotlib的主要api">Matplotlib的主要API</h1>
<p>参考Matplotlib的<span class="exturl" data-url="aHR0cHM6Ly9tYXRwbG90bGliLm9yZy9zdGFibGUvYXBpL2luZGV4Lmh0bWwjdXNhZ2UtcGF0dGVybnM=">Modules<i class="fa fa-external-link-alt"></i></span>。</p>
<p>写这个主要是从上层了解Matplotlib绘图时使用的类和方法，其中Axes类全面列出了使用的绘图方法和参数详解。之后会分类使用这些方法。</p>
<h2 id="artist">Artist</h2>
<p>我们之前讲了Matplotlib的三层结构，那谁使用它们呢？就是Artist（艺术家）。</p>
<p>matplotlib的三个API：<br />
（1）matplotlib.backend_bases.FigureCanvas：代表了一个绘图区，在这个绘图区上图表被绘制。<br />
（2）matplotlib.backend_bases.Renderer：代表了渲染器，它知道如何在绘图区上绘图。<br />
（2）matplotlib.artist.Artist：代表了图表组件，它知道如何利用渲染器在绘图区上绘图。<br />
我们经常使用的是与matplotlib.artist.Artist类，它是高层次的绘图控制。</p>
<p>matplotlib中有两种Artist：<br />
（1）primitive：代表了我们在绘图区域上绘制的基础的绘图组件，比如Line2D，Rectangle，Text
以及AxesImage等等。<br />
（2）container：代表了放置primitive的那些绘图组件。比如Axis、Axes以及Figure。对应容器层。</p>
<div class="note info"><p><strong>matplotlib的标准使用流程为：</strong><br />
（1）创建一个Figure实例对象fig。<br />
（2）使用fig实例创建一个或者多个Axes实例，或者创建一个或者多个Subplot实例。<br />
（3）使用Axes实例的方法来创建primitive。</p>
</div>
<p>每个在图形中出现的元素都是Artist。其属性有：<br />
（1）Figure.patch属性：一个Rectangle，代表了图表的矩形框，它的大小就是图表的大小，
并且可以通过它设置图表的背景色和透明度。<br />
（2）Axes.patch属性：一个Rectangle，代表了绘图坐标轴内部的矩形框（白底黑边），
通过它可以设置Axes的颜色、透明度等。</p>
<p>所有的Artist有下列属性：<br />
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">.alpha：透明度。值为0--1之间的浮点数</span><br><span class="line">.animated：一个布尔值，表示是否用于加速动画绘制</span><br><span class="line">.axes：返回这个Artist所属的axes，可能为None</span><br><span class="line">.clip_box：用于剪切Artist的bounding box</span><br><span class="line">.clip_on：是否开启clip</span><br><span class="line">.clip_path：Artist沿着该path执行clip</span><br><span class="line">.contains：一个picking function用于测试Artist是否包含pick point</span><br><span class="line">.figure：该Artist所属的Figure，可能为None</span><br><span class="line">.gid：该Artist的id字符串</span><br><span class="line">.label：一个text label</span><br><span class="line">.picker:一个python object用于控制object picking</span><br><span class="line">.transform：转换矩阵</span><br><span class="line">.url：一个url string，代表本Artist</span><br><span class="line">.visible：布尔值，控制Artist是否绘制</span><br><span class="line">.zorder：决定了Artist的绘制顺序。zorder越小就越底层，则越优先绘制。</span><br></pre></td></tr></table></figure><br />
这些属性可以通过旧式的实例对象方法，setter和getter函数访问和设置。如figure对象：<code>fig.get_alpha()</code>，<code>fig.set_alpha(0.5)</code>、<code>fig.set(alpha=0.5,zorder=2)</code>（一次设置多个属性）。</p>
<p>或者使用<code>plt.getp(o,"alpha")</code>来获取属性（一次只能返回一个属性），如果指定属性名，则返回对象的该属性值；如果不指定属性名，则返回对象的所有的属性和值。使用<code>plt.setp(o,alpha=0.5,zorder=2)</code>来设置属性（一次可以设置多个属性）。<br />
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 获取fig所有属性</span></span><br><span class="line"><span class="comment"># 下面两种方式等价</span></span><br><span class="line">mpl.artist.getp(fig)</span><br><span class="line">plt.getp(fig)</span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">agg_filter = None</span></span><br><span class="line"><span class="string">alpha = None</span></span><br><span class="line"><span class="string">animated = False</span></span><br><span class="line"><span class="string">axes = [&lt;matplotlib.axes._subplots.AxesSubplot object at ...</span></span><br><span class="line"><span class="string">children = [&lt;matplotlib.patches.Rectangle object at 0x0000019...</span></span><br><span class="line"><span class="string">clip_box = None</span></span><br><span class="line"><span class="string">clip_on = True</span></span><br><span class="line"><span class="string">clip_path = None</span></span><br><span class="line"><span class="string">constrained_layout = False</span></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br></pre></td></tr></table></figure></p>
<h2 id="figure">Figure</h2>
<p>matplotlib.figure.Figure是最顶层的container
Artist，它包含了图表中的所有元素。它的属性有：<br />
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">Figure.patch：Figure的背景矩形</span><br><span class="line">Figure.axes：持有的一个Axes实例的列表(包括Subplot)</span><br><span class="line">Figure.images：持有的一个FigureImages patch列表</span><br><span class="line">Figure.lines：持有一个Line2D实例的列表(很少使用)</span><br><span class="line">Figure.legends：持有的一个Figure Legend实例列表(不同于Axes.legends)</span><br><span class="line">Figure.patches：持有的一个Figure pathes实例列表(很少使用)</span><br><span class="line">Figure.texts：持有的Figure Text实例列表</span><br><span class="line">Figure.figsize：图像的尺寸，(w,h)，以英寸为单位</span><br><span class="line">Figure.dpi：图像分辨率</span><br><span class="line">Figure.facecolor：背景色</span><br><span class="line">Figure.edgecolor：edge color</span><br><span class="line">Figure.linewidth：edge linewidth</span><br><span class="line">Figure.frameon：如果为False，则不绘制图像</span><br><span class="line">Figure.subplotpars：一个SubplotParams实例</span><br><span class="line">Figure.tight_layout：如果为False，则使用subplotpars；否则使用tight_layout()调整subplot parameters</span><br></pre></td></tr></table></figure><br />
当你执行<code>Figure.add_subplot()</code>或者<code>Figure.add_axes()</code>时，这些新建的Axes都被添加到Figure.axes列表中。</p>
<p>由于Figure维持了当前的axes，因此不要手动的从Figure.axes列表中添加删除元素，而是要通过<code>Figure.add_subplot()</code>、<code>Figure.add_axes()</code>来添加元素，通过<code>Figure.delaxes()</code>来删除元素。但是你可以迭代或者访问Figure.axes中的Axes实例，然后修改这个实例的属性。</p>
<p>可以通过<code>Figure.gca()</code>获取当前的axes，通过<code>Figure.sca()</code>设置当前的axes。</p>
<p>Figure也有它自己的text、line、patch、image。可通过add
primitive（原始组件）语句直接添加。但是注意Figure默认的坐标系是以像素为单位，可能需要转换成figure坐标系：(0,0)表示左下点，(1,1)表示右上点。</p>
<p>创建Figure的方法：<br />
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">matplotlib.pyplot.figure(num=<span class="literal">None</span>, figsize=<span class="literal">None</span>, dpi=<span class="literal">None</span>, facecolor=<span class="literal">None</span>,</span><br><span class="line">    edgecolor=<span class="literal">None</span>, frameon=<span class="literal">True</span>, FigureClass=&lt;<span class="keyword">class</span> <span class="string">&#x27;matplotlib.figure.Figure&#x27;</span>&gt;, **kwargs)</span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">num：一个整数或者字符串。</span></span><br><span class="line"><span class="string">    若未提供，则创建一个新的figure。</span></span><br><span class="line"><span class="string">    如果给出了一个整数，而且某个现有的figure对象的number属性刚好等于这个整数：</span></span><br><span class="line"><span class="string">        则激活该figure并且返回该figure；否则创建一个新的figure</span></span><br><span class="line"><span class="string">    如果是个字符串，则创建一个新的figure，并且将window title设置为该字符串。</span></span><br><span class="line"><span class="string">figsize：一对整数的元组。给出了英寸为单位的高度和宽度。默认由rc的figure.figsize给出</span></span><br><span class="line"><span class="string">dpi：一个整数，给出figure的分辨率。默认由rc的figure.dpi给出</span></span><br><span class="line"><span class="string">facecolor：背景色。若未提供，则由rc的figure.facecolor给出</span></span><br><span class="line"><span class="string">edgecolor：border color。若未提供，则由rc的figure.edgecolor给出</span></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br></pre></td></tr></table></figure><br />
Figure的一些方法：<br />
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br></pre></td><td class="code"><pre><span class="line">add_axes(*args, **kwargs)：创建一个坐标轴。</span><br><span class="line">如果已经存在同样位置同样参数的一个Axes，则返回该Axes，并将其设为current Axes。</span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">rect:一个元组，代表了(left,bottom,width,height)，它是第一个位置参数</span></span><br><span class="line"><span class="string">axisbg：一个color，背景色</span></span><br><span class="line"><span class="string">frameon：布尔值，是否display frame</span></span><br><span class="line"><span class="string">sharex：另一个Axes对象，与该Axes共享 xaxis</span></span><br><span class="line"><span class="string">sharey：另一个Axes对象，与该Axes共享 yaxis</span></span><br><span class="line"><span class="string">projection：坐标系类型。projection=&#x27;polar&#x27;也等价于polar=True</span></span><br><span class="line"><span class="string">aspect：一个数值，指定x和y轴每个单位的尺寸比例。也可以设定为字符串&#x27;equal&#x27;/&#x27;auto&#x27;</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">如果你想在同样的一个rect创建两个Axes，那么你需要设置label参数。不同的Axes通过不同的label鉴别。</span></span><br><span class="line"><span class="string">如果你使用了`fig.delaxes()`从Figure中移除了ax，那么你可以通过`fig.add_exes(ax)`来将其放回。</span></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line">sca(a)：设置a为current axes并返回它。</span><br><span class="line">gca(**kwargs)：返回current axes。如果不存在则创建一个。</span><br><span class="line">delaxes(a)：从figure中移除axes。</span><br><span class="line"></span><br><span class="line">autofmt_xdate(bottom=<span class="number">0.2</span>, rotation=<span class="number">30</span>, ha=<span class="string">&#x27;right&#x27;</span>)：用于设置Date ticklabel的位置。</span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">bottom：设置距离subplot底部的位置。</span></span><br><span class="line"><span class="string">rotation：设置了xtick label的旋转角度。</span></span><br><span class="line"><span class="string">ha：设置xtick label的对其方式。</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">该函数主要用于当xtick为日期，可能会重叠，因此可以旋转一个角度。</span></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line">suptitle(t, **kwargs):设置图像标题。t为标题字符串。关键字参数就是Text对象的参数：</span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">x：在图形坐标系中，标题的横坐标（范围 0～1）</span></span><br><span class="line"><span class="string">y：在图形坐标系中，标题的纵坐标（范围 0～1）</span></span><br><span class="line"><span class="string">horizontalalignment：标题水平对齐方式，默认为&#x27;center&#x27;</span></span><br><span class="line"><span class="string">verticalalignment：标题垂直对齐方式，默认为&#x27;top&#x27;</span></span><br><span class="line"><span class="string">fontsize：字体大小</span></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line">text(x, y, s, *args, **kwargs)：添加文本。</span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">x：在图形坐标系中，标题的横坐标（范围 0～1）</span></span><br><span class="line"><span class="string">y：在图形坐标系中，标题的纵坐标（范围 0～1）</span></span><br><span class="line"><span class="string">s：文本字符串</span></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line">tight_layout(renderer=<span class="literal">None</span>, pad=<span class="number">1.08</span>, h_pad=<span class="literal">None</span>, w_pad=<span class="literal">None</span>, rect=<span class="literal">None</span>)：调整subplot的间距。</span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">pad：设定subplot和figure edge之间的距离。单位为font-size</span></span><br><span class="line"><span class="string">h_pad/w_pad：subplot之间的高距/宽距。</span></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="comment"># 子图，除了下面方法，还有plt.subplot()、plt.subplots()</span></span><br><span class="line">add_subplot(*args,**kwargs)：创建一个subplot。</span><br><span class="line">如果已经存在同样位置同样参数的一个subplot，则返回该subplot，并将其设为current Axes。</span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">nrows：行数</span></span><br><span class="line"><span class="string">nclos：列数，每个单元格是一个sub-axes。</span></span><br><span class="line"><span class="string">plot_number：子图的序列，从1开始，从左到右，从上到下顺序排列。最大为nrows*ncols。</span></span><br><span class="line"><span class="string">            当nrows,ncols,plot_number这三个数字都是个位数时，可以使用一个三位数代替，每位代表一个数。</span></span><br><span class="line"><span class="string">projection：坐标系类型。projection=&#x27;polar&#x27;也等价于polar=True</span></span><br><span class="line"><span class="string">axisbg：一个color，背景色</span></span><br><span class="line"><span class="string">frameon：布尔值，是否display frame</span></span><br><span class="line"><span class="string">sharex：另一个Axes对象，与该Axes共享 xaxis</span></span><br><span class="line"><span class="string">sharey：另一个Axes对象，与该Axes共享 yaxis</span></span><br><span class="line"><span class="string">projection：坐标系类型。projection=&#x27;polar&#x27;也等价于polar=True</span></span><br><span class="line"><span class="string">aspect：一个数值，指定x和y轴每个单位的尺寸比例。也可以设定为字符串&#x27;equal&#x27;/&#x27;auto&#x27;</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">&#x27;&#x27;</span></span><br><span class="line"><span class="string">%matplotlib inline</span></span><br><span class="line"><span class="string">import matplotlib.pyplot as plt</span></span><br><span class="line"><span class="string">plt.style.use(&#x27;seaborn-white&#x27;)</span></span><br><span class="line"><span class="string">import numpy as np</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">for i in range(1, 7):</span></span><br><span class="line"><span class="string">    plt.subplot(2, 3, i)</span></span><br><span class="line"><span class="string">    plt.text(0.5, 0.5, str((2, 3, i)), fontsize=18, ha=&#x27;center&#x27;)</span></span><br><span class="line"><span class="string">&#x27;&#x27;</span></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line">subplots_adjust(left=<span class="literal">None</span>, bottom=<span class="literal">None</span>, right=<span class="literal">None</span>, top=<span class="literal">None</span>, wspace=<span class="literal">None</span>, hspace=<span class="literal">None</span>)：调整子图之间的间隔和位置。</span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">hspace 与 wspace 参数设置与图形高度与宽度一致的子图间距，数值以子图的尺寸为单位</span></span><br><span class="line"><span class="string">&#x27;&#x27;</span></span><br><span class="line"><span class="string"># 在本例中，间距是子图宽度与高度的40%</span></span><br><span class="line"><span class="string">fig = plt.figure()</span></span><br><span class="line"><span class="string">fig.subplots_adjust(hspace=0.4, wspace=0.4)</span></span><br><span class="line"><span class="string">for i in range(1, 7):</span></span><br><span class="line"><span class="string">    ax = fig.add_subplot(2, 3, i)</span></span><br><span class="line"><span class="string">    ax.text(0.5, 0.5, str((2, 3, i)), fontsize=18, ha=&#x27;center&#x27;)</span></span><br><span class="line"><span class="string">&#x27;&#x27;</span></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line">colorbar(mappable, cax=<span class="literal">None</span>, ax=<span class="literal">None</span>, use_gridspec=<span class="literal">True</span>, **kw)：为mappable创建一个colorbar。</span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">mapple：一个ScalarMapple实例。它可以是Image/ContourSet等等。</span></span><br><span class="line"><span class="string">cax：指定在哪个axes中绘制colorbar。也可以是None</span></span><br><span class="line"><span class="string">ax：如果cax为None，则一个或多个父轴将从中窃取用于新颜色条轴的空间。如果设置了cax，则此设置无效。</span></span><br><span class="line"><span class="string">use_gridspec：如果cax为None，则将创建一个新的cax作为Axes的实例。</span></span><br><span class="line"><span class="string">              如果ax是Subplot的实例，并且use_gridspec为True，则使用gridspec模块将cax创建为Subplot的实例。</span></span><br><span class="line"><span class="string">ticks: 一个序列，离散颜色分箱。</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">plt.clim(min,max)：设置颜色条上下限。</span></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line">legend(handles, labels, *args, **kwargs)：创建图例。</span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">handles：是一个Lin2D/Patch等实例的一个序列</span></span><br><span class="line"><span class="string">labels：是个字符串序列，用于给上述实例添加图例说明</span></span><br><span class="line"><span class="string">loc：指定图例的位置。可以是字符串&#x27;best&#x27;/&#x27;upper right&#x27;/&#x27;upper left&#x27;</span></span><br><span class="line"><span class="string">    /&#x27;lower left&#x27;/&#x27;lower right&#x27;/&#x27;right&#x27;/&#x27;center left&#x27;/&#x27;center right&#x27;</span></span><br><span class="line"><span class="string">    /&#x27;lower center&#x27;/&#x27;upper center&#x27;/&#x27;center&#x27;。你也可以指定坐标(x,y)，其中(0,0)是左下角，(1,1)是右上角</span></span><br><span class="line"><span class="string">numpoint/scatterpoints：图例上每个图例线的点数</span></span><br><span class="line"><span class="string">fancybox：如果为True，图例的边框采用圆角矩形</span></span><br><span class="line"><span class="string">shadow：如果为True，图例添加背影</span></span><br><span class="line"><span class="string">ncol：列数</span></span><br><span class="line"><span class="string">title：图例的标题</span></span><br><span class="line"><span class="string">framealpha：一个浮点数，从0到 1，图例的透明度</span></span><br><span class="line"><span class="string">frameon：一个布尔值，如果为True，则绘制图例的背景框。否则不绘制。</span></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line">savefig(fname, dpi=<span class="literal">None</span>, facecolor=<span class="string">&#x27;w&#x27;</span>, edgecolor=<span class="string">&#x27;w&#x27;</span>,orientation=<span class="string">&#x27;portrait&#x27;</span>, </span><br><span class="line">        papertype=<span class="literal">None</span>, <span class="built_in">format</span>=<span class="literal">None</span>, transparent=<span class="literal">False</span>, bbox_inches=<span class="literal">None</span>, pad_inches=<span class="number">0.1</span>,frameon=<span class="literal">None</span>)：保存图像。</span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">fname：带路径的文件名。</span></span><br><span class="line"><span class="string">dpi：保存的分辨率。</span></span><br><span class="line"><span class="string">facecolor/edgecolor：figure rectangle的背景色和边线颜色</span></span><br><span class="line"><span class="string">orientation：可以为&#x27;landscape&#x27; | &#x27;portrait&#x27;</span></span><br><span class="line"><span class="string">format：图片格式。可以为&#x27;png&#x27;/&#x27;pdf&#x27;/&#x27;svg&#x27;/&#x27;eps&#x27;...</span></span><br><span class="line"><span class="string">transparent：如果为True，设置figure和axes背景透明（除非你设置了facecolor/edgecolor）</span></span><br><span class="line"><span class="string">frameon：如果为False，则图形背景透明</span></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="comment"># 显示图像</span></span><br><span class="line">show(warn=<span class="literal">True</span>)：显示图像。如果warn=<span class="literal">True</span>，则开启警报。</span><br><span class="line"><span class="comment"># 获取/设置属性</span></span><br><span class="line">get_dpi()/get_edgecolor()/get_facecolor()...：获取对应的属性值。</span><br><span class="line">get_children()：获取figure中包含的artists。</span><br><span class="line">get_size_inches()：返回fig的当前尺寸（单位为英寸。<span class="number">1</span><span class="keyword">in</span>=<span class="number">2.54</span>cm）</span><br><span class="line"></span><br><span class="line">set_dpi()/set_edgecolor()...：设置相关属性。</span><br><span class="line"><span class="comment"># 清除fig</span></span><br><span class="line">clear()：清除一个figure。</span><br><span class="line">clf(keep_observers=<span class="literal">False</span>)：清除一个figure。如果keep_observers=<span class="literal">True</span>，则gui仍然会跟踪figure中的axes。</span><br></pre></td></tr></table></figure></p>
<h2 id="axes">Axes</h2>
<p>Axes类是matplotlib的核心，大多数时间都是在与它打交道。Axes代表了绘图区。大量的用于绘图的Artist存放在它内部，并且它有许多辅助方法来创建和添加Artist给它自己，而且它也有许多赋值方法来访问和修改这些Artist。</p>
<p>它有许多方法用于绘图，如<code>.plot()</code>、<code>.text()</code>、<code>.hist()</code>、<code>.imshow()</code>等方法用于创建大多数常见的primitive(如Line2D，Rectangle，Text，Image等等）。这些方法会创建primitive
Artist实例，并且添加这些实例到对应的container上去，然后必要的时候会绘制这些图形。</p>
<p>例如，Subplot就是一个特殊的Axes，其实例是位于网格中某个区域的Subplot实例。其实你也可以在任意区域创建Axes，通过<code>Figure.add_axes([left,bottom,width,height])</code>来创建一个任意区域的Axes，其中left,bottom,width,height都是<code>[0,1]</code>之间的浮点数，他们代表了相对于Figure的坐标。<br />
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> numpy <span class="keyword">as</span> np </span><br><span class="line"><span class="keyword">import</span> matplotlib.pyplot <span class="keyword">as</span> plt</span><br><span class="line">%matplotlib notebook <span class="comment"># 使用交互式能显示整体Figure和Axes</span></span><br><span class="line"></span><br><span class="line">fig = plt.figure() <span class="comment"># 创建图形</span></span><br><span class="line">ax = fig.add_axes([<span class="number">0.15</span>,<span class="number">0.1</span>,<span class="number">0.7</span>,<span class="number">0.3</span>]) <span class="comment"># 绘图区坐标</span></span><br><span class="line"></span><br><span class="line">x = np.arange(<span class="number">0.0</span>,<span class="number">1.0</span>,<span class="number">0.01</span>)</span><br><span class="line">ax.plot(x, np.sin(<span class="number">2</span>*np.pi*x))</span><br></pre></td></tr></table></figure><br />
<img src="https://i.loli.net/2021/05/21/vHaJ7ncBWPmtf31.jpg" /><br />
Axes包含了一个<code>.patch</code>属性，对于笛卡尔坐标系而言，它是一个Rectangle；对于极坐标而言，它是一个Circle。这个<code>.patch</code>属性决定了plotting
region的形状、背景和边框。</p>
<p>当调用<code>Axes.plot()</code>方法时，该方法会创建一个matplotlib.lines.Line2D实例，然后会利用传给<code>.plot()</code>的关键字参数来更新该Line2D的属性，然后将这个Line2D添加到Axes.lines列表中。该方法返回的刚创建的Line2D列表，因为你可以传递多个<code>(x,y)</code>值从而创建多个Line2D。同理，当调用<code>Axes.hist()</code>方法时，类似于<code>.plot()</code>方法，不过它会添加patches到Axes.patches列表。<br />
<div class="note info"><p>不应该直接对Axes.lines和Axes.patches列表操作来添加图表。因为当你通过.plot()和.hist()等方法添加图表时，matplotlib会做许多工作而不仅仅是添加绘图组件到Axes.lines或者Axes.patches列表中。你可以使用Axes的辅助方法.add_line()和.add_patch()方法来添加。</p>
</div></p>
<p>下面是Axes用于创建primitive
Artist以及添加他们到相应的container中的方法：<br />
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">ax.annotate()：创建text annotation（Annotate对象），然后添加到ax.texts列表中。</span><br><span class="line">ax.bar()：创建bar chart（Rectangle对象），然后添加到ax.patches列表中。</span><br><span class="line">ax.errorbar()：创建error bar plot（Line2D对象和Rectangle对象），然后添加到ax.lines列表中和ax.patches列表中。</span><br><span class="line">ax.fill()：创建shared area（Polygon对象），然后添加到ax.patches列表中</span><br><span class="line">ax.hist()：创建histogram（Rectangle对象），然后添加到ax.patches列表中。</span><br><span class="line">ax.imshow()：创建image data（AxesImage对象），然后添加到ax.images列表中。</span><br><span class="line">ax.legend()：创建axes legends（Legend对象），然后添加到ax.legends列表中。</span><br><span class="line">ax.plot()：创建xy plot（Line2D对象），然后添加到ax.lines列表中。</span><br><span class="line">ax.scatter()：创建scatter charts（PolygonCollection对象），然后添加到ax.collections列表中。</span><br><span class="line">ax.text()：创建text（Text对象），然后添加到ax.texts列表中。</span><br></pre></td></tr></table></figure><br />
另外Axes还包含两个最重要的Artist container：<br />
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">ax.xaxis：XAxis对象的实例，用于处理x轴tick以及label的绘制</span><br><span class="line">ax.yaxis：YAxis对象的实例，用于处理y轴tick以及label的绘制</span><br></pre></td></tr></table></figure><br />
Axes包含了许多辅助方法来访问和修改XAxis和YAxis，这些辅助方法其实内部调用的是XAxis和YAxis的方法。因此通常情况下不需要直接调用XAxis和YAxis的方法。只需要知道更改x轴和y轴的tick和label的方法，都是对XAxis和YAxis的操作的。</p>
<p>Axes 的一些方法：<br />
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br><span class="line">234</span><br><span class="line">235</span><br><span class="line">236</span><br><span class="line">237</span><br><span class="line">238</span><br><span class="line">239</span><br><span class="line">240</span><br><span class="line">241</span><br><span class="line">242</span><br><span class="line">243</span><br><span class="line">244</span><br><span class="line">245</span><br><span class="line">246</span><br><span class="line">247</span><br><span class="line">248</span><br><span class="line">249</span><br><span class="line">250</span><br><span class="line">251</span><br><span class="line">252</span><br><span class="line">253</span><br><span class="line">254</span><br><span class="line">255</span><br><span class="line">256</span><br><span class="line">257</span><br><span class="line">258</span><br><span class="line">259</span><br><span class="line">260</span><br><span class="line">261</span><br><span class="line">262</span><br><span class="line">263</span><br><span class="line">264</span><br><span class="line">265</span><br><span class="line">266</span><br><span class="line">267</span><br><span class="line">268</span><br><span class="line">269</span><br><span class="line">270</span><br><span class="line">271</span><br><span class="line">272</span><br><span class="line">273</span><br><span class="line">274</span><br><span class="line">275</span><br><span class="line">276</span><br><span class="line">277</span><br><span class="line">278</span><br><span class="line">279</span><br><span class="line">280</span><br><span class="line">281</span><br><span class="line">282</span><br><span class="line">283</span><br><span class="line">284</span><br><span class="line">285</span><br><span class="line">286</span><br><span class="line">287</span><br><span class="line">288</span><br><span class="line">289</span><br><span class="line">290</span><br><span class="line">291</span><br><span class="line">292</span><br><span class="line">293</span><br><span class="line">294</span><br><span class="line">295</span><br><span class="line">296</span><br><span class="line">297</span><br><span class="line">298</span><br><span class="line">299</span><br><span class="line">300</span><br><span class="line">301</span><br><span class="line">302</span><br><span class="line">303</span><br><span class="line">304</span><br><span class="line">305</span><br><span class="line">306</span><br><span class="line">307</span><br><span class="line">308</span><br><span class="line">309</span><br><span class="line">310</span><br><span class="line">311</span><br><span class="line">312</span><br><span class="line">313</span><br><span class="line">314</span><br><span class="line">315</span><br><span class="line">316</span><br><span class="line">317</span><br><span class="line">318</span><br><span class="line">319</span><br><span class="line">320</span><br><span class="line">321</span><br><span class="line">322</span><br></pre></td><td class="code"><pre><span class="line">cla()/clear()：清除Axes</span><br><span class="line">remove()：从figure中移除本axes。除非重绘figure，否则看不出来效果。</span><br><span class="line"></span><br><span class="line">acorr(x, **kwargs)：绘制序列x的自相关。</span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">x：一个标量序列。对x执行自相关</span></span><br><span class="line"><span class="string">normed：一个布尔值，如果为True，则对数据正则化处理</span></span><br><span class="line"><span class="string">maxlags：一个整数，默认为10.它给出了要展示多少个lag。如果为None，则使用所有的2*len(x)-1个</span></span><br><span class="line"><span class="string">其他kwargs：控制了Line2D的属性</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">返回：(lags,c,lin,b)</span></span><br><span class="line"><span class="string">lags：是一个长度为2*maxlags+的lag vector</span></span><br><span class="line"><span class="string">c：是长度为2*maxlags+的自相关向量</span></span><br><span class="line"><span class="string">line：是一个Line2D实例</span></span><br><span class="line"><span class="string">b：是x-axis</span></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line">add_artist(a)：添加a（一个Artist对象）到axes上</span><br><span class="line">add_collection(collection, autolim=<span class="literal">True</span>)：添加Collection实例到axes上</span><br><span class="line">add_container(container)：添加Container实例到axes上</span><br><span class="line">add_image(image)：添加Image实例到axes上</span><br><span class="line">add_line(line)：添加Line2D实例到axes上</span><br><span class="line">add_patch(p)：添加Patch实例到axes上</span><br><span class="line">add_table(tab)：添加Table实例到axes上</span><br><span class="line"></span><br><span class="line">annotate(*args, **kwargs)：对坐标点(x,y)绘制注解。</span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">s：注解字符串</span></span><br><span class="line"><span class="string">xy：一个长度为2的序列，给出了坐标点的(x,y)坐标</span></span><br><span class="line"><span class="string">xytext：一个长度为2的序列，给出了注解字符串的(x,y)坐标</span></span><br><span class="line"><span class="string">xycoords：给出了坐标点的(x,y)所对应的坐标系。可以为&#x27;figure points&#x27;、 &#x27;figure pixels&#x27;、&#x27;figure fraction&#x27;、</span></span><br><span class="line"><span class="string">        &#x27;axes points&#x27;、 &#x27;axes pixels&#x27;、&#x27;axes fraction&#x27;、&#x27;data&#x27;。</span></span><br><span class="line"><span class="string">         figure表示Figure坐标系，axes表示Axes坐标系，data表示被注解的点所在的数据坐标系。</span></span><br><span class="line"><span class="string">         points表示单位为点（分辨率的点）；pixels表示单位为像素，fraction表示：(0,0) 为左下角，(1,1) 为右上角</span></span><br><span class="line"><span class="string">textcoords：给出了注解字符串的(x,y)所对应的坐标系。可以为xycoords允许的值之外，还可以为：</span></span><br><span class="line"><span class="string">        &#x27;offset points&#x27;：偏移被注解的坐标点的距离为 (x,y)个点（分辨率的点）</span></span><br><span class="line"><span class="string">        &#x27;offset pixels&#x27;：偏移被注解的坐标点的距离为 (x,y)个像素</span></span><br><span class="line"><span class="string">arrowprops：一个字典，给出了箭头的类型。</span></span><br><span class="line"><span class="string">        若字典不包含arrowstyle，则可以使用下面的键： width/headwidth/headlength/shrink以及其他的FancyArrowPatch的属性。</span></span><br><span class="line"><span class="string">        如果字典包含了arrowstyle，则上面的这些键将被屏蔽。arrowstyle的值可以为：</span></span><br><span class="line"><span class="string">            &#x27;-&#x27;、&#x27;-&gt;&#x27;、&#x27;-[&#x27;、&#x27;|-|&#x27;、&#x27;-|&gt;&#x27;、&#x27;&lt;-&#x27;、&#x27;&lt;-&gt;&#x27;、</span></span><br><span class="line"><span class="string">            &#x27;&lt;|-&#x27;、&#x27;&lt;|-|&gt;&#x27;、&#x27;fancy&#x27;、&#x27;simple&#x27;、&#x27;wedge&#x27;</span></span><br><span class="line"><span class="string">annotation_clip：一个布尔值。如果为True，则超出axes的部分将会不可见</span></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line">autoscale_view(tight=<span class="literal">None</span>, scalex=<span class="literal">True</span>, scaley=<span class="literal">True</span>)：自动调整坐标轴的范围。</span><br><span class="line">                                                      如果你不想自动调整x轴，则scalex=<span class="literal">False</span>即可。y轴类似。</span><br><span class="line">arrow(x, y, dx, dy, **kwargs)：绘制箭头。箭头起点为 (x,y)，终点为 (x+dx,y+dy)。你也可以使用annotate()来模拟本方法。</span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">x,y：箭头起点坐标（data坐标系）</span></span><br><span class="line"><span class="string">dxx,dy：箭头终点坐标为 (x+dx,y+dy)（data坐标系）</span></span><br><span class="line"><span class="string">width：箭头宽度</span></span><br><span class="line"><span class="string">length_includes_head:：如果为True，则箭头的头部也算在箭头长度内</span></span><br><span class="line"><span class="string">head_width：箭头的头部宽度</span></span><br><span class="line"><span class="string">head_length：箭头的头部长度 </span></span><br><span class="line"><span class="string">shape：可以为&#x27;full&#x27;/&#x27;left&#x27;/&#x27;right&#x27;。确定是绘制左半边/右半边还是全部画出</span></span><br><span class="line"><span class="string">其他参数控制了Patch的属性</span></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line">axhline(y=<span class="number">0</span>, xmin=<span class="number">0</span>, xmax=<span class="number">1</span>, **kwargs)：绘制水平线。</span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">y：一个标量，默认为 0.给出了水平的 y坐标（采用data坐标系）</span></span><br><span class="line"><span class="string">xmin：一个标量，默认为 0。给出了水平线的起始横坐标。最大为 1（表示最右侧）（使用Axes坐标系）</span></span><br><span class="line"><span class="string">xmax：一个标量，默认为 1。 给出了水平线的终点横坐标。最小为 0 （表示最左侧）（使用Axes坐标系）</span></span><br><span class="line"><span class="string">其他关键字参数控制Line2D的属性</span></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line">axhspan(ymin, ymax, xmin=<span class="number">0</span>, xmax=<span class="number">1</span>, **kwargs)：绘制水平区域。</span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">ymin/ymax：给出了水平区域的y坐标的下界和上界，采用data坐标系</span></span><br><span class="line"><span class="string">xmin/xmax：给出了水平区域的左侧和右侧的位置。采用Axes坐标系，最小为0，最大为 1</span></span><br><span class="line"><span class="string">其他关键字参数控制Line2D的属性</span></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line">axis(*v, **kwargs)：设置axis属性，它返回的是(xmin,xmax,ymin,ymax)。data坐标系下每个轴的最小值、最大值。</span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">v： Axis data limits set from a float list。也可以是字符串：</span></span><br><span class="line"><span class="string">    &#x27;on&#x27;：切换新轴线，有标签</span></span><br><span class="line"><span class="string">    &#x27;off&#x27;：切换新轴线，无标签</span></span><br><span class="line"><span class="string">    &#x27;equal&#x27;：根据设置的限制，平等缩放</span></span><br><span class="line"><span class="string">    &#x27;tight&#x27;：限制允许内，显示所有数据</span></span><br><span class="line"><span class="string">    &#x27;auto&#x27;：自动缩放</span></span><br><span class="line"><span class="string">xmin/ymin/ymax/ymax：待设置的轴的最小/最大值</span></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line">axvline(x=<span class="number">0</span>, ymin=<span class="number">0</span>, ymax=<span class="number">1</span>, **kwargs)：绘制垂直线。</span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">x：一个标量，默认为 0.给出了垂直线的 x坐标（采用data坐标系）</span></span><br><span class="line"><span class="string">ymin：一个标量，默认为 0。给出了垂直线的起始纵坐标。最大为 1（表示最上侧）（使用Axes坐标系）</span></span><br><span class="line"><span class="string">ymax：一个标量，默认为 1。 给出了垂直线的终点纵坐标。最小为 0 （表示最下侧）（使用Axes坐标系）</span></span><br><span class="line"><span class="string">其他关键字参数控制Line2D的属性</span></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line">axvspan(xmin, xmax, ymin=<span class="number">0</span>, ymax=<span class="number">1</span>, **kwargs)：绘制垂直区域。</span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">xmin/xmax：给出了垂直区域的x坐标的左侧和右侧，采用data坐标系</span></span><br><span class="line"><span class="string">ymin/ymax：给出了垂直区域的上侧和下侧的位置。采用Axes坐标系，最小为0，最大为 1</span></span><br><span class="line"><span class="string">其他关键字参数控制Line2D的属性</span></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line">clabel(CS, *args, **kwargs)：为等高线添加label。</span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">CS：由contour函数返回的ContourSet，代表一组等高线</span></span><br><span class="line"><span class="string">fontsize：label的字体大小，或者给出字符串&#x27;smaller&#x27;/&#x27;x-large&#x27;</span></span><br><span class="line"><span class="string">colors：如果为None，则使用对应的等高线的颜色。</span></span><br><span class="line"><span class="string">        如果为一个字符串指定的颜色，则所有的等高线label使用该颜色。</span></span><br><span class="line"><span class="string">        如果为一组颜色，则不同的等高线的label按顺序使用其中的不同的颜色。</span></span><br><span class="line"><span class="string">inline：一个布尔值。如果为True，则移除label覆盖的底层的等高线（嵌入式）；否则就全部绘制（重叠式）</span></span><br><span class="line"><span class="string">inline_spacing:一个浮点数，单位为像素点。它控制了label距离等高线的距离</span></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line">findobj(<span class="keyword">match</span>=<span class="literal">None</span>, include_self=<span class="literal">True</span>)：筛选出合适的artist对象，返回一个列表。他会递归的向下搜寻</span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">match指定过滤器：</span></span><br><span class="line"><span class="string">    如果为None，则它选出axes包含的所有artist</span></span><br><span class="line"><span class="string">    如果为一个函数，则函数接受一个artist参数，返回布尔值。所有返回True的artist被选中</span></span><br><span class="line"><span class="string">    如果是一个类，则返回属于该类的artist</span></span><br><span class="line"><span class="string">include_self：如果为True，则也检查自己</span></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line">get_xx函数：返回对应的属性值。</span><br><span class="line">    get_alpha()/get_anchor()/get_animated()...</span><br><span class="line"></span><br><span class="line">grid(b=<span class="literal">None</span>, which=<span class="string">&#x27;major&#x27;</span>, axis=<span class="string">&#x27;both&#x27;</span>, **kwargs)：开启关闭网格。</span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">b：布尔值，指定你想开启(True)还是关闭网格</span></span><br><span class="line"><span class="string">which：可以为&#x27;major&#x27;/&#x27;minor&#x27;/&#x27;both&#x27;，指定你想开启哪个级别的网格</span></span><br><span class="line"><span class="string">axis：可以为&#x27;x&#x27;/&#x27;y&#x27;/&#x27;both&#x27;，指定你想在那个轴上开启网格</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">其他的关键字参数设定了网格的线条类型。如color/linestype/linewidth</span></span><br><span class="line"><span class="string">还有一种简单用法，就是axes.grid()，此时表示：如果网格开启，则关闭。如果网格关闭，则开启。</span></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line">locator_params(axis=<span class="string">&#x27;both&#x27;</span>, tight=<span class="literal">None</span>, **kwargs)：控制tick locator</span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">axis：一个字符串，指定控制那个轴。可以为&#x27;x&#x27;/&#x27;y&#x27;/&#x27;both&#x27;。</span></span><br><span class="line"><span class="string">tight：一个布尔值。它传递给autoscale_view()</span></span><br><span class="line"><span class="string">其他关键字参数传递给set_params()方法</span></span><br><span class="line"><span class="string">如果你想调整主轴上的刻度线的数量，可以使用ax.locator_params(tight=True,nbins=4)</span></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line">loglog(*args, **kwargs)：绘制line，但是将x轴和y轴都调整为对数坐标</span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">x：数据的x坐标</span></span><br><span class="line"><span class="string">y：数据的y坐标</span></span><br><span class="line"><span class="string">basex/basey：一个大于 1 的标量，控制对数的底数</span></span><br><span class="line"><span class="string">subsx/subsy：一个序列，给出了x/y轴的子刻度的位置（数据坐标系）。默认为None，此时子刻度是自动划分的</span></span><br><span class="line"><span class="string">nonposx/nonposy：</span></span><br><span class="line"><span class="string">               如果为&#x27;mask&#x27;，则x/y的负数或者零将被视作无效的数；</span></span><br><span class="line"><span class="string">               如果为&#x27;clip&#x27;，则x/y的负数或者零将被视作一个非常小的正数（因为对数的自变量要大于零）</span></span><br><span class="line"><span class="string">剩下的参数将被作为Line2D的属性</span></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line">margins(*args, **kw)：设置Axes的margin。</span><br><span class="line">                      你可以通过ax.margins()获取当前的margin。</span><br><span class="line">                      你也可以通过ax.margins(x=xmargin,y=ymargin)来设置margin。这两个参数的值是 <span class="number">0</span>～<span class="number">1</span></span><br><span class="line"></span><br><span class="line">minorticks_off()：关闭次刻度线。minorticks_on()：打开次刻度线。</span><br><span class="line"></span><br><span class="line">pcolor(*args, **kwargs)：绘制一个pseudocolor plot，返回一个Collection实例。</span><br><span class="line">                         对于大型数组，它很慢，此时推荐使用pcolormesh()。常用的方式为：</span><br><span class="line">pcolor(C,*kwargs)，此时C为一个二维数组。也可以指定pcolor(X,Y,C,*kwargs)。</span><br><span class="line">    X/Y/C都是二维数组，并且X和Y的尺寸比C大。它将在四个点决定的矩形中填充颜色:</span><br><span class="line">        C[i,j]： (X[i, j], Y[i, j])，(X[i, j+<span class="number">1</span>], Y[i, j+<span class="number">1</span>])， </span><br><span class="line">        (X[i+<span class="number">1</span>, j], Y[i+<span class="number">1</span>, j])，(X[i+<span class="number">1</span>, j+<span class="number">1</span>], Y[i+<span class="number">1</span>, j+<span class="number">1</span>])。X/Y也可以是一维的，但是首先会进行广播法则。</span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">cmap：一个Colormap实例。如果为None，则使用rc的设置</span></span><br><span class="line"><span class="string">edgecolors：None或者&#x27;none&#x27;或者一个颜色或者一个颜色序列。用于设定边的颜色</span></span><br><span class="line"><span class="string">其他参数设置PopyCollection属性</span></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line">pcolorfast(*args, **kwargs)：用法和pcolor相同，它是一个实验性质的，提供了一个更快的实现。</span><br><span class="line"></span><br><span class="line">pcolormesh(*args, **kwargs)：作用和pcolor相同。</span><br><span class="line">                             但是它是另一个实现方式，并且返回不同的对象，它返回的是QuadMesh对象。</span><br><span class="line">                             它的速度更快。其参数和用法与pcolor相同。</span><br><span class="line"></span><br><span class="line">edgecolors：除了pcolor的edgecolors之外，还多了一个<span class="string">&#x27;face&#x27;</span>，表示使用与四边形背景色相同的颜色。</span><br><span class="line"></span><br><span class="line">ax.xaxis.set_major_locator(MonthLocator())：设置x轴的主刻度的locator。常见的一些DateLocator有：</span><br><span class="line">                                            MinuteLocator、HourLocator、DayLocator、 WeekdayLocator、</span><br><span class="line">                                           MonthLocator、YearLocator、AutoDateLocator </span><br><span class="line">ax.xaxis.set_major_formatter(DateFormatter(<span class="string">&quot;%Y-%m-%d %H:%M:%S&quot;</span>))：设置x轴的主刻度的formatter。</span><br><span class="line"></span><br><span class="line">properties()：返回一个字典，该字典中包含了axes中的所有属性的键值对。</span><br><span class="line"></span><br><span class="line">table(**kwargs)：添加一个表格，返回一个table.Table实例。调用方式为：</span><br><span class="line">    table(cellText=<span class="literal">None</span>, cellColours=<span class="literal">None</span>,</span><br><span class="line">        cellLoc=<span class="string">&#x27;right&#x27;</span>, colWidths=<span class="literal">None</span>,</span><br><span class="line">        rowLabels=<span class="literal">None</span>, rowColours=<span class="literal">None</span>, rowLoc=<span class="string">&#x27;left&#x27;</span>,</span><br><span class="line">        colLabels=<span class="literal">None</span>, colColours=<span class="literal">None</span>, colLoc=<span class="string">&#x27;center&#x27;</span>,</span><br><span class="line">        loc=<span class="string">&#x27;bottom&#x27;</span>, bbox=<span class="literal">None</span>)</span><br><span class="line"></span><br><span class="line">text(x, y, s, fontdict=<span class="literal">None</span>, withdash=<span class="literal">False</span>, **kwargs)：添加文本，返回一个Text实例。</span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">s：一个字符串，被添加的文本</span></span><br><span class="line"><span class="string">x/y：一个标量，文本被添加的坐标</span></span><br><span class="line"><span class="string">fontdict：一个字典，给出了字体属性。</span></span><br><span class="line"><span class="string">withdash：一个布尔值。如果为True，则创建一个TextWithDash实例而不是Text实例。</span></span><br><span class="line"><span class="string">其他参数用于控制Text属性</span></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line">tick_params(axis=<span class="string">&#x27;both&#x27;</span>, **kwargs)：控制tick和tick label。</span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">axis：一个字符串，指定要控制那个轴。可以为&#x27;x&#x27;/&#x27;y&#x27;/&#x27;both&#x27;</span></span><br><span class="line"><span class="string">reset：一个布尔值。如果为True，那么在进行处理其他关键字参数之前，先恢复默认值。默认为False</span></span><br><span class="line"><span class="string">which：一个字符串，指定控制主刻度还是次刻度。可以为&#x27;major&#x27;/&#x27;minor&#x27;/&#x27;both&#x27;</span></span><br><span class="line"><span class="string">direction：一个字符串，控制将刻度放置在axes里面还是外面。可以为&#x27;in&#x27;/&#x27;out&#x27;/&#x27;inout&#x27;</span></span><br><span class="line"><span class="string">length：一个标量值。给出了每个刻度线的长度（就是那个小竖线），单位为像素点</span></span><br><span class="line"><span class="string">width：一个标量值。给出了每个刻度线的宽度（就是那个小竖线），单位为像素点</span></span><br><span class="line"><span class="string">color：给出刻度线的颜色</span></span><br><span class="line"><span class="string">pad：一个标量值，给出了刻度线和刻度label之间的距离，单位为像素点</span></span><br><span class="line"><span class="string">labelsize：一个标量值，给出了刻度label的字体大小。可以为数值，单位为像素点。也可以为字符串，如large&#x27;</span></span><br><span class="line"><span class="string">labelcolor：给出了刻度label的颜色</span></span><br><span class="line"><span class="string">colors：同时调整刻度线的颜色和刻度label的颜色</span></span><br><span class="line"><span class="string">bottom/top/left/right：一个布尔值或者字符串&#x27;on&#x27;/&#x27;off&#x27;。控制是否绘制对应位置的刻度线</span></span><br><span class="line"><span class="string">labelbottom/labeltop/labelleft/labelright：一个布尔值或者字符串&#x27;on&#x27;/&#x27;off&#x27;。控制是否绘制对应位置的刻度label</span></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line">vlines(x, ymin, ymax, colors=<span class="string">&#x27;k&#x27;</span>, linestyles=<span class="string">&#x27;solid&#x27;</span>, label=<span class="string">&#x27;&#x27;</span>, **kwargs)：绘制一群垂直线。</span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">x：标量或者一维数组，给出了垂线的位置</span></span><br><span class="line"><span class="string">ymin/ymax：给出了垂线的起始和终止位置。如果是个标量，则所有垂线共享该值</span></span><br><span class="line"><span class="string">colors：给出垂线的颜色</span></span><br><span class="line"><span class="string">linestyles：给出了垂线的线型</span></span><br><span class="line"><span class="string">label：一个字符串</span></span><br><span class="line"><span class="string">其他关键字参数设置LineCollection参数</span></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line">hlines(y, xmin, xmax, colors=<span class="string">&#x27;k&#x27;</span>, linestyles=<span class="string">&#x27;solid&#x27;</span>, label=<span class="string">&#x27;&#x27;</span>, **kwargs)：</span><br><span class="line">从xmin到xmax绘制一系列的水平线。这些水平线的纵坐标由y提供。</span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">y：水平线的纵坐标。如果为标量，则为一条水平；如果为序列，则为一系列水平线。数据坐标系</span></span><br><span class="line"><span class="string">xmin/xmax：水平线的起点和终点的横坐标。如果是个标量，则所有的水平线公用。如果是序列，则每个水平线设置一个。数据坐标系</span></span><br><span class="line"><span class="string">linestyles：指定线型。</span></span><br><span class="line"><span class="string">            可以为一个字符串（所有水平线公用），或者字符串序列（每个水平线一个）。</span></span><br><span class="line"><span class="string">            线型在&#x27;solid&#x27; | &#x27;dashed&#x27; | &#x27;dashdot&#x27; | &#x27;dotted&#x27;四者之一</span></span><br><span class="line"><span class="string">colors：指定颜色。可以为一个颜色（所有水平线公用），或者颜色序列（每个水平线一个）。</span></span><br><span class="line"><span class="string">label：一个字符串，指定标签。</span></span><br><span class="line"><span class="string">其他关键字参数设置LineCollection属性。</span></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line">quiver(*args, **kw)：创建一个二维的场向量。常见的调用方式有：</span><br><span class="line">    quiver(U,V,**kw)、 quiver(U,V,C,**kw)、quiver(X,Y,U,V,C,**kw)</span><br><span class="line">    quiver(X,Y,U,V,C,**kw)</span><br><span class="line">    其中U/V为向量的x轴分量和y轴分量。X/Y为绘制向量的起点坐标。C用于指定每个箭头的颜色。</span><br><span class="line">    如果为指定X/Y，则默认每个向量的起点从每个单元格生成。</span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">units：一个字符串，指定箭头的单位。除了箭头的长度以外，其他的度量都是以该单位为准。可以为：</span></span><br><span class="line"><span class="string">    &#x27;width&#x27;/&#x27;height&#x27;：以axes的宽度/高度为单位</span></span><br><span class="line"><span class="string">    &#x27;dots&#x27;/&#x27;inches&#x27;：以像素点/英寸为单位</span></span><br><span class="line"><span class="string">    &#x27;x&#x27;/&#x27;y&#x27;/&#x27;xy&#x27;：以数据坐标系下的X/Y为单位，而xy&#x27;表示数据坐标系下的单位矩形的对角线为单位。</span></span><br><span class="line"><span class="string">angles：指定向量的角度。正方形可能因为X/Y轴缩放尺度不同而显示为长方形。</span></span><br><span class="line"><span class="string">        可以为&#x27;uv&#x27;，表示只采用U,V的值计算；可以为&#x27;xy&#x27;，表示角度计算时考虑X轴与Y轴的缩放尺度。</span></span><br><span class="line"><span class="string">scale：一个浮点数，决定缩放比例。它和scale_units决定了箭头的全长。</span></span><br><span class="line"><span class="string">       假如向量的长度计算得到为 10，那么假如scale为 2， 而scale_units为dots，那么该向量的长度为5像素点。</span></span><br><span class="line"><span class="string">scale_units：一个字符串，指定缩放比例的单位。可以为&#x27;width&#x27;/&#x27;height&#x27;/&#x27;dots&#x27;/&#x27;inches&#x27;/&#x27;x&#x27;/&#x27;y&#x27;/&#x27;xy&#x27;</span></span><br><span class="line"><span class="string">width:一个标量，指定箭头的宽度，单位由units参数指定</span></span><br><span class="line"><span class="string">headwitdh:一个标量，指定箭头的头部的宽度，单位由units参数指定</span></span><br><span class="line"><span class="string">headlength:一个标量，指定箭头的头部的长度，单位由units参数指定</span></span><br><span class="line"><span class="string">headaxislength:一个标量，指定的是箭头的头部的左半边小三角与箭杆的相交的长度。单位由units参数指定</span></span><br><span class="line"><span class="string">minshaft:一个标量，Length below which arrow scales, in units of head length. 。不要设置成小于1，否则图形很难看</span></span><br><span class="line"><span class="string">minlength:一个标量，指定所有箭头的最短长度（单位由units参数指定）。如果有的箭头长度小于它，则绘制成一个点。</span></span><br><span class="line"><span class="string">pivot:一个字符串，控制了箭头旋转的中心。可以为&#x27;tail&#x27;/&#x27;mid&#x27;/&#x27;middle&#x27;/&#x27;tip&#x27;。tip表示箭头的尖尖。</span></span><br><span class="line"><span class="string">color:给出了箭头的颜色。如果给出了C参数，则该参数被忽略。</span></span><br><span class="line"><span class="string">其他参数控制了PolyCollection的属性</span></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line">quiverkey(*args, **kw)：给quiver设置key。常用的调用方式为：quiverkey(Q,X,Y,U,label,**kw)。</span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">Q：一个Quiver实例，由quiver()返回</span></span><br><span class="line"><span class="string">X/Y：key放置的位置，都是标量</span></span><br><span class="line"><span class="string">U：key的长度，都是标量</span></span><br><span class="line"><span class="string">label：一个字符串，指定了标记。</span></span><br><span class="line"><span class="string">coordinates：一个字符串，指定了X/Y的坐标系。</span></span><br><span class="line"><span class="string">    &#x27;axes&#x27;：axes坐标系，(0，0)为axes的左下角，(1,1)为axes的右上角。</span></span><br><span class="line"><span class="string">    &#x27;figure&#x27;：figure坐标系，(0，0)为figure的左下角，(1,1)为figure的右上角。</span></span><br><span class="line"><span class="string">    &#x27;data&#x27;：data坐标系</span></span><br><span class="line"><span class="string">    &#x27;inches&#x27;：为figure坐标系，但是以像素点为基准。(0,0)为左下角</span></span><br><span class="line"><span class="string">color：重写了Q的color</span></span><br><span class="line"><span class="string">labelpos：放置标记的位置，可以为&#x27;N&#x27;/&#x27;S&#x27;/&#x27;E&#x27;/&#x27;W&#x27;</span></span><br><span class="line"><span class="string">labelsep：给出了标记和箭头的距离，单位为英寸</span></span><br><span class="line"><span class="string">labelcolor：给出了标记的颜色</span></span><br><span class="line"><span class="string">fontproperties：一个字典或者FontProperties实例，设置了标记的字体。</span></span><br><span class="line"><span class="string">其他的关键字参数用于重写quiver的一些属性。</span></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line">semilogx(*args, **kwargs)：它类似plot()，只是将x轴设置为对数坐标。除了多了下面的参数外，其他设置与plot()一样。</span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">basex：一个大于 1 的标量，用于设置对数的底数</span></span><br><span class="line"><span class="string">subx：一个序列或者None。用于设置x轴的主要刻度值。默认采用自动设定</span></span><br><span class="line"><span class="string">nonposx：如果为&#x27;mask&#x27;，则x的负数或者零将被视作无效的数；</span></span><br><span class="line"><span class="string">         如果为&#x27;clip&#x27;，则x的负数或者零将被视作一个非常小的正数（因为对数的自变量要大于零）</span></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line">semilogy(*args, **kwargs)：它类似plot()，只是将y轴设置为对数坐标。除了多了下面的参数外，其他设置与plot()一样。</span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">basey：一个大于 1 的标量，用于设置对数的底数</span></span><br><span class="line"><span class="string">suby：一个序列或者None。用于设置y轴的主要刻度值。默认采用自动设定</span></span><br><span class="line"><span class="string">nonposy：如果为&#x27;mask&#x27;，则y的负数或者零将被视作无效的数；</span></span><br><span class="line"><span class="string">         如果为&#x27;clip&#x27;，则y的负数或者零将被视作一个非常小的正数（因为对数的自变量要大于零）</span></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line">spy(Z, precision=<span class="number">0</span>, marker=<span class="literal">None</span>, markersize=<span class="literal">None</span>, aspect=<span class="string">&#x27;equal&#x27;</span>, origin=<span class="string">&#x27;upper&#x27;</span>, **kwargs)：绘制矩阵中的非零值。</span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">Z：待绘制的二维矩阵，它和precision决定了绘制区域。坐标点(i,j)对应于Z[j,i]，即列对应于x轴。</span></span><br><span class="line"><span class="string">precision：只有Z中的那些大于precision的值才被绘制</span></span><br><span class="line"><span class="string">marker：用它来表示Z中的非零值</span></span><br><span class="line"><span class="string">markersize：marker的大小。</span></span><br><span class="line"><span class="string">aspect：高宽比</span></span><br><span class="line"><span class="string">origin：参考imshow的origin</span></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line">stem(*args, **kwargs)：绘制stem图。其调用方式为：</span><br><span class="line">  stem(y, linefmt=<span class="string">&#x27;b-&#x27;</span>, markerfmt=<span class="string">&#x27;bo&#x27;</span>, basefmt=<span class="string">&#x27;r-&#x27;</span>)</span><br><span class="line">  stem(x, y, linefmt=<span class="string">&#x27;b-&#x27;</span>, markerfmt=<span class="string">&#x27;bo&#x27;</span>, basefmt=<span class="string">&#x27;r-&#x27;</span>)</span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">linefmt：决定了垂线的格式。</span></span><br><span class="line"><span class="string">markerfmt：决定了每个`fmt`的格式。</span></span><br><span class="line"><span class="string">x：决定了每条垂线的位置（如果未提供，则为`[0,1,...len(y)-1]`）。</span></span><br><span class="line"><span class="string">y：序列决定了每条垂线的高度。</span></span><br><span class="line"><span class="string">basefmt：决定了位于`y=0`这条基准直线的格式。</span></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line">step(x, y, *args, **kwargs)：绘制阶梯图。调用方式为step(x, y, *args, **kwargs)</span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">x/y：都是一维序列，并且假设x为单调递增的（如果不满足，也不报错）</span></span><br><span class="line"><span class="string">where：指定分步类型。可以为&#x27;pre&#x27;/&#x27;post&#x27;/&#x27;mid&#x27;</span></span><br><span class="line"><span class="string">其他参数与plot()相同</span></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line">streamplot(x, y, u, v, density=<span class="number">1</span>, linewidth=<span class="literal">None</span>, color=<span class="literal">None</span>, cmap=<span class="literal">None</span>, </span><br><span class="line">           norm=<span class="literal">None</span>, arrowsize=<span class="number">1</span>, arrowstyle=<span class="string">&#x27;-|&gt;&#x27;</span>, minlength=<span class="number">0.1</span>, </span><br><span class="line">           transform=<span class="literal">None</span>, zorder=<span class="number">1</span>, start_points=<span class="literal">None</span>)：绘制向量场流线。</span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">x/y：一维数组，给出了网格的坐标</span></span><br><span class="line"><span class="string">u/v：二维数组，给出了每个网格的向量。其行数等于y的长度，列数等于x的长度</span></span><br><span class="line"><span class="string">density：一个浮点数或者浮点数的二元元组。控制了绘制向量场的密度。</span></span><br><span class="line"><span class="string">linewidth：标量或者二维数组，给出了每个向量箭头的线宽</span></span><br><span class="line"><span class="string">color：标量或者二维数组，给出了每个向量箭头的颜色</span></span><br><span class="line"><span class="string">cmap：一个Colormap实例。当color是一个二维数组时，它配合使用，给出了每个向量箭头的颜色</span></span><br><span class="line"><span class="string">norm：一个Normalize实例。当color是一个二维数组时，它配合使用，将颜色亮度调整为0~1</span></span><br><span class="line"><span class="string">arrowsize：一个浮点数，给出了箭头缩放比例</span></span><br><span class="line"><span class="string">arrowstyle：一个字符串，给出了箭头的类型。</span></span><br><span class="line"><span class="string">minlength：一个浮点数，限定了最小的向量长度</span></span><br><span class="line"><span class="string">start_points：它是一个N*2的数组，N流线起点的个数，给出了流线起始点的位置</span></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br></pre></td></tr></table></figure></p>
<p>常用绘图方法：<br />
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br><span class="line">234</span><br><span class="line">235</span><br><span class="line">236</span><br><span class="line">237</span><br><span class="line">238</span><br><span class="line">239</span><br><span class="line">240</span><br><span class="line">241</span><br><span class="line">242</span><br><span class="line">243</span><br><span class="line">244</span><br><span class="line">245</span><br><span class="line">246</span><br><span class="line">247</span><br><span class="line">248</span><br><span class="line">249</span><br><span class="line">250</span><br><span class="line">251</span><br><span class="line">252</span><br><span class="line">253</span><br><span class="line">254</span><br><span class="line">255</span><br><span class="line">256</span><br><span class="line">257</span><br><span class="line">258</span><br><span class="line">259</span><br><span class="line">260</span><br><span class="line">261</span><br><span class="line">262</span><br><span class="line">263</span><br><span class="line">264</span><br><span class="line">265</span><br><span class="line">266</span><br><span class="line">267</span><br><span class="line">268</span><br><span class="line">269</span><br><span class="line">270</span><br><span class="line">271</span><br><span class="line">272</span><br><span class="line">273</span><br><span class="line">274</span><br><span class="line">275</span><br><span class="line">276</span><br><span class="line">277</span><br><span class="line">278</span><br><span class="line">279</span><br><span class="line">280</span><br><span class="line">281</span><br><span class="line">282</span><br><span class="line">283</span><br><span class="line">284</span><br><span class="line">285</span><br><span class="line">286</span><br><span class="line">287</span><br><span class="line">288</span><br><span class="line">289</span><br><span class="line">290</span><br><span class="line">291</span><br><span class="line">292</span><br><span class="line">293</span><br><span class="line">294</span><br><span class="line">295</span><br><span class="line">296</span><br><span class="line">297</span><br><span class="line">298</span><br><span class="line">299</span><br><span class="line">300</span><br><span class="line">301</span><br><span class="line">302</span><br><span class="line">303</span><br><span class="line">304</span><br><span class="line">305</span><br><span class="line">306</span><br><span class="line">307</span><br><span class="line">308</span><br><span class="line">309</span><br><span class="line">310</span><br><span class="line">311</span><br><span class="line">312</span><br><span class="line">313</span><br><span class="line">314</span><br><span class="line">315</span><br><span class="line">316</span><br><span class="line">317</span><br><span class="line">318</span><br><span class="line">319</span><br><span class="line">320</span><br><span class="line">321</span><br><span class="line">322</span><br><span class="line">323</span><br><span class="line">324</span><br><span class="line">325</span><br><span class="line">326</span><br><span class="line">327</span><br><span class="line">328</span><br><span class="line">329</span><br><span class="line">330</span><br><span class="line">331</span><br><span class="line">332</span><br><span class="line">333</span><br><span class="line">334</span><br><span class="line">335</span><br><span class="line">336</span><br><span class="line">337</span><br><span class="line">338</span><br><span class="line">339</span><br><span class="line">340</span><br><span class="line">341</span><br><span class="line">342</span><br><span class="line">343</span><br><span class="line">344</span><br><span class="line">345</span><br><span class="line">346</span><br><span class="line">347</span><br><span class="line">348</span><br><span class="line">349</span><br><span class="line">350</span><br><span class="line">351</span><br><span class="line">352</span><br><span class="line">353</span><br><span class="line">354</span><br><span class="line">355</span><br><span class="line">356</span><br><span class="line">357</span><br><span class="line">358</span><br><span class="line">359</span><br><span class="line">360</span><br><span class="line">361</span><br><span class="line">362</span><br><span class="line">363</span><br><span class="line">364</span><br><span class="line">365</span><br><span class="line">366</span><br><span class="line">367</span><br><span class="line">368</span><br><span class="line">369</span><br><span class="line">370</span><br><span class="line">371</span><br><span class="line">372</span><br><span class="line">373</span><br><span class="line">374</span><br><span class="line">375</span><br><span class="line">376</span><br><span class="line">377</span><br><span class="line">378</span><br><span class="line">379</span><br><span class="line">380</span><br><span class="line">381</span><br><span class="line">382</span><br><span class="line">383</span><br><span class="line">384</span><br><span class="line">385</span><br><span class="line">386</span><br><span class="line">387</span><br><span class="line">388</span><br><span class="line">389</span><br><span class="line">390</span><br><span class="line">391</span><br><span class="line">392</span><br><span class="line">393</span><br><span class="line">394</span><br><span class="line">395</span><br><span class="line">396</span><br><span class="line">397</span><br><span class="line">398</span><br><span class="line">399</span><br><span class="line">400</span><br><span class="line">401</span><br><span class="line">402</span><br><span class="line">403</span><br><span class="line">404</span><br><span class="line">405</span><br><span class="line">406</span><br><span class="line">407</span><br><span class="line">408</span><br><span class="line">409</span><br><span class="line">410</span><br><span class="line">411</span><br><span class="line">412</span><br><span class="line">413</span><br><span class="line">414</span><br><span class="line">415</span><br><span class="line">416</span><br><span class="line">417</span><br><span class="line">418</span><br><span class="line">419</span><br><span class="line">420</span><br><span class="line">421</span><br><span class="line">422</span><br><span class="line">423</span><br><span class="line">424</span><br><span class="line">425</span><br><span class="line">426</span><br><span class="line">427</span><br><span class="line">428</span><br><span class="line">429</span><br><span class="line">430</span><br><span class="line">431</span><br><span class="line">432</span><br><span class="line">433</span><br><span class="line">434</span><br><span class="line">435</span><br><span class="line">436</span><br><span class="line">437</span><br><span class="line">438</span><br><span class="line">439</span><br><span class="line">440</span><br><span class="line">441</span><br><span class="line">442</span><br><span class="line">443</span><br><span class="line">444</span><br><span class="line">445</span><br><span class="line">446</span><br><span class="line">447</span><br></pre></td><td class="code"><pre><span class="line">bar(left, height, width=<span class="number">0.8</span>, bottom=<span class="literal">None</span>, **kwargs)：绘制一个bar。</span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">left：一个标量或者标量的序列，bar的左侧的x坐标，采用data坐标系</span></span><br><span class="line"><span class="string">height：一个标量或者标量的序列，bar的高度，采用data坐标系</span></span><br><span class="line"><span class="string">width：一个标量或者标量的序列，bar的宽度，默认为 0.8，采用data坐标系</span></span><br><span class="line"><span class="string">bottom：一个标量或者标量的序列，bar的底部的y坐标，默认为 0，采用data坐标系</span></span><br><span class="line"><span class="string">color：一个标量或者标量的序列，bar的背景色</span></span><br><span class="line"><span class="string">edgecolor：一个标量或者标量的序列，bar的边色颜色</span></span><br><span class="line"><span class="string">linewidth：一个标量或者标量的序列，bar的边的线宽</span></span><br><span class="line"><span class="string">tick_label：一个字符串或者字符串的序列，给出了bar的label</span></span><br><span class="line"><span class="string">xerr：一个标量或者标量的序列，用于设置bar的errorbar。（水平方向的小横线）</span></span><br><span class="line"><span class="string">yerr：一个标量或者标量的序列，用于设置bar的errorbar（垂直方向的小横线）</span></span><br><span class="line"><span class="string">ecolor：一个标量或者标量的序列，用于设置errorbar。</span></span><br><span class="line"><span class="string">capsize：一个标量，用于设置errorbar。小横线头部的一个小短线</span></span><br><span class="line"><span class="string">error_kw：一个字典，用于设置errorbar。如ecolor/capsize关键字</span></span><br><span class="line"><span class="string">align：一个字符串，设定bar的对齐方式。可以为&#x27;edge&#x27;/&#x27;center&#x27;。柱子的左边跟x=left线对齐，还是柱子的中线跟x=left线对齐。</span></span><br><span class="line"><span class="string">orientation：一个字符串，指定bar的方向。可以为&#x27;vertical&#x27;/&#x27;horizontal&#x27;。它决定了errbar和label放置的位置。</span></span><br><span class="line"><span class="string">log：一个布尔值，如果为True，则设置axis为对数坐标</span></span><br><span class="line"><span class="string">返回matplotlib.container.BarContainer。</span></span><br><span class="line"><span class="string">可以一次添加多个bar，此时就是上述的“标量的序列”。</span></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line">barh(bottom, width, height=<span class="number">0.8</span>, left=<span class="literal">None</span>, **kwargs)：绘制水平的bar</span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">bottom：一个标量或者标量的序列，bar的底部的y坐标，默认为 0，采用data坐标系</span></span><br><span class="line"><span class="string">width：一个标量或者标量的序列，bar的宽度，默认为 0.8，采用data坐标系</span></span><br><span class="line"><span class="string">height：一个标量或者标量的序列，bar的高度，采用data坐标系</span></span><br><span class="line"><span class="string">left：一个标量或者标量的序列，bar的左侧的x坐标，采用data坐标系</span></span><br><span class="line"><span class="string">其他参数参考 bar方法</span></span><br><span class="line"><span class="string">它就是bar(orientation=&#x27;horizontal&#x27;)</span></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line">errorbar(x, y, yerr=<span class="literal">None</span>, xerr=<span class="literal">None</span>, fmt=<span class="string">&#x27;&#x27;</span>, ecolor=<span class="literal">None</span>, elinewidth=<span class="literal">None</span>, capsize=<span class="literal">None</span>, </span><br><span class="line">        barsabove=<span class="literal">False</span>, lolims=<span class="literal">False</span>, uplims=<span class="literal">False</span>, xlolims=<span class="literal">False</span>, xuplims=<span class="literal">False</span>, errorevery=<span class="number">1</span>, </span><br><span class="line">        capthick=<span class="literal">None</span>, **kwargs)：绘制errorbar，返回(plotline, caplines, barlinecols)</span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">x：一个序列，指定x坐标</span></span><br><span class="line"><span class="string">y:一个序列，指定y坐标。即： y=f(x)</span></span><br><span class="line"><span class="string">yerr：指定y的error。</span></span><br><span class="line"><span class="string">      如果为标量，则每个点都是相同的error；</span></span><br><span class="line"><span class="string">      如果为一维向量，则依次给出了每个点的error。</span></span><br><span class="line"><span class="string">      如果是个二维向量，则依次给出了每个点的上error和下error</span></span><br><span class="line"><span class="string">xerr：指定x的error。</span></span><br><span class="line"><span class="string">      如果为标量，则每个点都是相同的error；</span></span><br><span class="line"><span class="string">      如果为一维向量，则依次给出了每个点的error。</span></span><br><span class="line"><span class="string">      如果是个二维向量，则依次给出了每个点的左error和右error</span></span><br><span class="line"><span class="string">fmt：可以为空字符串，或者&#x27;none&#x27;或者其他的plot format string。如果是&#x27;none&#x27;则只有errorbars能够被绘制</span></span><br><span class="line"><span class="string">color：点(x, y)的颜色，比如color=black&#x27;&#x27;</span></span><br><span class="line"><span class="string">ecolor：指定了errorbar的颜色，比如ecolor=&#x27;lightgray&#x27;</span></span><br><span class="line"><span class="string">elinewidth：指定了errorbar的线宽</span></span><br><span class="line"><span class="string">capsize：指定了errorbar头部的小横线的宽度</span></span><br><span class="line"><span class="string">errorevery：一个整数。如果为 4， 则每隔 4个点才绘制一个errorbar</span></span><br><span class="line"><span class="string">其他的关键字参数都是用于指定marker的类型。</span></span><br><span class="line"><span class="string">     如： `marker=&#x27;s&#x27;,mfc=&#x27;red&#x27;, mec=&#x27;green&#x27;, ms=20, mew=4。</span></span><br><span class="line"><span class="string">     他们是markderfacecolor,markeredgecolor,markdersize,markderedgewidth的缩写。</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">errorbar是配合散点图使用，分析离散变量的误差性。</span></span><br><span class="line"><span class="string">我的经验是，让误差线的颜色比数据点的颜色浅一点，效果会非常好，尤其在点密集的图形中。</span></span><br><span class="line"><span class="string">比如，plt.errorbar(x, y, yerr=dy, fmt=&#x27;o&#x27;, color=&#x27;black&#x27;,ecolor=&#x27;lightgray&#x27;, elinewidth=3, capsize=0)</span></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line">eventplot(positions, orientation=<span class="string">&#x27;horizontal&#x27;</span>, lineoffsets=<span class="number">1</span>, linelengths=<span class="number">1</span>, </span><br><span class="line">          linewidths=<span class="literal">None</span>, colors=<span class="literal">None</span>, linestyles=<span class="string">&#x27;solid&#x27;</span>, **kwargs) ：绘制时间线。</span><br><span class="line">          时间线就是在指定位置上并排的一系列线段。返回 matplotlib.collections.EventCollection的一个列表</span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">positions：一个一维或者二维的数组。每一行代表了一组直线</span></span><br><span class="line"><span class="string">orientation：可以为&#x27;horizonal&#x27;|&#x27;vertical&#x27;，代表了摆放时间线的方式。</span></span><br><span class="line"><span class="string">             如果是水平走向的，则垂直摆放直线；如果是垂直走向的，则水平放置直线</span></span><br><span class="line"><span class="string">lineoffsets：一个浮点数或者浮点数的序列，指定了时间线中轴距离y=0的偏离值</span></span><br><span class="line"><span class="string">linelengths：一个浮点数或者浮点数的序列，指定了线的长度</span></span><br><span class="line"><span class="string">linewidths：一个浮点数或者浮点数的序列，指定了线的宽度</span></span><br><span class="line"><span class="string">colors：一个颜色或者一组颜色，指定了线的颜色。颜色可以为颜色字符串，或者一个RGB元组。</span></span><br><span class="line"><span class="string">linestyles：一个线型或者一组线型，指定了线型。线型在&#x27;solid&#x27; | &#x27;dashed&#x27; | &#x27;dashdot&#x27; | &#x27;dotted&#x27;四者之一</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">如果positions是一个一维数组，表示绘制一组时间线。</span></span><br><span class="line"><span class="string">    那么lineoffsets/linelengths/linewidths/colors/linestyles都是标量值，指定该组时间线的格式。</span></span><br><span class="line"><span class="string">    如果positions是一个二维数组则，有多少行，就有多少组时间线。</span></span><br><span class="line"><span class="string">        制定时间线格式的这些参数都是序列，序列长度就是positions的行数。</span></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line">fill(*args, **kwargs)：绘制多边形。返回一个Patch列表，plot()支持的颜色字符在这里也被支持。其常用的方式为：</span><br><span class="line">    fill(x,y,<span class="string">&#x27;b&#x27;</span>)：绘制一个多边形。其中x为多边形的边上的点的x坐标；y为多边形的边上的点的y坐标。<span class="string">&#x27;b&#x27;</span>为多边形的填充颜色。</span><br><span class="line">    fill(x1,y1,<span class="string">&#x27;b&#x27;</span>,x2,y2,<span class="string">&#x27;r&#x27;</span>)：绘制多个多边形。这里指定多个x,y,color就可以。</span><br><span class="line"><span class="string">&#x27;&#x27;&#x27; </span></span><br><span class="line"><span class="string">closed：一个布尔值，确定是否封闭多边形（即多一条从起点到终点的边）。默认为True。</span></span><br><span class="line"><span class="string">剩下的关键字参数用于控制Polygon的属性。如</span></span><br><span class="line"><span class="string">    hatch：一个字符串，指定填充方式，如[&#x27;/&#x27; | &#x27;\&#x27; | &#x27;|&#x27; | &#x27;-&#x27; | &#x27;+&#x27; | &#x27;x&#x27; | &#x27;o&#x27; | &#x27;O&#x27; | &#x27;.&#x27; | &#x27;*&#x27;]</span></span><br><span class="line"><span class="string">    label：一个字符串，指定标签</span></span><br><span class="line"><span class="string">    fill：一个布尔值，决定是否填充</span></span><br><span class="line"><span class="string">    facecolor/edgecolor/color：颜色</span></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line">fill_between(x, y1, y2=<span class="number">0</span>, where=<span class="literal">None</span>, interpolate=<span class="literal">False</span>, step=<span class="literal">None</span>, **kwargs)：绘制填充区域。</span><br><span class="line">它填充两个曲线之间的部分。它返回一个PolyCollection对象。</span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">x：一个序列，指定x坐标</span></span><br><span class="line"><span class="string">y1：第一条曲线的纵坐标。如果为标量，说明该曲线为水平线。相当于y轴的连续误差线（下限）。</span></span><br><span class="line"><span class="string">y2：第二条曲线的纵坐标。如果为标量，说明该曲线为水平线。相当于y轴的连续误差线（上限）。</span></span><br><span class="line"><span class="string">where：指定填充哪里。</span></span><br><span class="line"><span class="string">       如果为None，则填充两条曲线之间的所有区域，这是默认值。</span></span><br><span class="line"><span class="string">       如果非None，则他是一个一维布尔数组，长度与x相同。只有为True对应的x处才被填充。</span></span><br><span class="line"><span class="string">interpolate：一个布尔值。如果True，则进行插值计算来寻找两个曲线的交点。如果为False，则不进行插值。</span></span><br><span class="line"><span class="string">step：可以为&#x27;pre&#x27;/&#x27;post&#x27;/&#x27;mid&#x27;或者None，设定填充区域的边界的形状。</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">我的经验是，可以画连续变量误差区间。结合plot绘制连续误差线的上界和下界曲线，并且用颜色填充区间。</span></span><br><span class="line"><span class="string">比如：plt.fill_between(xfit, yfit-dyfit, yfit+dyfit, color=&#x27;gray&#x27;, alpha=&#x27;0.2&#x27;)</span></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line">fill_betweenx(y, x1, x2=<span class="number">0</span>, where=<span class="literal">None</span>, step=<span class="literal">None</span>, **kwargs)：绘制填充区域。</span><br><span class="line">该区域是以y为自变量，x为函数的两条曲线合围而成。它返回一个PolyCollection对象。</span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">y：一个序列，为纵坐标</span></span><br><span class="line"><span class="string">x1：第一个曲线的x坐标。它是一个反函数，即以y为自变量。相当于x轴的连续误差线（下限）。</span></span><br><span class="line"><span class="string">x2：第二个曲线的y坐标。它也是一个反函数。相当于x轴的连续误差线（上限）。</span></span><br><span class="line"><span class="string">where：指定填充哪里。</span></span><br><span class="line"><span class="string">       如果为None，则填充两条曲线之间的所有区域，这是默认值。</span></span><br><span class="line"><span class="string">       如果非None，则他是一个一维布尔数组，长度与y相同。只有为True对应的y处才被填充。</span></span><br><span class="line"><span class="string">step：可以为&#x27;pre&#x27;/&#x27;post&#x27;/&#x27;mid&#x27;或者None，设定填充区域的边界的形状。</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">通常建议提供一个alpha参数，用于设定填充的透明度。</span></span><br><span class="line"><span class="string">如果同一个区域被多个fill_between()填充，那么设定alpha之后会让每一层都能显示出来。</span></span><br><span class="line"><span class="string">fill_between沿着x轴填充；fill_betweenx沿着y轴填充</span></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line">hist(x, bins=<span class="number">10</span>, <span class="built_in">range</span>=<span class="literal">None</span>, normed=<span class="literal">False</span>, weights=<span class="literal">None</span>, cumulative=<span class="literal">False</span>, </span><br><span class="line">    bottom=<span class="literal">None</span>, histtype=<span class="string">&#x27;bar&#x27;</span>, align=<span class="string">&#x27;mid&#x27;</span>, orientation=<span class="string">&#x27;vertical&#x27;</span>, </span><br><span class="line">    rwidth=<span class="literal">None</span>, log=<span class="literal">False</span>, color=<span class="literal">None</span>, label=<span class="literal">None</span>, stacked=<span class="literal">False</span>, **kwargs) ：绘制频次直方图。 其返回值为：</span><br><span class="line">    如果绘制一个直方图，那么就是元组 (n, bins, patches)，n为频数/频率；bins为直方图的各个分界点；patches为每个直方图</span><br><span class="line">    如果绘制多个直方图，那么就是元组 ([n0, n1, ...], bins, [patches0, patches1,...])</span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">x:一个序列或者一维数组，给定了直方图的数据</span></span><br><span class="line"><span class="string">bins：一个整数。返回了bins+1个分界点，将竖着划分成等分的bins份。</span></span><br><span class="line"><span class="string">      你可以传递一个序列，指定分界点，此时可以实现非等分的划分。</span></span><br><span class="line"><span class="string">range：一个元组，给出了数据的上界和下界，在这之外的数据不被考虑。默认就是(x.min(),x.max())</span></span><br><span class="line"><span class="string">normed：布尔值，如果为True，则返回的是数据出现的频率；否则返回的是数据出现的频数</span></span><br><span class="line"><span class="string">weights：长度与x相同的序列，给出了每个数据的权重</span></span><br><span class="line"><span class="string">cumulative  ：布尔值。如果为True，则计算的是累积频率/频数</span></span><br><span class="line"><span class="string">bottom：一个整数或者整数序列或者None，指定了直方图底部的纵坐标。默认为 0</span></span><br><span class="line"><span class="string">histtype：直方图的类型。可以为&#x27;bar&#x27;/&#x27;barstacked&#x27;/&#x27;step&#x27;/&#x27;stepfilled&#x27;</span></span><br><span class="line"><span class="string">align：直方图每个小矩形的对齐方式。可以为&#x27;left&#x27;/&#x27;mid&#x27;/right&#x27;</span></span><br><span class="line"><span class="string">orientation：调整方向。可以为&#x27;horizontal&#x27;/&#x27;vertical&#x27;。如果为水平则，使用barh，同时bottom参数设定的是左侧的横坐标值</span></span><br><span class="line"><span class="string">rwidth：一个标量值，设定了直方图每个矩形的相对于默认值的宽度。如果直方图类型为 step/stepfilled，则忽略该参数。</span></span><br><span class="line"><span class="string">log：布尔值。如果为True：则x轴使用对数坐标</span></span><br><span class="line"><span class="string">color：颜色或者颜色序列，用于给直方图指定颜色</span></span><br><span class="line"><span class="string">label：字符串或者字符串序列。给直方图指定标签</span></span><br><span class="line"><span class="string">stacked：一个布尔值。如果为True，则多个直方图会叠加在一起。</span></span><br><span class="line"><span class="string">其他参数设置了Patch的属性</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">我的经验是，对不同分布特征的样本进行对比时，histtype=‘stepfilled&#x27;和alpha配合效果很好。</span></span><br><span class="line"><span class="string">如果只是分段区间，显示区间数量，不显示图，使用np.histogram(data,bins)更好。</span></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line">hist2d(x, y, bins=<span class="number">10</span>, <span class="built_in">range</span>=<span class="literal">None</span>, normed=<span class="literal">False</span>, </span><br><span class="line">        weights=<span class="literal">None</span>, cmin=<span class="literal">None</span>, cmax=<span class="literal">None</span>, **kwargs)：</span><br><span class="line">        将二维数组按照二维区间进行切分，绘制二维频次直方图。</span><br><span class="line">        其返回值为元组 (counts, xedges, yedges, Image) </span><br><span class="line">        二维频次直方图由与坐标轴的方块分割而成的，用于同一个地方有很多点的情况。  </span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">x:一个序列或者一维数组，给定了x坐标序列</span></span><br><span class="line"><span class="string">y:一个序列或者一维数组，给定了y坐标序列</span></span><br><span class="line"><span class="string">bins：</span></span><br><span class="line"><span class="string">    如果为整数，则给出了两个维度上的区间数量</span></span><br><span class="line"><span class="string">    如果为int,int序列，则分别给出了x区间数量和y区间数量</span></span><br><span class="line"><span class="string">    如果给定了一个一维数组，则给出了 x_edges=y_edges=bins</span></span><br><span class="line"><span class="string">    如果为定了array,array，则分别给出了x_edges,y_edges</span></span><br><span class="line"><span class="string">range：一个(2,2)的数组，给出了数据的上界和下界，在这之外的数据不被考虑。默认就是(x.min(),x.max())</span></span><br><span class="line"><span class="string">normed：布尔值，如果为True，则返回的是数据出现的频率；否则返回的是数据出现的频数</span></span><br><span class="line"><span class="string">weights：长度与x相同的序列，给出了每个数据的权重</span></span><br><span class="line"><span class="string">cmin：一个标量值。那些count值小于cmin的单元不被显示。同时返回的结果中，这些单元返回nan</span></span><br><span class="line"><span class="string">cmax：一个标量值。那些count值大于cmax的单元不被显示。同时返回的结果中，这些单元返回nan</span></span><br><span class="line"><span class="string">其他参数设置了pcolorfast()属性</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">如果只是分段区间，显示区间数量，不显示图，使用np.histogram2ds(x, y, bins)更好。</span></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line">hexbin(x, y, C=<span class="literal">None</span>, gridsize=<span class="number">100</span>, bins=<span class="literal">None</span>, xscale=<span class="string">&#x27;linear&#x27;</span>, yscale=<span class="string">&#x27;linear&#x27;</span>, </span><br><span class="line">    extent=<span class="literal">None</span>, cmap=<span class="literal">None</span>, norm=<span class="literal">None</span>, vmin=<span class="literal">None</span>, vmax=<span class="literal">None</span>, alpha=<span class="literal">None</span>, </span><br><span class="line">    linewidths=<span class="literal">None</span>, edgecolors=<span class="string">&#x27;none&#x27;</span>, reduce_C_function=&lt;function mean&gt;, </span><br><span class="line">    mincnt=<span class="literal">None</span>, marginals=<span class="literal">False</span>, **kwargs)：</span><br><span class="line">    同hist2d，绘制二维频次直方图。不同的是六边形面元划分。返回一个PolyCollection对象。</span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">x/y：一维数组，它们形状相同。它们给出了绘制六边形面元的点。</span></span><br><span class="line"><span class="string">C：如果非None，则它给出了坐标(x[i],y[i])的count value。它和x长度相同，也是一维数组</span></span><br><span class="line"><span class="string">   x/y/C也可能是masked array，此时只有unmasked的点才被绘制</span></span><br><span class="line"><span class="string">reduce_C_function：将坐标(x[i],y[i])的count value进行归并。</span></span><br><span class="line"><span class="string">                   因为同一个坐标可能被设定了多个count value。而每个点根据其count value来染色</span></span><br><span class="line"><span class="string">gridsize：一个整数。它调整了六边形面元x方向的尺寸，y方向的尺寸自动选取。</span></span><br><span class="line"><span class="string">         你也可以设定它为一个元组，同时调整x/y方向的尺寸。</span></span><br><span class="line"><span class="string">         它实际上给出的是x轴可以放置的面元数量，因此该数值越大，六边形面元尺寸越小。</span></span><br><span class="line"><span class="string">bins：</span></span><br><span class="line"><span class="string">    如果为None，则每个六边形面元的颜色值直接对应了它的count value</span></span><br><span class="line"><span class="string">    如果为&#x27;log&#x27;，则每个六边形面元的颜色值对应了它的count value+1的对数值</span></span><br><span class="line"><span class="string">    如果为一个整数，将counts划分为指定数量的箱，并相应地为六边形上色</span></span><br><span class="line"><span class="string">    如果为一个整数序列，则使用箱边界的下限值</span></span><br><span class="line"><span class="string">xscale：可以为&#x27;linear&#x27;/&#x27;log&#x27;，设置了x轴是线性还是对数</span></span><br><span class="line"><span class="string">scale：可以为&#x27;linear&#x27;/&#x27;log&#x27;，设置了y轴是线性还是对数</span></span><br><span class="line"><span class="string">mincnt：一个整数或者None。它指定显示这一类的面元：面元包含的坐标点的数量超过mincnt。</span></span><br><span class="line"><span class="string">        对于面元包含坐标点数量少于mincnt的，不显示。</span></span><br><span class="line"><span class="string">marginals：一个布尔值。如果为True，则沿着坐标轴绘制密度条。</span></span><br><span class="line"><span class="string">extent：一个元组(left, right, bottom, top)，等价于同时使用了set_xlim(left,right)+set_ylim(bottom,top)。</span></span><br><span class="line"><span class="string">剩下的参数设定颜色和面元的属性。</span></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line">contour(*args, **kwargs)：绘制等高线。它返回一个QuadContourSet对象 最常用的四种方式：</span><br><span class="line">    contour(Z)：其中Z为二维数组。数据坐标系下的坐标点(i,j)对应了Z[j,i]（x轴对应列，y轴对应行）。</span><br><span class="line">                该方法随机挑选一些等高线绘制。</span><br><span class="line">    contour(X,Y,Z)：其中 X/Y/Z均为二维数组，且形状相同。对应位置的横坐标由X提供，纵坐标由Y提供，值由Z提供。</span><br><span class="line">                    X和Y也可以同时是一维数组，且<span class="built_in">len</span>(X)是Z的列数，<span class="built_in">len</span>(Y)是Z的行数。</span><br><span class="line">                    该方法随机挑选一些等高线绘制。</span><br><span class="line">    contour(Z,N)/contour(X,Y,Z,N)：N为一个整数，表示绘制N条等高线。该方法随机挑选N条等高线绘制。</span><br><span class="line">    contour(Z,V)/contour(X,Y,Z,V)：V为一个递增的序列，表示绘制那些值位于V中的等高线</span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">colors：如果为None，则由cmap给出。如果是一个字符串，这所有的等高线由字符串指定的颜色给出。</span></span><br><span class="line"><span class="string">        如果是一个序列，该序列中每个都代表了一个颜色，则等高线的颜色依次由该序列给出。</span></span><br><span class="line"><span class="string">cmap：一个Colormap对象。如果为None，则默认的Colormap将被使用</span></span><br><span class="line"><span class="string">levels：一个序列（升序排列）。指定了要绘制等高线值位于levels的等高线。</span></span><br><span class="line"><span class="string">origin：可以为&#x27;upper&#x27;/&#x27;lower&#x27;。图片的第一个像素X[0,0]放置在坐标原点。默认是左上。</span></span><br><span class="line"><span class="string">        &#x27;upper&#x27;：横坐标向右，纵坐标向下</span></span><br><span class="line"><span class="string">        &#x27;lower&#x27;：横坐标向右，纵坐标向上</span></span><br><span class="line"><span class="string">extent：它是一个元组(x0,x1,y0,y1)。如果给出了(X,Y)，则该参数无效。如果未给出(X,Y)：</span></span><br><span class="line"><span class="string">        如果origin非None，则它给出了外边界， Z[0,0]位于图形中间</span></span><br><span class="line"><span class="string">        如果origin为None，则(x0,y0)对应Z[0,0]；(x1,y1)对应Z[-1.-1]，</span></span><br><span class="line"><span class="string">            等价于同时使用了set_xlim(left,right) + set_ylim(bottom,top)</span></span><br><span class="line"><span class="string">antialiased：一个布尔值，用于开启/关闭反走样</span></span><br><span class="line"><span class="string">linewidths：如果为None，则使用默认值。如果为一个整数，则所有的等高线都是用该线宽。</span></span><br><span class="line"><span class="string">            如果为一个整数序列，则等高线依次使用它指定的线宽。只有contour适用</span></span><br><span class="line"><span class="string">linestyles：如果为None，则使用默认的实线。你也可以指定为&#x27;solid&#x27;/&#x27;dashed&#x27;/&#x27;dashdot&#x27;/&#x27;dotted&#x27;。</span></span><br><span class="line"><span class="string">            你可以指定搜有的等高线使用一种线型，也可以使用一个线型序列。只有contour适用</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">所有使用cmap调色盘的，都可以plt.colorbar()显示颜色条。</span></span><br><span class="line"><span class="string">我的经验是，contour方法等高线图单一，可以进一步使用contourf方法在等高线间进行颜色填充，区分度更高。</span></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line">contourf(*args, **kwargs)：它绘制的是带填充的等高线。其参数和用法基本和contour相同。它返回一个QuadContourSet对象。</span><br><span class="line">    contourf(Z,V)：</span><br><span class="line">    contourf(X,Y,Z,V)：</span><br><span class="line">    V是递增的序列，指定了等高线的值。该方法会填充V中相邻两个等高线之间的区域。</span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">hatches：它指定了填充区域的填充类型（如以小斜线填充）。</span></span><br><span class="line"><span class="string">         如果为None，则无任何hatch。它典型值为hatches=[&#x27;.&#x27;, &#x27;/&#x27;, &#x27;\&#x27;, None, &#x27;\\&#x27;, &#x27;*&#x27;,&#x27;-&#x27;,]</span></span><br><span class="line"><span class="string">contourf填充的是半开半闭区间(z1,z2]</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">我的经验是，contourf进一步提高了等高线图的显示效果，但区分度强，看上去像是一块块斑渍，可用imshow渲染成渐变图。</span></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line">imshow(X, cmap=<span class="literal">None</span>, norm=<span class="literal">None</span>, aspect=<span class="literal">None</span>, interpolation=<span class="literal">None</span>, </span><br><span class="line">        alpha=<span class="literal">None</span>, vmin=<span class="literal">None</span>, vmax=<span class="literal">None</span>, origin=<span class="literal">None</span>, extent=<span class="literal">None</span>, </span><br><span class="line">        shape=<span class="literal">None</span>, filternorm=<span class="number">1</span>, filterrad=<span class="number">4.0</span>, imlim=<span class="literal">None</span>, </span><br><span class="line">        resample=<span class="literal">None</span>, url=<span class="literal">None</span>, **kwargs)：绘制色彩图片。返回一个AxesImage对象</span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">X：包含了图片的数据。其形状可以为：</span></span><br><span class="line"><span class="string">   (n,m)（灰度图），类型为float</span></span><br><span class="line"><span class="string">   (n,m,3)（RGB图），类型为float（此时每个元素的值都在 0 和 1.0 之间），或者unit8</span></span><br><span class="line"><span class="string">   (n,m,4)（RGBA图），类型为float（此时每个元素的值都在 0 和 1.0 之间），或者unit8</span></span><br><span class="line"><span class="string">cmap：一个Colormap实例。默认由rc的image.cmap指定。如果X是RGB/RGBA，则忽略该参数</span></span><br><span class="line"><span class="string">aspect：一个字符串，指定图片的缩放。可以为：</span></span><br><span class="line"><span class="string">        &#x27;auto&#x27;：缩放图片的宽高比，是的它匹配axes</span></span><br><span class="line"><span class="string">        &#x27;equal&#x27;：当extent参数为None时，修改axes的宽高比，使得它匹配图片；</span></span><br><span class="line"><span class="string">                 如果extent参数不是None，则修改axes的宽高比来匹配extent</span></span><br><span class="line"><span class="string">        None：默认由rc的image.aspect指定</span></span><br><span class="line"><span class="string">interpolation：一个字符串，指定插值方式。</span></span><br><span class="line"><span class="string">              可以为&#x27;none&#x27;, &#x27;nearest&#x27;, &#x27;bilinear&#x27;, &#x27;bicubic&#x27;, &#x27;spline16&#x27;, &#x27;spline36&#x27;, &#x27;hanning&#x27;, </span></span><br><span class="line"><span class="string">              &#x27;hamming&#x27;, &#x27;hermite&#x27;, &#x27;kaiser&#x27;, &#x27;quadric&#x27;, &#x27;catrom&#x27;, &#x27;gaussian&#x27;,</span></span><br><span class="line"><span class="string">              &#x27;bessel&#x27;, &#x27;mitchell&#x27;, &#x27;sinc&#x27;, &#x27;lanczos&#x27;</span></span><br><span class="line"><span class="string">norm：一个Normalize实例，用于将图片亮度正则化到 0~1。如果为None，则采用normalize.norm</span></span><br><span class="line"><span class="string">vmin/vmax：用于辅助norm进行正则化。如果你传入了一个norm实例，则该参数忽略</span></span><br><span class="line"><span class="string">alpha：浮点数，指定透明度</span></span><br><span class="line"><span class="string">origin：&#x27;upper&#x27;/&#x27;lower&#x27;。图片的第一个像素X[0,0]放置在坐标原点，默认左上角。</span></span><br><span class="line"><span class="string">        &#x27;upper&#x27;：横坐标向右，纵坐标向下</span></span><br><span class="line"><span class="string">        &#x27;lower&#x27;：横坐标向右，纵坐标向上。正常方向，建议用此参数。</span></span><br><span class="line"><span class="string">extent：一个元组(left, right, bottom, top)，等价于set_xlim(left,right)+set_ylim(bottom,top)</span></span><br><span class="line"><span class="string">shape：一个元组(column,rows)，用于rar buffer image</span></span><br><span class="line"><span class="string">filternorm/filterrad：用于过滤</span></span><br><span class="line"><span class="string">其他参数用于调整 Artist属性</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">我的经验是：</span></span><br><span class="line"><span class="string">imshow不支持x轴、y轴设置网格，而是通过extent设置图形坐标范围。</span></span><br><span class="line"><span class="string">imshow会自动调整坐标轴的精度以适应数据显示。可通过plt.axis(aspect=&#x27;image&#x27;)来设置x轴与y轴的单位。</span></span><br><span class="line"><span class="string">等高线图+色彩图，使用alpha设置透明度，用plt.clabel()函数与另一幅坐标轴相同、带数据标签的等高线图叠放在一起，效果更好:</span></span><br><span class="line"><span class="string">    contours = plt.contour(X, Y, Z, 3, colors=&#x27;black&#x27;)</span></span><br><span class="line"><span class="string">    plt.clabel(contours, inline=True, fontsize=8) # 叠放</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">    plt.imshow(Z, extent=[0, 5, 0, 5], origin=&#x27;lower&#x27;,cmap=&#x27;RdGy&#x27;, alpha=0.5)</span></span><br><span class="line"><span class="string">    plt.colorbar()</span></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line">matshow(Z, **kwargs)：将一个矩阵绘制成图片。</span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">Z：一个形状为(n,m)的数组</span></span><br><span class="line"><span class="string">其他参数见imshow</span></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line">Legend(*args, **kwargs)：创建图例。</span><br><span class="line">ax.legend((line1,line2),(<span class="string">&#x27;label1&#x27;</span>,<span class="string">&#x27;label2&#x27;</span>))：</span><br><span class="line">    输入lines列表，lines标签名列表。</span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">loc：指定了图例的位置。可以为整数、字符串：</span></span><br><span class="line"><span class="string">     对应于整数的0~10。也可以指定坐标(x,y)，其中(0,0)是左下角，(1,1)是右上角</span></span><br><span class="line"><span class="string">     &#x27;best&#x27;/&#x27;upper right&#x27;/&#x27;upper left&#x27;</span></span><br><span class="line"><span class="string">     /&#x27;lower left&#x27;/&#x27;lower right&#x27;/&#x27;right&#x27;/&#x27;center left&#x27;/</span></span><br><span class="line"><span class="string">     &#x27;center right&#x27;/&#x27;lower center&#x27;/&#x27;upper center&#x27;/&#x27;center&#x27;，</span></span><br><span class="line"><span class="string">ncol：一个整数，指定图例中有几列，默认为 1列</span></span><br><span class="line"><span class="string">prop：一个字典，或者FontProperties实例，可以指定图例中的字体属性。</span></span><br><span class="line"><span class="string">fontsize：控制字体大小，可以为整数、浮点数（指定字体绝对大小），或者字符串:</span></span><br><span class="line"><span class="string">         &#x27;xx-small&#x27;, &#x27;x-small&#x27;, &#x27;small&#x27;, &#x27;medium&#x27;, &#x27;large&#x27;, &#x27;x-large&#x27;, &#x27;xx-large&#x27;</span></span><br><span class="line"><span class="string">numpoint/scatterpoints：图例上每个图例线的点数</span></span><br><span class="line"><span class="string">fancybox：如果为True，图例的边框采用圆角矩形</span></span><br><span class="line"><span class="string">framealpha：一个浮点数，从0到1，外边框的透明度</span></span><br><span class="line"><span class="string">frameon：如果为True，则绘制图例的背景框。否则不绘制</span></span><br><span class="line"><span class="string">shadow：如果为True，图例添加背影</span></span><br><span class="line"><span class="string">ncol：标签列数</span></span><br><span class="line"><span class="string">title：图例的标题</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">图例显示：</span></span><br><span class="line"><span class="string">（1）plt.plot(x, y)返回lines实例列表，然后直接调用ax.legend()即可。</span></span><br><span class="line"><span class="string">（2）单个创建line，然后调用line.set_label()，然后调用ax.legend()。</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">默认会不显示无标签的line。</span></span><br><span class="line"><span class="string">如果你想显示部分line，那么只需把想显示的line添加标签即可。</span></span><br><span class="line"><span class="string">如果你想显示全部line + 显示部分图例，那么需绘制两幅图：</span></span><br><span class="line"><span class="string">    第一幅不添加标签（显示全部line）；</span></span><br><span class="line"><span class="string">    第二幅line数据为空，图例数据（比如图形大小,颜色等）添加标签。</span></span><br><span class="line"><span class="string">&#x27;&#x27;</span></span><br><span class="line"><span class="string">import pandas as pd</span></span><br><span class="line"><span class="string">cities = pd.read_csv(&#x27;data/california_cities.csv&#x27;)</span></span><br><span class="line"><span class="string"># 提取感兴趣的数据</span></span><br><span class="line"><span class="string">lat, lon = cities[&#x27;latd&#x27;], cities[&#x27;longd&#x27;]</span></span><br><span class="line"><span class="string">population, area = cities[&#x27;population_total&#x27;], cities[&#x27;area_total_km2&#x27;]</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string"># 用不同尺寸和颜色的散点图表示数据，但是不带标签</span></span><br><span class="line"><span class="string">plt.scatter(lon, lat, label=None, c=np.log10(population), cmap=&#x27;viridis&#x27;,</span></span><br><span class="line"><span class="string">            s=area, linewidth=0, alpha=0.5)</span></span><br><span class="line"><span class="string">plt.axis(aspect=&#x27;equal&#x27;)</span></span><br><span class="line"><span class="string">plt.xlabel(&#x27;longitude&#x27;)</span></span><br><span class="line"><span class="string">plt.ylabel(&#x27;latitude&#x27;)</span></span><br><span class="line"><span class="string">plt.colorbar(label=&#x27;log$_&#123;10&#125;$(population)&#x27;)</span></span><br><span class="line"><span class="string">plt.clim(3, 7)</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string"># 下面创建一个图例：</span></span><br><span class="line"><span class="string"># 画一些带标签和尺寸的空列表，尺寸代表面积</span></span><br><span class="line"><span class="string">for area in [100, 300, 500]:</span></span><br><span class="line"><span class="string">    plt.scatter([], [], c=&#x27;k&#x27;, alpha=0.3, s=area, label=str(area) + &#x27; km$^2$&#x27;)</span></span><br><span class="line"><span class="string">plt.legend(scatterpoints=1, frameon=False, labelspacing=1, title=&#x27;City Area&#x27;)</span></span><br><span class="line"><span class="string">plt.title(&#x27;California Cities: Area and Population&#x27;)</span></span><br><span class="line"><span class="string">&#x27;&#x27;</span></span><br><span class="line"><span class="string">如果你想显示多个图例，可以通过Legend()创建一个新的legend artist，然后用底层的ax.add_artist()方法在图上添加第二个图例:</span></span><br><span class="line"><span class="string">&#x27;&#x27;</span></span><br><span class="line"><span class="string">fig, ax = plt.subplots()</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">lines = []</span></span><br><span class="line"><span class="string">styles = [&#x27;-&#x27;, &#x27;--&#x27;, &#x27;-.&#x27;, &#x27;:&#x27;]</span></span><br><span class="line"><span class="string">x = np.linspace(0, 10, 1000)</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">for i in range(4):</span></span><br><span class="line"><span class="string">    lines += ax.plot(x, np.sin(x - i * np.pi / 2), styles[i], color=&#x27;black&#x27;)</span></span><br><span class="line"><span class="string">ax.axis(&#x27;equal&#x27;)</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string"># 设置第一个图例要显示的线条和标签</span></span><br><span class="line"><span class="string">ax.legend(lines[:2], [&#x27;line A&#x27;, &#x27;line B&#x27;], loc=&#x27;upper right&#x27;, frameon=False)</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string"># 创建第二个图例，通过add_artist方法添加到图上</span></span><br><span class="line"><span class="string">from matplotlib.legend import Legend</span></span><br><span class="line"><span class="string">leg = Legend(ax, lines[2:], [&#x27;line C&#x27;, &#x27;line D&#x27;], loc=&#x27;lower right&#x27;, frameon=False)</span></span><br><span class="line"><span class="string">ax.add_artist(leg)</span></span><br><span class="line"><span class="string">&#x27;&#x27;</span></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line">pie(x, explode=<span class="literal">None</span>, labels=<span class="literal">None</span>, colors=<span class="literal">None</span>, autopct=<span class="literal">None</span>, pctdistance=<span class="number">0.6</span>, </span><br><span class="line">    shadow=<span class="literal">False</span>, labeldistance=<span class="number">1.1</span>, startangle=<span class="literal">None</span>, radius=<span class="literal">None</span>, counterclock=<span class="literal">True</span>,</span><br><span class="line">    wedgeprops=<span class="literal">None</span>, textprops=<span class="literal">None</span>, center=(<span class="number">0</span>, <span class="number">0</span>), frame=<span class="literal">False</span>)：绘制饼状图。</span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">x：数据序列。每一块饼的权重为x/sum(x)；如果sum(x)&lt;=1，则x已经代表了每一块饼的权重，</span></span><br><span class="line"><span class="string">             此时并不会除以sum(x)。饼状图从x轴开始，逆时针绘制。</span></span><br><span class="line"><span class="string">explode：如果不是None，则它给出了每个饼的径向偏移量。该偏移量表示：径向偏移除以半径。</span></span><br><span class="line"><span class="string">colors：给出了每一块饼的颜色。可以为None或者颜色序列</span></span><br><span class="line"><span class="string">labels：给出了每个饼的字符串标签。可以为None或者字符串序列</span></span><br><span class="line"><span class="string">autopct：它可以为一个字符串，可以指定每个饼的数值标签，但是该字符串是 fmt%pct，</span></span><br><span class="line"><span class="string">         通过pct参数格式化，pct为饼的比重（自动提供）。也可以是一个可调用对象。</span></span><br><span class="line"><span class="string">pctdistance：若autopct为None，则忽略之。否则就是数值标签的径向距离，它是个相对距离，相对于半径。</span></span><br><span class="line"><span class="string">labeldistance：控制了饼的字符串标签的径向距离，它是个相对距离，相对于半径。</span></span><br><span class="line"><span class="string">shadow：一个布尔值，如果为True，则绘制带阴影的饼状图</span></span><br><span class="line"><span class="string">startangle：如果不是None，则它可控制了第一块饼与x轴的夹角</span></span><br><span class="line"><span class="string">radius：一个标量，控制了饼状图的半径。如果为None，则默认为 1</span></span><br><span class="line"><span class="string">counterclock：一个布尔值。如果为True，则为逆时针方向；否则为顺时针排列</span></span><br><span class="line"><span class="string">wedgeprops：一个字典，控制了每一块饼的某些属性，如线型</span></span><br><span class="line"><span class="string">textprops：一个字典，控制了饼的文字的一些属性</span></span><br><span class="line"><span class="string">center：一个二元的元组，指定了饼状图的中心</span></span><br><span class="line"><span class="string">frame：一个布尔值，控制是否绘制axes frame（也就是背后的数轴）。发现版本1.5.3中，开启它是个Bug，图形混乱。</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">为了显示好看，建议使用ax.set_aspect(1)将Axes的长宽比设置为 1， 此时的饼状图是个圆形（否则为椭圆）。</span></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line">plot(*args, **kwargs)：绘制line或者marker。他返回line的列表。</span><br><span class="line">    plot(x,y)：最简单的用法，其中x为数据点的横坐标，y为数据点的纵坐标。</span><br><span class="line">               此时采用默认的线型和颜色。如果x/y为二维数组，那么每一行作为一组line来绘制。</span><br><span class="line">    plot(x,y,<span class="string">&#x27;bo&#x27;</span>)：可设置线型和颜色。<span class="string">&#x27;b&#x27;</span>代表颜色为蓝色，<span class="string">&#x27;o&#x27;</span>代表使用小圆圈标记数据点。<span class="string">&#x27;bo&#x27;</span>称作plot <span class="built_in">format</span> string</span><br><span class="line">    plot(y)：可省略x。此时隐含着x等于[<span class="number">0</span>,<span class="number">1</span>,...<span class="built_in">len</span>(y-<span class="number">1</span>)]</span><br><span class="line">    plot(x1,y1,<span class="string">&#x27;b+&#x27;</span>,x2,y2,<span class="string">&#x27;b-&#x27;</span>,x3,y3,<span class="string">&#x27;bo&#x27;</span>)：可一次绘制多条线</span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">linestyle:&#x27;-&#x27;或者&#x27;solid&#x27;：表示实线</span></span><br><span class="line"><span class="string">          &#x27;--&#x27;或者dashed：表示虚线</span></span><br><span class="line"><span class="string">          &#x27;-.&#x27;或者dash_dot：表示点划线</span></span><br><span class="line"><span class="string">          &#x27;:&#x27;或者&#x27;dotted&#x27;：表示点线</span></span><br><span class="line"><span class="string">marker：&#x27;.&#x27;/&#x27;,&#x27;/&#x27;o&#x27;/&#x27;v&#x27;/&#x27;^&#x27;/&#x27;&lt;&#x27;/&#x27;&gt;&#x27;/&#x27;1&#x27;/&#x27;2&#x27;/&#x27;3&#x27;/&#x27;4&#x27;/</span></span><br><span class="line"><span class="string">        &#x27;s&#x27;/&#x27;p&#x27;/&#x27;*&#x27;/&#x27;h&#x27;/&#x27;H&#x27;/&#x27;+&#x27;/&#x27;x&#x27;/&#x27;D&#x27;/&#x27;d&#x27;/&#x27;|&#x27;/&#x27;_&#x27;</span></span><br><span class="line"><span class="string">color：&#x27;b&#x27;/&#x27;g&#x27;/&#x27;r&#x27;/&#x27;c&#x27;/&#x27;m&#x27;/&#x27;y&#x27;/&#x27;k&#x27;/&#x27;w&#x27;；</span></span><br><span class="line"><span class="string">        全名：&#x27;red&#x27;；</span></span><br><span class="line"><span class="string">        十六进制字符串：&#x27;#00ff00；</span></span><br><span class="line"><span class="string">        一个RGB/RGBA元组：(0,1,0)/(0,1,0,1)。</span></span><br><span class="line"><span class="string">默认情况下，不同的线采用不同的线型，它由rc的axes.prop_cycle参数控制，并且是循环使用。</span></span><br><span class="line"><span class="string">如果一个plot绘制了多条线，则其参数对所有的线起作用。这些关键字全部用于设定Line2D的属性。</span></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line">plot_date(x, y, fmt=<span class="string">&#x27;o&#x27;</span>, tz=<span class="literal">None</span>, xdate=<span class="literal">True</span>, ydate=<span class="literal">False</span>, **kwargs)：绘制日期相关的数据。</span><br><span class="line">它类似于plot()方法，但是plot_data的x轴或者y轴可能是日期相关的数据。</span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">x/y：待绘制的点的坐标序列。如果是日期序列，则代表了从0001-01-01 UTC以来的天数（浮点数）（它映射到整数1）。</span></span><br><span class="line"><span class="string">     日期必须大于等于 0（1代表第一天），且日期跨度大于一个月（31天）</span></span><br><span class="line"><span class="string">fmt：plot format string，如bo</span></span><br><span class="line"><span class="string">tz：指定时区。可以为时区字符串，也可以为tzinfo实例或者None</span></span><br><span class="line"><span class="string">xdate：一个布尔值。如果为True，则x轴为时间序列</span></span><br><span class="line"><span class="string">ydate：一个布尔值。如果为True，则y轴为时间序列</span></span><br><span class="line"><span class="string">其他参数用于设定Line2D的属性</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">注意：plot_date()使用默认的dates.AutoDateLocator/dates.AutoDateFormatter。</span></span><br><span class="line"><span class="string">     如果你希望使用自定义的，则你需要在调用plot_date()之后调用方法来设置date ticker/date formatter</span></span><br><span class="line"><span class="string">设置时区：</span></span><br><span class="line"><span class="string">    from datetime import timezone,timedelta</span></span><br><span class="line"><span class="string">    ax.plot_date(X,Y,tz=timezone(+timedelta(hours=23)))   </span></span><br><span class="line"><span class="string">设置日期格式化和位置：</span></span><br><span class="line"><span class="string">    from matplotlib.dates import AutoDateLocator,AutoDateFormatter,DateFormatter</span></span><br><span class="line"><span class="string">    autoloc = AutoDateLocator() #默认的 formatter</span></span><br><span class="line"><span class="string">    autofmt = AutoDateFormatter() #默认的 locator</span></span><br><span class="line"><span class="string">    myfmt = DateFormatter(&#x27;%Y-%m-%d %H:%M:%S&#x27;)#自定义的formatter,使用`strftime()`的格式化方式</span></span><br><span class="line"><span class="string">    ax.xaxis.set_major_locator(autodates)       #设置时间间隔</span></span><br><span class="line"><span class="string">    ax.xaxis.set_major_formatter(myfmt)      #设置时间显示格式</span></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line">scatter(x, y, s=<span class="number">20</span>, c=<span class="literal">None</span>, marker=<span class="string">&#x27;o&#x27;</span>, cmap=<span class="literal">None</span>, norm=<span class="literal">None</span>, vmin=<span class="literal">None</span>, vmax=<span class="literal">None</span>, </span><br><span class="line">        alpha=<span class="literal">None</span>, linewidths=<span class="literal">None</span>, verts=<span class="literal">None</span>, edgecolors=<span class="literal">None</span>, **kwargs)：</span><br><span class="line">        绘制散点图。返回一个PathCollection实例。</span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">x/y：数据的x坐标和y坐标，要求它们形状为(n,)</span></span><br><span class="line"><span class="string">s:指定散点的尺寸，可以为标量，也可以为一个长度为n的序列（序列配合c和cmap使用，c也必须为序列）</span></span><br><span class="line"><span class="string">c：指定散点的颜色字符。可以为一个颜色，或者颜色序列（序列配合cmap使用）</span></span><br><span class="line"><span class="string">marker：指定散点的类型，默认为&#x27;o&#x27;。可以为：</span></span><br><span class="line"><span class="string">        &#x27;.&#x27;,&#x27;,&#x27;,&#x27;o&#x27;,&#x27;v&#x27;,&#x27;^&#x27;,&#x27;&lt;&#x27;,&#x27;&gt;&#x27;,&#x27;1&#x27;,&#x27;2&#x27;,&#x27;3&#x27;,&#x27;4&#x27;,&#x27;s&#x27;,&#x27;p&#x27;,</span></span><br><span class="line"><span class="string">       &#x27;*&#x27;,&#x27;h&#x27;,&#x27;H&#x27;,&#x27;+&#x27;,&#x27;x&#x27;,&#x27;D&#x27;,&#x27;d&#x27;,&#x27;|&#x27;,&#x27;_&#x27;,&#x27;None&#x27;,None,&#x27; &#x27;,&#x27;&#x27;,&#x27;$...$&#x27;之一。</span></span><br><span class="line"><span class="string">       也可以为一个Path实例。也可以是一个元组(numsided,style,angle)：</span></span><br><span class="line"><span class="string">            numsided指定了边的数量</span></span><br><span class="line"><span class="string">            style：可以为0(正多边形）；1（星星状的符号）；2（一个*）;3（一个圆，此时numsided,angle被忽略）</span></span><br><span class="line"><span class="string">            angle：指定了散点旋转的角度（按照角度制而不是弧度制）</span></span><br><span class="line"><span class="string">cmap：设定一个colormap。可以是Colormap实例，或者它的名字。只有当c参数为一列浮点数时有效！</span></span><br><span class="line"><span class="string">norm：一个Normalize实例，用于将亮度调整到0~1</span></span><br><span class="line"><span class="string">vmin,vmax：一个标量，用于辅助默认的norm调整亮度（如果你传入了一个Normalize实例给norm，则该参数忽略）</span></span><br><span class="line"><span class="string">alpha：一个标量，设置透明度</span></span><br><span class="line"><span class="string">linewidths：一个标量或者序列，设置线宽</span></span><br><span class="line"><span class="string">edgecolors：设定边线的颜色，可以为一个颜色，或者颜色序列</span></span><br><span class="line"><span class="string">其他参数用于设定Collection参数</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">我的经验是，数据密集的图形，使用plot绘制散点图效率会更高。</span></span><br><span class="line"><span class="string">因为plot的配置适用于所有点，而scatter对每个点都要渲染一遍。</span></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line">xcorr(x, y, normed=<span class="literal">True</span>, detrend=&lt;function detrend_none&gt;, </span><br><span class="line">     usevlines=<span class="literal">True</span>, maxlags=<span class="number">10</span>, **kwargs)：绘制互相关图。参数解释参考acorr()自相关函数。</span><br></pre></td></tr></table></figure></p>
<h2 id="axis">Axis</h2>
<p>matplotlib.axis.Axis实例处理tick line、grid line、tick label以及axis
label的绘制，它包括坐标轴上的刻度线、刻度label、坐标网格、坐标轴标题。<br />
通常你可以独立的配置y轴的左边刻度以及右边的刻度，也可以独立地配置x轴的上边刻度以及下边的刻度。刻度包括主刻度和次刻度，它们都是Tick刻度对象。</p>
<p>Axis也存储了数据用于内部的缩放以及自适应处理。它还有Locator实例和Formatter实例用于控制刻度线的位置以及刻度label。</p>
<p>每个Axis都有一个.label属性，也有主刻度列表和次刻度列表。这些tick是XTick和YTick的实例，他们存放着实际的line
primitive以及text primitive来渲染刻度线以及刻度文本。</p>
<p>Axis也提供了一些辅助方法来获取刻度文本、刻度线位置等方法，更多方法请参考<span class="exturl" data-url="aHR0cHM6Ly9tYXRwbG90bGliLm9yZy9zdGFibGUvYXBpL2F4aXNfYXBpLmh0bWw/aGlnaGxpZ2h0PXhheGlzI21hdHBsb3RsaWIuYXhpcy5YQXhpcw==">axis<i class="fa fa-external-link-alt"></i></span>：<br />
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line">Axis.get_major_ticks()：获取主刻度列表(一个Tick对象的列表)</span><br><span class="line"></span><br><span class="line">Axis.get_minor_ticks()：获取次刻度列表(一个Tick对象的列表)</span><br><span class="line"></span><br><span class="line">Axis.get_majorticklabels()：获取主刻度label列表(一个Text对象的列表)</span><br><span class="line"></span><br><span class="line">Axis.get_majorticklines():获取主刻度线(一个Line2D对象的列表)</span><br><span class="line"></span><br><span class="line">Axis.get_ticklocs()：获取刻度线位置的列表。可通过minor=<span class="literal">True</span>|<span class="literal">False</span>控制输出minor还是major的tick location。</span><br><span class="line"></span><br><span class="line">Axis.get_ticklabels()：获取刻度label列表(一个Text实例的列表）。可通过minor=<span class="literal">True</span>|<span class="literal">False</span>控制输出minor还是major的tick label。</span><br><span class="line"></span><br><span class="line">Axis.get_ticklines()：获取刻度线列表(一个Line2D实例的列表）。可通过minor=<span class="literal">True</span>|<span class="literal">False</span>控制输出minor还是major的tick line。</span><br><span class="line"></span><br><span class="line">Axis.get_scale()：获取坐标轴的缩放属性，如<span class="string">&#x27;log&#x27;</span>或者<span class="string">&#x27;linear&#x27;</span></span><br><span class="line"></span><br><span class="line">Axis.get_view_interval():获取内部的axis view limits实例</span><br><span class="line"></span><br><span class="line">Axis.get_data_interval():获取内部的axis data limits实例</span><br><span class="line"></span><br><span class="line">Axis.get_gridlines():获取grid line的列表</span><br><span class="line"></span><br><span class="line">Axis.get_label():获取axis label(一个Text实例)</span><br><span class="line"></span><br><span class="line">Axis.get_label_text():获取axis label的字符串</span><br><span class="line"></span><br><span class="line">Axis.get_major_locator():获取major tick locator(一个matplotlib.ticker.Locator实例)</span><br><span class="line"></span><br><span class="line">Axis.get_minor_locator():获取minor tick locator(一个matplotlib.ticker.Locator实例)</span><br><span class="line"></span><br><span class="line">Axis.get_major_formatter():获取major tick formatter(一个matplotlib.ticker.Formatter实例)</span><br><span class="line"></span><br><span class="line">Axis.get_minor_formatter():获取minor tick formatter(一个matplotlib.ticker.Formatter实例)</span><br><span class="line"></span><br><span class="line">Axis.grid(b=<span class="literal">None</span>,which=<span class="string">&#x27;major&#x27;</span>,**kwargs):一个开关，用于控制major或者minor的tick的on|off</span><br><span class="line"></span><br><span class="line">Axis.cla()：清除axis</span><br><span class="line">Axis.axis_date(tz=<span class="literal">None</span>)：将x轴视作时间轴。</span><br></pre></td></tr></table></figure><br />
当然，设置这些属性可通过<code>set_xxx()</code>方法，进行对应的设置。</p>
<p>获取对应实例后，可以对其做很多修改。比如获取刻度label之后，可以设置其各种属性，对刻度label旋转30度：<br />
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">for</span> line <span class="keyword">in</span> axis.get_majorticklabels():</span><br><span class="line">    line.set_rotation(<span class="number">30</span>)</span><br></pre></td></tr></table></figure></p>
<h2 id="tick">Tick</h2>
<p>matplotlib.axis.Tick类是从Figure--&gt;Axes--&gt;Tick这个container体系中最末端的container。Tick容纳了tick、grid
line以及tick对应的label。所有的这些都可以通过Tick的属性获取:<br />
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">Tick.tick1line：一个Line2D实例</span><br><span class="line">Tick.tick2line：一个Line2D实例</span><br><span class="line">Tick.gridline：一个Line2D实例</span><br><span class="line">Tick.label1：一个Text实例</span><br><span class="line">Tick.label2：一个Text实例</span><br><span class="line">Tick.gridOn：一个布尔值，决定了是否绘制tickline</span><br><span class="line">Tick.tick1On：一个布尔值，决定了是否绘制1st tickline</span><br><span class="line">Tick.tick2On：一个布尔值，决定了是否绘制2nd tickline</span><br><span class="line">Tick.label1On：一个布尔值，决定了是否绘制1st tick label</span><br><span class="line">Tick.label2On：一个布尔值，决定了是否绘制2nd tick label</span><br></pre></td></tr></table></figure><br />
y轴分为左右两个，因此<code>tick1*对应左侧的轴</code>；<code>tick2*对应右侧的轴</code>。
x轴分为上下两个，因此<code>tick1*对应下侧的轴</code>；<code>tick2*对应上侧的轴</code>。</p>
<p>Tick 方法：<br />
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">get_loc()：以标量的形式返回Tick的坐标</span><br><span class="line">get_pad()：返回Tick的label和刻度线之间的距离（单位为像素点）</span><br><span class="line">set_label(s)/set_label1(s)/set_label2(s)：设置label</span><br><span class="line">set_pad(val)：设置Tick的label和刻度线之间的距离（单位为像素点）</span><br></pre></td></tr></table></figure></p>
<h2 id="primitive">primitive</h2>
<h3 id="line2d">Line2D</h3>
<p>matplotlib.lines.Line2D类是matplotlib中的曲线类（基类是matplotlib.artist.Artist），它可以有各种各样的颜色、类型、以及标注<br />
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br></pre></td><td class="code"><pre><span class="line">Line2D(xdata, ydata, linewidth=<span class="literal">None</span>, linestyle=<span class="literal">None</span>,</span><br><span class="line">  color=<span class="literal">None</span>, marker=<span class="literal">None</span>, markersize=<span class="literal">None</span>, markeredgewidth</span><br><span class="line">  =<span class="literal">None</span>, markeredgecolor=<span class="literal">None</span>, markerfacecolor</span><br><span class="line">  =<span class="literal">None</span>, markerfacecoloralt=’none’, fillstyle=<span class="literal">None</span>,</span><br><span class="line">  antialiased=<span class="literal">None</span>, dash_capstyle=<span class="literal">None</span>, solid_capstyle=<span class="literal">None</span>,</span><br><span class="line">  dash_joinstyle=<span class="literal">None</span>, solid_joinstyle=<span class="literal">None</span>, pickradius=<span class="number">5</span>,</span><br><span class="line">  drawstyle=<span class="literal">None</span>, markevery=<span class="literal">None</span>, **kwargs)</span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">这些关键字参数都是Line2D的属性。其属性有：</span></span><br><span class="line"><span class="string">    继承自Artist基类的属性：.alpha、.animated、.axes、.clip_box、</span></span><br><span class="line"><span class="string">        .clip_on、.clip_path、.contains、 .figure、.gid、.label、</span></span><br><span class="line"><span class="string">        .picker、.transform、.url、.visible、.zorder</span></span><br><span class="line"><span class="string">    .antialiased/.aa：一个布尔值。如果为True则表示线条是抗锯齿处理的</span></span><br><span class="line"><span class="string">    .color/.c：一个matplotlib color值，表示线条的颜色，</span></span><br><span class="line"><span class="string">    .dash_capstyle：为&#x27;butt&#x27; or &#x27;round&#x27; or &#x27;projecting&#x27;，表示虚线头端类型</span></span><br><span class="line"><span class="string">    .dash_joinstyle：为&#x27;miter&#x27; or &#x27;round&#x27; or &#x27;bevel&#x27;，表示虚线连接处类型</span></span><br><span class="line"><span class="string">    .dashes：一个数值序列，表示虚线的实部、虚部的尺寸。如果为(None,None)则虚线成为实线</span></span><br><span class="line"><span class="string">    .drawstyle：为&#x27;default&#x27;or&#x27;steps&#x27;or&#x27;step-pre&#x27;or&#x27;step-mid&#x27;or&#x27;step-post&#x27;，表示曲线类型。</span></span><br><span class="line"><span class="string">                &#x27;default&#x27;：点之间以直线连接</span></span><br><span class="line"><span class="string">                &#x27;steps*&#x27;：绘制阶梯图。其中steps等价于steps-pre，是为了保持兼容旧代码</span></span><br><span class="line"><span class="string">    .fillstyle：为&#x27;full&#x27;or&#x27;left&#x27;or&#x27;right&#x27;or&#x27;bottom&#x27;or&#x27;top&#x27;or&#x27;none&#x27;表示marker的填充类型。</span></span><br><span class="line"><span class="string">                &#x27;full&#x27;：填充整个marker</span></span><br><span class="line"><span class="string">                none：不填充marker</span></span><br><span class="line"><span class="string">                其他值：表示填充一半marker</span></span><br><span class="line"><span class="string">    .linestyle/.ls：指定线型，可以为以下值：</span></span><br><span class="line"><span class="string">            &#x27;-&#x27;或者&#x27;solid&#x27;：表示实线</span></span><br><span class="line"><span class="string">            &#x27;--&#x27;或者dashed：表示虚线</span></span><br><span class="line"><span class="string">            &#x27;-.&#x27;或者dash_dot：表示点划线</span></span><br><span class="line"><span class="string">            &#x27;:&#x27;或者&#x27;dotted&#x27;：表示点线</span></span><br><span class="line"><span class="string">            &#x27;None&#x27;或者&#x27; &#x27;或者&#x27;&#x27;：表示没有线条（不画线）</span></span><br><span class="line"><span class="string">    .linewidth/.lw：为浮点值，表示线条宽度</span></span><br><span class="line"><span class="string">    .marker：可以为一系列的字符串，如&#x27;.&#x27;、&#x27;,&#x27;、&#x27;o&#x27;....,表示线条的marker</span></span><br><span class="line"><span class="string">    .markeredgecolor/.mec:可以为matplotlib color，表示marker的边的颜色</span></span><br><span class="line"><span class="string">    .markeredgewidth/.mew:可以为浮点数，表示marker边的宽度</span></span><br><span class="line"><span class="string">    .markerfacecolor/.mfc：可以为matplotlib color，表示marker的前景色</span></span><br><span class="line"><span class="string">    .markerfacecoloralt/.mfcalt：可以为matplotlib color，表示marker的可选前景色</span></span><br><span class="line"><span class="string">    .markersize/.ms：可以为浮点数，表示marker的大小</span></span><br><span class="line"><span class="string">    .markevery：指定每隔多少个点绘制一个marker，可以为以下值，其他值参考文档：</span></span><br><span class="line"><span class="string">            None：表示每个点都绘制marker</span></span><br><span class="line"><span class="string">            N：表示每隔N个点绘制marker，从0开始</span></span><br><span class="line"><span class="string">            (start,N)：表示每隔N个点绘制marker，从start开始</span></span><br><span class="line"><span class="string">            [i,j,m,n]：只有点i,j,m,n的marker绘制</span></span><br><span class="line"><span class="string">    .pickradius：浮点值，表示pick radius</span></span><br><span class="line"><span class="string">    .solid_capstyle：可以为&#x27;butt&#x27;、&#x27;round&#x27;、&#x27;projecting&#x27;，表示实线的头端类型</span></span><br><span class="line"><span class="string">    .sold_joinstyle：可以为&#x27;miter&#x27;、&#x27;round&#x27;、&#x27;bevel&#x27;，表示实线连接处的类型</span></span><br><span class="line"><span class="string">    .xdata：可以为一维的numpy.array，表示x轴数据</span></span><br><span class="line"><span class="string">    .ydata：可以为一维的numpy.array，表示y轴数据</span></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br></pre></td></tr></table></figure></p>
<h3 id="text">Text</h3>
<p>matplotlib.text.Text类是绘制文字的类（基类是matplotlib.artist.Artist）。它的构造函数为：<br />
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br></pre></td><td class="code"><pre><span class="line">Text(x=<span class="number">0</span>, y=<span class="number">0</span>, text=<span class="string">&#x27;&#x27;</span>, color=<span class="literal">None</span>, verticalalignment=<span class="string">&#x27;baseline&#x27;</span>,</span><br><span class="line">  horizontalalignment=’left’, multialignment=<span class="literal">None</span>, fontproperties</span><br><span class="line">  =<span class="literal">None</span>, rotation=<span class="literal">None</span>, linespacing=<span class="literal">None</span>, rotation_</span><br><span class="line">  mode=<span class="literal">None</span>, usetex=<span class="literal">None</span>, wrap=<span class="literal">False</span>, **kwargs)</span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">这些关键字参数也是属性。其属性有：</span></span><br><span class="line"><span class="string">    继承自Artist基类的属性： .alpha、.animated、.axes、.clip_box、</span></span><br><span class="line"><span class="string">        .clip_on、.clip_path、.contains、.figure、.gid、</span></span><br><span class="line"><span class="string">        .label、.picker、.transform、.url、.visible、.zorder</span></span><br><span class="line"><span class="string">    .backgroundcolor：背景色，可以为任何matplotlib color</span></span><br><span class="line"><span class="string">    .bbox：文本框的边框。其值是FancyBboxPatch类的属性字典。</span></span><br><span class="line"><span class="string">    .color：字体颜色，可以为任何matplotlib color</span></span><br><span class="line"><span class="string">    .family/.name/.fontfamily/.fontname：字体的名字。</span></span><br><span class="line"><span class="string">        可以是string或者string list（表示可以为若干个名字，优先级依次递减）。</span></span><br><span class="line"><span class="string">        string必须是一个真实字体的名字，或者一个字体的class name。</span></span><br><span class="line"><span class="string">    .fontproperties/.font_properties：字体的属性。</span></span><br><span class="line"><span class="string">        值是一个matplotlib.font_manager.FontProperties实例，该实例一次性设置字体的很多属性：</span></span><br><span class="line"><span class="string">            比如字体类型、字体名字、字体大小、宽度等等。</span></span><br><span class="line"><span class="string">    .horizontalalignment/.ha：水平对齐方式，可以为&#x27;center&#x27;、&#x27;right&#x27;、&#x27;left&#x27;</span></span><br><span class="line"><span class="string">    .linespacing：为浮点数，单位为font size，表示行间距</span></span><br><span class="line"><span class="string">    .multialignment：multiline text对齐方式，可以为&#x27;left&#x27;、&#x27;right&#x27;、&#x27;center&#x27;</span></span><br><span class="line"><span class="string">    .position：为一个元组(x,y)，表示文本框的位置</span></span><br><span class="line"><span class="string">    .rotation：字体旋转角度。可以为下列值：</span></span><br><span class="line"><span class="string">        浮点数，表示角度</span></span><br><span class="line"><span class="string">        &#x27;vertical&#x27;、&#x27;horizontal&#x27;</span></span><br><span class="line"><span class="string">    .rotation_mode：旋转模式。可以为下列值：</span></span><br><span class="line"><span class="string">        &#x27;anchor&#x27;：文本首先对齐，然后根据对齐点来旋转</span></span><br><span class="line"><span class="string">        None：文本先旋转，再对齐</span></span><br><span class="line"><span class="string">    .size或者.fontsize：字体大小。可以为下列值：</span></span><br><span class="line"><span class="string">        浮点值，表示字体大小</span></span><br><span class="line"><span class="string">        &#x27;xx-small&#x27;、&#x27;x-small&#x27;、&#x27;small&#x27;、&#x27;medium&#x27;、&#x27;large&#x27;、&#x27;x-large&#x27;、&#x27;xx-large&#x27;</span></span><br><span class="line"><span class="string">    .stretch/.fontstretch：字体沿水平方向的拉伸。可以为下列值：</span></span><br><span class="line"><span class="string">        整数，在[0---1000]之间</span></span><br><span class="line"><span class="string">        &#x27;ultra-condensed&#x27;、&#x27;extra-condensed&#x27;、&#x27;condensed&#x27;、&#x27;semi-condensed&#x27;、</span></span><br><span class="line"><span class="string">        &#x27;normal&#x27;、&#x27;semi-expanded&#x27;、&#x27;expanded&#x27;、&#x27;extra-expanded&#x27;、&#x27;ultra-expanded&#x27;</span></span><br><span class="line"><span class="string">    .style/.fontstyle：字体样式，可以为&#x27;normal&#x27;、&#x27;italic&#x27;、&#x27;oblique&#x27;</span></span><br><span class="line"><span class="string">    .text:文本字符串，可以为任意字符串（他可以包含&#x27;\n&#x27;换行符或者LATEX语法）</span></span><br><span class="line"><span class="string">    .variant/.fontvariant：表示字体形变，可以为下列值：&#x27;normal&#x27;、&#x27;small-caps&#x27;</span></span><br><span class="line"><span class="string">    .verticalalignment/.ma/.va：表示文本的垂直对齐，可以为&#x27;center&#x27;、&#x27;top&#x27;、&#x27;bottom&#x27;、&#x27;baseline&#x27;</span></span><br><span class="line"><span class="string">    .weight/.fontweight：设置字体的weight，可以为下列值：</span></span><br><span class="line"><span class="string">        一个整数值，在[0---1000]之间</span></span><br><span class="line"><span class="string">        &#x27;ultralight&#x27;、&#x27;light&#x27;、&#x27;normal&#x27;、&#x27;regular&#x27;、&#x27;book&#x27;、&#x27;medium&#x27;、</span></span><br><span class="line"><span class="string">        &#x27;roman&#x27;、&#x27;semibold&#x27;、&#x27;demibold&#x27;、&#x27;demi&#x27;、&#x27;bold&#x27;、&#x27;heavy&#x27;、</span></span><br><span class="line"><span class="string">        &#x27;extrabold&#x27;、&#x27;black&#x27;</span></span><br><span class="line"><span class="string">    .x：一个浮点值，表示文本框位置的x值</span></span><br><span class="line"><span class="string">    .y：一个浮点值，表示文本框位置的y值</span></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br></pre></td></tr></table></figure><br />
可以通过<code>ax.text(*args,**kwargs)</code>设置文字，参数就是Text的属性。</p>
<h3 id="annotation">Annotation</h3>
<p>matplotlib.text.Annotation类是图表中的图式，它是一个带箭头的文本框，用于解说图表中的图形。它的基类是matplotlib.text.Text和matplotlib.text._AnnotationBase。其构造函数为：<br />
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line">Annotation(s, xy, xytext=<span class="literal">None</span>, xycoords=’data’, textcoords=<span class="literal">None</span>, arrowprops</span><br><span class="line">  =<span class="literal">None</span>, annotation_clip=<span class="literal">None</span>, **kwargs)</span><br><span class="line"><span class="comment"># 在位置xytext处放置一个文本框，该文本框用于解释点xy，文本框的文本为s。</span></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">s：文本框的文本字符串</span></span><br><span class="line"><span class="string">xy：被解释的点的坐标</span></span><br><span class="line"><span class="string">xytext：文本框放置的位置。如果为None，则默认取xy</span></span><br><span class="line"><span class="string">xycoords：xy坐标系，默认取&#x27;data&#x27;坐标系（即xy是数据坐标系中的点）。可以为以下值：</span></span><br><span class="line"><span class="string">    &#x27;figure points&#x27;：从figure左下角开始的点</span></span><br><span class="line"><span class="string">    &#x27;figure pixesl&#x27;：从figure左下角开始的像素值</span></span><br><span class="line"><span class="string">    &#x27;figure fraction&#x27;：(0,0)代表figure的左下角，(1,1)代表figure的右上角</span></span><br><span class="line"><span class="string">    &#x27;axes points&#x27;：从axes左下角开始的点</span></span><br><span class="line"><span class="string">    &#x27;axes pixels&#x27;：从axes左下角开始的像素</span></span><br><span class="line"><span class="string">    &#x27;axes fraction&#x27;：(0,0)代表axes的左下角，(1,1)代表axes的右上角</span></span><br><span class="line"><span class="string">    &#x27;data&#x27;：使用被标注对象的坐标系</span></span><br><span class="line"><span class="string">    &#x27;offset points&#x27;：指定从xy的偏移点</span></span><br><span class="line"><span class="string">    &#x27;polar&#x27;：极坐标系</span></span><br><span class="line"><span class="string">textcoords：文本框坐标系（即xytext是文本坐标系中的点），默认等于xycoords</span></span><br><span class="line"><span class="string">arrowprops：指定文本框和被解释的点之间的箭头。如果不是None，则是一个字典，该字典设定了matplotlib.lines.Line2D的属性。</span></span><br><span class="line"><span class="string">            如果该字典有一个arrowstyle属性，则该键的值也是一个字典，创建一个FancyArrowsPatch实例，实例属性由该字典指定。</span></span><br><span class="line"><span class="string">            如果该字典没有arrowstyle属性，则创建一个YAArrow实例，</span></span><br><span class="line"><span class="string">annotation_clip：控制超出axes区域的annotation的显示。如果为True则annotation 只显示位于axes区域内的内容。</span></span><br><span class="line"><span class="string">额外的关键字参数全部是设置Text的属性</span></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br></pre></td></tr></table></figure></p>
<h3 id="legend">Legend</h3>
<p>matplotlib.legend.Legend是图例类，它的基类是matplotlib.artist.Artist。其构造函数为：<br />
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br></pre></td><td class="code"><pre><span class="line">Legend(parent, handles, labels, loc=<span class="literal">None</span>, numpoints=<span class="literal">None</span>, markerscale</span><br><span class="line">  =<span class="literal">None</span>, markerfirst=<span class="literal">True</span>, scatterpoints=<span class="literal">None</span>,</span><br><span class="line">  scatteryoffsets=<span class="literal">None</span>, prop=<span class="literal">None</span>, fontsize=<span class="literal">None</span>, borderpad</span><br><span class="line">  =<span class="literal">None</span>, labelspacing=<span class="literal">None</span>, handlelength=<span class="literal">None</span>,</span><br><span class="line">  handleheight=<span class="literal">None</span>, handletextpad=<span class="literal">None</span>, borderaxespad</span><br><span class="line">  =<span class="literal">None</span>, columnspacing=<span class="literal">None</span>, ncol=<span class="number">1</span>, mode=<span class="literal">None</span>,</span><br><span class="line">  fancybox=<span class="literal">None</span>, shadow=<span class="literal">None</span>, title=<span class="literal">None</span>, framealpha</span><br><span class="line">  =<span class="literal">None</span>, bbox_to_anchor=<span class="literal">None</span>, bbox_transform=<span class="literal">None</span>,</span><br><span class="line">  frameon=<span class="literal">None</span>, handler_map=<span class="literal">None</span>)</span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">parent：持有该legend的artist</span></span><br><span class="line"><span class="string">loc:图例的位置。其值可以为字符串或者数字：</span></span><br><span class="line"><span class="string">    best或0：自动计算</span></span><br><span class="line"><span class="string">    upper right或1： 右上角</span></span><br><span class="line"><span class="string">    upper left或2：上角</span></span><br><span class="line"><span class="string">    lower left或3：下角</span></span><br><span class="line"><span class="string">    lower right或4：右下角</span></span><br><span class="line"><span class="string">    right或5：右边</span></span><br><span class="line"><span class="string">    center left或6：中间偏左</span></span><br><span class="line"><span class="string">    center right或7：中间偏右</span></span><br><span class="line"><span class="string">    lower center或8：中间底部</span></span><br><span class="line"><span class="string">    upper center或9：中间顶部</span></span><br><span class="line"><span class="string">    center或10：正中央</span></span><br><span class="line"><span class="string">handle：一个artist列表，添加这些artist到legend中</span></span><br><span class="line"><span class="string">lebels：一个字符串列表添加到legend中</span></span><br><span class="line"><span class="string">prop:字体属性</span></span><br><span class="line"><span class="string">fontsize: 字体大小（只有prop未设置时有效）</span></span><br><span class="line"><span class="string">markerscale: marker的缩放比例（相对于原始大小）</span></span><br><span class="line"><span class="string">markerfirst: 如果为True，则marker放在label左侧；否则marker放在label右侧</span></span><br><span class="line"><span class="string">numpoints: the number of points in the legend for line</span></span><br><span class="line"><span class="string">scatterpoints: the number of points in the legend for scatter plot</span></span><br><span class="line"><span class="string">scatteryoffsets: a list of offsets for scatter symbols in legend</span></span><br><span class="line"><span class="string">frameon: if True, draw a frame around the legend. If None, use rc</span></span><br><span class="line"><span class="string">fancybox: if True, draw a frame with a round fancybox. If None, use rc</span></span><br><span class="line"><span class="string">shadow: if True, draw a shadow behind legend</span></span><br><span class="line"><span class="string">framealpha: If not None, alpha channel for the frame.</span></span><br><span class="line"><span class="string">ncol: number of columns</span></span><br><span class="line"><span class="string">borderpad: the fractional whitespace inside the legend border</span></span><br><span class="line"><span class="string">labelspacing: the vertical space between the legend entries</span></span><br><span class="line"><span class="string">handlelength: the length of the legend handles</span></span><br><span class="line"><span class="string">handleheight: the height of the legend handles</span></span><br><span class="line"><span class="string">handletextpad: the pad between the legend handle and text</span></span><br><span class="line"><span class="string">borderaxespad: the pad between the axes and legend border</span></span><br><span class="line"><span class="string">columnspacing:the spacing between columns</span></span><br><span class="line"><span class="string">title: 图例的标题</span></span><br><span class="line"><span class="string">bbox_to_anchor: the bbox that the legend will be anchored.</span></span><br><span class="line"><span class="string">bbox_transform: the transform for the bbox. transAxes if Noneloc a location code</span></span><br><span class="line"><span class="string">其他关键字参数用于设置属性</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">继承自Artist基类的属性：</span></span><br><span class="line"><span class="string">.alpha、.animated、.axes、.clip_box、..clip_on、.clip_path、.contains、</span></span><br><span class="line"><span class="string">.figure、.gid、.label、.picker、.transform、.url、.visible、.zorder</span></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br></pre></td></tr></table></figure></p>
<h3 id="patch">Patch</h3>
<p>matplotlib.patches.Patch类是二维图形类。它的基类是matplotlib.artist.Artist。其构造函数为：<br />
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br></pre></td><td class="code"><pre><span class="line"> Patch(edgecolor=<span class="literal">None</span>, facecolor=<span class="literal">None</span>, color=<span class="literal">None</span>,</span><br><span class="line">  linewidth=<span class="literal">None</span>, linestyle=<span class="literal">None</span>, antialiased=<span class="literal">None</span>,</span><br><span class="line">  hatch=<span class="literal">None</span>, fill=<span class="literal">True</span>, capstyle=<span class="literal">None</span>, joinstyle=<span class="literal">None</span>,</span><br><span class="line">  **kwargs)</span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">edgecolor：可以为matplotlib color，表示边线条的颜色，若为none则表示无颜色</span></span><br><span class="line"><span class="string">facecolor：可以为matplotlib color，表示前景色，若为none则表示无颜色</span></span><br><span class="line"><span class="string">color可以为matplotlib color，表示边线条和前景色的颜色。</span></span><br><span class="line"><span class="string">linewidth：为浮点数，表示线条宽度</span></span><br><span class="line"><span class="string">linestyle：指定线型，可以为以下值：</span></span><br><span class="line"><span class="string">            &#x27;-&#x27;或者&#x27;solid&#x27;：表示实线</span></span><br><span class="line"><span class="string">            &#x27;--&#x27;或者dashed：表示虚线</span></span><br><span class="line"><span class="string">            &#x27;-.&#x27;或者dash_dot：表示点划线</span></span><br><span class="line"><span class="string">            &#x27;:&#x27;或者&#x27;dotted&#x27;：表示点线</span></span><br><span class="line"><span class="string">            &#x27;None&#x27;或者&#x27; &#x27;或者&#x27;&#x27;：表示没有线条（不画线）</span></span><br><span class="line"><span class="string">antialiased：一个布尔值。如果为True则表示线条是抗锯齿处理的</span></span><br><span class="line"><span class="string">hatch：设置hatching pattern，可以为下列的值：</span></span><br><span class="line"><span class="string">        &#x27;\&#x27;、&#x27;|&#x27;、&#x27;-&#x27;、&#x27;+&#x27;、&#x27;x&#x27;、&#x27;o&#x27;、&#x27;0&#x27;、&#x27;.&#x27;、&#x27;*&#x27;</span></span><br><span class="line"><span class="string">fill：为布尔值。如果为True则填充图形，否则不填充</span></span><br><span class="line"><span class="string">capstyle：为&#x27;butt&#x27; or &#x27;round&#x27; or &#x27;projecting&#x27;，表示线条头端类型</span></span><br><span class="line"><span class="string">joinstyle：可以为&#x27;miter&#x27;、&#x27;round&#x27;、&#x27;bevel&#x27;，表示矩形线条接头类型</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">其他关键字参数用于设置属性。</span></span><br><span class="line"><span class="string">如果 edgecolor, facecolor, linewidth, or antialiased 为None则这些值从rc params中读取</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">属性如下：</span></span><br><span class="line"><span class="string">继承自Artist基类的属性： .alpha、.animated、.axes、.clip_box、</span></span><br><span class="line"><span class="string">                       .clip_on、.clip_path、.contains、.figure、.gid、</span></span><br><span class="line"><span class="string">                       .label、path_effects、.picker、.transform、.url、.visible、.zorder</span></span><br><span class="line"><span class="string">.antialiased/.aa：一个布尔值。如果为True则表示线条是抗锯齿处理的</span></span><br><span class="line"><span class="string">.capstyle：为&#x27;butt&#x27; or &#x27;round&#x27; or &#x27;projecting&#x27;，表示线条头端类型</span></span><br><span class="line"><span class="string">.color：可以为matplotlib color，表示边线条和前景色的颜色。</span></span><br><span class="line"><span class="string">.edgecolor/.ec：可以为matplotlib color，表示边线条的颜色，若为none则表示无颜色</span></span><br><span class="line"><span class="string">.facecolor/.fc：可以为matplotlib color，表示前景色，若为none则表示无颜色</span></span><br><span class="line"><span class="string">.fill：为布尔值。如果为True则填充图形，否则不填充</span></span><br><span class="line"><span class="string">.hatch：设置hatching pattern，可以为下列的值：</span></span><br><span class="line"><span class="string">            &#x27;\&#x27;、&#x27;|&#x27;、&#x27;-&#x27;、&#x27;+&#x27;、&#x27;x&#x27;、&#x27;o&#x27;、&#x27;0&#x27;、&#x27;.&#x27;、&#x27;*&#x27;</span></span><br><span class="line"><span class="string">.joinstyle：可以为&#x27;miter&#x27;、&#x27;round&#x27;、&#x27;bevel&#x27;，表示矩形线条接头类型</span></span><br><span class="line"><span class="string">.linestyle/.ls：指定线型，可以为以下值：</span></span><br><span class="line"><span class="string">                    &#x27;-&#x27;或者&#x27;solid&#x27;：表示实线</span></span><br><span class="line"><span class="string">                    &#x27;--&#x27;或者dashed：表示虚线</span></span><br><span class="line"><span class="string">                    &#x27;-.&#x27;或者dash_dot：表示点划线</span></span><br><span class="line"><span class="string">                    &#x27;:&#x27;或者&#x27;dotted&#x27;：表示点线</span></span><br><span class="line"><span class="string">                    &#x27;None&#x27;或者&#x27; &#x27;或者&#x27;&#x27;：表示没有线条（不画线）</span></span><br><span class="line"><span class="string">.linewidth/.lw：为浮点数，表示线条宽度</span></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br></pre></td></tr></table></figure></p>
<h3 id="rectangle">Rectangle</h3>
<p>matplotlib.patches.Rectangle类是矩形类（基类是matplotlib.patches.Patch），其构造函数为：<br />
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">Rectangle(xy,width,height,angle=<span class="number">0.0</span>,**kwargs)</span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">xy：矩形左下角坐标</span></span><br><span class="line"><span class="string">width：矩形宽度</span></span><br><span class="line"><span class="string">height：矩形高度</span></span><br><span class="line"><span class="string">其他关键字参数用于设置属性</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">其属性有：</span></span><br><span class="line"><span class="string">继承自Artist基类的属性：.alpha、.animated、.axes、.clip_box、.clip_on、.clip_path、</span></span><br><span class="line"><span class="string">                      .contains、.figure、.gid、.label、.picker、.transform、</span></span><br><span class="line"><span class="string">                      .url、.visible、.zorder</span></span><br><span class="line"><span class="string">继承自Patch基类的属性：.antialiased/.aa、.capstyle、.color、.edgecolor/.ec、</span></span><br><span class="line"><span class="string">                     .facecolor/.fc、.fill、.hatch、.joinstyle、.linestyle/.ls、.linewidth/.lw</span></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br></pre></td></tr></table></figure></p>
<h3 id="polygon">Polygon</h3>
<p>matplotlib.patches.Polygon类是多边形类。其基类是matplotlib.patches.Patch。其构造函数为：<br />
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">Polygon(xy, closed=<span class="literal">True</span>, **kwargs)</span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">xy：是一个N×2的numpy array，为多边形的顶点。</span></span><br><span class="line"><span class="string">closed：为True则指定多边形将起点和终点重合从而显式关闭多边形。</span></span><br><span class="line"><span class="string">其他关键字参数用于设置属性</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">Polygon的属性有：</span></span><br><span class="line"><span class="string">继承自Artist基类的属性：.alpha、.animated、.axes、.clip_box、</span></span><br><span class="line"><span class="string">                      .clip_on、.clip_path、.contains、.figure、</span></span><br><span class="line"><span class="string">                      .gid、.label、.picker、.transform、.url、.visible、.zorder</span></span><br><span class="line"><span class="string">继承自Patch基类的属性：.antialiased/.aa、.capstyle、.color、.edgecolor/.ec、</span></span><br><span class="line"><span class="string">                     .facecolor/.fc、.fill、.hatch、.joinstyle、.linestyle/.ls、.linewidth/.lw</span></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br></pre></td></tr></table></figure></p>
<h3 id="polycollection">PolyCollection</h3>
<p>matplotlib.collections.PolyCollection是多边形集合类，其基类是matplotlib.collections._CollectionWithSizes。它的构造函数为：<br />
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">PolyCollection(verts, sizes=<span class="literal">None</span>, closed=<span class="literal">True</span>, **kwargs)</span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">verts：一个顶点序列。每个顶点都由xy元组或者xy数组组成</span></span><br><span class="line"><span class="string">sizes：一个浮点数序列，依次指定每个顶点正方形的边长。如果序列长度小于顶点长度，则循环从序列头部再开始  挑选</span></span><br><span class="line"><span class="string">closed：如果为True，则显式封闭多边形</span></span><br><span class="line"><span class="string">edgecolors: collection的边的颜色</span></span><br><span class="line"><span class="string">其他关键字参数用于设置属性</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">属性：</span></span><br><span class="line"><span class="string">继承自Artist基类的属性：.alpha、.animated、.axes、.clip_box、.clip_on、</span></span><br><span class="line"><span class="string">                      .clip_path、.contains、.figure、.gid、.label、</span></span><br><span class="line"><span class="string">                      .picker、.transform、.url、.visible、.zorder</span></span><br><span class="line"><span class="string">.facecolors: collection的前景色</span></span><br><span class="line"><span class="string">.linewidths: collection的边线宽</span></span><br><span class="line"><span class="string">.antialiaseds: 抗锯齿属性，可以为True或者False</span></span><br><span class="line"><span class="string">.offsets: 设置collection的偏移</span></span><br><span class="line"><span class="string">.norm: 归一化对象</span></span><br><span class="line"><span class="string">.cmap: color map</span></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br></pre></td></tr></table></figure></p>
<h1 id="matplotlib实例">Matplotlib实例</h1>
<p><img src="https://i.loli.net/2021/05/22/V9JoBlqxdeHjtbD.jpg" /></p>
<h2 id="基础画图参数">基础画图、参数</h2>
<p>绘图中常用的方法：<br />
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 设置坐标轴上下限</span></span><br><span class="line"><span class="comment"># 第一种方法</span></span><br><span class="line">plt.axis([xmin,xmax,ymin,ymax])</span><br><span class="line"><span class="comment"># 第二种方法</span></span><br><span class="line">plt.xlim(left, right) <span class="comment"># x轴上线下限 </span></span><br><span class="line">plt.ylim(left, right<span class="comment"># y轴上线下限</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 设置图形标题</span></span><br><span class="line">plt.title(<span class="string">&quot;title&quot;</span>)</span><br><span class="line"><span class="comment"># 设置x轴y轴标题</span></span><br><span class="line">plt.xlabel(<span class="string">&quot;x&quot;</span>)</span><br><span class="line">plt.ylabel(<span class="string">&quot;y&quot;</span>)</span><br><span class="line"><span class="comment"># 显示图例</span></span><br><span class="line">plt.legend()</span><br></pre></td></tr></table></figure><br />
一般情况下plt方法也可以用ax调用，但有些方法名字不一样：<br />
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">plt.xlabel()   ax.set_xlabel()</span><br><span class="line">plt.ylabel()   ax.set_ylabel()</span><br><span class="line">plt.xlim()     ax.set_xlim()</span><br><span class="line">plt.ylim()     ax.set_ylim()</span><br><span class="line">plt.title()    ax.set_title()</span><br><span class="line"><span class="comment"># 一般常用ax.set()全部设置了，比如：</span></span><br><span class="line">ax.<span class="built_in">set</span>(xlim=(<span class="number">0</span>, <span class="number">10</span>), ylim=(-<span class="number">2</span>, <span class="number">2</span>), xlabel=<span class="string">&#x27;x&#x27;</span>, ylabel=<span class="string">&#x27;sin(x)&#x27;</span>, title=<span class="string">&#x27;title&#x27;</span>)</span><br></pre></td></tr></table></figure><br />
显示marker样式：<br />
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">rng = np.random.RandomState(<span class="number">0</span>)</span><br><span class="line"><span class="keyword">for</span> marker <span class="keyword">in</span> [<span class="string">&#x27;o&#x27;</span>, <span class="string">&#x27;.&#x27;</span>, <span class="string">&#x27;,&#x27;</span>, <span class="string">&#x27;x&#x27;</span>, <span class="string">&#x27;+&#x27;</span>, <span class="string">&#x27;v&#x27;</span>, <span class="string">&#x27;^&#x27;</span>, <span class="string">&#x27;&lt;&#x27;</span>, <span class="string">&#x27;&gt;&#x27;</span>, <span class="string">&#x27;s&#x27;</span>, <span class="string">&#x27;d&#x27;</span>]:</span><br><span class="line">    plt.plot(rng.rand(<span class="number">5</span>), rng.rand(<span class="number">5</span>), marker, label=<span class="string">&quot;marker=&#x27;&#123;0&#125;&#x27;&quot;</span>.<span class="built_in">format</span>(marker))</span><br><span class="line">    plt.legend(numpoints=<span class="number">1</span>)</span><br><span class="line">    plt.xlim(<span class="number">0</span>, <span class="number">1.8</span>)</span><br></pre></td></tr></table></figure></p>
<iframe src="https://nbviewer.jupyter.org/github/soundmemories/StudyNotes/blob/cc4141f7491403a41ac738dba7695d7aaeda9c07/Cheatsheets/Matplotlib_visualization.ipynb" width="1000" height="800">
</iframe>
<h2 id="d画图参数">3D画图、参数</h2>
<iframe src="https://nbviewer.jupyter.org/github/soundmemories/StudyNotes/blob/cc4141f7491403a41ac738dba7695d7aaeda9c07/Cheatsheets/Matplotlib%203D.ipynb" width="1000" height="800">
</iframe>
<h1 id="basemap可视化地理数据">Basemap可视化地理数据</h1>
<p>地理数据可视化是数据科学中一种十分常见的可视化类型。 Matplotlib
做此类可视化的主要工具是 Basemap 工具箱，它是 Matplotlib 的 mpl_toolkits
命名空间里的众多工具箱之一。坦白说， Basemap
用起来有点笨重，就算做点儿简单的可视化图也需要花费比预期更长的时间。在处理比较复杂的地图可视化任务时，更现代的解决方案可能会更适用一些，比如
leaflet 开发库或 Google Maps API。</p>
<p>Basemap是Matplotlib的第三方扩展，Matplotlib还支持很多这种第三方库，详情<span class="exturl" data-url="aHR0cHM6Ly9tYXRwbG90bGliLm9yZy9zdGFibGUvdGhpcmRwYXJ0eXBhY2thZ2VzL2luZGV4Lmh0bWwjbWFwcGluZy10b29sa2l0cw==">thirdpartypackages<i class="fa fa-external-link-alt"></i></span>。</p>
<p>Basemap安装环境（本环境是python 3.6）：<br />
（1）pyproj可以直接pip安装，手动安装要和python版本一致。<br />
（2）basemap需要手动下载安装，从<span class="exturl" data-url="aHR0cHM6Ly93d3cubGZkLnVjaS5lZHUvfmdvaGxrZS9weXRob25saWJzLw==">pythonlibs<i class="fa fa-external-link-alt"></i></span>下载basemap安装（必须和python版本一致）。<br />
（3）python2需要pil包，python3还需要安装pillwo包。<br />
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 安装pyproj</span></span><br><span class="line">!pip install pyproj</span><br><span class="line"><span class="comment"># 下载3.6版本的安装包，放在notebook目录下</span></span><br><span class="line">!pip install basemap-<span class="number">1.2</span><span class="number">.2</span>-cp36-cp36m-win_amd64.whl</span><br></pre></td></tr></table></figure><br />
显示地球投影：<br />
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">%matplotlib inline</span><br><span class="line"><span class="keyword">import</span> numpy <span class="keyword">as</span> np</span><br><span class="line"><span class="keyword">import</span> matplotlib.pyplot <span class="keyword">as</span> plt</span><br><span class="line"><span class="comment"># 导入</span></span><br><span class="line"><span class="keyword">from</span> mpl_toolkits.basemap <span class="keyword">import</span> Basemap</span><br><span class="line"></span><br><span class="line">plt.figure(figsize=(<span class="number">8</span>, <span class="number">8</span>))</span><br><span class="line">m = Basemap(projection=<span class="string">&#x27;ortho&#x27;</span>, resolution=<span class="literal">None</span>, lat_0=<span class="number">50</span>, lon_0=-<span class="number">100</span>)</span><br><span class="line">m.bluemarble(scale=<span class="number">0.5</span>)</span><br></pre></td></tr></table></figure><br />
<img src="https://i.loli.net/2021/05/25/shcfE8TC2kHNiYB.jpg"
alt="basemap地球.jpg" /></p>
<p>ETOPO 地图，显示陆地与海底的地形特征作为背景：<br />
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">fig = plt.figure(figsize=(<span class="number">8</span>, <span class="number">8</span>))</span><br><span class="line">m = Basemap(projection=<span class="string">&#x27;lcc&#x27;</span>, resolution=<span class="literal">None</span>, width=<span class="number">8E6</span>, height=<span class="number">8E6</span>, lat_0=<span class="number">30</span>, lon_0=<span class="number">100</span>)</span><br><span class="line"><span class="comment"># etopo图</span></span><br><span class="line">m.etopo(scale=<span class="number">0.5</span>, alpha=<span class="number">0.5</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 地图上的(经度, 纬度)对应图上的(x, y)坐标</span></span><br><span class="line">x, y = m(<span class="number">116.20</span>, <span class="number">39.56</span>) <span class="comment"># 北京</span></span><br><span class="line">plt.plot(x, y, <span class="string">&#x27;ok&#x27;</span>, markersize=<span class="number">5</span>)</span><br><span class="line">plt.text(x, y, <span class="string">&#x27; 北京&#x27;</span>, fontsize=<span class="number">12</span>)</span><br></pre></td></tr></table></figure><br />
<img src="https://i.loli.net/2021/05/25/UiL2A5P46DaMShs.jpg"
alt="北京.jpg" /></p>
<p>对于背景，用 <code>bluemarble()</code> 和 <code>shadedrelief()</code>
方法可以画出地球投影，用 <code>drawparallels()</code> 和
<code>drawmeridians()</code> 方法可以画出纬线与经线。<br />
Basemap
程序包中有许多实用的函数，可以画出各种地形的轮廓，如陆地、海洋、湖泊、河流、分界线等等。<br />
常用方法：<br />
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 物理边界与水体</span></span><br><span class="line">drawcoastlines()      绘制大陆海岸线</span><br><span class="line">drawlsmask()          为陆地与海洋设置填充色，从而可以在陆地或海洋投影其他图像</span><br><span class="line">drawmapboundary()     绘制地图边界，包括为海洋填充颜色</span><br><span class="line">drawrivers()          绘制河流</span><br><span class="line">fillcontinents()      用一种颜色填充大陆，用另一种颜色填充湖泊（可选）</span><br><span class="line"><span class="comment"># 政治边界</span></span><br><span class="line">drawcountries()       绘制国界线</span><br><span class="line">drawstates()          绘制美国州界线</span><br><span class="line">drawcounties()        绘制美国县界线</span><br><span class="line"><span class="comment"># 地图功能</span></span><br><span class="line">drawgreatcircle()    在两点之间绘制一个大圆</span><br><span class="line">drawparallels()      绘制纬线</span><br><span class="line">drawmeridians()      绘制经线</span><br><span class="line">drawmapscale()       在地图上绘制一个线性比例尺</span><br><span class="line"><span class="comment"># 地球影像</span></span><br><span class="line">bluemarble()         绘制 NASA 蓝色弹珠地球投影</span><br><span class="line">shadedrelief()       在地图上绘制地貌晕渲图</span><br><span class="line">etopo()              在地图上绘制地形晕渲图</span><br><span class="line">warpimage()          将用户提供的图像投影到地图上</span><br></pre></td></tr></table></figure><br />
对于数据，可以在背景上画出，常用方法：<br />
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">contour()/contourf()     绘制等高线 / 填充等高线</span><br><span class="line">imshow()                 绘制一个图像</span><br><span class="line">pcolor()/pcolormesh()    绘制带规则 / 不规则网格的伪彩图</span><br><span class="line">plot()                   绘制线条和 / 或标签</span><br><span class="line">scatter()                绘制带标签的点</span><br><span class="line">quiver()                 绘制箭头</span><br><span class="line">barbs()                  绘制风羽（wind barb）</span><br><span class="line">drawgreatcircle()        绘制大圆圈</span><br></pre></td></tr></table></figure></p>
<h1 id="seaborn可视化">Seaborn可视化</h1>
<p>Matplotlib缺点：<br />
（1）Matplotlib 的 API
比较底层。虽然可以实现复杂的统计数据可视化，但是通常都需要写大量的样板代码。<br />
（2）由于 Matplotlib 比 Pandas 早十几年，因此它并不是为 Pandas 的
DataFrame 设计的。为了实现 Pandas 的 DataFrame
数据的可视化，你必须先提取每个
Series，然后通常还需要将它们合并成适当的格式。如果有一个画图程序库可以智能地使用DataFrame的标签画图，那一定会很方便。</p>
<p>Seaborn 在 Matplotlib 的基础上开发了一套
API，为默认的图形样式和颜色设置提供了理智的选择，为常用的统计图形定义了许多简单的高级函数，并与
Pandas DataFrame 的功能有机结合。</p>
<p>Matplotlib 团队也一直在努力解决这些问题，Matplotlib
中不仅增加了<code>plt.style</code> 工具，而且与 Pandas
数据也可以无缝衔接。</p>
<p>Seanborn内置的数据集<span class="exturl" data-url="aHR0cHM6Ly9naXRodWIuY29tL213YXNrb20vc2VhYm9ybi1kYXRh">seaborn-data<i class="fa fa-external-link-alt"></i></span>。<br />
Seaborn<span class="exturl" data-url="aHR0cDovL3NlYWJvcm4ucHlkYXRhLm9yZw==">文档<i class="fa fa-external-link-alt"></i></span>、<span class="exturl" data-url="aHR0cDovL3N0YW5mb3JkLmVkdS9+bXdhc2tvbS9zb2Z0d2FyZS9zZWFib3JuL3R1dG9yaWFsLmh0bWw=">教程<i class="fa fa-external-link-alt"></i></span>和
Seaborn <span class="exturl" data-url="aHR0cDovL3N0YW5mb3JkLmVkdS9+bXdhc2tvbS9zb2Z0d2FyZS9zZWFib3JuL2V4YW1wbGVzL2luZGV4Lmh0bWw=">画廊<i class="fa fa-external-link-alt"></i></span>。</p>
<p><strong>1、频次直方图、 KDE和密度图</strong><br />
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> numpy <span class="keyword">as</span> np</span><br><span class="line"><span class="keyword">import</span> pandas <span class="keyword">as</span> pd</span><br><span class="line"><span class="keyword">import</span> seaborn <span class="keyword">as</span> sns</span><br><span class="line"><span class="keyword">import</span> matplotlib.pyplot <span class="keyword">as</span> plt </span><br><span class="line"></span><br><span class="line">data = np.random.multivariate_normal([<span class="number">0</span>, <span class="number">0</span>], [[<span class="number">5</span>, <span class="number">2</span>], [<span class="number">2</span>, <span class="number">2</span>]], size=<span class="number">2000</span>)</span><br><span class="line">data = pd.DataFrame(data, columns=[<span class="string">&#x27;x&#x27;</span>, <span class="string">&#x27;y&#x27;</span>])</span><br><span class="line"><span class="keyword">for</span> col <span class="keyword">in</span> <span class="string">&#x27;xy&#x27;</span>:</span><br><span class="line">    plt.hist(data[col], density=<span class="literal">True</span>, alpha=<span class="number">0.5</span>)</span><br></pre></td></tr></table></figure><br />
<img src="https://i.loli.net/2021/05/25/MRIcGhDvJywsx9e.jpg"
alt="直方图.jpg" /></p>
<p>还可以用 KDE 获取变量分布的平滑估计：<br />
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">for</span> col <span class="keyword">in</span> <span class="string">&#x27;xy&#x27;</span>:</span><br><span class="line">    sns.kdeplot(data[col], shade=<span class="literal">True</span>)</span><br></pre></td></tr></table></figure><br />
<img src="https://i.loli.net/2021/05/25/1VQ7XoztnxcjylU.jpg"
alt="sns_kde.jpg" /></p>
<p>用 distplot 可以让频次直方图与 KDE 结合起来：<br />
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">sns.distplot(data[<span class="string">&#x27;x&#x27;</span>])</span><br><span class="line">sns.distplot(data[<span class="string">&#x27;y&#x27;</span>])</span><br></pre></td></tr></table></figure><br />
<img src="https://i.loli.net/2021/05/25/5jaP7gXxVCnT9Uc.jpg"
alt="sns_displot.jpg" /></p>
<p>如果向 kdeplot
输入的是二维数据集，那么就可以获得一个二维数据可视化图：<br />
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sns.kdeplot(data)</span><br></pre></td></tr></table></figure><br />
<img src="https://i.loli.net/2021/05/25/nLC3rfKHoQPq5v7.jpg"
alt="sns_kde2.jpg" /></p>
<p>用 sns.jointplot
可以同时看到两个变量的联合分布与单变量的独立分布：<br />
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 白色背景</span></span><br><span class="line"><span class="keyword">with</span> sns.axes_style(<span class="string">&#x27;white&#x27;</span>):</span><br><span class="line">    sns.jointplot(<span class="string">&quot;x&quot;</span>, <span class="string">&quot;y&quot;</span>, data, kind=<span class="string">&#x27;kde&#x27;</span>)</span><br></pre></td></tr></table></figure><br />
<img src="https://i.loli.net/2021/05/25/zOb5WjnBpATCRrQ.jpg"
alt="sns_joinplot.jpg" /></p>
<p>可以向 jointplot
函数传递一些参数。例如，可以用六边形块代替频次直方图：<br />
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">with</span> sns.axes_style(<span class="string">&#x27;white&#x27;</span>):</span><br><span class="line">    sns.jointplot(<span class="string">&quot;x&quot;</span>, <span class="string">&quot;y&quot;</span>, data, kind=<span class="string">&#x27;hex&#x27;</span>)</span><br></pre></td></tr></table></figure><br />
<img src="https://i.loli.net/2021/05/25/1rJpz4dkQ7nHlRF.jpg"
alt="sns_joinplot2.jpg" /></p>
<p><strong>2、矩阵图</strong><br />
需要对多维数据集进行可视化时，最终都要使用矩阵图。<br />
如果想画出所有变量中任意两个变量之间的图形，用矩阵图探索多维数据不同维度间的相关性非常有效。</p>
<p>可视化样本中多个维度的关系非常简单，直接用 sns.pairplot 即可：<br />
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">iris = sns.load_dataset(<span class="string">&quot;iris&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 四个变量的矩阵图</span></span><br><span class="line">sns.pairplot(iris, hue=<span class="string">&#x27;species&#x27;</span>, height=<span class="number">2.5</span>)</span><br></pre></td></tr></table></figure><br />
<img src="https://i.loli.net/2021/05/25/LHb73OQBySJ9r5t.jpg"
alt="矩阵图.jpg" /></p>
<p><strong>3、分面频次直方图</strong><br />
有时观察数据最好的方法就是借助数据子集的频次直方图。 Seaborn 的
<code>FacetGrid()</code> 函数让这件事变得非常简单。</p>
<p>某个餐厅统计的服务员收取小费的数据<br />
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">tips = sns.load_dataset(<span class="string">&#x27;tips&#x27;</span>)</span><br><span class="line"></span><br><span class="line">tips[<span class="string">&#x27;tip_pct&#x27;</span>] = <span class="number">100</span> * tips[<span class="string">&#x27;tip&#x27;</span>] / tips[<span class="string">&#x27;total_bill&#x27;</span>]</span><br><span class="line"></span><br><span class="line">grid = sns.FacetGrid(tips, row=<span class="string">&quot;sex&quot;</span>, col=<span class="string">&quot;time&quot;</span>, margin_titles=<span class="literal">True</span>)</span><br><span class="line">grid.<span class="built_in">map</span>(plt.hist, <span class="string">&quot;tip_pct&quot;</span>, bins=np.linspace(<span class="number">0</span>, <span class="number">40</span>, <span class="number">15</span>))</span><br></pre></td></tr></table></figure><br />
<img src="https://i.loli.net/2021/05/25/QDKa9k8qvuAF42T.jpg"
alt="分面频次直方图.jpg" /></p>
<p><strong>4、因子图</strong><br />
因子图（factor
plot）也是对数据子集进行可视化的方法。你可以通过它观察一个参数在另一个参数间隔中的分布情况。<br />
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">with</span> sns.axes_style(style=<span class="string">&#x27;ticks&#x27;</span>):</span><br><span class="line">    <span class="comment"># 新版本重命名为catplot</span></span><br><span class="line">    g = sns.factorplot(<span class="string">&quot;day&quot;</span>, <span class="string">&quot;total_bill&quot;</span>, <span class="string">&quot;sex&quot;</span>, data=tips, kind=<span class="string">&quot;box&quot;</span>)</span><br><span class="line">    g.set_axis_labels(<span class="string">&quot;Day&quot;</span>, <span class="string">&quot;Total Bill&quot;</span>)</span><br></pre></td></tr></table></figure><br />
<img src="https://i.loli.net/2021/05/25/7STzpiKFqYl3sRa.jpg"
alt="factorplot/catplot.jpg" /></p>
<p><strong>5、联合分布</strong><br />
与前面介绍的矩阵图类似，可以用 <code>sns.jointplot()</code>
画出不同数据集的联合分布和各数据本身的分布。<br />
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">with</span> sns.axes_style(<span class="string">&#x27;white&#x27;</span>):</span><br><span class="line">    sns.jointplot(<span class="string">&quot;total_bill&quot;</span>, <span class="string">&quot;tip&quot;</span>, data=tips, kind=<span class="string">&#x27;hex&#x27;</span>)</span><br></pre></td></tr></table></figure><br />
<img src="https://i.loli.net/2021/05/25/YQHD938NtKWJLXv.jpg"
alt="联合分布图.jpg" /></p>
<p>联合分布图也可以自动进行 KDE 和回归：<br />
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sns.jointplot(<span class="string">&quot;total_bill&quot;</span>, <span class="string">&quot;tip&quot;</span>, data=tips, kind=<span class="string">&#x27;reg&#x27;</span>)</span><br></pre></td></tr></table></figure><br />
<img src="https://i.loli.net/2021/05/25/PViOUKG93k6WbeI.jpg"
alt="联合分布图回归.jpg" /></p>
<p><strong>6、条形图</strong><br />
时间序列数据可以用 <code>sns.factorplot()</code> 画出条形图。</p>
<p>行星数据来演示：<br />
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">planets = sns.load_dataset(<span class="string">&#x27;planets&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">with</span> sns.axes_style(<span class="string">&#x27;white&#x27;</span>):</span><br><span class="line">    g = sns.factorplot(<span class="string">&quot;year&quot;</span>, data=planets, aspect=<span class="number">2</span>, kind=<span class="string">&quot;count&quot;</span>, color=<span class="string">&#x27;steelblue&#x27;</span>)</span><br><span class="line">    g.set_xticklabels(step=<span class="number">5</span>)</span><br></pre></td></tr></table></figure><br />
<img src="https://i.loli.net/2021/05/25/KeauUM3LJxg8ytB.jpg"
alt="条形图.jpg" /></p>
<p>其他案例：<br />
<strong>0、Seaborn详细教程</strong><br />
<iframe src="https://nbviewer.jupyter.org/github/soundmemories/StudyNotes/blob/0a57cce6189669f35997e1ec3a371336e9f7a757/Cheatsheets/Seaborn_visualization.ipynb" width="1000" height="700"></iframe></p>
<p><strong>1、单维度与关联维度分析</strong><br />
<iframe src="https://nbviewer.jupyter.org/github/soundmemories/StudyNotes/blob/0a57cce6189669f35997e1ec3a371336e9f7a757/Cheatsheets/Seaborn_distribution.ipynb" width="1000" height="700"></iframe></p>
<p><strong>2、连续变量关联分析</strong><br />
<iframe src="https://nbviewer.jupyter.org/github/soundmemories/StudyNotes/blob/0a57cce6189669f35997e1ec3a371336e9f7a757/Cheatsheets/Seaborn_regression.ipynb" width="1000" height="700"></iframe></p>
<p><strong>3、离散变量分析</strong><br />
<iframe src="https://nbviewer.jupyter.org/github/soundmemories/StudyNotes/blob/0a57cce6189669f35997e1ec3a371336e9f7a757/Cheatsheets/Seaborn_statEstimation.ipynb" width="1000" height="700"></iframe></p>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="https://soundmemories.github.io/2020/04/25/ML/03.ML-Pandas/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avstar.png">
      <meta itemprop="name" content="SoundMemories">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="SoundMemories">
      <meta itemprop="description" content="今日事，今日毕">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | SoundMemories">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2020/04/25/ML/03.ML-Pandas/" class="post-title-link" itemprop="url">ML-Pandas</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>

      <time title="创建时间：2020-04-25 00:00:00" itemprop="dateCreated datePublished" datetime="2020-04-25T00:00:00+08:00">2020-04-25</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">分类于</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/ML/" itemprop="url" rel="index"><span itemprop="name">ML</span></a>
        </span>
    </span>

  
    <span class="post-meta-break"></span>
    <span class="post-meta-item" title="本文字数">
      <span class="post-meta-item-icon">
        <i class="far fa-file-word"></i>
      </span>
      <span class="post-meta-item-text">本文字数：</span>
      <span>40k</span>
    </span>
    <span class="post-meta-item" title="阅读时长">
      <span class="post-meta-item-icon">
        <i class="far fa-clock"></i>
      </span>
      <span class="post-meta-item-text">阅读时长 &asymp;</span>
      <span>2:26</span>
    </span>
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <h2 id="pandas概述">Pandas概述</h2>
<p>Pandas 是在 NumPy 基础上建立的新程序库，提供了一种高效的
DataFrame数据结构。 DataFrame
本质上是一种带行标签和列标签、支持相同类型数据和缺失值的多维数组。</p>
<p>NumPy 的 ndarray
数据结构为数值计算任务中常见的干净整齐、组织良好的数据提供了许多不可或缺的功能。虽然它在这方面做得很好，但是当我们需要处理更灵活的数据任务（如为数据添加标签、处理缺失值等），或者需要做一些不是对每个元素都进行广播映射的计算（如分组、透视表等）时，
NumPy
的限制就非常明显了，而这些都是分析各种非结构化数据时很重要的一部分。建立在
NumPy 数组结构上的Pandas，尤其是它的 Series 和 DataFrame
对象，为我们处理那些消耗大量时间的“数据清理”任务提供了捷径。</p>
<p>在安装 Pandas 之前，确保你的操作系统中有
NumPy。可使用<code>pip install pandas</code>安装pandas。如果你使用了
Anaconda，那么 Pandas 就已经安装好了。更详细的安装请参考<span class="exturl" data-url="aHR0cHM6Ly9wYW5kYXMucHlkYXRhLm9yZy9kb2NzL2dldHRpbmdfc3RhcnRlZC9pbnN0YWxsLmh0bWw=">官方文档<i class="fa fa-external-link-alt"></i></span>。<br />
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> pandas <span class="keyword">as</span> pd</span><br><span class="line"></span><br><span class="line"><span class="comment"># 查看包的版本</span></span><br><span class="line">pd.__version__</span><br><span class="line"><span class="comment"># 自动补全</span></span><br><span class="line">pd.&lt;TAB&gt;</span><br><span class="line"><span class="comment"># 内置的文档</span></span><br><span class="line">pd?</span><br></pre></td></tr></table></figure><br />
          <!--noindex-->
            <div class="post-button">
              <a class="btn" href="/2020/04/25/ML/03.ML-Pandas/#more" rel="contents">
                阅读全文 &raquo;
              </a>
            </div>
          <!--/noindex-->
        
      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="https://soundmemories.github.io/2020/04/22/ML/02.ML-NumPy/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avstar.png">
      <meta itemprop="name" content="SoundMemories">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="SoundMemories">
      <meta itemprop="description" content="今日事，今日毕">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | SoundMemories">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2020/04/22/ML/02.ML-NumPy/" class="post-title-link" itemprop="url">ML-NumPy</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>

      <time title="创建时间：2020-04-22 00:00:00" itemprop="dateCreated datePublished" datetime="2020-04-22T00:00:00+08:00">2020-04-22</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">分类于</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/ML/" itemprop="url" rel="index"><span itemprop="name">ML</span></a>
        </span>
    </span>

  
    <span class="post-meta-break"></span>
    <span class="post-meta-item" title="本文字数">
      <span class="post-meta-item-icon">
        <i class="far fa-file-word"></i>
      </span>
      <span class="post-meta-item-text">本文字数：</span>
      <span>18k</span>
    </span>
    <span class="post-meta-item" title="阅读时长">
      <span class="post-meta-item-icon">
        <i class="far fa-clock"></i>
      </span>
      <span class="post-meta-item-text">阅读时长 &asymp;</span>
      <span>1:07</span>
    </span>
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <h2 id="python数据的存储和操作">Python数据的存储和操作</h2>
<p>要实现高效的数据驱动的科学和计算，需要理解数据是如何被存储和操作的。Python
语言中数据数组是如何被处理的，并对比 NumPy
所做的改进。这也是理解其他数据科学工具的数据处理的基础。<br />
          <!--noindex-->
            <div class="post-button">
              <a class="btn" href="/2020/04/22/ML/02.ML-NumPy/#more" rel="contents">
                阅读全文 &raquo;
              </a>
            </div>
          <!--/noindex-->
        
      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="https://soundmemories.github.io/2020/04/21/ML/01.ML-IPython%E5%92%8CJupyter/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avstar.png">
      <meta itemprop="name" content="SoundMemories">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="SoundMemories">
      <meta itemprop="description" content="今日事，今日毕">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | SoundMemories">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2020/04/21/ML/01.ML-IPython%E5%92%8CJupyter/" class="post-title-link" itemprop="url">ML-IPython和Jupyter</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>

      <time title="创建时间：2020-04-21 00:00:00" itemprop="dateCreated datePublished" datetime="2020-04-21T00:00:00+08:00">2020-04-21</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">分类于</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/ML/" itemprop="url" rel="index"><span itemprop="name">ML</span></a>
        </span>
    </span>

  
    <span class="post-meta-break"></span>
    <span class="post-meta-item" title="本文字数">
      <span class="post-meta-item-icon">
        <i class="far fa-file-word"></i>
      </span>
      <span class="post-meta-item-text">本文字数：</span>
      <span>4.5k</span>
    </span>
    <span class="post-meta-item" title="阅读时长">
      <span class="post-meta-item-icon">
        <i class="far fa-clock"></i>
      </span>
      <span class="post-meta-item-text">阅读时长 &asymp;</span>
      <span>16 分钟</span>
    </span>
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <h2 id="ipython">IPython</h2>
<p>IPython（interactive Python 的简称，即交互式Python），由 Fernando
Perez 作为一个增强的 Python 解释器于 2001
年启动，并由此发展为一个项目。用 Perez
的原话来说，该项目致力于提供“科学计算的全生命周期开发工具”。如果将
Python 看作数据科学任务的引擎，那么 IPython 就是一个交互式控制面板。</p>
<p>IPython 除了作为 Python 的一个交互式接口，还提供了一些有用的 Python
语法附加功能（魔法命令），我会介绍其中最有用的一些。</p>
<p>另外，IPython 被紧密地连接在 <span class="exturl" data-url="aHR0cDovL2p1cHl0ZXIub3Jn">Jupyter项目<i class="fa fa-external-link-alt"></i></span> 中。该项目提供一个基于浏览器的
Notebook，它可以开发、协作、分享甚至发布数据科学结果。IPython Notebook
其实只是通用 Jupyter Notebook 结构的特例，而Jupyter Notebook 不仅支持
Python，还包括用于 Julia、 R 和其他编程语言的 Notebook。<br />
          <!--noindex-->
            <div class="post-button">
              <a class="btn" href="/2020/04/21/ML/01.ML-IPython%E5%92%8CJupyter/#more" rel="contents">
                阅读全文 &raquo;
              </a>
            </div>
          <!--/noindex-->
        
      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="https://soundmemories.github.io/2020/04/20/ML/00.ML-%E6%9C%BA%E5%99%A8%E5%AD%A6%E4%B9%A0%EF%BC%9F/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avstar.png">
      <meta itemprop="name" content="SoundMemories">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="SoundMemories">
      <meta itemprop="description" content="今日事，今日毕">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | SoundMemories">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2020/04/20/ML/00.ML-%E6%9C%BA%E5%99%A8%E5%AD%A6%E4%B9%A0%EF%BC%9F/" class="post-title-link" itemprop="url">ML-机器学习？</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>

      <time title="创建时间：2020-04-20 00:00:00" itemprop="dateCreated datePublished" datetime="2020-04-20T00:00:00+08:00">2020-04-20</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">分类于</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/ML/" itemprop="url" rel="index"><span itemprop="name">ML</span></a>
        </span>
    </span>

  
    <span class="post-meta-break"></span>
    <span class="post-meta-item" title="本文字数">
      <span class="post-meta-item-icon">
        <i class="far fa-file-word"></i>
      </span>
      <span class="post-meta-item-text">本文字数：</span>
      <span>1.7k</span>
    </span>
    <span class="post-meta-item" title="阅读时长">
      <span class="post-meta-item-icon">
        <i class="far fa-clock"></i>
      </span>
      <span class="post-meta-item-text">阅读时长 &asymp;</span>
      <span>6 分钟</span>
    </span>
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <h2 id="准备">准备</h2>
<p>数据科学领域常用的是Python，因为它的第三方程序包拥有庞大而活跃的生态系统，需要你有一定的
<span class="exturl" data-url="aHR0cHM6Ly9kb2NzLnB5dGhvbi5vcmcvMy8=">Python<i class="fa fa-external-link-alt"></i></span>
编程经验，而且熟悉Python中的主流科学计算库：<br />
（1）<span class="exturl" data-url="aHR0cHM6Ly9udW1weS5vcmcv">Numpy<i class="fa fa-external-link-alt"></i></span>：可以处理同类型数组型数据。<br />
（2）<span class="exturl" data-url="aHR0cHM6Ly93d3cuc2NpcHkub3JnLw==">SciPy<i class="fa fa-external-link-alt"></i></span>：可以处理多种类型带标签的数据。<br />
（3）<span class="exturl" data-url="aHR0cHM6Ly9wYW5kYXMucHlkYXRhLm9yZy8=">Pandas<i class="fa fa-external-link-alt"></i></span>：可以解决常见的科学计算问题。<br />
（4）<span class="exturl" data-url="aHR0cHM6Ly9tYXRwbG90bGliLm9yZy8=">Matplotlib<i class="fa fa-external-link-alt"></i></span>：可以绘制可用于印刷的可视化图形。<br />
以及Python机器/深度学习框架：<br />
（1）<span class="exturl" data-url="aHR0cHM6Ly9zY2lraXQtbGVhcm4ub3JnLw==">Scikit-Learn<i class="fa fa-external-link-alt"></i></span>：实现了众多机器学习算法。<br />
（2）<span class="exturl" data-url="aHR0cHM6Ly90ZW5zb3JmbG93Lmdvb2dsZS5jbi8=">TensorFlow<i class="fa fa-external-link-alt"></i></span>：使用数据流图进行分布式运算，可在多个GPU服务器上分配运算，针对大型项目和深度学习项目。Google开源框架。<br />
（3）<span class="exturl" data-url="aHR0cHM6Ly93d3cucGFkZGxlcGFkZGxlLm9yZy5jbi8=">PaddlePaddle<i class="fa fa-external-link-alt"></i></span>：同TensorFlow，Baidu开源框架。</p>
<p>编程环境建议使用Python的<span class="exturl" data-url="aHR0cHM6Ly9qdXB5dGVyLm9yZy8=">Jupyter
Notebook<i class="fa fa-external-link-alt"></i></span>，这是一个非常好用的工具，支持多种语言编程，还可以写笔记。它依托的Python底层环境是IPython，所以IPython的魔法命令也可以用在Jupyter上。</p>
<p>另外，如果你想深入理解底层的原理，则需要大学水平的数学知识（微积分、线性代数、概率论和统计学）。</p>
<h2 id="软件安装">软件安装</h2>
<p>安装 Python
和科学计算程序库的方法有很多，推荐使用Anaconda发行版，Windows、Linux 和
Mac OS操作系统的安装和使用方式类似。</p>
<p>Anaconda 发行版有两种：<br />
（1）<span class="exturl" data-url="aHR0cHM6Ly9kb2NzLmNvbmRhLmlvL2VuL2xhdGVzdC9taW5pY29uZGEuaHRtbA==">Miniconda<i class="fa fa-external-link-alt"></i></span>：只包含
Python 解释器和一个名为conda 的命令行工具。 conda
是一个跨平台的程序包管理器，可以管理各种 Python 程序包，类似于 Linux
用户熟悉的 apt 和 yum 程序包管理器。<br />
（2）<span class="exturl" data-url="aHR0cHM6Ly93d3cuYW5hY29uZGEuY29tL3Byb2R1Y3RzL2luZGl2aWR1YWwjRG93bmxvYWRz">Anaconda<i class="fa fa-external-link-alt"></i></span>：除了包含
Python 和 conda
之外，还同时绑定了四五百个科学计算程序包。由于预安装了许多包，因此安装它需要占用几个G字节的存储空间。</p>
<p>如果安装了 Miniconda，所有程序包（包括
Anaconda）都可以手动安装。因此，我推荐先安装
Miniconda，其他包视情况安装。<br />
首先，下载并安装 Miniconda 程序包（确认你选择的是适合 Python 3
的版本），然后安装几个重要程序包。<br />
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[~]$ conda install numpy pandas scikit-learn matplotlib seaborn ipython-notebook</span><br></pre></td></tr></table></figure><br />
若使用其他更专业的 Python 科学计算工具，安装方法同样很简单，就是 conda
install 程序包名称。关于 conda 的更多信息，包括 conda
虚拟环境（强烈推荐）的创建和使用，请参考 <span class="exturl" data-url="aHR0cDovL2NvbmRhLnB5ZGF0YS5vcmcvZG9jcy8=">conda 在线文档<i class="fa fa-external-link-alt"></i></span>。<br />
          <!--noindex-->
            <div class="post-button">
              <a class="btn" href="/2020/04/20/ML/00.ML-%E6%9C%BA%E5%99%A8%E5%AD%A6%E4%B9%A0%EF%BC%9F/#more" rel="contents">
                阅读全文 &raquo;
              </a>
            </div>
          <!--/noindex-->
        
      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="https://soundmemories.github.io/2020/03/17/Java/30.Java%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avstar.png">
      <meta itemprop="name" content="SoundMemories">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="SoundMemories">
      <meta itemprop="description" content="今日事，今日毕">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | SoundMemories">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2020/03/17/Java/30.Java%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F/" class="post-title-link" itemprop="url">Java设计模式</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>

      <time title="创建时间：2020-03-17 00:00:00" itemprop="dateCreated datePublished" datetime="2020-03-17T00:00:00+08:00">2020-03-17</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">分类于</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/Java/" itemprop="url" rel="index"><span itemprop="name">Java</span></a>
        </span>
    </span>

  
    <span class="post-meta-break"></span>
    <span class="post-meta-item" title="本文字数">
      <span class="post-meta-item-icon">
        <i class="far fa-file-word"></i>
      </span>
      <span class="post-meta-item-text">本文字数：</span>
      <span>3.1k</span>
    </span>
    <span class="post-meta-item" title="阅读时长">
      <span class="post-meta-item-icon">
        <i class="far fa-clock"></i>
      </span>
      <span class="post-meta-item-text">阅读时长 &asymp;</span>
      <span>11 分钟</span>
    </span>
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <h2 id="设计模式">设计模式</h2>
<p>说白了，就是解决问题的套路，代码结构。<br />
Java中常用的设计模式有23种。</p>
<p>JavaSE阶段给大家普及几个：<br />
（1）模板设计模式（做到能模仿（3星））<br />
（2）单例设计模式（做到脱稿能写（5星））<br />
（3）工厂设计模式（做到会调用工厂类的方法（2星））<br />
（4）代理设计模式（做到能模仿（3星））<br />
（5）迭代器设计模式（了解）<br />
（6）装饰者设计模式（了解）<br />
其他复杂设计模式，做到能看懂代码，能认识。<br />
          <!--noindex-->
            <div class="post-button">
              <a class="btn" href="/2020/03/17/Java/30.Java%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F/#more" rel="contents">
                阅读全文 &raquo;
              </a>
            </div>
          <!--/noindex-->
        
      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="https://soundmemories.github.io/2020/03/14/Java/29.Java%20Lambda%E4%B8%8E%E5%87%BD%E6%95%B0%E5%BC%8F%E6%8E%A5%E5%8F%A3/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avstar.png">
      <meta itemprop="name" content="SoundMemories">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="SoundMemories">
      <meta itemprop="description" content="今日事，今日毕">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | SoundMemories">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2020/03/14/Java/29.Java%20Lambda%E4%B8%8E%E5%87%BD%E6%95%B0%E5%BC%8F%E6%8E%A5%E5%8F%A3/" class="post-title-link" itemprop="url">Java Lambda与函数式接口</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>

      <time title="创建时间：2020-03-14 00:00:00" itemprop="dateCreated datePublished" datetime="2020-03-14T00:00:00+08:00">2020-03-14</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">分类于</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/Java/" itemprop="url" rel="index"><span itemprop="name">Java</span></a>
        </span>
    </span>

  
    <span class="post-meta-break"></span>
    <span class="post-meta-item" title="本文字数">
      <span class="post-meta-item-icon">
        <i class="far fa-file-word"></i>
      </span>
      <span class="post-meta-item-text">本文字数：</span>
      <span>8k</span>
    </span>
    <span class="post-meta-item" title="阅读时长">
      <span class="post-meta-item-icon">
        <i class="far fa-clock"></i>
      </span>
      <span class="post-meta-item-text">阅读时长 &asymp;</span>
      <span>29 分钟</span>
    </span>
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <h2 id="lambda表达式">Lambda表达式</h2>
          <!--noindex-->
            <div class="post-button">
              <a class="btn" href="/2020/03/14/Java/29.Java%20Lambda%E4%B8%8E%E5%87%BD%E6%95%B0%E5%BC%8F%E6%8E%A5%E5%8F%A3/#more" rel="contents">
                阅读全文 &raquo;
              </a>
            </div>
          <!--/noindex-->
        
      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




  <nav class="pagination">
    <a class="extend prev" rel="prev" title="上一页" aria-label="上一页" href="/page/6/"><i class="fa fa-angle-left"></i></a><a class="page-number" href="/">1</a><span class="space">&hellip;</span><a class="page-number" href="/page/6/">6</a><span class="page-number current">7</span><a class="page-number" href="/page/8/">8</a><span class="space">&hellip;</span><a class="page-number" href="/page/13/">13</a><a class="extend next" rel="next" title="下一页" aria-label="下一页" href="/page/8/"><i class="fa fa-angle-right"></i></a>
  </nav>

</div>
  </main>

  <footer class="footer">
    <div class="footer-inner">

  <div class="copyright">
    &copy; 2019 – 
    <span itemprop="copyrightYear">2024</span>
    <span class="with-love">
      <i class="fa fa-heart"></i>
    </span>
    <span class="author" itemprop="copyrightHolder">SoundMemories</span>
  </div>
  <div class="powered-by">由 <span class="exturl" data-url="aHR0cHM6Ly9oZXhvLmlv">Hexo</span> & <span class="exturl" data-url="aHR0cHM6Ly90aGVtZS1uZXh0LmpzLm9yZy9tdXNlLw==">NexT.Muse</span> 强力驱动
  </div>

    </div>
  </footer>

  
  <div class="toggle sidebar-toggle" role="button">
    <span class="toggle-line"></span>
    <span class="toggle-line"></span>
    <span class="toggle-line"></span>
  </div>
  <div class="sidebar-dimmer"></div>
  <div class="back-to-top" role="button" aria-label="返回顶部">
    <i class="fa fa-arrow-up fa-lg"></i>
    <span>0%</span>
  </div>
  <a role="button" class="book-mark-link book-mark-link-fixed"></a>

<noscript>
  <div class="noscript-warning">Theme NexT works best with JavaScript enabled</div>
</noscript>


  
  <script src="https://cdnjs.cloudflare.com/ajax/libs/animejs/3.2.1/anime.min.js" integrity="sha256-XL2inqUJaslATFnHdJOi9GfQ60on8Wx1C2H8DYiN1xY=" crossorigin="anonymous"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/next-theme-pjax/0.6.0/pjax.min.js" integrity="sha256-vxLn1tSKWD4dqbMRyv940UYw4sXgMtYcK6reefzZrao=" crossorigin="anonymous"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.7.0/jquery.min.js" integrity="sha256-2Pmvv0kuTBOenSvLm6bvfBSSHrUJ+3A7x6P5Ebd07/g=" crossorigin="anonymous"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/fancybox/3.5.7/jquery.fancybox.min.js" integrity="sha256-yt2kYMy0w8AbtF89WXb2P1rfjcP/HTHLT7097U8Y5b8=" crossorigin="anonymous"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/medium-zoom/1.0.8/medium-zoom.min.js" integrity="sha256-7PhEpEWEW0XXQ0k6kQrPKwuoIomz8R8IYyuU1Qew4P8=" crossorigin="anonymous"></script>
<script src="/js/comments.js"></script><script src="/js/utils.js"></script><script src="/js/motion.js"></script><script src="/js/schemes/muse.js"></script><script src="/js/next-boot.js"></script><script src="/js/bookmark.js"></script><script src="/js/pjax.js"></script>

  <script src="https://cdnjs.cloudflare.com/ajax/libs/hexo-generator-searchdb/1.4.1/search.js" integrity="sha256-1kfA5uHPf65M5cphT2dvymhkuyHPQp5A53EGZOnOLmc=" crossorigin="anonymous"></script>
<script src="/js/third-party/search/local-search.js"></script>

  <script class="next-config" data-name="pdf" type="application/json">{"object_url":{"url":"https://cdnjs.cloudflare.com/ajax/libs/pdfobject/2.2.12/pdfobject.min.js","integrity":"sha256-g2xji1rlE3KsGVClvuxTbcR0Kn2+wtQADSff2Tbb4zA="},"url":"/lib/pdf/web/viewer.html"}</script>
  <script src="/js/third-party/tags/pdf.js"></script>

  <script class="next-config" data-name="mermaid" type="application/json">{"enable":true,"theme":{"light":"neutral","dark":"neutral"},"js":{"url":"https://cdnjs.cloudflare.com/ajax/libs/mermaid/10.2.3/mermaid.min.js","integrity":"sha256-JFptYy4KzJ5OQP+Q9fubNf3cxpPPmZKqUOovyEONKrQ="}}</script>
  <script src="/js/third-party/tags/mermaid.js"></script>


  <script src="/js/third-party/fancybox.js"></script>



  




  

  <script class="next-config" data-name="enableMath" type="application/json">true</script><script class="next-config" data-name="mathjax" type="application/json">{"enable":true,"tags":"none","js":{"url":"https://cdnjs.cloudflare.com/ajax/libs/mathjax/3.2.2/es5/tex-mml-chtml.js","integrity":"sha256-MASABpB4tYktI2Oitl4t+78w/lyA+D7b/s9GEP0JOGI="}}</script>
<script src="/js/third-party/math/mathjax.js"></script>


  <script src="https://cdnjs.cloudflare.com/ajax/libs/quicklink/2.3.0/quicklink.umd.js" integrity="sha256-yvJQOINiH9fWemHn0vCA5lsHWJaHs6/ZmO+1Ft04SvM=" crossorigin="anonymous"></script>
  <script class="next-config" data-name="quicklink" type="application/json">{"enable":true,"home":true,"archive":true,"delay":true,"timeout":3000,"priority":true,"url":"https://soundmemories.github.io/page/7/"}</script>
  <script src="/js/third-party/quicklink.js"></script>

</body>
</html>
