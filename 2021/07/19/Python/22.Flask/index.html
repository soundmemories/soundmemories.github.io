<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width">
<meta name="theme-color" content="#222" media="(prefers-color-scheme: light)">
<meta name="theme-color" content="#222" media="(prefers-color-scheme: dark)"><meta name="generator" content="Hexo 6.3.0">

  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png">
  <link rel="mask-icon" href="/images/logo.svg" color="#222">

<link rel="stylesheet" href="/css/main.css">

<link rel="stylesheet" href="https://fonts.loli.net/css?family=Monda:300,300italic,400,400italic,700,700italic&display=swap&subset=latin,latin-ext">

<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" integrity="sha256-HtsXJanqjKTc8vVQjO4YMhiqFoXkfBsjBWcX91T1jr8=" crossorigin="anonymous">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/animate.css/3.1.1/animate.min.css" integrity="sha256-PR7ttpcvz8qrF57fur/yAx1qXMFJeJFiA6pSzWi0OIE=" crossorigin="anonymous">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/fancybox/3.5.7/jquery.fancybox.min.css" integrity="sha256-Vzbj7sDDS/woiFS3uNKo8eIuni59rjyNGtXfstRzStA=" crossorigin="anonymous">

<script class="next-config" data-name="main" type="application/json">{"hostname":"soundmemories.github.io","root":"/","images":"/images","scheme":"Muse","darkmode":true,"version":"8.17.1","exturl":true,"sidebar":{"position":"left","display":"always","padding":18,"offset":12},"copycode":{"enable":true,"style":null},"bookmark":{"enable":true,"color":"#222","save":"auto"},"mediumzoom":true,"lazyload":false,"pangu":false,"comments":{"style":"tabs","active":null,"storage":true,"lazyload":false,"nav":null},"stickytabs":false,"motion":{"enable":true,"async":false,"transition":{"menu_item":"fadeInDown","post_block":"fadeIn","post_header":"fadeInDown","post_body":"fadeInDown","coll_header":"fadeInLeft","sidebar":"fadeInUp"}},"prism":false,"i18n":{"placeholder":"搜索...","empty":"没有找到任何搜索结果：${query}","hits_time":"找到 ${hits} 个搜索结果（用时 ${time} 毫秒）","hits":"找到 ${hits} 个搜索结果"},"path":"/search.xml","localsearch":{"enable":true,"trigger":"auto","top_n_per_article":1,"unescape":false,"preload":false}}</script><script src="/js/config.js"></script>

    <meta name="description" content="Web框架 WSGI：Web服务器网关接口（Python Web Server Gateway Interface，缩写为WSGI）是为Python语言定义的Web服务器和Web应用程序或框架之间的一种简单而通用的接口，如，WSGI服务器Gunicorn。 Web服务器：Web服务器一般指网站服务器，是指驻留于因特网上某种类型计算机的程序，可以处理浏览器等Web客户端的请求并返回相应响应，也">
<meta property="og:type" content="article">
<meta property="og:title" content="Flask">
<meta property="og:url" content="https://soundmemories.github.io/2021/07/19/Python/22.Flask/index.html">
<meta property="og:site_name" content="SoundMemories">
<meta property="og:description" content="Web框架 WSGI：Web服务器网关接口（Python Web Server Gateway Interface，缩写为WSGI）是为Python语言定义的Web服务器和Web应用程序或框架之间的一种简单而通用的接口，如，WSGI服务器Gunicorn。 Web服务器：Web服务器一般指网站服务器，是指驻留于因特网上某种类型计算机的程序，可以处理浏览器等Web客户端的请求并返回相应响应，也">
<meta property="og:locale" content="zh_CN">
<meta property="og:image" content="https://soundmemories.github.io/images/Python/web.png">
<meta property="article:published_time" content="2021-07-18T16:00:00.000Z">
<meta property="article:modified_time" content="2024-07-15T05:21:20.586Z">
<meta property="article:author" content="SoundMemories">
<meta property="article:tag" content="Python">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://soundmemories.github.io/images/Python/web.png">


<link rel="canonical" href="https://soundmemories.github.io/2021/07/19/Python/22.Flask/">



<script class="next-config" data-name="page" type="application/json">{"sidebar":"","isHome":false,"isPost":true,"lang":"zh-CN","comments":"","permalink":"https://soundmemories.github.io/2021/07/19/Python/22.Flask/","path":"2021/07/19/Python/22.Flask/","title":"Flask"}</script>

<script class="next-config" data-name="calendar" type="application/json">""</script>
<title>Flask | SoundMemories</title>
  








  <noscript>
    <link rel="stylesheet" href="/css/noscript.css">
  </noscript>
</head>

<body itemscope itemtype="http://schema.org/WebPage" class="use-motion">
  <div class="headband"></div>

  <main class="main">
    <div class="column">
      <header class="header" itemscope itemtype="http://schema.org/WPHeader"><div class="site-brand-container">
  <div class="site-nav-toggle">
    <div class="toggle" aria-label="切换导航栏" role="button">
        <span class="toggle-line"></span>
        <span class="toggle-line"></span>
        <span class="toggle-line"></span>
    </div>
  </div>

  <div class="site-meta">

    <a href="/" class="brand" rel="start">
      <i class="logo-line"></i>
      <p class="site-title">SoundMemories</p>
      <i class="logo-line"></i>
    </a>
  </div>

  <div class="site-nav-right">
    <div class="toggle popup-trigger" aria-label="搜索" role="button">
        <i class="fa fa-search fa-fw fa-lg"></i>
    </div>
  </div>
</div>



<nav class="site-nav">
  <ul class="main-menu menu"><li class="menu-item menu-item-home"><a href="/" rel="section"><i class="fa fa-home fa-fw"></i>首页</a></li><li class="menu-item menu-item-tags"><a href="/tags/" rel="section"><i class="fa fa-tags fa-fw"></i>标签<span class="badge">10</span></a></li><li class="menu-item menu-item-categories"><a href="/categories/" rel="section"><i class="fa fa-th fa-fw"></i>分类<span class="badge">10</span></a></li><li class="menu-item menu-item-archives"><a href="/archives/" rel="section"><i class="fa fa-archive fa-fw"></i>归档<span class="badge">129</span></a></li>
      <li class="menu-item menu-item-search">
        <a role="button" class="popup-trigger"><i class="fa fa-search fa-fw"></i>搜索
        </a>
      </li>
  </ul>
</nav>



  <div class="search-pop-overlay">
    <div class="popup search-popup"><div class="search-header">
  <span class="search-icon">
    <i class="fa fa-search"></i>
  </span>
  <div class="search-input-container">
    <input autocomplete="off" autocapitalize="off" maxlength="80"
           placeholder="搜索..." spellcheck="false"
           type="search" class="search-input">
  </div>
  <span class="popup-btn-close" role="button">
    <i class="fa fa-times-circle"></i>
  </span>
</div>
<div class="search-result-container no-result">
  <div class="search-result-icon">
    <i class="fa fa-spinner fa-pulse fa-5x"></i>
  </div>
</div>

    </div>
  </div>

</header>
        
  
  <aside class="sidebar">

    <div class="sidebar-inner sidebar-nav-active sidebar-toc-active">
      <ul class="sidebar-nav">
        <li class="sidebar-nav-toc">
          文章目录
        </li>
        <li class="sidebar-nav-overview">
          站点概览
        </li>
      </ul>

      <div class="sidebar-panel-container">
        <!--noindex-->
        <div class="post-toc-wrap sidebar-panel">
            <div class="post-toc animated"><ol class="nav"><li class="nav-item nav-level-1"><a class="nav-link" href="#web%E6%A1%86%E6%9E%B6"><span class="nav-number">1.</span> <span class="nav-text">Web框架</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#flask%E4%BB%8B%E7%BB%8D"><span class="nav-number">2.</span> <span class="nav-text">Flask介绍</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#%E6%A1%86%E6%9E%B6%E5%AF%B9%E6%AF%94"><span class="nav-number">2.1.</span> <span class="nav-text">框架对比</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%AE%89%E8%A3%85"><span class="nav-number">2.2.</span> <span class="nav-text">安装</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#%E5%B7%A5%E7%A8%8B%E6%90%AD%E5%BB%BA"><span class="nav-number">3.</span> <span class="nav-text">工程搭建</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#%E9%85%8D%E7%BD%AE%E5%8F%82%E6%95%B0"><span class="nav-number">3.1.</span> <span class="nav-text">配置参数</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E8%BF%90%E8%A1%8C%E5%8F%82%E6%95%B0"><span class="nav-number">3.2.</span> <span class="nav-text">运行参数</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E7%BB%88%E7%AB%AF%E5%90%AF%E5%8A%A8"><span class="nav-number">3.3.</span> <span class="nav-text">终端启动</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#%E8%B7%AF%E7%94%B1"><span class="nav-number">4.</span> <span class="nav-text">路由</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#%E8%B7%AF%E7%94%B1%E4%BF%A1%E6%81%AF"><span class="nav-number">4.1.</span> <span class="nav-text">路由信息</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E8%B7%AF%E7%94%B1%E9%87%8D%E5%AE%9A%E5%90%91"><span class="nav-number">4.2.</span> <span class="nav-text">路由重定向</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#%E8%93%9D%E5%9B%BE%E5%AD%90%E8%B7%AF%E7%94%B1"><span class="nav-number">5.</span> <span class="nav-text">蓝图（子路由）</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#%E8%93%9D%E5%9B%BE%E5%88%9B%E5%BB%BA"><span class="nav-number">5.1.</span> <span class="nav-text">蓝图创建</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E6%89%A9%E5%B1%95%E7%94%A8%E6%B3%95"><span class="nav-number">5.2.</span> <span class="nav-text">扩展用法</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#%E8%AF%B7%E6%B1%82"><span class="nav-number">6.</span> <span class="nav-text">请求</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#%E8%AF%B7%E6%B1%82%E6%96%B9%E5%BC%8F"><span class="nav-number">6.1.</span> <span class="nav-text">请求方式</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E8%AF%B7%E6%B1%82%E5%8F%82%E6%95%B0"><span class="nav-number">6.2.</span> <span class="nav-text">请求参数</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E8%B7%AF%E5%BE%84%E5%8F%82%E6%95%B0%E5%8A%A8%E6%80%81%E8%B7%AF%E7%94%B1"><span class="nav-number">6.3.</span> <span class="nav-text">路径参数（动态路由）</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E8%AF%B7%E6%B1%82%E9%92%A9%E5%AD%90"><span class="nav-number">6.4.</span> <span class="nav-text">请求钩子</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E4%B8%8A%E4%B8%8B%E6%96%87"><span class="nav-number">6.5.</span> <span class="nav-text">上下文</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#%E5%93%8D%E5%BA%94"><span class="nav-number">7.</span> <span class="nav-text">响应</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#%E9%87%8D%E5%AE%9A%E5%90%91"><span class="nav-number">7.1.</span> <span class="nav-text">重定向</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#json"><span class="nav-number">7.2.</span> <span class="nav-text">Json</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E8%87%AA%E5%AE%9A%E4%B9%89%E5%93%8D%E5%BA%94"><span class="nav-number">7.3.</span> <span class="nav-text">自定义响应</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#cookie"><span class="nav-number">7.4.</span> <span class="nav-text">Cookie</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#session"><span class="nav-number">7.5.</span> <span class="nav-text">Session</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E6%A8%A1%E6%9D%BF%E6%B8%B2%E6%9F%93"><span class="nav-number">7.6.</span> <span class="nav-text">模板渲染</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#%E5%BC%82%E5%B8%B8"><span class="nav-number">8.</span> <span class="nav-text">异常</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#%E4%B8%BB%E5%8A%A8%E6%8A%9B%E5%87%BA"><span class="nav-number">8.1.</span> <span class="nav-text">主动抛出</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#jinja2%E6%A8%A1%E6%9D%BF"><span class="nav-number">9.</span> <span class="nav-text">Jinja2模板</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#%E6%A8%A1%E6%9D%BF%E4%BC%A0%E5%8F%82"><span class="nav-number">9.1.</span> <span class="nav-text">模板传参</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E6%8E%A7%E5%88%B6%E8%AF%AD%E5%8F%A5"><span class="nav-number">9.2.</span> <span class="nav-text">控制语句</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E8%BF%87%E6%BB%A4%E5%99%A8%E8%BD%AC%E6%8D%A2%E5%87%BD%E6%95%B0"><span class="nav-number">9.3.</span> <span class="nav-text">过滤器（转换函数）</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E6%B5%8B%E8%AF%95%E5%99%A8"><span class="nav-number">9.4.</span> <span class="nav-text">测试器</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E7%BB%A7%E6%89%BF"><span class="nav-number">9.5.</span> <span class="nav-text">继承</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#url_for"><span class="nav-number">9.6.</span> <span class="nav-text">url_for</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#%E5%8F%82%E8%80%83%E6%96%87%E7%8C%AE"><span class="nav-number">10.</span> <span class="nav-text">参考文献</span></a></li></ol></div>
        </div>
        <!--/noindex-->

        <div class="site-overview-wrap sidebar-panel">
          <div class="site-author animated" itemprop="author" itemscope itemtype="http://schema.org/Person">
    <img class="site-author-image" itemprop="image" alt="SoundMemories"
      src="/images/avstar.png">
  <p class="site-author-name" itemprop="name">SoundMemories</p>
  <div class="site-description" itemprop="description">今日事，今日毕</div>
</div>
<div class="site-state-wrap animated">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
        <a href="/archives/">
          <span class="site-state-item-count">129</span>
          <span class="site-state-item-name">日志</span>
        </a>
      </div>
      <div class="site-state-item site-state-categories">
          <a href="/categories/">
        <span class="site-state-item-count">10</span>
        <span class="site-state-item-name">分类</span></a>
      </div>
      <div class="site-state-item site-state-tags">
          <a href="/tags/">
        <span class="site-state-item-count">10</span>
        <span class="site-state-item-name">标签</span></a>
      </div>
  </nav>
</div>
  <div class="links-of-author animated">
      <span class="links-of-author-item">
        <span class="exturl" data-url="aHR0cHM6Ly9naXRodWIuY29tL3NvdW5kbWVtb3JpZXM=" title="GitHub → https:&#x2F;&#x2F;github.com&#x2F;soundmemories"><i class="fab fa-github fa-fw"></i>GitHub</span>
      </span>
      <span class="links-of-author-item">
        <span class="exturl" data-url="bWFpbHRvOnNvdW5kbWVtb3JpZXNAMTYzLmNvbQ==" title="E-Mail → mailto:soundmemories@163.com"><i class="fa fa-envelope fa-fw"></i>E-Mail</span>
      </span>
  </div>
  <div class="cc-license animated" itemprop="license">
    <span class="exturl cc-opacity" data-url="aHR0cHM6Ly9jcmVhdGl2ZWNvbW1vbnMub3JnL2xpY2Vuc2VzL2J5LW5jLXNhLzQuMC8="><img src="https://cdnjs.cloudflare.com/ajax/libs/creativecommons-vocabulary/2020.11.3/assets/license_badges/small/by_nc_sa.svg" alt="Creative Commons"></span>
  </div>

        </div>
      </div>
    </div>

    
        <div class="pjax">
        </div>
  </aside>


    </div>

    <div class="main-inner post posts-expand">


  


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="https://soundmemories.github.io/2021/07/19/Python/22.Flask/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avstar.png">
      <meta itemprop="name" content="SoundMemories">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="SoundMemories">
      <meta itemprop="description" content="今日事，今日毕">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="Flask | SoundMemories">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h1 class="post-title" itemprop="name headline">
          Flask
        </h1>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>

      <time title="创建时间：2021-07-19 00:00:00" itemprop="dateCreated datePublished" datetime="2021-07-19T00:00:00+08:00">2021-07-19</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">分类于</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/Python/" itemprop="url" rel="index"><span itemprop="name">Python</span></a>
        </span>
    </span>

  
    <span class="post-meta-break"></span>
    <span class="post-meta-item" title="本文字数">
      <span class="post-meta-item-icon">
        <i class="far fa-file-word"></i>
      </span>
      <span class="post-meta-item-text">本文字数：</span>
      <span>10k</span>
    </span>
    <span class="post-meta-item" title="阅读时长">
      <span class="post-meta-item-icon">
        <i class="far fa-clock"></i>
      </span>
      <span class="post-meta-item-text">阅读时长 &asymp;</span>
      <span>36 分钟</span>
    </span>
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody"><h1 id="web框架">Web框架</h1>
<p><strong>WSGI</strong>：Web服务器网关接口（Python Web Server Gateway
Interface，缩写为WSGI）是为Python语言定义的Web服务器和Web应用程序或框架之间的一种简单而通用的接口，如，WSGI服务器Gunicorn。<br />
<strong>Web服务器</strong>：Web服务器一般指网站服务器，是指驻留于因特网上某种类型计算机的程序，可以处理浏览器等Web客户端的请求并返回相应响应，也可以放置网站文件，让全世界浏览；可以放置数据文件，让全世界下载。目前最主流的三个Web服务器是Apache、
Nginx 、IIS。<br />
<strong>Web框架</strong>：是一种开发框架，用来支持动态网站、网络应用程序及网络服务的开发。<br />
<strong>静态资源</strong>：不需要经常变化的资源，这种资源web服务器可以提前准备好，比如:
png/jpg/css/js等文件。<br />
<strong>动态资源</strong>：和静态资源相反, 这种资源会经常变化，比如:
我们在京东浏览商品时经常会根据条件进行筛选，选择不同条件,
浏览的商品就不同，这种资源web服务器无法提前准备好，需要web框架来帮web服务器进行准备，在这里web服务器可以把.html的资源请求认为是动态资源请求交由web框架进行处理。</p>
<p>Flask项目架构一般为<code>Nginx（Web服务器） + Gunicorn（WSGI服务器） + Flask</code>。<br />
<img src="/images/Python/web.png" width="80%"></p>
<h1 id="flask介绍">Flask介绍</h1>
<p>Flask诞生于2010年，是Armin ronacher（人名）用 Python 语言基于
Werkzeug 工具箱编写的轻量级Web开发框架。它也遵循MVC设计模式：<br />
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">MVC：</span><br><span class="line">    M Model 数据模型</span><br><span class="line">    V view  界面</span><br><span class="line">    C controller 控制器</span><br><span class="line">MTV：</span><br><span class="line">    M Models 模型（数据）</span><br><span class="line">    T Templates  模板（界面）</span><br><span class="line">    V Views 视图（控制器）</span><br></pre></td></tr></table></figure></p>
<p>Flask
本身相当于一个内核，其他几乎所有的功能都要用到扩展（邮件扩展Flask-Mail，用户认证Flask-Login，数据库Flask-SQLAlchemy），都需要用第三方的扩展来实现。比如可以用
Flask 扩展加入ORM、窗体验证工具，文件上传、身份验证等。Flask
没有默认使用的数据库，你可以选择 MySQL，也可以用
NoSQL。<strong>其WSGI工具箱采用 Werkzeug（路由模块），模板引擎则使用
Jinja2</strong>。这两个也是 Flask 框架的核心。</p>
<p>Flask有1.x和2.x版本，项目稳定性有要求推荐1.x。</p>
<h2 id="框架对比">框架对比</h2>
<p>重量级框架：为方便业务程序的开发，提供了丰富的工具、组件，如Django。<br />
轻量级框架：只提供Web框架的核心功能，自由、灵活、高度定制，如Flask、Tornado。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># django提供了：</span></span><br><span class="line"><span class="number">1.</span> django-admin快速创建项目工程目录</span><br><span class="line"><span class="number">2.</span> manage.py 管理项目工程</span><br><span class="line"><span class="number">3.</span> orm模型（数据库抽象层）</span><br><span class="line"><span class="number">4.</span> admin后台管理站点</span><br><span class="line"><span class="number">5.</span> 缓存机制</span><br><span class="line"><span class="number">6.</span> 文件存储系统</span><br><span class="line"><span class="number">7.</span> 用户认证系统</span><br><span class="line"><span class="comment"># flask本身没有上面这些功能，需要扩展包来提供：</span></span><br><span class="line"><span class="comment"># 扩展列表：http://flask.pocoo.org/extensions/</span></span><br><span class="line">Flask-SQLalchemy：操作数据库；</span><br><span class="line">Flask-script：插入脚本；</span><br><span class="line">Flask-migrate：管理迁移数据库；</span><br><span class="line">Flask-Session：Session存储方式指定；</span><br><span class="line">Flask-WTF：表单；</span><br><span class="line">Flask-Mail：邮件；</span><br><span class="line">Flask-Bable：提供国际化和本地化支持，翻译；</span><br><span class="line">Flask-Login：认证用户状态；</span><br><span class="line">Flask-OpenID：认证；</span><br><span class="line">**Flask-RESTful：开发REST API的工具；**</span><br><span class="line">Flask-Bootstrap：集成前端Twitter Bootstrap框架；</span><br><span class="line">Flask-Moment：本地化日期和时间；</span><br><span class="line">Flask-Admin：简单而可扩展的管理接口的框架</span><br></pre></td></tr></table></figure>
<h2 id="安装">安装</h2>
<p>建议初学者创建虚拟环境<code>conda create -n flask python=3.8</code>，再<code>pip install flask</code>。<br />
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 虚拟环境</span></span><br><span class="line">conda create -n flask python=<span class="number">3.8</span>  <span class="comment"># 创建虚拟环境</span></span><br><span class="line">conda env remove -name flask  <span class="comment"># 删除虚拟环境</span></span><br><span class="line">conda activate flask  <span class="comment"># 进入虚拟环境</span></span><br><span class="line">conda deactivate  <span class="comment"># 退出虚拟环境</span></span><br><span class="line"><span class="comment"># pip</span></span><br><span class="line">pip install  <span class="comment"># 安装依赖包</span></span><br><span class="line">pip uninstall  <span class="comment"># 卸载依赖包</span></span><br><span class="line">pip <span class="built_in">list</span>  <span class="comment"># 查看已安装的依赖包</span></span><br><span class="line">pip freeze  <span class="comment"># 冻结当前环境的依赖包</span></span><br></pre></td></tr></table></figure></p>
<h1 id="工程搭建">工程搭建</h1>
<p>工程目录如下：<br />
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">|-Hello</span><br><span class="line">    |-static</span><br><span class="line">    |-templates</span><br><span class="line">    |-app.py</span><br></pre></td></tr></table></figure></p>
<figure class="highlight python"><figcaption><span>app.py</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 导入Flask类</span></span><br><span class="line"><span class="keyword">from</span> flask <span class="keyword">import</span> Flask</span><br><span class="line"></span><br><span class="line"><span class="comment"># 初始化Flask，接收一个参数__name__</span></span><br><span class="line">app = Flask(__name__)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 装饰器的作用是将路由/映射到视图函数index</span></span><br><span class="line"><span class="meta">@app.route(<span class="params"><span class="string">&#x27;/&#x27;</span></span>)</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">index</span>():</span><br><span class="line">    <span class="keyword">return</span> <span class="string">&#x27;Hello World&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># Flask应用程序实例的run方法启动WEB服务器</span></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&#x27;__main__&#x27;</span>:</span><br><span class="line">    app.run()</span><br></pre></td></tr></table></figure>
<p>1.首先我们导入了 Flask 类。 该类的实例将会成为我们的 WSGI
应用。<br />
2.接着我们创建一个该类的实例<code>Flask(__name__)</code>。通过<code>Flask(__name__)</code>，Flask知道了根目录，从而知道本目录下的其他配置文件或文件夹(static、tmplates)，不像Django需要手动指定配置目录。<br />
3.然后我们使用 <code>route()</code> 装饰器来告诉 Flask 触发函数的 URL
。<br />
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># Flask参数解析</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">__init__</span>(<span class="params"></span></span><br><span class="line"><span class="params">        self,</span></span><br><span class="line"><span class="params">        import_name: <span class="built_in">str</span>,  <span class="comment"># 根目录，其可以决定Flask在访问静态文件时查找的路径</span></span></span><br><span class="line"><span class="params">        static_url_path: t.<span class="type">Optional</span>[<span class="built_in">str</span>] = <span class="literal">None</span>, <span class="comment"># 静态文件访问路径(路由)，默认为 &quot;/ + static_folder&quot;</span></span></span><br><span class="line"><span class="params">        static_folder: t.<span class="type">Optional</span>[t.<span class="type">Union</span>[<span class="built_in">str</span>, os.PathLike]] = <span class="string">&quot;static&quot;</span>, <span class="comment"># 静态文件存储文件夹</span></span></span><br><span class="line"><span class="params">        static_host: t.<span class="type">Optional</span>[<span class="built_in">str</span>] = <span class="literal">None</span>,s</span></span><br><span class="line"><span class="params">        host_matching: <span class="built_in">bool</span> = <span class="literal">False</span>,</span></span><br><span class="line"><span class="params">        subdomain_matching: <span class="built_in">bool</span> = <span class="literal">False</span>,</span></span><br><span class="line"><span class="params">        template_folder: t.<span class="type">Optional</span>[<span class="built_in">str</span>] = <span class="string">&quot;templates&quot;</span>,  <span class="comment"># 模板文件存储文件夹</span></span></span><br><span class="line"><span class="params">        instance_path: t.<span class="type">Optional</span>[<span class="built_in">str</span>] = <span class="literal">None</span>,</span></span><br><span class="line"><span class="params">        instance_relative_config: <span class="built_in">bool</span> = <span class="literal">False</span>,</span></span><br><span class="line"><span class="params">        root_path: t.<span class="type">Optional</span>[<span class="built_in">str</span>] = <span class="literal">None</span>,</span></span><br><span class="line"><span class="params">    </span>):</span><br></pre></td></tr></table></figure></p>
<h2 id="配置参数">配置参数</h2>
<p><code>Flask(__name__)</code>对象初始化参数仅仅设置的是Flask本身的属性，比如Flask从哪里读取静态文件、模板文件。</p>
<p>应用程序配置参数设置的是一个Web应用工程的相关信息，比如：数据库的连接信息、日志的配置信息、自定义的配置信息。这就需要集中管理项目的所有配置信息：<br />
1. Django将所有配置信息都放到了settings.py文件中，而Flask则不同。<br />
2.
Flask将配置信息保存到了<strong>app.config</strong>属性中，该属性可以<strong>按照字典类型进行操作</strong>。</p>
<p>Flask应用程序配置参数：<br />
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 读取</span></span><br><span class="line">app.config.get(name)</span><br><span class="line">app.config[name]</span><br><span class="line"><span class="comment"># 设置</span></span><br><span class="line"><span class="comment"># 1.从配置“对象”中加载，配置对象可以写一个类</span></span><br><span class="line">app.config.from_object(配置对象)</span><br><span class="line"><span class="comment"># 2.从配置文件中加载</span></span><br><span class="line">app.config.from_pyfile(<span class="string">&#x27;setting.py&#x27;</span>)</span><br><span class="line"><span class="comment"># 3.从环境变量中加载(使用环境变量加载不想出现在代码中的敏感配置信息)</span></span><br><span class="line">app.config.from_envvar(<span class="string">&#x27;环境变量名&#x27;</span>)</span><br></pre></td></tr></table></figure></p>
<p>优缺点：<br />
1.
从配置“对象”中加载：可以继承，适用于配置多变动的情况；缺点是敏感信息暴露。<br />
2.
从配置文件中加载：不会暴露敏感信息；缺点是不能继承，配置地址写死，不易变动。<br />
3.
从环境变量中加载：不会暴露敏感信息，配置地址灵活可变；缺点是不能继承，设置不方便。</p>
<p>一般选择2种方式一起，来配置参数。</p>
<div class="tabs" id="1"><ul class="nav-tabs"><li class="tab active"><a href="#1-1">从配置“对象”中加载</a></li><li class="tab"><a href="#1-2">从配置文件中加载</a></li><li class="tab"><a href="#1-3">从环境变量中加载</a></li></ul><div class="tab-content"><div class="tab-pane active" id="1-1"><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">DefaultConfig</span>(<span class="title class_ inherited__">object</span>):</span><br><span class="line">    <span class="string">&quot;&quot;&quot;默认配置&quot;&quot;&quot;</span></span><br><span class="line">    SECRET_KEY = <span class="string">&#x27;TPmi4aLWRbyVq8zu9v82dWYW1&#x27;</span></span><br><span class="line"></span><br><span class="line">app = Flask(__name__)</span><br><span class="line"><span class="comment"># 加入SECRET_KEY配置</span></span><br><span class="line">app.config.from_object(DefaultConfig)</span><br><span class="line"></span><br><span class="line"><span class="meta">@app.route(<span class="params"><span class="string">&quot;/&quot;</span></span>)</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">index</span>():</span><br><span class="line">    <span class="built_in">print</span>(app.config[<span class="string">&#x27;SECRET_KEY&#x27;</span>])</span><br><span class="line">    <span class="keyword">return</span> <span class="string">&quot;hello world&quot;</span></span><br></pre></td></tr></table></figure></div><div class="tab-pane" id="1-2"><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 新建一个配置文件setting.py，写入下文</span></span><br><span class="line">SECRET_KEY = <span class="string">&#x27;TPmi4aLWRbyVq8zu9v82dWYW1&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 在Flask程序</span></span><br><span class="line">app = Flask(__name__)</span><br><span class="line"><span class="comment"># 增加配置</span></span><br><span class="line">app.config.from_pyfile(<span class="string">&#x27;setting.py&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="meta">@app.route(<span class="params"><span class="string">&quot;/&quot;</span></span>)</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">index</span>():</span><br><span class="line">    <span class="built_in">print</span>(app.config[<span class="string">&#x27;SECRET_KEY&#x27;</span>])</span><br><span class="line">    <span class="keyword">return</span> <span class="string">&quot;hello world&quot;</span></span><br></pre></td></tr></table></figure></div><div class="tab-pane" id="1-3"><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 先在终端中设置环境变量：export 变量名=变量值</span></span><br><span class="line"><span class="comment"># Flask使用环境变量加载配置的本质，是通过环境变量值找到配置文件。</span></span><br><span class="line">$ export PROJECT_SETTING=<span class="string">&#x27;~/setting.py&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 在Flask程序</span></span><br><span class="line">app = Flask(__name__)</span><br><span class="line"><span class="comment"># 增加配置：setting.py指定为配置文件，只不过这个文件地址存储在PROJECT_SETTING环境变量中</span></span><br><span class="line">app.config.from_envvar(<span class="string">&#x27;PROJECT_SETTING&#x27;</span>, silent=<span class="literal">True</span>) </span><br><span class="line"><span class="comment"># silent=False没有值时报错通知，默认为False</span></span><br><span class="line"><span class="comment"># True 表示安静的处理，即时没有值也让Flask正常的运行下去</span></span><br><span class="line"></span><br><span class="line"><span class="meta">@app.route(<span class="params"><span class="string">&quot;/&quot;</span></span>)</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">index</span>():</span><br><span class="line">    <span class="built_in">print</span>(app.config[<span class="string">&#x27;SECRET_KEY&#x27;</span>])</span><br><span class="line">    <span class="keyword">return</span> <span class="string">&quot;hello world&quot;</span></span><br></pre></td></tr></table></figure></div></div></div>
<p>Flask项目中的常用方式：使用工厂模式创建Flask
app，并结合使用配置对象与环境变量加载配置。<br />
1.使用<strong>配置对象</strong>加载默认配置。<br />
2.使用<strong>环境变量</strong>加载不想出现在代码中的<strong>敏感配置</strong>信息。<br />
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 1. 默认配置：从配置“对象”中加载，配置对象可以写一个类</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">DefaultConfig</span>(<span class="title class_ inherited__">object</span>):</span><br><span class="line">    SECRET_KEY = <span class="string">&#x27;itcast1&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 2. 自定义配置：继承默认继承，再新增项目特别的配置</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">DevelopmentConfig</span>(<span class="title class_ inherited__">DefaultConfig</span>):</span><br><span class="line">    DEBUG = <span class="literal">True</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 3. 自定义配置+环境变量</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">create_flask_app</span>(<span class="params">config</span>):</span><br><span class="line">    <span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">    创建Flask应用</span></span><br><span class="line"><span class="string">    :param config: 配置对象</span></span><br><span class="line"><span class="string">    :return: Flask应用</span></span><br><span class="line"><span class="string">    &quot;&quot;&quot;</span></span><br><span class="line">    app = Flask(__name__)</span><br><span class="line">    app.config.from_object(config)</span><br><span class="line">    <span class="comment"># 从环境变量指向的配置文件中读取的配置信息会覆盖掉从配置对象中加载的同名参数</span></span><br><span class="line">    app.config.from_envvar(<span class="string">&quot;PROJECT_SETTING&quot;</span>, silent=<span class="literal">True</span>)</span><br><span class="line">    <span class="keyword">return</span> app</span><br><span class="line"></span><br><span class="line">app = create_flask_app(DevelopmentConfig)</span><br><span class="line"></span><br><span class="line"><span class="meta">@app.route(<span class="params"><span class="string">&quot;/&quot;</span></span>)</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">index</span>():</span><br><span class="line">    <span class="built_in">print</span>(app.config[<span class="string">&#x27;SECRET_KEY&#x27;</span>])</span><br><span class="line">    <span class="keyword">return</span> <span class="string">&quot;hello world&quot;</span></span><br></pre></td></tr></table></figure></p>
<h2 id="运行参数">运行参数</h2>
<p>可以指定运行的主机IP地址，端口，是否开启调试模式。<br />
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># host：监听响应的ip，&quot;0.0.0.0&quot;表示当前系统中所有的ip。</span></span><br><span class="line"><span class="comment"># port：端口，默认5000。</span></span><br><span class="line"><span class="comment"># debug：是否开启Flask的debug模式，输出错误信息。</span></span><br><span class="line">app.run(host=<span class="string">&quot;0.0.0.0&quot;</span>, port=<span class="number">5000</span>, debug=<span class="literal">True</span>)</span><br></pre></td></tr></table></figure></p>
<p>关于DEBUG调试模式：<br />
1.程序代码修改后可以<strong>自动重启服务器</strong>。<br />
2.可以直接将错误信息返回到<strong>前端展示</strong>。</p>
<h2 id="终端启动">终端启动</h2>
<p>默认启动：<br />
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_">$ </span><span class="language-bash">python app.py</span></span><br></pre></td></tr></table></figure></p>
<p>环境变量启动：<br />
1.环境变量 <code>FLASK_APP</code> 指明flask的启动实例。<br />
2.<code>flask run -h 0.0.0.0 -p 8000</code> 绑定地址、端口。<br />
3.生产模式与开发模式的控制通过<code>FLASK_ENV</code>环境变量指明。<br />
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">&quot;&quot;&quot;</span><br><span class="line">&quot;flask run&quot; 等价于 &quot;python -m flask run&quot;</span><br><span class="line">export FLASK_ENV=development # 运行在开发模式</span><br><span class="line">export FLASK_ENV=production # 运行在生产模式，未指明则默认为此方式</span><br><span class="line">&quot;&quot;&quot;</span><br><span class="line"><span class="meta prompt_">$ </span><span class="language-bash"><span class="built_in">export</span> FLASK_APP=app.py</span></span><br><span class="line"><span class="meta prompt_">$ </span><span class="language-bash">flask run -p 5000</span></span><br><span class="line"> * Running on http://127.0.0.1:5000/</span><br></pre></td></tr></table></figure></p>
<h1 id="路由">路由</h1>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@app.route(<span class="params"><span class="string">&quot;/itcast&quot;</span></span>)</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">view_func</span>():</span><br><span class="line">    <span class="keyword">return</span> <span class="string">&quot;hello world&quot;</span></span><br></pre></td></tr></table></figure>
<h2 id="路由信息">路由信息</h2>
<p>1.命令行方式：<br />
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_">$ </span><span class="language-bash">flask routes</span></span><br><span class="line">&#x27;&#x27;&#x27;</span><br><span class="line">Endpoint  Methods  Rule</span><br><span class="line">--------  -------  -----------------------</span><br><span class="line">index     GET      /</span><br><span class="line">static    GET      /static/</span><br><span class="line">&#x27;&#x27;&#x27;</span><br></pre></td></tr></table></figure></p>
<p>2.在程序中获取：<br />
在应用中的<code>url_map</code>属性中保存着整个Flask应用的路由映射信息，可以通过读取这个属性获取路由信息。<br />
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">print</span>(app.url_map)</span><br><span class="line"><span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">Map([&lt;Rule &#x27;/&#x27; (GET, HEAD, OPTIONS) -&gt; hello_world&gt;,</span></span><br><span class="line"><span class="string"> &lt;Rule &#x27;/static/&lt;filename&gt;&#x27; (GET, HEAD, OPTIONS) -&gt; static&gt;])</span></span><br><span class="line"><span class="string">&quot;&quot;&quot;</span></span><br></pre></td></tr></table></figure></p>
<p>程序中<strong>遍历路由信息</strong>，可以采用如下方式：<br />
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># rule为Rule对象，其属性endpoint为路由名字，rule为路由路径。</span></span><br><span class="line"><span class="keyword">for</span> rule <span class="keyword">in</span> app.url_map.iter_rules():</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&#x27;name=&#123;&#125; path=&#123;&#125;&#x27;</span>.<span class="built_in">format</span>(rule.endpoint, rule.rule))</span><br><span class="line"></span><br><span class="line"><span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">name=hello_world path=/</span></span><br><span class="line"><span class="string">name=static path=/static/&lt;path:filename&gt;</span></span><br><span class="line"><span class="string">&quot;&quot;&quot;</span></span><br></pre></td></tr></table></figure></p>
<p>示例：通过访问"/"地址，以json的方式返回应用内的所有路由信息：<br />
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@app.route(<span class="params"><span class="string">&#x27;/&#x27;</span></span>)</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">route_map</span>():</span><br><span class="line">    <span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">    主视图，返回所有视图网址</span></span><br><span class="line"><span class="string">    &quot;&quot;&quot;</span></span><br><span class="line">    rules_iterator = app.url_map.iter_rules()</span><br><span class="line">    <span class="keyword">return</span> json.dumps(&#123;rule.endpoint: rule.rule <span class="keyword">for</span> rule <span class="keyword">in</span> rules_iterator&#125;)</span><br><span class="line"></span><br><span class="line"><span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">&#123;&quot;route_map&quot;: &quot;/rule&quot;, &quot;hello_world&quot;: &quot;/&quot;, &quot;static&quot;: &quot;/static/&quot;&#125;</span></span><br><span class="line"><span class="string">&quot;&quot;&quot;</span></span><br></pre></td></tr></table></figure></p>
<h2 id="路由重定向">路由重定向</h2>
<p>一般通过一个 URL
就可以执行到某一个函数，那么从一个函数，怎么去路由到另一个 URL 呢？
url_for 函数就可以帮我们实现这个功能。<br />
url_for：函数接收两个及以上的参数，他接收函数名作为第一个参数，后面以key-value形式接收对应URL规则的命名参数，如果还出现其他的参数，则会添加到
URL 的后面作为查询参数。<br />
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> flask <span class="keyword">import</span> Flask, request, url_for, redirect</span><br><span class="line"></span><br><span class="line"><span class="meta">@app.route(<span class="params"><span class="string">&#x27;/post/list/&lt;page&gt;/&#x27;</span></span>)</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">my_list</span>(<span class="params">page</span>):</span><br><span class="line">    <span class="keyword">return</span> <span class="string">&#x27;my list&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="meta">@app.route(<span class="params"><span class="string">&#x27;/&#x27;</span></span>)</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">hello_world</span>():</span><br><span class="line">    <span class="keyword">return</span> redirect(url_for(<span class="string">&#x27;my_list&#x27;</span>, page=<span class="number">2</span>, num=<span class="number">8</span>)) <span class="comment"># 重定向到/post/my_list/2?num=8</span></span><br></pre></td></tr></table></figure></p>
<h1 id="蓝图子路由">蓝图（子路由）</h1>
<p>在一个Flask
应用项目中，如果业务视图过多，可否将以某种方式划分出的业务单元单独维护，将每个单元用到的视图、静态文件、模板文件等独立分开？</p>
<p>在Flask中，使用蓝图 Blueprint
来分模块组织管理。蓝图实际可以理解为是一个存储一组视图方法的容器对象，其具有如下特点：<br />
1.一个应用可以具有多个Blueprint。<br />
2.可以将一个Blueprint注册到任何一个未使用的URL下比如
“/user”、“/goods”。<br />
3.Blueprint可以单独具有自己的模板、静态文件或者其它的通用操作方法，它并不是必须要实现应用的视图和函数。<br />
4.在一个应用初始化时，就应该要注册需要使用的Blueprint。<br />
但是一个Blueprint并不是一个完整的应用，它不能独立于应用运行，而必须要注册到某一个应用中。</p>
<h2 id="蓝图创建">蓝图创建</h2>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> flask <span class="keyword">import</span> Flask, Blueprint</span><br><span class="line"></span><br><span class="line">app = Flask(__name__)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 1.创建一个蓝图对象</span></span><br><span class="line">user_bp = Blueprint(<span class="string">&#x27;user&#x27;</span>,__name__)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 2.在这个蓝图对象上进行操作，注册路由，指定静态文件夹，注册模版过滤器</span></span><br><span class="line"><span class="meta">@user_bp.route(<span class="params"><span class="string">&#x27;/&#x27;</span></span>)</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">user_profile</span>():</span><br><span class="line">    <span class="keyword">return</span> <span class="string">&#x27;user_profile&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 3.在app注册这个蓝图对象</span></span><br><span class="line">app.register_blueprint(user_bp)</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&#x27;__main__&#x27;</span>:</span><br><span class="line">    app.run()</span><br></pre></td></tr></table></figure>
<p><strong>目录蓝图</strong>：项目形式。对于一个包含多个文件的蓝图，通常将创建蓝图对象放到Python包的<code>__init__.py</code>文件中。<br />
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">|--------- project <span class="comment"># 工程目录</span></span><br><span class="line">  |------ main.py <span class="comment"># 启动文件</span></span><br><span class="line">  |------ user  <span class="comment"># 用户蓝图</span></span><br><span class="line">  |  |--- __init__.py  <span class="comment"># 此处创建蓝图对象</span></span><br><span class="line">  |  |--- passport.py  </span><br><span class="line">  |  |--- profile.py</span><br><span class="line">  |  |--- ...</span><br><span class="line">  |------ goods <span class="comment"># 商品蓝图</span></span><br><span class="line">  |  |--- __init__.py  <span class="comment"># 此处创建蓝图对象</span></span><br><span class="line">  |  |--- views.py  <span class="comment"># 此处定义视图</span></span><br><span class="line">  |...</span><br></pre></td></tr></table></figure></p>
<p>以商品蓝图 goods 为例：<br />
<div class="tabs" id="2"><ul class="nav-tabs"><li class="tab active"><a href="#2-1">__init__.py</a></li><li class="tab"><a href="#2-2">views.py</a></li><li class="tab"><a href="#2-3">main.py</a></li></ul><div class="tab-content"><div class="tab-pane active" id="2-1"><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> flask <span class="keyword">import</span> Flask, Blueprint</span><br><span class="line"></span><br><span class="line">goods_bp = Blueprint(<span class="string">&#x27;goods&#x27;</span>,__name__)</span><br><span class="line"></span><br><span class="line"><span class="keyword">from</span> . <span class="keyword">import</span> views  <span class="comment"># 引入该蓝图下的路由</span></span><br></pre></td></tr></table></figure></div><div class="tab-pane" id="2-2"><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> . <span class="keyword">import</span> goods_bp <span class="comment"># 引入蓝图</span></span><br><span class="line"></span><br><span class="line"><span class="meta">@goods_bp.route(<span class="params"><span class="string">&#x27;/goods&#x27;</span></span>)</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">get_goods</span>():</span><br><span class="line">    <span class="keyword">return</span> <span class="string">&#x27;get_goods&#x27;</span></span><br></pre></td></tr></table></figure></div><div class="tab-pane" id="2-3"><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> flask <span class="keyword">import</span> Flask, Blueprint</span><br><span class="line"><span class="keyword">from</span> goods <span class="keyword">import</span> goods_bp <span class="comment"># 引入蓝图</span></span><br><span class="line"></span><br><span class="line">app = Flask(__name__)</span><br><span class="line"><span class="comment"># 注册蓝图</span></span><br><span class="line">app.register_blueprint(goods_bp) </span><br></pre></td></tr></table></figure></div></div></div></p>
<h2 id="扩展用法">扩展用法</h2>
<p>1.指定蓝图的<strong>url前缀（子地址）</strong>：<br />
在应用中注册蓝图时使用<code>url_prefix</code>参数指定：<br />
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">app.register_blueprint(user_bp, url_prefix=<span class="string">&#x27;/user&#x27;</span>)  <span class="comment"># 此时访问的是/user/xx</span></span><br><span class="line">app.register_blueprint(goods_bp, url_prefix=<span class="string">&#x27;/goods&#x27;</span>) <span class="comment"># 此时访问的是/goods/xx</span></span><br></pre></td></tr></table></figure></p>
<p>2.指定蓝图的<strong>静态文件</strong>：<br />
和应用对象不同，蓝图对象创建时不会默认注册静态目录的路由。需要在创建时指定
<code>static_folder</code> 参数。<br />
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 蓝图文件所在目录下，新建static_admin目录设置为静态目录</span></span><br><span class="line">admin = Blueprint(<span class="string">&quot;admin&quot;</span>, __name__, static_folder=<span class="string">&#x27;static_admin&#x27;</span>)</span><br><span class="line"><span class="comment"># 静态剥访问地址：/admin/static_admin/&lt;filename&gt;</span></span><br><span class="line">app.register_blueprint(admin, url_prefix=<span class="string">&#x27;/admin&#x27;</span>) </span><br><span class="line"></span><br><span class="line"><span class="comment"># 也可通过static_url_path改变访问路径</span></span><br><span class="line">admin = Blueprint(<span class="string">&quot;admin&quot;</span>,__name__, static_folder=<span class="string">&#x27;static_admin&#x27;</span>, static_url_path=<span class="string">&#x27;/lib&#x27;</span>)</span><br><span class="line">app.register_blueprint(admin,url_prefix=<span class="string">&#x27;/admin&#x27;</span>)</span><br></pre></td></tr></table></figure></p>
<p>3.指定蓝图的<strong>模板目录</strong>：<br />
蓝图对象默认的模板目录为系统的模版目录，可以在创建蓝图对象时使用
<code>template_folder</code> 关键字参数设置模板目录。<br />
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">admin = Blueprint(<span class="string">&#x27;admin&#x27;</span>, __name__, template_folder=<span class="string">&#x27;my_templates&#x27;</span>)</span><br></pre></td></tr></table></figure></p>
<h1 id="请求">请求</h1>
<p>在视图编写中需要读取客户端请求携带的数据时，如何才能正确的取出数据呢？<br />
请求携带的数据可能出现在HTTP报文中的不同位置，需要使用不同的方法来获取参数。</p>
<h2 id="请求方式">请求方式</h2>
<p>在 Flask 中，定义路由其默认的请求方式为：<br />
1.<code>GET</code>：默认获取请求。请求的数据是以<strong>明文的形式</strong>放在路由上面，url的"?"后面为请求参数，格式为"参数名=参数值"。<br />
2.<code>POST</code>：表单提交请求，请求数据是隐藏发送，通常用来向服务器提交数据。<br />
3.<code>PUT</code>：修改请求，用法同POST。<br />
4.<code>DELETE</code>：删除请求，用法同POST。<br />
利用<code>methods</code>参数可以自己指定一个接口的请求方式。<br />
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@app.route(<span class="params"><span class="string">&quot;/itcast1&quot;</span>, methods=[<span class="string">&quot;POST&quot;</span>]</span>)  </span><span class="comment"># 只支持POST请求</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">view_func_1</span>():</span><br><span class="line">    <span class="keyword">return</span> <span class="string">&quot;hello world 1&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="meta">@app.route(<span class="params"><span class="string">&quot;/itcast2&quot;</span>, methods=[<span class="string">&quot;GET&quot;</span>, <span class="string">&quot;POST&quot;</span>]</span>)  </span><span class="comment"># 支持GET、POST请求</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">view_func_2</span>():</span><br><span class="line">    <span class="keyword">return</span> <span class="string">&quot;hello world 2&quot;</span></span><br></pre></td></tr></table></figure></p>
<h2 id="请求参数">请求参数</h2>
<p>如果想要获取其他地方传递的参数，可以通过Flask提供的request对象来读取。</p>
<p><strong>不同位置的参数</strong>都存放在<strong>request的不同属性</strong>中：<br />
<figure class="highlight txt"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">属性        类型                        说明</span><br><span class="line">data        *                   记录请求的数据，并转换为字符串（请求中body的原始数据）</span><br><span class="line">form        MultiDict           记录请求中的表单数据（对应请求中body的form数据）</span><br><span class="line">args        MultiDict           记录请求中的查询参数（对应请求中path后面的查询参数）</span><br><span class="line">cookies     Dict                记录请求中的cookie信息</span><br><span class="line">headers     EnvironHeaders      记录请求中的报文头</span><br><span class="line">method      GET/POST            记录请求使用的HTTP方法</span><br><span class="line">url         String              记录请求的URL地址</span><br><span class="line">files       *                   记录请求上传的文件（对应请求中body的files数据）</span><br></pre></td></tr></table></figure></p>
<div class="tabs" id="请求参数"><ul class="nav-tabs"><li class="tab active"><a href="#请求参数-1">GET</a></li><li class="tab"><a href="#请求参数-2">POST获取参数</a></li><li class="tab"><a href="#请求参数-3">POST上传文件</a></li></ul><div class="tab-content"><div class="tab-pane active" id="请求参数-1"><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> flask <span class="keyword">import</span> request</span><br><span class="line"><span class="comment"># 获取&quot;/articles?channel_id=1&quot;中&quot;channel_id&quot;的参数</span></span><br><span class="line"><span class="meta">@app.route(<span class="params"><span class="string">&#x27;/articles&#x27;</span>, methods=[<span class="string">&#x27;GET&#x27;</span>]</span>)</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">get_articles</span>():</span><br><span class="line">    channel_id = request.args.get(<span class="string">&#x27;channel_id&#x27;</span>) <span class="comment"># 获取get请求中的参数</span></span><br><span class="line">    <span class="keyword">return</span> <span class="string">&#x27;you wanna get articles of channel &#123;&#125;&#x27;</span>.<span class="built_in">format</span>(channel_id)</span><br></pre></td></tr></table></figure></div><div class="tab-pane" id="请求参数-2"><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> flask <span class="keyword">import</span> request</span><br><span class="line"><span class="comment"># 获取form中的参数</span></span><br><span class="line"><span class="meta">@app.route(<span class="params"><span class="string">&#x27;/articles&#x27;</span>, methods=[<span class="string">&#x27;POST&#x27;</span>]</span>)</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">upload_file</span>():</span><br><span class="line">    channel_id = request.form.get(<span class="string">&#x27;channel_id&#x27;</span>)  <span class="comment"># 获取post请求中的参数</span></span><br><span class="line">    <span class="keyword">return</span> <span class="string">&#x27;you wanna get articles of channel &#123;&#125;&#x27;</span>.<span class="built_in">format</span>(channel_id)</span><br></pre></td></tr></table></figure></div><div class="tab-pane" id="请求参数-3"><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> flask <span class="keyword">import</span> request</span><br><span class="line"><span class="comment"># 上传图片到服务器，并保存到服务器中</span></span><br><span class="line"><span class="comment"># html的form中一定要加属性enctype=&quot;multipart/form-data&quot;，确保上传文件是一整个包</span></span><br><span class="line"><span class="meta">@app.route(<span class="params"><span class="string">&#x27;/upload&#x27;</span>, methods=[<span class="string">&#x27;POST&#x27;</span>]</span>)</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">upload_file</span>():</span><br><span class="line">    f = request.files[<span class="string">&#x27;pic&#x27;</span>]  <span class="comment"># pic为上传文件的字段名</span></span><br><span class="line">    <span class="comment"># 1.python方式保存文件</span></span><br><span class="line">    <span class="comment"># with open(&#x27;./demo.png&#x27;, &#x27;wb&#x27;) as new_file:</span></span><br><span class="line">    <span class="comment">#     new_file.write(f.read())</span></span><br><span class="line">    <span class="comment"># 2.自带的保存方式</span></span><br><span class="line">    f.save(<span class="string">&#x27;./demo.png&#x27;</span>)</span><br><span class="line">    <span class="keyword">return</span> <span class="string">&#x27;ok&#x27;</span></span><br></pre></td></tr></table></figure></div></div></div>
<h2 id="路径参数动态路由">路径参数（动态路由）</h2>
<p>例如，有一个请求访问的接口地址为"/users/123"，其中"123"实际上为具体的请求参数，表明请求123号用户的信息。此时如何从url中提取出123的数据？</p>
<p>Flask不同于Django直接在定义路由时编写正则表达式的方式，而是采用转换器语法：<br />
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@app.route(<span class="params"><span class="string">&#x27;/users/&lt;user_id&gt;&#x27;</span></span>)  </span><span class="comment"># 提取路径中user_id参数</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">user_info</span>(<span class="params">user_id</span>):</span><br><span class="line">    <span class="built_in">print</span>(<span class="built_in">type</span>(user_id))</span><br><span class="line">    <span class="keyword">return</span> <span class="string">&#x27;hello user &#123;&#125;&#x27;</span>.<span class="built_in">format</span>(user_id)</span><br></pre></td></tr></table></figure></p>
<p>此处的<code>&lt;&gt;</code>即是一个转换器，<strong>默认为字符串类型</strong>，即将该位置的数据以字符串格式进行匹配、并以字符串为数据类型类型、
user_id为参数名传入视图。<br />
Flask也提供其他数据类型的转换器：<br />
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">DEFAULT_CONVERTERS = &#123;</span><br><span class="line">    <span class="string">&#x27;default&#x27;</span>:          UnicodeConverter,</span><br><span class="line">    <span class="string">&#x27;string&#x27;</span>:           UnicodeConverter,</span><br><span class="line">    <span class="string">&#x27;any&#x27;</span>:              AnyConverter,</span><br><span class="line">    <span class="string">&#x27;path&#x27;</span>:             PathConverter,</span><br><span class="line">    <span class="string">&#x27;int&#x27;</span>:              IntegerConverter,</span><br><span class="line">    <span class="string">&#x27;float&#x27;</span>:            FloatConverter,</span><br><span class="line">    <span class="string">&#x27;uuid&#x27;</span>:             UUIDConverter,</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>比如，以整型匹配数据：<br />
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@app.route(<span class="params"><span class="string">&#x27;/users/&lt;int:user_id&gt;&#x27;</span></span>)  </span><span class="comment"># 整型转换</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">user_info</span>(<span class="params">user_id</span>):</span><br><span class="line">    <span class="built_in">print</span>(<span class="built_in">type</span>(user_id))</span><br><span class="line">    <span class="keyword">return</span> <span class="string">&#x27;hello user &#123;&#125;&#x27;</span>.<span class="built_in">format</span>(user_id)</span><br><span class="line"></span><br><span class="line"><span class="meta">@app.route(<span class="params"><span class="string">&#x27;/users/&lt;int(min=1):user_id&gt;&#x27;</span></span>)  </span><span class="comment"># 整型转换、限制最小值</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">user_info</span>(<span class="params">user_id</span>):</span><br><span class="line">    <span class="built_in">print</span>(<span class="built_in">type</span>(user_id))</span><br><span class="line">    <span class="keyword">return</span> <span class="string">&#x27;hello user &#123;&#125;&#x27;</span>.<span class="built_in">format</span>(user_id)</span><br></pre></td></tr></table></figure></p>
<p><strong>自定义转换器</strong><br />
如果遇到需要匹配提取"/sms_codes/15645678901"中的手机号数据，Flask内置的转换器就无法满足需求，此时需要自定义转换器。</p>
<p>1.创建转换器类，保存匹配时的正则表达式。<br />
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> werkzeug.routing <span class="keyword">import</span> BaseConverter</span><br><span class="line"><span class="comment"># 自定义转换器，要继承BaseConverter</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">MobileConverter</span>(<span class="title class_ inherited__">BaseConverter</span>):</span><br><span class="line">    regex = <span class="string">r&#x27;1[3-9]\d&#123;9&#125;&#x27;</span> <span class="comment"># 手机号格式</span></span><br></pre></td></tr></table></figure></p>
<p>2.将自定义的转换器告知Flask应用，即注册自定义类型到converters字典中，converters保存了所有类型。<br />
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">app = Flask(__name__)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 将自定义转换器添加到转换器字典中，并指定转换器使用时名字为: mobile</span></span><br><span class="line">app.url_map.converters[<span class="string">&#x27;mobile&#x27;</span>] = MobileConverter</span><br></pre></td></tr></table></figure></p>
<p>3.在使用转换器的地方定义使用。<br />
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@app.route(<span class="params"><span class="string">&#x27;/sms_codes/&lt;mobile:mob_num&gt;&#x27;</span></span>)  </span><span class="comment"># mobile为自定义类型</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">send_sms_code</span>(<span class="params">mob_num</span>):</span><br><span class="line">    <span class="keyword">return</span> <span class="string">&#x27;send sms code to &#123;&#125;&#x27;</span>.<span class="built_in">format</span>(mob_num)</span><br></pre></td></tr></table></figure></p>
<h2 id="请求钩子">请求钩子</h2>
<p>在客户端和服务器交互的过程中，有些准备工作或扫尾工作需要处理：<br />
1.在请求开始时，建立数据库连接；<br />
2.在请求开始时，根据需求进行权限校验；<br />
3.在请求结束时，指定数据的交互格式；<br />
这些算是通用功能，为了让每个视图函数避免编写重复功能的代码，Flask提供了<strong>通用处理</strong>功能，即请求钩子。</p>
<p>请求钩子是通过装饰器的形式实现，Flask支持如下4种请求钩子：<br />
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">|-before_first_request：</span><br><span class="line">    |-在处理第一个请求前执行。</span><br><span class="line">|-before_request：</span><br><span class="line">    |-在每次请求前执行。</span><br><span class="line">    |-如果它返回了一个响应，那么后续的视图函数将不再被调用。</span><br><span class="line">|-after_request：</span><br><span class="line">    |-在每次视图函数执行后执行（视图函数没有抛出错误）。</span><br><span class="line">    |-把<span class="string">&quot;视图函数的响应&quot;</span>作为一个参数接收，可对响应值做进一步处理。</span><br><span class="line">    |-需要返回一个响应。</span><br><span class="line">|-teardown_request：</span><br><span class="line">    |-在after_request后执行。</span><br><span class="line">    |-把<span class="string">&quot;错误信息&quot;</span>作为一个参数接收，如果有相关错误抛出。</span><br><span class="line"><span class="comment"># 其他钩子函数</span></span><br><span class="line">|-errorhandler：</span><br><span class="line">    |-当任何一个视图函数出现指定错误的时候直接调用此方法。</span><br><span class="line">    |-需指定错误状态码。</span><br><span class="line">|-context_processor：</span><br><span class="line">    |-当项目中的所有模板都需要一个参数的时候，可以在此函数里定义，并且自动传给所有的模板。</span><br><span class="line">    |-该函数一定要返回字典。</span><br></pre></td></tr></table></figure></p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> flask <span class="keyword">import</span> Flask, abort, render_template</span><br><span class="line"></span><br><span class="line">app = Flask(__name__)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 在第一次请求之前调用，可以在此方法内部做一些初始化操作</span></span><br><span class="line"><span class="meta">@app.before_first_request</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">before_first_request</span>():</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;before_first_request&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 在每一次请求之前调用，这时候已经有请求了，可能在这个方法里面做请求的校验</span></span><br><span class="line"><span class="comment"># 如果请求的校验不成功，可以直接在此方法中进行响应，直接return之后那么就不会执行视图函数</span></span><br><span class="line"><span class="meta">@app.before_request</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">before_request</span>():</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;before_request&quot;</span>)</span><br><span class="line">    <span class="comment"># if 请求不符合条件:</span></span><br><span class="line">    <span class="comment"># return &quot;laowang&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 在执行完视图函数之后会调用，并且会把视图函数所生成的响应传入,可以在此方法中对响应做最后一步统一的处理</span></span><br><span class="line"><span class="meta">@app.after_request</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">after_request</span>(<span class="params">response</span>):</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;after_request&quot;</span>)</span><br><span class="line">    response.headers[<span class="string">&quot;Content-Type&quot;</span>] = <span class="string">&quot;application/json&quot;</span></span><br><span class="line">    <span class="keyword">return</span> response</span><br><span class="line"></span><br><span class="line"><span class="comment"># 每一次请求之后都会调用，会接受一个参数，参数是服务器出现的错误信息</span></span><br><span class="line"><span class="meta">@app.teardown_request</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">teardown_request</span>(<span class="params">response</span>):</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;teardown_request&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 当任何一个视图函数出现指定错误的时候直接调用此方法。</span></span><br><span class="line"><span class="comment"># 作为指定错误的统一处理入口。</span></span><br><span class="line"><span class="meta">@app.errorhandler(<span class="params"><span class="number">500</span></span>)</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">server_error</span>(<span class="params">error</span>):</span><br><span class="line">    <span class="built_in">print</span>(error)</span><br><span class="line">    <span class="keyword">return</span> render_template(<span class="string">&#x27;500.html&#x27;</span>), <span class="number">500</span></span><br><span class="line"></span><br><span class="line"><span class="meta">@app.route(<span class="params"><span class="string">&#x27;/&#x27;</span></span>)</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">index</span>():</span><br><span class="line">    <span class="keyword">return</span> <span class="string">&#x27;index&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&#x27;__main__&#x27;</span>:</span><br><span class="line">app.run(debug=<span class="literal">True</span>)</span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;第一次请求结果</span></span><br><span class="line"><span class="string">before_first_request</span></span><br><span class="line"><span class="string">before_request</span></span><br><span class="line"><span class="string">after_request</span></span><br><span class="line"><span class="string">teardown_request</span></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br></pre></td></tr></table></figure>
<h2 id="上下文">上下文</h2>
<p><strong>上下文</strong>：在程序中可以理解为在代码执行到某一时刻时，根据之前代码所做的操作以及下文即将要执行的逻辑，可以决定在当前时刻下可以使用到的变量，或者可以完成的事情。</p>
<p>Flask中上下文对象相当于一个容器，保存了Flask程序运行过程中的一些信息。<br />
Flask中有两种上下文，请求上下文、应用上下文：<br />
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">|-请求上下文</span><br><span class="line">    |-上面讲过的request、session等，它们保存了当前请求的相关数据。</span><br><span class="line">|-应用上下文</span><br><span class="line">    |-循环引用：app.py中引入蓝图，蓝图中使用app，需要从app.py引入，这就导致循环引用了。</span><br><span class="line">    |-current_app：为防止循环引用代替app的，和app一样。</span><br></pre></td></tr></table></figure></p>
<div class="tabs" id="上下文"><ul class="nav-tabs"><li class="tab active"><a href="#上下文-1">程序入口</a></li><li class="tab"><a href="#上下文-2">产品蓝图</a></li></ul><div class="tab-content"><div class="tab-pane active" id="上下文-1"><figure class="highlight python"><figcaption><span>app.py</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> flask <span class="keyword">import</span> Flask</span><br><span class="line"></span><br><span class="line">app = Flask(__name__)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 注册蓝图</span></span><br><span class="line"><span class="keyword">from</span> item <span class="keyword">import</span> item_bp</span><br><span class="line">app.register_blueprint(item_bp, url_prefix=<span class="string">&#x27;/item&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 往app中设置任意的一个参数</span></span><br><span class="line">app.test = <span class="string">&#x27;hello test&#x27;</span> </span><br><span class="line"></span><br><span class="line"><span class="meta">@app.route(<span class="params"><span class="string">&#x27;/&#x27;</span></span>)</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">hello_world</span>():</span><br><span class="line">    <span class="keyword">return</span> <span class="string">&#x27;Hello World!&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&#x27;__main__&#x27;</span>:</span><br><span class="line">    app.run()</span><br></pre></td></tr></table></figure></div><div class="tab-pane" id="上下文-2"><figure class="highlight python"><figcaption><span>item.py</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> flask <span class="keyword">import</span> Blueprint, current_app</span><br><span class="line"></span><br><span class="line">item_bp = Blueprint(<span class="string">&#x27;item&#x27;</span>, __name__)</span><br><span class="line"></span><br><span class="line"><span class="meta">@item_bp.route(<span class="params"><span class="string">&quot;/get&quot;</span></span>)</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">hello_item</span>():</span><br><span class="line">    <span class="comment"># 在蓝图中都能通过current_app访问app的参数</span></span><br><span class="line">    <span class="built_in">print</span>(current_app.test)</span><br><span class="line">    <span class="keyword">return</span> <span class="string">&quot;产品模块的页面&quot;</span></span><br></pre></td></tr></table></figure></div></div></div>
<p><strong>G对象</strong>：g 作为 flask
程序全局的一个临时变量，充当中间媒介的作用，可以通过它在一次请求调用的多个函数间传递一些数据，注意，<strong>每次请求都会重置这个变量</strong>。<br />
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> flask <span class="keyword">import</span> Flask, g</span><br><span class="line"></span><br><span class="line">app = Flask(__name__)</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">db_query</span>():</span><br><span class="line">    user_id = g.user_id</span><br><span class="line">    user_name = g.user_name</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&#x27;user_id=&#123;&#125; user_name=&#123;&#125;&#x27;</span>.<span class="built_in">format</span>(user_id, user_name))</span><br><span class="line"></span><br><span class="line"><span class="meta">@app.route(<span class="params"><span class="string">&#x27;/&#x27;</span></span>)</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">get_user_profile</span>():</span><br><span class="line">    <span class="comment"># 当前请求参数注入g</span></span><br><span class="line">    g.user_id = <span class="number">123</span></span><br><span class="line">    g.user_name = <span class="string">&#x27;laoxiao&#x27;</span></span><br><span class="line">    <span class="comment"># 当前请求获取g中存储的参数</span></span><br><span class="line">    db_query()</span><br><span class="line">    <span class="keyword">return</span> <span class="string">&#x27;hello world&#x27;</span></span><br></pre></td></tr></table></figure></p>
<p><strong>g对象与请求钩子综合使用</strong>：<br />
1.构建认证机制。<br />
2.对于特定视图可以提供强制要求用户登录的限制。<br />
3.对于所有视图，无论是否强制要求用户登录，都可以在视图中尝试获取用户认证后的身份信息。<br />
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> flask <span class="keyword">import</span> Flask, abort, g</span><br><span class="line"></span><br><span class="line"><span class="comment"># 创建一个验证&quot;未登录用户&quot;的装饰器</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">login_required</span>(<span class="params">func</span>):</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">wrapper</span>(<span class="params">*args, **kwargs</span>):</span><br><span class="line">        <span class="keyword">if</span> g.user_id <span class="keyword">is</span> <span class="keyword">not</span> <span class="literal">None</span>:</span><br><span class="line">            <span class="keyword">return</span> func(*args, **kwargs)</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            abort(<span class="number">401</span>)</span><br><span class="line">    <span class="keyword">return</span> wrapper</span><br><span class="line"></span><br><span class="line">app = Flask(__name__)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 利用before_request请求钩子，在进入所有视图前先尝试判断用户身份</span></span><br><span class="line"><span class="meta">@app.before_request </span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">authentication</span>():</span><br><span class="line">    <span class="comment"># TODO 此处利用鉴权机制（如cookie、session、jwt等）鉴别用户身份信息</span></span><br><span class="line">    <span class="comment"># if 已登录用户，用户有身份信息</span></span><br><span class="line">    g.user_id = <span class="number">123</span></span><br><span class="line">    <span class="comment"># else 未登录用户，用户无身份信息</span></span><br><span class="line">    <span class="comment"># g.user_id = None</span></span><br><span class="line"></span><br><span class="line"><span class="meta">@app.route(<span class="params"><span class="string">&#x27;/&#x27;</span></span>)</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">index</span>():</span><br><span class="line">    <span class="keyword">return</span> <span class="string">&#x27;home page user_id=&#123;&#125;&#x27;</span>.<span class="built_in">format</span>(g.user_id)</span><br><span class="line"></span><br><span class="line"><span class="meta">@app.route(<span class="params"><span class="string">&#x27;/profile&#x27;</span></span>)</span></span><br><span class="line"><span class="meta">@login_required  </span><span class="comment"># 装饰器使用</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">get_user_profile</span>():</span><br><span class="line">    <span class="keyword">return</span> <span class="string">&#x27;user profile page user_id=&#123;&#125;&#x27;</span>.<span class="built_in">format</span>(g.user_id)</span><br></pre></td></tr></table></figure></p>
<h1 id="响应">响应</h1>
<p>如何在不同的场景里返回不同的响应信息？</p>
<h2 id="重定向">重定向</h2>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> flask <span class="keyword">import</span> redirect </span><br><span class="line"></span><br><span class="line"><span class="meta">@app.route(<span class="params"><span class="string">&#x27;/demo2&#x27;</span></span>)</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">demo2</span>():</span><br><span class="line">    <span class="comment"># 通过redirect重定向，主要用于重新路由到动态的url</span></span><br><span class="line">    <span class="keyword">return</span> redirect(<span class="string">&#x27;http://www.baidu.com&#x27;</span>) </span><br></pre></td></tr></table></figure>
<h2 id="json">Json</h2>
<p><code>jsonify</code>：转换成json格式，设置了响应头<code>Content-Type:application/json</code>。<br />
<code>json.dumps</code>：只会转换成json格式，无设置响应头信息。<br />
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> flask <span class="keyword">import</span> jsonify</span><br><span class="line"></span><br><span class="line"><span class="meta">@app.route(<span class="params"><span class="string">&#x27;/demo3&#x27;</span></span>)</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">demo3</span>():</span><br><span class="line">    json_dict = &#123;</span><br><span class="line">        <span class="string">&quot;user_id&quot;</span>: <span class="number">10</span>,</span><br><span class="line">        <span class="string">&quot;user_name&quot;</span>: <span class="string">&quot;laowang&quot;</span></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> jsonify(json_dict)</span><br></pre></td></tr></table></figure></p>
<h2 id="自定义响应">自定义响应</h2>
<p>可自定义状态码、响应头，可使用如下方式：</p>
<p>1.元组方式：<br />
可以返回一个元组，这样的元组必须是
<code>(response, status, headers)</code> 的形式，且至少包含一个元素。
<code>status</code> 值会覆盖状态代码， <code>headers</code>
可以是一个列表或字典，作为额外的消息标头值。<br />
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@app.route(<span class="params"><span class="string">&#x27;/demo4&#x27;</span></span>)</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">demo4</span>():</span><br><span class="line">    <span class="comment"># return &#x27;状态码为 666&#x27;, 666</span></span><br><span class="line">    <span class="comment"># return &#x27;状态码为 666&#x27;, 666, [(&#x27;Itcast&#x27;, &#x27;Python&#x27;)]</span></span><br><span class="line">    <span class="keyword">return</span> <span class="string">&#x27;状态码为 666&#x27;</span>, <span class="number">666</span>, &#123;<span class="string">&#x27;Itcast&#x27;</span>: <span class="string">&#x27;Python&#x27;</span>&#125;</span><br></pre></td></tr></table></figure></p>
<p>2.make_response方式：<br />
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@app.route(<span class="params"><span class="string">&#x27;/demo5&#x27;</span></span>)</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">demo5</span>():</span><br><span class="line">    resp = make_response(<span class="string">&#x27;make response测试&#x27;</span>)  <span class="comment"># 响应体body</span></span><br><span class="line">    resp.headers[<span class="string">&quot;Itcast&quot;</span>] = <span class="string">&quot;Python&quot;</span>      <span class="comment"># 响应头headers</span></span><br><span class="line">    resp.status = <span class="string">&quot;404 not found&quot;</span>          <span class="comment"># 响应状态status，一定是完整的状态(状态码+描述信息)！</span></span><br><span class="line">    <span class="keyword">return</span> resp</span><br></pre></td></tr></table></figure></p>
<h2 id="cookie">Cookie</h2>
<p>Cookie是一段不超过4KB的小型文本数据，保存在客户端浏览器中，由一个名称（Name）、一个值（Value）和其它几个用于控制Cookie有效期、安全性、使用范围的可选属性组成。<br />
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">|-Name/Value：设置Cookie的名称及相对应的值，对于认证Cookie，Value值包括Web服务器所提供的访问令牌。</span><br><span class="line">|-Expires属性：设置Cookie的生存期。有两种存储类型的Cookie：</span><br><span class="line">    |-会话性：Expires属性缺省时，为会话性Cookie，仅保存在客户端内存中，并在用户关闭浏览器时失效；</span><br><span class="line">    |-持久性：Cookie会保存在用户的硬盘中，直至生存期到或用户直接在网页中单击<span class="string">&quot;注销&quot;</span>等按钮结束会话时才会失效。</span><br><span class="line">|-Path属性：定义了Web站点上可以访问该Cookie的目录。</span><br><span class="line">|-Domain属性：指定了可以访问该Cookie的Web站点或域。</span><br></pre></td></tr></table></figure></p>
<p>1.设置<br />
cookie只能在响应对象中设置，所以要先拿到响应体，所以只能用make_response方法构造响应。<br />
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> flask <span class="keyword">import</span> Flask, make_response</span><br><span class="line"></span><br><span class="line">app = Flask(__name__)</span><br><span class="line"></span><br><span class="line"><span class="meta">@app.route(<span class="params"><span class="string">&#x27;/cookie&#x27;</span></span>)</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">set_cookie</span>():</span><br><span class="line">    resp = make_response(<span class="string">&#x27;set cookie ok&#x27;</span>)  <span class="comment"># 先拿到响应体</span></span><br><span class="line">    <span class="comment"># key为username，value为ming</span></span><br><span class="line">    resp.set_cookie(<span class="string">&#x27;username&#x27;</span>, <span class="string">&#x27;ming&#x27;</span>, max_age=<span class="number">3600</span>)  <span class="comment"># 再设置cookie，默认有效期为窗口关闭, 也可max_age主动设置有效期</span></span><br><span class="line">    <span class="keyword">return</span> resp</span><br></pre></td></tr></table></figure></p>
<p>2.读取<br />
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> flask <span class="keyword">import</span> request</span><br><span class="line"></span><br><span class="line"><span class="meta">@app.route(<span class="params"><span class="string">&#x27;/get_cookie&#x27;</span></span>)</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">get_cookie</span>():</span><br><span class="line">    resp = request.cookies.get(<span class="string">&#x27;username&#x27;</span>)</span><br><span class="line">    <span class="keyword">return</span> resp</span><br></pre></td></tr></table></figure></p>
<p>3.删除<br />
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> flask <span class="keyword">import</span> request</span><br><span class="line"></span><br><span class="line"><span class="meta">@app.route(<span class="params"><span class="string">&#x27;/delete_cookie&#x27;</span></span>)</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">delete_cookie</span>():</span><br><span class="line">    response = make_response(<span class="string">&#x27;hello world&#x27;</span>)</span><br><span class="line">    response.delete_cookie(<span class="string">&#x27;username&#x27;</span>)  <span class="comment"># 不是真删除，是设置过早的有效期达到结束目的</span></span><br><span class="line">    <span class="keyword">return</span> response</span><br></pre></td></tr></table></figure></p>
<h2 id="session">Session</h2>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">|-Session：与cookie功能效果相同。</span><br><span class="line">    |-Session是记录在服务端的，而Cookie是记录在客户端的。</span><br><span class="line">    |-Django存储到Redis中，Flask存储到浏览器缓存中。</span><br></pre></td></tr></table></figure>
<p>当访问服务器否个网页的时候，会在服务器端的内存里开辟一块内存，这块内存就叫做session，而这个内存是跟浏览器关联在一起的。这个浏览器指的是浏览器窗口，或者是浏览器的子窗口，意思就是，只允许当前这个session对应的浏览器访问，就算是在同一个机器上新启的浏览器也是无法访问的。而另外一个浏览器也需要记录session的话，就会再启一个属于自己的session。</p>
<p><strong>问题</strong>：如何知道浏览器和这个服务器中的session是一一对应的呢？又如何保证不会去访问其它的session呢？<br />
<strong>解答</strong>：就是当访问一个页面的时候给浏览器创建一个独一无二的号码，也给同时创建的session赋予同样的号码。这样就可以在打开同一个网站的第二个页面时获取到第一个页面中session保留下来的对应信息（当访问第二个页面时将号码同时传递到第二个页面。找到对应的session）。这个号码也叫sessionID（签名），session的ID号码或者签名是独一无二的。</p>
<p><strong>Session的两种传递方式：第一种通过Cookies实现，第二种通过URL重写来实现。</strong><br />
<strong>Cookies实现</strong>：当客户端进行第一次请求时，客户端的HTTP
request（cookie为空）到服务端，服务端创建session，视图函数根据form表单填写session，请求结束时，session内容填写入response的cookie中并返回给客户端，客户端的cookie中便保存了用户的数据。当同一客户端再次请求时，
客户端的HTTP request中cookie已经携带数据，此时cookies不为空,
获取cookie的有效时长，如果cookie依然有效，通过与写入时同样的签名算法将cookie中的值解密出来，若cookie已经失效，则返回空。
再根据解密出来的内容判断服务器中是否存在对应的值。注意：在Flask中Session的签名算法是HMAC和SHA1算法。</p>
<p>为了防止用户修改这个session，那么需要设置签名，这就需要SECRET_KEY（也叫SessionID）了。<br />
1.先设置SECRET_KEY：<br />
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 1.第一种：配置对象设置</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">DefaultConfig</span>(<span class="title class_ inherited__">object</span>):</span><br><span class="line">    SECRET_KEY = <span class="string">&#x27;fih9fh9eh9gh2&#x27;</span></span><br><span class="line">app.config.from_object(DefaultConfig) <span class="comment"># 加载配置</span></span><br><span class="line"><span class="comment"># 2.第二种：直接设置</span></span><br><span class="line">app.secret_key=<span class="string">&#x27;xihwidfw9efw&#x27;</span></span><br></pre></td></tr></table></figure></p>
<p>2.设置Session<br />
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> flask <span class="keyword">import</span> session</span><br><span class="line"></span><br><span class="line"><span class="meta">@app.route(<span class="params"><span class="string">&#x27;/set_session&#x27;</span></span>)</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">set_session</span>():</span><br><span class="line">    session[<span class="string">&#x27;username&#x27;</span>] = <span class="string">&#x27;ming&#x27;</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> <span class="string">&#x27;set session ok&#x27;</span></span><br></pre></td></tr></table></figure></p>
<p>3.读取<br />
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@app.route(<span class="params"><span class="string">&#x27;/get_session&#x27;</span></span>)</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">get_session</span>():</span><br><span class="line">    username = session.get(<span class="string">&#x27;username&#x27;</span>)</span><br><span class="line">    <span class="keyword">return</span> <span class="string">&#x27;get session username &#123;&#125;&#x27;</span>.<span class="built_in">format</span>(username)</span><br></pre></td></tr></table></figure></p>
<p>Session还可以设置自定义对象，但需要继承JSONEncoder重写自己的序列化方法：<br />
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> flask <span class="keyword">import</span> Flask,session,json</span><br><span class="line"><span class="comment"># flask默认使用JSONEncoder序列化，但它默认不支持自定义对象的序列化，需要继承它重写自己的序列化</span></span><br><span class="line"><span class="keyword">from</span> flask.json <span class="keyword">import</span> JSONEncoder </span><br><span class="line"><span class="keyword">from</span> datetime <span class="keyword">import</span> timedelta</span><br><span class="line"><span class="keyword">import</span> os</span><br><span class="line"></span><br><span class="line">app = Flask(__name__)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 自定义类</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">User</span>(<span class="title class_ inherited__">object</span>):</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__init__</span>(<span class="params">self, xun, xpwd</span>):</span><br><span class="line">        self.username = xun</span><br><span class="line">        self.password = xpwd</span><br><span class="line"></span><br><span class="line"><span class="comment"># 自定义JSONEncoder，支持序列化User类</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">My_JSONEcoder</span>(<span class="title class_ inherited__">JSONEncoder</span>):</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">default</span>(<span class="params">self, obj</span>):</span><br><span class="line">        <span class="keyword">if</span> <span class="built_in">isinstance</span>(obj, User):</span><br><span class="line">            <span class="keyword">return</span> &#123;</span><br><span class="line">                <span class="string">&#x27;username&#x27;</span>:obj.username,</span><br><span class="line">                <span class="string">&#x27;password&#x27;</span>:obj.password</span><br><span class="line">            &#125;</span><br><span class="line">        <span class="keyword">else</span>:  <span class="comment"># 其他不是User类型的数据还是交给 默认的JSONEcoder处理</span></span><br><span class="line">            JSONEncoder.default(obj)</span><br><span class="line"><span class="comment"># 设置当前的jsonencoder</span></span><br><span class="line">app.json_encoder = My_JSONEcoder</span><br><span class="line"></span><br><span class="line"><span class="comment"># 设置SECRET_KEY</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">DefaultConfig</span>(<span class="title class_ inherited__">object</span>):</span><br><span class="line">    SECRET_KEY = os.urandom(<span class="number">24</span>)</span><br><span class="line">    <span class="comment"># 设置session的有效时间为30分钟。默认浏览器关闭即结束</span></span><br><span class="line">    PERMANENT_SESSION_LIFETIME = timedelta(minutes=<span class="number">30</span>)</span><br><span class="line"><span class="comment"># 加载配置</span></span><br><span class="line">app.config.from_object(DefaultConfig) </span><br><span class="line"></span><br><span class="line"><span class="meta">@app.route(<span class="params"><span class="string">&#x27;/set&#x27;</span></span>)</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">hello_world</span>(): </span><br><span class="line">    <span class="comment"># 使定义的session有效时间生效。</span></span><br><span class="line">    session.permanent = <span class="literal">True</span> <span class="comment"># 不设置PERMANENT_SESSION_LIFETIME启用此值，默认session有效期为31天。</span></span><br><span class="line">    <span class="comment"># print(app.config.get(&#x27;SECRET_KEY&#x27;))</span></span><br><span class="line">    <span class="comment"># 设置session</span></span><br><span class="line">    session[<span class="string">&#x27;un&#x27;</span>] = <span class="string">&#x27;laoxiao&#x27;</span></span><br><span class="line">    session[<span class="string">&#x27;pwd&#x27;</span>] = <span class="string">&#x27;123123&#x27;</span></span><br><span class="line">    session[<span class="string">&#x27;user&#x27;</span>] = User(<span class="string">&#x27;zhangsan&#x27;</span>,<span class="string">&#x27;123&#x27;</span>)</span><br><span class="line">    <span class="keyword">return</span> <span class="string">&#x27;hello laoxiao&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="meta">@app.route(<span class="params"><span class="string">&#x27;/get&#x27;</span></span>)</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">get_cookie</span>():</span><br><span class="line">    un = session.get(<span class="string">&#x27;un&#x27;</span>)</span><br><span class="line">    pwd = session.get(<span class="string">&#x27;pwd&#x27;</span>)</span><br><span class="line">    user_obj = session.get(<span class="string">&#x27;user&#x27;</span>)</span><br><span class="line">    <span class="built_in">print</span>(un,pwd,user_obj)</span><br><span class="line">    <span class="keyword">return</span> <span class="string">&quot;获取session的值&quot;</span></span><br></pre></td></tr></table></figure></p>
<h2 id="模板渲染">模板渲染</h2>
<p>使用render_template方法渲染模板并返回。</p>
<p>例如，新建一个模板index.html：<br />
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;!DOCTYPE <span class="keyword">html</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">html</span> <span class="attr">lang</span>=<span class="string">&quot;en&quot;</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">meta</span> <span class="attr">charset</span>=<span class="string">&quot;UTF-8&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">title</span>&gt;</span>Title<span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line">我的模板html内容</span><br><span class="line"><span class="tag">&lt;<span class="name">br</span>/&gt;</span>&#123;&#123; my_str &#125;&#125;</span><br><span class="line"><span class="tag">&lt;<span class="name">br</span>/&gt;</span>&#123;&#123; my_int &#125;&#125;</span><br><span class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure></p>
<p>后端视图：<br />
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> flask <span class="keyword">import</span> render_template</span><br><span class="line"></span><br><span class="line"><span class="comment"># 返回html</span></span><br><span class="line"><span class="meta">@app.route(<span class="params"><span class="string">&#x27;/&#x27;</span></span>)</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">index</span>():</span><br><span class="line">    mstr = <span class="string">&#x27;Hello World&#x27;</span></span><br><span class="line">    mint = <span class="number">10</span></span><br><span class="line">    <span class="comment"># html模板中的变量名作为参数名，前面定义的变量mstr、mint赋值给这些参数。</span></span><br><span class="line">    <span class="keyword">return</span> render_template(<span class="string">&#x27;index.html&#x27;</span>, my_str=mstr, my_int=mint)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 返回dict格式 </span></span><br><span class="line"><span class="meta">@app.route(<span class="params"><span class="string">&#x27;/&#x27;</span></span>)</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">index</span>():</span><br><span class="line">    <span class="comment"># 注意，参数名要和html一致</span></span><br><span class="line">    data = <span class="built_in">dict</span>(</span><br><span class="line">        my_str = <span class="string">&#x27;Hello World&#x27;</span>  </span><br><span class="line">        my_int = <span class="number">10</span></span><br><span class="line">    )</span><br><span class="line">    <span class="comment"># 解包</span></span><br><span class="line">    <span class="keyword">return</span> render_template(<span class="string">&#x27;index.html&#x27;</span>, **data)</span><br></pre></td></tr></table></figure></p>
<h1 id="异常">异常</h1>
<h2 id="主动抛出">主动抛出</h2>
<p>Flask自带abort方法，只需提供Http错误状态码，输出对应错误状态码页面，然后终止后续代码的执行。<br />
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> flask <span class="keyword">import</span> Flask, abort </span><br><span class="line"></span><br><span class="line">app = Flask(__name__)</span><br><span class="line"></span><br><span class="line">app.test = <span class="string">&#x27;test&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="meta">@app.route(<span class="params"><span class="string">&#x27;/&#x27;</span></span>)</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">index</span>():</span><br><span class="line">    <span class="keyword">if</span> app.test != <span class="literal">None</span>:</span><br><span class="line">        abort(<span class="number">404</span>)</span><br></pre></td></tr></table></figure><br />
## 捕获抛出<br />
errorhandler：钩子函数，注册一个错误处理程序，当程序抛出指定错误状态码的时候，就会调用该装饰器所装饰的方法。<br />
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 统一处理状态码为500的错误给用户友好的提示</span></span><br><span class="line"><span class="meta">@app.errorhandler(<span class="params"><span class="number">500</span></span>)</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">internal_server_error</span>(<span class="params">e</span>):</span><br><span class="line">    <span class="keyword">return</span> <span class="string">&#x27;服务器搬家了&#x27;</span> </span><br><span class="line"></span><br><span class="line"><span class="comment"># 捕获指定异常</span></span><br><span class="line"><span class="meta">@app.errorhandler(<span class="params">ZeroDivisionError</span>)</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">zero_division_error</span>(<span class="params">e</span>):</span><br><span class="line">    <span class="keyword">return</span> <span class="string">&#x27;除数不能为0&#x27;</span></span><br></pre></td></tr></table></figure></p>
<h1 id="jinja2模板">Jinja2模板</h1>
<p>大型工程会把项目细分为三个部分：<strong>表现层、业务逻辑层、数据层</strong>。<br />
之前视图函数会把业务逻辑、表现（返回响应内容）耦合，而模板作用是只做表现（渲染），从而把业务逻辑交给用户处理。</p>
<h2 id="模板传参">模板传参</h2>
<p>Jinja2使用 render_template
渲染模版，可通过key-value方式传参，这些参数可直接在模版中使用。<br />
如果参数项过多，可以将所有的参数放到一个字典/列表中。一般如果想将字典打散成关键字参数可以在参数的前面加<code>**</code>。<br />
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> flask <span class="keyword">import</span> Flask, render_template, redirect, request</span><br><span class="line"></span><br><span class="line">app = Flask(__name__)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 三种参数传递方式</span></span><br><span class="line">STUDENT = &#123;<span class="string">&#x27;name&#x27;</span>: <span class="string">&#x27;Old&#x27;</span>, <span class="string">&#x27;age&#x27;</span>: <span class="number">38</span>, <span class="string">&#x27;gender&#x27;</span>: <span class="string">&#x27;中&#x27;</span>&#125;</span><br><span class="line">STUDENT_LIST = [</span><br><span class="line">    &#123;<span class="string">&#x27;name&#x27;</span>: <span class="string">&#x27;Old&#x27;</span>, <span class="string">&#x27;age&#x27;</span>: <span class="number">38</span>, <span class="string">&#x27;gender&#x27;</span>: <span class="string">&#x27;中&#x27;</span>&#125;,</span><br><span class="line">    &#123;<span class="string">&#x27;name&#x27;</span>: <span class="string">&#x27;Boy&#x27;</span>, <span class="string">&#x27;age&#x27;</span>: <span class="number">73</span>, <span class="string">&#x27;gender&#x27;</span>: <span class="string">&#x27;男&#x27;</span>&#125;,</span><br><span class="line">    &#123;<span class="string">&#x27;name&#x27;</span>: <span class="string">&#x27;EDU&#x27;</span>, <span class="string">&#x27;age&#x27;</span>: <span class="number">84</span>, <span class="string">&#x27;gender&#x27;</span>: <span class="string">&#x27;女&#x27;</span>&#125;</span><br><span class="line">]</span><br><span class="line">STUDENT_DICT = &#123;</span><br><span class="line">    <span class="string">&#x27;a&#x27;</span>: &#123;<span class="string">&#x27;name&#x27;</span>: <span class="string">&#x27;Old&#x27;</span>, <span class="string">&#x27;age&#x27;</span>: <span class="number">38</span>, <span class="string">&#x27;gender&#x27;</span>: <span class="string">&#x27;中&#x27;</span>&#125;,</span><br><span class="line">    <span class="string">&#x27;b&#x27;</span>: &#123;<span class="string">&#x27;name&#x27;</span>: <span class="string">&#x27;Boy&#x27;</span>, <span class="string">&#x27;age&#x27;</span>: <span class="number">73</span>, <span class="string">&#x27;gender&#x27;</span>: <span class="string">&#x27;男&#x27;</span>&#125;,</span><br><span class="line">    <span class="string">&#x27;c&#x27;</span>: &#123;<span class="string">&#x27;name&#x27;</span>: <span class="string">&#x27;EDU&#x27;</span>, <span class="string">&#x27;age&#x27;</span>: <span class="number">84</span>, <span class="string">&#x27;gender&#x27;</span>: <span class="string">&#x27;女&#x27;</span>&#125;,</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">@app.route(<span class="params"><span class="string">&quot;/student&quot;</span></span>)</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">detail</span>():</span><br><span class="line">    <span class="comment">#print(url_for(&quot;detail&quot;))</span></span><br><span class="line">    <span class="keyword">return</span> render_template(<span class="string">&quot;student.html&quot;</span>, **STUDENT)</span><br><span class="line"></span><br><span class="line"><span class="meta">@app.route(<span class="params"><span class="string">&quot;/detail_list&quot;</span>, </span>)</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">detail_list</span>():</span><br><span class="line">    <span class="keyword">return</span> render_template(<span class="string">&quot;student_list.html&quot;</span>, stu_list=STUDENT_LIST)</span><br><span class="line"></span><br><span class="line"><span class="meta">@app.route(<span class="params"><span class="string">&quot;/detail_dict&quot;</span></span>)</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">detail_dict</span>():</span><br><span class="line">    <span class="keyword">return</span> render_template(<span class="string">&quot;student_dict.html&quot;</span>, stu_dict=STUDENT_DICT)</span><br></pre></td></tr></table></figure></p>
<p>这些参数通过render_template传递到.html中进行渲染，常见的表达式：<br />
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">变量传递：&#123;&#123;stu_list&#125;&#125;</span><br><span class="line">运算：&#123;&#123; 2 + 3 &#125;&#125;、如&#123;&#123; False and True &#125;&#125;</span><br><span class="line">函数调用：&#123;&#123; current_time() &#125;&#125;</span><br><span class="line">数组下标：&#123;&#123; arr[1] &#125;&#125;</span><br><span class="line">in操作符：&#123;&#123; 1 in [1,2,3] &#125;&#125;</span><br><span class="line">~字符串连接符：如&#123;&#123; &quot;Hello &quot; ~ name ~ &quot;!&quot; &#125;&#125;</span><br><span class="line">None值处理：&#123;&#123;name or &quot;&quot;&#125;&#125;</span><br></pre></td></tr></table></figure></p>
<h2 id="控制语句">控制语句</h2>
<p>条件判断语句：<br />
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">&#123;% if name and name == &#x27;admin&#x27; %&#125;</span><br><span class="line">    <span class="tag">&lt;<span class="name">h1</span>&gt;</span>This is admin console<span class="tag">&lt;/<span class="name">h1</span>&gt;</span></span><br><span class="line">&#123;% elif name %&#125;</span><br><span class="line">    <span class="tag">&lt;<span class="name">h1</span>&gt;</span>Welcome &#123;&#123; name &#125;&#125;!<span class="tag">&lt;/<span class="name">h1</span>&gt;</span></span><br><span class="line">&#123;% else %&#125;</span><br><span class="line">    <span class="tag">&lt;<span class="name">h1</span>&gt;</span>Please login<span class="tag">&lt;/<span class="name">h1</span>&gt;</span></span><br><span class="line">&#123;% endif %&#125;</span><br></pre></td></tr></table></figure></p>
<p>循环语句for：<br />
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">&#123;% for stu in stu_list%&#125;</span><br><span class="line">    &#123;&#123; stu &#125;&#125;</span><br><span class="line">&#123;% endfor %&#125;</span><br></pre></td></tr></table></figure></p>
<div class="tabs" id="模板"><ul class="nav-tabs"><li class="tab active"><a href="#模板-1">stu_list</a></li><li class="tab"><a href="#模板-2">stu_dict</a></li></ul><div class="tab-content"><div class="tab-pane active" id="模板-1"><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;!DOCTYPE <span class="keyword">html</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">html</span> <span class="attr">lang</span>=<span class="string">&quot;en&quot;</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">meta</span> <span class="attr">charset</span>=<span class="string">&quot;UTF-8&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">title</span>&gt;</span>Title<span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line">&#123;&#123; stu_list &#125;&#125;</span><br><span class="line"><span class="tag">&lt;<span class="name">table</span> <span class="attr">border</span>=<span class="string">&quot;1px&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">tr</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">td</span>&gt;</span>name<span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">td</span>&gt;</span>age<span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">td</span>&gt;</span>gender<span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">tr</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- 从stu_list控制数据的获取 --&gt;</span></span><br><span class="line">    &#123;% for stu in stu_list %&#125;</span><br><span class="line">        &#123;% if stu.name != &quot;Old&quot; %&#125;</span><br><span class="line">            &#123;% if stu.age != 73 %&#125;</span><br><span class="line">                <span class="tag">&lt;<span class="name">tr</span>&gt;</span></span><br><span class="line">                    <span class="comment">&lt;!-- 三种方法获取值 --&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">td</span>&gt;</span>&#123;&#123; stu.name &#125;&#125;<span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">td</span>&gt;</span>&#123;&#123; stu.get(&quot;age&quot;) &#125;&#125;<span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">td</span>&gt;</span>&#123;&#123; stu[&quot;gender&quot;] &#125;&#125;<span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;/<span class="name">tr</span>&gt;</span></span><br><span class="line">            &#123;% endif %&#125;</span><br><span class="line">        &#123;% endif %&#125;</span><br><span class="line">    &#123;% endfor %&#125;</span><br><span class="line"><span class="tag">&lt;/<span class="name">table</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure></div><div class="tab-pane" id="模板-2"><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;!DOCTYPE <span class="keyword">html</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">html</span> <span class="attr">lang</span>=<span class="string">&quot;en&quot;</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">meta</span> <span class="attr">charset</span>=<span class="string">&quot;UTF-8&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">title</span>&gt;</span>Title<span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line">&#123;&#123; stu_dict &#125;&#125;</span><br><span class="line"><span class="tag">&lt;<span class="name">table</span> <span class="attr">border</span>=<span class="string">&quot;1px&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">tr</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">td</span>&gt;</span>id<span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">td</span>&gt;</span>name<span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">td</span>&gt;</span>age<span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">td</span>&gt;</span>gender<span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">tr</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- 从stu_dict控制数据的获取 --&gt;</span></span><br><span class="line">    &#123;% for stu_key,stu_value in stu_dict.items() %&#125;</span><br><span class="line">    <span class="tag">&lt;<span class="name">tr</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!-- 循环自带的loop对象可获取索引 --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">td</span>&gt;</span>&#123;&#123; loop.index &#125;&#125;， Key: &#123;&#123; stu_key &#125;&#125;<span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">td</span>&gt;</span>&#123;&#123; stu_value.get(&quot;name&quot;) &#125;&#125;<span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">td</span>&gt;</span>&#123;&#123; stu_value.age &#125;&#125;<span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">td</span>&gt;</span>&#123;&#123; stu_value.gender &#125;&#125;<span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">tr</span>&gt;</span></span><br><span class="line">    &#123;% endfor %&#125;</span><br><span class="line"><span class="tag">&lt;/<span class="name">table</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure></div></div></div>
<h2 id="过滤器转换函数">过滤器（转换函数）</h2>
<p><strong>过滤器</strong>实质就是<strong>转换函数</strong>，变量可通过“过滤器”进行修改，过滤器可以理解为是jinja2里面的内置函数和字符串处理函数，常用过滤器有：<br />
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">过滤器名称          说明</span><br><span class="line">safe            渲染时值不转义</span><br><span class="line">capitialize     把值的首字母转换成大写，其他子母转换为小写</span><br><span class="line">lower           把值转换成小写形式</span><br><span class="line">upper           把值转换成大写形式</span><br><span class="line">title           把值中每个单词的首字母都转换成大写</span><br><span class="line">trim            把值的首尾空格去掉</span><br><span class="line">striptags       渲染之前把值中所有的HTML标签都删掉</span><br><span class="line">join            拼接多个值为字符串</span><br><span class="line">replace         替换字符串的值</span><br><span class="line"><span class="built_in">round</span>           默认对数字进行四舍五入，也可以用参数进行控制</span><br><span class="line"><span class="built_in">int</span>             把值转换成整型</span><br></pre></td></tr></table></figure></p>
<div class="tabs" id="过滤器"><ul class="nav-tabs"><li class="tab active"><a href="#过滤器-1">字符串</a></li><li class="tab"><a href="#过滤器-2">数值</a></li><li class="tab"><a href="#过滤器-3">列表</a></li><li class="tab"><a href="#过滤器-4">字典</a></li><li class="tab"><a href="#过滤器-5">自定义</a></li></ul><div class="tab-content"><div class="tab-pane active" id="过滤器-1"><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line">&#123;# 当变量未定义时，显示默认字符串，可以缩写为d #&#125;</span><br><span class="line"><span class="tag">&lt;<span class="name">p</span>&gt;</span>&#123;&#123; name | default(&#x27;No name&#x27;) &#125;&#125;<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line"></span><br><span class="line">&#123;# 单词首字母大写 #&#125;</span><br><span class="line"><span class="tag">&lt;<span class="name">p</span>&gt;</span>&#123;&#123; &#x27;hello world&#x27; | capitalize &#125;&#125;<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line"></span><br><span class="line">&#123;# 单词全小写 #&#125;</span><br><span class="line"><span class="tag">&lt;<span class="name">p</span>&gt;</span>&#123;&#123; &#x27;XML&#x27; | lower &#125;&#125;<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line"></span><br><span class="line">&#123;# 去除字符串前后的空白字符 #&#125;</span><br><span class="line"><span class="tag">&lt;<span class="name">p</span>&gt;</span>&#123;&#123; &#x27; hello &#x27; | trim &#125;&#125;<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line"></span><br><span class="line">&#123;# 字符串反转，返回&quot;olleh&quot; #&#125;</span><br><span class="line"><span class="tag">&lt;<span class="name">p</span>&gt;</span>&#123;&#123; &#x27;hello&#x27; | reverse &#125;&#125;<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line"></span><br><span class="line">&#123;# 格式化输出，返回&quot;Number is 99&quot; #&#125;</span><br><span class="line"><span class="tag">&lt;<span class="name">p</span>&gt;</span>&#123;&#123; &#x27;%s is %d&#x27; | format(&quot;Number&quot;, 99) &#125;&#125;<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line"></span><br><span class="line">&#123;# 关闭HTML自动转义 #&#125;</span><br><span class="line"><span class="tag">&lt;<span class="name">p</span>&gt;</span>&#123;&#123; &#x27;<span class="tag">&lt;<span class="name">em</span>&gt;</span>name<span class="tag">&lt;/<span class="name">em</span>&gt;</span>&#x27; | safe &#125;&#125;<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line"></span><br><span class="line">&#123;% autoescape false %&#125;</span><br><span class="line">&#123;# HTML转义，即使autoescape关了也转义，可以缩写为e #&#125;</span><br><span class="line"><span class="tag">&lt;<span class="name">p</span>&gt;</span>&#123;&#123; &#x27;<span class="tag">&lt;<span class="name">em</span>&gt;</span>name<span class="tag">&lt;/<span class="name">em</span>&gt;</span>&#x27; | escape &#125;&#125;<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line">&#123;% endautoescape %&#125;</span><br></pre></td></tr></table></figure></div><div class="tab-pane" id="过滤器-2"><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">&#123;# 四舍五入取整，返回13.0 #&#125;</span><br><span class="line"><span class="tag">&lt;<span class="name">p</span>&gt;</span>&#123;&#123; 12.98 | round &#125;&#125;<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line"></span><br><span class="line">&#123;# 向下截取到小数点后2位，返回12.88 #&#125;</span><br><span class="line"><span class="tag">&lt;<span class="name">p</span>&gt;</span>&#123;&#123; 12.8888 | round(2, &#x27;floor&#x27;) &#125;&#125;<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line"></span><br><span class="line">&#123;# 绝对值，返回12 #&#125;</span><br><span class="line"><span class="tag">&lt;<span class="name">p</span>&gt;</span>&#123;&#123; -12 | abs &#125;&#125;<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br></pre></td></tr></table></figure></div><div class="tab-pane" id="过滤器-3"><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">&#123;# 取第一个元素 #&#125;</span><br><span class="line"><span class="tag">&lt;<span class="name">p</span>&gt;</span>&#123;&#123; [1,2,3] | first &#125;&#125;<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line"></span><br><span class="line">&#123;# 取最后一个元素 #&#125;</span><br><span class="line"><span class="tag">&lt;<span class="name">p</span>&gt;</span>&#123;&#123; [1,2,3] | last &#125;&#125;<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line"></span><br><span class="line">&#123;# 返回列表长度，可以写为count #&#125;</span><br><span class="line"><span class="tag">&lt;<span class="name">p</span>&gt;</span>&#123;&#123; [1,2,3,4,5] | length &#125;&#125;<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line"></span><br><span class="line">&#123;# 列表求和 #&#125;</span><br><span class="line"><span class="tag">&lt;<span class="name">p</span>&gt;</span>&#123;&#123; [1,2,3,4,5] | sum &#125;&#125;<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line"></span><br><span class="line">&#123;# 列表排序，默认为升序 #&#125;</span><br><span class="line"><span class="tag">&lt;<span class="name">p</span>&gt;</span>&#123;&#123; [3,2,1,5,4] | sort &#125;&#125;<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line"></span><br><span class="line">&#123;# 合并为字符串，返回&quot;1 | 2 | 3 | 4 | 5&quot; #&#125;</span><br><span class="line"><span class="tag">&lt;<span class="name">p</span>&gt;</span>&#123;&#123; [1,2,3,4,5] | join(&#x27; | &#x27;) &#125;&#125;<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line"></span><br><span class="line">&#123;# 列表中所有元素都全大写。这里可以用upper,lower，但capitalize无效 #&#125;</span><br><span class="line"><span class="tag">&lt;<span class="name">p</span>&gt;</span>&#123;&#123; [&#x27;alex&#x27;,&#x27;bob&#x27;,&#x27;ada&#x27;] | upper &#125;&#125;<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br></pre></td></tr></table></figure></div><div class="tab-pane" id="过滤器-4"><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line">&#123;% set users=[&#123;&#x27;name&#x27;:&#x27;Tom&#x27;,&#x27;gender&#x27;:&#x27;M&#x27;,&#x27;age&#x27;:20&#125;,</span><br><span class="line">              &#123;&#x27;name&#x27;:&#x27;John&#x27;,&#x27;gender&#x27;:&#x27;M&#x27;,&#x27;age&#x27;:18&#125;,</span><br><span class="line">              &#123;&#x27;name&#x27;:&#x27;Mary&#x27;,&#x27;gender&#x27;:&#x27;F&#x27;,&#x27;age&#x27;:24&#125;,</span><br><span class="line">              &#123;&#x27;name&#x27;:&#x27;Bob&#x27;,&#x27;gender&#x27;:&#x27;M&#x27;,&#x27;age&#x27;:31&#125;,</span><br><span class="line">              &#123;&#x27;name&#x27;:&#x27;Lisa&#x27;,&#x27;gender&#x27;:&#x27;F&#x27;,&#x27;age&#x27;:19&#125;]</span><br><span class="line">%&#125;</span><br><span class="line"></span><br><span class="line">&#123;# 按指定字段排序，这里设reverse为true使其按降序排 #&#125;</span><br><span class="line"><span class="tag">&lt;<span class="name">ul</span>&gt;</span></span><br><span class="line">&#123;% for user in users | sort(attribute=&#x27;age&#x27;, reverse=true) %&#125;</span><br><span class="line">    <span class="tag">&lt;<span class="name">li</span>&gt;</span>&#123;&#123; user.name &#125;&#125;, &#123;&#123; user.age &#125;&#125;<span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br><span class="line">&#123;% endfor %&#125;</span><br><span class="line"><span class="tag">&lt;/<span class="name">ul</span>&gt;</span></span><br><span class="line"></span><br><span class="line">&#123;# 列表分组，每组是一个子列表，组名就是分组项的值 #&#125;</span><br><span class="line"><span class="tag">&lt;<span class="name">ul</span>&gt;</span></span><br><span class="line">&#123;% for group in users|groupby(&#x27;gender&#x27;) %&#125;</span><br><span class="line">    <span class="tag">&lt;<span class="name">li</span>&gt;</span>&#123;&#123; group.grouper &#125;&#125;<span class="tag">&lt;<span class="name">ul</span>&gt;</span></span><br><span class="line">    &#123;% for user in group.list %&#125;</span><br><span class="line">        <span class="tag">&lt;<span class="name">li</span>&gt;</span>&#123;&#123; user.name &#125;&#125;<span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br><span class="line">    &#123;% endfor %&#125;<span class="tag">&lt;/<span class="name">ul</span>&gt;</span><span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br><span class="line">&#123;% endfor %&#125;</span><br><span class="line"><span class="tag">&lt;/<span class="name">ul</span>&gt;</span></span><br><span class="line"></span><br><span class="line">&#123;# 取字典中的某一项组成列表，再将其连接起来 #&#125;</span><br><span class="line"><span class="tag">&lt;<span class="name">p</span>&gt;</span>&#123;&#123; users | map(attribute=&#x27;name&#x27;) | join(&#x27;, &#x27;) &#125;&#125;<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br></pre></td></tr></table></figure></div><div class="tab-pane" id="过滤器-5"><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 第一种方式</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">get_even_list</span>(<span class="params">l</span>):</span><br><span class="line">    <span class="keyword">return</span> l[::<span class="number">2</span>]</span><br><span class="line"><span class="comment"># 函数的第一个参数是过滤器函数，第二个参数是过滤器名称</span></span><br><span class="line">app.jinja_env.filters[<span class="string">&#x27;even_filter&#x27;</span>] = get_even_list</span><br><span class="line"></span><br><span class="line"><span class="comment"># 第二种方式</span></span><br><span class="line"><span class="meta">@app.template_filter() </span><span class="comment"># 过滤器函数</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">is_even</span>(<span class="params">num</span>):</span><br><span class="line">    <span class="keyword">if</span> num % <span class="number">2</span> == <span class="number">0</span>:</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;even number&quot;</span></span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;odd number&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="string">&quot;&quot;&quot;html</span></span><br><span class="line"><span class="string">&lt;p&gt;&#123;&#123; [1,2,3,4,5] | even_filter &#125;&#125;&lt;/p&gt;</span></span><br><span class="line"><span class="string">&lt;p&gt;&#123;&#123; 2 | is_even &#125;&#125;&lt;/p&gt;</span></span><br><span class="line"><span class="string">&quot;&quot;&quot;</span></span><br></pre></td></tr></table></figure></div></div></div>
<h2 id="测试器">测试器</h2>
<p><strong>测试器总是返回一个布尔值，它可以用来测试一个变量/表达式，使用“is”关键字来进行测试。</strong><br />
测试器本质上也是一个函数，它的第一个参数就是待测试的变量，在模板中使用时可以省略去。如果它有第二个参数，模板中就必须传进去。测试器函数返回的必须是一个布尔值，这样才可以用来给if语句作判断。<br />
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">&#123;% set name=&#x27;ab&#x27; %&#125;</span><br><span class="line">&#123;% if name is lower %&#125;</span><br><span class="line">    <span class="tag">&lt;<span class="name">h2</span>&gt;</span>&quot;&#123;&#123; name &#125;&#125;&quot; are all lower case.<span class="tag">&lt;/<span class="name">h2</span>&gt;</span></span><br><span class="line">&#123;% endif %&#125;</span><br></pre></td></tr></table></figure></p>
<p>Jinja2内置的一些测试器：<br />
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line">&#123;# 检查变量是否被定义，也可以用undefined检查是否未被定义 #&#125;</span><br><span class="line">&#123;% if name is defined %&#125;</span><br><span class="line">    <span class="tag">&lt;<span class="name">p</span>&gt;</span>Name is: &#123;&#123; name &#125;&#125;<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line">&#123;% endif %&#125;</span><br><span class="line"></span><br><span class="line">&#123;# 检查是否所有字符都是大写 #&#125;</span><br><span class="line">&#123;% if name is upper %&#125;</span><br><span class="line">    <span class="tag">&lt;<span class="name">h2</span>&gt;</span>&quot;&#123;&#123; name &#125;&#125;&quot; are all upper case.<span class="tag">&lt;/<span class="name">h2</span>&gt;</span></span><br><span class="line">&#123;% endif %&#125;</span><br><span class="line"></span><br><span class="line">&#123;# 检查变量是否为空 #&#125;</span><br><span class="line">&#123;% if name is none %&#125;</span><br><span class="line">    <span class="tag">&lt;<span class="name">h2</span>&gt;</span>Variable is none.<span class="tag">&lt;/<span class="name">h2</span>&gt;</span></span><br><span class="line">&#123;% endif %&#125;</span><br><span class="line"></span><br><span class="line">&#123;# 检查变量是否为字符串，也可以用number检查是否为数值 #&#125;</span><br><span class="line">&#123;% if name is string %&#125;</span><br><span class="line">    <span class="tag">&lt;<span class="name">h2</span>&gt;</span>&#123;&#123; name &#125;&#125; is a string.<span class="tag">&lt;/<span class="name">h2</span>&gt;</span></span><br><span class="line">&#123;% endif %&#125;</span><br><span class="line"></span><br><span class="line">&#123;# 检查数值是否是偶数，也可以用odd检查是否为奇数 #&#125;</span><br><span class="line">&#123;% if 2 is even %&#125;</span><br><span class="line">    <span class="tag">&lt;<span class="name">h2</span>&gt;</span>Variable is an even number.<span class="tag">&lt;/<span class="name">h2</span>&gt;</span></span><br><span class="line">&#123;% endif %&#125;</span><br><span class="line"></span><br><span class="line">&#123;# 检查变量是否可被迭代循环，也可以用sequence检查是否是序列 #&#125;</span><br><span class="line">&#123;% if [1,2,3] is iterable %&#125;</span><br><span class="line">    <span class="tag">&lt;<span class="name">h2</span>&gt;</span>Variable is iterable.<span class="tag">&lt;/<span class="name">h2</span>&gt;</span></span><br><span class="line">&#123;% endif %&#125;</span><br><span class="line"></span><br><span class="line">&#123;# 检查变量是否是字典 #&#125;</span><br><span class="line">&#123;% if &#123;&#x27;name&#x27;:&#x27;test&#x27;&#125; is mapping %&#125;</span><br><span class="line">    <span class="tag">&lt;<span class="name">h2</span>&gt;</span>Variable is dict.<span class="tag">&lt;/<span class="name">h2</span>&gt;</span></span><br><span class="line">&#123;% endif %&#125;</span><br></pre></td></tr></table></figure></p>
<p>自定义测试器：<br />
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 第一种方式</span></span><br><span class="line"><span class="keyword">import</span> re</span><br><span class="line"><span class="keyword">def</span> <span class="title function_">test_tel</span>(<span class="params">tel_num</span>):</span><br><span class="line">    tel_re = <span class="string">r&#x27;\d&#123;11&#125;&#x27;</span></span><br><span class="line">    <span class="keyword">return</span> re.<span class="keyword">match</span>(tel_re,tel_num)</span><br><span class="line">app.jinja_env.tests[<span class="string">&#x27;is_tel&#x27;</span>] = test_tel</span><br><span class="line"></span><br><span class="line"><span class="comment"># 第二种方式</span></span><br><span class="line"><span class="meta">@app.template_test(<span class="params"><span class="string">&#x27;start_with&#x27;</span></span>) </span><span class="comment"># 参数为测试器名字</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">start_with</span>(<span class="params"><span class="built_in">str</span>, suffix</span>):</span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">str</span>.lower().startswith(suffix.lower())</span><br><span class="line"></span><br><span class="line"><span class="string">&quot;&quot;&quot;html</span></span><br><span class="line"><span class="string">&#123;% set tel = &#x27;18910171111&#x27; %&#125;</span></span><br><span class="line"><span class="string">&#123;% if tel is is_tel %&#125;</span></span><br><span class="line"><span class="string">    &lt;h2&gt;&#123;&#123; tel &#125;&#125; is mobile phone&lt;/h2&gt;</span></span><br><span class="line"><span class="string">&#123;% endif %&#125;</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">&#123;% set name = &#x27;Hello world&#x27; %&#125;</span></span><br><span class="line"><span class="string">&#123;% if name is start_with &#x27;hello&#x27; %&#125;</span></span><br><span class="line"><span class="string">    &lt;h2&gt;&quot;&#123;&#123; name &#125;&#125;&quot; start_with &quot;hello&quot;&lt;/h2&gt;</span></span><br><span class="line"><span class="string">&#123;% endif %&#125;</span></span><br><span class="line"><span class="string">&quot;&quot;&quot;</span></span><br></pre></td></tr></table></figure></p>
<h2 id="继承">继承</h2>
<p>需要做很多页面，但重复元素很多的时候，比如页首，页脚，导航栏之类的。对于每个页面，都要写这些代码，很麻烦。Flask的Jinja2模板支持模板继承功能，省去了这些重复代码。</p>
<div class="tabs" id="继承"><ul class="nav-tabs"><li class="tab active"><a href="#继承-1">父模板</a></li><li class="tab"><a href="#继承-2">子模板</a></li></ul><div class="tab-content"><div class="tab-pane active" id="继承-1"><figure class="highlight html"><figcaption><span>parent.html</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line">&#123;% block temp1 %&#125;</span><br><span class="line">    <span class="tag">&lt;<span class="name">p</span>&gt;</span>页面的头部<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">hr</span>&gt;</span></span><br><span class="line">&#123;% endblock %&#125;</span><br><span class="line"></span><br><span class="line">&#123;% block temp2 %&#125;</span><br><span class="line">    <span class="tag">&lt;<span class="name">hr</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">p</span>&gt;</span>页面的尾部<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line">&#123;% endblock %&#125;</span><br><span class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br></pre></td></tr></table></figure></div><div class="tab-pane" id="继承-2"><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">&#123;% extends &quot;parent.html&quot; %&#125;</span><br><span class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="comment">&lt;!-- 继承关系，默认子模板temp1会覆盖掉父模板的temp1 --&gt;</span></span><br><span class="line">&#123;% block temp1 %&#125;</span><br><span class="line">    <span class="comment">&lt;!-- super()表示父模板并不会被覆盖掉 --&gt;</span></span><br><span class="line">    &#123;&#123; super() &#125;&#125;</span><br><span class="line">    <span class="tag">&lt;<span class="name">p</span>&gt;</span>子模版的内容<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line">&#123;% endblock %&#125;</span><br><span class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br></pre></td></tr></table></figure></div></div></div>
<p>当然include标签也可以做到上述内容：这个标签相当于是，<strong>直接将指定的模版中的代码复制粘贴到当前位置</strong>。include标签，可直接使用父模版中的变量，include的路径，也是跟import一样，直接从templates根目录下去找，不要以相对路径去找。<br />
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;!DOCTYPE <span class="keyword">html</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">html</span> <span class="attr">lang</span>=<span class="string">&quot;en&quot;</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">meta</span> <span class="attr">charset</span>=<span class="string">&quot;UTF-8&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">title</span>&gt;</span>include<span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!--通过include 引入头部log信息--&gt;</span></span><br><span class="line">    &#123;% include &quot;head.html&quot; %&#125;</span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span>&gt;</span></span><br><span class="line">        这是首页内容</span><br><span class="line">        &#123;&#123; major &#125;&#125;</span><br><span class="line">    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">hr</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!--通过include 引入底部版权信息--&gt;</span></span><br><span class="line">    &#123;% include &quot;footer.html&quot; %&#125;</span><br><span class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure></p>
<h2 id="url_for">url_for</h2>
<p>模版中的 url_for 跟后台视图函数中的 url_for
使用起来基本是一模一样的。它可以传递视图函数的名字，也可以传递参数。</p>
<p><strong>1.动态超链接</strong><br />
url_for
第一个参数需要为<strong>视图函数名字</strong>，其余为视图函数参数。<br />
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- html页面使用如： --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">&quot;&#123;&#123; url_for(&#x27;login&#x27;,p1=&#x27;abc&#x27;,p2=&#x27;ddd&#x27;,name=&#x27;momo&#x27;) &#125;&#125;&quot;</span>&gt;</span>登录<span class="tag">&lt;/<span class="name">a</span>&gt;</span></span><br><span class="line"><span class="comment">&lt;!-- 点击变为： --&gt;</span></span><br><span class="line">http://127.0.0.1:5000/accounts/login/momo/?p1=abc&amp;p2=ddd</span><br></pre></td></tr></table></figure></p>
<p>对应的视图函数：<br />
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@app.route(<span class="params"><span class="string">&#x27;/accounts/login/&lt;name&gt;/&#x27;</span></span>)</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">login</span>(<span class="params">name</span>):</span><br><span class="line">    <span class="built_in">print</span>(name)</span><br><span class="line">    <span class="keyword">return</span> render_template(<span class="string">&#x27;login.html&#x27;</span>)</span><br></pre></td></tr></table></figure></p>
<p><strong>2.加载静态文件</strong><br />
静态文件：css、js、图片等文件。<br />
url_for 第一个参数需要为 <code>static</code>
，第二个参数需要为一个关键字参数 <code>filename='路径'</code>。<br />
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">link</span> <span class="attr">href</span>=<span class="string">&quot;&#123;&#123; url_for(&#x27;static&#x27;,filename=&#x27;css/main.css&#x27;) &#125;&#125;&quot;</span> <span class="attr">rel</span>=<span class="string">&quot;stylesheet&quot;</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span> <span class="attr">src</span>=<span class="string">&quot;&#123;&#123; url_for(&#x27;static&#x27;,filename=&#x27;js/main.js&#x27;) &#125;&#125;&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">img</span> <span class="attr">src</span>=<span class="string">&quot;&#123;&#123; url_for(&#x27;static&#x27;,filename=&#x27;img/main.jpg&#x27;) &#125;&#125;&quot;</span>/&gt;</span></span><br></pre></td></tr></table></figure></p>
<h1 id="参考文献">参考文献</h1>
<p><span class="exturl" data-url="aHR0cHM6Ly9mbGFzay5wYWxsZXRzcHJvamVjdHMuY29tL2VuL2xhdGVzdC8=">Flask官网<i class="fa fa-external-link-alt"></i></span><br />
<span class="exturl" data-url="aHR0cHM6Ly9kb3Jtb3VzZWhvbGUucmVhZHRoZWRvY3MuaW8vZW4vbGF0ZXN0L2luZGV4Lmh0bWw=">Flask中文官网<i class="fa fa-external-link-alt"></i></span><br />
<span class="exturl" data-url="aHR0cHM6Ly9mbGFzay1yZXN0ZnVsLnJlYWR0aGVkb2NzLmlvL2VuL2xhdGVzdC9xdWlja3N0YXJ0Lmh0bWw=">Flask-RESTful<i class="fa fa-external-link-alt"></i></span><br />
<span class="exturl" data-url="aHR0cDovL3d3dy5weXRob25kb2MuY29tL0ZsYXNrLVJFU1RmdWwvcXVpY2tzdGFydC5odG1s">Flask-RESTful中文<i class="fa fa-external-link-alt"></i></span><br />
<span class="exturl" data-url="aHR0cDovL3d3dy5iamhlZS5jb20vZmxhc2stMS5odG1s">Flask入门系列(一)–Hello
World<i class="fa fa-external-link-alt"></i></span><br />
<span class="exturl" data-url="aHR0cDovL3d3dy5iamhlZS5jb20vZmxhc2stYWQxLmh0bWw=">Flask进阶系列(一)–上下文环境<i class="fa fa-external-link-alt"></i></span><br />
<span class="exturl" data-url="aHR0cHM6Ly9mbGFzay5wYWxsZXRzcHJvamVjdHMuY29tL2VuLzIuMi54Lw==">Flask
Documentation (2.2.x)<i class="fa fa-external-link-alt"></i></span><br />
<span class="exturl" data-url="aHR0cHM6Ly9naXRodWIuY29tL3BhbGxldHMvZmxhc2s=">pallets/flask<i class="fa fa-external-link-alt"></i></span></p>

    </div>

    
    
    

    <footer class="post-footer">
          

<div class="post-copyright">
<ul>
  <li class="post-copyright-author">
      <strong>本文作者： </strong>SoundMemories
  </li>
  <li class="post-copyright-link">
      <strong>本文链接：</strong>
      <a href="https://soundmemories.github.io/2021/07/19/Python/22.Flask/" title="Flask">https://soundmemories.github.io/2021/07/19/Python/22.Flask/</a>
  </li>
  <li class="post-copyright-license">
      <strong>版权声明： </strong>本博客所有文章除特别声明外，均采用 <span class="exturl" data-url="aHR0cHM6Ly9jcmVhdGl2ZWNvbW1vbnMub3JnL2xpY2Vuc2VzL2J5LW5jLXNhLzQuMC8="><i class="fab fa-fw fa-creative-commons"></i>BY-NC-SA</span> 许可协议。转载请注明出处！
  </li>
</ul>
</div>

          <div class="post-tags">
              <a href="/tags/Python/" rel="tag"><i class="fa fa-tag"></i> Python</a>
          </div>

        

          <div class="post-nav">
            <div class="post-nav-item">
                <a href="/2021/07/19/NLP/04.Transformer/" rel="prev" title="Transformer">
                  <i class="fa fa-chevron-left"></i> Transformer
                </a>
            </div>
            <div class="post-nav-item">
                <a href="/2021/07/20/NLP/05.Bert/" rel="next" title="Bert">
                  Bert <i class="fa fa-chevron-right"></i>
                </a>
            </div>
          </div>
    </footer>
  </article>
</div>






</div>
  </main>

  <footer class="footer">
    <div class="footer-inner">

  <div class="copyright">
    &copy; 2019 – 
    <span itemprop="copyrightYear">2025</span>
    <span class="with-love">
      <i class="fa fa-heart"></i>
    </span>
    <span class="author" itemprop="copyrightHolder">SoundMemories</span>
  </div>
  <div class="powered-by">由 <span class="exturl" data-url="aHR0cHM6Ly9oZXhvLmlv">Hexo</span> & <span class="exturl" data-url="aHR0cHM6Ly90aGVtZS1uZXh0LmpzLm9yZy9tdXNlLw==">NexT.Muse</span> 强力驱动
  </div>

    </div>
  </footer>

  
  <div class="toggle sidebar-toggle" role="button">
    <span class="toggle-line"></span>
    <span class="toggle-line"></span>
    <span class="toggle-line"></span>
  </div>
  <div class="sidebar-dimmer"></div>
  <div class="back-to-top" role="button" aria-label="返回顶部">
    <i class="fa fa-arrow-up fa-lg"></i>
    <span>0%</span>
  </div>
  <a role="button" class="book-mark-link book-mark-link-fixed"></a>

<noscript>
  <div class="noscript-warning">Theme NexT works best with JavaScript enabled</div>
</noscript>


  
  <script src="https://cdnjs.cloudflare.com/ajax/libs/animejs/3.2.1/anime.min.js" integrity="sha256-XL2inqUJaslATFnHdJOi9GfQ60on8Wx1C2H8DYiN1xY=" crossorigin="anonymous"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/next-theme-pjax/0.6.0/pjax.min.js" integrity="sha256-vxLn1tSKWD4dqbMRyv940UYw4sXgMtYcK6reefzZrao=" crossorigin="anonymous"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.7.0/jquery.min.js" integrity="sha256-2Pmvv0kuTBOenSvLm6bvfBSSHrUJ+3A7x6P5Ebd07/g=" crossorigin="anonymous"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/fancybox/3.5.7/jquery.fancybox.min.js" integrity="sha256-yt2kYMy0w8AbtF89WXb2P1rfjcP/HTHLT7097U8Y5b8=" crossorigin="anonymous"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/medium-zoom/1.0.8/medium-zoom.min.js" integrity="sha256-7PhEpEWEW0XXQ0k6kQrPKwuoIomz8R8IYyuU1Qew4P8=" crossorigin="anonymous"></script>
<script src="/js/comments.js"></script><script src="/js/utils.js"></script><script src="/js/motion.js"></script><script src="/js/schemes/muse.js"></script><script src="/js/next-boot.js"></script><script src="/js/bookmark.js"></script><script src="/js/pjax.js"></script>

  <script src="https://cdnjs.cloudflare.com/ajax/libs/hexo-generator-searchdb/1.4.1/search.js" integrity="sha256-1kfA5uHPf65M5cphT2dvymhkuyHPQp5A53EGZOnOLmc=" crossorigin="anonymous"></script>
<script src="/js/third-party/search/local-search.js"></script>

  <script class="next-config" data-name="pdf" type="application/json">{"object_url":{"url":"https://cdnjs.cloudflare.com/ajax/libs/pdfobject/2.2.12/pdfobject.min.js","integrity":"sha256-g2xji1rlE3KsGVClvuxTbcR0Kn2+wtQADSff2Tbb4zA="},"url":"/lib/pdf/web/viewer.html"}</script>
  <script src="/js/third-party/tags/pdf.js"></script>

  <script class="next-config" data-name="mermaid" type="application/json">{"enable":true,"theme":{"light":"neutral","dark":"neutral"},"js":{"url":"https://cdnjs.cloudflare.com/ajax/libs/mermaid/10.2.3/mermaid.min.js","integrity":"sha256-JFptYy4KzJ5OQP+Q9fubNf3cxpPPmZKqUOovyEONKrQ="}}</script>
  <script src="/js/third-party/tags/mermaid.js"></script>


  <script src="/js/third-party/fancybox.js"></script>



  




  

  <script class="next-config" data-name="enableMath" type="application/json">true</script><script class="next-config" data-name="mathjax" type="application/json">{"enable":true,"tags":"none","js":{"url":"https://cdnjs.cloudflare.com/ajax/libs/mathjax/3.2.2/es5/tex-mml-chtml.js","integrity":"sha256-MASABpB4tYktI2Oitl4t+78w/lyA+D7b/s9GEP0JOGI="}}</script>
<script src="/js/third-party/math/mathjax.js"></script>


  <script src="https://cdnjs.cloudflare.com/ajax/libs/quicklink/2.3.0/quicklink.umd.js" integrity="sha256-yvJQOINiH9fWemHn0vCA5lsHWJaHs6/ZmO+1Ft04SvM=" crossorigin="anonymous"></script>
  <script class="next-config" data-name="quicklink" type="application/json">{"enable":true,"home":true,"archive":true,"delay":true,"timeout":3000,"priority":true,"url":"https://soundmemories.github.io/2021/07/19/Python/22.Flask/"}</script>
  <script src="/js/third-party/quicklink.js"></script>

</body>
</html>
