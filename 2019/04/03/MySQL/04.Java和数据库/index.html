<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=2">
<meta name="theme-color" content="#222">
<meta name="generator" content="Hexo 5.2.0">


  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png">
  <link rel="mask-icon" href="/images/logo.svg" color="#222">

<link rel="stylesheet" href="/css/main.css">

<link rel="stylesheet" href="https://fonts.loli.net/css?family=Monda:300,300italic,400,400italic,700,700italic&display=swap&subset=latin,latin-ext">

<link rel="stylesheet" href="//cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@5.15.1/css/all.min.css">
  <link rel="stylesheet" href="//cdn.jsdelivr.net/npm/animate.css@3.1.1/animate.min.css">
  <link rel="stylesheet" href="//cdn.jsdelivr.net/npm/@fancyapps/fancybox@3.5.7/dist/jquery.fancybox.min.css">

<script class="hexo-configurations">
    var NexT = window.NexT || {};
    var CONFIG = {"hostname":"soundmemories.github.io","root":"/","images":"/images","scheme":"Muse","version":"8.0.2","exturl":true,"sidebar":{"position":"left","display":"always","padding":18,"offset":12},"copycode":true,"bookmark":{"enable":true,"color":"#222","save":"auto"},"fancybox":true,"mediumzoom":true,"lazyload":false,"pangu":false,"comments":{"style":"tabs","active":null,"storage":true,"lazyload":false,"nav":null},"motion":{"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"fadeInDown","post_body":"fadeInDown","coll_header":"fadeInLeft","sidebar":"fadeInUp"}},"prism":false,"i18n":{"placeholder":"搜索...","empty":"没有找到任何搜索结果：${query}","hits_time":"找到 ${hits} 个搜索结果（用时 ${time} 毫秒）","hits":"找到 ${hits} 个搜索结果"},"path":"/search.xml","localsearch":{"enable":true,"trigger":"auto","top_n_per_article":1,"unescape":false,"preload":false}};
  </script>

  <meta name="description" content="JDBC在Java中，数据库存取技术可分为如下几类：（1）JDBC直接访问数据库。（2）JDO（Java Data Object）技术。（3）第三方O&#x2F;R工具，如Hibernate, Mybatis 等。JDBC是Java访问数据库的基石，JDO, Hibernate等只是更好的封装了JDBC。 什么是JDBC？JDBC(Java Database Connectivity)是一个独立于特定数据库">
<meta property="og:type" content="article">
<meta property="og:title" content="Java和数据库">
<meta property="og:url" content="https://soundmemories.github.io/2019/04/03/MySQL/04.Java%E5%92%8C%E6%95%B0%E6%8D%AE%E5%BA%93/index.html">
<meta property="og:site_name" content="SoundMemories">
<meta property="og:description" content="JDBC在Java中，数据库存取技术可分为如下几类：（1）JDBC直接访问数据库。（2）JDO（Java Data Object）技术。（3）第三方O&#x2F;R工具，如Hibernate, Mybatis 等。JDBC是Java访问数据库的基石，JDO, Hibernate等只是更好的封装了JDBC。 什么是JDBC？JDBC(Java Database Connectivity)是一个独立于特定数据库">
<meta property="og:locale" content="zh_CN">
<meta property="og:image" content="https://i.loli.net/2021/04/29/5DxUkgzr2wS3GjL.png">
<meta property="og:image" content="https://i.loli.net/2021/04/29/CrEJ4RQeuogaVFW.png">
<meta property="og:image" content="https://i.loli.net/2021/04/29/LIR6zDhk5s7YiKA.jpg">
<meta property="og:image" content="https://i.loli.net/2021/04/29/JIxDS8rf49snHTV.jpg">
<meta property="og:image" content="https://i.loli.net/2021/04/29/RmtBDurWVUozPdS.png">
<meta property="og:image" content="https://i.loli.net/2021/04/29/NcV5Q9KA8CzBXvS.png">
<meta property="og:image" content="https://i.loli.net/2021/04/29/gJdOLFG6K5zMovH.png">
<meta property="og:image" content="https://i.loli.net/2021/04/29/fBctnrApV5NdS8J.png">
<meta property="og:image" content="https://i.loli.net/2021/04/29/u2sCpFZilGgdtm5.png">
<meta property="article:published_time" content="2019-04-02T16:00:00.000Z">
<meta property="article:modified_time" content="2021-05-01T14:38:53.532Z">
<meta property="article:author" content="SoundMemories">
<meta property="article:tag" content="MySQL">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://i.loli.net/2021/04/29/5DxUkgzr2wS3GjL.png">


<link rel="canonical" href="https://soundmemories.github.io/2019/04/03/MySQL/04.Java%E5%92%8C%E6%95%B0%E6%8D%AE%E5%BA%93/">


<script data-pjax class="page-configurations">
  // https://hexo.io/docs/variables.html
  CONFIG.page = {
    sidebar: "",
    isHome : false,
    isPost : true,
    lang   : 'zh-CN'
  };
</script>

  <title>Java和数据库 | SoundMemories</title>
  






  <noscript>
  <style>
  body { margin-top: 2rem; }

  .use-motion .menu-item,
  .use-motion .sidebar,
  .use-motion .post-block,
  .use-motion .pagination,
  .use-motion .comments,
  .use-motion .post-header,
  .use-motion .post-body,
  .use-motion .collection-header {
    visibility: visible;
  }

  .use-motion .header,
  .use-motion .site-brand-container .toggle,
  .use-motion .footer { opacity: initial; }

  .use-motion .site-title,
  .use-motion .site-subtitle,
  .use-motion .custom-logo-image {
    opacity: initial;
    top: initial;
  }

  .use-motion .logo-line {
    transform: scaleX(1);
  }

  .search-pop-overlay, .sidebar-nav { display: none; }
  .sidebar-panel { display: block; }
  </style>
</noscript>

</head>

<body itemscope itemtype="http://schema.org/WebPage" class="use-motion">
  <div class="headband"></div>

  <main class="main">
    <header class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-container">
  <div class="site-nav-toggle">
    <div class="toggle" aria-label="切换导航栏">
        <span class="toggle-line"></span>
        <span class="toggle-line"></span>
        <span class="toggle-line"></span>
    </div>
  </div>

  <div class="site-meta">

    <a href="/" class="brand" rel="start">
      <i class="logo-line"></i>
      <h1 class="site-title">SoundMemories</h1>
      <i class="logo-line"></i>
    </a>
  </div>

  <div class="site-nav-right">
    <div class="toggle popup-trigger">
        <i class="fa fa-search fa-fw fa-lg"></i>
    </div>
  </div>
</div>



<nav class="site-nav">
  <ul class="main-menu menu">
        <li class="menu-item menu-item-主页">

    <a href="/" rel="section"><i class="fa fa-home fa-fw"></i>主页</a>

  </li>
        <li class="menu-item menu-item-分类">

    <a href="/categories/" rel="section"><i class="fa fa-th fa-fw"></i>分类</a>

  </li>
        <li class="menu-item menu-item-标签">

    <a href="/tags/" rel="section"><i class="fa fa-tags fa-fw"></i>标签</a>

  </li>
        <li class="menu-item menu-item-归档">

    <a href="/archives/" rel="section"><i class="fa fa-archive fa-fw"></i>归档</a>

  </li>
        <li class="menu-item menu-item-关于">

    <a href="/about/" rel="section"><i class="fa fa-user fa-fw"></i>关于</a>

  </li>
      <li class="menu-item menu-item-search">
        <a role="button" class="popup-trigger"><i class="fa fa-search fa-fw"></i>搜索
        </a>
      </li>
  </ul>
</nav>



  <div class="search-pop-overlay">
    <div class="popup search-popup">
        <div class="search-header">
  <span class="search-icon">
    <i class="fa fa-search"></i>
  </span>
  <div class="search-input-container">
    <input autocomplete="off" autocapitalize="off" maxlength="80"
           placeholder="搜索..." spellcheck="false"
           type="search" class="search-input">
  </div>
  <span class="popup-btn-close">
    <i class="fa fa-times-circle"></i>
  </span>
</div>
<div class="search-result-container no-result">
  <div class="search-result-icon">
    <i class="fa fa-spinner fa-pulse fa-5x"></i>
  </div>
</div>

    </div>
  </div>

</div>
        
  
  <div class="toggle sidebar-toggle">
    <span class="toggle-line"></span>
    <span class="toggle-line"></span>
    <span class="toggle-line"></span>
  </div>

  <aside class="sidebar">

    <div class="sidebar-inner sidebar-nav-active sidebar-toc-active">
      <ul class="sidebar-nav">
        <li class="sidebar-nav-toc">
          文章目录
        </li>
        <li class="sidebar-nav-overview">
          站点概览
        </li>
      </ul>
	   
		  
      <div class="sidebar-panel-container">
        <!--noindex-->
        <section class="post-toc-wrap sidebar-panel">
            <div class="post-toc animated"><ol class="nav"><li class="nav-item nav-level-2"><a class="nav-link" href="#JDBC"><span class="nav-number">1.</span> <span class="nav-text">JDBC</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#JDBC%E4%BD%BF%E7%94%A8%E6%AD%A5%E9%AA%A4"><span class="nav-number">2.</span> <span class="nav-text">JDBC使用步骤</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E6%B3%A8%E5%86%8C%E9%A9%B1%E5%8A%A8"><span class="nav-number">2.1.</span> <span class="nav-text">注册驱动</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E8%BF%9E%E6%8E%A5%E6%95%B0%E6%8D%AE%E5%BA%93"><span class="nav-number">2.2.</span> <span class="nav-text">连接数据库</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E6%93%8D%E4%BD%9C%E6%88%96%E8%AE%BF%E9%97%AE%E6%95%B0%E6%8D%AE%E5%BA%93"><span class="nav-number">2.3.</span> <span class="nav-text">操作或访问数据库</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#Statement"><span class="nav-number">2.3.1.</span> <span class="nav-text">Statement</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#PreparedStatement"><span class="nav-number">2.3.2.</span> <span class="nav-text">PreparedStatement</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E9%87%8A%E6%94%BE%E8%B5%84%E6%BA%90"><span class="nav-number">2.4.</span> <span class="nav-text">释放资源</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E6%95%B0%E6%8D%AE%E5%BA%93%E8%BF%9E%E6%8E%A5%E6%B1%A0"><span class="nav-number">3.</span> <span class="nav-text">数据库连接池</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%A4%9A%E7%A7%8D%E5%BC%80%E6%BA%90%E7%9A%84%E6%95%B0%E6%8D%AE%E5%BA%93%E8%BF%9E%E6%8E%A5%E6%B1%A0"><span class="nav-number">3.1.</span> <span class="nav-text">多种开源的数据库连接池</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#ThreadLocal"><span class="nav-number">3.2.</span> <span class="nav-text">ThreadLocal</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#ThreadLocal%E5%B0%81%E8%A3%85JDBCTools"><span class="nav-number">3.3.</span> <span class="nav-text">ThreadLocal封装JDBCTools</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#JDBCTools%E5%B0%81%E8%A3%85BasicDAOImpl"><span class="nav-number">3.4.</span> <span class="nav-text">JDBCTools封装BasicDAOImpl</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Apache%E2%80%94DBUtils"><span class="nav-number">4.</span> <span class="nav-text">Apache—DBUtils</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#DbUtils%E7%B1%BB"><span class="nav-number">4.1.</span> <span class="nav-text">DbUtils类</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#QueryRunner%E7%B1%BB"><span class="nav-number">4.2.</span> <span class="nav-text">QueryRunner类</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#ResultSetHandler%E6%8E%A5%E5%8F%A3"><span class="nav-number">4.3.</span> <span class="nav-text">ResultSetHandler接口</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E4%B9%A0%E9%A2%98%E4%BB%A3%E7%A0%81"><span class="nav-number">4.4.</span> <span class="nav-text">习题代码</span></a></li></ol></li></ol></div>
        </section>
        <!--/noindex-->

        <section class="site-overview-wrap sidebar-panel">
          <div class="site-author site-overview-item animated" itemprop="author" itemscope itemtype="http://schema.org/Person">
    <img class="site-author-image" itemprop="image" alt="SoundMemories"
      src="https://i.loli.net/2020/11/04/6JhNuwtBe4adylS.png">
  <p class="site-author-name" itemprop="name">SoundMemories</p>
  <div class="site-description" itemprop="description">今日事，今日毕</div>
</div>
<div class="site-state-wrap site-overview-item animated">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
          <a href="/archives">
          <span class="site-state-item-count">117</span>
          <span class="site-state-item-name">日志</span>
        </a>
      </div>
      <div class="site-state-item site-state-categories">
            <a href="/categories/">
        <span class="site-state-item-count">8</span>
        <span class="site-state-item-name">分类</span></a>
      </div>
      <div class="site-state-item site-state-tags">
            <a href="/tags/">
        <span class="site-state-item-count">8</span>
        <span class="site-state-item-name">标签</span></a>
      </div>
  </nav>
</div>
  <div class="links-of-author site-overview-item animated">
      <span class="links-of-author-item">
        <span class="exturl" data-url="aHR0cHM6Ly9naXRodWIuY29tL3NvdW5kbWVtb3JpZXM=" title="GitHub → https:&#x2F;&#x2F;github.com&#x2F;soundmemories"><i class="fab fa-github fa-fw"></i>GitHub</span>
      </span>
      <span class="links-of-author-item">
        <span class="exturl" data-url="bWFpbHRvOnNvdW5kbWVtb3JpZXNAMTYzLmNvbQ==" title="E-Mail → mailto:soundmemories@163.com"><i class="fa fa-envelope fa-fw"></i>E-Mail</span>
      </span>
  </div>
  <div class="cc-license site-overview-item animated" itemprop="license">
    <span class="exturl cc-opacity" data-url="aHR0cHM6Ly9jcmVhdGl2ZWNvbW1vbnMub3JnL2xpY2Vuc2VzL2J5LW5jLXNhLzQuMC8="><img src="/images/cc-by-nc-sa.svg" alt="Creative Commons"></span>
  </div>



        </section>
      </div>
    </div>
  </aside>
  <div class="sidebar-dimmer"></div>


    </header>

    
  <div class="back-to-top">
    <i class="fa fa-arrow-up"></i>
    <span>0%</span>
  </div>
  <a role="button" class="book-mark-link book-mark-link-fixed"></a>

<noscript>
  <div class="noscript-warning">Theme NexT works best with JavaScript enabled</div>
</noscript>


    <div class="main-inner post posts-expand">
      

      

  


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="https://soundmemories.github.io/2019/04/03/MySQL/04.Java%E5%92%8C%E6%95%B0%E6%8D%AE%E5%BA%93/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="https://i.loli.net/2020/11/04/6JhNuwtBe4adylS.png">
      <meta itemprop="name" content="SoundMemories">
      <meta itemprop="description" content="今日事，今日毕">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="SoundMemories">
    </span>
      <header class="post-header">
        <h1 class="post-title" itemprop="name headline">
          Java和数据库
        </h1>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>

      <time title="创建时间：2019-04-03 00:00:00" itemprop="dateCreated datePublished" datetime="2019-04-03T00:00:00+08:00">2019-04-03</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">分类于</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/MySQL/" itemprop="url" rel="index"><span itemprop="name">MySQL</span></a>
        </span>
    </span>

  
      </div>
      <div class="post-meta">
    <span class="post-meta-item" title="本文字数">
      <span class="post-meta-item-icon">
        <i class="far fa-file-word"></i>
      </span>
      <span class="post-meta-item-text">本文字数：</span>
      <span>46k</span>
    </span>
    <span class="post-meta-item" title="阅读时长">
      <span class="post-meta-item-icon">
        <i class="far fa-clock"></i>
      </span>
      <span class="post-meta-item-text">阅读时长 &asymp;</span>
      <span>42 分钟</span>
    </span>
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
        <h2 id="JDBC"><a href="#JDBC" class="headerlink" title="JDBC"></a>JDBC</h2><p>在Java中，数据库存取技术可分为如下几类：<br>（1）JDBC直接访问数据库。<br>（2）JDO（Java Data Object）技术。<br>（3）第三方O/R工具，如Hibernate, Mybatis 等。<br>JDBC是Java访问数据库的基石，JDO, Hibernate等只是更好的封装了JDBC。</p>
<p><strong>什么是JDBC？</strong><br>JDBC(Java Database Connectivity)是一个<strong>独立于特定数据库管理系统（DBMS）的API、通用的SQL数据库存取和操作的公共接口</strong>（一组API），定义了用来访问数据库的标准Java类库，使用这个类库可以以一种标准的方法、方便地访问数据库资源。<br>JDBC是SUN公司（Oracle公司甲骨文）提供一套用于数据库操作的接口API，Java程序员只需要面向这套接口编程即可。<br>不同的数据库厂商，需要针对这套接口，提供不同实现。不同的实现的集合，即为不同数据库的驱动。</p>
<p>JDBC为访问不同的数据库提供了一种<strong>统一的途径</strong>，为开发者屏蔽了一些细节问题。<br>JDBC的目标是使Java程序员使用JDBC可以连接任何<strong>提供了JDBC驱动程序</strong>的数据库系统，这样就使得程序员无需对特定的数据库系统的特点有过多的了解，从而大大简化和加快了开发过程。</p>
<p>如果没有JDBC，那么Java程序访问数据库时是这样的：<br><img src="https://i.loli.net/2021/04/29/5DxUkgzr2wS3GjL.png" alt=""></p>
<p>有JDBC，那么Java程序访问数据库时是这样的：<br><img src="https://i.loli.net/2021/04/29/CrEJ4RQeuogaVFW.png" alt=""></p>
<p><strong>JDBC API</strong><br>JDBC API是一系列的接口，它统一和规范了应用程序与数据库的连接、执行SQL语句，并到得到返回结果等各类操作。声明在java.sql与javax.sql包中。<br><img src="https://i.loli.net/2021/04/29/LIR6zDhk5s7YiKA.jpg" alt=""><br><a id="more"></a></p>
<p><img src="https://i.loli.net/2021/04/29/JIxDS8rf49snHTV.jpg" alt=""></p>
<h2 id="JDBC使用步骤"><a href="#JDBC使用步骤" class="headerlink" title="JDBC使用步骤"></a>JDBC使用步骤</h2><p>Java程序员编写Java代码时，只要面向接口编程就可以了，运行时把驱动实现类加到项目中即可。<br>Java程序员只要学习SUN公司提供的JDBC的公共接口就可以了。</p>
<p>DriverManager：驱动管理类。<br>常用的接口：<br>（1）Connection：连接。<br>（2）Statement和PreparedStatement：增删改查。<br>（3）ResultSet：接收和处理查询结果。</p>
<p>使用步骤：<br>（1）注册驱动<br>（2）连接数据库<br>（3）操作数据库<br>（4）断开连接，关闭对应各种资源</p>
<h3 id="注册驱动"><a href="#注册驱动" class="headerlink" title="注册驱动"></a>注册驱动</h3><p>如果这步不做，编译不会报错，运行会报找不到驱动类等异常。<br>（1）引入JDBC驱动程序：将DBMS数据库管理软件的驱动jar拷贝到项目的lib/libs目录中。<br>（2）把驱动jar添加到项目的build path中。<br>驱动程序由数据库提供商提供下载。 MySQL的驱动<span class="exturl" data-url="aHR0cDovL2Rldi5teXNxbC5jb20vZG93bmxvYWRzLw==">下载地址<i class="fa fa-external-link-alt"></i></span>。<br>如何在Java Project项目应用中添加数据库驱动jar：添加到项目类(lib)路径下，并且在驱动jar上右键—&gt;Build Path—&gt;Add to Build Path。<br><img src="https://i.loli.net/2021/04/29/RmtBDurWVUozPdS.png" alt=""><br>注意：如果是Dynamic Web Project（动态的web项目）话，则是把驱动jar放到WebContent（有的开发工具叫WebRoot）目录中的WEB-INF目录中的lib目录下即可。<br><img src="https://i.loli.net/2021/04/29/NcV5Q9KA8CzBXvS.png" alt=""><br>（3）将驱动类加载到内存中：在代码中注册驱动，把驱动类的对象交给DriverManager管理，用于后面创建连接等使用。<br>因为 Driver 接口的驱动程序类都包含了静态代码块，在这个静态代码块中，会调用 DriverManager.registerDriver() 方法来注册自身的一个实例，所以可以换一种方式来加载驱动。即只要想办法让驱动类的这段静态代码块执行即可注册驱动类，而要让这段静态代码块执行，只要让该类被类加载器加载即可。<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Driver</span> <span class="keyword">extends</span> <span class="title">NonRegisteringDriver</span> <span class="keyword">implements</span> <span class="title">java</span>.<span class="title">sql</span>.<span class="title">Driver</span></span>&#123;</span><br><span class="line">    <span class="comment">//Register ourselves with the DriverManager</span></span><br><span class="line">    <span class="keyword">static</span> &#123;</span><br><span class="line">        <span class="keyword">try</span>&#123;</span><br><span class="line">            java.sql.DriverManager.registerDriver(<span class="keyword">new</span> Driver());</span><br><span class="line">        &#125;<span class="keyword">catch</span>(SQLException E)&#123;</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> RuntimeException(<span class="string">&quot;Can&#x27;t register driver!&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><br>调用Class静态方法 <code>Class.forName()</code>，向其传递要加载的 JDBC 驱动的类名：<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//通过反射，加载与注册驱动类，解耦合（不直接依赖）</span></span><br><span class="line">Class.forName(<span class="string">&quot;com.mysql.jdbc.Driver&quot;</span>);</span><br></pre></td></tr></table></figure><br>服务提供者框架自动注册，有版本要求：<br>符合JDBC 4.0规范的驱动程序包含了一个文件META-INF/services/java.sql.Driver，这个文件中提供了JDBC驱动实现的类名。<br>JVM的服务提供者框架在启动应用时就会注册服务，例如，MySQL的JDBC驱动就会被注册，而原代码中的<code>Class.forName(&quot;com.mysql.jdbc.Driver&quot;)</code>仍然可以存在，但是不会起作用。<br>例如：mysql-connector-java-5.1.40-bin.jar文件中可以找到java.sql.Driver文件，用文本编辑器打开文件就可以看到com.mysql.jdbc.Driver类。<br><img src="https://i.loli.net/2021/04/29/gJdOLFG6K5zMovH.png" alt=""><br>但mysql-connector-java-5.0.8-bin.jar版本的jar中没有这个文件，如下：<br><img src="https://i.loli.net/2021/04/29/fBctnrApV5NdS8J.png" alt=""><br>所以这个版本使用<code>Class.forName(&quot;org.gjt.mm.Driver&quot;)</code>进行代码注册。</p>
<h3 id="连接数据库"><a href="#连接数据库" class="headerlink" title="连接数据库"></a>连接数据库</h3><p>DriverManager试图从<strong>已注册</strong>的 JDBC 驱动程序集中选择一个<strong>适当的</strong>驱动程序。<br>通过DriverManager类建立到数据库的连接：<br>（1）public static Connection getConnection(String url)<br>（2）<strong>public static Connection getConnection(String url,String user, String password)</strong><br>（3）public static Connection getConnection(String url,Properties info)其中Properties info通常至少包括 “user” 和 “password” 属性</p>
<p>URL解决问题：哪台电脑？哪种DBMS数据库软件？访问哪个数据库？这个DBMS软件目前运行在哪个端口号？连接这个DBMS软件是否还需要其他的参数？<br>JDBC URL 用于标识一个被注册的驱动程序，驱动程序管理器通过这个 URL 选择正确的驱动程序，从而建立到数据库的连接。<br>JDBC URL的标准由三部分组成，各部分间用冒号分隔：<br>（1）协议：JDBC URL中的协议总是jdbc。<br>（2）子协议：子协议用于标识一个数据库驱动程序。<br>（3）子名称：一种标识数据库的方法。子名称可以依不同的子协议而变化，用子名称的目的是为了定位数据库提供足够的信息。<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">jdbc:mysql:&#x2F;&#x2F;localhost:3306&#x2F;test</span><br><span class="line"># 协议：jdbc</span><br><span class="line"># 子协议：mysql</span><br><span class="line"># 子名称：&#x2F;&#x2F;localhost:3306&#x2F;test</span><br></pre></td></tr></table></figure><br>MySQL的连接URL编写方式：<code>jdbc:mysql://主机名称:mysql服务端口号/数据库名称?参数=值&amp;参数=值</code><br>Oracle9i的连接URL编写方式：<code>jdbc:oracle:thin:@主机名称:oracle服务端口号:数据库名称</code><br>SQLServer的连接URL编写方式：<code>jdbc:sqlserver://主机名称:sqlserver服务端口号:DatabaseName=数据库名称</code><br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"># MySQL的连接URL编写方式</span><br><span class="line"># 如果JDBC程序与服务器端的字符集不一致，会导致乱码，那么可以通过参数指定服务器端的字符集</span><br><span class="line">jdbc:mysql:&#x2F;&#x2F;localhost:3306&#x2F;testdb</span><br><span class="line">jdbc:mysql:&#x2F;&#x2F;localhost:3306&#x2F;testdb?useUnicode&#x3D;true&amp;characterEncoding&#x3D;utf8</span><br><span class="line">jdbc:mysql:&#x2F;&#x2F;localhost:3306&#x2F;testdb?user&#x3D;root&amp;password&#x3D;123456</span><br><span class="line"></span><br><span class="line"># Oracle9i的连接URL编写方式</span><br><span class="line">jdbc:oracle:thin:@localhost:1521:testdb</span><br><span class="line"></span><br><span class="line"># SQLServer的连接URL编写方式</span><br><span class="line">jdbc:sqlserver:&#x2F;&#x2F;localhost:1433:DatabaseName&#x3D;testdb</span><br></pre></td></tr></table></figure><br>到目前为止的代码：<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> java.sql.Connection;</span><br><span class="line"><span class="keyword">import</span> java.sql.DriverManager;</span><br><span class="line"><span class="comment">//1、加载与注册驱动</span></span><br><span class="line">Class.forName(<span class="string">&quot;com.mysql.jdbc.Driver&quot;</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">//2、获取数据库连接</span></span><br><span class="line">String url = <span class="string">&quot;jdbc:mysql://localhost:3306/test&quot;</span>;</span><br><span class="line">Connection conn = DriverManager.getConnection(url, <span class="string">&quot;root&quot;</span>, <span class="string">&quot;root&quot;</span>);</span><br></pre></td></tr></table></figure></p>
<h3 id="操作或访问数据库"><a href="#操作或访问数据库" class="headerlink" title="操作或访问数据库"></a>操作或访问数据库</h3><p>数据库连接被用于向数据库服务器发送命令和 SQL 语句，并接受数据库服务器返回的结果。<br>Connection好比网络编程中的Socket。Statement等好比和服务器进行数据读写的InputStream和OutputStream。<br>在 java.sql 包中有 3 个接口分别定义了对数据库的调用的不同方式：<br>（1）Statement：用于执行静态 SQL 语句并返回它所生成结果的对象。<br>（2）PrepatedStatement：SQL 语句被预编译并存储在此对象中，然后可以使用此对象多次高效地执行该语句。<br>（3）CallableStatement：用于执行 SQL 存储过程。</p>
<h4 id="Statement"><a href="#Statement" class="headerlink" title="Statement"></a>Statement</h4><p>通过调用 Connection 对象的 <code>createStatement()</code> 方法创建该对象，该对象用于执行静态的 SQL 语句，并且返回执行结果。<br>Statement 接口中定义了下列方法用于执行 SQL 语句：<br>（1）<code>int excuteUpdate(String sql)</code>：执行更新操作INSERT、UPDATE、DELETE，返回影响的行数。<br>（2）<code>ResultSet excuteQuery(String sql)</code>：执行查询操作SELECT，返回结果集。</p>
<p>ResultSet 对象以逻辑表格的形式封装了执行数据库操作的结果集，ResultSet 接口由数据库厂商实现。<br>ResultSet 接口的常用方法：<br>（1）<code>boolean next()</code>：移动到下一行。ResultSet 对象维护了一个指向当前数据行的游标，初始的时候，游标在第一行之前，可以通过 ResultSet 对象的 next() 方法移动到下一行。<br>（2）<code>getXxx(String columnLabel)</code>：查询结果的指定列。若使用AS则用别名，否则用原本列名称。<br>（3）<code>getXxx(int index)</code>：查询结果的指定列。索引从1开始，对应的数据类型如下表所示。<br><img src="https://i.loli.net/2021/04/29/u2sCpFZilGgdtm5.png" alt=""><br>如果不清楚类型，可以写<code>getObject()</code>。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.memories.statement;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.sql.Connection;</span><br><span class="line"><span class="keyword">import</span> java.sql.DriverManager;</span><br><span class="line"><span class="keyword">import</span> java.sql.ResultSet;</span><br><span class="line"><span class="keyword">import</span> java.sql.Statement;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.junit.Test;</span><br><span class="line"></span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment"> * 网络编程：tcp</span></span><br><span class="line"><span class="comment"> * </span></span><br><span class="line"><span class="comment"> * 服务器端：</span></span><br><span class="line"><span class="comment"> * 1、ServerSocket server = new ServerSocket(3306);</span></span><br><span class="line"><span class="comment"> * 2、Socket socket = server.accept();</span></span><br><span class="line"><span class="comment"> * 3、InputStream input = socket.getInputStream();//接收sql，客户端传过来的</span></span><br><span class="line"><span class="comment"> * 4、在服务器执行sql</span></span><br><span class="line"><span class="comment"> * 5、把结果给客户端</span></span><br><span class="line"><span class="comment"> * </span></span><br><span class="line"><span class="comment"> * 客户端：</span></span><br><span class="line"><span class="comment"> * 1、Socket socket = new Socket(服务器的IP地址，3306);</span></span><br><span class="line"><span class="comment"> * 2、传sql</span></span><br><span class="line"><span class="comment"> * 3、OutputStream out = socket.getOutputStream();</span></span><br><span class="line"><span class="comment"> * 4、out.write(sql);</span></span><br><span class="line"><span class="comment"> * 5、接收结果</span></span><br><span class="line"><span class="comment"> * 6、断开连接  out.close();socket.close();</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">TestStatement</span> </span>&#123;</span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">testAdd</span><span class="params">()</span><span class="keyword">throws</span> Exception</span>&#123;    </span><br><span class="line">        Class.forName(<span class="string">&quot;com.mysql.jdbc.Driver&quot;</span>);</span><br><span class="line">        </span><br><span class="line">        String url = <span class="string">&quot;jdbc:mysql://localhost:3306/test&quot;</span>;</span><br><span class="line">        String user = <span class="string">&quot;root&quot;</span>;</span><br><span class="line">        String password = <span class="string">&quot;123456&quot;</span>;</span><br><span class="line">        Connection conn = DriverManager.getConnection(url, user, password);</span><br><span class="line">        </span><br><span class="line">        Statement st = conn.createStatement();</span><br><span class="line">        </span><br><span class="line">        String sql = <span class="string">&quot;INSERT INTO t_department(dname,description) VALUES(&#x27;财务部&#x27;,&#x27;负责发钱工作&#x27;)&quot;</span>;</span><br><span class="line">        <span class="keyword">int</span> len = st.executeUpdate(sql);<span class="comment">//把insert,update,delete都用这个方法</span></span><br><span class="line">        </span><br><span class="line">        <span class="keyword">if</span>(len&gt;<span class="number">0</span>)&#123;</span><br><span class="line">            System.out.println(<span class="string">&quot;添加成功&quot;</span>);</span><br><span class="line">        &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">            System.out.println(<span class="string">&quot;添加失败&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        </span><br><span class="line">        st.close();</span><br><span class="line">        conn.close();</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">testUpdate</span><span class="params">()</span><span class="keyword">throws</span> Exception</span>&#123;</span><br><span class="line">        Class.forName(<span class="string">&quot;com.mysql.jdbc.Driver&quot;</span>);</span><br><span class="line">        </span><br><span class="line">        String url = <span class="string">&quot;jdbc:mysql://localhost:3306/test&quot;</span>;</span><br><span class="line">        String user = <span class="string">&quot;root&quot;</span>;</span><br><span class="line">        String password = <span class="string">&quot;123456&quot;</span>;</span><br><span class="line">        Connection conn = DriverManager.getConnection(url, user, password);</span><br><span class="line">        </span><br><span class="line">        Statement st = conn.createStatement();</span><br><span class="line">        </span><br><span class="line">        String sql = <span class="string">&quot;UPDATE t_department SET description = &#x27;负责发工资、社保、公积金工作&#x27; WHERE dname =&#x27;财务部&#x27;&quot;</span>;</span><br><span class="line">        <span class="keyword">int</span> len = st.executeUpdate(sql);<span class="comment">//把insert,update,delete都用这个方法</span></span><br><span class="line">        </span><br><span class="line">        <span class="keyword">if</span>(len&gt;<span class="number">0</span>)&#123;</span><br><span class="line">            System.out.println(<span class="string">&quot;修改成功&quot;</span>);</span><br><span class="line">        &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">            System.out.println(<span class="string">&quot;修改失败&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        </span><br><span class="line">        st.close();</span><br><span class="line">        conn.close();</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">testDelete</span><span class="params">()</span><span class="keyword">throws</span> Exception</span>&#123;</span><br><span class="line">        Class.forName(<span class="string">&quot;com.mysql.jdbc.Driver&quot;</span>);</span><br><span class="line">        </span><br><span class="line">        String url = <span class="string">&quot;jdbc:mysql://localhost:3306/test&quot;</span>;</span><br><span class="line">        String user = <span class="string">&quot;root&quot;</span>;</span><br><span class="line">        String password = <span class="string">&quot;123456&quot;</span>;</span><br><span class="line">        Connection conn = DriverManager.getConnection(url, user, password);</span><br><span class="line">        </span><br><span class="line">        Statement st = conn.createStatement();</span><br><span class="line"></span><br><span class="line">        String sql = <span class="string">&quot;DELETE FROM t_department WHERE did =6&quot;</span>;</span><br><span class="line">        <span class="keyword">int</span> len = st.executeUpdate(sql);<span class="comment">//把insert,update,delete都用这个方法</span></span><br><span class="line">        </span><br><span class="line">        <span class="keyword">if</span>(len&gt;<span class="number">0</span>)&#123;</span><br><span class="line">            System.out.println(<span class="string">&quot;删除成功&quot;</span>);</span><br><span class="line">        &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">            System.out.println(<span class="string">&quot;删除失败&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        </span><br><span class="line">        st.close();</span><br><span class="line">        conn.close();</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">testSelect</span><span class="params">()</span><span class="keyword">throws</span> Exception</span>&#123;</span><br><span class="line">        Class.forName(<span class="string">&quot;com.mysql.jdbc.Driver&quot;</span>);</span><br><span class="line">        </span><br><span class="line">        String url = <span class="string">&quot;jdbc:mysql://localhost:3306/test&quot;</span>;</span><br><span class="line">        String user = <span class="string">&quot;root&quot;</span>;</span><br><span class="line">        String password = <span class="string">&quot;123456&quot;</span>;</span><br><span class="line">        Connection conn = DriverManager.getConnection(url, user, password);</span><br><span class="line">        </span><br><span class="line">        Statement st = conn.createStatement();</span><br><span class="line">        </span><br><span class="line">        String sql = <span class="string">&quot;SELECT * FROM t_department&quot;</span>;</span><br><span class="line">        ResultSet rs = st.executeQuery(sql);<span class="comment">//select语句用query方法</span></span><br><span class="line">        <span class="keyword">while</span>(rs.next())&#123;<span class="comment">//是否有下一行</span></span><br><span class="line">            <span class="comment">//取这一行的单元格</span></span><br><span class="line">            <span class="keyword">int</span> id = rs.getInt(<span class="number">1</span>);</span><br><span class="line">            String name = rs.getString(<span class="number">2</span>);</span><br><span class="line">            String desc = rs.getString(<span class="number">3</span>);</span><br><span class="line">            </span><br><span class="line">            System.out.println(id+<span class="string">&quot;\t&quot;</span> + name + <span class="string">&quot;\t&quot;</span> + desc);</span><br><span class="line">        &#125;</span><br><span class="line">        </span><br><span class="line">        rs.close();</span><br><span class="line">        st.close();</span><br><span class="line">        conn.close();</span><br><span class="line">        </span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">testSelect2</span><span class="params">()</span><span class="keyword">throws</span> Exception</span>&#123;</span><br><span class="line">        Class.forName(<span class="string">&quot;com.mysql.jdbc.Driver&quot;</span>);</span><br><span class="line">        </span><br><span class="line">        String url = <span class="string">&quot;jdbc:mysql://localhost:3306/test&quot;</span>;</span><br><span class="line">        String user = <span class="string">&quot;root&quot;</span>;</span><br><span class="line">        String password = <span class="string">&quot;123456&quot;</span>;</span><br><span class="line">        Connection conn = DriverManager.getConnection(url, user, password);</span><br><span class="line">        </span><br><span class="line">        Statement st = conn.createStatement();</span><br><span class="line"></span><br><span class="line">        String sql = <span class="string">&quot;SELECT did,dname FROM t_department&quot;</span>;</span><br><span class="line">        ResultSet rs = st.executeQuery(sql);<span class="comment">//select语句用query方法</span></span><br><span class="line">        <span class="keyword">while</span>(rs.next())&#123;<span class="comment">//是否有下一行</span></span><br><span class="line">            <span class="comment">//取这一行的单元格</span></span><br><span class="line">            <span class="keyword">int</span> id = rs.getInt(<span class="string">&quot;did&quot;</span>);</span><br><span class="line">            String name = rs.getString(<span class="string">&quot;dname&quot;</span>);</span><br><span class="line">            System.out.println(id+<span class="string">&quot;\t&quot;</span> + name);</span><br><span class="line">        &#125;</span><br><span class="line">        </span><br><span class="line">        rs.close();</span><br><span class="line">        st.close();</span><br><span class="line">        conn.close();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h4 id="PreparedStatement"><a href="#PreparedStatement" class="headerlink" title="PreparedStatement"></a>PreparedStatement</h4><p><strong>1、Statement的问题和解决</strong><br>（1）SQL添加变量时，使用单引号和双引号，变量过多就会很乱，容易出错。<br>（2）SQL 注入攻击，是利用某些系统没有对用户输入的数据进行充分的检查，而在用户输入数据中注入非法的 SQL 语句段或命令，从而利用系统的 SQL 引擎完成恶意行为的做法。对于 Java 而言，要防范 SQL 注入，只要用 PreparedStatement 取代 Statement 就可以了。对于Python使用带%号的参数化输入即可。</p>
<p>（3）处理Blob类型的数据<br>BLOB (binary large object)，二进制大对象，BLOB常常是数据库中用来存储二进制文件的字段类型，比如图片文件。<br>插入BLOB类型的数据必须使用PreparedStatement，BLOB类型的数据无法使用字符串拼接写的，因为拼接的结果都是字符串类型。<br>MySQL的四种BLOB类型(除了在存储的最大信息量上不同外，他们是等同的)：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">TinyBlob    最大255字节</span><br><span class="line">Blob        最大65k字节</span><br><span class="line">MediumBlob  最大16M字节</span><br><span class="line">LongBlob    最大4G字节</span><br></pre></td></tr></table></figure><br>如果报错<code>xxx too large</code>，那么在mysql的安装目录下，找my.ini文件加上如下的配置参数：<code>max_allowed_packet=16M</code>，修改了my.ini文件，一定要重新启动服务。<br>实际使用中根据需要存入的数据大小定义不同的BLOB类型。需要注意的是：如果存储的文件过大，数据库的性能会下降。</p>
<p>这三种问题的演示：<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.memories.statement;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.sql.Connection;</span><br><span class="line"><span class="keyword">import</span> java.sql.DriverManager;</span><br><span class="line"><span class="keyword">import</span> java.sql.ResultSet;</span><br><span class="line"><span class="keyword">import</span> java.sql.Statement;</span><br><span class="line"><span class="keyword">import</span> java.util.Scanner;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.junit.Test;</span><br><span class="line"></span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment"> * Statement：</span></span><br><span class="line"><span class="comment"> * 1、SQL拼接问题</span></span><br><span class="line"><span class="comment"> * 2、SQL注入问题</span></span><br><span class="line"><span class="comment"> * 3、处理不了Blob类型的数据</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">TestStatementProblem</span> </span>&#123;</span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">add</span><span class="params">()</span> <span class="keyword">throws</span> Exception</span>&#123;</span><br><span class="line">        Scanner input = <span class="keyword">new</span> Scanner(System.in);</span><br><span class="line">        System.out.println(<span class="string">&quot;请输入姓名：&quot;</span>);</span><br><span class="line">        String name = input.nextLine();</span><br><span class="line">        </span><br><span class="line">        System.out.println(<span class="string">&quot;请输入领导编号：&quot;</span>);</span><br><span class="line">        <span class="keyword">int</span> mid = input.nextInt();</span><br><span class="line">        </span><br><span class="line">        System.out.println(<span class="string">&quot;请输入部门编号：&quot;</span>);</span><br><span class="line">        <span class="keyword">int</span> did = input.nextInt();</span><br><span class="line">        </span><br><span class="line">        <span class="comment">//1、连接数据库</span></span><br><span class="line">        Class.forName(<span class="string">&quot;com.mysql.jdbc.Driver&quot;</span>);</span><br><span class="line">        </span><br><span class="line">        String url = <span class="string">&quot;jdbc:mysql://localhost:3306/1221db&quot;</span>;</span><br><span class="line">        String user = <span class="string">&quot;root&quot;</span>;</span><br><span class="line">        String password = <span class="string">&quot;123456&quot;</span>;</span><br><span class="line">        Connection conn = DriverManager.getConnection(url, user, password);</span><br><span class="line">        </span><br><span class="line">        <span class="comment">//2、创建Statement对象</span></span><br><span class="line">        Statement st = conn.createStatement();</span><br><span class="line">        </span><br><span class="line">        <span class="comment">//3、编写sql</span></span><br><span class="line">        <span class="comment">//SQL拼接问题：变量过多时，单引号和双引号过多会很乱</span></span><br><span class="line">        String sql = <span class="string">&quot;INSERT INTO emp (ename,`mid`,did) VALUES(&#x27;&quot;</span> + name +<span class="string">&quot;&#x27;,&quot;</span>+ mid +<span class="string">&quot;,&quot;</span>+ did +<span class="string">&quot;)&quot;</span>;</span><br><span class="line">        </span><br><span class="line">        <span class="comment">//4、执行sql</span></span><br><span class="line">        <span class="keyword">int</span> update = st.executeUpdate(sql);</span><br><span class="line">        System.out.println(update&gt;<span class="number">0</span>?<span class="string">&quot;添加成功&quot;</span>:<span class="string">&quot;添加失败&quot;</span>);</span><br><span class="line">        </span><br><span class="line">        <span class="comment">//5、释放资源</span></span><br><span class="line">        st.close();</span><br><span class="line">        conn.close();</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">select</span><span class="params">()</span><span class="keyword">throws</span> Exception</span>&#123;</span><br><span class="line">        Scanner input = <span class="keyword">new</span> Scanner(System.in);</span><br><span class="line">        System.out.println(<span class="string">&quot;请输入姓名：&quot;</span>);</span><br><span class="line">        String name = input.nextLine();<span class="comment">//回车作为结束符</span></span><br><span class="line">        </span><br><span class="line">        <span class="comment">//1、连接数据库</span></span><br><span class="line">        Class.forName(<span class="string">&quot;com.mysql.jdbc.Driver&quot;</span>);</span><br><span class="line">        </span><br><span class="line">        String url = <span class="string">&quot;jdbc:mysql://localhost:3306/1221db&quot;</span>;</span><br><span class="line">        String user = <span class="string">&quot;root&quot;</span>;</span><br><span class="line">        String password = <span class="string">&quot;123456&quot;</span>;</span><br><span class="line">        Connection conn = DriverManager.getConnection(url, user, password);</span><br><span class="line"></span><br><span class="line">        <span class="comment">//2、创建Statement对象</span></span><br><span class="line">        Statement st = conn.createStatement();</span><br><span class="line"></span><br><span class="line">        <span class="comment">//3、写sql</span></span><br><span class="line">        <span class="comment">//输入的是：&#x27;孙红雷&#x27; or &#x27;1&#x27; = &#x27;1&#x27;</span></span><br><span class="line">        <span class="comment">//where条件总是True，就会查询到表的所有信息，这就是SQL注入问题</span></span><br><span class="line">        String sql = <span class="string">&quot;SELECT eid,ename,tel,gender,salary FROM t_employee WHERE ename = &#x27;&quot;</span> + name + <span class="string">&quot;&#x27;&quot;</span>;</span><br><span class="line">        System.out.println(sql);</span><br><span class="line">        <span class="comment">//SELECT eid,ename,tel,gender,salary FROM t_employee WHERE ename = &#x27;孙红雷&#x27; or &#x27;1&#x27; = &#x27;1&#x27;</span></span><br><span class="line">        </span><br><span class="line">        <span class="comment">//4、执行查询sql</span></span><br><span class="line">        ResultSet rs = st.executeQuery(sql);</span><br><span class="line">        <span class="keyword">while</span>(rs.next())&#123;</span><br><span class="line">            <span class="keyword">int</span> id = rs.getInt(<span class="number">1</span>);</span><br><span class="line">            String ename = rs.getString(<span class="number">2</span>);</span><br><span class="line">            String tel = rs.getString(<span class="number">3</span>);</span><br><span class="line">            String gender =rs.getString(<span class="number">4</span>);</span><br><span class="line">            <span class="keyword">double</span> salary = rs.getDouble(<span class="number">5</span>);</span><br><span class="line">            </span><br><span class="line">            System.out.println(id+<span class="string">&quot;\t&quot;</span> + ename + <span class="string">&quot;\t&quot;</span> + tel + <span class="string">&quot;\t&quot;</span> + gender + <span class="string">&quot;\t&quot;</span> +salary);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">//5、释放资源</span></span><br><span class="line">        st.close();</span><br><span class="line">        conn.close();</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">testAddBlob</span><span class="params">()</span></span>&#123;</span><br><span class="line">        String sql = <span class="string">&quot;INSERT INTO `user` (username,`password`,photo)VALUES(&#x27;chai&#x27;,&#x27;123&#x27;,没法在String中处理Blob类型的数据);&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><br>如何解决上面这些问题呢？使用Statement 的子接口PreparedStatement 接口，它表示一条预编译过的 SQL 语句。<br>（1）可通过调用 Connection 对象的 <code>preparedStatement(String sql)</code> 方法获取 PreparedStatement 对象，PreparedStatement 对象所代表的 SQL 语句中的参数用问好 ? 来表示，调用 PreparedStatement 对象的 <code>setXxx()</code> 方法来设置这些参数。<code>setXxx()</code>方法有两个参数，第一个参数是要设置的 SQL 语句中的参数的索引(从 1 开始)，第二个是设置的 SQL 语句中的参数的值。<br>（2）<code>ResultSet executeQuery()</code>：执行查询，并返回该查询生成的 ResultSet 对象。<br>（3）<code>int executeUpdate()</code>：执行更新，包括增、删、改。 </p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.memories.preparedstatement;</span><br><span class="line"><span class="comment">//...</span></span><br><span class="line"><span class="keyword">import</span> java.sql.PreparedStatement;</span><br><span class="line"><span class="keyword">import</span> java.io.FileInputStream;</span><br><span class="line"><span class="comment">//...</span></span><br><span class="line"><span class="comment">//使用preparedstatement解决Statement的问题</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">TestPreparedStatement</span> </span>&#123;</span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">add</span><span class="params">()</span> <span class="keyword">throws</span> Exception</span>&#123;</span><br><span class="line">        <span class="comment">//...</span></span><br><span class="line"></span><br><span class="line">        <span class="comment">//2、编写sql</span></span><br><span class="line">        <span class="comment">//String sql = &quot;INSERT INTO emp (ename,`mid`,did) VALUES(&#x27;&quot; + name +&quot;&#x27;,&quot;+ mid +&quot;,&quot;+ did +&quot;)&quot;;</span></span><br><span class="line">        String sql = <span class="string">&quot;INSERT INTO emp (ename,`mid`,did) VALUES(?,?,?)&quot;</span>;</span><br><span class="line"></span><br><span class="line">        <span class="comment">//3、创建Statement对象</span></span><br><span class="line">        <span class="comment">//Statement st = conn.createStatement();</span></span><br><span class="line">        PreparedStatement st = conn.prepareStatement(sql);</span><br><span class="line">        </span><br><span class="line">        <span class="comment">//插入一步，设置?的值</span></span><br><span class="line">        st.setString(<span class="number">1</span>, name);</span><br><span class="line">        st.setInt(<span class="number">2</span>, mid);</span><br><span class="line">        st.setInt(<span class="number">3</span>, did);</span><br><span class="line"></span><br><span class="line">        <span class="comment">//4、执行sql</span></span><br><span class="line">        <span class="comment">//int update = st.executeUpdate(sql);</span></span><br><span class="line">        <span class="keyword">int</span> update = st.executeUpdate();</span><br><span class="line">        System.out.println(update&gt;<span class="number">0</span>?<span class="string">&quot;添加成功&quot;</span>:<span class="string">&quot;添加失败&quot;</span>);</span><br><span class="line">        <span class="comment">//...</span></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">select</span><span class="params">()</span><span class="keyword">throws</span> Exception</span>&#123;</span><br><span class="line">        <span class="comment">//3、写sql</span></span><br><span class="line">        <span class="comment">//String sql = &quot;SELECT eid,ename,tel,gender,salary FROM t_employee WHERE ename = &#x27;&quot; + name + &quot;&#x27;&quot;;</span></span><br><span class="line">        String sql = <span class="string">&quot;SELECT eid,ename,tel,gender,salary FROM t_employee WHERE ename = ?&quot;</span>;</span><br><span class="line"></span><br><span class="line">        <span class="comment">//2、创建Statement对象</span></span><br><span class="line">        <span class="comment">//Statement st = conn.createStatement();</span></span><br><span class="line">        PreparedStatement st = conn.prepareStatement(sql);</span><br><span class="line"></span><br><span class="line">        <span class="comment">//插入一步，设置?的值</span></span><br><span class="line">        <span class="comment">//会把&#x27;孙红雷&#x27; or &#x27;1&#x27; = &#x27;1&#x27; 整体当作变量的值，从而避免sql注入问题</span></span><br><span class="line">        st.setString(<span class="number">1</span>, name);</span><br><span class="line">                </span><br><span class="line">        <span class="comment">//4、执行查询sql</span></span><br><span class="line">        <span class="comment">//ResultSet rs = st.executeQuery(sql);</span></span><br><span class="line">        ResultSet rs = st.executeQuery();</span><br><span class="line">        <span class="keyword">while</span>(rs.next())&#123;</span><br><span class="line">            <span class="keyword">int</span> id = rs.getInt(<span class="number">1</span>);</span><br><span class="line">            String ename = rs.getString(<span class="number">2</span>);</span><br><span class="line">            String tel = rs.getString(<span class="number">3</span>);</span><br><span class="line">            String gender =rs.getString(<span class="number">4</span>);</span><br><span class="line">            <span class="keyword">double</span> salary = rs.getDouble(<span class="number">5</span>);</span><br><span class="line">            </span><br><span class="line">            System.out.println(id+<span class="string">&quot;\t&quot;</span> + ename + <span class="string">&quot;\t&quot;</span> + tel + <span class="string">&quot;\t&quot;</span> + gender + <span class="string">&quot;\t&quot;</span> +salary);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">//...</span></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">testAddBlob</span><span class="params">()</span></span>&#123;</span><br><span class="line">        <span class="comment">//String sql = &quot;INSERT INTO `user` (username,`password`,photo)VALUES(&#x27;chai&#x27;,&#x27;123&#x27;,没法在String中处理Blob类型的数据)&quot;;</span></span><br><span class="line">        <span class="comment">//?避免了拼接问题</span></span><br><span class="line">        String sql = <span class="string">&quot;INSERT INTO `user` (username,`password`,photo)VALUES(&#x27;chai&#x27;,&#x27;123&#x27;,?)&quot;</span>;</span><br><span class="line"></span><br><span class="line">        <span class="comment">//插入一步，设置?的值</span></span><br><span class="line">        <span class="comment">//too large可修改配置文件my.ini的max_allowed_packet=16M</span></span><br><span class="line">        <span class="comment">//st.setBlob(1, new FileInputStream(&quot;D:/img/测试.jpg&quot;));</span></span><br><span class="line">        st.setObject(<span class="number">1</span>, <span class="keyword">new</span> FileInputStream(<span class="string">&quot;D:/img/测试.jpg&quot;</span>));</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><strong>2、PreparedStatement vs Statement？</strong><br>（1）Statement的sql拼接是个难题。PreparedStatement可以拼接。<br>（2）PreparedStatement 可以防止 SQL 注入。<br>（3）PreparedStatement 可以处理Blob类型的数据。<br>（4）PreparedStatement 能最大可能提高性能：（Oracle和PostgreSQL8是这样，但是对于MySQL不一定比Statement高）。<br>（5）DBServer会对预编译语句提供性能优化。因为预编译语句有可能被重复调用，所以语句在被DBServer的编译器编译后的执行代码被缓存下来，那么下次调用时只要是相同的预编译语句就不需要编译，只要将参数直接传入编译过的语句执行代码中就会得到执行。</p>
<p><strong>3、JDBC取得数据库自动生成的主键</strong><br>在创建PreparedStatement对象时，就要指明需要返回自增长的键值，否则mysql服务器不会返回。<br>此时要通过<code>getGeneratedKeys()</code>来获取结果集。</p>
<p>在使用PreparedStatement添加数据时，获取自增长的键值：<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//1、在创建PreparedStatement对象时</span></span><br><span class="line"><span class="comment">//原来：</span></span><br><span class="line">PreparedStatement pst = conn.preparedStatement(sql);</span><br><span class="line"><span class="comment">//现在：</span></span><br><span class="line">PreparedStatement pst = conn.prepareStatement(sql,Statement.RETURN_GENERATED_KEYS);</span><br><span class="line"></span><br><span class="line"><span class="comment">//2、执行更新</span></span><br><span class="line"><span class="comment">//原来：</span></span><br><span class="line"><span class="keyword">int</span> len = pst.executeUpdate();    </span><br><span class="line"><span class="comment">//现在：</span></span><br><span class="line"><span class="keyword">int</span> len = pst.executeUpdate();    </span><br><span class="line">ResultSet rs = pst.getGeneratedKeys();</span><br><span class="line"><span class="keyword">if</span>(rs.next())&#123;</span><br><span class="line">     Object key = rs.getObject(第几列);<span class="comment">//获取自增长的键值</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.memories.preparedstatement;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.sql.Connection;</span><br><span class="line"><span class="keyword">import</span> java.sql.DriverManager;</span><br><span class="line"><span class="keyword">import</span> java.sql.PreparedStatement;</span><br><span class="line"><span class="keyword">import</span> java.sql.ResultSet;</span><br><span class="line"><span class="keyword">import</span> java.sql.Statement;</span><br><span class="line"><span class="keyword">import</span> java.util.Scanner;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">TestGenerateKey</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> Exception</span>&#123;</span><br><span class="line">        Scanner input = <span class="keyword">new</span> Scanner(System.in);</span><br><span class="line">        System.out.println(<span class="string">&quot;请输入姓名：&quot;</span>);</span><br><span class="line">        String name = input.nextLine();</span><br><span class="line">        </span><br><span class="line">        System.out.println(<span class="string">&quot;请输入手机号码：&quot;</span>);</span><br><span class="line">        String tel = input.nextLine();</span><br><span class="line">        </span><br><span class="line">        System.out.println(<span class="string">&quot;请输入性别：&quot;</span>);</span><br><span class="line">        String gender = input.nextLine();</span><br><span class="line">        </span><br><span class="line">        System.out.println(<span class="string">&quot;请输入薪资：&quot;</span>);</span><br><span class="line">        <span class="keyword">double</span> salary = input.nextDouble();</span><br><span class="line">        </span><br><span class="line">        System.out.println(<span class="string">&quot;请输入部门编号：&quot;</span>);</span><br><span class="line">        <span class="keyword">int</span> did = input.nextInt();</span><br><span class="line">        </span><br><span class="line">        <span class="comment">//1、连接数据库</span></span><br><span class="line">        Class.forName(<span class="string">&quot;com.mysql.jdbc.Driver&quot;</span>);</span><br><span class="line">        </span><br><span class="line">        String url = <span class="string">&quot;jdbc:mysql://localhost:3306/test&quot;</span>;</span><br><span class="line">        String user = <span class="string">&quot;root&quot;</span>;</span><br><span class="line">        String password = <span class="string">&quot;123456&quot;</span>;</span><br><span class="line">        Connection conn = DriverManager.getConnection(url, user, password);</span><br><span class="line"></span><br><span class="line">        <span class="comment">//2、编写带？的SQL</span></span><br><span class="line">        String sql = <span class="string">&quot;INSERT INTO t_employee (ename,tel,gender,salary,did) VALUES(?,?,?,?,?)&quot;</span>;</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// 3、准备一个PreparedStatement</span></span><br><span class="line">        <span class="comment">//prepareStatement(String sql, int autoGeneratedKeys)  autoGeneratedKeys返回自增长键值集</span></span><br><span class="line">        <span class="comment">//在Statement这个接口中，声明了常量：Statement.RETURN_GENERATED_KEYS 或 Statement.NO_GENERATED_KEYS</span></span><br><span class="line">        PreparedStatement pst = conn.prepareStatement(sql, Statement.RETURN_GENERATED_KEYS);</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// 4、把?用具体的值进行代替</span></span><br><span class="line">        pst.setString(<span class="number">1</span>, name);</span><br><span class="line">        pst.setString(<span class="number">2</span>, tel);</span><br><span class="line">        pst.setString(<span class="number">3</span>, gender);</span><br><span class="line">        pst.setDouble(<span class="number">4</span>, salary);</span><br><span class="line">        pst.setInt(<span class="number">5</span>, did);</span><br><span class="line">    </span><br><span class="line">        <span class="comment">// 5、执行sql</span></span><br><span class="line">        <span class="keyword">int</span> len = pst.executeUpdate();</span><br><span class="line">        System.out.println(len&gt;<span class="number">0</span>?<span class="string">&quot;添加成功&quot;</span>:<span class="string">&quot;添加失败&quot;</span>);</span><br><span class="line">        </span><br><span class="line">        <span class="comment">//返回自增长键值集</span></span><br><span class="line">        ResultSet rs = pst.getGeneratedKeys();</span><br><span class="line">        <span class="keyword">if</span>(rs.next())&#123;</span><br><span class="line">            System.out.println(<span class="string">&quot;新员工编号是：&quot;</span> + rs.getObject(<span class="number">1</span>));</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 6、释放资源</span></span><br><span class="line">        pst.close();</span><br><span class="line">        conn.close();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><br><strong>4、批处理</strong><br>当需要成批插入或者更新记录时，可以采用Java的批量更新机制提高效率，这一机制允许多条语句一次性提交给数据库批量处理。<br>JDBC的批量处理语句包括下面两个方法：<br>（1）<code>addBatch()</code>：添加需要批量处理的SQL语句或参数。<br>（2）<code>executeBatch()</code>：执行批量处理语句。<br>通常我们会遇到两种批量执行SQL语句的情况：<br>（1）多条SQL语句的批量处理。<br>（2）一个SQL语句的批量传参。<br><div class="note info"><p>MySQL服务器默认是关闭批处理的，如果要使用批处理功能，要在url中加参数“?rewriteBatchedStatements=true”（单个参数情况）或“&amp;rewriteBatchedStatements=true”（多个参数情况）。<br>PreparedStatement作批处理“插入”时使用values（使用value没有效果），建议SQL都写values。</p>
</div></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.memories.preparedstatement;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.sql.Connection;</span><br><span class="line"><span class="keyword">import</span> java.sql.DriverManager;</span><br><span class="line"><span class="keyword">import</span> java.sql.PreparedStatement;</span><br><span class="line"><span class="keyword">import</span> org.junit.Test;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">TestBatch</span> </span>&#123;</span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">noBatch</span><span class="params">()</span><span class="keyword">throws</span> Exception</span>&#123;</span><br><span class="line">        Class.forName(<span class="string">&quot;com.mysql.jdbc.Driver&quot;</span>);</span><br><span class="line">        </span><br><span class="line">        String url = <span class="string">&quot;jdbc:mysql://localhost:3306/test&quot;</span>;</span><br><span class="line">        String user = <span class="string">&quot;root&quot;</span>;</span><br><span class="line">        String password = <span class="string">&quot;123456&quot;</span>;</span><br><span class="line">        Connection conn = DriverManager.getConnection(url, user, password);</span><br><span class="line">        </span><br><span class="line">        </span><br><span class="line">        String sql = <span class="string">&quot;INSERT INTO t_department(dname,description) VALUES(?,?)&quot;</span>;</span><br><span class="line">        PreparedStatement st = conn.prepareStatement(sql);</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">for</span>(<span class="keyword">int</span> i=<span class="number">0</span>; i&lt;<span class="number">1000</span>; i++)&#123;</span><br><span class="line">            st.setString(<span class="number">1</span>, <span class="string">&quot;测试部门&quot;</span> + i);</span><br><span class="line">            st.setString(<span class="number">2</span>, <span class="string">&quot;测试部门描述&quot;</span>  + i);</span><br><span class="line">            </span><br><span class="line">            st.executeUpdate();</span><br><span class="line">        &#125;</span><br><span class="line">        </span><br><span class="line">        st.close();</span><br><span class="line">        conn.close();</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">useBatch</span><span class="params">()</span><span class="keyword">throws</span> Exception</span>&#123;</span><br><span class="line">        Class.forName(<span class="string">&quot;com.mysql.jdbc.Driver&quot;</span>);</span><br><span class="line">        </span><br><span class="line">        <span class="comment">//url中添加参数?rewriteBatchedStatements=true</span></span><br><span class="line">        <span class="comment">//多个参数使用&amp;rewriteBatchedStatements=true</span></span><br><span class="line">        String url = <span class="string">&quot;jdbc:mysql://localhost:3306/test?rewriteBatchedStatements=true&quot;</span>;</span><br><span class="line">        String user = <span class="string">&quot;root&quot;</span>;</span><br><span class="line">        String password = <span class="string">&quot;123456&quot;</span>;</span><br><span class="line">        Connection conn = DriverManager.getConnection(url, user, password);</span><br><span class="line">        </span><br><span class="line">        </span><br><span class="line">        String sql = <span class="string">&quot;INSERT INTO t_department(dname,description) VALUES(?,?)&quot;</span>;</span><br><span class="line">        PreparedStatement st = conn.prepareStatement(sql);</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">for</span>(<span class="keyword">int</span> i=<span class="number">0</span>; i&lt;<span class="number">1000</span>; i++)&#123;</span><br><span class="line">            st.setString(<span class="number">1</span>, <span class="string">&quot;测试部门&quot;</span> + i);</span><br><span class="line">            st.setString(<span class="number">2</span>, <span class="string">&quot;测试部门描述&quot;</span>  + i);</span><br><span class="line">            </span><br><span class="line">            st.addBatch();<span class="comment">//添加到批处理组中，先攒着，本质上（底层）有一个缓冲区，先缓冲所有的要执行的sql</span></span><br><span class="line">        &#125;</span><br><span class="line">        </span><br><span class="line">        st.executeBatch();<span class="comment">//执行这组批处理的sql</span></span><br><span class="line">        </span><br><span class="line">        st.close();</span><br><span class="line">        conn.close();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><strong>5、事务</strong><br>JDBC程序中当一个连接对象被创建时，默认是自动提交事务：每次执行一个SQL语句成功时，就会向数据库自动提交一次，而不能回滚。<br>JDBC程序中为了让多个SQL语句作为一个事务执行，失败某一个SQL可回滚：<br>（1）调用 Connection 对象的<code>setAutoCommit(false)</code>以取消自动提交事务。<br>（2）在所有的 SQL 语句都成功执行后，调用<code>commit()</code>方法提交事务。<br>（3）在其中某个操作失败或出现异常时，调用<code>rollback()</code>方法回滚事务。<br>（4）若此时 Connection 没有被彻底关闭，还可能被重复使用, 则需要恢复其自动提交状态 <code>setAutoCommit(true)</code>。<br><div class="note info"><p>如果多个操作，每个操作使用的是自己单独的连接，则无法保证事务。即同一个事务的多个操作必须在同一个连接下。</p>
</div><br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.memories.transaction;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.sql.Connection;</span><br><span class="line"><span class="keyword">import</span> java.sql.DriverManager;</span><br><span class="line"><span class="keyword">import</span> java.sql.PreparedStatement;</span><br><span class="line"><span class="keyword">import</span> java.sql.SQLException;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">TestTransaction</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span></span>&#123;</span><br><span class="line">        Connection conn = <span class="keyword">null</span>;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="comment">//1、连接数据库</span></span><br><span class="line">            Class.forName(<span class="string">&quot;com.mysql.jdbc.Driver&quot;</span>);</span><br><span class="line"></span><br><span class="line">            String url = <span class="string">&quot;jdbc:mysql://localhost:3306/test&quot;</span>;</span><br><span class="line">            String user = <span class="string">&quot;root&quot;</span>;</span><br><span class="line">            String password = <span class="string">&quot;123456&quot;</span>;</span><br><span class="line">            conn = DriverManager.getConnection(url, user, password);</span><br><span class="line">            <span class="comment">//设置手动提交</span></span><br><span class="line">            conn.setAutoCommit(<span class="keyword">false</span>);</span><br><span class="line"></span><br><span class="line">            String sql1 = <span class="string">&quot;update t_department set description = ? where did = ?&quot;</span>;</span><br><span class="line">            PreparedStatement pst1 = conn.prepareStatement(sql1);</span><br><span class="line">            pst1.setObject(<span class="number">1</span>, <span class="string">&quot;事务测试&quot;</span>);</span><br><span class="line">            pst1.setObject(<span class="number">2</span>, <span class="number">4</span>);</span><br><span class="line">            <span class="keyword">int</span> len1 = pst1.executeUpdate();</span><br><span class="line">            System.out.println(len1&gt;<span class="number">0</span>?<span class="string">&quot;更新部门信息成功&quot;</span>:<span class="string">&quot;更新部门信息失败&quot;</span>);</span><br><span class="line">            pst1.close();</span><br><span class="line">            </span><br><span class="line">            String sql2 = <span class="string">&quot;update t_employee set salary = salary + ? where did = ?&quot;</span>;</span><br><span class="line">            PreparedStatement pst2 = conn.prepareStatement(sql2);</span><br><span class="line">            pst2.setObject(<span class="number">1</span>, <span class="number">20000</span>);</span><br><span class="line">            pst2.setObject(<span class="number">2</span>, <span class="string">&quot;数据类型错误&quot;</span>);<span class="comment">//插入错误数据</span></span><br><span class="line">            <span class="keyword">int</span> len2 = pst2.executeUpdate();</span><br><span class="line">            System.out.println(len2&gt;<span class="number">0</span>?<span class="string">&quot;更新部门信息成功&quot;</span>:<span class="string">&quot;更新部门信息失败&quot;</span>);</span><br><span class="line">            pst2.close();</span><br><span class="line">            </span><br><span class="line">            <span class="comment">//SQL都执行成功，commit()</span></span><br><span class="line">            conn.commit();</span><br><span class="line">        &#125;<span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">            <span class="keyword">try</span> &#123;</span><br><span class="line">                <span class="keyword">if</span>(conn!=<span class="keyword">null</span>)&#123;</span><br><span class="line">                    <span class="comment">//失败回滚</span></span><br><span class="line">                    conn.rollback();</span><br><span class="line">                &#125;</span><br><span class="line">            &#125; <span class="keyword">catch</span> (SQLException e1) &#123;</span><br><span class="line">                e1.printStackTrace();</span><br><span class="line">            &#125;</span><br><span class="line">        &#125; <span class="keyword">finally</span>&#123;</span><br><span class="line">            <span class="keyword">try</span> &#123;</span><br><span class="line">                <span class="keyword">if</span>(conn!=<span class="keyword">null</span>)&#123;</span><br><span class="line">                    <span class="comment">//恢复自动提交</span></span><br><span class="line">                    conn.setAutoCommit(<span class="keyword">true</span>);</span><br><span class="line">                    <span class="comment">//释放连接</span></span><br><span class="line">                    conn.close();</span><br><span class="line">                &#125;</span><br><span class="line">            &#125; <span class="keyword">catch</span> (SQLException e) &#123;</span><br><span class="line">                e.printStackTrace();</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<h3 id="释放资源"><a href="#释放资源" class="headerlink" title="释放资源"></a>释放资源</h3><p>Connection、Statement、ResultSet都是应用程序和数据库服务器的连接资源，使用后一定要<code>close()</code>关闭，可以在finally中关闭。<br>演示未关闭后果：<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.memories.conn;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.sql.Connection;</span><br><span class="line"><span class="keyword">import</span> java.sql.DriverManager;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">TestConnectionClose</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> Exception</span>&#123;</span><br><span class="line">        <span class="comment">//1、加载与注册驱动</span></span><br><span class="line">        Class.forName(<span class="string">&quot;com.mysql.jdbc.Driver&quot;</span>);</span><br><span class="line">        </span><br><span class="line">        <span class="comment">//2、获取数据库连接</span></span><br><span class="line">        String url = <span class="string">&quot;jdbc:mysql://localhost:3306/test&quot;</span>;</span><br><span class="line">        </span><br><span class="line">        <span class="comment">//my.ini中max_connections=10</span></span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; <span class="number">15</span>; i++) &#123;</span><br><span class="line">            Connection conn = DriverManager.getConnection(url,<span class="string">&quot;root&quot;</span>, <span class="string">&quot;123456&quot;</span>);</span><br><span class="line">            System.out.println(conn);</span><br><span class="line">            <span class="comment">//没有关闭，资源一直没有释放</span></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<h2 id="数据库连接池"><a href="#数据库连接池" class="headerlink" title="数据库连接池"></a>数据库连接池</h2><p><strong>1、不使用数据库连接池存在的问题:</strong><br>（1）普通的JDBC数据库连接使用 DriverManager 来获取，每次向数据库建立连接的时候都要将 Connection 加载到内存中，再验证IP地址，用户名和密码(得花费0.05s～1s的时间)。需要数据库连接的时候，就向数据库要求一个，执行完成后再断开连接。这样的方式将会消耗大量的资源和时间。<strong>数据库的连接资源并没有得到很好的重复利用</strong>，若同时有几百人甚至几千人在线，频繁的进行数据库连接操作将占用很多的系统资源，严重的甚至会造成服务器的崩溃。<br>（2）每一次数据库连接，使用完后都得断开。否则程序出现异常而<strong>未能关闭</strong>，将会导致<strong>数据库系统中的内存泄漏</strong>，最终将导致重启数据库。<br>（3）这种开发不能控制被创建的<strong>连接对象数</strong>，系统资源会被毫无顾及的分配出去，如连接<strong>过多</strong>，也可能导致<strong>内存泄漏，服务器崩溃</strong>。</p>
<p><strong>2、数据库连接池技术</strong><br>为解决传统开发中的数据库连接问题，可以采用<strong>数据库连接池技术</strong>（connection pool）。<br><strong>数据库连接池的基本思想</strong>：为数据库连接建立一个“缓冲池”。预先在缓冲池中放入一定数量的连接，当需要建立数据库连接时，只需从“缓冲池”中取出一个，使用完毕之后再放回去。数据库连接池负责分配、管理和释放数据库连接，它<strong>允许应用程序重复使用一个现有的数据库连接，而不是重新建立一个</strong>。连接池的<strong>最大数据库连接数量</strong>限定了这个连接池能占有的最大连接数，当应用程序向连接池请求的连接数超过最大连接数量时，这些请求将被加入到等待队列中。<br>连接池考虑的参数：<br>（1）初始化连接数：即一开始准备的连接数量，例如：10个<br>（2）最大连接数：即数据库服务器最多能承受多少个，例如：100个<br>（3）每次增量：如果10个不够了，会增加多少，直到达到100个<br>（4）等待时间：如果达到最大连接数怎么办？让用户无限制等待 或者 等待xx时间后，返回异常，告知客户端，连接超时。</p>
<p><strong>3、数据库连接池技术的优点：</strong><br>（1）资源重用：由于数据库连接得以重用，避免了频繁创建，释放连接引起的大量性能开销。在减少系统消耗的基础上，另一方面也增加了系统运行环境的平稳性。<br>（2）更快的系统反应速度：数据库连接池在初始化过程中，往往已经创建了若干数据库连接置于连接池中备用。此时连接的初始化工作均已完成。对于业务请求处理而言，直接利用现有可用连接，避免了数据库连接初始化和释放过程的时间开销，从而减少了系统的响应时间<br>（3）新的资源分配手段：对于多应用共享同一数据库的系统而言，可在应用层通过数据库连接池的配置，实现某一应用最大可用数据库连接数的限制，避免某一应用独占所有的数据库资源<br>（4）统一的连接管理，避免数据库连接泄露：在较为完善的数据库连接池实现中，可根据预先的占用超时设定，强制回收被占用连接，从而避免了常规数据库连接操作中可能出现的资源泄露</p>
<h3 id="多种开源的数据库连接池"><a href="#多种开源的数据库连接池" class="headerlink" title="多种开源的数据库连接池"></a>多种开源的数据库连接池</h3><p>JDBC 的数据库连接池使用 javax.sql.DataSource 来表示，DataSource 只是一个接口，该接口通常由服务器(Weblogic, WebSphere, Tomcat)提供实现，也有一些开源组织提供实现：<br>（1）DBCP 是Apache提供的数据库连接池，速度相对c3p0较快，但因自身存在BUG，Hibernate3已不再提供支持。<br>（2）C3P0 是一个开源组织提供的一个数据库连接池，速度相对较慢，稳定性还可以。<br>（3）Proxool 是sourceforge下的一个开源项目数据库连接池，有监控连接池状态的功能，稳定性较c3p0差一点。<br>（4）BoneCP 是一个开源组织提供的数据库连接池，速度快，但功能少。<br>（5）Druid 是阿里提供的数据库连接池，据说是集DBCP 、C3P0 、Proxool 优点于一身的数据库连接池，但是速度不知道是否有BoneCP快。<br>DataSource 通常被称为数据源，它包含连接池和连接池管理两个部分，习惯上也经常把 DataSource 称为连接池。<br><div class="note info"><p>数据源和数据库连接不同，数据源无需创建多个，它是产生数据库连接的工厂，因此整个应用只需要一个数据源即可。<br>当数据库访问结束后，程序还是像以前一样关闭数据库连接：conn.close(); 但conn.close()并没有关闭数据库的物理连接，它仅仅把数据库连接释放，归还给了数据库连接池。</p>
</div></p>
<p><strong>Druid（德鲁伊）数据源</strong><br>Druid是阿里巴巴开源平台上一个数据库连接池实现，它结合了C3P0、DBCP、Proxool等DB池的优点，同时加入了日志监控，可以很好的监控DB池连接和SQL的执行情况，可以说是针对监控而生的DB连接池，据说是目前最好的连接池。jar包的引入和Mysql一样。<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.memories.druid;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.sql.Connection;</span><br><span class="line"><span class="keyword">import</span> java.util.Properties;</span><br><span class="line"><span class="keyword">import</span> javax.sql.DataSource;</span><br><span class="line"><span class="keyword">import</span> org.junit.Test;</span><br><span class="line"><span class="keyword">import</span> com.alibaba.druid.pool.DruidDataSourceFactory;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">TestDruid</span> </span>&#123;</span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">test01</span><span class="params">()</span> <span class="keyword">throws</span> Exception</span>&#123;</span><br><span class="line">        <span class="comment">//第一种方式：手动创建数据库连接池对象，在代码中硬编码配置参数</span></span><br><span class="line">        Properties pro = <span class="keyword">new</span> Properties();</span><br><span class="line">        pro.setProperty(<span class="string">&quot;url&quot;</span>, <span class="string">&quot;jdbc:mysql://localhost:3306/test&quot;</span>);</span><br><span class="line">        pro.setProperty(<span class="string">&quot;username&quot;</span>, <span class="string">&quot;root&quot;</span>);</span><br><span class="line">        pro.setProperty(<span class="string">&quot;password&quot;</span>, <span class="string">&quot;1234&quot;</span>);</span><br><span class="line">        <span class="comment">//使用工厂类创建连接池，DataSource是面向对象的，便于移植</span></span><br><span class="line">        DataSource ds = DruidDataSourceFactory.createDataSource(pro);</span><br><span class="line">        System.out.println(ds.getClass());<span class="comment">//com.alibaba.druid.pool.DruidDataSource</span></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">test02</span><span class="params">()</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">        <span class="comment">//第二种方式：在配置文件中写配置参数，在代码中用配置文件创建连接池对象对象</span></span><br><span class="line">        Properties pro = <span class="keyword">new</span> Properties();<span class="comment">//特点：key和value都是String类型</span></span><br><span class="line">        <span class="comment">//类加载器对象.getResourceAsStream()：加载资源文件，并且把配置文件中的数据封装到Properties对象</span></span><br><span class="line">        <span class="comment">//这个资源文件格式：key=value</span></span><br><span class="line">        pro.load(TestDruid.class.getClassLoader().getResourceAsStream(<span class="string">&quot;druid.properties&quot;</span>));</span><br><span class="line">        DataSource ds = DruidDataSourceFactory.createDataSource(pro);<span class="comment">//创建数据库池</span></span><br><span class="line">        Connection conn = ds.getConnection(); <span class="comment">//从数据库池中拿连接</span></span><br><span class="line">        System.out.println(conn);</span><br><span class="line">        <span class="comment">//测试获取超过最大连接数的连接数量（连接关闭、未关闭的情况）</span></span><br><span class="line"></span><br><span class="line">        <span class="comment">//用完记得还回去</span></span><br><span class="line">        conn.close()</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">/*配置文件druid.properties的内容</span></span><br><span class="line"><span class="comment">url=jdbc:mysql://localhost:3306/test?rewriteBatchedStatements=true</span></span><br><span class="line"><span class="comment">username=root</span></span><br><span class="line"><span class="comment">password=123456</span></span><br><span class="line"><span class="comment">driverClassName=com.mysql.jdbc.Driver</span></span><br><span class="line"><span class="comment">initialSize=10</span></span><br><span class="line"><span class="comment">maxActive=20</span></span><br><span class="line"><span class="comment">maxWait=1000</span></span><br><span class="line"><span class="comment">*/</span></span><br></pre></td></tr></table></figure><br>| 配置参数名 | 缺省 | 描述 |<br>| :——-| :—— | :—— |<br>| name |  | 配置这个属性的意义在于，如果存在多个数据源，监控的时候可以通过名字来区分开来。 如果没有配置，将会生成一个名字，格式是：”DataSource-” + System.identityHashCode(this) |<br>| jdbcUrl |  | 连接数据库的url，不同数据库不一样。例如：mysql : jdbc:mysql://10.20.153.104:3306/druid2 oracle : jdbc:oracle:thin:@10.20.149.85:1521:ocnauto |<br>|username||连接数据库的用户名|<br>|password||连接数据库的密码。如果你不希望密码直接写在配置文件中，可以使用ConfigFilter。详细看这里：<span class="exturl" data-url="aHR0cHM6Ly9naXRodWIuY29tL2FsaWJhYmEvZHJ1aWQvd2lraS8lRTQlQkQlQkYlRTclOTQlQThDb25maWdGaWx0ZXJ8">https://github.com/alibaba/druid/wiki/%E4%BD%BF%E7%94%A8ConfigFilter|<i class="fa fa-external-link-alt"></i></span><br>|driverClassName||根据url自动识别 这一项可配可不配，如果不配置druid会根据url自动识别dbType，然后选择相应的driverClassName(建议配置下)|<br>|initialSize|0|初始化时建立物理连接的个数。初始化发生在显示调用init方法，或者第一次getConnection时|<br>|maxActive|8|最大连接池数量|<br>|maxIdle|8|已经不再使用，配置了也没效果|<br>|minIdle||最小连接池数量|<br>|maxWait||获取连接时最大等待时间，单位毫秒。配置了maxWait之后，缺省启用公平锁，并发效率会有所下降，如果需要可以通过配置useUnfairLock属性为true使用非公平锁。|<br>|poolPreparedStatements|false|是否缓存preparedStatement，也就是PSCache。PSCache对支持游标的数据库性能提升巨大，比如说oracle。在mysql下建议关闭。|<br>|maxOpenPreparedStatements|-1|要启用PSCache，必须配置大于0，当大于0时，poolPreparedStatements自动触发修改为true。在Druid中，不会存在Oracle下PSCache占用内存过多的问题，可以把这个数值配置大一些，比如说100|<br>|validationQuery||用来检测连接是否有效的sql，要求是一个查询语句。如果validationQuery为null，testOnBorrow、testOnReturn、testWhileIdle都不会其作用。|<br>|testOnBorrow|true|申请连接时执行validationQuery检测连接是否有效，做了这个配置会降低性能。|<br>|testOnReturn|false|归还连接时执行validationQuery检测连接是否有效，做了这个配置会降低性能|<br>|testWhileIdle|false|建议配置为true，不影响性能，并且保证安全性。申请连接的时候检测，如果空闲时间大于timeBetweenEvictionRunsMillis，执行validationQuery检测连接是否有效。|<br>|timeBetweenEvictionRunsMillis||有两个含义：(1)Destroy线程会检测连接的间隔时间  (2)testWhileIdle的判断依据，详细看testWhileIdle属性的说明|<br>|numTestsPerEvictionRun||不再使用，一个DruidDataSource只支持一个EvictionRun|<br>|minEvictableIdleTimeMillis|||<br>|connectionInitSqls||物理连接初始化的时候执行的sql|<br>|exceptionSorter||根据dbType自动识别 当数据库抛出一些不可恢复的异常时，抛弃连接|<br>|filters||属性类型是字符串，通过别名的方式配置扩展插件，常用的插件有： 监控统计用的filter:stat日志用的filter:log4j防御sql注入的filter:wall|<br>|proxyFilters||类型是List，如果同时配置了filters和proxyFilters，是组合关系，并非替换关系|</p>
<h3 id="ThreadLocal"><a href="#ThreadLocal" class="headerlink" title="ThreadLocal"></a>ThreadLocal</h3><p>JDK 1.2的版本中就提供java.lang.ThreadLocal，为解决多线程程序的并发问题提供了一种新的思路。</p>
<p>ThreadLocal用于<strong>保存某个线程共享变量</strong>，因为在Java中，每一个线程对象中都有一个ThreadLocalMap\<ThreadLocal, Object\>，其key就是一个ThreadLocal，而value就是Object即为<strong>该线程的共享变量</strong>，可通过下面方法操作：<br>（1）<code>ThreadLocal.get()</code>: 获取ThreadLocal中当前线程共享变量的值。<br>（2）<code>ThreadLocal.set()</code>: 设置ThreadLocal中当前线程共享变量的值。<br>（3）<code>ThreadLocal.remove()</code>: 移除ThreadLocal中当前线程共享变量的值。<br>对于同一个static ThreadLocal，不同线程只能从中get()，set()，remove()自己的变量，而不会影响其他线程的变量。<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.memories.threadlocal;</span><br><span class="line"><span class="keyword">import</span> java.util.Random;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">TestThreadLocal</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">        MyRunnable my = <span class="keyword">new</span> MyRunnable();</span><br><span class="line">        <span class="comment">//a线程的rand和B--线程的rand互不影响</span></span><br><span class="line">        <span class="keyword">new</span> Thread(my,<span class="string">&quot;a&quot;</span>).start();</span><br><span class="line">        <span class="keyword">new</span> Thread(my,<span class="string">&quot;B--&quot;</span>).start();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Tools</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> Random rand = <span class="keyword">new</span> Random();<span class="comment">//产生随机数的工具类</span></span><br><span class="line">    <span class="comment">//这里设置的就是当前线程保存的共享变量</span></span><br><span class="line">    <span class="comment">//这个共享变量不是我们之前说的多个线程之间共享，这里指同一个线程在整个生命周期中，使用的共享变量</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> ThreadLocal&lt;Integer&gt; threadLocal = <span class="keyword">new</span> ThreadLocal&lt;&gt;();</span><br><span class="line">    </span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> Integer <span class="title">getNumber</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="comment">//从当前线程中获取数字</span></span><br><span class="line">        Integer num = threadLocal.get();</span><br><span class="line">        <span class="keyword">if</span> (num == <span class="keyword">null</span>) &#123;</span><br><span class="line">            <span class="comment">//随机产生一个</span></span><br><span class="line">            num = rand.nextInt(<span class="number">100</span>);</span><br><span class="line">            <span class="comment">//将数字与当前线程绑定</span></span><br><span class="line">            threadLocal.set(num);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> num;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">removeNumber</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="comment">//获取当前线程中的数字</span></span><br><span class="line">        Integer num = threadLocal.get();</span><br><span class="line">        <span class="keyword">if</span> (num != <span class="keyword">null</span>) &#123;</span><br><span class="line">            <span class="comment">//将数字从当前线程中移除</span></span><br><span class="line">            threadLocal.remove();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">MyRunnable</span> <span class="keyword">implements</span> <span class="title">Runnable</span></span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">run</span><span class="params">()</span></span>&#123;</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span>; i &lt;=<span class="number">5</span>; i++) &#123;</span><br><span class="line">            <span class="comment">//拿当前线程中的数字</span></span><br><span class="line">            System.out.println(Thread.currentThread().getName() + <span class="string">&quot;:&quot;</span> + Tools.getNumber());</span><br><span class="line">            <span class="keyword">try</span> &#123;</span><br><span class="line">                Thread.sleep(<span class="number">100</span>);</span><br><span class="line">            &#125; <span class="keyword">catch</span> (InterruptedException e) &#123;</span><br><span class="line">                e.printStackTrace();</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">if</span>(i==<span class="number">3</span>)&#123;<span class="comment">//第三次时，删除线程中的数字</span></span><br><span class="line">                Tools.removeNumber();</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><br>输出结果：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">a:3</span><br><span class="line">B--:53</span><br><span class="line">a:3</span><br><span class="line">B--:53</span><br><span class="line">a:3</span><br><span class="line">B--:53</span><br><span class="line">remove后</span><br><span class="line">a:9</span><br><span class="line">remove后</span><br><span class="line">B--:40</span><br><span class="line">a:9</span><br><span class="line">B--:40</span><br></pre></td></tr></table></figure><br>发现ThreadLocal用于保存每一个线程共享变量，只要不删除remove，那么该值在该线程的生命周期中一直存在。<br>最常见的ThreadLocal使用场景为：用来解决 数据库连接、Session管理等。</p>
<h3 id="ThreadLocal封装JDBCTools"><a href="#ThreadLocal封装JDBCTools" class="headerlink" title="ThreadLocal封装JDBCTools"></a>ThreadLocal封装JDBCTools</h3><p>比如在使用连接池时，内部类是获取连接+处理sql，此时外部类想控制事务，但多条sql执行的内部类获取的连接是不同的，没法处理事务。<br>解决办法，内部类可以用ThreadLocal进行处理，把获取的连接和线程绑定，这样就可以保证外部类的线程中执行的多条sql使用是同一个线程的连接了，外部类可以执行事务了。<br><figure class="highlight java"><figcaption><span>JDBCTool.java</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.memories.util;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.sql.Connection;</span><br><span class="line"><span class="keyword">import</span> java.sql.SQLException;</span><br><span class="line"><span class="keyword">import</span> java.util.Properties;</span><br><span class="line"><span class="keyword">import</span> javax.sql.DataSource;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.alibaba.druid.pool.DruidDataSourceFactory;</span><br><span class="line"></span><br><span class="line"><span class="comment">//获取连接或释放连接的工具类</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">JDBCTools</span> </span>&#123;</span><br><span class="line">    <span class="comment">// 1、数据源,即连接池</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> DataSource dataSource;</span><br><span class="line">    <span class="comment">// 2、ThreadLocal对象</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> ThreadLocal&lt;Connection&gt; threadLocal;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">static</span> &#123;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="comment">//1、读取druip.properties文件</span></span><br><span class="line">            Properties pro = <span class="keyword">new</span> Properties();</span><br><span class="line">            pro.load(JDBCTools.class.getClassLoader().getResourceAsStream(<span class="string">&quot;druid.properties&quot;</span>));</span><br><span class="line">            </span><br><span class="line">            <span class="comment">//2、连接连接池</span></span><br><span class="line">            dataSource = DruidDataSourceFactory.createDataSource(pro);</span><br><span class="line"></span><br><span class="line">            <span class="comment">//3、创建线程池</span></span><br><span class="line">            threadLocal = <span class="keyword">new</span> ThreadLocal&lt;&gt;();</span><br><span class="line">        &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 获取连接的方法</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     * <span class="doctag">@throws</span> SQLException</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> Connection <span class="title">getConnection</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="comment">// 从当前线程中获取连接</span></span><br><span class="line">        Connection connection = threadLocal.get();</span><br><span class="line">        <span class="keyword">if</span> (connection == <span class="keyword">null</span>) &#123;</span><br><span class="line">            <span class="comment">// 从连接池中获取一个连接</span></span><br><span class="line">            <span class="keyword">try</span> &#123;</span><br><span class="line">                connection = dataSource.getConnection();</span><br><span class="line">                <span class="comment">// 将连接与当前线程绑定</span></span><br><span class="line">                threadLocal.set(connection);</span><br><span class="line">            &#125; <span class="keyword">catch</span> (SQLException e) &#123;</span><br><span class="line">                e.printStackTrace();</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> connection;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 释放连接的方法</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> connection</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">free</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="comment">// 获取当前线程中的连接</span></span><br><span class="line">        Connection connection = threadLocal.get();</span><br><span class="line">        <span class="keyword">if</span> (connection != <span class="keyword">null</span>) &#123;</span><br><span class="line">            <span class="keyword">try</span> &#123;</span><br><span class="line">                connection.close();</span><br><span class="line">                <span class="comment">// 将已经关闭的连接从当前线程中移除</span></span><br><span class="line">                threadLocal.remove();</span><br><span class="line">            &#125; <span class="keyword">catch</span> (SQLException e) &#123;</span><br><span class="line">                e.printStackTrace();</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<h3 id="JDBCTools封装BasicDAOImpl"><a href="#JDBCTools封装BasicDAOImpl" class="headerlink" title="JDBCTools封装BasicDAOImpl"></a>JDBCTools封装BasicDAOImpl</h3><p>DAO：Data Access Object，访问数据信息的类和接口，包括了对数据的CRUD（Create、Retrival、Update、Delete），而不包含任何业务相关的信息（数据库池，获取连接，释放连接等）。<br>作用：为了实现功能的模块化，更有利于代码的维护和升级。比如当发生数据库迁移的情况，业务逻辑层JDBCTools类就可以不动，只需要改动BasicDAOImpl类就行了。习惯面向接口编程，便于模块化管理和移植。</p>
<p>把JDBCTools类的访问等操作功能分离出来了，BasicDAOImpl类。<br><figure class="highlight java"><figcaption><span>BasicDAOImpl.java</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.memories.dao;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.lang.reflect.Field;</span><br><span class="line"><span class="keyword">import</span> java.sql.Connection;</span><br><span class="line"><span class="keyword">import</span> java.sql.PreparedStatement;</span><br><span class="line"><span class="keyword">import</span> java.sql.ResultSet;</span><br><span class="line"><span class="keyword">import</span> java.sql.ResultSetMetaData;</span><br><span class="line"><span class="keyword">import</span> java.sql.SQLException;</span><br><span class="line"><span class="keyword">import</span> java.util.ArrayList;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.memories.utils.JDBCTools;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">BasicDAOImpl</span> </span>&#123;</span><br><span class="line">    <span class="comment">//适用于insert,update,delete语句</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">update</span><span class="params">(String sql,Object... args)</span> </span>&#123;</span><br><span class="line">        <span class="comment">//1、获取连接</span></span><br><span class="line">        Connection conn = JDBCTools.getConnection();</span><br><span class="line">        <span class="comment">//2、创建PreparedStatement</span></span><br><span class="line">        PreparedStatement pst = <span class="keyword">null</span>;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            pst = conn.prepareStatement(sql);</span><br><span class="line">            <span class="comment">//3、设置？的值</span></span><br><span class="line">            <span class="keyword">if</span>(args!=<span class="keyword">null</span> &amp;&amp; args.length&gt;<span class="number">0</span>)&#123;</span><br><span class="line">                <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; args.length; i++) &#123;<span class="comment">//数组的下标从0开始</span></span><br><span class="line">                    pst.setObject(i+<span class="number">1</span>, args[i]);<span class="comment">//？的序号从1开始</span></span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="comment">//4、执行更新sql</span></span><br><span class="line">            <span class="keyword">return</span> pst.executeUpdate();</span><br><span class="line">        &#125; <span class="keyword">catch</span> (SQLException e) &#123;</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> RuntimeException(e);</span><br><span class="line">        &#125;<span class="keyword">finally</span>&#123;</span><br><span class="line">            <span class="keyword">try</span> &#123;</span><br><span class="line">                <span class="comment">//5、关闭</span></span><br><span class="line">                pst.close();</span><br><span class="line">                JDBCTools.free();</span><br><span class="line">            &#125; <span class="keyword">catch</span> (SQLException e) &#123;</span><br><span class="line">                e.printStackTrace();</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">//通用的查询，多个T对象。T表的每一行对应T类一个实例</span></span><br><span class="line">    <span class="comment">//T可能代表Department，Employee等各种Javabean的对象</span></span><br><span class="line">    <span class="comment">//clazz是决定你查询的结果是Department，Employee类型中的那个对象</span></span><br><span class="line">    <span class="keyword">public</span> &lt;T&gt; <span class="function">ArrayList&lt;T&gt; <span class="title">getBeanList</span><span class="params">(Class&lt;T&gt; clazz, String sql,Object... args)</span></span>&#123;</span><br><span class="line">        <span class="comment">//1、获取连接</span></span><br><span class="line">        Connection conn = JDBCTools.getConnection();</span><br><span class="line">        <span class="comment">//2、创建PreparedStatement</span></span><br><span class="line">        PreparedStatement pst = <span class="keyword">null</span>;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            pst = conn.prepareStatement(sql);</span><br><span class="line">            <span class="comment">//3、设置？的值</span></span><br><span class="line">            <span class="keyword">if</span>(args!=<span class="keyword">null</span> &amp;&amp; args.length&gt;<span class="number">0</span>)&#123;</span><br><span class="line">                <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; args.length; i++) &#123;<span class="comment">//数组的下标从0开始</span></span><br><span class="line">                    pst.setObject(i+<span class="number">1</span>, args[i]);<span class="comment">//？的序号从1开始</span></span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="comment">//4、执行查询</span></span><br><span class="line">            ResultSet rs = pst.executeQuery();</span><br><span class="line">            <span class="comment">//获取结果集的元数据对象，该对象有对结果集的数据进行描述的相关信息</span></span><br><span class="line">            ResultSetMetaData rsm = rs.getMetaData();</span><br><span class="line">            <span class="comment">//(1)获取结果集的列数</span></span><br><span class="line">            <span class="keyword">int</span> count = rsm.getColumnCount();</span><br><span class="line">            </span><br><span class="line">            ArrayList&lt;T&gt; list = <span class="keyword">new</span> ArrayList&lt;T&gt;();</span><br><span class="line">            <span class="comment">//5、把ResultSet结果集中的数据封装到一个一个JavaBean对象中，并且存到list中</span></span><br><span class="line">            <span class="keyword">while</span>(rs.next())&#123;<span class="comment">//循环一次，代表一行，一行就是一个JavaBean对象</span></span><br><span class="line">                <span class="comment">//(2)创建一个JavaBean的对象</span></span><br><span class="line">                T obj = clazz.newInstance();</span><br><span class="line">                <span class="comment">//有几列，就代表有几个属性</span></span><br><span class="line">                <span class="comment">//为obj的每一个属性赋值</span></span><br><span class="line">                <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; count; i++) &#123;</span><br><span class="line">                    <span class="comment">//通过反射设置属性的值</span></span><br><span class="line">                    <span class="comment">//(3)从结果集的元数据对象中获取第几列的字段名</span></span><br><span class="line">                    String columnName = rsm.getColumnLabel(i+<span class="number">1</span>);<span class="comment">//mysql的序号从1开始</span></span><br><span class="line">                    <span class="comment">//(4)获取属性对象</span></span><br><span class="line">                    Field field = clazz.getDeclaredField(columnName);<span class="comment">//根据字段名称，获取属性对象</span></span><br><span class="line">                    <span class="comment">//(5)设置属性可以被访问</span></span><br><span class="line">                    field.setAccessible(<span class="keyword">true</span>);</span><br><span class="line">                    <span class="comment">//(6)设置属性的值</span></span><br><span class="line">                    field.set(obj, rs.getObject(i+<span class="number">1</span>));<span class="comment">//从结果集中获取第i+1的值，赋值给该属性</span></span><br><span class="line">                &#125;</span><br><span class="line">                list.add(obj);</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="comment">//7、返回结果</span></span><br><span class="line">            <span class="keyword">return</span> list;</span><br><span class="line">        &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> RuntimeException(e);</span><br><span class="line">        &#125;<span class="keyword">finally</span>&#123;</span><br><span class="line">            <span class="keyword">try</span> &#123;</span><br><span class="line">                <span class="comment">//6、关闭</span></span><br><span class="line">                pst.close();</span><br><span class="line">                JDBCTools.free();</span><br><span class="line">            &#125; <span class="keyword">catch</span> (SQLException e) &#123;</span><br><span class="line">                e.printStackTrace();</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">//通用的查询，单个T对象</span></span><br><span class="line">    <span class="keyword">public</span> &lt;T&gt; <span class="function">T <span class="title">getBean</span><span class="params">(Class&lt;T&gt; type,String sql, Object... params)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> getBeanList(type,sql,params).get(<span class="number">0</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<div class="tabs" id="dao"><ul class="nav-tabs"><li class="tab active"><a href="#dao-1">Employee</a></li><li class="tab"><a href="#dao-2">EmployeeDAO</a></li><li class="tab"><a href="#dao-3">EmployeeDAOImpl</a></li><li class="tab"><a href="#dao-4">TestEmployeeDAOImpl</a></li></ul><div class="tab-content"><div class="tab-pane active" id="dao-1"><figure class="highlight java"><figcaption><span>Employee.java</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//int,double等在Java中都用包装类，因为mysql中的所有类型都可能是NULL，而Java只有引用数据类型才有NULL值</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Employee</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> Integer eid;</span><br><span class="line">    <span class="keyword">private</span> String ename;</span><br><span class="line">    <span class="keyword">private</span> String tel;</span><br><span class="line">    <span class="keyword">private</span> String gender;<span class="comment">//mysql中用char,在Java中也要用String</span></span><br><span class="line">    <span class="keyword">private</span> Double salary;</span><br><span class="line">    <span class="keyword">private</span> Double commissionPct;<span class="comment">//和数据库不一样，可以用别名使它们一样</span></span><br><span class="line">    <span class="keyword">private</span> Date birthday;<span class="comment">//此处用String或Date</span></span><br><span class="line">    <span class="keyword">private</span> Date hiredate;</span><br><span class="line">    <span class="keyword">private</span> Integer jobId;</span><br><span class="line">    <span class="keyword">private</span> String email;</span><br><span class="line">    <span class="keyword">private</span> Integer mid;</span><br><span class="line">    <span class="keyword">private</span> String address;</span><br><span class="line">    <span class="keyword">private</span> String nativePlace;</span><br><span class="line">    <span class="keyword">private</span> Integer did;</span><br><span class="line"><span class="comment">//...</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div><div class="tab-pane" id="dao-2"><figure class="highlight java"><figcaption><span>EmployeeDAO.java</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.memories.dao;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.util.List;</span><br><span class="line"><span class="keyword">import</span> com.memories.bean.Employee;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">EmployeeDAO</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">addEmployee</span><span class="params">(Employee emp)</span></span>;</span><br><span class="line">    <span class="function">List&lt;Employee&gt; <span class="title">getAllEmployee</span><span class="params">()</span></span>;</span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">update</span><span class="params">(Employee emp)</span></span>;</span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">deleteByEid</span><span class="params">(<span class="keyword">int</span> eid)</span></span>;</span><br><span class="line">    <span class="function">Employee <span class="title">getById</span><span class="params">(<span class="keyword">int</span> eid)</span></span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div><div class="tab-pane" id="dao-3"><figure class="highlight java"><figcaption><span>EmployeeDAOImpl.java</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.memories.dao;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.util.List;</span><br><span class="line"><span class="keyword">import</span> com.memories.bean.Employee;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">EmployeeDAOImpl</span> <span class="keyword">extends</span> <span class="title">BasicDAOImpl</span> <span class="keyword">implements</span> <span class="title">EmployeeDAO</span></span>&#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">addEmployee</span><span class="params">(Employee emp)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="comment">//eid,ename,tel,gender,salary,commission_pct,birthday,hiredate,job_id,email,MID,address,native_place,did</span></span><br><span class="line">            String sql = <span class="string">&quot;INSERT INTO t_employee VALUES(NULL,?,?,?,?,?,?,?,?,?,?,?,?,?)&quot;</span>;</span><br><span class="line">            update(sql, emp.getEname(),</span><br><span class="line">                    emp.getTel(),</span><br><span class="line">                    emp.getGender(),</span><br><span class="line">                    emp.getSalary(),</span><br><span class="line">                    emp.getCommissionPct(),</span><br><span class="line">                    emp.getBirthday(),</span><br><span class="line">                    emp.getHiredate(),</span><br><span class="line">                    emp.getJobId(),</span><br><span class="line">                    emp.getEmail(),</span><br><span class="line">                    emp.getMid(),</span><br><span class="line">                    emp.getAddress(),</span><br><span class="line">                    emp.getNativePlace(),</span><br><span class="line">                    emp.getDid());</span><br><span class="line">        &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> RuntimeException(e.getMessage());</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> List&lt;Employee&gt; <span class="title">getAllEmployee</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="comment">//如果字段名和属性名对不上，那么可以取别名，通过别名来代表属性名</span></span><br><span class="line">            String sql = <span class="string">&quot;select eid,ename,tel,gender,salary,commission_pct as commissionPct,birthday,hiredate,job_id as jobId,email,mid,address,native_place as nativePlace,did from t_employee&quot;</span>;</span><br><span class="line">            <span class="keyword">return</span> getBeanList(Employee.class, sql);</span><br><span class="line">        &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> RuntimeException(e.getMessage());</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">update</span><span class="params">(Employee emp)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">try</span>&#123;</span><br><span class="line">            String sql = <span class="string">&quot;update t_employee set ename=?,tel=?,gender=?,salary=?,commission_pct =?,birthday=?,hiredate=?,job_id=?,email=?,mid=?,address=?,native_place=? ,did=? where eid=?&quot;</span>;</span><br><span class="line">            update(sql, emp.getEname(),</span><br><span class="line">                    emp.getTel(),</span><br><span class="line">                    emp.getGender(),</span><br><span class="line">                    emp.getSalary(),</span><br><span class="line">                    emp.getCommissionPct(),</span><br><span class="line">                    emp.getBirthday(),</span><br><span class="line">                    emp.getHiredate(),</span><br><span class="line">                    emp.getJobId(),</span><br><span class="line">                    emp.getEmail(),</span><br><span class="line">                    emp.getMid(),</span><br><span class="line">                    emp.getAddress(),</span><br><span class="line">                    emp.getNativePlace(),</span><br><span class="line">                    emp.getDid(),</span><br><span class="line">                    emp.getEid());</span><br><span class="line">        &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> RuntimeException(e.getMessage());</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">deleteByEid</span><span class="params">(<span class="keyword">int</span> eid)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            String sql = <span class="string">&quot;delete from t_employee where eid = ?&quot;</span>;</span><br><span class="line">            update(sql, eid);</span><br><span class="line">        &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> RuntimeException(e.getMessage());</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Employee <span class="title">getById</span><span class="params">(<span class="keyword">int</span> eid)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            String sql = <span class="string">&quot;select eid,ename,tel,gender,salary,commission_pct as commissionPct,birthday,hiredate,job_id as jobId,email,mid,address,native_place as nativePlace,did from t_employee where eid = ?&quot;</span>;</span><br><span class="line">            <span class="keyword">return</span> getBean(Employee.class, sql, eid);</span><br><span class="line">        &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> RuntimeException(e.getMessage());</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div><div class="tab-pane" id="dao-4"><figure class="highlight java"><figcaption><span>TestEmployeeDAOImpl.java</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.memories.dao;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.util.List;</span><br><span class="line"><span class="keyword">import</span> org.junit.Test;</span><br><span class="line"><span class="keyword">import</span> com.memories.bean.Employee;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">TestEmployeeDAOImpl</span> </span>&#123;</span><br><span class="line">    EmployeeDAOImpl ed = <span class="keyword">new</span> EmployeeDAOImpl();</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">test1</span><span class="params">()</span></span>&#123;</span><br><span class="line">         List&lt;Employee&gt; all = ed.getAllEmployee();</span><br><span class="line">        <span class="keyword">for</span> (Employee employee : all) &#123;</span><br><span class="line">            System.out.println(employee);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div></div></div>
<h2 id="Apache—DBUtils"><a href="#Apache—DBUtils" class="headerlink" title="Apache—DBUtils"></a>Apache—DBUtils</h2><p>commons-dbutils 是 Apache 组织提供的一个开源 JDBC工具类库，它是对JDBC的简单封装，学习成本极低，并且使用dbutils能极大简化jdbc编码的工作量，同时也不会影响程序的性能。</p>
<h3 id="DbUtils类"><a href="#DbUtils类" class="headerlink" title="DbUtils类"></a>DbUtils类</h3><p>DbUtils ：提供如关闭连接、装载JDBC驱动程序等常规工作的工具类，里面的所有方法都是静态的。主要方法如下：<br>（1）<code>public static void close(…) throws java.sql.SQLException</code>：　DbUtils类提供了三个重载的关闭方法。这些方法检查所提供的参数是不是NULL，如果不是的话，它们就关闭Connection、Statement和ResultSet。<br>（2）<code>public static void closeQuietly(…)</code>: 这一类方法不仅能在Connection、Statement和ResultSet为NULL情况下避免关闭，还能隐藏一些在程序中抛出的SQLEeception。<br>（3）<code>public static void commitAndClose(Connection conn)throws SQLException</code> 用来提交连接的事务，然后关闭连接。<br>（4）<code>public static void commitAndCloseQuietly(Connection conn)</code>：用来提交连接的事务，然后关闭连接，并且在关闭连接时不抛出SQL异常。<br>（5）<code>public static void rollback(Connection conn)throws SQLException</code>：允许conn为null，因为方法内部做了判断。<br>（6）<code>public static void rollbackAndClose(Connection conn)throws SQLException</code><br>（7）<code>rollbackAndCloseQuietly(Connection)</code><br>（8）<code>public static boolean loadDriver(java.lang.String driverClassName)</code>：这一方装载并注册JDBC驱动程序，如果成功就返回true。使用该方法，你不需要捕捉这个异常ClassNotFoundException。</p>
<h3 id="QueryRunner类"><a href="#QueryRunner类" class="headerlink" title="QueryRunner类"></a>QueryRunner类</h3><p>该类封装了SQL的执行，是线程安全的。<br>（1）可以实现增、删、改、查、批处理。<br>（2）考虑了事务处理需要共用Connection。<br>（3）该类最主要的就是简单化了SQL查询，它与ResultSetHandler组合在一起使用可以完成大部分的数据库操作，能够大大减少编码量。</p>
<p>QueryRunner类提供了两个构造方法：<br>（1）<code>QueryRunner()</code>：默认的构造方法。<br>（2）<code>QueryRunner(DataSource ds)</code>：需要一个 javax.sql.DataSource 来作参数的构造方法。</p>
<p>更新：<br><code>public int update(Connection conn, String sql, Object... params) throws SQLException</code>:用来执行一个更新,插入,更新或删除,操作。</p>
<p>插入：<br><code>public &lt;T&gt; T insert(Connection conn,String sql,ResultSetHandler&lt;T&gt; rsh, Object... params) throws SQLException</code>：只支持INSERT语句，其中rsh根据自动生成键值的ResultSet创建结果对象，返回自动生成的键值。</p>
<p>批处理：<br><code>public int[] batch(Connection conn,String sql,Object[][] params)throws SQLException</code>： INSERT, UPDATE, or DELETE语句。<br><code>public &lt;T&gt; T insertBatch(Connection conn,String sql,ResultSetHandler&lt;T&gt; rsh,Object[][] params)throws SQLException</code>：只支持INSERT语句。</p>
<p>使用QueryRunner类实现查询：<br><code>public Object query(Connection conn, String sql, ResultSetHandler rsh,Object... params) throws SQLException</code>：执行一个查询操作，在这个查询中，对象数组中的每个元素值被用来作为查询语句的置换参数。该方法会自行处理 PreparedStatement 和 ResultSet 的创建和关闭。</p>
<p>简化前面的BasicDAOImpl类，配合ResultSetHandler使用。<br><figure class="highlight java"><figcaption><span>BasicDAOImpl.java</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.memories.dao;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.sql.SQLException;</span><br><span class="line"><span class="keyword">import</span> java.util.ArrayList;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.apache.commons.dbutils.QueryRunner;</span><br><span class="line"><span class="keyword">import</span> org.apache.commons.dbutils.handlers.BeanHandler;</span><br><span class="line"><span class="keyword">import</span> org.apache.commons.dbutils.handlers.BeanListHandler;</span><br><span class="line"><span class="keyword">import</span> org.apache.commons.dbutils.handlers.MapHandler;</span><br><span class="line"><span class="keyword">import</span> org.apache.commons.dbutils.handlers.MapListHandler;</span><br><span class="line"><span class="keyword">import</span> org.apache.commons.dbutils.handlers.ScalarHandler;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.memories.utils.JDBCTools;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">BasicDAOImpl</span> </span>&#123;</span><br><span class="line">    <span class="comment">//QueryRunner类</span></span><br><span class="line">    <span class="keyword">private</span> QueryRunner qr = <span class="keyword">new</span> QueryRunner();</span><br><span class="line"></span><br><span class="line">    <span class="comment">//适用于insert,update,delete语句</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">update</span><span class="params">(String sql,Object... args)</span> <span class="keyword">throws</span> SQLException</span>&#123;</span><br><span class="line">        <span class="keyword">return</span> qr.update(JDBCTools.getConnection(), sql, args);</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">//通用的查询，多个T对象。T表的每一行对应T类一个实例</span></span><br><span class="line">    <span class="comment">//T可能代表Department，Employee等各种Javabean的对象</span></span><br><span class="line">    <span class="comment">//clazz是决定你查询的结果是Department，Employee类型中的那个对象</span></span><br><span class="line">    <span class="keyword">public</span> &lt;T&gt; <span class="function">ArrayList&lt;T&gt; <span class="title">getBeanList</span><span class="params">(Class&lt;T&gt; clazz, String sql,Object... args)</span></span>&#123;</span><br><span class="line">        <span class="comment">//BeanListHandler&lt;&gt;(clazz)，结果集中元素类型是clazz</span></span><br><span class="line">        <span class="keyword">return</span> qr.query(JDBCTools.getConnection(), sql, <span class="keyword">new</span> BeanListHandler&lt;&gt;(clazz), args);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">//通用的查询，单个T对象</span></span><br><span class="line">    <span class="keyword">public</span> &lt;T&gt; <span class="function">T <span class="title">getBean</span><span class="params">(Class&lt;T&gt; type,String sql, Object... params)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> qr.query(JDBCTools.getConnection(), sql, <span class="keyword">new</span> BeanHandler&lt;&gt;(clazz), args);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">//查询单个值对象。比如count结果</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Object <span class="title">getObject</span><span class="params">(String sql,Object... args)</span><span class="keyword">throws</span> SQLException</span>&#123;</span><br><span class="line">		<span class="keyword">return</span> qr.query(JDBCTools.getConnection(), sql, <span class="keyword">new</span> ScalarHandler(), args);</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="comment">//查询单个kv对象。对应group by结果的第一个</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> Map <span class="title">getMap</span><span class="params">(String sql,Object... args)</span><span class="keyword">throws</span> SQLException</span>&#123;</span><br><span class="line">		<span class="keyword">return</span> qr.query(JDBCTools.getConnection(), sql, <span class="keyword">new</span> MapHandler(), args);</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="comment">//查询多个kv对象。对应group by所有结果</span></span><br><span class="line">	<span class="keyword">public</span> List&lt;Map&lt;String,Object&gt;&gt; getMapList(String sql,Object... args)<span class="keyword">throws</span> SQLException&#123;</span><br><span class="line">		<span class="keyword">return</span> qr.query(JDBCTools.getConnection(), sql, <span class="keyword">new</span> MapListHandler(), args);</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<h3 id="ResultSetHandler接口"><a href="#ResultSetHandler接口" class="headerlink" title="ResultSetHandler接口"></a>ResultSetHandler接口</h3><p>该接口用于处理 java.sql.ResultSet，将数据按要求转换为另一种形式。ResultSetHandler 接口提供了一个单独的方法：Object handle (java.sql.ResultSet  rs)该方法的返回值将作为QueryRunner类的query()方法的返回值。<br>该接口有如下实现类可以使用：<br>（1）BeanHandler：将结果集中的第一行数据封装到一个对应的JavaBean实例中。<br>（2）BeanListHandler：将结果集中的每一行数据都封装到一个对应的JavaBean实例中，存放到List里。<br>（3）ScalarHandler：查询单个值对象。<br>（4）MapHandler：将结果集中的第一行数据封装到一个Map里，key是列名，value就是对应的值。<br>（5）MapListHandler：将结果集中的每一行数据都封装到一个Map里，然后再存放到List。<br>（6）ColumnListHandler：将结果集中某一列的数据存放到List中。<br>（7）KeyedHandler(name)：将结果集中的每一行数据都封装到一个Map里，再把这些map再存到一个map里，其key为指定的key。<br>（8）ArrayHandler：把结果集中的第一行数据转成对象数组。<br>（9）ArrayListHandler：把结果集中的每一行数据都转成一个数组，再存放到List中。</p>
<h3 id="习题代码"><a href="#习题代码" class="headerlink" title="习题代码"></a>习题代码</h3><p>DAO接口：<br><div class="tabs" id="dao2"><ul class="nav-tabs"><li class="tab active"><a href="#dao2-1">UserDAO</a></li><li class="tab"><a href="#dao2-2">BookDAO</a></li><li class="tab"><a href="#dao2-3">OrderDAO</a></li><li class="tab"><a href="#dao2-4">OrderItemDAO</a></li></ul><div class="tab-content"><div class="tab-pane active" id="dao2-1"><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.memories.dao;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.memories.bean.User;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">UserDAO</span> </span>&#123;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 根据用户名和密码获取数据库中的记录</span></span><br><span class="line"><span class="comment">     * </span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> user</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> User：用户名和密码正确 null：用户名或密码不正确</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> User <span class="title">getUser</span><span class="params">(User user)</span></span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 根据用户名获取数据库中的记录</span></span><br><span class="line"><span class="comment">     * </span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> user</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> true：用户名已存在， false：用户名可用</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">checkUserName</span><span class="params">(User user)</span></span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 将用户保存到数据库</span></span><br><span class="line"><span class="comment">     * </span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> user</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">saveUser</span><span class="params">(User user)</span></span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div><div class="tab-pane" id="dao2-2"><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.memories.dao;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.util.List;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.memories.bean.Book;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">BookDAO</span> </span>&#123;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 获取所有图书的方法</span></span><br><span class="line"><span class="comment">     * </span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> List&lt;Book&gt; <span class="title">getBooks</span><span class="params">()</span></span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 添加图书的方法</span></span><br><span class="line"><span class="comment">     * </span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> book</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">addBook</span><span class="params">(Book book)</span></span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 根据图书的id删除图书的方法</span></span><br><span class="line"><span class="comment">     * </span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> bookId</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">deleteBookById</span><span class="params">(String bookId)</span></span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 根据图书的id获取图书信息</span></span><br><span class="line"><span class="comment">     * </span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> bookId</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Book <span class="title">getBookById</span><span class="params">(String bookId)</span></span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 更新图书信息的方法</span></span><br><span class="line"><span class="comment">     * </span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> book</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">updateBook</span><span class="params">(Book book)</span></span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 批量更新图书的库存和销量</span></span><br><span class="line"><span class="comment">     * </span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> params</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">batchUpdateSalesAndStock</span><span class="params">(Object[][] params)</span></span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div><div class="tab-pane" id="dao2-3"><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.memories.dao;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.util.List;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.memories.bean.Order;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">OrderDAO</span> </span>&#123;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 保存订单的方法</span></span><br><span class="line"><span class="comment">     * </span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> order</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">saveOrder</span><span class="params">(Order order)</span></span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 获取所用订单的方法</span></span><br><span class="line"><span class="comment">     * </span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> List&lt;Order&gt; <span class="title">getOrders</span><span class="params">()</span></span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 获取我的订单的方法</span></span><br><span class="line"><span class="comment">     * </span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> userId</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> List&lt;Order&gt; <span class="title">getMyOrders</span><span class="params">(<span class="keyword">int</span> userId)</span></span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 更新订单的状态的方法，例如已发货、确认收货等</span></span><br><span class="line"><span class="comment">     * </span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> orderId</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> state</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">updateOrderState</span><span class="params">(String orderId, <span class="keyword">int</span> state)</span></span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div><div class="tab-pane" id="dao2-4"><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.memories.dao;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.util.List;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.memories.bean.OrderItem;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">OrderItemDAO</span> </span>&#123;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 根据订单号获取对应的订单项</span></span><br><span class="line"><span class="comment">     * </span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> orderId</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> List&lt;OrderItem&gt; <span class="title">getOrderItemsByOrderId</span><span class="params">(String orderId)</span></span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 批量插入订单项的方法</span></span><br><span class="line"><span class="comment">     * </span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> params</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">batchInsertOrderItems</span><span class="params">(Object[][] params)</span></span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div></div></div><br>BasicDAOImpl：<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.memories.dao.impl;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.sql.Connection;</span><br><span class="line"><span class="keyword">import</span> java.sql.SQLException;</span><br><span class="line"><span class="keyword">import</span> java.util.List;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.apache.commons.dbutils.QueryRunner;</span><br><span class="line"><span class="keyword">import</span> org.apache.commons.dbutils.handlers.BeanHandler;</span><br><span class="line"><span class="keyword">import</span> org.apache.commons.dbutils.handlers.BeanListHandler;</span><br><span class="line"><span class="keyword">import</span> org.apache.commons.dbutils.handlers.ScalarHandler;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.memories.util.JDBCTools;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 定义一个用来被继承的对数据库进行基本操作的Dao</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">BasicDAOImpl</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> QueryRunner queryRunner = <span class="keyword">new</span> QueryRunner();</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 通用的增删改操作</span></span><br><span class="line"><span class="comment">     * </span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> sql</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> params</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">update</span><span class="params">(String sql, Object... params)</span> </span>&#123;</span><br><span class="line">        <span class="comment">// 获取连接</span></span><br><span class="line">        Connection connection = JDBCTools.getConnection();</span><br><span class="line">        <span class="keyword">int</span> count = <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            count = queryRunner.update(connection, sql, params);</span><br><span class="line">        &#125; <span class="keyword">catch</span> (SQLException e) &#123;</span><br><span class="line">            <span class="comment">//将编译时异常转换为运行时异常向上抛</span></span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> RuntimeException(e);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> count;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 获取一个对象</span></span><br><span class="line"><span class="comment">     * </span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> sql</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> params</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> &lt;T&gt; <span class="function">T <span class="title">getBean</span><span class="params">(Class&lt;T&gt; type,String sql, Object... params)</span> </span>&#123;</span><br><span class="line">        <span class="comment">// 获取连接</span></span><br><span class="line">        Connection connection = JDBCTools.getConnection();</span><br><span class="line">        T t = <span class="keyword">null</span>;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            t = queryRunner.query(connection, sql, <span class="keyword">new</span> BeanHandler&lt;T&gt;(type), params);</span><br><span class="line">        &#125; <span class="keyword">catch</span> (SQLException e) &#123;</span><br><span class="line">            <span class="comment">//将编译时异常转换为运行时异常向上抛</span></span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> RuntimeException(e);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> t;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 获取所有对象</span></span><br><span class="line"><span class="comment">     * </span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> sql</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> params</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> &lt;T&gt; <span class="function">List&lt;T&gt; <span class="title">getBeanList</span><span class="params">(Class&lt;T&gt; type,String sql, Object... params)</span> </span>&#123;</span><br><span class="line">        <span class="comment">// 获取连接</span></span><br><span class="line">        Connection connection = JDBCTools.getConnection();</span><br><span class="line">        List&lt;T&gt; list = <span class="keyword">null</span>;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            list = queryRunner.query(connection, sql, <span class="keyword">new</span> BeanListHandler&lt;T&gt;(type), params);</span><br><span class="line">        &#125; <span class="keyword">catch</span> (SQLException e) &#123;</span><br><span class="line">            <span class="comment">//将编译时异常转换为运行时异常向上抛</span></span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> RuntimeException(e);</span><br><span class="line">        &#125; </span><br><span class="line">        <span class="keyword">return</span> list;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 获取一个单一值的方法，专门用来执行像select count(*)... 这样的sql语句</span></span><br><span class="line"><span class="comment">     * </span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> sql</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> params</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Object <span class="title">getSingleValue</span><span class="params">(String sql, Object... params)</span> </span>&#123;</span><br><span class="line">        <span class="comment">// 获取连接</span></span><br><span class="line">        Connection connection = JDBCTools.getConnection();</span><br><span class="line">        Object value = <span class="keyword">null</span>;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            value = queryRunner.query(connection, sql, <span class="keyword">new</span> ScalarHandler(), params);</span><br><span class="line">        &#125; <span class="keyword">catch</span> (SQLException e) &#123;</span><br><span class="line">            <span class="comment">//将编译时异常转换为运行时异常向上抛</span></span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> RuntimeException(e);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> value;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 进行批处理的方法</span></span><br><span class="line"><span class="comment">     * 关于二维数组Object[][] params</span></span><br><span class="line"><span class="comment">     *         二维数组的第一维是sql语句要执行的次数</span></span><br><span class="line"><span class="comment">     *         二维数组的第二维就是每条sql语句中要填充的占位符</span></span><br><span class="line"><span class="comment">     * </span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> sql</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> params</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">batchUpdate</span><span class="params">(String sql , Object[][] params)</span></span>&#123;</span><br><span class="line">        <span class="comment">//获取连接</span></span><br><span class="line">        Connection connection = JDBCTools.getConnection();</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            queryRunner.batch(connection ,sql, params);</span><br><span class="line">        &#125; <span class="keyword">catch</span> (SQLException e) &#123;</span><br><span class="line">            <span class="comment">//将编译时异常转换为运行时异常向上抛</span></span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> RuntimeException(e);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><br>DAO实现类:<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.memories.dao.impl;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.memories.bean.User;</span><br><span class="line"><span class="keyword">import</span> com.memories.dao.UserDAO;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">UserDAOImpl</span> <span class="keyword">extends</span> <span class="title">BasicDAOImpl</span> <span class="keyword">implements</span> <span class="title">UserDAO</span></span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> User <span class="title">getUser</span><span class="params">(User user)</span> </span>&#123;</span><br><span class="line">        <span class="comment">// 写查询数据库的sql语句</span></span><br><span class="line">        String sql = <span class="string">&quot;select id , username , password , email from users where username = ? and password = ?&quot;</span>;</span><br><span class="line">        <span class="comment">// 调用BaseDao中的getBean方法</span></span><br><span class="line">        User bean = getBean(User.class, sql, user.getUsername(), user.getPassword());</span><br><span class="line">        <span class="keyword">return</span> bean;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">checkUserName</span><span class="params">(User user)</span> </span>&#123;</span><br><span class="line">        <span class="comment">// 写查询数据库的sql语句</span></span><br><span class="line">        String sql = <span class="string">&quot;select id , username , password , email from users where username = ?&quot;</span>;</span><br><span class="line">        <span class="comment">// 调用BaseDao中的getBean方法</span></span><br><span class="line">        User bean = getBean(User.class, sql, user.getUsername());</span><br><span class="line">        <span class="keyword">return</span> bean!=<span class="keyword">null</span>;<span class="comment">//不为空，说明已存在，返回true，如果bEan是空的，没找到，bean!=null返回false，说明不存在</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">saveUser</span><span class="params">(User user)</span> </span>&#123;</span><br><span class="line">        <span class="comment">//写添加数据到数据库的sql语句</span></span><br><span class="line">        String sql = <span class="string">&quot;insert into users(username,password,email) values(?,?,?)&quot;</span>;</span><br><span class="line">        <span class="comment">//调用BaseDao中通用的增删改的方法</span></span><br><span class="line">        update(sql, user.getUsername(),user.getPassword(),user.getEmail());</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>

    </div>

    
    
    
      
  <div class="popular-posts-header">相关文章</div>
  <ul class="popular-posts">
    <li class="popular-posts-item">
      <div class="popular-posts-title"><a href="\2019\03\25\MySQL\02.MySQL练习题\" rel="bookmark">MySQL练习题</a></div>
    </li>
    <li class="popular-posts-item">
      <div class="popular-posts-title"><a href="\2019\04\01\MySQL\03.Python和数据库\" rel="bookmark">Python和数据库</a></div>
    </li>
    <li class="popular-posts-item">
      <div class="popular-posts-title"><a href="\2019\03\23\MySQL\01.MySQL数据库\" rel="bookmark">MySQL数据库</a></div>
    </li>
  </ul>


    <footer class="post-footer">
          

<div class="post-copyright">
<ul>
  <li class="post-copyright-author">
      <strong>本文作者： </strong>SoundMemories
  </li>
  <li class="post-copyright-link">
      <strong>本文链接：</strong>
      <a href="https://soundmemories.github.io/2019/04/03/MySQL/04.Java%E5%92%8C%E6%95%B0%E6%8D%AE%E5%BA%93/" title="Java和数据库">https://soundmemories.github.io/2019/04/03/MySQL/04.Java和数据库/</a>
  </li>
  <li class="post-copyright-license">
    <strong>版权声明： </strong>本博客所有文章除特别声明外，均采用 <span class="exturl" data-url="aHR0cHM6Ly9jcmVhdGl2ZWNvbW1vbnMub3JnL2xpY2Vuc2VzL2J5LW5jLXNhLzQuMC8="><i class="fab fa-fw fa-creative-commons"></i>BY-NC-SA</span> 许可协议。转载请注明出处！
  </li>
</ul>
</div>

          <div class="post-tags">
              <a href="/tags/MySQL/" rel="tag"><i class="fa fa-tag"></i> MySQL</a>
          </div>

        

          <div class="post-nav">
            <div class="post-nav-item">
                <a href="/2019/04/01/MySQL/03.Python%E5%92%8C%E6%95%B0%E6%8D%AE%E5%BA%93/" rel="prev" title="Python和数据库">
                  <i class="fa fa-chevron-left"></i> Python和数据库
                </a>
            </div>
            <div class="post-nav-item">
                <a href="/2020/01/20/Java/01.Java%E8%AF%AD%E8%A8%80%E7%AE%80%E4%BB%8B%E5%92%8C%E7%8E%AF%E5%A2%83%E6%90%AD%E5%BB%BA/" rel="next" title="Java语言简介和环境搭建">
                  Java语言简介和环境搭建 <i class="fa fa-chevron-right"></i>
                </a>
            </div>
          </div>
    </footer>
  </article>
</div>






      

<script>
  window.addEventListener('tabs:register', () => {
    let { activeClass } = CONFIG.comments;
    if (CONFIG.comments.storage) {
      activeClass = localStorage.getItem('comments_active') || activeClass;
    }
    if (activeClass) {
      const activeTab = document.querySelector(`a[href="#comment-${activeClass}"]`);
      if (activeTab) {
        activeTab.click();
      }
    }
  });
  if (CONFIG.comments.storage) {
    window.addEventListener('tabs:click', event => {
      if (!event.target.matches('.tabs-comment .tab-content .tab-pane')) return;
      const commentClass = event.target.classList[1];
      localStorage.setItem('comments_active', commentClass);
    });
  }
</script>

    </div>
  </main>

  <footer class="footer">
    <div class="footer-inner">
      

      

<div class="copyright">
  
  &copy; 2019 – 
  <span itemprop="copyrightYear">2022</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">SoundMemories</span>
</div>
  <div class="powered-by">由 <span class="exturl theme-link" data-url="aHR0cHM6Ly9oZXhvLmlv">Hexo</span> & <span class="exturl theme-link" data-url="aHR0cHM6Ly90aGVtZS1uZXh0LmpzLm9yZy9tdXNlLw==">NexT.Muse</span> 强力驱动
  </div>

    </div>
  </footer>

  
  <script src="//cdn.jsdelivr.net/npm/animejs@3.2.1/lib/anime.min.js"></script>
  <script src="//cdn.jsdelivr.net/npm/@next-theme/pjax@0.4.0/pjax.min.js"></script>
  <script src="//cdn.jsdelivr.net/npm/jquery@3.5.1/dist/jquery.min.js"></script>
  <script src="//cdn.jsdelivr.net/npm/@fancyapps/fancybox@3.5.7/dist/jquery.fancybox.min.js"></script>
  <script src="//cdn.jsdelivr.net/npm/medium-zoom@1.0.6/dist/medium-zoom.min.js"></script>
<script src="/js/utils.js"></script><script src="/js/motion.js"></script><script src="/js/schemes/muse.js"></script><script src="/js/next-boot.js"></script><script src="/js/bookmark.js"></script>
  <script>
var pjax = new Pjax({
  selectors: [
    'head title',
    '.page-configurations',
    '.main-inner',
    '.post-toc-wrap',
    '.languages',
    '.pjax'
  ],
  analytics: false,
  cacheBust: false,
  scrollRestoration: false,
  scrollTo: !CONFIG.bookmark.enable
});

document.addEventListener('pjax:success', () => {
  pjax.executeScripts(document.querySelectorAll('script[data-pjax], .pjax script'));
  NexT.boot.refresh();
  // Define Motion Sequence & Bootstrap Motion.
  if (CONFIG.motion.enable) {
    NexT.motion.integrator
      .init()
      .add(NexT.motion.middleWares.subMenu)
      .add(NexT.motion.middleWares.postList)
      .bootstrap();
  }
  const hasTOC = document.querySelector('.post-toc');
  document.querySelector('.sidebar-inner').classList.toggle('sidebar-nav-active', hasTOC);
  document.querySelector(hasTOC ? '.sidebar-nav-toc' : '.sidebar-nav-overview').click();
  NexT.utils.updateSidebarPosition();
});
</script>


  




  <script src="/js/local-search.js"></script>








<script data-pjax>
document.querySelectorAll('.pdfobject-container').forEach(element => {
  const url = element.dataset.target;
  const pdfOpenParams = {
    navpanes : 0,
    toolbar  : 0,
    statusbar: 0,
    pagemode : 'thumbs',
    view     : 'FitH'
  };
  const pdfOpenFragment = '#' + Object.entries(pdfOpenParams).map(([key, value]) => `${key}=${encodeURIComponent(value)}`).join('&');
  const fullURL = `/lib/pdf/web/viewer.html?file=${encodeURIComponent(url)}${pdfOpenFragment}`;

  if (NexT.utils.supportsPDFs()) {
    element.innerHTML = `<embed class="pdfobject" src="${url + pdfOpenFragment}" type="application/pdf" style="height: ${element.dataset.height};">`;
  } else {
    element.innerHTML = `<iframe src="${fullURL}" style="height: ${element.dataset.height};" frameborder="0"></iframe>`;
  }
});
</script>


<script data-pjax>
if (document.querySelectorAll('.mermaid').length) {
  NexT.utils.getScript('//cdn.jsdelivr.net/npm/mermaid@8.8.2/dist/mermaid.min.js', () => {
    mermaid.init({
      theme    : 'neutral',
      logLevel : 3,
      flowchart: { curve     : 'linear' },
      gantt    : { axisFormat: '%m/%d/%Y' },
      sequence : { actorMargin: 50 }
    }, '.mermaid');
  }, window.mermaid);
}
</script>





  








    <div class="pjax">
  

  
      <script>
  if (typeof MathJax === 'undefined') {
    window.MathJax = {
      tex: {
        inlineMath: {'[+]': [['$', '$']]},
        tags: 'ams'
      },
      options: {
        renderActions: {
          findScript: [10, doc => {
            document.querySelectorAll('script[type^="math/tex"]').forEach(node => {
              const display = !!node.type.match(/; *mode=display/);
              const math = new doc.options.MathItem(node.textContent, doc.inputJax[0], display);
              const text = document.createTextNode('');
              node.parentNode.replaceChild(text, node);
              math.start = {node: text, delim: '', n: 0};
              math.end = {node: text, delim: '', n: 0};
              doc.math.push(math);
            });
          }, '', false],
          insertedScript: [200, () => {
            document.querySelectorAll('mjx-container').forEach(node => {
              const target = node.parentNode;
              if (target.nodeName.toLowerCase() === 'li') {
                target.parentNode.classList.add('has-jax');
              }
            });
          }, '', false]
        }
      }
    };
    const script = document.createElement('script');
    script.src = '//cdn.jsdelivr.net/npm/mathjax@3.1.2/es5/tex-mml-chtml.js';
    script.defer = true;
    document.head.appendChild(script);
  } else {
    MathJax.startup.document.state(0);
    MathJax.typesetClear();
    MathJax.texReset();
    MathJax.typeset();
  }
</script>

    

  
  <script src="//cdn.jsdelivr.net/npm/quicklink@2.0.0/dist/quicklink.umd.js"></script>
  <script>
      window.addEventListener('load', () => {
      quicklink.listen({
        timeout : 3000,
        priority: true,
        ignores : [uri => uri.includes('#'),uri => uri === 'https://soundmemories.github.io/2019/04/03/MySQL/04.Java%E5%92%8C%E6%95%B0%E6%8D%AE%E5%BA%93/',]
      });
      });
  </script>

    </div>
</body>
</html>
