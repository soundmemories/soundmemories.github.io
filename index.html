<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width">
<meta name="theme-color" content="#222" media="(prefers-color-scheme: light)">
<meta name="theme-color" content="#222" media="(prefers-color-scheme: dark)"><meta name="generator" content="Hexo 6.3.0">

  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png">
  <link rel="mask-icon" href="/images/logo.svg" color="#222">

<link rel="stylesheet" href="/css/main.css">

<link rel="stylesheet" href="https://fonts.loli.net/css?family=Monda:300,300italic,400,400italic,700,700italic&display=swap&subset=latin,latin-ext">

<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" integrity="sha256-HtsXJanqjKTc8vVQjO4YMhiqFoXkfBsjBWcX91T1jr8=" crossorigin="anonymous">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/animate.css/3.1.1/animate.min.css" integrity="sha256-PR7ttpcvz8qrF57fur/yAx1qXMFJeJFiA6pSzWi0OIE=" crossorigin="anonymous">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/fancybox/3.5.7/jquery.fancybox.min.css" integrity="sha256-Vzbj7sDDS/woiFS3uNKo8eIuni59rjyNGtXfstRzStA=" crossorigin="anonymous">

<script class="next-config" data-name="main" type="application/json">{"hostname":"soundmemories.github.io","root":"/","images":"/images","scheme":"Muse","darkmode":true,"version":"8.17.1","exturl":true,"sidebar":{"position":"left","display":"always","padding":18,"offset":12},"copycode":{"enable":true,"style":null},"bookmark":{"enable":true,"color":"#222","save":"auto"},"mediumzoom":true,"lazyload":false,"pangu":false,"comments":{"style":"tabs","active":null,"storage":true,"lazyload":false,"nav":null},"stickytabs":false,"motion":{"enable":true,"async":false,"transition":{"menu_item":"fadeInDown","post_block":"fadeIn","post_header":"fadeInDown","post_body":"fadeInDown","coll_header":"fadeInLeft","sidebar":"fadeInUp"}},"prism":false,"i18n":{"placeholder":"搜索...","empty":"没有找到任何搜索结果：${query}","hits_time":"找到 ${hits} 个搜索结果（用时 ${time} 毫秒）","hits":"找到 ${hits} 个搜索结果"},"path":"/search.xml","localsearch":{"enable":true,"trigger":"auto","top_n_per_article":1,"unescape":false,"preload":false}}</script><script src="/js/config.js"></script>

    <meta name="description" content="今日事，今日毕">
<meta property="og:type" content="website">
<meta property="og:title" content="SoundMemories">
<meta property="og:url" content="https://soundmemories.github.io/index.html">
<meta property="og:site_name" content="SoundMemories">
<meta property="og:description" content="今日事，今日毕">
<meta property="og:locale" content="zh_CN">
<meta property="article:author" content="SoundMemories">
<meta name="twitter:card" content="summary">


<link rel="canonical" href="https://soundmemories.github.io/">



<script class="next-config" data-name="page" type="application/json">{"sidebar":"","isHome":true,"isPost":false,"lang":"zh-CN","comments":"","permalink":"","path":"index.html","title":""}</script>

<script class="next-config" data-name="calendar" type="application/json">""</script>
<title>SoundMemories</title>
  








  <noscript>
    <link rel="stylesheet" href="/css/noscript.css">
  </noscript>
</head>

<body itemscope itemtype="http://schema.org/WebPage" class="use-motion">
  <div class="headband"></div>

  <main class="main">
    <div class="column">
      <header class="header" itemscope itemtype="http://schema.org/WPHeader"><div class="site-brand-container">
  <div class="site-nav-toggle">
    <div class="toggle" aria-label="切换导航栏" role="button">
        <span class="toggle-line"></span>
        <span class="toggle-line"></span>
        <span class="toggle-line"></span>
    </div>
  </div>

  <div class="site-meta">

    <a href="/" class="brand" rel="start">
      <i class="logo-line"></i>
      <h1 class="site-title">SoundMemories</h1>
      <i class="logo-line"></i>
    </a>
  </div>

  <div class="site-nav-right">
    <div class="toggle popup-trigger" aria-label="搜索" role="button">
        <i class="fa fa-search fa-fw fa-lg"></i>
    </div>
  </div>
</div>



<nav class="site-nav">
  <ul class="main-menu menu"><li class="menu-item menu-item-home"><a href="/" rel="section"><i class="fa fa-home fa-fw"></i>首页</a></li><li class="menu-item menu-item-tags"><a href="/tags/" rel="section"><i class="fa fa-tags fa-fw"></i>标签<span class="badge">10</span></a></li><li class="menu-item menu-item-categories"><a href="/categories/" rel="section"><i class="fa fa-th fa-fw"></i>分类<span class="badge">10</span></a></li><li class="menu-item menu-item-archives"><a href="/archives/" rel="section"><i class="fa fa-archive fa-fw"></i>归档<span class="badge">126</span></a></li>
      <li class="menu-item menu-item-search">
        <a role="button" class="popup-trigger"><i class="fa fa-search fa-fw"></i>搜索
        </a>
      </li>
  </ul>
</nav>



  <div class="search-pop-overlay">
    <div class="popup search-popup"><div class="search-header">
  <span class="search-icon">
    <i class="fa fa-search"></i>
  </span>
  <div class="search-input-container">
    <input autocomplete="off" autocapitalize="off" maxlength="80"
           placeholder="搜索..." spellcheck="false"
           type="search" class="search-input">
  </div>
  <span class="popup-btn-close" role="button">
    <i class="fa fa-times-circle"></i>
  </span>
</div>
<div class="search-result-container no-result">
  <div class="search-result-icon">
    <i class="fa fa-spinner fa-pulse fa-5x"></i>
  </div>
</div>

    </div>
  </div>

</header>
        
  
  <aside class="sidebar">

    <div class="sidebar-inner sidebar-overview-active">
      <ul class="sidebar-nav">
        <li class="sidebar-nav-toc">
          文章目录
        </li>
        <li class="sidebar-nav-overview">
          站点概览
        </li>
      </ul>

      <div class="sidebar-panel-container">
        <!--noindex-->
        <div class="post-toc-wrap sidebar-panel">
        </div>
        <!--/noindex-->

        <div class="site-overview-wrap sidebar-panel">
          <div class="site-author animated" itemprop="author" itemscope itemtype="http://schema.org/Person">
    <img class="site-author-image" itemprop="image" alt="SoundMemories"
      src="/images/avstar.png">
  <p class="site-author-name" itemprop="name">SoundMemories</p>
  <div class="site-description" itemprop="description">今日事，今日毕</div>
</div>
<div class="site-state-wrap animated">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
        <a href="/archives/">
          <span class="site-state-item-count">126</span>
          <span class="site-state-item-name">日志</span>
        </a>
      </div>
      <div class="site-state-item site-state-categories">
          <a href="/categories/">
        <span class="site-state-item-count">10</span>
        <span class="site-state-item-name">分类</span></a>
      </div>
      <div class="site-state-item site-state-tags">
          <a href="/tags/">
        <span class="site-state-item-count">10</span>
        <span class="site-state-item-name">标签</span></a>
      </div>
  </nav>
</div>
  <div class="links-of-author animated">
      <span class="links-of-author-item">
        <span class="exturl" data-url="aHR0cHM6Ly9naXRodWIuY29tL3NvdW5kbWVtb3JpZXM=" title="GitHub → https:&#x2F;&#x2F;github.com&#x2F;soundmemories"><i class="fab fa-github fa-fw"></i>GitHub</span>
      </span>
      <span class="links-of-author-item">
        <span class="exturl" data-url="bWFpbHRvOnNvdW5kbWVtb3JpZXNAMTYzLmNvbQ==" title="E-Mail → mailto:soundmemories@163.com"><i class="fa fa-envelope fa-fw"></i>E-Mail</span>
      </span>
  </div>
  <div class="cc-license animated" itemprop="license">
    <span class="exturl cc-opacity" data-url="aHR0cHM6Ly9jcmVhdGl2ZWNvbW1vbnMub3JnL2xpY2Vuc2VzL2J5LW5jLXNhLzQuMC8="><img src="https://cdnjs.cloudflare.com/ajax/libs/creativecommons-vocabulary/2020.11.3/assets/license_badges/small/by_nc_sa.svg" alt="Creative Commons"></span>
  </div>

        </div>
      </div>
    </div>

    
        <div class="pjax">
        </div>
  </aside>


    </div>

    <div class="main-inner index posts-expand">

    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="https://soundmemories.github.io/2024/11/05/Python/24.Django5+Vue3%E4%BE%8B%E5%AD%90/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avstar.png">
      <meta itemprop="name" content="SoundMemories">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="SoundMemories">
      <meta itemprop="description" content="今日事，今日毕">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | SoundMemories">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2024/11/05/Python/24.Django5+Vue3%E4%BE%8B%E5%AD%90/" class="post-title-link" itemprop="url">Django5+Vue3例子</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>

      <time title="创建时间：2024-11-05 00:00:00" itemprop="dateCreated datePublished" datetime="2024-11-05T00:00:00+08:00">2024-11-05</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">分类于</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/Python/" itemprop="url" rel="index"><span itemprop="name">Python</span></a>
        </span>
    </span>

  
    <span class="post-meta-break"></span>
    <span class="post-meta-item" title="本文字数">
      <span class="post-meta-item-icon">
        <i class="far fa-file-word"></i>
      </span>
      <span class="post-meta-item-text">本文字数：</span>
      <span>9.1k</span>
    </span>
    <span class="post-meta-item" title="阅读时长">
      <span class="post-meta-item-icon">
        <i class="far fa-clock"></i>
      </span>
      <span class="post-meta-item-text">阅读时长 &asymp;</span>
      <span>33 分钟</span>
    </span>
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <h1 id="django5">Django5</h1>
<h2 id="初始化">初始化</h2>
<p>1.安装django等库：<br />
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">建议使用conda虚拟环境安装</span></span><br><span class="line">pip install django</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">不安装使用mysql会报错</span></span><br><span class="line">pip install mysqlclient</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">用于连接mysql时规避ssl报错</span></span><br><span class="line">pip install pymysql</span><br></pre></td></tr></table></figure></p>
<p>2.创建项目：<br />
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">django-admin startproject [project_name]</span><br></pre></td></tr></table></figure></p>
<p>3.创建模块：<br />
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 项目创建后，需要进入项目文件夹下执行</span></span><br><span class="line">python manage.py startapp [module_name]</span><br><span class="line"><span class="comment"># 本例创建user、role、menu三个模块</span></span><br><span class="line"><span class="comment"># 在每个模块下手动创建urls.py文件，子路由。</span></span><br><span class="line"><span class="comment"># 子路由中要先写空</span></span><br></pre></td></tr></table></figure></p>
<p>4.1将子路由，加入到主路由中：<br />
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 主路由的urls.py中，添加子路由</span></span><br><span class="line">urlpatterns = [</span><br><span class="line">    path(<span class="string">&quot;user/&quot;</span>, include(<span class="string">&quot;user.urls&quot;</span>)),</span><br><span class="line">    path(<span class="string">&quot;role/&quot;</span>, include(<span class="string">&quot;role.urls&quot;</span>)),</span><br><span class="line">    path(<span class="string">&quot;menu/&quot;</span>, include(<span class="string">&quot;menu.urls&quot;</span>)),</span><br><span class="line">]</span><br></pre></td></tr></table></figure></p>
<p>4.2将模块加入到配置中：<br />
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 在项目目录下，settings.py中找到INSTALLED_APPS，添加模块</span></span><br><span class="line">INSTALLED_APPS = [</span><br><span class="line">    <span class="string">&quot;user.apps.UserConfig&quot;</span>,</span><br><span class="line">    <span class="string">&quot;role.apps.RoleConfig&quot;</span>,</span><br><span class="line">    <span class="string">&quot;menu.apps.MenuConfig&quot;</span></span><br><span class="line">]</span><br></pre></td></tr></table></figure></p>
<p>4.3配置数据库：<br />
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 在项目目录下，settings.py中找到DATABASES，配置为mysql</span></span><br><span class="line">DATABASES = &#123;</span><br><span class="line">    <span class="string">&quot;default&quot;</span>: &#123;</span><br><span class="line">        <span class="string">&quot;ENGINE&quot;</span>: <span class="string">&quot;django.db.backends.mysql&quot;</span>,</span><br><span class="line">        <span class="string">&quot;NAME&quot;</span>: <span class="string">&quot;django&quot;</span>, <span class="comment"># 数据库名称</span></span><br><span class="line">        <span class="string">&quot;USER&quot;</span>: <span class="string">&quot;root&quot;</span>,</span><br><span class="line">        <span class="string">&quot;PASSWORD&quot;</span>: <span class="string">&quot;root&quot;</span>,</span><br><span class="line">        <span class="string">&quot;HOST&quot;</span>: <span class="string">&quot;192.168.137.36&quot;</span>,</span><br><span class="line">        <span class="string">&quot;PORT&quot;</span>: <span class="string">&quot;3306&quot;</span>,</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<h2 id="数据模型">数据模型</h2>
<p>1.打开user模块的models.py，创建实体类：<br />
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> django.db <span class="keyword">import</span> models</span><br><span class="line"></span><br><span class="line"><span class="comment"># Create your models here.</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">SysUser</span>(models.Model):</span><br><span class="line">    <span class="built_in">id</span> = models.AutoField(primary_key=<span class="literal">True</span>)</span><br><span class="line">    username = models.CharField(max_length=<span class="number">100</span>, unique=<span class="literal">True</span>, verbose_name=<span class="string">&quot;用户名&quot;</span>)</span><br><span class="line">    password = models.CharField(max_length=<span class="number">100</span>, verbose_name=<span class="string">&quot;密码&quot;</span>)</span><br><span class="line">    avatar = models.CharField(max_length=<span class="number">255</span>, null=<span class="literal">True</span>, verbose_name=<span class="string">&quot;用户头像&quot;</span>)</span><br><span class="line">    email = models.CharField(max_length=<span class="number">100</span>, null=<span class="literal">True</span>, verbose_name=<span class="string">&quot;用户邮箱&quot;</span>)</span><br><span class="line">    phonenumber = models.CharField(max_length=<span class="number">11</span>, null=<span class="literal">True</span>, verbose_name=<span class="string">&quot;手机号码&quot;</span>)</span><br><span class="line">    login_date = models.DateField(null=<span class="literal">True</span>, verbose_name=<span class="string">&quot;最后登录时间&quot;</span>)</span><br><span class="line">    status = models.IntegerField(null=<span class="literal">True</span>, verbose_name=<span class="string">&quot;帐号状态（0正常 1停用）&quot;</span>)</span><br><span class="line">    create_time = models.DateField(null=<span class="literal">True</span>, verbose_name=<span class="string">&quot;创建时间&quot;</span>)</span><br><span class="line">    update_time = models.DateField(null=<span class="literal">True</span>, verbose_name=<span class="string">&quot;更新时间&quot;</span>)</span><br><span class="line">    remark = models.CharField(max_length=<span class="number">500</span>, null=<span class="literal">True</span>, verbose_name=<span class="string">&quot;备注&quot;</span>)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">class</span> <span class="title class_">Meta</span>: <span class="comment"># 元数据</span></span><br><span class="line">        db_table = <span class="string">&quot;sys_user&quot;</span> <span class="comment"># 定义数据库中表名，不写默认为&quot;app名_实体类名&quot;</span></span><br></pre></td></tr></table></figure></p>
<p>2.使用python创建的实体类，反向创建数据库表：<br />
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 示例这里[module_name]为user, 成功后出现user/migrations/0001_initial.py文件</span></span><br><span class="line"><span class="comment"># 生成指定module的迁移文件（不指定会生成全部module的）</span></span><br><span class="line">python manage.py makemigrations [module_name]</span><br><span class="line"><span class="comment"># 执行指定module的迁移文件，创建数据库表（不指定会生成全部module的）</span></span><br><span class="line">python manage.py migrate [module_name]</span><br></pre></td></tr></table></figure></p>
<p>使用时遇到ssl问题，安装pymysql，并在settings.py中添加：<br />
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> pymysql</span><br><span class="line">pymysql.install_as_MySQLdb()</span><br></pre></td></tr></table></figure></p>
<p>3.为了后续使用，在数据库表中插入几条数据：<br />
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">USE django; <span class="comment">-- 选择数据库</span></span><br><span class="line"><span class="keyword">insert</span> <span class="keyword">into</span> `sys_user` (`id`, `username`, `password`, `avatar`, `email`, `phonenumber`, `login_date`, `status`, `create_time`, `update_time`, `remark`) <span class="keyword">values</span>(<span class="string">&#x27;1&#x27;</span>,<span class="string">&#x27;python222&#x27;</span>,<span class="string">&#x27;123456&#x27;</span>,<span class="string">&#x27;20240906202303.jpg&#x27;</span>,<span class="string">&#x27;caofeng2014@126.com&#x27;</span>,<span class="string">&#x27;18862857104&#x27;</span>,<span class="string">&#x27;2024-08-08&#x27;</span>,<span class="string">&#x27;1&#x27;</span>,<span class="string">&#x27;2024-08-08&#x27;</span>,<span class="string">&#x27;2024-08-08&#x27;</span>,<span class="string">&#x27;超级管理员&#x27;</span>);</span><br><span class="line"><span class="keyword">insert</span> <span class="keyword">into</span> `sys_user` (`id`, `username`, `password`, `avatar`, `email`,`phonenumber`, `login_date`, `status`, `create_time`, `update_time`, `remark`) <span class="keyword">values</span>(<span class="string">&#x27;3&#x27;</span>,<span class="string">&#x27;1&#x27;</span>,<span class="string">&#x27;123456&#x27;</span>,<span class="string">&#x27;20240808230603.jpg&#x27;</span>,<span class="string">&#x27;caofeng2014@126.com&#x27;</span>,<span class="string">&#x27;18862857104&#x27;</span>,<span class="string">&#x27;2024-08-08&#x27;</span>,<span class="string">&#x27;0&#x27;</span>,<span class="string">&#x27;2024-08-08&#x27;</span>,<span class="string">&#x27;2024-08-14&#x27;</span>,<span class="string">&#x27;测试用户&#x27;</span>);</span><br><span class="line"><span class="keyword">insert</span> <span class="keyword">into</span> `sys_user` (`id`, `username`, `password`, `avatar`, `email`,`phonenumber`, `login_date`, `status`, `create_time`, `update_time`, `remark`) <span class="keyword">values</span>(<span class="string">&#x27;6&#x27;</span>,<span class="string">&#x27;4&#x27;</span>,<span class="string">&#x27;123456&#x27;</span>,<span class="string">&#x27;20240808230603.jpg&#x27;</span>,<span class="keyword">NULL</span>,<span class="keyword">NULL</span>,<span class="keyword">NULL</span>,<span class="string">&#x27;1&#x27;</span>,<span class="keyword">NULL</span>,<span class="keyword">NULL</span>,<span class="keyword">NULL</span>);</span><br><span class="line"><span class="keyword">insert</span> <span class="keyword">into</span> `sys_user` (`id`, `username`, `password`, `avatar`, `email`,`phonenumber`, `login_date`, `status`, `create_time`, `update_time`, `remark`) <span class="keyword">values</span>(<span class="string">&#x27;7&#x27;</span>,<span class="string">&#x27;5&#x27;</span>,<span class="string">&#x27;123456&#x27;</span>,<span class="string">&#x27;20240808230603.jpg&#x27;</span>,<span class="keyword">NULL</span>,<span class="keyword">NULL</span>,<span class="keyword">NULL</span>,<span class="string">&#x27;1&#x27;</span>,<span class="keyword">NULL</span>,<span class="keyword">NULL</span>,<span class="keyword">NULL</span>);</span><br><span class="line"><span class="keyword">insert</span> <span class="keyword">into</span> `sys_user` (`id`, `username`, `password`, `avatar`, `email`,`phonenumber`, `login_date`, `status`, `create_time`, `update_time`, `remark`) <span class="keyword">values</span>(<span class="string">&#x27;8&#x27;</span>,<span class="string">&#x27;6&#x27;</span>,<span class="string">&#x27;123456&#x27;</span>,<span class="string">&#x27;20240808230603.jpg&#x27;</span>,<span class="keyword">NULL</span>,<span class="keyword">NULL</span>,<span class="keyword">NULL</span>,<span class="string">&#x27;0&#x27;</span>,<span class="keyword">NULL</span>,<span class="keyword">NULL</span>,<span class="keyword">NULL</span>);</span><br><span class="line"><span class="keyword">insert</span> <span class="keyword">into</span> `sys_user` (`id`, `username`, `password`, `avatar`, `email`, `phonenumber`, `login_date`, `status`, `create_time`, `update_time`, `remark`) <span class="keyword">values</span>(<span class="string">&#x27;11&#x27;</span>,<span class="string">&#x27;9&#x27;</span>,<span class="string">&#x27;123456&#x27;</span>,<span class="string">&#x27;20240808230603.jpg&#x27;</span>,<span class="keyword">NULL</span>,<span class="keyword">NULL</span>,<span class="keyword">NULL</span>,<span class="string">&#x27;1&#x27;</span>,<span class="keyword">NULL</span>,<span class="keyword">NULL</span>,<span class="keyword">NULL</span>);</span><br><span class="line"><span class="keyword">insert</span> <span class="keyword">into</span> `sys_user` (`id`, `username`, `password`, `avatar`, `email`,`phonenumber`, `login_date`, `status`, `create_time`, `update_time`, `remark`) <span class="keyword">values</span>(<span class="string">&#x27;14&#x27;</span>,<span class="string">&#x27;666&#x27;</span>,<span class="string">&#x27;123456&#x27;</span>,<span class="string">&#x27;default.jpg&#x27;</span>,<span class="string">&#x27;caofeng2014@126.com&#x27;</span>,<span class="string">&#x27;18862857104&#x27;</span>,<span class="keyword">NULL</span>,<span class="string">&#x27;1&#x27;</span>,<span class="string">&#x27;2024-08-13&#x27;</span>,<span class="keyword">NULL</span>,<span class="string">&#x27;33&#x27;</span>);</span><br><span class="line"><span class="keyword">insert</span> <span class="keyword">into</span> `sys_user` (`id`, `username`, `password`, `avatar`, `email`,`phonenumber`, `login_date`, `status`, `create_time`, `update_time`, `remark`) <span class="keyword">values</span>(<span class="string">&#x27;15&#x27;</span>,<span class="string">&#x27;jack&#x27;</span>,<span class="string">&#x27;123456&#x27;</span>,<span class="string">&#x27;default.jpg&#x27;</span>,<span class="string">&#x27;caofeng2014@126.com&#x27;</span>,<span class="string">&#x27;18862857104&#x27;</span>,<span class="keyword">NULL</span>,<span class="string">&#x27;1&#x27;</span>,<span class="string">&#x27;2024-08-13&#x27;</span>,<span class="string">&#x27;2024-09-06&#x27;</span>,<span class="string">&#x27;禁用用户测试4&#x27;</span>);</span><br><span class="line"><span class="keyword">insert</span> <span class="keyword">into</span> `sys_user` (`id`, `username`, `password`, `avatar`, `email`,`phonenumber`, `login_date`, `status`, `create_time`, `update_time`, `remark`) <span class="keyword">values</span>(<span class="string">&#x27;16&#x27;</span>,<span class="string">&#x27;12323232&#x27;</span>,<span class="string">&#x27;123456&#x27;</span>,<span class="string">&#x27;default.jpg&#x27;</span>,<span class="string">&#x27;1@126.com&#x27;</span>,<span class="string">&#x27;18862857104&#x27;</span>,<span class="keyword">NULL</span>,<span class="string">&#x27;1&#x27;</span>,<span class="string">&#x27;2024-08-18&#x27;</span>,<span class="string">&#x27;2024-08-18&#x27;</span>,<span class="string">&#x27;115&#x27;</span>);</span><br><span class="line"><span class="keyword">insert</span> <span class="keyword">into</span> `sys_user` (`id`, `username`, `password`, `avatar`, `email`,`phonenumber`, `login_date`, `status`, `create_time`, `update_time`, `remark`) <span class="keyword">values</span>(<span class="string">&#x27;17&#x27;</span>,<span class="string">&#x27;marry&#x27;</span>,<span class="string">&#x27;123456&#x27;</span>,<span class="string">&#x27;default.jpg&#x27;</span>,<span class="string">&#x27;111@qq.com&#x27;</span>,<span class="string">&#x27;15586521012&#x27;</span>,<span class="keyword">NULL</span>,<span class="string">&#x27;1&#x27;</span>,<span class="string">&#x27;2024-09-05&#x27;</span>,<span class="keyword">NULL</span>,<span class="string">&#x27;555&#x27;</span>);</span><br></pre></td></tr></table></figure></p>
<h2 id="接口开发">接口开发</h2>
<p>1.尽可能使用Restful规范：<br />
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">get：/api/user/test <span class="comment"># 测试</span></span><br><span class="line">get：/api/user/users <span class="comment"># 获取用户列表</span></span><br><span class="line">post：/api/user/users <span class="comment"># 新增用户</span></span><br><span class="line">get：/api/user/users/&#123;<span class="built_in">id</span>&#125; <span class="comment"># 获取用户信息</span></span><br><span class="line">put：/api/user/users/&#123;<span class="built_in">id</span>&#125; <span class="comment"># 更新用户</span></span><br><span class="line">delete：/api/user/users/&#123;<span class="built_in">id</span>&#125; <span class="comment"># 删除用户</span></span><br></pre></td></tr></table></figure></p>
<p>2.创建视图，在 user/views.py 中添加：<br />
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> django.http <span class="keyword">import</span> JsonResponse</span><br><span class="line"><span class="keyword">from</span> django.shortcuts <span class="keyword">import</span> render</span><br><span class="line"><span class="keyword">from</span> django.views <span class="keyword">import</span> View</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">TestView</span>(<span class="title class_ inherited__">View</span>):</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">get</span>(<span class="params">self, request</span>):</span><br><span class="line">        <span class="keyword">return</span> JsonResponse(&#123;<span class="string">&#x27;code&#x27;</span>: <span class="number">200</span>, <span class="string">&#x27;info&#x27;</span>: <span class="string">&#x27;测试！&#x27;</span>&#125;)</span><br></pre></td></tr></table></figure></p>
<p>3.创建路由映射，在 user/urls.py 中添加：<br />
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> django.urls <span class="keyword">import</span> path</span><br><span class="line"><span class="keyword">from</span> user.views <span class="keyword">import</span> TestView</span><br><span class="line"></span><br><span class="line">urlpatterns = [</span><br><span class="line">    path(<span class="string">&#x27;test&#x27;</span>, TestView.as_view(), name=<span class="string">&#x27;test&#x27;</span>), <span class="comment"># 测试</span></span><br><span class="line">]</span><br></pre></td></tr></table></figure></p>
<p>4.启动项目，访问测试接口 http://127.0.0.1:8000/api/user/test：<br />
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 默认地址为127.0.0.1，端口为8000</span></span><br><span class="line">python manage.py runserver <span class="number">0.0</span><span class="number">.0</span><span class="number">.0</span>:<span class="number">8000</span></span><br></pre></td></tr></table></figure></p>
<p>5.测试接口中，增加数据库数据查询，修改 user/views.py：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> django.http <span class="keyword">import</span> JsonResponse</span><br><span class="line"><span class="keyword">from</span> django.shortcuts <span class="keyword">import</span> render</span><br><span class="line"><span class="keyword">from</span> django.views <span class="keyword">import</span> View</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">TestView</span>(<span class="title class_ inherited__">View</span>):</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">get</span>(<span class="params">self, request</span>):</span><br><span class="line">        userList_obj = SysUser.objects.<span class="built_in">all</span>() <span class="comment"># 返回的是QuerySet对象(外部容器)，对象中每一个元素是object(容器内部元素)</span></span><br><span class="line">        <span class="built_in">print</span>(userList_obj, <span class="built_in">type</span>(userList_obj))  <span class="comment"># &lt;QuerySet [&lt;SysUser: SysUser object (1)&gt;,...], &lt;class &#x27;django.db.models.query.QuerySet&#x27;&gt;</span></span><br><span class="line">        userList_dict = userList_obj.values() <span class="comment"># 返回的是QuerySet对象(外部容器)，对象中每一个元素是dict(容器内部元素)</span></span><br><span class="line">        <span class="built_in">print</span>(userList_dict,<span class="built_in">type</span>(userList_dict)) <span class="comment"># &lt;QuerySet [&#123;&#x27;id&#x27;: 1, &#x27;username&#x27;:&#x27;python222&#x27;,...&#125;,...], &lt;class &#x27;django.db.models.query.QuerySet&#x27;&gt;</span></span><br><span class="line">        userList = <span class="built_in">list</span>(userList_dict) <span class="comment"># 返回的是List对象(外部容器)，对象中每一个元素是dict(容器内部元素)</span></span><br><span class="line">        <span class="built_in">print</span>(userList, <span class="built_in">type</span>(userList)) <span class="comment"># [&#123;&#x27;id&#x27;: 1, &#x27;username&#x27;: &#x27;python222&#x27;,...&#125;,...], &lt;class &#x27;list&#x27;&gt;</span></span><br><span class="line">        <span class="keyword">return</span> JsonResponse(&#123;<span class="string">&#x27;code&#x27;</span>: <span class="number">200</span>, <span class="string">&#x27;info&#x27;</span>: userList&#125;) <span class="comment"># django只能返回可序列化的类型数据(QuerySet对象不能被序列化)</span></span><br></pre></td></tr></table></figure>
<h2 id="jwt认证">jwt认证</h2>
<p>Json web token (JWT),
是为了在网络应用环境间传递声明而执行的一种基于JSON的开放标准（(RFC7519)；<br />
JWT就是一段字符串，用来进行用户身份认证的凭证，该字符串分成三段【头部、载荷、签证】。<br />
<img src="/images/Python/JWT.png" width="70%"></p>
<p>DRF（Django Rest
Framework）是基于流行的Web框架Django构建的一个轻量级REST框架，旨在简化复杂的数据访问API的开发过程。如果你已经熟悉Django框架，那么学习DRF将会非常直接，因为它使用了很多Django中已有的概念，并添加了额外的功能来支持RESTful
API的设计。<br />
DRF使用的好处：支持RESTful风格服务端接口。内建了序列化功能，模型转json，json转模型都都不用手写了。</p>
<p>1.在DRF框架基础上使用JWT认证，需要安装这两个库：<br />
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># DRF</span></span><br><span class="line">pip install djangorestframework</span><br><span class="line"><span class="comment"># jwt</span></span><br><span class="line">pip install djangorestframework-jwt</span><br></pre></td></tr></table></figure></p>
<p>2.在 settings.py里 INSTALLED_APPS 中添加这两个库：<br />
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">INSTALLED_APPS = [</span><br><span class="line">    <span class="string">&quot;django.contrib.admin&quot;</span>,</span><br><span class="line">    <span class="string">&quot;django.contrib.auth&quot;</span>,</span><br><span class="line">    <span class="string">&quot;django.contrib.contenttypes&quot;</span>,</span><br><span class="line">    <span class="string">&quot;django.contrib.sessions&quot;</span>,</span><br><span class="line">    <span class="string">&quot;django.contrib.messages&quot;</span>,</span><br><span class="line">    <span class="string">&quot;django.contrib.staticfiles&quot;</span>,</span><br><span class="line">    <span class="string">&#x27;rest_framework&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;rest_framework_jwt&#x27;</span>,</span><br><span class="line">    <span class="string">&quot;user.apps.UserConfig&quot;</span>, <span class="comment"># 新增</span></span><br><span class="line">    <span class="string">&quot;role.apps.RoleConfig&quot;</span>, <span class="comment"># 新增</span></span><br><span class="line">    <span class="string">&quot;menu.apps.MenuConfig&quot;</span>  <span class="comment"># 新增</span></span><br><span class="line">]</span><br></pre></td></tr></table></figure></p>
<p>3.1在 user/views.py
中添加一个测试api，进行模拟登录，返回token：<br />
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> rest_framework_jwt.settings <span class="keyword">import</span> api_settings</span><br><span class="line"></span><br><span class="line"><span class="comment"># 测试jwt</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">JwtTestView</span>(<span class="title class_ inherited__">View</span>):</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">get</span>(<span class="params">self, request</span>):</span><br><span class="line">        user = SysUser.objects.get(username=<span class="string">&#x27;python222&#x27;</span>, password=<span class="string">&#x27;123456&#x27;</span>)</span><br><span class="line">        jwt_payload_handler = api_settings.JWT_PAYLOAD_HANDLER <span class="comment"># 小写快捷键ctrl+shift+U</span></span><br><span class="line">        jwt_encode_handler = api_settings.JWT_ENCODE_HANDLER</span><br><span class="line">        <span class="comment"># 将用户对象传递进去，获取到该对象的属性值</span></span><br><span class="line">        payload = jwt_payload_handler(user)</span><br><span class="line">        <span class="comment"># 将属性值编码成jwt格式的字符串</span></span><br><span class="line">        token = jwt_encode_handler(payload)</span><br><span class="line">        <span class="keyword">return</span> JsonResponse(&#123;<span class="string">&#x27;code&#x27;</span>: <span class="number">200</span>, <span class="string">&#x27;token&#x27;</span>: token&#125;)</span><br></pre></td></tr></table></figure></p>
<p>3.2在 user/urls.py 中添加路由映射：<br />
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> user.views <span class="keyword">import</span> TestView, JwtTestView</span><br><span class="line"></span><br><span class="line">urlpatterns = [</span><br><span class="line">    path(<span class="string">&#x27;test&#x27;</span>, TestView.as_view(), name=<span class="string">&#x27;test&#x27;</span>), <span class="comment"># 测试数据库读取</span></span><br><span class="line">    path(<span class="string">&#x27;jwt_test&#x27;</span>, JwtTestView.as_view(), name=<span class="string">&#x27;jwt_test&#x27;</span>), <span class="comment"># jwt</span></span><br><span class="line">]</span><br></pre></td></tr></table></figure></p>
<p>之后启动Django，测试user/jwt_test接口，会返回token。</p>
<p>3.3进一步，修改TestView数据查询接口，要求有token才可以访问：<br />
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">TestView</span>(<span class="title class_ inherited__">View</span>):</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">get</span>(<span class="params">self, request</span>):</span><br><span class="line">        token = request.META.get(<span class="string">&#x27;HTTP_AUTHORIZATION&#x27;</span>) <span class="comment"># 注意，django默认在头前面加上&quot;HTTP_&quot;</span></span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;token:&quot;</span>, token)</span><br><span class="line">        <span class="keyword">if</span> token != <span class="literal">None</span> <span class="keyword">and</span> token != <span class="string">&#x27;&#x27;</span>:</span><br><span class="line">            userList_obj = SysUser.objects.<span class="built_in">all</span>() </span><br><span class="line">            userList_dict = userList_obj.values() </span><br><span class="line">            userList = <span class="built_in">list</span>(userList_dict) </span><br><span class="line">            <span class="keyword">return</span> JsonResponse(&#123;<span class="string">&#x27;code&#x27;</span>: <span class="number">200</span>, <span class="string">&#x27;info&#x27;</span>: userList&#125;,</span><br><span class="line">                                json_dumps_params=&#123;<span class="string">&#x27;ensure_ascii&#x27;</span>: <span class="literal">False</span>&#125;)</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            <span class="comment"># &#x27;ensure_ascii&#x27;: False  设置json编码参数，确保中文字符不会被转译</span></span><br><span class="line">            <span class="keyword">return</span> JsonResponse(&#123;<span class="string">&#x27;code&#x27;</span>: <span class="number">401</span>, <span class="string">&#x27;info&#x27;</span>: <span class="string">&#x27;没有访问权限！&#x27;</span>&#125;, </span><br><span class="line">                                json_dumps_params=&#123;<span class="string">&#x27;ensure_ascii&#x27;</span>: <span class="literal">False</span>&#125;)</span><br></pre></td></tr></table></figure></p>
<p>4.1前后端是分离项目，两个项目的地址是在不同域中，要在后端配置跨域访问。<br />
在Django中，有人开发了cors-header的middleware只需在settings.py中做一些简单的配置即可，首先安装库：<br />
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 安装django-cors-headers库</span></span><br><span class="line">pip install django-cors-headers</span><br></pre></td></tr></table></figure></p>
<p>4.2配置cors：<br />
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># setting.py中新增如下：</span></span><br><span class="line">INSTALLED_APPS = [</span><br><span class="line">    ... ,</span><br><span class="line">    <span class="string">&quot;corsheaders&quot;</span> ,</span><br><span class="line">    ... ,</span><br><span class="line">    ]</span><br><span class="line"><span class="comment"># CorsMiddleware需要放在第一位，不放在第一位，可能会造成某些请求没有添加CORS</span></span><br><span class="line">MIDDLEWARE = [</span><br><span class="line">    <span class="string">&quot;corsheaders.middleware.CorsMiddleware&quot;</span>,</span><br><span class="line">    ... ,</span><br><span class="line">    ]</span><br><span class="line"><span class="comment"># 设置访问白名单，指定所有域名(ip)都可以访问后端接口, 默认为False</span></span><br><span class="line">CORS_ORIGIN_ALLOW_ALL = <span class="literal">True</span></span><br><span class="line"><span class="comment"># 设置允许携带cookie</span></span><br><span class="line">CORS_ALLOW_CREDENTIALS = <span class="literal">True</span></span><br><span class="line"><span class="comment"># 设置默认允许请求头方法</span></span><br><span class="line">CORS_ALLOW_METHODS = [</span><br><span class="line">    <span class="string">&#x27;GET&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;POST&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;PUT&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;PATCH&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;DELETE&#x27;</span>,</span><br><span class="line">    ]</span><br></pre></td></tr></table></figure></p>
<h2 id="登录页面">登录页面</h2>
<h3 id="登录接口">登录接口</h3>
<p>1.在 user/views.py 中添加登录接口：<br />
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">LoginView</span>(<span class="title class_ inherited__">View</span>):</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">post</span>(<span class="params">self, request</span>):</span><br><span class="line">        suername = request.GET.get(<span class="string">&#x27;username&#x27;</span>)</span><br><span class="line">        password = request.GET.get(<span class="string">&#x27;password&#x27;</span>)</span><br><span class="line">        <span class="keyword">try</span>:</span><br><span class="line">            user = SysUser.objects.get(username=suername, password=password)</span><br><span class="line">            jwt_payload_handler = api_settings.JWT_PAYLOAD_HANDLER</span><br><span class="line">            jwt_encode_handler = api_settings.JWT_ENCODE_HANDLER</span><br><span class="line">            <span class="comment"># 将用户对象传递进去，获取到该对象的属性值</span></span><br><span class="line">            payload = jwt_payload_handler(user)</span><br><span class="line">            <span class="comment"># 将属性值编码成jwt格式的字符串</span></span><br><span class="line">            token = jwt_encode_handler(payload)</span><br><span class="line">        <span class="keyword">except</span> Exception <span class="keyword">as</span> e:</span><br><span class="line">            <span class="built_in">print</span>(e)</span><br><span class="line">            <span class="keyword">return</span> JsonResponse(&#123;<span class="string">&#x27;code&#x27;</span>: <span class="number">500</span>, <span class="string">&#x27;info&#x27;</span>: <span class="string">&#x27;用户名或密码错误！&#x27;</span>&#125;)</span><br><span class="line">        <span class="keyword">return</span> JsonResponse(&#123;<span class="string">&#x27;code&#x27;</span>: <span class="number">200</span>, <span class="string">&#x27;token&#x27;</span>:token, <span class="string">&#x27;info&#x27;</span>: <span class="string">&quot;登陆成功&quot;</span>&#125;)</span><br></pre></td></tr></table></figure></p>
<p>2.在 user/urls.py 中添加路由映射：<br />
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> django.urls <span class="keyword">import</span> path</span><br><span class="line"><span class="keyword">from</span> user.views <span class="keyword">import</span> TestView, JwtTestView, LoginView</span><br><span class="line"></span><br><span class="line">urlpatterns = [</span><br><span class="line">    ...,</span><br><span class="line">    path(<span class="string">&#x27;login&#x27;</span>, LoginView.as_view(), name=<span class="string">&#x27;login&#x27;</span>), <span class="comment"># 登录</span></span><br><span class="line">]</span><br></pre></td></tr></table></figure></p>
<h3 id="csrf处理">csrf处理</h3>
<p>前端登录页，通过axios访问后端时，报
<code>CSRF verification failed. Request aborted.</code> 错误。<br />
CSRF（跨站请求伪造）是一种攻击类型，它利用用户在已登录状态下的信任，以执行未授权的操作。报这个错误通常表示你的请求没有通过
CSRF 验证。<br />
Django 默认启用了 CSRF 保护，因此需要确保你的请求包含正确的 CSRF
令牌，这一般在提交Form表单时需要此令牌，可以在在提交表单时加上 CSRF
token。因为本例子是前后端分离，带了jwt的token验证，就不要 CSRF
令牌保护了，所以需要关闭它。</p>
<p>在Django中，可以通过以下方式关闭CSRF保护：<br />
1.在settings.py中，找到MIDDLEWARE设置，注释掉'django.middleware.csrf.CsrfViewMiddleware'这一行。<br />
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">MIDDLEWARE = [</span><br><span class="line">    <span class="string">&quot;corsheaders.middleware.CorsMiddleware&quot;</span>,</span><br><span class="line">    <span class="string">&quot;django.middleware.security.SecurityMiddleware&quot;</span>,</span><br><span class="line">    <span class="string">&quot;django.contrib.sessions.middleware.SessionMiddleware&quot;</span>,</span><br><span class="line">    <span class="string">&quot;django.middleware.common.CommonMiddleware&quot;</span>,</span><br><span class="line">    <span class="comment"># &quot;django.middleware.csrf.CsrfViewMiddleware&quot;,</span></span><br><span class="line">    <span class="string">&quot;django.contrib.auth.middleware.AuthenticationMiddleware&quot;</span>,</span><br><span class="line">    <span class="string">&quot;django.contrib.messages.middleware.MessageMiddleware&quot;</span>,</span><br><span class="line">    <span class="string">&quot;django.middleware.clickjacking.XFrameOptionsMiddleware&quot;</span>,</span><br><span class="line">]</span><br></pre></td></tr></table></figure><br />
2.在views.py中，使用@csrf_exempt装饰器来标记不需要CSRF保护的视图函数。</p>
<h1 id="vue3">Vue3</h1>
<p>了解以下概念：<br />
Node.js是一个开源的、跨平台的JavaScript运行环境，使得JavaScript可以用于后端服务器开发。<br />
npm是Node.js的包管理器，用于安装和管理Node.js的第三方库和工具。</p>
<h2 id="初始化-1">初始化</h2>
<p>1.安装node，查看nodejs和npm版本：<br />
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 使用conda虚拟环境安装</span></span><br><span class="line">conda install nodejs</span><br><span class="line"><span class="comment"># nodejs 版本</span></span><br><span class="line">node -v</span><br><span class="line"><span class="comment"># npm 版本</span></span><br><span class="line">npm -v</span><br></pre></td></tr></table></figure></p>
<p>2.vue-cli是官方发布 vue.js <strong>项目脚手架</strong>，可以快速创建
vue 项目、安装插件、安装依赖。vue-cli安装：<br />
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 安装vue-cli</span></span><br><span class="line">npm install -g @vue/cli</span><br><span class="line"><span class="comment"># 查看版本</span></span><br><span class="line">vue --version</span><br></pre></td></tr></table></figure></p>
<h2 id="创建启动">创建启动</h2>
<p>1.启动vue，并创建项目：<br />
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 启动项目</span></span><br><span class="line">vue ui</span><br><span class="line"><span class="comment"># 在vue的图形界面中创建项目</span></span><br><span class="line"><span class="comment"># 1.选择&quot;创建&quot;-&gt;选择要创建项目的位置-&gt;输入&quot;项目名&quot;-&gt;&quot;包管理器&quot;选择&quot;npm&quot;-&gt;git根据需求选择是否初始化-&gt;下一步</span></span><br><span class="line"><span class="comment"># 2.选择&quot;手动配置&quot;-&gt;下一步</span></span><br><span class="line"><span class="comment"># 3.选择&quot;Vue 3&quot;-&gt;选择&quot;Babel&quot;、&quot;Router&quot;、&quot;Vuex&quot;-&gt;下一步</span></span><br><span class="line"><span class="comment"># 4.选择使用的Vue版本，默认是&quot;3.x&quot;-&gt;创建项目</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 步骤3.中安装的是插件，也可以使用命令的方式安装</span></span><br><span class="line">vue add babel</span><br></pre></td></tr></table></figure></p>
<p>项目结构：<br />
<img src="/images/Python/vue项目结构.png" width="60%"></p>
<p>2.为项目安装依赖：<br />
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 注意，vue ui中有插件和依赖两个选项：</span></span><br><span class="line"><span class="comment"># 1.插件是vue项目中的组件</span></span><br><span class="line"><span class="comment"># 2.依赖是vue项目中的第三方库</span></span><br><span class="line"><span class="comment"># 直接搜索想用的插件/依赖安装就行</span></span><br></pre></td></tr></table></figure></p>
<p>package.json完整的安装结果：<br />
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  <span class="string">&quot;name&quot;</span>: <span class="string">&quot;zwv&quot;</span>,</span><br><span class="line">  <span class="string">&quot;version&quot;</span>: <span class="string">&quot;0.1.0&quot;</span>,</span><br><span class="line">  <span class="string">&quot;private&quot;</span>: true,</span><br><span class="line">  <span class="string">&quot;scripts&quot;</span>: &#123;</span><br><span class="line">    <span class="string">&quot;serve&quot;</span>: <span class="string">&quot;vue-cli-service serve&quot;</span>,</span><br><span class="line">    <span class="string">&quot;build&quot;</span>: <span class="string">&quot;vue-cli-service build&quot;</span></span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="string">&quot;dependencies&quot;</span>: &#123; <span class="comment"># 依赖</span></span><br><span class="line">    <span class="string">&quot;core-js&quot;</span>: <span class="string">&quot;^3.8.3&quot;</span>,</span><br><span class="line">    <span class="string">&quot;vue&quot;</span>: <span class="string">&quot;^3.2.13&quot;</span>,</span><br><span class="line">    <span class="string">&quot;vue-router&quot;</span>: <span class="string">&quot;^4.0.3&quot;</span>,</span><br><span class="line">    <span class="string">&quot;vuex&quot;</span>: <span class="string">&quot;^4.0.0&quot;</span>, <span class="comment"># 以此之后都是新安装的</span></span><br><span class="line">    <span class="string">&quot;axios&quot;</span>: <span class="string">&quot;^1.7.7&quot;</span>,</span><br><span class="line">    <span class="string">&quot;element-plus&quot;</span>: <span class="string">&quot;^2.8.7&quot;</span>,</span><br><span class="line">    <span class="string">&quot;js-cookie&quot;</span>: <span class="string">&quot;^3.0.5&quot;</span>,</span><br><span class="line">    <span class="string">&quot;jsencrypt&quot;</span>: <span class="string">&quot;^3.3.2&quot;</span>,</span><br><span class="line">    <span class="string">&quot;qs&quot;</span>: <span class="string">&quot;^6.13.0&quot;</span>,</span><br><span class="line">    <span class="string">&quot;sass&quot;</span>: <span class="string">&quot;^1.80.6&quot;</span>,</span><br><span class="line">    <span class="string">&quot;sass-loader&quot;</span>: <span class="string">&quot;^16.0.3&quot;</span>,</span><br><span class="line">    <span class="string">&quot;svg-sprite-loader&quot;</span>: <span class="string">&quot;^6.0.11&quot;</span>,</span><br><span class="line">    <span class="string">&quot;webpack&quot;</span>: <span class="string">&quot;^5.96.1&quot;</span></span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="string">&quot;devDependencies&quot;</span>: &#123; <span class="comment"># 插件</span></span><br><span class="line">    <span class="string">&quot;@vue/cli-plugin-babel&quot;</span>: <span class="string">&quot;~5.0.0&quot;</span>,</span><br><span class="line">    <span class="string">&quot;@vue/cli-plugin-router&quot;</span>: <span class="string">&quot;~5.0.0&quot;</span>,</span><br><span class="line">    <span class="string">&quot;@vue/cli-plugin-vuex&quot;</span>: <span class="string">&quot;~5.0.0&quot;</span>,</span><br><span class="line">    <span class="string">&quot;@vue/cli-service&quot;</span>: <span class="string">&quot;~5.0.0&quot;</span></span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="string">&quot;browserslist&quot;</span>: [</span><br><span class="line">    <span class="string">&quot;&gt; 1%&quot;</span>,</span><br><span class="line">    <span class="string">&quot;last 2 versions&quot;</span>,</span><br><span class="line">    <span class="string">&quot;not dead&quot;</span>,</span><br><span class="line">    <span class="string">&quot;not ie 11&quot;</span></span><br><span class="line">  ]</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>3.在 vue.config.js 中配置项目启动端口：<br />
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> &#123; defineConfig &#125; = <span class="built_in">require</span>(<span class="string">&#x27;@vue/cli-service&#x27;</span>)</span><br><span class="line"><span class="variable language_">module</span>.<span class="property">exports</span> = <span class="title function_">defineConfig</span>(&#123;</span><br><span class="line">  <span class="attr">transpileDependencies</span>: <span class="literal">true</span>,</span><br><span class="line">  <span class="comment">//配置dev的启动端口(serve启动也是这个端口)</span></span><br><span class="line">  <span class="attr">devServer</span>: &#123;</span><br><span class="line">      <span class="attr">port</span>: <span class="number">8080</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure></p>
<p>4.启动项目：<br />
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 执行的是package.json中的scripts/xxx命令</span></span><br><span class="line"><span class="comment"># 启动项目本地开发服务器，用于本地开发预览</span></span><br><span class="line">npm run serve</span><br><span class="line"><span class="comment"># 类似serve，但是能提供更多的开发工具和功能</span></span><br><span class="line">npm run dev</span><br><span class="line"><span class="comment"># 构建项目生产环境使用，并将源码打包优化，生成用于部署的静态文件</span></span><br><span class="line">npm run build</span><br></pre></td></tr></table></figure></p>
<h2 id="ui组件">UI组件</h2>
<p>1.element-plus是Element UI一个分支，提供了完整的UI组件。在项目下的
src/main.js 或 src/main.ts 中引入element-plus：<br />
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 全局引入</span></span><br><span class="line"><span class="keyword">import</span> &#123; createApp &#125; <span class="keyword">from</span> <span class="string">&#x27;vue&#x27;</span></span><br><span class="line"><span class="keyword">import</span> App <span class="keyword">from</span> <span class="string">&#x27;./App.vue&#x27;</span></span><br><span class="line"><span class="keyword">import</span> router <span class="keyword">from</span> <span class="string">&#x27;./router&#x27;</span></span><br><span class="line"><span class="keyword">import</span> store <span class="keyword">from</span> <span class="string">&#x27;./store&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> ElementPlus <span class="keyword">from</span> <span class="string">&#x27;element-plus&#x27;</span> <span class="comment"># 引入ElementPlus</span></span><br><span class="line"><span class="keyword">import</span> <span class="string">&#x27;element-plus/dist/index.css&#x27;</span> <span class="comment"># 引入css</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 增加.use(ElementPlus)</span></span><br><span class="line">createApp(App).use(store).use(router).use(ElementPlus).mount(<span class="string">&#x27;#app&#x27;</span>)</span><br></pre></td></tr></table></figure></p>
<p>2.在 src/views/AboutView.vue 中修改About界面，使用element-plus的 按钮
组件：<br />
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- element-plus组件提供的代码，缩进为2空格 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">template</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;mb-4&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">el-button</span>&gt;</span>Default<span class="tag">&lt;/<span class="name">el-button</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">el-button</span> <span class="attr">type</span>=<span class="string">&quot;primary&quot;</span>&gt;</span>Primary<span class="tag">&lt;/<span class="name">el-button</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">el-button</span> <span class="attr">type</span>=<span class="string">&quot;success&quot;</span>&gt;</span>Success<span class="tag">&lt;/<span class="name">el-button</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">el-button</span> <span class="attr">type</span>=<span class="string">&quot;info&quot;</span>&gt;</span>Info<span class="tag">&lt;/<span class="name">el-button</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">el-button</span> <span class="attr">type</span>=<span class="string">&quot;warning&quot;</span>&gt;</span>Warning<span class="tag">&lt;/<span class="name">el-button</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">el-button</span> <span class="attr">type</span>=<span class="string">&quot;danger&quot;</span>&gt;</span>Danger<span class="tag">&lt;/<span class="name">el-button</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"></span><br><span class="line">  <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;mb-4&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">el-button</span> <span class="attr">plain</span>&gt;</span>Plain<span class="tag">&lt;/<span class="name">el-button</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">el-button</span> <span class="attr">type</span>=<span class="string">&quot;primary&quot;</span> <span class="attr">plain</span>&gt;</span>Primary<span class="tag">&lt;/<span class="name">el-button</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">el-button</span> <span class="attr">type</span>=<span class="string">&quot;success&quot;</span> <span class="attr">plain</span>&gt;</span>Success<span class="tag">&lt;/<span class="name">el-button</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">el-button</span> <span class="attr">type</span>=<span class="string">&quot;info&quot;</span> <span class="attr">plain</span>&gt;</span>Info<span class="tag">&lt;/<span class="name">el-button</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">el-button</span> <span class="attr">type</span>=<span class="string">&quot;warning&quot;</span> <span class="attr">plain</span>&gt;</span>Warning<span class="tag">&lt;/<span class="name">el-button</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">el-button</span> <span class="attr">type</span>=<span class="string">&quot;danger&quot;</span> <span class="attr">plain</span>&gt;</span>Danger<span class="tag">&lt;/<span class="name">el-button</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"></span><br><span class="line">  <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;mb-4&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">el-button</span> <span class="attr">round</span>&gt;</span>Round<span class="tag">&lt;/<span class="name">el-button</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">el-button</span> <span class="attr">type</span>=<span class="string">&quot;primary&quot;</span> <span class="attr">round</span>&gt;</span>Primary<span class="tag">&lt;/<span class="name">el-button</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">el-button</span> <span class="attr">type</span>=<span class="string">&quot;success&quot;</span> <span class="attr">round</span>&gt;</span>Success<span class="tag">&lt;/<span class="name">el-button</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">el-button</span> <span class="attr">type</span>=<span class="string">&quot;info&quot;</span> <span class="attr">round</span>&gt;</span>Info<span class="tag">&lt;/<span class="name">el-button</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">el-button</span> <span class="attr">type</span>=<span class="string">&quot;warning&quot;</span> <span class="attr">round</span>&gt;</span>Warning<span class="tag">&lt;/<span class="name">el-button</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">el-button</span> <span class="attr">type</span>=<span class="string">&quot;danger&quot;</span> <span class="attr">round</span>&gt;</span>Danger<span class="tag">&lt;/<span class="name">el-button</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"></span><br><span class="line">  <span class="tag">&lt;<span class="name">div</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">el-button</span> <span class="attr">:icon</span>=<span class="string">&quot;Search&quot;</span> <span class="attr">circle</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">el-button</span> <span class="attr">type</span>=<span class="string">&quot;primary&quot;</span> <span class="attr">:icon</span>=<span class="string">&quot;Edit&quot;</span> <span class="attr">circle</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">el-button</span> <span class="attr">type</span>=<span class="string">&quot;success&quot;</span> <span class="attr">:icon</span>=<span class="string">&quot;Check&quot;</span> <span class="attr">circle</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">el-button</span> <span class="attr">type</span>=<span class="string">&quot;info&quot;</span> <span class="attr">:icon</span>=<span class="string">&quot;Message&quot;</span> <span class="attr">circle</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">el-button</span> <span class="attr">type</span>=<span class="string">&quot;warning&quot;</span> <span class="attr">:icon</span>=<span class="string">&quot;Star&quot;</span> <span class="attr">circle</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">el-button</span> <span class="attr">type</span>=<span class="string">&quot;danger&quot;</span> <span class="attr">:icon</span>=<span class="string">&quot;Delete&quot;</span> <span class="attr">circle</span> /&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">template</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">&lt;!-- 这里不支持ts，可以去掉lang=&quot;ts&quot; --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span> <span class="attr">lang</span>=<span class="string">&quot;ts&quot;</span> <span class="attr">setup</span>&gt;</span><span class="language-javascript"> </span></span><br><span class="line"><span class="language-javascript"><span class="keyword">import</span> &#123;</span></span><br><span class="line"><span class="language-javascript">  <span class="title class_">Check</span>,</span></span><br><span class="line"><span class="language-javascript">  <span class="title class_">Delete</span>,</span></span><br><span class="line"><span class="language-javascript">  <span class="title class_">Edit</span>,</span></span><br><span class="line"><span class="language-javascript">  <span class="title class_">Message</span>,</span></span><br><span class="line"><span class="language-javascript">  <span class="title class_">Search</span>,</span></span><br><span class="line"><span class="language-javascript">  <span class="title class_">Star</span>,</span></span><br><span class="line"><span class="language-javascript">&#125; <span class="keyword">from</span> <span class="string">&#x27;@element-plus/icons-vue&#x27;</span></span></span><br><span class="line"><span class="language-javascript"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br></pre></td></tr></table></figure></p>
<h2 id="jwt认证-1">jwt认证</h2>
<p>1.前端通过axios请求后端，首先需要对axios的请求方法进行封装，创建
src/util/request.js 文件，写入：<br />
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> axios <span class="keyword">from</span> <span class="string">&quot;axios&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">//后端地址</span></span><br><span class="line"><span class="keyword">let</span> baseUrl = <span class="string">&quot;http://localhost:8000/&quot;</span>; </span><br><span class="line"><span class="comment">//创建axios实例</span></span><br><span class="line"><span class="keyword">const</span> httpService = axios.<span class="title function_">create</span>(&#123;</span><br><span class="line">    <span class="comment">//baseURL: process.env.BASE_API, //需要自定义</span></span><br><span class="line">    <span class="attr">baseURL</span>: baseUrl,</span><br><span class="line">    <span class="comment">//请求超时时间</span></span><br><span class="line">    <span class="attr">timeout</span>: <span class="number">3000</span> <span class="comment">//3秒超时</span></span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"><span class="comment">//需要添加请求、响应拦截器</span></span><br><span class="line"><span class="comment">//添加请求拦截器（在发送请求之前做些什么）</span></span><br><span class="line">httpService.<span class="property">interceptors</span>.<span class="property">request</span>.<span class="title function_">use</span>(<span class="keyword">function</span> (<span class="params">config</span>) &#123;</span><br><span class="line">    <span class="comment">//在发送请求之前，从sessionStorage中获取token，添加到请求头中</span></span><br><span class="line">    config.<span class="property">headers</span>.<span class="property">AUTHORIZATION</span> = <span class="variable language_">window</span>.<span class="property">sessionStorage</span>.<span class="title function_">getItem</span>(<span class="string">&quot;token&quot;</span>);</span><br><span class="line">    <span class="keyword">return</span> config;</span><br><span class="line"></span><br><span class="line">&#125;, <span class="keyword">function</span> (<span class="params">error</span>) &#123;</span><br><span class="line">    <span class="comment">//对请求错误做些什么</span></span><br><span class="line">    <span class="keyword">return</span> <span class="title class_">Promise</span>.<span class="title function_">reject</span>(error);</span><br><span class="line">&#125;);</span><br><span class="line"><span class="comment">//添加响应拦截器（对响应数据做点什么）</span></span><br><span class="line">httpService.<span class="property">interceptors</span>.<span class="property">response</span>.<span class="title function_">use</span>(<span class="keyword">function</span> (<span class="params">response</span>) &#123;</span><br><span class="line">    <span class="comment">//对响应数据什么都不做</span></span><br><span class="line">    <span class="keyword">return</span> response;</span><br><span class="line">&#125;, <span class="keyword">function</span> (<span class="params">error</span>) &#123;</span><br><span class="line">    <span class="comment">//对响应错误做点什么</span></span><br><span class="line">    <span class="keyword">return</span> <span class="title class_">Promise</span>.<span class="title function_">reject</span>(error);</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">//网络请求封装</span></span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment"> * get请求</span></span><br><span class="line"><span class="comment"> * url：请求地址</span></span><br><span class="line"><span class="comment"> * params：请求参数</span></span><br><span class="line"><span class="comment">*/</span> </span><br><span class="line"><span class="keyword">export</span> <span class="keyword">function</span> <span class="title function_">get</span>(<span class="params">url, params = &#123;&#125;</span>) &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">Promise</span>(<span class="function">(<span class="params">resolve, reject</span>) =&gt;</span> &#123;</span><br><span class="line">        <span class="title function_">httpService</span>(&#123;</span><br><span class="line">            <span class="attr">url</span>: url,</span><br><span class="line">            <span class="attr">method</span>: <span class="string">&#x27;get&#x27;</span>,</span><br><span class="line">            <span class="attr">params</span>: params</span><br><span class="line">        &#125;).<span class="title function_">then</span>(<span class="function"><span class="params">response</span> =&gt;</span> &#123;</span><br><span class="line">            <span class="title function_">resolve</span>(response);</span><br><span class="line">        &#125;).<span class="title function_">catch</span>(<span class="function"><span class="params">error</span> =&gt;</span> &#123;</span><br><span class="line">            <span class="title function_">reject</span>(error);</span><br><span class="line">        &#125;);</span><br><span class="line">    &#125;);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment"> * post请求</span></span><br><span class="line"><span class="comment"> * url：请求地址</span></span><br><span class="line"><span class="comment"> * params：请求参数</span></span><br><span class="line"><span class="comment">*/</span> </span><br><span class="line"><span class="keyword">export</span> <span class="keyword">function</span> <span class="title function_">post</span>(<span class="params">url, params = &#123;&#125;</span>) &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">Promise</span>(<span class="function">(<span class="params">resolve, reject</span>) =&gt;</span> &#123;</span><br><span class="line">        <span class="title function_">httpService</span>(&#123;</span><br><span class="line">            <span class="attr">url</span>: url,</span><br><span class="line">            <span class="attr">method</span>: <span class="string">&#x27;post&#x27;</span>,</span><br><span class="line">            <span class="attr">params</span>: params</span><br><span class="line">        &#125;).<span class="title function_">then</span>(<span class="function"><span class="params">response</span> =&gt;</span> &#123;</span><br><span class="line">            <span class="variable language_">console</span>.<span class="title function_">log</span>(response)</span><br><span class="line">            <span class="title function_">resolve</span>(response);</span><br><span class="line">        &#125;).<span class="title function_">catch</span>(<span class="function"><span class="params">error</span> =&gt;</span> &#123;</span><br><span class="line">            <span class="variable language_">console</span>.<span class="title function_">log</span>(error)</span><br><span class="line">            <span class="title function_">reject</span>(error);</span><br><span class="line">        &#125;);</span><br><span class="line">    &#125;);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment"> * delete请求</span></span><br><span class="line"><span class="comment"> * url：请求地址</span></span><br><span class="line"><span class="comment"> * params：请求参数</span></span><br><span class="line"><span class="comment">*/</span> </span><br><span class="line"><span class="keyword">export</span> <span class="keyword">function</span> <span class="title function_">del</span>(<span class="params">url, params = &#123;&#125;</span>) &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">Promise</span>(<span class="function">(<span class="params">resolve, reject</span>) =&gt;</span> &#123;</span><br><span class="line">        <span class="title function_">httpService</span>(&#123;</span><br><span class="line">            <span class="attr">url</span>: url,</span><br><span class="line">            <span class="attr">method</span>: <span class="string">&#x27;delete&#x27;</span>,</span><br><span class="line">            <span class="attr">params</span>: params</span><br><span class="line">        &#125;).<span class="title function_">then</span>(<span class="function"><span class="params">response</span> =&gt;</span> &#123;</span><br><span class="line">            <span class="variable language_">console</span>.<span class="title function_">log</span>(response)</span><br><span class="line">            <span class="title function_">resolve</span>(response);</span><br><span class="line">        &#125;).<span class="title function_">catch</span>(<span class="function"><span class="params">error</span> =&gt;</span> &#123;</span><br><span class="line">            <span class="variable language_">console</span>.<span class="title function_">log</span>(error)</span><br><span class="line">            <span class="title function_">reject</span>(error);</span><br><span class="line">        &#125;);</span><br><span class="line">    &#125;);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment"> * 文件上传请求</span></span><br><span class="line"><span class="comment"> * url：请求地址</span></span><br><span class="line"><span class="comment"> * params：请求参数</span></span><br><span class="line"><span class="comment">*/</span> </span><br><span class="line"><span class="keyword">export</span> <span class="keyword">function</span> <span class="title function_">fileUpload</span>(<span class="params">url, params = &#123;&#125;</span>) &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">Promise</span>(<span class="function">(<span class="params">resolve, reject</span>) =&gt;</span> &#123;</span><br><span class="line">        <span class="title function_">httpService</span>(&#123;</span><br><span class="line">            <span class="attr">url</span>: url,</span><br><span class="line">            <span class="attr">method</span>: <span class="string">&#x27;post&#x27;</span>,</span><br><span class="line">            <span class="attr">params</span>: params,</span><br><span class="line">            <span class="attr">headers</span>: &#123;<span class="string">&quot;Content-Type&quot;</span>: <span class="string">&#x27;multipart/form-data&#x27;</span>&#125;</span><br><span class="line">        &#125;).<span class="title function_">then</span>(<span class="function"><span class="params">response</span> =&gt;</span> &#123;</span><br><span class="line">            <span class="title function_">resolve</span>(response);</span><br><span class="line">        &#125;).<span class="title function_">catch</span>(<span class="function"><span class="params">error</span> =&gt;</span> &#123;</span><br><span class="line">            <span class="title function_">reject</span>(error);</span><br><span class="line">        &#125;);</span><br><span class="line">    &#125;);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">function</span> <span class="title function_">getServerUrl</span>(<span class="params"></span>)&#123;</span><br><span class="line">    <span class="keyword">return</span> baseUrl;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> &#123;</span><br><span class="line">    get,</span><br><span class="line">    post,</span><br><span class="line">    del,</span><br><span class="line">    fileUpload,</span><br><span class="line">    getServerUrl</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>2.编写 src/AboutView.vue
通过axios请求后端接口，模拟登录获取token、获取用户信息：<br />
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">template</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- @click 按钮事件 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">el-button</span> <span class="attr">type</span>=<span class="string">&quot;primary&quot;</span> @<span class="attr">click</span>=<span class="string">&quot;handleLogin&quot;</span>&gt;</span>测试登录<span class="tag">&lt;/<span class="name">el-button</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">el-button</span> <span class="attr">type</span>=<span class="string">&quot;success&quot;</span> @<span class="attr">click</span>=<span class="string">&quot;handleUserList&quot;</span>&gt;</span>测试获取用户信息列表<span class="tag">&lt;/<span class="name">el-button</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;/<span class="name">template</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">&lt;!-- 这里不支持ts，去掉lang=&quot;ts&quot; --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span> <span class="attr">setup</span>&gt;</span><span class="language-javascript"> </span></span><br><span class="line"><span class="language-javascript"><span class="keyword">import</span> request <span class="keyword">from</span> <span class="string">&#x27;@/util/request&#x27;</span>;</span></span><br><span class="line"><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript"><span class="comment">//登录时，获取响应的token，并存入sessionStorage中</span></span></span><br><span class="line"><span class="language-javascript"><span class="keyword">const</span> <span class="title function_">handleLogin</span> = <span class="keyword">async</span>(<span class="params"></span>) =&gt; &#123;</span></span><br><span class="line"><span class="language-javascript">  <span class="keyword">let</span> result = <span class="keyword">await</span> request.<span class="title function_">get</span>(<span class="string">&quot;user/jwt_test&quot;</span>)</span></span><br><span class="line"><span class="language-javascript">  <span class="keyword">let</span> data = result.<span class="property">data</span>;</span></span><br><span class="line"><span class="language-javascript">  <span class="keyword">if</span>(data.<span class="property">code</span> == <span class="number">200</span>)&#123;</span></span><br><span class="line"><span class="language-javascript">    <span class="keyword">const</span> token = data.<span class="property">token</span></span></span><br><span class="line"><span class="language-javascript">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;登录成功，token=&quot;</span> + token)</span></span><br><span class="line"><span class="language-javascript">    <span class="variable language_">window</span>.<span class="property">sessionStorage</span>.<span class="title function_">setItem</span>(<span class="string">&quot;token&quot;</span>, token)</span></span><br><span class="line"><span class="language-javascript">  &#125;<span class="keyword">else</span>&#123;</span></span><br><span class="line"><span class="language-javascript">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;登录出错&quot;</span>)</span></span><br><span class="line"><span class="language-javascript">  &#125;</span></span><br><span class="line"><span class="language-javascript">&#125;</span></span><br><span class="line"><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript"><span class="keyword">const</span> <span class="title function_">handleUserList</span> = <span class="keyword">async</span>(<span class="params"></span>) =&gt; &#123;</span></span><br><span class="line"><span class="language-javascript">  <span class="keyword">let</span> result = <span class="keyword">await</span> request.<span class="title function_">get</span>(<span class="string">&quot;user/test&quot;</span>)</span></span><br><span class="line"><span class="language-javascript">  <span class="keyword">let</span> data = result.<span class="property">data</span>;</span></span><br><span class="line"><span class="language-javascript">  <span class="keyword">if</span>(data.<span class="property">code</span> == <span class="number">200</span>)&#123;</span></span><br><span class="line"><span class="language-javascript">    <span class="keyword">const</span> userList = data.<span class="property">data</span>;</span></span><br><span class="line"><span class="language-javascript">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;用户信息列表，userList=&quot;</span> + userList)</span></span><br><span class="line"><span class="language-javascript">  &#125;<span class="keyword">else</span>&#123;</span></span><br><span class="line"><span class="language-javascript">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;登录出错&quot;</span>)</span></span><br><span class="line"><span class="language-javascript">  &#125;</span></span><br><span class="line"><span class="language-javascript">&#125;</span></span><br><span class="line"><span class="language-javascript"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br></pre></td></tr></table></figure></p>
<p>3.1启动前后端，点击"测试登录"按钮，会报CORS跨域请求错误，需要在后端配置跨域。<br />
3.2跨域配置好后，浏览器按F12进入开发这模式，重新点击"测试登录"按钮，触发handleLogin事件，将响应中token存储在sessionStorage中，浏览器中Network显示访问jwt_test，查看其Response中的token，并和Application的Session
storage中存储的token对比，应该是一样的。<br />
3.3点击"测试获取用户信息列表"按钮，触发handleUserList事件，因为自己封装的axios文件request.js中定义了请求拦截器，在每次请求前从sessionStorage中获取token，并加载到当前请求上，所以带了token，能访问test获取信息。</p>
<h2 id="登录页面-1">登录页面</h2>
<h3 id="基础布局">基础布局</h3>
<p>一般开发页面前，对全局样式进行配置。<br />
1.首先引入全局样式，新建 src/assets/styles 文件夹，放入 border.css 和
reset.css 两个文件：<br />
<div class="tabs" id="fourth-unique-name"><ul class="nav-tabs"><li class="tab active"><a href="#fourth-unique-name-1">边框样式</a></li><li class="tab"><a href="#fourth-unique-name-2">重置浏览器默认样式</a></li></ul><div class="tab-content"><div class="tab-pane active" id="fourth-unique-name-1"><figure class="highlight css"><figcaption><span>border.css</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">@charset</span> <span class="string">&quot;utf-8&quot;</span>;</span><br><span class="line"><span class="selector-class">.border</span>,</span><br><span class="line"><span class="selector-class">.border-top</span>,</span><br><span class="line"><span class="selector-class">.border-right</span>,</span><br><span class="line"><span class="selector-class">.border-bottom</span>,</span><br><span class="line"><span class="selector-class">.border-left</span>,</span><br><span class="line"><span class="selector-class">.border-topbottom</span>,</span><br><span class="line"><span class="selector-class">.border-rightleft</span>,</span><br><span class="line"><span class="selector-class">.border-topleft</span>,</span><br><span class="line"><span class="selector-class">.border-rightbottom</span>,</span><br><span class="line"><span class="selector-class">.border-topright</span>,</span><br><span class="line"><span class="selector-class">.border-bottomleft</span> &#123;</span><br><span class="line">    <span class="attribute">position</span>: relative;</span><br><span class="line">&#125;</span><br><span class="line"><span class="selector-class">.border</span><span class="selector-pseudo">::before</span>,</span><br><span class="line"><span class="selector-class">.border-top</span><span class="selector-pseudo">::before</span>,</span><br><span class="line"><span class="selector-class">.border-right</span><span class="selector-pseudo">::before</span>,</span><br><span class="line"><span class="selector-class">.border-bottom</span><span class="selector-pseudo">::before</span>,</span><br><span class="line"><span class="selector-class">.border-left</span><span class="selector-pseudo">::before</span>,</span><br><span class="line"><span class="selector-class">.border-topbottom</span><span class="selector-pseudo">::before</span>,</span><br><span class="line"><span class="selector-class">.border-topbottom</span><span class="selector-pseudo">::after</span>,</span><br><span class="line"><span class="selector-class">.border-rightleft</span><span class="selector-pseudo">::before</span>,</span><br><span class="line"><span class="selector-class">.border-rightleft</span><span class="selector-pseudo">::after</span>,</span><br><span class="line"><span class="selector-class">.border-topleft</span><span class="selector-pseudo">::before</span>,</span><br><span class="line"><span class="selector-class">.border-topleft</span><span class="selector-pseudo">::after</span>,</span><br><span class="line"><span class="selector-class">.border-rightbottom</span><span class="selector-pseudo">::before</span>,</span><br><span class="line"><span class="selector-class">.border-rightbottom</span><span class="selector-pseudo">::after</span>,</span><br><span class="line"><span class="selector-class">.border-topright</span><span class="selector-pseudo">::before</span>,</span><br><span class="line"><span class="selector-class">.border-topright</span><span class="selector-pseudo">::after</span>,</span><br><span class="line"><span class="selector-class">.border-bottomleft</span><span class="selector-pseudo">::before</span>,</span><br><span class="line"><span class="selector-class">.border-bottomleft</span><span class="selector-pseudo">::after</span> &#123;</span><br><span class="line">    <span class="attribute">content</span>: <span class="string">&quot;\0020&quot;</span>;</span><br><span class="line">    <span class="attribute">overflow</span>: hidden;</span><br><span class="line">    <span class="attribute">position</span>: absolute;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">/* border</span></span><br><span class="line"><span class="comment"> * 因，边框是由伪元素区域遮盖在父级</span></span><br><span class="line"><span class="comment"> * 故，子级若有交互，需要对子级设置</span></span><br><span class="line"><span class="comment"> * 定位 及 z轴</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="selector-class">.border</span><span class="selector-pseudo">::before</span> &#123;</span><br><span class="line">    <span class="attribute">box-sizing</span>: border-box;</span><br><span class="line">    <span class="attribute">top</span>: <span class="number">0</span>;</span><br><span class="line">    <span class="attribute">left</span>: <span class="number">0</span>;</span><br><span class="line">    <span class="attribute">height</span>: <span class="number">100%</span>;</span><br><span class="line">    <span class="attribute">width</span>: <span class="number">100%</span>;</span><br><span class="line">    <span class="attribute">border</span>: <span class="number">1px</span> solid <span class="number">#eaeaea</span>;</span><br><span class="line">    <span class="attribute">transform-origin</span>: <span class="number">0</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="selector-class">.border-top</span><span class="selector-pseudo">::before</span>,</span><br><span class="line"><span class="selector-class">.border-bottom</span><span class="selector-pseudo">::before</span>,</span><br><span class="line"><span class="selector-class">.border-topbottom</span><span class="selector-pseudo">::before</span>,</span><br><span class="line"><span class="selector-class">.border-topbottom</span><span class="selector-pseudo">::after</span>,</span><br><span class="line"><span class="selector-class">.border-topleft</span><span class="selector-pseudo">::before</span>,</span><br><span class="line"><span class="selector-class">.border-rightbottom</span><span class="selector-pseudo">::after</span>,</span><br><span class="line"><span class="selector-class">.border-topright</span><span class="selector-pseudo">::before</span>,</span><br><span class="line"><span class="selector-class">.border-bottomleft</span><span class="selector-pseudo">::before</span> &#123;</span><br><span class="line">    <span class="attribute">left</span>: <span class="number">0</span>;</span><br><span class="line">    <span class="attribute">width</span>: <span class="number">100%</span>;</span><br><span class="line">    <span class="attribute">height</span>: <span class="number">1px</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="selector-class">.border-right</span><span class="selector-pseudo">::before</span>,</span><br><span class="line"><span class="selector-class">.border-left</span><span class="selector-pseudo">::before</span>,</span><br><span class="line"><span class="selector-class">.border-rightleft</span><span class="selector-pseudo">::before</span>,</span><br><span class="line"><span class="selector-class">.border-rightleft</span><span class="selector-pseudo">::after</span>,</span><br><span class="line"><span class="selector-class">.border-topleft</span><span class="selector-pseudo">::after</span>,</span><br><span class="line"><span class="selector-class">.border-rightbottom</span><span class="selector-pseudo">::before</span>,</span><br><span class="line"><span class="selector-class">.border-topright</span><span class="selector-pseudo">::after</span>,</span><br><span class="line"><span class="selector-class">.border-bottomleft</span><span class="selector-pseudo">::after</span> &#123;</span><br><span class="line">    <span class="attribute">top</span>: <span class="number">0</span>;</span><br><span class="line">    <span class="attribute">width</span>: <span class="number">1px</span>;</span><br><span class="line">    <span class="attribute">height</span>: <span class="number">100%</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="selector-class">.border-top</span><span class="selector-pseudo">::before</span>,</span><br><span class="line"><span class="selector-class">.border-topbottom</span><span class="selector-pseudo">::before</span>,</span><br><span class="line"><span class="selector-class">.border-topleft</span><span class="selector-pseudo">::before</span>,</span><br><span class="line"><span class="selector-class">.border-topright</span><span class="selector-pseudo">::before</span> &#123;</span><br><span class="line">    <span class="attribute">border-top</span>: <span class="number">1px</span> solid <span class="number">#eaeaea</span>;</span><br><span class="line">    <span class="attribute">transform-origin</span>: <span class="number">0</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="selector-class">.border-right</span><span class="selector-pseudo">::before</span>,</span><br><span class="line"><span class="selector-class">.border-rightbottom</span><span class="selector-pseudo">::before</span>,</span><br><span class="line"><span class="selector-class">.border-rightleft</span><span class="selector-pseudo">::before</span>,</span><br><span class="line"><span class="selector-class">.border-topright</span><span class="selector-pseudo">::after</span> &#123;</span><br><span class="line">    <span class="attribute">border-right</span>: <span class="number">1px</span> solid <span class="number">#eaeaea</span>;</span><br><span class="line">    <span class="attribute">transform-origin</span>: <span class="number">100%</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="selector-class">.border-bottom</span><span class="selector-pseudo">::before</span>,</span><br><span class="line"><span class="selector-class">.border-topbottom</span><span class="selector-pseudo">::after</span>,</span><br><span class="line"><span class="selector-class">.border-rightbottom</span><span class="selector-pseudo">::after</span>,</span><br><span class="line"><span class="selector-class">.border-bottomleft</span><span class="selector-pseudo">::before</span> &#123;</span><br><span class="line">    <span class="attribute">border-bottom</span>: <span class="number">1px</span> solid <span class="number">#eaeaea</span>;</span><br><span class="line">    <span class="attribute">transform-origin</span>: <span class="number">0</span> <span class="number">100%</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="selector-class">.border-left</span><span class="selector-pseudo">::before</span>,</span><br><span class="line"><span class="selector-class">.border-topleft</span><span class="selector-pseudo">::after</span>,</span><br><span class="line"><span class="selector-class">.border-rightleft</span><span class="selector-pseudo">::after</span>,</span><br><span class="line"><span class="selector-class">.border-bottomleft</span><span class="selector-pseudo">::after</span> &#123;</span><br><span class="line">    <span class="attribute">border-left</span>: <span class="number">1px</span> solid <span class="number">#eaeaea</span>;</span><br><span class="line">    <span class="attribute">transform-origin</span>: <span class="number">0</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="selector-class">.border-top</span><span class="selector-pseudo">::before</span>,</span><br><span class="line"><span class="selector-class">.border-topbottom</span><span class="selector-pseudo">::before</span>,</span><br><span class="line"><span class="selector-class">.border-topleft</span><span class="selector-pseudo">::before</span>,</span><br><span class="line"><span class="selector-class">.border-topright</span><span class="selector-pseudo">::before</span> &#123;</span><br><span class="line">    <span class="attribute">top</span>: <span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="selector-class">.border-right</span><span class="selector-pseudo">::before</span>,</span><br><span class="line"><span class="selector-class">.border-rightleft</span><span class="selector-pseudo">::after</span>,</span><br><span class="line"><span class="selector-class">.border-rightbottom</span><span class="selector-pseudo">::before</span>,</span><br><span class="line"><span class="selector-class">.border-topright</span><span class="selector-pseudo">::after</span> &#123;</span><br><span class="line">    <span class="attribute">right</span>: <span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="selector-class">.border-bottom</span><span class="selector-pseudo">::before</span>,</span><br><span class="line"><span class="selector-class">.border-topbottom</span><span class="selector-pseudo">::after</span>,</span><br><span class="line"><span class="selector-class">.border-rightbottom</span><span class="selector-pseudo">::after</span>,</span><br><span class="line"><span class="selector-class">.border-bottomleft</span><span class="selector-pseudo">::after</span> &#123;</span><br><span class="line">    <span class="attribute">bottom</span>: <span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="selector-class">.border-left</span><span class="selector-pseudo">::before</span>,</span><br><span class="line"><span class="selector-class">.border-rightleft</span><span class="selector-pseudo">::before</span>,</span><br><span class="line"><span class="selector-class">.border-topleft</span><span class="selector-pseudo">::after</span>,</span><br><span class="line"><span class="selector-class">.border-bottomleft</span><span class="selector-pseudo">::before</span> &#123;</span><br><span class="line">    <span class="attribute">left</span>: <span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">@media</span> (<span class="attribute">max--moz-device-pixel-ratio</span>: <span class="number">1.49</span>), (<span class="attribute">-webkit-max-device-pixel-ratio</span>: <span class="number">1.49</span>), (<span class="attribute">max-device-pixel-ratio</span>: <span class="number">1.49</span>), (<span class="attribute">max-resolution</span>: <span class="number">143dpi</span>), (<span class="attribute">max-resolution</span>: <span class="number">1.49dppx</span>) &#123;</span><br><span class="line">    <span class="comment">/* 默认值，无需重置 */</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">@media</span> (<span class="attribute">min--moz-device-pixel-ratio</span>: <span class="number">1.5</span>) <span class="keyword">and</span> (<span class="attribute">max--moz-device-pixel-ratio</span>: <span class="number">2.49</span>), (<span class="attribute">-webkit-min-device-pixel-ratio</span>: <span class="number">1.5</span>) <span class="keyword">and</span> (<span class="attribute">-webkit-max-device-pixel-ratio</span>: <span class="number">2.49</span>), (<span class="attribute">min-device-pixel-ratio</span>: <span class="number">1.5</span>) <span class="keyword">and</span> (<span class="attribute">max-device-pixel-ratio</span>: <span class="number">2.49</span>), (<span class="attribute">min-resolution</span>: <span class="number">144dpi</span>) <span class="keyword">and</span> (<span class="attribute">max-resolution</span>: <span class="number">239dpi</span>), (<span class="attribute">min-resolution</span>: <span class="number">1.5dppx</span>) <span class="keyword">and</span> (<span class="attribute">max-resolution</span>: <span class="number">2.49dppx</span>) &#123;</span><br><span class="line">    <span class="selector-class">.border</span><span class="selector-pseudo">::before</span> &#123;</span><br><span class="line">        <span class="attribute">width</span>: <span class="number">200%</span>;</span><br><span class="line">        <span class="attribute">height</span>: <span class="number">200%</span>;</span><br><span class="line">        <span class="attribute">transform</span>: <span class="built_in">scale</span>(.<span class="number">5</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="selector-class">.border-top</span><span class="selector-pseudo">::before</span>,</span><br><span class="line">    <span class="selector-class">.border-bottom</span><span class="selector-pseudo">::before</span>,</span><br><span class="line">    <span class="selector-class">.border-topbottom</span><span class="selector-pseudo">::before</span>,</span><br><span class="line">    <span class="selector-class">.border-topbottom</span><span class="selector-pseudo">::after</span>,</span><br><span class="line">    <span class="selector-class">.border-topleft</span><span class="selector-pseudo">::before</span>,</span><br><span class="line">    <span class="selector-class">.border-rightbottom</span><span class="selector-pseudo">::after</span>,</span><br><span class="line">    <span class="selector-class">.border-topright</span><span class="selector-pseudo">::before</span>,</span><br><span class="line">    <span class="selector-class">.border-bottomleft</span><span class="selector-pseudo">::before</span> &#123;</span><br><span class="line">        <span class="attribute">transform</span>: <span class="built_in">scaleY</span>(.<span class="number">5</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="selector-class">.border-right</span><span class="selector-pseudo">::before</span>,</span><br><span class="line">    <span class="selector-class">.border-left</span><span class="selector-pseudo">::before</span>,</span><br><span class="line">    <span class="selector-class">.border-rightleft</span><span class="selector-pseudo">::before</span>,</span><br><span class="line">    <span class="selector-class">.border-rightleft</span><span class="selector-pseudo">::after</span>,</span><br><span class="line">    <span class="selector-class">.border-topleft</span><span class="selector-pseudo">::after</span>,</span><br><span class="line">    <span class="selector-class">.border-rightbottom</span><span class="selector-pseudo">::before</span>,</span><br><span class="line">    <span class="selector-class">.border-topright</span><span class="selector-pseudo">::after</span>,</span><br><span class="line">    <span class="selector-class">.border-bottomleft</span><span class="selector-pseudo">::after</span> &#123;</span><br><span class="line">        <span class="attribute">transform</span>: <span class="built_in">scaleX</span>(.<span class="number">5</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">@media</span> (<span class="attribute">min--moz-device-pixel-ratio</span>: <span class="number">2.5</span>), (<span class="attribute">-webkit-min-device-pixel-ratio</span>: <span class="number">2.5</span>), (<span class="attribute">min-device-pixel-ratio</span>: <span class="number">2.5</span>), (<span class="attribute">min-resolution</span>: <span class="number">240dpi</span>), (<span class="attribute">min-resolution</span>: <span class="number">2.5dppx</span>) &#123;</span><br><span class="line">    <span class="selector-class">.border</span><span class="selector-pseudo">::before</span> &#123;</span><br><span class="line">        <span class="attribute">width</span>: <span class="number">300%</span>;</span><br><span class="line">        <span class="attribute">height</span>: <span class="number">300%</span>;</span><br><span class="line">        <span class="attribute">transform</span>: <span class="built_in">scale</span>(.<span class="number">33333</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="selector-class">.border-top</span><span class="selector-pseudo">::before</span>,</span><br><span class="line">    <span class="selector-class">.border-bottom</span><span class="selector-pseudo">::before</span>,</span><br><span class="line">    <span class="selector-class">.border-topbottom</span><span class="selector-pseudo">::before</span>,</span><br><span class="line">    <span class="selector-class">.border-topbottom</span><span class="selector-pseudo">::after</span>,</span><br><span class="line">    <span class="selector-class">.border-topleft</span><span class="selector-pseudo">::before</span>,</span><br><span class="line">    <span class="selector-class">.border-rightbottom</span><span class="selector-pseudo">::after</span>,</span><br><span class="line">    <span class="selector-class">.border-topright</span><span class="selector-pseudo">::before</span>,</span><br><span class="line">    <span class="selector-class">.border-bottomleft</span><span class="selector-pseudo">::before</span> &#123;</span><br><span class="line">        <span class="attribute">transform</span>: <span class="built_in">scaleY</span>(.<span class="number">33333</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="selector-class">.border-right</span><span class="selector-pseudo">::before</span>,</span><br><span class="line">    <span class="selector-class">.border-left</span><span class="selector-pseudo">::before</span>,</span><br><span class="line">    <span class="selector-class">.border-rightleft</span><span class="selector-pseudo">::before</span>,</span><br><span class="line">    <span class="selector-class">.border-rightleft</span><span class="selector-pseudo">::after</span>,</span><br><span class="line">    <span class="selector-class">.border-topleft</span><span class="selector-pseudo">::after</span>,</span><br><span class="line">    <span class="selector-class">.border-rightbottom</span><span class="selector-pseudo">::before</span>,</span><br><span class="line">    <span class="selector-class">.border-topright</span><span class="selector-pseudo">::after</span>,</span><br><span class="line">    <span class="selector-class">.border-bottomleft</span><span class="selector-pseudo">::after</span> &#123;</span><br><span class="line">        <span class="attribute">transform</span>: <span class="built_in">scaleX</span>(.<span class="number">33333</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div><div class="tab-pane" id="fourth-unique-name-2"><figure class="highlight css"><figcaption><span>reset.css</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">@charset</span> <span class="string">&quot;utf-8&quot;</span>;</span><br><span class="line"><span class="selector-tag">html</span>&#123;<span class="attribute">font-size</span>:<span class="number">12px</span>&#125;</span><br><span class="line"><span class="selector-tag">body</span>,<span class="selector-tag">ul</span>,<span class="selector-tag">ol</span>,<span class="selector-tag">dl</span>,<span class="selector-tag">dd</span>,<span class="selector-tag">h1</span>,<span class="selector-tag">h2</span>,<span class="selector-tag">h3</span>,<span class="selector-tag">h4</span>,<span class="selector-tag">h5</span>,<span class="selector-tag">h6</span>,<span class="selector-tag">figure</span>,<span class="selector-tag">form</span>,<span class="selector-tag">fieldset</span>,<span class="selector-tag">legend</span>,<span class="selector-tag">input</span>,<span class="selector-tag">textarea</span>,<span class="selector-tag">button</span>,<span class="selector-tag">p</span>,<span class="selector-tag">blockquote</span>,<span class="selector-tag">th</span>,<span class="selector-tag">td</span>,pre,xmp&#123;<span class="attribute">margin</span>:<span class="number">0</span>;<span class="attribute">padding</span>:<span class="number">0</span>&#125;</span><br><span class="line"><span class="selector-tag">body</span>,<span class="selector-tag">input</span>,<span class="selector-tag">textarea</span>,<span class="selector-tag">button</span>,select,pre,xmp,tt,<span class="selector-tag">code</span>,<span class="selector-tag">kbd</span>,<span class="selector-tag">samp</span>&#123;<span class="attribute">line-height</span>:<span class="number">1.5</span>;<span class="attribute">font-family</span>:tahoma,arial,<span class="string">&quot;Hiragino Sans GB&quot;</span>,simsun,sans-serif&#125;</span><br><span class="line"><span class="selector-tag">h1</span>,<span class="selector-tag">h2</span>,<span class="selector-tag">h3</span>,<span class="selector-tag">h4</span>,<span class="selector-tag">h5</span>,<span class="selector-tag">h6</span>,small,big,<span class="selector-tag">input</span>,<span class="selector-tag">textarea</span>,<span class="selector-tag">button</span>,select&#123;<span class="attribute">font-size</span>:<span class="number">100%</span>&#125;</span><br><span class="line"><span class="selector-tag">h1</span>,<span class="selector-tag">h2</span>,<span class="selector-tag">h3</span>,<span class="selector-tag">h4</span>,<span class="selector-tag">h5</span>,<span class="selector-tag">h6</span>&#123;<span class="attribute">font-family</span>:tahoma,arial,<span class="string">&quot;Hiragino Sans GB&quot;</span>,<span class="string">&quot;微软雅黑&quot;</span>,simsun,sans-serif&#125;</span><br><span class="line"><span class="selector-tag">h1</span>,<span class="selector-tag">h2</span>,<span class="selector-tag">h3</span>,<span class="selector-tag">h4</span>,<span class="selector-tag">h5</span>,<span class="selector-tag">h6</span>,<span class="selector-tag">b</span>,<span class="selector-tag">strong</span>&#123;<span class="attribute">font-weight</span>:normal&#125;</span><br><span class="line"><span class="selector-tag">address</span>,<span class="selector-tag">cite</span>,<span class="selector-tag">dfn</span>,<span class="selector-tag">em</span>,<span class="selector-tag">i</span>,optgroup,<span class="selector-tag">var</span>&#123;<span class="attribute">font-style</span>:normal&#125;</span><br><span class="line"><span class="selector-tag">table</span>&#123;<span class="attribute">border-collapse</span>:collapse;<span class="attribute">border-spacing</span>:<span class="number">0</span>;<span class="attribute">text-align</span><span class="selector-pseudo">:left</span>&#125;</span><br><span class="line"><span class="selector-tag">caption</span>,<span class="selector-tag">th</span>&#123;<span class="attribute">text-align</span>:inherit&#125;</span><br><span class="line"><span class="selector-tag">ul</span>,<span class="selector-tag">ol</span>,<span class="selector-tag">menu</span>&#123;<span class="attribute">list-style</span>:none&#125;</span><br><span class="line"><span class="selector-tag">fieldset</span>,<span class="selector-tag">img</span>&#123;<span class="attribute">border</span>:<span class="number">0</span>&#125;</span><br><span class="line"><span class="selector-tag">img</span>,<span class="selector-tag">object</span>,<span class="selector-tag">input</span>,<span class="selector-tag">textarea</span>,<span class="selector-tag">button</span>,select&#123;<span class="attribute">vertical-align</span>:middle&#125;</span><br><span class="line"><span class="selector-tag">article</span>,<span class="selector-tag">aside</span>,<span class="selector-tag">footer</span>,<span class="selector-tag">header</span>,<span class="selector-tag">section</span>,<span class="selector-tag">nav</span>,<span class="selector-tag">figure</span>,<span class="selector-tag">figcaption</span>,<span class="selector-tag">hgroup</span>,<span class="selector-tag">details</span>,<span class="selector-tag">menu</span>&#123;<span class="attribute">display</span>:block&#125;</span><br><span class="line"><span class="selector-tag">audio</span>,<span class="selector-tag">canvas</span>,<span class="selector-tag">video</span>&#123;<span class="attribute">display</span>:inline-block;*<span class="attribute">display</span>:inline;*zoom:<span class="number">1</span>&#125; <span class="comment">/* *符号是为了兼容旧版本IE浏览器，可以去掉 */</span></span><br><span class="line"><span class="selector-tag">blockquote</span><span class="selector-pseudo">:before</span>,<span class="selector-tag">blockquote</span><span class="selector-pseudo">:after</span>,<span class="selector-tag">q</span><span class="selector-pseudo">:before</span>,<span class="selector-tag">q</span><span class="selector-pseudo">:after</span>&#123;<span class="attribute">content</span>:<span class="string">&quot;\0020&quot;</span>&#125;</span><br><span class="line"><span class="selector-tag">textarea</span>&#123;<span class="attribute">overflow</span>:auto;<span class="attribute">resize</span>:vertical&#125;</span><br><span class="line"><span class="selector-tag">input</span>,<span class="selector-tag">textarea</span>,<span class="selector-tag">button</span>,select,<span class="selector-tag">a</span>&#123;<span class="attribute">outline</span>:<span class="number">0</span> none;<span class="attribute">border</span>: none;&#125;</span><br><span class="line"><span class="selector-tag">button</span>::-moz-focus-inner,input::-moz-focus-inner&#123;<span class="attribute">padding</span>:<span class="number">0</span>;<span class="attribute">border</span>:<span class="number">0</span>&#125;</span><br><span class="line"><span class="selector-tag">mark</span>&#123;<span class="attribute">background-color</span>:transparent&#125;</span><br><span class="line"><span class="selector-tag">a</span>,<span class="selector-tag">ins</span>,s,u,<span class="selector-tag">del</span>&#123;<span class="attribute">text-decoration</span>:none&#125;</span><br><span class="line"><span class="selector-tag">sup</span>,sub&#123;<span class="attribute">vertical-align</span>:baseline&#125;</span><br><span class="line"><span class="selector-tag">html</span> &#123;<span class="attribute">overflow-x</span>: hidden;<span class="attribute">height</span>: <span class="number">100%</span>;<span class="attribute">font-size</span>: <span class="number">50px</span>;-webkit-tap-highlight-<span class="attribute">color</span>: transparent;&#125;</span><br><span class="line"><span class="selector-tag">body</span> &#123;<span class="attribute">font-family</span>: Arial, <span class="string">&quot;Microsoft Yahei&quot;</span>, <span class="string">&quot;Helvetica Neue&quot;</span>, Helvetica, sans-serif;<span class="attribute">color</span>: <span class="number">#333</span>;<span class="attribute">font-size</span>: .<span class="number">28em</span>;<span class="attribute">line-height</span>: <span class="number">1</span>;-webkit-text-size-adjust: none;&#125;</span><br><span class="line">hr &#123;<span class="attribute">height</span>: .<span class="number">02rem</span>;<span class="attribute">margin</span>: .<span class="number">1rem</span> <span class="number">0</span>;<span class="attribute">border</span>: medium none;<span class="attribute">border-top</span>: .<span class="number">02rem</span> solid <span class="number">#cacaca</span>;&#125;</span><br><span class="line"><span class="selector-tag">a</span> &#123;<span class="attribute">color</span>: <span class="number">#25a4bb</span>;<span class="attribute">text-decoration</span>: none;&#125;</span><br></pre></td></tr></table></figure></div></div></div></p>
<p>2.在 src/main.js 中导入两个样式文件：<br />
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> <span class="string">&#x27;@/assets/styles/border.css&#x27;</span></span><br><span class="line"><span class="keyword">import</span> <span class="string">&#x27;@/assets/styles/reset.css&#x27;</span></span><br></pre></td></tr></table></figure></p>
<p>3.新建 src/views/Login.vue
作为登录页面（这里用到了scss样式，需要安装sass和sass-loader依赖），内容如下：<br />
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br></pre></td><td class="code"><pre><span class="line"> <span class="tag">&lt;<span class="name">template</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;login&quot;</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- el-form 是 element-plus组件 --&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- ref是引用名 class是类名(用于css样式定制)--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">el-form</span> <span class="attr">ref</span>=<span class="string">&quot;loginRef&quot;</span> <span class="attr">class</span>=<span class="string">&quot;login-form&quot;</span>&gt;</span></span><br><span class="line"></span><br><span class="line">      <span class="tag">&lt;<span class="name">h3</span> <span class="attr">class</span>=<span class="string">&quot;title&quot;</span>&gt;</span>后台管理系统<span class="tag">&lt;/<span class="name">h3</span>&gt;</span></span><br><span class="line"></span><br><span class="line">      <span class="tag">&lt;<span class="name">el-form-item</span> &gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">el-input</span> <span class="attr">type</span>=<span class="string">&quot;text&quot;</span> <span class="attr">size</span>=<span class="string">&quot;large&quot;</span> <span class="attr">auto-complete</span>=<span class="string">&quot;off&quot;</span> <span class="attr">placeholder</span>=<span class="string">&quot;账号&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">el-input</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;/<span class="name">el-form-item</span>&gt;</span></span><br><span class="line"></span><br><span class="line">      <span class="tag">&lt;<span class="name">el-form-item</span> &gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">el-input</span> <span class="attr">type</span>=<span class="string">&quot;password&quot;</span> <span class="attr">size</span>=<span class="string">&quot;large&quot;</span> <span class="attr">auto-complete</span>=<span class="string">&quot;off&quot;</span> <span class="attr">placeholder</span>=<span class="string">&quot;密码&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">el-input</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;/<span class="name">el-form-item</span>&gt;</span></span><br><span class="line"></span><br><span class="line">      <span class="tag">&lt;<span class="name">el-checkbox</span>  <span class="attr">style</span>=<span class="string">&quot;margin:0px 0px 25px 0px;&quot;</span>&gt;</span>记住密码<span class="tag">&lt;/<span class="name">el-checkbox</span>&gt;</span></span><br><span class="line"></span><br><span class="line">      <span class="tag">&lt;<span class="name">el-form-item</span> <span class="attr">style</span>=<span class="string">&quot;width:100%;&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">el-button</span> <span class="attr">size</span>=<span class="string">&quot;large&quot;</span> <span class="attr">type</span>=<span class="string">&quot;primary&quot;</span> <span class="attr">style</span>=<span class="string">&quot;width:100%;&quot;</span>&gt;</span></span><br><span class="line">          <span class="tag">&lt;<span class="name">span</span>&gt;</span>登 录<span class="tag">&lt;/<span class="name">span</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">el-button</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;/<span class="name">el-form-item</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;/<span class="name">el-form</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!--  底部  --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;el-login-footer&quot;</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">span</span>&gt;</span>Copyright © 2024-2025 <span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">&quot;http://www.baidu.com&quot;</span> <span class="attr">target</span>=<span class="string">&quot;_blank&quot;</span>&gt;</span>测试<span class="tag">&lt;/<span class="name">a</span>&gt;</span> 版权所有.<span class="tag">&lt;/<span class="name">span</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">    </span><br><span class="line">  <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">template</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span> <span class="attr">setup</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">&lt;!-- 使用scss，简化了css编写样式的复杂写法 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">style</span> <span class="attr">lang</span>=<span class="string">&quot;scss&quot;</span> <span class="attr">scoped</span>&gt;</span><span class="language-css"></span></span><br><span class="line"><span class="language-css"><span class="selector-tag">a</span>&#123;</span></span><br><span class="line"><span class="language-css">  <span class="attribute">color</span>:white <span class="comment">/* 对a标签(超链接)的文字颜色设置为白色 */</span></span></span><br><span class="line"><span class="language-css">&#125;</span></span><br><span class="line"><span class="language-css"><span class="selector-class">.login</span> &#123; <span class="comment">/* 类选择器，应用于所有login类的html元素 */</span></span></span><br><span class="line"><span class="language-css">  <span class="attribute">display</span>: flex; <span class="comment">/* Flexbox布局 */</span></span></span><br><span class="line"><span class="language-css">  <span class="attribute">justify-content</span>: center; <span class="comment">/* 设置了Flex容器中的子元素在主轴（默认是水平方向）上的对齐方式为居中对齐 */</span></span></span><br><span class="line"><span class="language-css">  <span class="attribute">align-items</span>: center; <span class="comment">/* 设置了Flex容器中的子元素在交叉轴（默认是垂直方向）上的对齐方式为居中对齐 */</span></span></span><br><span class="line"><span class="language-css">  <span class="attribute">height</span>: <span class="number">100%</span>; <span class="comment">/* 设置了元素的高度为其父元素高度的100% */</span></span></span><br><span class="line"><span class="language-css">  <span class="attribute">background-image</span>: <span class="built_in">url</span>(<span class="string">&quot;../assets/images/login-background.png&quot;</span>);<span class="comment">/* 新建images文件夹，找张背景图片即可 */</span></span></span><br><span class="line"><span class="language-css">  <span class="attribute">background-size</span>: cover;<span class="comment">/* 设置了背景图片的尺寸调整方式为覆盖：背景图片会被缩放以完全覆盖元素区域，同时保持图片的宽高比，可能会有部分图片内容被裁剪 */</span></span></span><br><span class="line"><span class="language-css">&#125;</span></span><br><span class="line"><span class="language-css"><span class="selector-class">.title</span> &#123;<span class="comment">/* 标题 */</span></span></span><br><span class="line"><span class="language-css">  <span class="attribute">margin</span>: <span class="number">0px</span> auto <span class="number">30px</span> auto;<span class="comment">/* margin 属性用于设置元素的外边距（即元素周围的空间）：0px 表示上边距为0像素，30px 表示下边距为30像素，auto 表示左右边距自动调整，这通常用于水平居中元素 */</span></span></span><br><span class="line"><span class="language-css">  <span class="attribute">text-align</span>: center;<span class="comment">/* 设置元素内文本的水平对齐方式为居中对齐 */</span></span></span><br><span class="line"><span class="language-css">  <span class="attribute">color</span>: <span class="number">#707070</span>;<span class="comment">/* 设置元素内文本的颜色，#707070 是一个十六进制颜色代码，表示一种灰色 */</span></span></span><br><span class="line"><span class="language-css">&#125;</span></span><br><span class="line"><span class="language-css"><span class="selector-class">.login-form</span> &#123;<span class="comment">/* 登录表单 */</span></span></span><br><span class="line"><span class="language-css">  <span class="attribute">border-radius</span>: <span class="number">6px</span>;<span class="comment">/* 设置表单的边框圆角为6像素 */</span></span></span><br><span class="line"><span class="language-css">  <span class="attribute">background</span>: <span class="number">#ffffff</span>;<span class="comment">/* 设置表单的背景颜色为白色 */</span></span></span><br><span class="line"><span class="language-css">  <span class="attribute">width</span>: <span class="number">400px</span>;<span class="comment">/* 设置表单的宽度为400像素 */</span></span></span><br><span class="line"><span class="language-css">  <span class="attribute">padding</span>: <span class="number">25px</span> <span class="number">25px</span> <span class="number">5px</span> <span class="number">25px</span>;<span class="comment">/* 设置表单的内边距，上、右、下、左分别为25像素、25像素、5像素、25像素 */</span></span></span><br><span class="line"><span class="language-css">  <span class="selector-class">.el-input</span> &#123;</span></span><br><span class="line"><span class="language-css">    <span class="attribute">height</span>: <span class="number">40px</span>;<span class="comment">/* 设置输入框的高度为40像素 */</span></span></span><br><span class="line"><span class="language-css">    <span class="selector-tag">input</span> &#123;</span></span><br><span class="line"><span class="language-css">      <span class="attribute">display</span>: inline-block;<span class="comment">/* 设置输入框为行内块元素，使其能够与其他元素在同一行显示 */</span></span></span><br><span class="line"><span class="language-css">      <span class="attribute">height</span>: <span class="number">40px</span>;<span class="comment">/* 设置输入框的高度为40像素 */</span></span></span><br><span class="line"><span class="language-css">    &#125;</span></span><br><span class="line"><span class="language-css">  &#125;</span></span><br><span class="line"><span class="language-css">  <span class="selector-class">.input-icon</span> &#123;</span></span><br><span class="line"><span class="language-css">    <span class="attribute">height</span>: <span class="number">39px</span>;<span class="comment">/* 设置输入框图标的的高度为39像素 */</span></span></span><br><span class="line"><span class="language-css">    <span class="attribute">width</span>: <span class="number">14px</span>;<span class="comment">/* 设置输入框图标的宽度为14像素 */</span></span></span><br><span class="line"><span class="language-css">    <span class="attribute">margin-left</span>: <span class="number">0px</span>;<span class="comment">/* 设置输入框图标的左边距为0像素 */</span></span></span><br><span class="line"><span class="language-css">  &#125;</span></span><br><span class="line"><span class="language-css">&#125;</span></span><br><span class="line"><span class="language-css"><span class="selector-class">.login-tip</span> &#123;<span class="comment">/* 提示信息 */</span></span></span><br><span class="line"><span class="language-css">  <span class="attribute">font-size</span>: <span class="number">13px</span>;<span class="comment">/* 设置了字体大小为13像素 */</span></span></span><br><span class="line"><span class="language-css">  <span class="attribute">text-align</span>: center;<span class="comment">/* 文本对齐方式设置为居中 */</span></span></span><br><span class="line"><span class="language-css">  <span class="attribute">color</span>: <span class="number">#bfbfbf</span>;<span class="comment">/* 设置了文本颜色为一种浅灰色 */</span></span></span><br><span class="line"><span class="language-css">&#125;</span></span><br><span class="line"><span class="language-css"><span class="selector-class">.login-code</span> &#123;<span class="comment">/* 验证码 */</span></span></span><br><span class="line"><span class="language-css">  <span class="attribute">width</span>: <span class="number">33%</span>;</span></span><br><span class="line"><span class="language-css">  <span class="attribute">height</span>: <span class="number">40px</span>;</span></span><br><span class="line"><span class="language-css">  <span class="attribute">float</span>: right;</span></span><br><span class="line"><span class="language-css">  <span class="selector-tag">img</span> &#123;</span></span><br><span class="line"><span class="language-css">    <span class="attribute">cursor</span>: pointer;</span></span><br><span class="line"><span class="language-css">    <span class="attribute">vertical-align</span>: middle;</span></span><br><span class="line"><span class="language-css">  &#125;</span></span><br><span class="line"><span class="language-css">&#125;</span></span><br><span class="line"><span class="language-css"><span class="selector-class">.el-login-footer</span> &#123;<span class="comment">/* 页脚 */</span></span></span><br><span class="line"><span class="language-css">  <span class="attribute">height</span>: <span class="number">40px</span>;<span class="comment">/* 设置高度为40像素 */</span></span></span><br><span class="line"><span class="language-css">  <span class="attribute">line-height</span>: <span class="number">40px</span>;<span class="comment">/* 设置行高为40像素 */</span></span></span><br><span class="line"><span class="language-css">  <span class="attribute">position</span>: fixed;<span class="comment">/* 使用固定定位，使页脚始终固定在视口底部 */</span></span></span><br><span class="line"><span class="language-css">  <span class="attribute">bottom</span>: <span class="number">0</span>;<span class="comment">/* 将页脚定位到视口的底部 */</span></span></span><br><span class="line"><span class="language-css">  <span class="attribute">width</span>: <span class="number">100%</span>;<span class="comment">/* 置页脚的宽度为100%，使其占满整个视口宽度 */</span></span></span><br><span class="line"><span class="language-css">  <span class="attribute">text-align</span>: center;<span class="comment">/* 文本居中对齐 */</span></span></span><br><span class="line"><span class="language-css">  <span class="attribute">color</span>: <span class="number">#fff</span>;<span class="comment">/* 设置文本颜色为白色 */</span></span></span><br><span class="line"><span class="language-css">  <span class="attribute">font-family</span>: Arial;<span class="comment">/* 设置字体为Arial */</span></span></span><br><span class="line"><span class="language-css">  <span class="attribute">font-size</span>: <span class="number">12px</span>;<span class="comment">/* 设置字体大小为12像素 */</span></span></span><br><span class="line"><span class="language-css">  <span class="attribute">letter-spacing</span>: <span class="number">1px</span>;<span class="comment">/* 设置字母间距为1像素 */</span></span></span><br><span class="line"><span class="language-css">&#125;</span></span><br><span class="line"><span class="language-css"><span class="selector-class">.login-code-img</span> &#123;</span></span><br><span class="line"><span class="language-css">  <span class="attribute">height</span>: <span class="number">40px</span>;</span></span><br><span class="line"><span class="language-css">  <span class="attribute">padding-left</span>: <span class="number">12px</span>;</span></span><br><span class="line"><span class="language-css">&#125;</span></span><br><span class="line"><span class="language-css"></span><span class="tag">&lt;/<span class="name">style</span>&gt;</span></span><br></pre></td></tr></table></figure></p>
<p>4.在 src/router/index.js 中添加登录页面的路由：<br />
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> routes = [</span><br><span class="line">  ...,</span><br><span class="line">  &#123;</span><br><span class="line">    <span class="attr">path</span>: <span class="string">&#x27;/login&#x27;</span>,</span><br><span class="line">    <span class="attr">name</span>: <span class="string">&#x27;login&#x27;</span>,</span><br><span class="line">    <span class="attr">component</span>: <span class="function">() =&gt;</span> <span class="keyword">import</span>(<span class="string">&#x27;../views/Login.vue&#x27;</span>)</span><br><span class="line">  &#125;</span><br><span class="line">]</span><br></pre></td></tr></table></figure></p>
<p>5.在 src/App.vue 中添加 <code>&lt;router-view/&gt;</code>
组件，用于显示当前路由匹配到的组件内容，并且设置html、body等高度为100%，让登录页背景图全显示出来（不然只显示一半高）：<br />
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">template</span>&gt;</span></span><br><span class="line">  <span class="comment">&lt;!-- &lt;nav&gt;</span></span><br><span class="line"><span class="comment">    &lt;router-link to=&quot;/&quot;&gt;Home&lt;/router-link&gt; |</span></span><br><span class="line"><span class="comment">    &lt;router-link to=&quot;/about&quot;&gt;About&lt;/router-link&gt;</span></span><br><span class="line"><span class="comment">  &lt;/nav&gt; --&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">router-view</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">template</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">style</span>&gt;</span><span class="language-css"></span></span><br><span class="line"><span class="language-css"><span class="comment">/* #app 指定是 &lt;div id=&quot;app&quot;&gt;，是整个Vue实例挂载的根元素，#是id选择器的意思 */</span></span></span><br><span class="line"><span class="language-css"><span class="comment">/* &lt;html&gt;、&lt;body&gt; 是html自带的标签，不需要加# */</span></span></span><br><span class="line"><span class="language-css"><span class="selector-tag">html</span>,<span class="selector-tag">body</span>,<span class="selector-id">#app</span> &#123;</span></span><br><span class="line"><span class="language-css">  <span class="attribute">font-family</span>: Avenir, Helvetica, Arial, sans-serif;</span></span><br><span class="line"><span class="language-css">  -webkit-<span class="attribute">font-smoothing</span>: antialiased;</span></span><br><span class="line"><span class="language-css">  -moz-osx-<span class="attribute">font-smoothing</span>: grayscale;</span></span><br><span class="line"><span class="language-css">  <span class="attribute">text-align</span>: center;</span></span><br><span class="line"><span class="language-css">  <span class="attribute">color</span>: <span class="number">#2c3e50</span>;</span></span><br><span class="line"><span class="language-css">  <span class="attribute">height</span>: <span class="number">100%</span>; <span class="comment">/* 设置高度为100%。这里想让到&lt;body&gt;高度为100%，让登录页背景图全显示 */</span></span></span><br><span class="line"><span class="language-css">&#125;</span></span><br><span class="line"><span class="language-css"><span class="selector-class">.app-container</span> &#123;<span class="comment">/* 类选择器 */</span></span></span><br><span class="line"><span class="language-css">  <span class="attribute">padding</span>:<span class="number">20px</span> <span class="comment">/* 在元素的内容和边框之间添加20像素的空间 */</span></span></span><br><span class="line"><span class="language-css">&#125;</span></span><br><span class="line"><span class="language-css"></span></span><br><span class="line"><span class="language-css"><span class="selector-tag">nav</span> &#123;</span></span><br><span class="line"><span class="language-css">  <span class="attribute">padding</span>: <span class="number">30px</span>;</span></span><br><span class="line"><span class="language-css">&#125;</span></span><br><span class="line"><span class="language-css"></span></span><br><span class="line"><span class="language-css"><span class="selector-tag">nav</span> <span class="selector-tag">a</span> &#123;<span class="comment">/* 定义 &lt;nav&gt; 元素内的 &lt;a&gt;（链接）标签的样式 */</span></span></span><br><span class="line"><span class="language-css">  <span class="attribute">font-weight</span>: bold;</span></span><br><span class="line"><span class="language-css">  <span class="attribute">color</span>: <span class="number">#2c3e50</span>;</span></span><br><span class="line"><span class="language-css">&#125;</span></span><br><span class="line"><span class="language-css"></span></span><br><span class="line"><span class="language-css"><span class="selector-tag">nav</span> <span class="selector-tag">a</span><span class="selector-class">.router-link-exact-active</span> &#123;</span></span><br><span class="line"><span class="language-css">  <span class="attribute">color</span>: <span class="number">#42b983</span>;</span></span><br><span class="line"><span class="language-css">&#125;</span></span><br><span class="line"><span class="language-css"></span><span class="tag">&lt;/<span class="name">style</span>&gt;</span></span><br></pre></td></tr></table></figure></p>
<h3 id="自定义icon">自定义icon</h3>
<p>想要在登录页的"账号"、"密码"输入框内显示一个用户图标，一个锁图标，需要自定义icon。<br />
1.新建 src/components/SvgIcon/index.vue
文件夹和文件，index.vue中定义svg-icon组件：<br />
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">template</span>&gt;</span></span><br><span class="line">  <span class="comment">&lt;!-- aria-hidden=&quot;true&quot; 表示对屏幕阅读器不可见 --&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">svg</span> <span class="attr">class</span>=<span class="string">&quot;svg-icon&quot;</span> <span class="attr">aria-hidden</span>=<span class="string">&quot;true&quot;</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- 将 iconName 这个组件的属性值绑定到 xlink:href 属性上 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">use</span> <span class="attr">:xlink:href</span>=<span class="string">&quot;iconName&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">use</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">svg</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">template</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span> <span class="attr">setup</span>&gt;</span><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript"><span class="comment">// 从 vue 包中导入 defineProps 和 computed 函数</span></span></span><br><span class="line"><span class="language-javascript"><span class="keyword">import</span> &#123; defineProps, computed &#125; <span class="keyword">from</span> <span class="string">&#x27;vue&#x27;</span></span></span><br><span class="line"><span class="language-javascript"><span class="comment">// 定义一个名为 icon 的 prop，它是一个字符串，并且是必需的</span></span></span><br><span class="line"><span class="language-javascript"><span class="keyword">const</span> props = <span class="title function_">defineProps</span>(&#123;</span></span><br><span class="line"><span class="language-javascript">  <span class="attr">icon</span>: &#123;</span></span><br><span class="line"><span class="language-javascript">    <span class="attr">type</span>: <span class="title class_">String</span>,</span></span><br><span class="line"><span class="language-javascript">    <span class="attr">required</span>: <span class="literal">true</span></span></span><br><span class="line"><span class="language-javascript">  &#125;</span></span><br><span class="line"><span class="language-javascript">&#125;)</span></span><br><span class="line"><span class="language-javascript"><span class="comment">// 创建一个计算属性 iconName，它返回一个字符串，该字符串由 #icon- 前缀和 icon prop 的值组成</span></span></span><br><span class="line"><span class="language-javascript"><span class="keyword">const</span> iconName = <span class="title function_">computed</span>(<span class="function">() =&gt;</span> &#123;</span></span><br><span class="line"><span class="language-javascript">  <span class="keyword">return</span> <span class="string">`#icon-<span class="subst">$&#123;props.icon&#125;</span>`</span></span></span><br><span class="line"><span class="language-javascript">&#125;)</span></span><br><span class="line"><span class="language-javascript"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">&lt;!-- lang=&quot;scss&quot; 指定了样式使用的是 SCSS（Sassy CSS）预处理器 --&gt;</span></span><br><span class="line"><span class="comment">&lt;!-- scoped的作用是限定样式只会应用到当前组件的元素上，而不会影响到其他组件的样式 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">style</span> <span class="attr">lang</span>=<span class="string">&quot;scss&quot;</span> <span class="attr">scoped</span>&gt;</span><span class="language-css"></span></span><br><span class="line"><span class="language-css"><span class="selector-class">.svg-icon</span> &#123;</span></span><br><span class="line"><span class="language-css">  <span class="attribute">width</span>: <span class="number">1em</span>; <span class="comment">/* 设置svg图片宽度，em 是一个相对单位，相对于当前元素的字体大小，1em意味着图标的宽度将与当前字体大小相同 */</span></span></span><br><span class="line"><span class="language-css">  <span class="attribute">height</span>: <span class="number">1em</span>; <span class="comment">/* 设置svg图片高度 */</span></span></span><br><span class="line"><span class="language-css">  <span class="attribute">vertical-align</span>: -<span class="number">0.15em</span>; <span class="comment">/* 设置垂直对齐方式，-0.15em 的值意味着图标将向上移动当前字体大小的 15%。这通常用于调整图标与文本的垂直对齐，使其看起来更加协调 */</span></span></span><br><span class="line"><span class="language-css">  fill: currentColor; <span class="comment">/* 设置SVG图标的填充颜色，currentColor 是一个关键字，表示使用当前文本颜色 */</span></span></span><br><span class="line"><span class="language-css">  <span class="attribute">overflow</span>: hidden; <span class="comment">/*设置元素内容的溢出处理方式，hidden 表示如果内容溢出元素框，则隐藏溢出的部分*/</span></span></span><br><span class="line"><span class="language-css">&#125;</span></span><br><span class="line"><span class="language-css"></span><span class="tag">&lt;/<span class="name">style</span>&gt;</span></span><br></pre></td></tr></table></figure></p>
<p>2.新建 src/icons/svg 文件夹存放icon，然后新建 src/icons/index.js
文件，将svg-icon组件注册到全局：<br />
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> <span class="title class_">SvgIcon</span> <span class="keyword">from</span> <span class="string">&#x27;@/components/SvgIcon&#x27;</span> <span class="comment">//导入SvgIcon组件</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//require.context是Webpack提供的一个功能，用于创建一个包含了指定目录下所有文件的上下文</span></span><br><span class="line"><span class="comment">//这里，它被用来创建一个上下文，该上下文包含了./svg目录下所有以.svg结尾的文件</span></span><br><span class="line"><span class="comment">//&#x27;./svg&#x27;：指定要查找的目录。false：表示不查找子目录。\.svg$：正则表达式，用于匹配以.svg结尾的文件。</span></span><br><span class="line"><span class="keyword">const</span> svgRequired = <span class="built_in">require</span>.<span class="title function_">context</span>(<span class="string">&#x27;./svg&#x27;</span>, <span class="literal">false</span>, <span class="regexp">/\.svg$/</span>)</span><br><span class="line"><span class="comment">//遍历上下文中的所有文件，并导入它们</span></span><br><span class="line">svgRequired.<span class="title function_">keys</span>().<span class="title function_">forEach</span>(<span class="function">(<span class="params">item</span>) =&gt;</span> <span class="title function_">svgRequired</span>(item))</span><br><span class="line"></span><br><span class="line"><span class="comment">//定义并导出一个默认函数，该函数接收一个Vue应用实例app作为参数</span></span><br><span class="line"><span class="comment">//在函数内部，使用app.component方法将SvgIcon组件注册为全局组件，组件名为&#x27;svg-icon&#x27;</span></span><br><span class="line"><span class="comment">//这样，在任何Vue模板中都可以使用&lt;svg-icon&gt;&lt;/svg-icon&gt;标签来使用这个组件</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> (app) =&gt; &#123;</span><br><span class="line">    app.<span class="title function_">component</span>(<span class="string">&#x27;svg-icon&#x27;</span>, <span class="title class_">SvgIcon</span>)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>3.需要安装webpack（静态模块打包器）和svg-sprite-loader（Webpack的加载器，专门用于将SVG图标打包成SVG
sprite）依赖。<br />
4.配置项目下的 vue.config.js 文件，添加svg图标配置：<br />
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> &#123; defineConfig &#125; = <span class="built_in">require</span>(<span class="string">&#x27;@vue/cli-service&#x27;</span>)<span class="comment">//引入默认配置函数defineConfig</span></span><br><span class="line"><span class="variable language_">module</span>.<span class="property">exports</span> = <span class="title function_">defineConfig</span>(&#123;</span><br><span class="line">  <span class="comment">//这个属性设置为 true 时，表示项目中的依赖包也会被 Babel 转译</span></span><br><span class="line">  <span class="comment">//默认情况下，Vue CLI 只会转译 src 目录下的文件。</span></span><br><span class="line">  <span class="comment">//如果项目依赖了一些使用了现代 JavaScript 特性的第三方库，并且这些库没有提供编译后的代码，设置这个选项为 true 可以确保这些依赖在旧版浏览器中也能正常运行</span></span><br><span class="line">  <span class="attr">transpileDependencies</span>: <span class="literal">true</span>, </span><br><span class="line">  <span class="comment">//开发服务器配置</span></span><br><span class="line">  <span class="attr">devServer</span>: &#123;</span><br><span class="line">      <span class="attr">port</span>: <span class="number">8080</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> webpack = <span class="built_in">require</span>(<span class="string">&#x27;webpack&#x27;</span>);</span><br><span class="line"><span class="keyword">const</span> path = <span class="built_in">require</span>(<span class="string">&#x27;path&#x27;</span>)</span><br><span class="line"><span class="comment">//接收一个dir，用于拼接成一个绝对路径</span></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">resolve</span>(<span class="params">dir</span>) &#123;</span><br><span class="line">    <span class="comment">//__dirname是Node.js中的一个全局变量，表示当前执行脚本所在的目录</span></span><br><span class="line">    <span class="comment">//将__dirname和传入的dir参数连接起来，可以生成一个绝对路径，确保无论项目在何处运行，路径都是正确的</span></span><br><span class="line">    <span class="keyword">return</span> path.<span class="title function_">join</span>(__dirname, dir) </span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//配置了 webpack 来处理 SVG 文件，并使用 svg-sprite-loader 来加载 SVG 图标</span></span><br><span class="line"><span class="variable language_">module</span>.<span class="property">exports</span> = &#123;</span><br><span class="line">    <span class="attr">lintOnSave</span>: <span class="literal">false</span>, <span class="comment">//关闭了 Vue CLI 在保存文件时自动进行代码质量检查（linting）的功能</span></span><br><span class="line">    <span class="comment">//chainWebpack 是一个函数，接收一个 config 参数，这个参数是 webpack 的配置对象。</span></span><br><span class="line">    <span class="comment">//通过这个函数，可以对 webpack 的配置进行链式修改</span></span><br><span class="line">    <span class="title function_">chainWebpack</span>(<span class="params">config</span>) &#123;</span><br><span class="line">        <span class="comment">// 设置 svg-sprite-loader</span></span><br><span class="line">        <span class="comment">// config.module 表示创建一个具名规则，以后用来修改规则</span></span><br><span class="line">        <span class="comment">//创建了一个名为 svg 的规则，并设置了一个排除项，排除 src/icons 目录下的 SVG 文件。</span></span><br><span class="line">        <span class="comment">//这意味着 src/icons 目录下的 SVG 文件不会被默认的 SVG loader 处理</span></span><br><span class="line">        config.<span class="property">module</span></span><br><span class="line">            <span class="comment">// 规则</span></span><br><span class="line">            .<span class="title function_">rule</span>(<span class="string">&#x27;svg&#x27;</span>)</span><br><span class="line">            <span class="comment">// 忽略</span></span><br><span class="line">            .<span class="property">exclude</span>.<span class="title function_">add</span>(<span class="title function_">resolve</span>(<span class="string">&#x27;src/icons&#x27;</span>))</span><br><span class="line">            <span class="comment">// 结束</span></span><br><span class="line">            .<span class="title function_">end</span>()</span><br><span class="line">        <span class="comment">// 创建了一个名为 icons 的规则，用于处理 src/icons 目录下的 .svg 文件。</span></span><br><span class="line">        <span class="comment">// 它使用了 svg-sprite-loader 来加载这些文件，并设置了 symbolId 为 icon-[name]，其中 [name] 是文件名</span></span><br><span class="line">        config.<span class="property">module</span></span><br><span class="line">            <span class="comment">// 规则</span></span><br><span class="line">            .<span class="title function_">rule</span>(<span class="string">&#x27;icons&#x27;</span>)</span><br><span class="line">            <span class="comment">// 正则，解析 .svg 格式文件</span></span><br><span class="line">            .<span class="title function_">test</span>(<span class="regexp">/\.svg$/</span>)</span><br><span class="line">            <span class="comment">// 解析的文件</span></span><br><span class="line">            .<span class="property">include</span>.<span class="title function_">add</span>(<span class="title function_">resolve</span>(<span class="string">&#x27;src/icons&#x27;</span>))</span><br><span class="line">            <span class="comment">// 结束</span></span><br><span class="line">            .<span class="title function_">end</span>()</span><br><span class="line">            <span class="comment">// 新增了一个解析的loader</span></span><br><span class="line">            .<span class="title function_">use</span>(<span class="string">&#x27;svg-sprite-loader&#x27;</span>)</span><br><span class="line">            <span class="comment">// 具体的loader</span></span><br><span class="line">            .<span class="title function_">loader</span>(<span class="string">&#x27;svg-sprite-loader&#x27;</span>)</span><br><span class="line">            <span class="comment">// loader 的配置</span></span><br><span class="line">            .<span class="title function_">options</span>(&#123;</span><br><span class="line">                <span class="attr">symbolId</span>: <span class="string">&#x27;icon-[name]&#x27;</span></span><br><span class="line">            &#125;)</span><br><span class="line">            <span class="comment">// 结束</span></span><br><span class="line">            .<span class="title function_">end</span>()</span><br><span class="line">        <span class="comment">//使用 webpack.ContextReplacementPlugin 插件来忽略 moment.js 库中除了 zh-cn（中文）以外的本地化文件，以减小打包后的文件体积</span></span><br><span class="line">        config</span><br><span class="line">            .<span class="title function_">plugin</span>(<span class="string">&#x27;ignore&#x27;</span>)</span><br><span class="line">            .<span class="title function_">use</span>(</span><br><span class="line">                <span class="keyword">new</span> webpack.<span class="title class_">ContextReplacementPlugin</span>(<span class="regexp">/moment[/\\]locale$/</span>, <span class="regexp">/zh-cn$/</span>)</span><br><span class="line">            )</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>5.入口文件main.js中引入svg相关组件：<br />
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> <span class="title class_">SvgIcon</span> <span class="keyword">from</span> <span class="string">&#x27;@/icons&#x27;</span> <span class="comment">//导入svg</span></span><br><span class="line"><span class="comment">//因为SvgIcon，修改导入组件的方式</span></span><br><span class="line"><span class="keyword">const</span> app = <span class="title function_">createApp</span>(<span class="title class_">App</span>)</span><br><span class="line"><span class="title class_">SvgIcon</span>(app)</span><br><span class="line">app.<span class="title function_">use</span>(store).<span class="title function_">use</span>(router).<span class="title function_">use</span>(<span class="title class_">ElementPlus</span>).<span class="title function_">mount</span>(<span class="string">&#x27;#app&#x27;</span>)</span><br><span class="line"></span><br></pre></td></tr></table></figure></p>
<p>6.在 src/views/Login.vue 中使用svg-icon组件：<br />
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">el-form-item</span> &gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">el-input</span> <span class="attr">type</span>=<span class="string">&quot;text&quot;</span> <span class="attr">size</span>=<span class="string">&quot;large&quot;</span> <span class="attr">auto-complete</span>=<span class="string">&quot;off&quot;</span> <span class="attr">placeholder</span>=<span class="string">&quot;账号&quot;</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- 使用自定义组件svg-icon，显示user图标 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">template</span> #<span class="attr">prefix</span>&gt;</span><span class="tag">&lt;<span class="name">svg-icon</span> <span class="attr">icon</span>=<span class="string">&quot;user&quot;</span> /&gt;</span><span class="tag">&lt;/<span class="name">template</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">el-input</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">el-form-item</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">el-form-item</span> &gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">el-input</span> <span class="attr">type</span>=<span class="string">&quot;password&quot;</span> <span class="attr">size</span>=<span class="string">&quot;large&quot;</span> <span class="attr">auto-complete</span>=<span class="string">&quot;off&quot;</span> <span class="attr">placeholder</span>=<span class="string">&quot;密码&quot;</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- 使用自定义组件svg-icon，显示password图标 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">template</span> #<span class="attr">prefix</span>&gt;</span><span class="tag">&lt;<span class="name">svg-icon</span> <span class="attr">icon</span>=<span class="string">&quot;password&quot;</span> /&gt;</span><span class="tag">&lt;/<span class="name">template</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">el-input</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">el-form-item</span>&gt;</span></span><br></pre></td></tr></table></figure></p>
<h3 id="登录逻辑">登录逻辑</h3>
<p>在 src/views/Login.vue
中添加登录逻辑，包括表单验证、表单数据绑定，以及调用后端接口进行登录验证。具体代码如下：<br />
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">template</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;login&quot;</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- el-form 是 element-plus组件 --&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- ref为表单组件指定一个引用名称，以便在代码中可以通过这个引用名称来访问表单组件的方法和属性 --&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- class是类名(用于css样式定制) --&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- :model是 v-bind 的简写形式，用于绑定数据。</span></span><br><span class="line"><span class="comment">      即表单控件的值会与 loginForm 对象中的属性进行双向绑定，</span></span><br><span class="line"><span class="comment">      该表单的数据模型将通过名为 loginForm 的变量进行管理 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">el-form</span> <span class="attr">:model</span>=<span class="string">&quot;loginForm&quot;</span> <span class="attr">:rules</span>=<span class="string">&quot;loginRules&quot;</span> <span class="attr">ref</span>=<span class="string">&quot;loginRef&quot;</span> <span class="attr">class</span>=<span class="string">&quot;login-form&quot;</span>&gt;</span></span><br><span class="line"></span><br><span class="line">      <span class="tag">&lt;<span class="name">h3</span> <span class="attr">class</span>=<span class="string">&quot;title&quot;</span>&gt;</span>后台管理系统<span class="tag">&lt;/<span class="name">h3</span>&gt;</span></span><br><span class="line">      <span class="comment">&lt;!-- 配置prop属性，用于loginRules规则匹配 --&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">el-form-item</span> <span class="attr">prop</span>=<span class="string">&quot;username&quot;</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!-- 输入框绑定到LoginForm.username --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">el-input</span> <span class="attr">v-model</span>=<span class="string">&quot;loginForm.username&quot;</span> <span class="attr">type</span>=<span class="string">&quot;text&quot;</span> <span class="attr">size</span>=<span class="string">&quot;large&quot;</span> <span class="attr">auto-complete</span>=<span class="string">&quot;off&quot;</span> <span class="attr">placeholder</span>=<span class="string">&quot;账号&quot;</span>&gt;</span></span><br><span class="line">          <span class="comment">&lt;!-- 使用自定义组件svg-icon，显示user图标 --&gt;</span></span><br><span class="line">          <span class="tag">&lt;<span class="name">template</span> #<span class="attr">prefix</span>&gt;</span><span class="tag">&lt;<span class="name">svg-icon</span> <span class="attr">icon</span>=<span class="string">&quot;user&quot;</span> /&gt;</span><span class="tag">&lt;/<span class="name">template</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">el-input</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;/<span class="name">el-form-item</span>&gt;</span></span><br><span class="line"></span><br><span class="line">      <span class="tag">&lt;<span class="name">el-form-item</span>  <span class="attr">prop</span>=<span class="string">&quot;password&quot;</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!-- 输入框绑定到LoginForm.password --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">el-input</span> <span class="attr">v-model</span>=<span class="string">&quot;loginForm.password&quot;</span> <span class="attr">type</span>=<span class="string">&quot;password&quot;</span> <span class="attr">size</span>=<span class="string">&quot;large&quot;</span> <span class="attr">auto-complete</span>=<span class="string">&quot;off&quot;</span> <span class="attr">placeholder</span>=<span class="string">&quot;密码&quot;</span>&gt;</span></span><br><span class="line">          <span class="comment">&lt;!-- 使用自定义组件svg-icon，显示password图标 --&gt;</span></span><br><span class="line">          <span class="tag">&lt;<span class="name">template</span> #<span class="attr">prefix</span>&gt;</span><span class="tag">&lt;<span class="name">svg-icon</span> <span class="attr">icon</span>=<span class="string">&quot;password&quot;</span> /&gt;</span><span class="tag">&lt;/<span class="name">template</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">el-input</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;/<span class="name">el-form-item</span>&gt;</span></span><br><span class="line"></span><br><span class="line">      <span class="comment">&lt;!-- &lt;el-checkbox  style=&quot;margin:0px 0px 25px 0px;&quot;&gt;记住密码&lt;/el-checkbox&gt; --&gt;</span></span><br><span class="line"></span><br><span class="line">      <span class="tag">&lt;<span class="name">el-form-item</span> <span class="attr">style</span>=<span class="string">&quot;width:100%;&quot;</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!-- 绑定触发事件handleLogin --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">el-button</span> @<span class="attr">click.prevent</span>=<span class="string">&quot;handleLogin&quot;</span> <span class="attr">size</span>=<span class="string">&quot;large&quot;</span> <span class="attr">type</span>=<span class="string">&quot;primary&quot;</span> <span class="attr">style</span>=<span class="string">&quot;width:100%;&quot;</span>&gt;</span></span><br><span class="line">          <span class="tag">&lt;<span class="name">span</span>&gt;</span>登 录<span class="tag">&lt;/<span class="name">span</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">el-button</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;/<span class="name">el-form-item</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;/<span class="name">el-form</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!--  底部  --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;el-login-footer&quot;</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">span</span>&gt;</span>Copyright © 2024-2025 <span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">&quot;http://www.baidu.com&quot;</span> <span class="attr">target</span>=<span class="string">&quot;_blank&quot;</span>&gt;</span>测试<span class="tag">&lt;/<span class="name">a</span>&gt;</span> 版权所有.<span class="tag">&lt;/<span class="name">span</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">    </span><br><span class="line">  <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">template</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span> <span class="attr">setup</span>&gt;</span><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript"><span class="keyword">import</span> &#123; ref &#125; <span class="keyword">from</span> <span class="string">&#x27;vue&#x27;</span> <span class="comment">//ref 是 Vue 3 中用于创建响应式数据的函数</span></span></span><br><span class="line"><span class="language-javascript"><span class="keyword">import</span> &#123;<span class="title class_">ElMessage</span>&#125; <span class="keyword">from</span> <span class="string">&#x27;element-plus&#x27;</span> <span class="comment">//引入消息提示组件</span></span></span><br><span class="line"><span class="language-javascript"><span class="keyword">import</span> qs <span class="keyword">from</span> <span class="string">&#x27;qs&#x27;</span> <span class="comment">//用来将对象转换成url中的query参数</span></span></span><br><span class="line"><span class="language-javascript"><span class="keyword">import</span> request <span class="keyword">from</span> <span class="string">&#x27;@/util/request&#x27;</span>;</span></span><br><span class="line"><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript"><span class="comment">// 创建一个响应式对象 loginRef，用于存储表单引用（用于表单提交、验证）</span></span></span><br><span class="line"><span class="language-javascript"><span class="keyword">const</span> loginRef = <span class="title function_">ref</span>(<span class="literal">null</span>)</span></span><br><span class="line"><span class="language-javascript"><span class="comment">// 创建一个响应式对象 LoginForm，用于存储表单数据</span></span></span><br><span class="line"><span class="language-javascript"><span class="keyword">const</span> loginForm = <span class="title function_">ref</span>(&#123;</span></span><br><span class="line"><span class="language-javascript">    <span class="attr">username</span>: <span class="string">&#x27;&#x27;</span>,</span></span><br><span class="line"><span class="language-javascript">    <span class="attr">password</span>: <span class="string">&#x27;&#x27;</span></span></span><br><span class="line"><span class="language-javascript">&#125;)</span></span><br><span class="line"><span class="language-javascript"><span class="comment">// 创建一个响应式对象 loginRules，用于存储表单验证规则（不能为空）</span></span></span><br><span class="line"><span class="language-javascript"><span class="keyword">const</span> loginRules = &#123;</span></span><br><span class="line"><span class="language-javascript">    <span class="comment">//required: true：表示这个字段是必填的，不能为空。</span></span></span><br><span class="line"><span class="language-javascript">    <span class="comment">//trigger: &quot;blur&quot;：表示验证触发的事件是失去焦点（blur），系统会自动验证输入的内容是否符合规则。</span></span></span><br><span class="line"><span class="language-javascript">    <span class="comment">//message: &quot;请输入您的账号&quot;：表示当验证失败时，显示的错误信息。</span></span></span><br><span class="line"><span class="language-javascript">    <span class="attr">username</span>: [&#123;<span class="attr">required</span>: <span class="literal">true</span>, <span class="attr">trigger</span>: <span class="string">&quot;blur&quot;</span>, <span class="attr">message</span>: <span class="string">&quot;请输入您的账号&quot;</span>&#125;],</span></span><br><span class="line"><span class="language-javascript">    <span class="attr">password</span>: [&#123;<span class="attr">required</span>: <span class="literal">true</span>, <span class="attr">trigger</span>: <span class="string">&quot;blur&quot;</span>, <span class="attr">message</span>: <span class="string">&quot;请输入您的密码&quot;</span>&#125;]</span></span><br><span class="line"><span class="language-javascript">&#125;;</span></span><br><span class="line"><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript"><span class="keyword">const</span> <span class="title function_">handleLogin</span> = (<span class="params"></span>) =&gt; &#123;</span></span><br><span class="line"><span class="language-javascript">    <span class="comment">// 调用表单的 validate 方法进行表单验证</span></span></span><br><span class="line"><span class="language-javascript">    loginRef.<span class="property">value</span>.<span class="title function_">validate</span>(<span class="keyword">async</span> (valid) =&gt; &#123;</span></span><br><span class="line"><span class="language-javascript">        <span class="keyword">if</span> (valid) &#123;<span class="comment">// 如果验证通过，则执行登录操作</span></span></span><br><span class="line"><span class="language-javascript">          <span class="keyword">let</span> result = <span class="keyword">await</span> request.<span class="title function_">post</span>(<span class="string">&quot;user/login?&quot;</span> + qs.<span class="title function_">stringify</span>(loginForm.<span class="property">value</span>))</span></span><br><span class="line"><span class="language-javascript">          <span class="variable language_">console</span>.<span class="title function_">log</span>(result)</span></span><br><span class="line"><span class="language-javascript">          <span class="keyword">let</span> data = result.<span class="property">data</span> <span class="comment">//获取后端响应，data为后端响应的数据</span></span></span><br><span class="line"><span class="language-javascript">          <span class="keyword">if</span> (data.<span class="property">code</span> == <span class="number">200</span>) &#123;</span></span><br><span class="line"><span class="language-javascript">            <span class="title class_">ElMessage</span>.<span class="title function_">success</span>(data.<span class="property">info</span>) <span class="comment">//弹窗提示</span></span></span><br><span class="line"><span class="language-javascript">            <span class="comment">//存储token到sessionStorage</span></span></span><br><span class="line"><span class="language-javascript">            <span class="variable language_">window</span>.<span class="property">sessionStorage</span>.<span class="title function_">setItem</span>(<span class="string">&quot;token&quot;</span>, data.<span class="property">token</span>)</span></span><br><span class="line"><span class="language-javascript">          &#125; <span class="keyword">else</span> &#123;</span></span><br><span class="line"><span class="language-javascript">            <span class="title class_">ElMessage</span>.<span class="title function_">error</span>(data.<span class="property">info</span>) <span class="comment">//弹窗提示</span></span></span><br><span class="line"><span class="language-javascript">          &#125;</span></span><br><span class="line"><span class="language-javascript">        &#125; <span class="keyword">else</span> &#123;<span class="comment">// 如果验证失败，则显示错误信息</span></span></span><br><span class="line"><span class="language-javascript">            <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;表单验证失败&#x27;</span>);</span></span><br><span class="line"><span class="language-javascript">        &#125;</span></span><br><span class="line"><span class="language-javascript">    &#125;);</span></span><br><span class="line"><span class="language-javascript">&#125;</span></span><br><span class="line"><span class="language-javascript"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">&lt;!-- 使用scss，简化了css编写样式的复杂写法 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">style</span> <span class="attr">lang</span>=<span class="string">&quot;scss&quot;</span> <span class="attr">scoped</span>&gt;</span><span class="language-css"></span></span><br><span class="line"><span class="language-css"><span class="selector-tag">a</span>&#123;</span></span><br><span class="line"><span class="language-css">  <span class="attribute">color</span>:white <span class="comment">/* 对a标签(超链接)的文字颜色设置为白色 */</span></span></span><br><span class="line"><span class="language-css">&#125;</span></span><br><span class="line"><span class="language-css"><span class="selector-class">.login</span> &#123; <span class="comment">/* 类选择器，应用于所有login类的html元素 */</span></span></span><br><span class="line"><span class="language-css">  <span class="attribute">display</span>: flex; <span class="comment">/* Flexbox布局 */</span></span></span><br><span class="line"><span class="language-css">  <span class="attribute">justify-content</span>: center; <span class="comment">/* 设置了Flex容器中的子元素在主轴（默认是水平方向）上的对齐方式为居中对齐 */</span></span></span><br><span class="line"><span class="language-css">  <span class="attribute">align-items</span>: center; <span class="comment">/* 设置了Flex容器中的子元素在交叉轴（默认是垂直方向）上的对齐方式为居中对齐 */</span></span></span><br><span class="line"><span class="language-css">  <span class="attribute">height</span>: <span class="number">100%</span>; <span class="comment">/* 设置了元素的高度为其父元素高度的100% */</span></span></span><br><span class="line"><span class="language-css">  <span class="attribute">background-image</span>: <span class="built_in">url</span>(<span class="string">&quot;../assets/images/login-background.png&quot;</span>);<span class="comment">/* 新建images文件夹，找张背景图片即可 */</span></span></span><br><span class="line"><span class="language-css">  <span class="attribute">background-size</span>: cover;<span class="comment">/* 设置了背景图片的尺寸调整方式为覆盖：背景图片会被缩放以完全覆盖元素区域，同时保持图片的宽高比，可能会有部分图片内容被裁剪 */</span></span></span><br><span class="line"><span class="language-css">&#125;</span></span><br><span class="line"><span class="language-css"><span class="selector-class">.title</span> &#123;<span class="comment">/* 标题  */</span></span></span><br><span class="line"><span class="language-css">  <span class="attribute">margin</span>: <span class="number">0px</span> auto <span class="number">30px</span> auto;<span class="comment">/* margin 属性用于设置元素的外边距（即元素周围的空间）：0px 表示上边距为0像素，30px 表示下边距为30像素，auto 表示左右边距自动调整，这通常用于水平居中元素 */</span></span></span><br><span class="line"><span class="language-css">  <span class="attribute">text-align</span>: center;<span class="comment">/* 设置元素内文本的水平对齐方式为居中对齐 */</span></span></span><br><span class="line"><span class="language-css">  <span class="attribute">color</span>: <span class="number">#707070</span>;<span class="comment">/* 设置元素内文本的颜色，#707070 是一个十六进制颜色代码，表示一种灰色 */</span></span></span><br><span class="line"><span class="language-css">&#125;</span></span><br><span class="line"><span class="language-css"><span class="selector-class">.login-form</span> &#123;<span class="comment">/* 登录表单 */</span></span></span><br><span class="line"><span class="language-css">  <span class="attribute">border-radius</span>: <span class="number">6px</span>;<span class="comment">/* 设置表单的边框圆角为6像素 */</span></span></span><br><span class="line"><span class="language-css">  <span class="attribute">background</span>: <span class="number">#ffffff</span>;<span class="comment">/* 设置表单的背景颜色为白色 */</span></span></span><br><span class="line"><span class="language-css">  <span class="attribute">width</span>: <span class="number">400px</span>;<span class="comment">/* 设置表单的宽度为400像素 */</span></span></span><br><span class="line"><span class="language-css">  <span class="attribute">padding</span>: <span class="number">25px</span> <span class="number">25px</span> <span class="number">5px</span> <span class="number">25px</span>;<span class="comment">/* 设置表单的内边距，上、右、下、左分别为25像素、25像素、5像素、25像素 */</span></span></span><br><span class="line"><span class="language-css">  <span class="selector-class">.el-input</span> &#123;</span></span><br><span class="line"><span class="language-css">    <span class="attribute">height</span>: <span class="number">40px</span>;<span class="comment">/* 设置输入框的高度为40像素 */</span></span></span><br><span class="line"><span class="language-css">    <span class="selector-tag">input</span> &#123;</span></span><br><span class="line"><span class="language-css">      <span class="attribute">display</span>: inline-block;<span class="comment">/* 设置输入框为行内块元素，使其能够与其他元素在同一行显示 */</span></span></span><br><span class="line"><span class="language-css">      <span class="attribute">height</span>: <span class="number">40px</span>;<span class="comment">/* 设置输入框的高度为40像素 */</span></span></span><br><span class="line"><span class="language-css">    &#125;</span></span><br><span class="line"><span class="language-css">  &#125;</span></span><br><span class="line"><span class="language-css">  <span class="selector-class">.input-icon</span> &#123;</span></span><br><span class="line"><span class="language-css">    <span class="attribute">height</span>: <span class="number">39px</span>;<span class="comment">/* 设置输入框图标的的高度为39像素 */</span></span></span><br><span class="line"><span class="language-css">    <span class="attribute">width</span>: <span class="number">14px</span>;<span class="comment">/* 设置输入框图标的宽度为14像素 */</span></span></span><br><span class="line"><span class="language-css">    <span class="attribute">margin-left</span>: <span class="number">0px</span>;<span class="comment">/* 设置输入框图标的左边距为0像素 */</span></span></span><br><span class="line"><span class="language-css">  &#125;</span></span><br><span class="line"><span class="language-css">&#125;</span></span><br><span class="line"><span class="language-css"><span class="selector-class">.login-tip</span> &#123;<span class="comment">/* 提示信息 */</span></span></span><br><span class="line"><span class="language-css">  <span class="attribute">font-size</span>: <span class="number">13px</span>; <span class="comment">/* 设置了字体大小为13像素 */</span></span></span><br><span class="line"><span class="language-css">  <span class="attribute">text-align</span>: center;<span class="comment">/* 文本对齐方式设置为居中 */</span></span></span><br><span class="line"><span class="language-css">  <span class="attribute">color</span>: <span class="number">#bfbfbf</span>;<span class="comment">/* 设置了文本颜色为一种浅灰色 */</span></span></span><br><span class="line"><span class="language-css">&#125;</span></span><br><span class="line"><span class="language-css"><span class="selector-class">.login-code</span> &#123;<span class="comment">/* 验证码 */</span></span></span><br><span class="line"><span class="language-css">  <span class="attribute">width</span>: <span class="number">33%</span>;</span></span><br><span class="line"><span class="language-css">  <span class="attribute">height</span>: <span class="number">40px</span>;</span></span><br><span class="line"><span class="language-css">  <span class="attribute">float</span>: right;</span></span><br><span class="line"><span class="language-css">  <span class="selector-tag">img</span> &#123;</span></span><br><span class="line"><span class="language-css">    <span class="attribute">cursor</span>: pointer;</span></span><br><span class="line"><span class="language-css">    <span class="attribute">vertical-align</span>: middle;</span></span><br><span class="line"><span class="language-css">  &#125;</span></span><br><span class="line"><span class="language-css">&#125;</span></span><br><span class="line"><span class="language-css"><span class="selector-class">.el-login-footer</span> &#123;<span class="comment">/* 页脚 */</span></span></span><br><span class="line"><span class="language-css">  <span class="attribute">height</span>: <span class="number">40px</span>;<span class="comment">/* 设置高度为40像素 */</span></span></span><br><span class="line"><span class="language-css">  <span class="attribute">line-height</span>: <span class="number">40px</span>;<span class="comment">/* 设置行高为40像素 */</span></span></span><br><span class="line"><span class="language-css">  <span class="attribute">position</span>: fixed;<span class="comment">/* 使用固定定位，使页脚始终固定在视口底部 */</span></span></span><br><span class="line"><span class="language-css">  <span class="attribute">bottom</span>: <span class="number">0</span>;<span class="comment">/* 将页脚定位到视口的底部 */</span></span></span><br><span class="line"><span class="language-css">  <span class="attribute">width</span>: <span class="number">100%</span>;<span class="comment">/* 置页脚的宽度为100%，使其占满整个视口宽度 */</span></span></span><br><span class="line"><span class="language-css">  <span class="attribute">text-align</span>: center;<span class="comment">/* 文本居中对齐 */</span></span></span><br><span class="line"><span class="language-css">  <span class="attribute">color</span>: <span class="number">#fff</span>;<span class="comment">/* 设置文本颜色为白色 */</span></span></span><br><span class="line"><span class="language-css">  <span class="attribute">font-family</span>: Arial;<span class="comment">/* 设置字体为Arial */</span></span></span><br><span class="line"><span class="language-css">  <span class="attribute">font-size</span>: <span class="number">12px</span>;<span class="comment">/* 设置字体大小为12像素 */</span></span></span><br><span class="line"><span class="language-css">  <span class="attribute">letter-spacing</span>: <span class="number">1px</span>;<span class="comment">/* 设置字母间距为1像素 */</span></span></span><br><span class="line"><span class="language-css">&#125;</span></span><br><span class="line"><span class="language-css"><span class="selector-class">.login-code-img</span> &#123;</span></span><br><span class="line"><span class="language-css">  <span class="attribute">height</span>: <span class="number">40px</span>;</span></span><br><span class="line"><span class="language-css">  <span class="attribute">padding-left</span>: <span class="number">12px</span>;</span></span><br><span class="line"><span class="language-css">&#125;</span></span><br><span class="line"><span class="language-css"></span><span class="tag">&lt;/<span class="name">style</span>&gt;</span></span><br></pre></td></tr></table></figure></p>
<h1 id="参考文献">参考文献</h1>
<p><span class="exturl" data-url="aHR0cHM6Ly9kb2NzLmRqYW5nb3Byb2plY3QuY29tL3poLWhhbnMvNS4wLw==">django官方文档(5.0)<i class="fa fa-external-link-alt"></i></span><br />
<span class="exturl" data-url="aHR0cHM6Ly9jbi52dWVqcy5vcmcv">vue官网<i class="fa fa-external-link-alt"></i></span><br />
<span class="exturl" data-url="aHR0cHM6Ly9lbGVtZW50LXBsdXMub3JnL3poLUNOLw==">element-plus官网<i class="fa fa-external-link-alt"></i></span><br />
<span class="exturl" data-url="aHR0cHM6Ly93d3cuZGphbmdvLXJlc3QtZnJhbWV3b3JrLm9yZy8=">DRF官网<i class="fa fa-external-link-alt"></i></span><br />
<span class="exturl" data-url="aHR0cHM6Ly9naXRodWIuY29tL2pwYWRpbGxhL2RqYW5nby1yZXN0LWZyYW1ld29yay1qd3Q=">JWT<i class="fa fa-external-link-alt"></i></span><br />
<span class="exturl" data-url="aHR0cHM6Ly93d3cuYmlsaWJpbGkuY29tL3ZpZGVvL0JWMTlzcHNlR0U5WS8/c3BtX2lkX2Zyb209MzMzLjMzNy5zZWFyY2gtY2FyZC5hbGwuY2xpY2smdmRfc291cmNlPWJhYjI2MThiMzlmNjljN2QzYzJkNDFkZDMwNDM4Mjg3">django5+vue3视频<i class="fa fa-external-link-alt"></i></span></p>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="https://soundmemories.github.io/2024/10/09/Python/23.FastAPI/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avstar.png">
      <meta itemprop="name" content="SoundMemories">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="SoundMemories">
      <meta itemprop="description" content="今日事，今日毕">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | SoundMemories">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2024/10/09/Python/23.FastAPI/" class="post-title-link" itemprop="url">FastAPI</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>

      <time title="创建时间：2024-10-09 00:00:00" itemprop="dateCreated datePublished" datetime="2024-10-09T00:00:00+08:00">2024-10-09</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">分类于</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/Python/" itemprop="url" rel="index"><span itemprop="name">Python</span></a>
        </span>
    </span>

  
    <span class="post-meta-break"></span>
    <span class="post-meta-item" title="本文字数">
      <span class="post-meta-item-icon">
        <i class="far fa-file-word"></i>
      </span>
      <span class="post-meta-item-text">本文字数：</span>
      <span>18k</span>
    </span>
    <span class="post-meta-item" title="阅读时长">
      <span class="post-meta-item-icon">
        <i class="far fa-clock"></i>
      </span>
      <span class="post-meta-item-text">阅读时长 &asymp;</span>
      <span>1:04</span>
    </span>
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <h1 id="基础介绍">基础介绍</h1>
<h1 id="简单示例">简单示例</h1>
<p>1.安装<br />
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">pip install fastapi</span><br><span class="line">pip install uvicorn</span><br></pre></td></tr></table></figure></p>
<p>2.创建项目<br />
<figure class="highlight python"><figcaption><span>main.py</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> unicorn</span><br><span class="line"><span class="keyword">from</span> fastapi <span class="keyword">import</span> FastAPI</span><br><span class="line"></span><br><span class="line">app = FastAPI()</span><br><span class="line"></span><br><span class="line"><span class="meta">@app.get(<span class="params"><span class="string">&quot;/&quot;</span></span>)</span></span><br><span class="line"><span class="keyword">async</span> <span class="keyword">def</span> <span class="title function_">root</span>():</span><br><span class="line">    <span class="keyword">return</span> &#123;<span class="string">&quot;message&quot;</span>: <span class="string">&quot;Hello World&quot;</span>&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&quot;__main__&quot;</span>:</span><br><span class="line">    uvicorn.run(app, host=<span class="string">&quot;0.0.0.0&quot;</span>, port=<span class="number">8000</span>)</span><br></pre></td></tr></table></figure></p>
<p>3.启动项目<br />
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># main指main.py，app指FastAPI实例</span></span><br><span class="line"><span class="comment"># --host 0.0.0.0表示监听所有地址，--port 8000表示监听8000端口，--workers表示启动多个进程，--reload表示开启热重载</span></span><br><span class="line">uvicorn main:app --host 0.0.0.0 --port 8000 --workers 4 --reload</span><br></pre></td></tr></table></figure></p>
<h1 id="api配置">API配置</h1>
<h2 id="api参数">API参数</h2>
<p><code>FastAPI()</code>中的参数，指定API的元数据和自动文档使用的字段：<br />
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">参数                类型        描述</span><br><span class="line">title               <span class="built_in">str</span>         API的标题</span><br><span class="line">summary             <span class="built_in">str</span>         API的简要描述</span><br><span class="line">description         <span class="built_in">str</span>         API的详细描述</span><br><span class="line">vsersion            <span class="built_in">str</span>         API的版本</span><br><span class="line">terms_of_service    <span class="built_in">str</span>         API的服务条款URL，必须为URL</span><br><span class="line">contact             <span class="built_in">dict</span>        公开的API联系信息，必须为<span class="built_in">dict</span>，包含name、url、email字段</span><br><span class="line">license_of          <span class="built_in">dict</span>        公开的API许可证信息，必须为<span class="built_in">dict</span>，包含name、url字段</span><br></pre></td></tr></table></figure></p>
<p>1.使用示例：<br />
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> fastapi <span class="keyword">import</span> FastAPI</span><br><span class="line"></span><br><span class="line">description = <span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">ChimichangApp API helps you do awesome stuff. 🚀</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">## Items</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">You can **read items**.</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">## Users</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">You will be able to:</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">* **Create users** (_not implemented_).</span></span><br><span class="line"><span class="string">* **Read users** (_not implemented_).</span></span><br><span class="line"><span class="string">&quot;&quot;&quot;</span></span><br><span class="line"></span><br><span class="line">app = FastAPI(</span><br><span class="line">    title=<span class="string">&quot;ChimichangApp&quot;</span>,</span><br><span class="line">    description=description,</span><br><span class="line">    summary=<span class="string">&quot;Deadpool&#x27;s favorite app. Nuff said.&quot;</span>,</span><br><span class="line">    version=<span class="string">&quot;0.0.1&quot;</span>,</span><br><span class="line">    terms_of_service=<span class="string">&quot;http://example.com/terms/&quot;</span>,</span><br><span class="line">    contact=&#123;</span><br><span class="line">        <span class="string">&quot;name&quot;</span>: <span class="string">&quot;Deadpoolio the Amazing&quot;</span>,</span><br><span class="line">        <span class="string">&quot;url&quot;</span>: <span class="string">&quot;http://x-force.example.com/contact/&quot;</span>,</span><br><span class="line">        <span class="string">&quot;email&quot;</span>: <span class="string">&quot;dp@x-force.example.com&quot;</span>,</span><br><span class="line">    &#125;,</span><br><span class="line">    license_info=&#123;</span><br><span class="line">        <span class="string">&quot;name&quot;</span>: <span class="string">&quot;Apache 2.0&quot;</span>,</span><br><span class="line">        <span class="string">&quot;url&quot;</span>: <span class="string">&quot;https://www.apache.org/licenses/LICENSE-2.0.html&quot;</span>,</span><br><span class="line">    &#125;,</span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="meta">@app.get(<span class="params"><span class="string">&quot;/items/&quot;</span></span>)</span></span><br><span class="line"><span class="keyword">async</span> <span class="keyword">def</span> <span class="title function_">read_items</span>():</span><br><span class="line">    <span class="keyword">return</span> [&#123;<span class="string">&quot;name&quot;</span>: <span class="string">&quot;Katana&quot;</span>&#125;]</span><br></pre></td></tr></table></figure></p>
<h2 id="文档参数">文档参数</h2>
<p>1.FastAPI提供了基于OpenAPI的文档生成器：<br />
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> fastapi <span class="keyword">import</span> FastAPI</span><br><span class="line"></span><br><span class="line"><span class="comment"># OpenAPI 模式服务于 /openapi.json，可以通过参数 openapi_url 对其进行配置</span></span><br><span class="line"><span class="comment"># 完全禁用 OpenAPI 模式，可以将其设置为 openapi_url=None，这样也会禁用使用它的文档用户界面</span></span><br><span class="line">app = FastAPI(openapi_url=<span class="string">&quot;/api/v1/openapi.json&quot;</span>) <span class="comment"># 将其设置为服务于 /api/v1/openapi.json</span></span><br><span class="line"></span><br><span class="line"><span class="meta">@app.get(<span class="params"><span class="string">&quot;/items/&quot;</span></span>)</span></span><br><span class="line"><span class="keyword">async</span> <span class="keyword">def</span> <span class="title function_">read_items</span>():</span><br><span class="line">    <span class="keyword">return</span> [&#123;<span class="string">&quot;name&quot;</span>: <span class="string">&quot;Foo&quot;</span>&#125;]</span><br></pre></td></tr></table></figure></p>
<p>2.可以通过<code>docs_url</code>和<code>redoc_url</code>参数配置：<br />
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> fastapi <span class="keyword">import</span> FastAPI</span><br><span class="line"></span><br><span class="line"><span class="comment"># Swagger UI 服务于 /docs，可以通过参数 docs_url 设置它的 URL，docs_url=None 禁用它</span></span><br><span class="line"><span class="comment"># ReDoc 服务于 /redoc，可以使用参数 redoc_url 设置它的 URL，redoc_url=None 禁用它</span></span><br><span class="line">app = FastAPI(docs_url=<span class="string">&quot;/documentation&quot;</span>, redoc_url=<span class="literal">None</span>) <span class="comment"># 设置 Swagger UI 服务于 /documentation 并禁用 ReDoc</span></span><br><span class="line"></span><br><span class="line"><span class="meta">@app.get(<span class="params"><span class="string">&quot;/items/&quot;</span></span>)</span></span><br><span class="line"><span class="keyword">async</span> <span class="keyword">def</span> <span class="title function_">read_items</span>():</span><br><span class="line">    <span class="keyword">return</span> [&#123;<span class="string">&quot;name&quot;</span>: <span class="string">&quot;Foo&quot;</span>&#125;]</span><br></pre></td></tr></table></figure></p>
<h1 id="路由操作">路由操作</h1>
<p>在开发 API 时，通常使用特定的 HTTP
方法去执行特定的行为，通常使用：<br />
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">POST：创建数据。</span><br><span class="line">GET：读取数据。</span><br><span class="line">PUT：更新数据。</span><br><span class="line">DELETE：删除数据。</span><br></pre></td></tr></table></figure></p>
<p>FastAPI中定义的路径操作装饰器：<br />
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@app.get()</span></span><br><span class="line"><span class="meta">@app.post()</span></span><br><span class="line"><span class="meta">@app.put()</span></span><br><span class="line"><span class="meta">@app.delete()</span></span><br><span class="line"><span class="meta">@app.options()</span></span><br><span class="line"><span class="meta">@app.head()</span></span><br><span class="line"><span class="meta">@app.patch()</span></span><br><span class="line"><span class="meta">@app.trace()</span></span><br></pre></td></tr></table></figure></p>
<h2 id="响应码">响应码</h2>
<p>1.可以在路由中使用 <code>status_code</code> 参数声明用于 "响应成功"
的 HTTP 状态码：<br />
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> fastapi <span class="keyword">import</span> FastAPI</span><br><span class="line"></span><br><span class="line">app = FastAPI()</span><br><span class="line"></span><br><span class="line"><span class="meta">@app.post(<span class="params"><span class="string">&quot;/items/&quot;</span>, status_code=<span class="number">201</span></span>) </span><span class="comment"># status_code状态码</span></span><br><span class="line"><span class="keyword">async</span> <span class="keyword">def</span> <span class="title function_">create_item</span>(<span class="params">name: <span class="built_in">str</span></span>):</span><br><span class="line">    <span class="keyword">return</span> &#123;<span class="string">&quot;name&quot;</span>: name&#125;</span><br></pre></td></tr></table></figure></p>
<p>2.<code>status_code</code>
还可以接收<code>fastapi.status</code>中的快捷变量：<br />
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> fastapi <span class="keyword">import</span> FastAPI, status</span><br><span class="line"></span><br><span class="line">app = FastAPI()</span><br><span class="line"><span class="comment"># HTTP_201_CREATED为fastapi中的快捷变量</span></span><br><span class="line"><span class="meta">@app.post(<span class="params"><span class="string">&quot;/items/&quot;</span>, status_code=status.HTTP_201_CREATED</span>)</span></span><br><span class="line"><span class="keyword">async</span> <span class="keyword">def</span> <span class="title function_">create_item</span>(<span class="params">name: <span class="built_in">str</span></span>):</span><br><span class="line">    <span class="keyword">return</span> &#123;<span class="string">&quot;name&quot;</span>: name&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment"># status_code 还能接收 IntEnum 类型，比如 Python 的 http.HTTPStatus</span></span><br><span class="line"><span class="comment"># status_code 还能接收 starlette.status</span></span><br></pre></td></tr></table></figure></p>
<p>3.额外的状态码，比如，更新时正常返回200，但条目不存在时希望创建它并返回201，此时需要JSONResponse：<br />
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> typing <span class="keyword">import</span> <span class="type">Union</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">from</span> fastapi <span class="keyword">import</span> Body, FastAPI, status</span><br><span class="line"><span class="keyword">from</span> fastapi.responses <span class="keyword">import</span> JSONResponse</span><br><span class="line"></span><br><span class="line">app = FastAPI()</span><br><span class="line"></span><br><span class="line">items = &#123;<span class="string">&quot;foo&quot;</span>: &#123;<span class="string">&quot;name&quot;</span>: <span class="string">&quot;Fighters&quot;</span>, <span class="string">&quot;size&quot;</span>: <span class="number">6</span>&#125;, <span class="string">&quot;bar&quot;</span>: &#123;<span class="string">&quot;name&quot;</span>: <span class="string">&quot;Tenders&quot;</span>, <span class="string">&quot;size&quot;</span>: <span class="number">3</span>&#125;&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">@app.put(<span class="params"><span class="string">&quot;/items/&#123;item_id&#125;&quot;</span></span>)</span></span><br><span class="line"><span class="keyword">async</span> <span class="keyword">def</span> <span class="title function_">upsert_item</span>(<span class="params"></span></span><br><span class="line"><span class="params">    item_id: <span class="built_in">str</span>,</span></span><br><span class="line"><span class="params">    name: <span class="type">Union</span>[<span class="built_in">str</span>, <span class="literal">None</span>] = Body(<span class="params">default=<span class="literal">None</span></span>),</span></span><br><span class="line"><span class="params">    size: <span class="type">Union</span>[<span class="built_in">int</span>, <span class="literal">None</span>] = Body(<span class="params">default=<span class="literal">None</span></span>),</span></span><br><span class="line"><span class="params"></span>):</span><br><span class="line">    <span class="keyword">if</span> item_id <span class="keyword">in</span> items:</span><br><span class="line">        item = items[item_id]</span><br><span class="line">        item[<span class="string">&quot;name&quot;</span>] = name</span><br><span class="line">        item[<span class="string">&quot;size&quot;</span>] = size</span><br><span class="line">        <span class="keyword">return</span> item <span class="comment"># 更新时正常返回200</span></span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        item = &#123;<span class="string">&quot;name&quot;</span>: name, <span class="string">&quot;size&quot;</span>: size&#125;</span><br><span class="line">        items[item_id] = item</span><br><span class="line">        <span class="comment"># 条目不存在时希望创建它并返回201</span></span><br><span class="line">        <span class="keyword">return</span> JSONResponse(status_code=status.HTTP_201_CREATED, content=item)</span><br></pre></td></tr></table></figure></p>
<h2 id="路由参数">路由参数</h2>
<p>1.路由请求中的参数，除了<code>status_code</code>，还有<code>tags</code>添加标签：<br />
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> typing <span class="keyword">import</span> <span class="type">Set</span>, <span class="type">Union</span></span><br><span class="line"><span class="keyword">from</span> fastapi <span class="keyword">import</span> FastAPI</span><br><span class="line"><span class="keyword">from</span> pydantic <span class="keyword">import</span> BaseModel</span><br><span class="line"></span><br><span class="line">app = FastAPI()</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Item</span>(<span class="title class_ inherited__">BaseModel</span>):</span><br><span class="line">    name: <span class="built_in">str</span></span><br><span class="line">    description: <span class="type">Union</span>[<span class="built_in">str</span>, <span class="literal">None</span>] = <span class="literal">None</span></span><br><span class="line">    price: <span class="built_in">float</span></span><br><span class="line">    tax: <span class="type">Union</span>[<span class="built_in">float</span>, <span class="literal">None</span>] = <span class="literal">None</span></span><br><span class="line">    tags: <span class="type">Set</span>[<span class="built_in">str</span>] = <span class="built_in">set</span>()</span><br><span class="line"></span><br><span class="line"><span class="comment"># 在Swagger文档中，tags字段会把同一标签请求显示在一起，相当于分类了</span></span><br><span class="line"><span class="meta">@app.post(<span class="params"><span class="string">&quot;/items/&quot;</span>, response_model=Item, tags=[<span class="string">&quot;items&quot;</span>]</span>)</span></span><br><span class="line"><span class="keyword">async</span> <span class="keyword">def</span> <span class="title function_">create_item</span>(<span class="params">item: Item</span>):</span><br><span class="line">    <span class="keyword">return</span> item</span><br><span class="line"></span><br><span class="line"><span class="meta">@app.get(<span class="params"><span class="string">&quot;/items/&quot;</span>, tags=[<span class="string">&quot;items&quot;</span>]</span>)</span></span><br><span class="line"><span class="keyword">async</span> <span class="keyword">def</span> <span class="title function_">read_items</span>():</span><br><span class="line">    <span class="keyword">return</span> [&#123;<span class="string">&quot;name&quot;</span>: <span class="string">&quot;Foo&quot;</span>, <span class="string">&quot;price&quot;</span>: <span class="number">42</span>&#125;]</span><br><span class="line"></span><br><span class="line"><span class="meta">@app.get(<span class="params"><span class="string">&quot;/users/&quot;</span>, tags=[<span class="string">&quot;users&quot;</span>]</span>)</span></span><br><span class="line"><span class="keyword">async</span> <span class="keyword">def</span> <span class="title function_">read_users</span>():</span><br><span class="line">    <span class="keyword">return</span> [&#123;<span class="string">&quot;username&quot;</span>: <span class="string">&quot;johndoe&quot;</span>&#125;]</span><br></pre></td></tr></table></figure></p>
<p>2.支持
<code>summary</code>，<code>description</code>，<code>response_description</code>，<code>deprecated=True</code>路径弃用：<br />
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> typing <span class="keyword">import</span> <span class="type">Set</span>, <span class="type">Union</span></span><br><span class="line"><span class="keyword">from</span> fastapi <span class="keyword">import</span> FastAPI</span><br><span class="line"><span class="keyword">from</span> pydantic <span class="keyword">import</span> BaseModel</span><br><span class="line"></span><br><span class="line">app = FastAPI()</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Item</span>(<span class="title class_ inherited__">BaseModel</span>):</span><br><span class="line">    name: <span class="built_in">str</span></span><br><span class="line">    description: <span class="type">Union</span>[<span class="built_in">str</span>, <span class="literal">None</span>] = <span class="literal">None</span></span><br><span class="line">    price: <span class="built_in">float</span></span><br><span class="line">    tax: <span class="type">Union</span>[<span class="built_in">float</span>, <span class="literal">None</span>] = <span class="literal">None</span></span><br><span class="line">    tags: <span class="type">Set</span>[<span class="built_in">str</span>] = <span class="built_in">set</span>()</span><br><span class="line"></span><br><span class="line"><span class="meta">@app.post(<span class="params"></span></span></span><br><span class="line"><span class="params"><span class="meta">    <span class="string">&quot;/items/&quot;</span>,</span></span></span><br><span class="line"><span class="params"><span class="meta">    response_model=Item,</span></span></span><br><span class="line"><span class="params"><span class="meta">    summary=<span class="string">&quot;Create an item&quot;</span>,</span></span></span><br><span class="line"><span class="params"><span class="meta">    description=<span class="string">&quot;Create an item with all the information, name, description, price, tax and a set of unique tags&quot;</span>,</span></span></span><br><span class="line"><span class="params"><span class="meta">    response_description=<span class="string">&quot;The created item&quot;</span>,</span></span></span><br><span class="line"><span class="params"><span class="meta">    deprecated=<span class="literal">True</span></span></span></span><br><span class="line"><span class="params"><span class="meta"></span>)</span></span><br><span class="line"><span class="keyword">async</span> <span class="keyword">def</span> <span class="title function_">create_item</span>(<span class="params">item: Item</span>):</span><br><span class="line">    <span class="keyword">return</span> item</span><br></pre></td></tr></table></figure></p>
<p>3.当描述内容比较长且占用多行时，可以在函数的 docstring
中声明，FastAPI 会自动提取到Swagger：<br />
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> typing <span class="keyword">import</span> <span class="type">Set</span>, <span class="type">Union</span></span><br><span class="line"><span class="keyword">from</span> fastapi <span class="keyword">import</span> FastAPI</span><br><span class="line"><span class="keyword">from</span> pydantic <span class="keyword">import</span> BaseModel</span><br><span class="line"></span><br><span class="line">app = FastAPI()</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Item</span>(<span class="title class_ inherited__">BaseModel</span>):</span><br><span class="line">    name: <span class="built_in">str</span></span><br><span class="line">    description: <span class="type">Union</span>[<span class="built_in">str</span>, <span class="literal">None</span>] = <span class="literal">None</span></span><br><span class="line">    price: <span class="built_in">float</span></span><br><span class="line">    tax: <span class="type">Union</span>[<span class="built_in">float</span>, <span class="literal">None</span>] = <span class="literal">None</span></span><br><span class="line">    tags: <span class="type">Set</span>[<span class="built_in">str</span>] = <span class="built_in">set</span>()</span><br><span class="line"></span><br><span class="line"><span class="meta">@app.post(<span class="params"><span class="string">&quot;/items/&quot;</span>, response_model=Item, summary=<span class="string">&quot;Create an item&quot;</span></span>)</span></span><br><span class="line"><span class="keyword">async</span> <span class="keyword">def</span> <span class="title function_">create_item</span>(<span class="params">item: Item</span>):</span><br><span class="line">    <span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">    Create an item with all the information:</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">    - **name**: each item must have a name</span></span><br><span class="line"><span class="string">    - **description**: a long description</span></span><br><span class="line"><span class="string">    - **price**: required</span></span><br><span class="line"><span class="string">    - **tax**: if the item doesn&#x27;t have tax, you can omit this</span></span><br><span class="line"><span class="string">    - **tags**: a set of unique tag strings for this item</span></span><br><span class="line"><span class="string">    \f</span></span><br><span class="line"><span class="string">    换页符，\f后面的内容不会出现在文档中</span></span><br><span class="line"><span class="string">    :param item: User input.</span></span><br><span class="line"><span class="string">    &quot;&quot;&quot;</span></span><br><span class="line">    <span class="keyword">return</span> item</span><br></pre></td></tr></table></figure></p>
<h1 id="路径参数">路径参数</h1>
<h2 id="基础使用">基础使用</h2>
<p>1.FastAPI 支持使用 Python
字符串格式化语法声明<strong>路径参数</strong>：<br />
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> fastapi <span class="keyword">import</span> FastAPI</span><br><span class="line"></span><br><span class="line">app = FastAPI()</span><br><span class="line"></span><br><span class="line"><span class="meta">@app.get(<span class="params"><span class="string">&quot;/items/&#123;item_id&#125;&quot;</span></span>) </span><span class="comment"># 这段代码把路径参数item_id的值传递给路径函数的参数item_id。</span></span><br><span class="line"><span class="keyword">async</span> <span class="keyword">def</span> <span class="title function_">read_item</span>(<span class="params">item_id</span>): </span><br><span class="line">    <span class="keyword">return</span> &#123;<span class="string">&quot;item_id&quot;</span>: item_id&#125;</span><br></pre></td></tr></table></figure></p>
<p>2.使用Python标准类型注解，声明路径操作函数中路径参数的<strong>类型</strong>，FastAPI通过类型声明<strong>自动解析</strong>请求中的数据：<br />
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> fastapi <span class="keyword">import</span> FastAPI</span><br><span class="line"></span><br><span class="line">app = FastAPI()</span><br><span class="line"></span><br><span class="line"><span class="meta">@app.get(<span class="params"><span class="string">&quot;/items/&#123;item_id&#125;&quot;</span></span>)</span></span><br><span class="line"><span class="keyword">async</span> <span class="keyword">def</span> <span class="title function_">read_item</span>(<span class="params">item_id: <span class="built_in">int</span></span>): <span class="comment"># 把item_id的类型声明为int。</span></span><br><span class="line">    <span class="keyword">return</span> &#123;<span class="string">&quot;item_id&quot;</span>: item_id&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment"># 访问http://127.0.0.1:8000/items/3，返回响应&#123;&quot;item_id&quot;:3&#125;</span></span><br><span class="line"><span class="comment"># 注意，自动解析，函数接收并返回的值是 3（ int），不是 &quot;3&quot;（str）。</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 访问http://127.0.0.1:8000/items/foo，会返回报错信息，这是因为路径参数item_id的值（&quot;foo&quot;）的类型不是int。</span></span><br></pre></td></tr></table></figure></p>
<p>3.路径操作是按顺序执行的，所以顺序很重要，比如有两个路径<code>/users/me</code>和<code>/users/&#123;user_id&#125;</code>：<br />
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> fastapi <span class="keyword">import</span> FastAPI</span><br><span class="line"></span><br><span class="line">app = FastAPI()</span><br><span class="line"></span><br><span class="line"><span class="comment"># 一定要在 /users/&#123;user_id&#125; 之前声明 /users/me，否则 /users/me 会被 /users/&#123;user_id&#125; 匹配到从而报错。</span></span><br><span class="line"><span class="meta">@app.get(<span class="params"><span class="string">&quot;/users/me&quot;</span></span>)</span></span><br><span class="line"><span class="keyword">async</span> <span class="keyword">def</span> <span class="title function_">read_user_me</span>():</span><br><span class="line">    <span class="keyword">return</span> &#123;<span class="string">&quot;user_id&quot;</span>: <span class="string">&quot;the current user&quot;</span>&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">@app.get(<span class="params"><span class="string">&quot;/users/&#123;user_id&#125;&quot;</span></span>)</span></span><br><span class="line"><span class="keyword">async</span> <span class="keyword">def</span> <span class="title function_">read_user</span>(<span class="params">user_id: <span class="built_in">str</span></span>):</span><br><span class="line">    <span class="keyword">return</span> &#123;<span class="string">&quot;user_id&quot;</span>: user_id&#125;</span><br></pre></td></tr></table></figure></p>
<p>4.路径参数可以用Enum限制范围：<br />
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> enum <span class="keyword">import</span> Enum</span><br><span class="line"><span class="keyword">from</span> fastapi <span class="keyword">import</span> FastAPI</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">ModelName</span>(<span class="built_in">str</span>, Enum):</span><br><span class="line">    alexnet = <span class="string">&quot;alexnet&quot;</span></span><br><span class="line">    resnet = <span class="string">&quot;resnet&quot;</span></span><br><span class="line">    lenet = <span class="string">&quot;lenet&quot;</span></span><br><span class="line"></span><br><span class="line">app = FastAPI()</span><br><span class="line"></span><br><span class="line"><span class="meta">@app.get(<span class="params"><span class="string">&quot;/models/&#123;model_name&#125;&quot;</span></span>)</span></span><br><span class="line"><span class="keyword">async</span> <span class="keyword">def</span> <span class="title function_">get_model</span>(<span class="params">model_name: ModelName</span>): <span class="comment"># model_name的值只能是ModelName中定义的值</span></span><br><span class="line">    <span class="comment"># 1.可通过 ModelName.xx 访问枚举值</span></span><br><span class="line">    <span class="keyword">if</span> model_name <span class="keyword">is</span> ModelName.alexnet:</span><br><span class="line">        <span class="keyword">return</span> &#123;<span class="string">&quot;model_name&quot;</span>: model_name, <span class="string">&quot;message&quot;</span>: <span class="string">&quot;Deep Learning FTW!&quot;</span>&#125;</span><br><span class="line">    <span class="comment"># 2.可通过 model_name.value 访问枚举值</span></span><br><span class="line">    <span class="keyword">if</span> model_name.value == <span class="string">&quot;lenet&quot;</span>:</span><br><span class="line">        <span class="keyword">return</span> &#123;<span class="string">&quot;model_name&quot;</span>: model_name, <span class="string">&quot;message&quot;</span>: <span class="string">&quot;LeCNN all the images&quot;</span>&#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> &#123;<span class="string">&quot;model_name&quot;</span>: model_name, <span class="string">&quot;message&quot;</span>: <span class="string">&quot;Have some residuals&quot;</span>&#125;</span><br></pre></td></tr></table></figure></p>
<p>5.路径的路径参数：<br />
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> fastapi <span class="keyword">import</span> FastAPI</span><br><span class="line"></span><br><span class="line">app = FastAPI()</span><br><span class="line"></span><br><span class="line"><span class="meta">@app.get(<span class="params"><span class="string">&quot;/files/&#123;file_path:path&#125;&quot;</span></span>) </span><span class="comment"># 参数名为 file_path, :path说明该参数应匹配&quot;路径&quot;</span></span><br><span class="line"><span class="keyword">async</span> <span class="keyword">def</span> <span class="title function_">read_file</span>(<span class="params">file_path: <span class="built_in">str</span></span>):</span><br><span class="line">    <span class="keyword">return</span> &#123;<span class="string">&quot;file_path&quot;</span>: file_path&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment"># 比如file_path路径为 /home/johndoe/myfile.txt </span></span><br><span class="line"><span class="comment"># 那么这么应访问 /files//home/johndoe/myfile.txt ，files和home之间要使用&quot;双斜杠&quot;（//）</span></span><br></pre></td></tr></table></figure></p>
<h2 id="参数校验">参数校验</h2>
<p>1.路径参数的校验，从 fastapi 导入 Path：<br />
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> fastapi <span class="keyword">import</span> FastAPI, Path, Query</span><br><span class="line"></span><br><span class="line">app = FastAPI()</span><br><span class="line"></span><br><span class="line"><span class="meta">@app.get(<span class="params"><span class="string">&quot;/items/&#123;item_id&#125;&quot;</span></span>)</span></span><br><span class="line"><span class="keyword">async</span> <span class="keyword">def</span> <span class="title function_">read_items</span>(<span class="params"></span></span><br><span class="line"><span class="params">    item_id: <span class="built_in">int</span> = Path(<span class="params">title=<span class="string">&quot;The ID of the item to get&quot;</span></span>), <span class="comment"># 路径参数的校验</span></span></span><br><span class="line"><span class="params">    q: <span class="built_in">str</span> | <span class="literal">None</span> = Query(<span class="params">default=<span class="literal">None</span>, alias=<span class="string">&quot;item-query&quot;</span></span>), <span class="comment"># 查询参数的校验</span></span></span><br><span class="line"><span class="params"></span>):</span><br><span class="line">    results = &#123;<span class="string">&quot;item_id&quot;</span>: item_id&#125;</span><br><span class="line">    <span class="keyword">if</span> q:</span><br><span class="line">        results.update(&#123;<span class="string">&quot;q&quot;</span>: q&#125;)</span><br><span class="line">    <span class="keyword">return</span> results</span><br></pre></td></tr></table></figure></p>
<p>2.必选参数（无默认值）要在可选参数（有默认值）前面，若想改变顺序使用"*"指定后续参数为kwargs：<br />
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> fastapi <span class="keyword">import</span> FastAPI, Path</span><br><span class="line"></span><br><span class="line">app = FastAPI()</span><br><span class="line"></span><br><span class="line"><span class="meta">@app.get(<span class="params"><span class="string">&quot;/items/&#123;item_id&#125;&quot;</span></span>)</span></span><br><span class="line"><span class="comment"># 带有「默认值」的参数放在没有「默认值」的参数之前，Python将会报错</span></span><br><span class="line"><span class="comment"># 重新排序，并将不带默认值的值（查询参数 q）放到最前面</span></span><br><span class="line"><span class="keyword">async</span> <span class="keyword">def</span> <span class="title function_">read_items</span>(<span class="params">q: <span class="built_in">str</span>, item_id: <span class="built_in">int</span> = Path(<span class="params">title=<span class="string">&quot;The ID of the item to get&quot;</span></span>)</span>):</span><br><span class="line">    results = &#123;<span class="string">&quot;item_id&quot;</span>: item_id&#125;</span><br><span class="line">    <span class="keyword">if</span> q:</span><br><span class="line">        results.update(&#123;<span class="string">&quot;q&quot;</span>: q&#125;)</span><br><span class="line">    <span class="keyword">return</span> results</span><br><span class="line"></span><br><span class="line"><span class="meta">@app.get(<span class="params"><span class="string">&quot;/items/&#123;item_id&#125;&quot;</span></span>)</span></span><br><span class="line"><span class="comment"># &quot;*&quot;后为kwargs关键字参数，此时顺序可以改变</span></span><br><span class="line"><span class="keyword">async</span> <span class="keyword">def</span> <span class="title function_">read_items</span>(<span class="params">*, item_id: <span class="built_in">int</span> = Path(<span class="params">title=<span class="string">&quot;The ID of the item to get&quot;</span></span>), q: <span class="built_in">str</span></span>):</span><br><span class="line">    results = &#123;<span class="string">&quot;item_id&quot;</span>: item_id&#125;</span><br><span class="line">    <span class="keyword">if</span> q:</span><br><span class="line">        results.update(&#123;<span class="string">&quot;q&quot;</span>: q&#125;)</span><br><span class="line">    <span class="keyword">return</span> results</span><br></pre></td></tr></table></figure></p>
<p>3.数值大小校验，"gt"大于、"ge"大于等于、"lt"小于、"le"小于等于：<br />
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> fastapi <span class="keyword">import</span> FastAPI, Path</span><br><span class="line"></span><br><span class="line">app = FastAPI()</span><br><span class="line"></span><br><span class="line"><span class="meta">@app.get(<span class="params"><span class="string">&quot;/items/&#123;item_id&#125;&quot;</span></span>)</span></span><br><span class="line"><span class="keyword">async</span> <span class="keyword">def</span> <span class="title function_">read_items</span>(<span class="params"></span></span><br><span class="line"><span class="params">    *,</span></span><br><span class="line"><span class="params">    item_id: <span class="built_in">int</span> = Path(<span class="params">title=<span class="string">&quot;The ID of the item to get&quot;</span>, gt=<span class="number">0</span>, le=<span class="number">1000</span></span>), <span class="comment"># gt大于，le小于等于</span></span></span><br><span class="line"><span class="params">    q: <span class="built_in">str</span>,</span></span><br><span class="line"><span class="params"></span>):</span><br><span class="line">    results = &#123;<span class="string">&quot;item_id&quot;</span>: item_id&#125;</span><br><span class="line">    <span class="keyword">if</span> q:</span><br><span class="line">        results.update(&#123;<span class="string">&quot;q&quot;</span>: q&#125;)</span><br><span class="line">    <span class="keyword">return</span> results</span><br><span class="line"></span><br><span class="line"><span class="meta">@app.get(<span class="params"><span class="string">&quot;/items/&#123;item_id&#125;&quot;</span></span>)</span></span><br><span class="line"><span class="keyword">async</span> <span class="keyword">def</span> <span class="title function_">read_items</span>(<span class="params"></span></span><br><span class="line"><span class="params">    *,</span></span><br><span class="line"><span class="params">    item_id: <span class="built_in">int</span> = Path(<span class="params">title=<span class="string">&quot;The ID of the item to get&quot;</span>, ge=<span class="number">0</span>, le=<span class="number">1000</span></span>),</span></span><br><span class="line"><span class="params">    q: <span class="built_in">str</span>,</span></span><br><span class="line"><span class="params">    size: <span class="built_in">float</span> = Query(<span class="params">gt=<span class="number">0</span>, lt=<span class="number">10.5</span></span>), <span class="comment"># 同样适用于查询参数，float类型</span></span></span><br><span class="line"><span class="params"></span>):</span><br><span class="line">    results = &#123;<span class="string">&quot;item_id&quot;</span>: item_id&#125;</span><br><span class="line">    <span class="keyword">if</span> q:</span><br><span class="line">        results.update(&#123;<span class="string">&quot;q&quot;</span>: q&#125;)</span><br><span class="line">    <span class="keyword">if</span> size:</span><br><span class="line">        results.update(&#123;<span class="string">&quot;size&quot;</span>: size&#125;)</span><br><span class="line">    <span class="keyword">return</span> results</span><br></pre></td></tr></table></figure></p>
<h1 id="查询参数">查询参数</h1>
<h2 id="基础使用-1">基础使用</h2>
<p>1.声明的参数不是路径参数时，路径操作函数会把该参数自动解释为<strong>查询</strong>参数。查询字符串是键值对的集合，这些键值对位于
URL 的 ? 之后，以 &amp; 分隔。<br />
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> fastapi <span class="keyword">import</span> FastAPI</span><br><span class="line"></span><br><span class="line">app = FastAPI()</span><br><span class="line"></span><br><span class="line">fake_items_db = [<span class="string">&quot;Foo&quot;</span>, <span class="string">&quot;Bar&quot;</span>, <span class="string">&quot;Baz&quot;</span>]</span><br><span class="line"></span><br><span class="line"><span class="meta">@app.get(<span class="params"><span class="string">&quot;/items/&quot;</span></span>)</span></span><br><span class="line"><span class="keyword">async</span> <span class="keyword">def</span> <span class="title function_">read_item</span>(<span class="params">skip: <span class="built_in">int</span> = <span class="number">0</span>, limit: <span class="built_in">int</span> = <span class="number">10</span></span>):  <span class="comment"># 设置了默认值</span></span><br><span class="line">    <span class="keyword">return</span> fake_items_db[skip: skip+limit] <span class="comment"># 取列表skip~skip+limit的值</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 访问http://127.0.0.1:8000/items/?skip=0&amp;limit=10，返回[&quot;Foo&quot;, &quot;Bar&quot;, &quot;Baz&quot;], skip值为0，limit值为10</span></span><br><span class="line"><span class="comment"># 访问http://127.0.0.1:8000/items/，效果同http://127.0.0.1:8000/items/?skip=0&amp;limit=10，因为设置了默认值</span></span><br></pre></td></tr></table></figure></p>
<p>2.默认值设置为None即是可选参数：<br />
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> fastapi <span class="keyword">import</span> FastAPI</span><br><span class="line"></span><br><span class="line">app = FastAPI()</span><br><span class="line"></span><br><span class="line"><span class="meta">@app.get(<span class="params"><span class="string">&quot;/items/&#123;item_id&#125;&quot;</span></span>)</span></span><br><span class="line"><span class="keyword">async</span> <span class="keyword">def</span> <span class="title function_">read_item</span>(<span class="params">item_id: <span class="built_in">str</span>, q: <span class="built_in">str</span> | <span class="literal">None</span> = <span class="literal">None</span></span>): <span class="comment"># 查询参数 q 是可选的，默认值为 None。</span></span><br><span class="line">    <span class="keyword">if</span> q:</span><br><span class="line">        <span class="keyword">return</span> &#123;<span class="string">&quot;item_id&quot;</span>: item_id, <span class="string">&quot;q&quot;</span>: q&#125;</span><br><span class="line">    <span class="keyword">return</span> &#123;<span class="string">&quot;item_id&quot;</span>: item_id&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment"># 不设置默认值，参数为必选参数</span></span><br></pre></td></tr></table></figure></p>
<p>3.参数还可以声明为 bool 类型，FastAPI 会自动转换参数类型：<br />
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> fastapi <span class="keyword">import</span> FastAPI</span><br><span class="line"></span><br><span class="line">app = FastAPI()</span><br><span class="line"></span><br><span class="line"><span class="meta">@app.get(<span class="params"><span class="string">&quot;/items/&#123;item_id&#125;&quot;</span></span>)</span></span><br><span class="line"><span class="comment"># fastapi会自动转换short为bool类型</span></span><br><span class="line"><span class="keyword">async</span> <span class="keyword">def</span> <span class="title function_">read_item</span>(<span class="params">item_id: <span class="built_in">str</span>, q: <span class="built_in">str</span> | <span class="literal">None</span> = <span class="literal">None</span>, short: <span class="built_in">bool</span> = <span class="literal">False</span></span>): </span><br><span class="line">    item = &#123;<span class="string">&quot;item_id&quot;</span>: item_id&#125;</span><br><span class="line">    <span class="keyword">if</span> q:</span><br><span class="line">        item.update(&#123;<span class="string">&quot;q&quot;</span>: q&#125;)</span><br><span class="line">    <span class="keyword">if</span> <span class="keyword">not</span> short:</span><br><span class="line">        item.update(</span><br><span class="line">            &#123;<span class="string">&quot;description&quot;</span>: <span class="string">&quot;This is an amazing item that has a long description&quot;</span>&#125;</span><br><span class="line">        )</span><br><span class="line">    <span class="keyword">return</span> item</span><br><span class="line"></span><br><span class="line"><span class="comment"># http://127.0.0.1:8000/items/foo?short=1，</span></span><br><span class="line"><span class="comment"># 其它任意大小写形式（大写、首字母大写等），函数接收的 short 参数都是布尔值 True。值为 False 时也一样。</span></span><br></pre></td></tr></table></figure></p>
<h2 id="参数校验-1">参数校验</h2>
<p>1.导入Query，使用 Query 作为默认值：<br />
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># from typing import Union # python 3.8使用Union[str, None]</span></span><br><span class="line"><span class="keyword">from</span> fastapi <span class="keyword">import</span> FastAPI, Query</span><br><span class="line"></span><br><span class="line">app = FastAPI()</span><br><span class="line"></span><br><span class="line"><span class="meta">@app.get(<span class="params"><span class="string">&quot;/items/&quot;</span></span>)</span></span><br><span class="line"><span class="comment"># Query作为默认值，并将它的default默认值设置为None，min_length参数设置为1，max_length参数设置为50，正则pattern</span></span><br><span class="line"><span class="keyword">async</span> <span class="keyword">def</span> <span class="title function_">read_items</span>(<span class="params">q: <span class="built_in">str</span> | <span class="literal">None</span> = Query(<span class="params">default=<span class="literal">None</span>, min_length=<span class="number">1</span>, max_length=<span class="number">50</span>, </span></span></span><br><span class="line"><span class="params"><span class="params">                                     pattern=<span class="string">&quot;^fixedquery$&quot;</span></span>)</span>): </span><br><span class="line">    results = &#123;<span class="string">&quot;items&quot;</span>: [&#123;<span class="string">&quot;item_id&quot;</span>: <span class="string">&quot;Foo&quot;</span>&#125;, &#123;<span class="string">&quot;item_id&quot;</span>: <span class="string">&quot;Bar&quot;</span>&#125;]&#125;</span><br><span class="line">    <span class="keyword">if</span> q:</span><br><span class="line">        results.update(&#123;<span class="string">&quot;q&quot;</span>: q&#125;)</span><br><span class="line">    <span class="keyword">return</span> results</span><br></pre></td></tr></table></figure></p>
<p>2.Query声明为必须参数：<br />
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> fastapi <span class="keyword">import</span> FastAPI, Query</span><br><span class="line"></span><br><span class="line">app = FastAPI()</span><br><span class="line"></span><br><span class="line"><span class="meta">@app.get(<span class="params"><span class="string">&quot;/items/&quot;</span></span>)</span></span><br><span class="line"><span class="comment"># 如果声明参数为必须参数，则去掉default</span></span><br><span class="line"><span class="comment"># 如果声明参数为必须参数，且可以是None值，则将default默认值设为&quot;...&quot;或&quot;Required&quot;，此时输入需显示输入None</span></span><br><span class="line"><span class="keyword">async</span> <span class="keyword">def</span> <span class="title function_">read_items</span>(<span class="params">q: <span class="built_in">str</span> | <span class="literal">None</span> = Query(<span class="params">default=..., min_length=<span class="number">3</span></span>)</span>):</span><br><span class="line">    results = &#123;<span class="string">&quot;items&quot;</span>: [&#123;<span class="string">&quot;item_id&quot;</span>: <span class="string">&quot;Foo&quot;</span>&#125;, &#123;<span class="string">&quot;item_id&quot;</span>: <span class="string">&quot;Bar&quot;</span>&#125;]&#125;</span><br><span class="line">    <span class="keyword">if</span> q:</span><br><span class="line">        results.update(&#123;<span class="string">&quot;q&quot;</span>: q&#125;)</span><br><span class="line">    <span class="keyword">return</span> results</span><br></pre></td></tr></table></figure></p>
<p>3.Query定义查询参数，可以接收一组数值：<br />
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> typing <span class="keyword">import</span> <span class="type">List</span></span><br><span class="line"><span class="keyword">from</span> fastapi <span class="keyword">import</span> FastAPI, Query</span><br><span class="line"></span><br><span class="line">app = FastAPI()</span><br><span class="line"></span><br><span class="line"><span class="meta">@app.get(<span class="params"><span class="string">&quot;/items/&quot;</span></span>)</span></span><br><span class="line"><span class="keyword">async</span> <span class="keyword">def</span> <span class="title function_">read_items</span>(<span class="params">q: <span class="type">List</span>[<span class="built_in">str</span>] | <span class="literal">None</span> = Query(<span class="params">default=<span class="literal">None</span></span>)</span>): <span class="comment"># 查询参数q可以为一组数值</span></span><br><span class="line">    query_items = &#123;<span class="string">&quot;q&quot;</span>: q&#125;</span><br><span class="line">    <span class="keyword">return</span> query_items</span><br><span class="line"><span class="comment"># 访问http://localhost:8000/items/?q=foo&amp;q=bar，接收q的多个值，返回&#123;&quot;q&quot;: [&quot;foo&quot;, &quot;bar&quot;]&#125;</span></span><br></pre></td></tr></table></figure></p>
<p>4.Query设置default默认值也可以为一组值：<br />
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@app.get(<span class="params"><span class="string">&quot;/items/&quot;</span></span>)</span></span><br><span class="line"><span class="comment"># default=List[int]，会检查List内是否为int类型</span></span><br><span class="line"><span class="comment"># default=[]，不会检查List内的类型</span></span><br><span class="line"><span class="keyword">async</span> <span class="keyword">def</span> <span class="title function_">read_items</span>(<span class="params">q: <span class="type">List</span>[<span class="built_in">str</span>] = Query(<span class="params">default=[<span class="string">&quot;foo&quot;</span>, <span class="string">&quot;bar&quot;</span>]</span>)</span>):</span><br><span class="line">    query_items = &#123;<span class="string">&quot;q&quot;</span>: q&#125;</span><br><span class="line">    <span class="keyword">return</span> query_items</span><br></pre></td></tr></table></figure></p>
<p>5.Query的其他参数，"title"、"description"、"alias"、"deprecated=True"：<br />
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> fastapi <span class="keyword">import</span> FastAPI, Query</span><br><span class="line"></span><br><span class="line">app = FastAPI()</span><br><span class="line"></span><br><span class="line"><span class="meta">@app.get(<span class="params"><span class="string">&quot;/items/&quot;</span></span>)</span></span><br><span class="line"><span class="keyword">async</span> <span class="keyword">def</span> <span class="title function_">read_items</span>(<span class="params"></span></span><br><span class="line"><span class="params">    q: <span class="built_in">str</span> | <span class="literal">None</span> = Query(<span class="params"></span></span></span><br><span class="line"><span class="params"><span class="params">      default=<span class="literal">None</span>,</span></span></span><br><span class="line"><span class="params"><span class="params">      title=<span class="string">&quot;Query string&quot;</span>, <span class="comment"># 参数标题</span></span></span></span><br><span class="line"><span class="params"><span class="params">      description=<span class="string">&quot;Query string for the items to search in the database that have a good match&quot;</span>, <span class="comment"># 参数描述</span></span></span></span><br><span class="line"><span class="params"><span class="params">      alias=<span class="string">&quot;item-query&quot;</span>, <span class="comment"># 参数别名，有此参数时，只能使用此参数设置的item-query访问，不能使用变量名q访问</span></span></span></span><br><span class="line"><span class="params"><span class="params">      deprecated=<span class="literal">True</span>, <span class="comment"># 未来会弃用，目前临时可用</span></span></span></span><br><span class="line"><span class="params"><span class="params">      min_length=<span class="number">3</span>,</span></span></span><br><span class="line"><span class="params"><span class="params">    </span>),</span></span><br><span class="line"><span class="params"></span>):</span><br><span class="line">    results = &#123;<span class="string">&quot;items&quot;</span>: [&#123;<span class="string">&quot;item_id&quot;</span>: <span class="string">&quot;Foo&quot;</span>&#125;, &#123;<span class="string">&quot;item_id&quot;</span>: <span class="string">&quot;Bar&quot;</span>&#125;]&#125;</span><br><span class="line">    <span class="keyword">if</span> q:</span><br><span class="line">        results.update(&#123;<span class="string">&quot;q&quot;</span>: q&#125;)</span><br><span class="line">    <span class="keyword">return</span> results</span><br></pre></td></tr></table></figure></p>
<h1 id="自定义校验类型">自定义校验类型</h1>
<h2 id="pydantic模型">Pydantic模型</h2>
<p>1.声明自定义Pydantic模型（默认解析为Body），可以重复使用该模型在不同地方，作为参数的类型进行校验：<br />
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> typing <span class="keyword">import</span> <span class="type">Literal</span></span><br><span class="line"><span class="keyword">from</span> fastapi <span class="keyword">import</span> FastAPI, Query</span><br><span class="line"><span class="keyword">from</span> pydantic <span class="keyword">import</span> BaseModel, Field</span><br><span class="line"></span><br><span class="line">app = FastAPI()</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">FilterParams</span>(<span class="title class_ inherited__">BaseModel</span>):</span><br><span class="line">    limit: <span class="built_in">int</span> = Field(<span class="number">100</span>, gt=<span class="number">0</span>, le=<span class="number">100</span>)</span><br><span class="line">    offset: <span class="built_in">int</span> = Field(<span class="number">0</span>, ge=<span class="number">0</span>)</span><br><span class="line">    order_by: <span class="type">Literal</span>[<span class="string">&quot;created_at&quot;</span>, <span class="string">&quot;updated_at&quot;</span>] = <span class="string">&quot;created_at&quot;</span></span><br><span class="line">    tags: <span class="built_in">list</span>[<span class="built_in">str</span>] = []</span><br><span class="line"></span><br><span class="line"><span class="meta">@app.get(<span class="params"><span class="string">&quot;/items/&quot;</span></span>)</span></span><br><span class="line"><span class="keyword">async</span> <span class="keyword">def</span> <span class="title function_">read_items</span>(<span class="params">filter_query: FilterParams = Query(<span class="params"></span>)</span>):</span><br><span class="line">    <span class="keyword">return</span> filter_query</span><br></pre></td></tr></table></figure></p>
<p>2.禁止额外参数<code>model_config = &#123;"extra": "forbid"&#125;</code>：<br />
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> typing <span class="keyword">import</span> <span class="type">Literal</span></span><br><span class="line"><span class="keyword">from</span> fastapi <span class="keyword">import</span> FastAPI, Query</span><br><span class="line"><span class="keyword">from</span> pydantic <span class="keyword">import</span> BaseModel, Field</span><br><span class="line"></span><br><span class="line">app = FastAPI()</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">FilterParams</span>(<span class="title class_ inherited__">BaseModel</span>):</span><br><span class="line">    model_config = &#123;<span class="string">&quot;extra&quot;</span>: <span class="string">&quot;forbid&quot;</span>&#125;  <span class="comment"># 禁止额外参数输入，出现额外参数报错</span></span><br><span class="line">    limit: <span class="built_in">int</span> = Field(<span class="number">100</span>, gt=<span class="number">0</span>, le=<span class="number">100</span>)</span><br><span class="line">    offset: <span class="built_in">int</span> = Field(<span class="number">0</span>, ge=<span class="number">0</span>)</span><br><span class="line">    order_by: <span class="type">Literal</span>[<span class="string">&quot;created_at&quot;</span>, <span class="string">&quot;updated_at&quot;</span>] = <span class="string">&quot;created_at&quot;</span></span><br><span class="line">    tags: <span class="built_in">list</span>[<span class="built_in">str</span>] = []</span><br><span class="line"></span><br><span class="line"><span class="meta">@app.get(<span class="params"><span class="string">&quot;/items/&quot;</span></span>)</span></span><br><span class="line"><span class="keyword">async</span> <span class="keyword">def</span> <span class="title function_">read_items</span>(<span class="params">filter_query: FilterParams = Query(<span class="params"></span>)</span>): <span class="comment"># 从Query参数中获取（默认从Body中获取）</span></span><br><span class="line">    <span class="keyword">return</span> filter_query</span><br><span class="line"></span><br><span class="line"><span class="comment"># 访问http://localhost:8000/items/?q=foo&amp;limit=1&amp;offset=0&amp;order_by=updated_at&amp;tags=a，有额外参数q，报错</span></span><br></pre></td></tr></table></figure></p>
<h2 id="pydantic嵌套模型">Pydantic嵌套模型</h2>
<p>FastAPI可以定义、校验、记录文档并使用任意深度嵌套的模型（归功于Pydantic）。<br />
1.具有子类型的字段：<br />
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> typing <span class="keyword">import</span> <span class="type">List</span>, <span class="type">Union</span> <span class="comment"># List[str], Union[float, None]</span></span><br><span class="line"><span class="keyword">from</span> fastapi <span class="keyword">import</span> FastAPI</span><br><span class="line"><span class="keyword">from</span> pydantic <span class="keyword">import</span> BaseModel</span><br><span class="line"></span><br><span class="line">app = FastAPI()</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Item</span>(<span class="title class_ inherited__">BaseModel</span>):</span><br><span class="line">    name: <span class="built_in">str</span></span><br><span class="line">    description: <span class="built_in">str</span> | <span class="literal">None</span> = <span class="literal">None</span></span><br><span class="line">    price: <span class="built_in">float</span> </span><br><span class="line">    tax: <span class="built_in">float</span> | <span class="literal">None</span> = <span class="literal">None</span></span><br><span class="line">    tags: <span class="built_in">list</span>[<span class="built_in">str</span>] = []  <span class="comment"># list中指定子类型为str</span></span><br><span class="line">    <span class="comment"># tags: set[str] = set()  # set同理，可以去重</span></span><br><span class="line"></span><br><span class="line"><span class="meta">@app.put(<span class="params"><span class="string">&quot;/items/&#123;item_id&#125;&quot;</span></span>)</span></span><br><span class="line"><span class="keyword">async</span> <span class="keyword">def</span> <span class="title function_">update_item</span>(<span class="params">item_id: <span class="built_in">int</span>, item: Item</span>):</span><br><span class="line">    results = &#123;<span class="string">&quot;item_id&quot;</span>: item_id, <span class="string">&quot;item&quot;</span>: item&#125;</span><br><span class="line">    <span class="keyword">return</span> results</span><br><span class="line"></span><br><span class="line"><span class="meta">@app.post(<span class="params"><span class="string">&quot;/index-weights/&quot;</span></span>)</span></span><br><span class="line"><span class="comment"># dict中指定key为int，value为float。Json的key支持str，会被转换为int</span></span><br><span class="line"><span class="keyword">async</span> <span class="keyword">def</span> <span class="title function_">create_index_weights</span>(<span class="params">weights: <span class="built_in">dict</span>[<span class="built_in">int</span>, <span class="built_in">float</span>]</span>):</span><br><span class="line">    <span class="keyword">return</span> weights</span><br></pre></td></tr></table></figure></p>
<p>2.自定义类型的嵌套：<br />
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> fastapi <span class="keyword">import</span> FastAPI</span><br><span class="line"><span class="keyword">from</span> pydantic <span class="keyword">import</span> BaseModel</span><br><span class="line"></span><br><span class="line">app = FastAPI()</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Image</span>(<span class="title class_ inherited__">BaseModel</span>):</span><br><span class="line">    url: <span class="built_in">str</span></span><br><span class="line">    name: <span class="built_in">str</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Item</span>(<span class="title class_ inherited__">BaseModel</span>):</span><br><span class="line">    name: <span class="built_in">str</span></span><br><span class="line">    description: <span class="built_in">str</span> | <span class="literal">None</span> = <span class="literal">None</span></span><br><span class="line">    price: <span class="built_in">float</span></span><br><span class="line">    tax: <span class="built_in">float</span> | <span class="literal">None</span> = <span class="literal">None</span></span><br><span class="line">    tags: <span class="built_in">set</span>[<span class="built_in">str</span>] = <span class="built_in">set</span>()</span><br><span class="line">    image: Image | <span class="literal">None</span> = <span class="literal">None</span>  <span class="comment"># 嵌套Image模型</span></span><br><span class="line">    <span class="comment"># images: list[Image] | None = None # 支持一组嵌套</span></span><br><span class="line"></span><br><span class="line"><span class="meta">@app.put(<span class="params"><span class="string">&quot;/items/&#123;item_id&#125;&quot;</span></span>)</span></span><br><span class="line"><span class="keyword">async</span> <span class="keyword">def</span> <span class="title function_">update_item</span>(<span class="params">item_id: <span class="built_in">int</span>, item: Item</span>):</span><br><span class="line">    results = &#123;<span class="string">&quot;item_id&quot;</span>: item_id, <span class="string">&quot;item&quot;</span>: item&#125;</span><br><span class="line">    <span class="keyword">return</span> results</span><br><span class="line"></span><br><span class="line"><span class="comment"># 此时期望发送的请求体：</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="string">&quot;name&quot;</span>: <span class="string">&quot;Foo&quot;</span>,</span><br><span class="line">    <span class="string">&quot;description&quot;</span>: <span class="string">&quot;The pretender&quot;</span>,</span><br><span class="line">    <span class="string">&quot;price&quot;</span>: <span class="number">42.0</span>,</span><br><span class="line">    <span class="string">&quot;tax&quot;</span>: <span class="number">3.2</span>,</span><br><span class="line">    <span class="string">&quot;tags&quot;</span>: [<span class="string">&quot;rock&quot;</span>, <span class="string">&quot;metal&quot;</span>, <span class="string">&quot;bar&quot;</span>],</span><br><span class="line">    <span class="string">&quot;image&quot;</span>: &#123; <span class="comment"># 嵌套</span></span><br><span class="line">        <span class="string">&quot;url&quot;</span>: <span class="string">&quot;http://example.com/baz.jpg&quot;</span>,</span><br><span class="line">        <span class="string">&quot;name&quot;</span>: <span class="string">&quot;The Foo live&quot;</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment"># 一组嵌套时，期望发送的请求体：</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="string">&quot;name&quot;</span>: <span class="string">&quot;Foo&quot;</span>,</span><br><span class="line">    <span class="string">&quot;description&quot;</span>: <span class="string">&quot;The pretender&quot;</span>,</span><br><span class="line">    <span class="string">&quot;price&quot;</span>: <span class="number">42.0</span>,</span><br><span class="line">    <span class="string">&quot;tax&quot;</span>: <span class="number">3.2</span>,</span><br><span class="line">    <span class="string">&quot;tags&quot;</span>: [</span><br><span class="line">        <span class="string">&quot;rock&quot;</span>,</span><br><span class="line">        <span class="string">&quot;metal&quot;</span>,</span><br><span class="line">        <span class="string">&quot;bar&quot;</span></span><br><span class="line">    ],</span><br><span class="line">    <span class="string">&quot;images&quot;</span>: [</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="string">&quot;url&quot;</span>: <span class="string">&quot;http://example.com/baz.jpg&quot;</span>,</span><br><span class="line">            <span class="string">&quot;name&quot;</span>: <span class="string">&quot;The Foo live&quot;</span></span><br><span class="line">        &#125;,</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="string">&quot;url&quot;</span>: <span class="string">&quot;http://example.com/dave.jpg&quot;</span>,</span><br><span class="line">            <span class="string">&quot;name&quot;</span>: <span class="string">&quot;The Baz&quot;</span></span><br><span class="line">        &#125;</span><br><span class="line">    ]</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<h2 id="pydantic特殊类型">Pydantic特殊类型</h2>
<p>1.Pydantic还支持其他特殊类型的校验：<br />
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> fastapi <span class="keyword">import</span> FastAPI</span><br><span class="line"><span class="keyword">from</span> pydantic <span class="keyword">import</span> BaseModel, HttpUrl</span><br><span class="line"></span><br><span class="line">app = FastAPI()</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Image</span>(<span class="title class_ inherited__">BaseModel</span>):</span><br><span class="line">    url: HttpUrl  <span class="comment"># 校验url</span></span><br><span class="line">    name: <span class="built_in">str</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Item</span>(<span class="title class_ inherited__">BaseModel</span>):</span><br><span class="line">    name: <span class="built_in">str</span></span><br><span class="line">    description: <span class="built_in">str</span> | <span class="literal">None</span> = <span class="literal">None</span></span><br><span class="line">    price: <span class="built_in">float</span></span><br><span class="line">    tax: <span class="built_in">float</span> | <span class="literal">None</span> = <span class="literal">None</span></span><br><span class="line">    tags: <span class="built_in">set</span>[<span class="built_in">str</span>] = <span class="built_in">set</span>()</span><br><span class="line">    image: Image | <span class="literal">None</span> = <span class="literal">None</span></span><br><span class="line"></span><br><span class="line"><span class="meta">@app.put(<span class="params"><span class="string">&quot;/items/&#123;item_id&#125;&quot;</span></span>)</span></span><br><span class="line"><span class="keyword">async</span> <span class="keyword">def</span> <span class="title function_">update_item</span>(<span class="params">item_id: <span class="built_in">int</span>, item: Item</span>):</span><br><span class="line">    results = &#123;<span class="string">&quot;item_id&quot;</span>: item_id, <span class="string">&quot;item&quot;</span>: item&#125;</span><br><span class="line">    <span class="keyword">return</span> results</span><br></pre></td></tr></table></figure></p>
<p>常见的一些校验：<br />
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line">|-UUID:</span><br><span class="line">    |-一种标准的 &quot;通用唯一标识符&quot; ，在许多数据库和系统中用作ID。</span><br><span class="line">    |-在请求和响应中将以 str 表示。</span><br><span class="line">|-datetime.datetime:</span><br><span class="line">    |-一个 Python datetime.datetime.</span><br><span class="line">    |-在请求和响应中将表示为 ISO 8601 格式的 str ，比如: 2008-09-15T15:53:00+05:00.</span><br><span class="line">|-datetime.date:</span><br><span class="line">    |-Python datetime.date.</span><br><span class="line">    |-在请求和响应中将表示为 ISO 8601 格式的 str ，比如: 2008-09-15.</span><br><span class="line">|-datetime.time:</span><br><span class="line">    |-Python datetime.time.</span><br><span class="line">    |-在请求和响应中将表示为 ISO 8601 格式的 str ，比如: 14:23:55.003.</span><br><span class="line">|-datetime.timedelta:</span><br><span class="line">    |-Python datetime.timedelta.</span><br><span class="line">    |-在请求和响应中将表示为 float 代表总秒数。</span><br><span class="line">    |-Pydantic 也允许将其表示为 &quot;ISO 8601 时间差异编码&quot;.</span><br><span class="line">|-frozenset:</span><br><span class="line">    |-在请求和响应中，作为 set 对待：</span><br><span class="line">    |-在请求中，列表将被读取，消除重复，并将其转换为一个 set。</span><br><span class="line">    |-在响应中 set 将被转换为 list 。</span><br><span class="line">    |-产生的模式将指定那些 set 的值是唯一的 (使用 JSON 模式的 uniqueItems)。</span><br><span class="line">|-bytes:</span><br><span class="line">    |-标准的 Python bytes。</span><br><span class="line">    |-在请求和响应中被当作 str 处理。</span><br><span class="line">    |-生成的模式将指定这个 str 是 binary &quot;格式&quot;。</span><br><span class="line">|-Decimal:</span><br><span class="line">    |-标准的 Python Decimal。</span><br><span class="line">    |-在请求和响应中被当做 float 一样处理。</span><br></pre></td></tr></table></figure></p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> datetime <span class="keyword">import</span> datetime, time, timedelta</span><br><span class="line"><span class="keyword">from</span> uuid <span class="keyword">import</span> UUID</span><br><span class="line"><span class="keyword">from</span> fastapi <span class="keyword">import</span> Body, FastAPI</span><br><span class="line"></span><br><span class="line">app = FastAPI()</span><br><span class="line"></span><br><span class="line"><span class="meta">@app.put(<span class="params"><span class="string">&quot;/items/&#123;item_id&#125;&quot;</span></span>)</span></span><br><span class="line"><span class="keyword">async</span> <span class="keyword">def</span> <span class="title function_">read_items</span>(<span class="params"></span></span><br><span class="line"><span class="params">    item_id: UUID,  <span class="comment"># UUID</span></span></span><br><span class="line"><span class="params">    start_datetime: datetime = Body(<span class="params"></span>),  <span class="comment"># datetime</span></span></span><br><span class="line"><span class="params">    end_datetime: datetime = Body(<span class="params"></span>), <span class="comment"># datetime</span></span></span><br><span class="line"><span class="params">    process_after: timedelta = Body(<span class="params"></span>), <span class="comment"># timedelta</span></span></span><br><span class="line"><span class="params">    repeat_at: time | <span class="literal">None</span> = Body(<span class="params">default=<span class="literal">None</span></span>), <span class="comment"># time</span></span></span><br><span class="line"><span class="params"></span>):</span><br><span class="line">    start_process = start_datetime + process_after</span><br><span class="line">    duration = end_datetime - start_process</span><br><span class="line">    <span class="keyword">return</span> &#123;</span><br><span class="line">        <span class="string">&quot;item_id&quot;</span>: item_id,</span><br><span class="line">        <span class="string">&quot;start_datetime&quot;</span>: start_datetime,</span><br><span class="line">        <span class="string">&quot;end_datetime&quot;</span>: end_datetime,</span><br><span class="line">        <span class="string">&quot;process_after&quot;</span>: process_after,</span><br><span class="line">        <span class="string">&quot;repeat_at&quot;</span>: repeat_at,</span><br><span class="line">        <span class="string">&quot;start_process&quot;</span>: start_process,</span><br><span class="line">        <span class="string">&quot;duration&quot;</span>: duration,</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>
<p>2.使用 Config 和 schema_extra 为Swagger文档添加接口示例：<br />
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> fastapi <span class="keyword">import</span> FastAPI</span><br><span class="line"><span class="keyword">from</span> pydantic <span class="keyword">import</span> BaseModel</span><br><span class="line"></span><br><span class="line">app = FastAPI()</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Item</span>(<span class="title class_ inherited__">BaseModel</span>):</span><br><span class="line">    name: <span class="built_in">str</span></span><br><span class="line">    description: <span class="built_in">str</span> | <span class="literal">None</span> = <span class="literal">None</span></span><br><span class="line">    price: <span class="built_in">float</span></span><br><span class="line">    tax: <span class="built_in">float</span> | <span class="literal">None</span> = <span class="literal">None</span></span><br><span class="line">    model_config = &#123;</span><br><span class="line">        <span class="string">&quot;json_schema_extra&quot;</span>: &#123;</span><br><span class="line">            <span class="string">&quot;examples&quot;</span>: [  <span class="comment"># 会在Request body下显示下面示例</span></span><br><span class="line">                &#123;</span><br><span class="line">                    <span class="string">&quot;name&quot;</span>: <span class="string">&quot;Foo&quot;</span>,</span><br><span class="line">                    <span class="string">&quot;description&quot;</span>: <span class="string">&quot;A very nice Item&quot;</span>,</span><br><span class="line">                    <span class="string">&quot;price&quot;</span>: <span class="number">35.4</span>,</span><br><span class="line">                    <span class="string">&quot;tax&quot;</span>: <span class="number">3.2</span>,</span><br><span class="line">                &#125;</span><br><span class="line">            ]</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">@app.put(<span class="params"><span class="string">&quot;/items/&#123;item_id&#125;&quot;</span></span>)</span></span><br><span class="line"><span class="keyword">async</span> <span class="keyword">def</span> <span class="title function_">update_item</span>(<span class="params">item_id: <span class="built_in">int</span>, item: Item</span>):</span><br><span class="line">    results = &#123;<span class="string">&quot;item_id&quot;</span>: item_id, <span class="string">&quot;item&quot;</span>: item&#125;</span><br><span class="line">    <span class="keyword">return</span> results</span><br></pre></td></tr></table></figure></p>
<p>同样Field, Path, Query, Body都可以添加examples：<br />
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> fastapi <span class="keyword">import</span> FastAPI</span><br><span class="line"><span class="keyword">from</span> pydantic <span class="keyword">import</span> BaseModel, Field</span><br><span class="line"></span><br><span class="line">app = FastAPI()</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Item</span>(<span class="title class_ inherited__">BaseModel</span>):</span><br><span class="line">    name: <span class="built_in">str</span> = Field(examples=[<span class="string">&quot;Foo&quot;</span>]) <span class="comment"># Field添加examples</span></span><br><span class="line">    description: <span class="built_in">str</span> | <span class="literal">None</span> = Field(default=<span class="literal">None</span>, examples=[<span class="string">&quot;A very nice Item&quot;</span>])</span><br><span class="line">    price: <span class="built_in">float</span> = Field(examples=[<span class="number">35.4</span>])</span><br><span class="line">    tax: <span class="built_in">float</span> | <span class="literal">None</span> = Field(default=<span class="literal">None</span>, examples=[<span class="number">3.2</span>])</span><br><span class="line"></span><br><span class="line"><span class="meta">@app.put(<span class="params"><span class="string">&quot;/items/&#123;item_id&#125;&quot;</span></span>)</span></span><br><span class="line"><span class="keyword">async</span> <span class="keyword">def</span> <span class="title function_">update_item</span>(<span class="params">item_id: <span class="built_in">int</span>, item: Item</span>):</span><br><span class="line">    results = &#123;<span class="string">&quot;item_id&quot;</span>: item_id, <span class="string">&quot;item&quot;</span>: item&#125;</span><br><span class="line">    <span class="keyword">return</span> results</span><br><span class="line"></span><br><span class="line"><span class="meta">@app.put(<span class="params"><span class="string">&quot;/items/&#123;item_id&#125;&quot;</span></span>)</span></span><br><span class="line"><span class="keyword">async</span> <span class="keyword">def</span> <span class="title function_">update_item</span>(<span class="params"></span></span><br><span class="line"><span class="params">    item_id: <span class="built_in">int</span>,</span></span><br><span class="line"><span class="params">    item: Item = Body(<span class="params"> <span class="comment"># Body添加examples</span></span></span></span><br><span class="line"><span class="params"><span class="params">        examples=[</span></span></span><br><span class="line"><span class="params"><span class="params">            &#123;</span></span></span><br><span class="line"><span class="params"><span class="params">                <span class="string">&quot;name&quot;</span>: <span class="string">&quot;Foo&quot;</span>,</span></span></span><br><span class="line"><span class="params"><span class="params">                <span class="string">&quot;description&quot;</span>: <span class="string">&quot;A very nice Item&quot;</span>,</span></span></span><br><span class="line"><span class="params"><span class="params">                <span class="string">&quot;price&quot;</span>: <span class="number">35.4</span>,</span></span></span><br><span class="line"><span class="params"><span class="params">                <span class="string">&quot;tax&quot;</span>: <span class="number">3.2</span>,</span></span></span><br><span class="line"><span class="params"><span class="params">            &#125;</span></span></span><br><span class="line"><span class="params"><span class="params">        ],</span></span></span><br><span class="line"><span class="params"><span class="params">    </span>),</span></span><br><span class="line"><span class="params"></span>):</span><br><span class="line">    results = &#123;<span class="string">&quot;item_id&quot;</span>: item_id, <span class="string">&quot;item&quot;</span>: item&#125;</span><br><span class="line">    <span class="keyword">return</span> results</span><br></pre></td></tr></table></figure></p>
<h2 id="dataclass模型">dataclass模型</h2>
<p>FastAPI
还可以使用Python自带的数据类（dataclasses），自动生成一些常见的方法，如
<code>__init__</code>、<code>__repr__</code>、<code>__eq__</code>
等。可以和Pydantic模型一起使用，Pydantic模型可以处理数据验证、序列化等。<br />
FastAPI中，即使代码中没有显式使用Pydantic，仍会自动使用Pydantic把dataclasses数据类转换为Pydantic数据类（Pydantic有自己的dataclasses）。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> dataclasses <span class="keyword">import</span> dataclass, field</span><br><span class="line"><span class="keyword">from</span> typing <span class="keyword">import</span> <span class="type">List</span>, <span class="type">Union</span></span><br><span class="line"><span class="keyword">from</span> fastapi <span class="keyword">import</span> FastAPI</span><br><span class="line"></span><br><span class="line"><span class="meta">@dataclass  </span><span class="comment"># 数据类，自动为Item生成一些常见的方法</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Item</span>: <span class="comment"># FastAPI会把@dataclass装饰的Item转为Pydantic自己的dataclasses</span></span><br><span class="line">    name: <span class="built_in">str</span></span><br><span class="line">    price: <span class="built_in">float</span></span><br><span class="line">    tags: <span class="type">List</span>[<span class="built_in">str</span>] = field(default_factory=<span class="built_in">list</span>)</span><br><span class="line">    description: <span class="type">Union</span>[<span class="built_in">str</span>, <span class="literal">None</span>] = <span class="literal">None</span></span><br><span class="line">    tax: <span class="type">Union</span>[<span class="built_in">float</span>, <span class="literal">None</span>] = <span class="literal">None</span></span><br><span class="line"></span><br><span class="line">app = FastAPI()</span><br><span class="line"></span><br><span class="line"><span class="meta">@app.get(<span class="params"><span class="string">&quot;/items/next&quot;</span>, response_model=Item</span>)</span></span><br><span class="line"><span class="keyword">async</span> <span class="keyword">def</span> <span class="title function_">read_next_item</span>():</span><br><span class="line">    <span class="keyword">return</span> &#123;</span><br><span class="line">        <span class="string">&quot;name&quot;</span>: <span class="string">&quot;Island In The Moon&quot;</span>,</span><br><span class="line">        <span class="string">&quot;price&quot;</span>: <span class="number">12.99</span>,</span><br><span class="line">        <span class="string">&quot;description&quot;</span>: <span class="string">&quot;A place to be playin&#x27; and havin&#x27; fun&quot;</span>,</span><br><span class="line">        <span class="string">&quot;tags&quot;</span>: [<span class="string">&quot;breater&quot;</span>],</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>
<p>嵌套dataclass，使用Pydantic有自己的dataclasses：<br />
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> dataclasses <span class="keyword">import</span> field  <span class="comment"># field约束需要从标准库导入</span></span><br><span class="line"><span class="keyword">from</span> pydantic.dataclasses <span class="keyword">import</span> dataclass  <span class="comment"># 使用pydantic的dataclasses</span></span><br><span class="line"><span class="keyword">from</span> typing <span class="keyword">import</span> <span class="type">List</span>, <span class="type">Union</span></span><br><span class="line"><span class="keyword">from</span> fastapi <span class="keyword">import</span> FastAPI</span><br><span class="line"></span><br><span class="line"><span class="meta">@dataclass</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Item</span>:</span><br><span class="line">    name: <span class="built_in">str</span></span><br><span class="line">    description: <span class="type">Union</span>[<span class="built_in">str</span>, <span class="literal">None</span>] = <span class="literal">None</span></span><br><span class="line"></span><br><span class="line"><span class="meta">@dataclass</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Author</span>:</span><br><span class="line">    name: <span class="built_in">str</span></span><br><span class="line">    items: <span class="type">List</span>[Item] = field(default_factory=<span class="built_in">list</span>)  <span class="comment"># 约束</span></span><br><span class="line"></span><br><span class="line">app = FastAPI()</span><br><span class="line"></span><br><span class="line"><span class="meta">@app.post(<span class="params"><span class="string">&quot;/authors/&#123;author_id&#125;/items/&quot;</span>, response_model=Author</span>)</span></span><br><span class="line"><span class="keyword">async</span> <span class="keyword">def</span> <span class="title function_">create_author_items</span>(<span class="params">author_id: <span class="built_in">str</span>, items: <span class="type">List</span>[Item]</span>):</span><br><span class="line">    <span class="comment"># FastAPI 使用（包含数据类的） response_model 参数转换响应。</span></span><br><span class="line">    <span class="keyword">return</span> &#123;<span class="string">&quot;name&quot;</span>: author_id, <span class="string">&quot;items&quot;</span>: items&#125;  </span><br><span class="line"></span><br><span class="line"><span class="meta">@app.get(<span class="params"><span class="string">&quot;/authors/&quot;</span>, response_model=<span class="type">List</span>[Author]</span>)  </span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">get_authors</span>():  </span><br><span class="line">    <span class="comment"># FastAPI 使用（包含数据类的） response_model 参数转换响应。</span></span><br><span class="line">    <span class="keyword">return</span> [  </span><br><span class="line">        &#123;</span><br><span class="line">            <span class="string">&quot;name&quot;</span>: <span class="string">&quot;Breaters&quot;</span>,</span><br><span class="line">            <span class="string">&quot;items&quot;</span>: [</span><br><span class="line">                &#123;</span><br><span class="line">                    <span class="string">&quot;name&quot;</span>: <span class="string">&quot;Island In The Moon&quot;</span>,</span><br><span class="line">                    <span class="string">&quot;description&quot;</span>: <span class="string">&quot;A place to be playin&#x27; and havin&#x27; fun&quot;</span>,</span><br><span class="line">                &#125;,</span><br><span class="line">                &#123;<span class="string">&quot;name&quot;</span>: <span class="string">&quot;Holy Buddies&quot;</span>&#125;,</span><br><span class="line">            ],</span><br><span class="line">        &#125;,</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="string">&quot;name&quot;</span>: <span class="string">&quot;System of an Up&quot;</span>,</span><br><span class="line">            <span class="string">&quot;items&quot;</span>: [</span><br><span class="line">                &#123;</span><br><span class="line">                    <span class="string">&quot;name&quot;</span>: <span class="string">&quot;Salt&quot;</span>,</span><br><span class="line">                    <span class="string">&quot;description&quot;</span>: <span class="string">&quot;The kombucha mushroom people&#x27;s favorite&quot;</span>,</span><br><span class="line">                &#125;,</span><br><span class="line">                &#123;<span class="string">&quot;name&quot;</span>: <span class="string">&quot;Pad Thai&quot;</span>&#125;,</span><br><span class="line">                &#123;</span><br><span class="line">                    <span class="string">&quot;name&quot;</span>: <span class="string">&quot;Lonely Night&quot;</span>,</span><br><span class="line">                    <span class="string">&quot;description&quot;</span>: <span class="string">&quot;The mostests lonliest nightiest of allest&quot;</span>,</span><br><span class="line">                &#125;,</span><br><span class="line">            ],</span><br><span class="line">        &#125;,</span><br><span class="line">    ]</span><br></pre></td></tr></table></figure></p>
<h1 id="请求体">请求体</h1>
<p>FastAPI 使用<strong>请求体</strong>从客户端（例如浏览器）向 API
发送数据。<br />
<strong>请求体</strong>是客户端发送给 API
的数据。<strong>响应体</strong>是 API 发送给客户端的数据。API
基本上肯定要发送<strong>响应体</strong>，但是客户端不一定发送<strong>请求体</strong>。<br />
使用 Pydantic
模型声明<strong>请求体</strong>，能充分利用它的功能和优点。</p>
<h2 id="基础使用-2">基础使用</h2>
<p>1.从 pydantic 中导入 BaseModel，把数据模型声明为继承 BaseModel
的类。<br />
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> fastapi <span class="keyword">import</span> FastAPI</span><br><span class="line"><span class="keyword">from</span> pydantic <span class="keyword">import</span> BaseModel</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Item</span>(<span class="title class_ inherited__">BaseModel</span>): <span class="comment"># 继承BaseModel类</span></span><br><span class="line">    name: <span class="built_in">str</span></span><br><span class="line">    description: <span class="built_in">str</span> | <span class="literal">None</span> = <span class="literal">None</span>  <span class="comment"># 可选参数（默认值为None）</span></span><br><span class="line">    price: <span class="built_in">float</span></span><br><span class="line">    tax: <span class="built_in">float</span> | <span class="literal">None</span> = <span class="literal">None</span>  <span class="comment"># 可选参数（默认值为None）</span></span><br><span class="line"> </span><br><span class="line">app = FastAPI()</span><br><span class="line"></span><br><span class="line"><span class="meta">@app.post(<span class="params"><span class="string">&quot;/items/&quot;</span></span>)</span></span><br><span class="line"><span class="keyword">async</span> <span class="keyword">def</span> <span class="title function_">create_item</span>(<span class="params">item: Item</span>): <span class="comment"># item参数的类型为Item，自动将&quot;请求体&quot;中的数据解析为Item类型</span></span><br><span class="line">    <span class="keyword">return</span> item</span><br><span class="line"></span><br><span class="line"><span class="comment"># description和tax是可选的（默认值为 None），所以请求body可以是：</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="string">&quot;name&quot;</span>: <span class="string">&quot;Foo&quot;</span>,</span><br><span class="line">    <span class="string">&quot;price&quot;</span>: <span class="number">45.2</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>2.使用"."访问模型对象属性：<br />
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@app.post(<span class="params"><span class="string">&quot;/items/&quot;</span></span>)</span></span><br><span class="line"><span class="keyword">async</span> <span class="keyword">def</span> <span class="title function_">create_item</span>(<span class="params">item: Item</span>):</span><br><span class="line">    item_dict = item.<span class="built_in">dict</span>()</span><br><span class="line">    <span class="keyword">if</span> item.tax:</span><br><span class="line">        price_with_tax = item.price + item.tax  <span class="comment"># 访问item属性</span></span><br><span class="line">        item_dict.update(&#123;<span class="string">&quot;price_with_tax&quot;</span>: price_with_tax&#125;)</span><br><span class="line">    <span class="keyword">return</span> item_dict</span><br></pre></td></tr></table></figure></p>
<h2 id="多参数混合">多参数混合</h2>
<p>1.支持，<strong>路径参数</strong> + <strong>查询参数</strong> +
<strong>请求体</strong>：<br />
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> fastapi <span class="keyword">import</span> FastAPI</span><br><span class="line"><span class="keyword">from</span> pydantic <span class="keyword">import</span> BaseModel</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Item</span>(<span class="title class_ inherited__">BaseModel</span>):</span><br><span class="line">    name: <span class="built_in">str</span></span><br><span class="line">    description: <span class="built_in">str</span> | <span class="literal">None</span> = <span class="literal">None</span></span><br><span class="line">    price: <span class="built_in">float</span></span><br><span class="line">    tax: <span class="built_in">float</span> | <span class="literal">None</span> = <span class="literal">None</span></span><br><span class="line"></span><br><span class="line">app = FastAPI()</span><br><span class="line"></span><br><span class="line"><span class="meta">@app.put(<span class="params"><span class="string">&quot;/items/&#123;item_id&#125;&quot;</span></span>) </span><span class="comment"># 路径参数</span></span><br><span class="line"><span class="keyword">async</span> <span class="keyword">def</span> <span class="title function_">update_item</span>(<span class="params">item_id: <span class="built_in">int</span>, item: Item, q: <span class="built_in">str</span> | <span class="literal">None</span> = <span class="literal">None</span></span>): <span class="comment"># q查询参数，item请求体</span></span><br><span class="line">    result = &#123;<span class="string">&quot;item_id&quot;</span>: item_id, **item.<span class="built_in">dict</span>()&#125;</span><br><span class="line">    <span class="keyword">if</span> q:</span><br><span class="line">        result.update(&#123;<span class="string">&quot;q&quot;</span>: q&#125;)</span><br><span class="line">    <span class="keyword">return</span> result</span><br></pre></td></tr></table></figure></p>
<p>2.多个请求体参数 + 单个请求体参数：<br />
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> fastapi <span class="keyword">import</span> FastAPI</span><br><span class="line"><span class="keyword">from</span> pydantic <span class="keyword">import</span> BaseModel</span><br><span class="line"></span><br><span class="line">app = FastAPI()</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Item</span>(<span class="title class_ inherited__">BaseModel</span>):</span><br><span class="line">    name: <span class="built_in">str</span></span><br><span class="line">    description: <span class="built_in">str</span> | <span class="literal">None</span> = <span class="literal">None</span></span><br><span class="line">    price: <span class="built_in">float</span></span><br><span class="line">    tax: <span class="built_in">float</span> | <span class="literal">None</span> = <span class="literal">None</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">User</span>(<span class="title class_ inherited__">BaseModel</span>):</span><br><span class="line">    username: <span class="built_in">str</span></span><br><span class="line">    full_name: <span class="built_in">str</span> | <span class="literal">None</span> = <span class="literal">None</span></span><br><span class="line"></span><br><span class="line"><span class="meta">@app.put(<span class="params"><span class="string">&quot;/items/&#123;item_id&#125;&quot;</span></span>)</span></span><br><span class="line"><span class="comment"># item 和 user 两个请求体参数，importance单个参数（指定从Body获取）</span></span><br><span class="line"><span class="keyword">async</span> <span class="keyword">def</span> <span class="title function_">update_item</span>(<span class="params">item_id: <span class="built_in">int</span>, item: Item, user: User, importance: <span class="built_in">int</span> = Body(<span class="params"></span>)</span>):</span><br><span class="line">    results = &#123;<span class="string">&quot;item_id&quot;</span>: item_id, <span class="string">&quot;item&quot;</span>: item, <span class="string">&quot;user&quot;</span>: user&#125;</span><br><span class="line">    <span class="keyword">return</span> results</span><br><span class="line"></span><br><span class="line"><span class="comment"># 注意输入的请求体将&quot;参数名&quot;作为键，期望输入如下：</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="string">&quot;item&quot;</span>: &#123;</span><br><span class="line">        <span class="string">&quot;name&quot;</span>: <span class="string">&quot;Foo&quot;</span>,</span><br><span class="line">        <span class="string">&quot;description&quot;</span>: <span class="string">&quot;The pretender&quot;</span>,</span><br><span class="line">        <span class="string">&quot;price&quot;</span>: <span class="number">42.0</span>,</span><br><span class="line">        <span class="string">&quot;tax&quot;</span>: <span class="number">3.2</span></span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="string">&quot;user&quot;</span>: &#123;</span><br><span class="line">        <span class="string">&quot;username&quot;</span>: <span class="string">&quot;dave&quot;</span>,</span><br><span class="line">        <span class="string">&quot;full_name&quot;</span>: <span class="string">&quot;Dave Grohl&quot;</span></span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="string">&quot;importance&quot;</span>: <span class="number">5</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>3.多个请求体参数 + 查询参数：<br />
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> fastapi <span class="keyword">import</span> Body, FastAPI</span><br><span class="line"><span class="keyword">from</span> pydantic <span class="keyword">import</span> BaseModel</span><br><span class="line"></span><br><span class="line">app = FastAPI()</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Item</span>(<span class="title class_ inherited__">BaseModel</span>):</span><br><span class="line">    name: <span class="built_in">str</span></span><br><span class="line">    description: <span class="built_in">str</span> | <span class="literal">None</span> = <span class="literal">None</span></span><br><span class="line">    price: <span class="built_in">float</span></span><br><span class="line">    tax: <span class="built_in">float</span> | <span class="literal">None</span> = <span class="literal">None</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">User</span>(<span class="title class_ inherited__">BaseModel</span>):</span><br><span class="line">    username: <span class="built_in">str</span></span><br><span class="line">    full_name: <span class="built_in">str</span> | <span class="literal">None</span> = <span class="literal">None</span></span><br><span class="line"></span><br><span class="line"><span class="meta">@app.put(<span class="params"><span class="string">&quot;/items/&#123;item_id&#125;&quot;</span></span>)</span></span><br><span class="line"><span class="keyword">async</span> <span class="keyword">def</span> <span class="title function_">update_item</span>(<span class="params"></span></span><br><span class="line"><span class="params">    *,</span></span><br><span class="line"><span class="params">    item_id: <span class="built_in">int</span>, <span class="comment"># 默认为Path参数</span></span></span><br><span class="line"><span class="params">    item: Item, <span class="comment"># 默认为Body参数（自定义）</span></span></span><br><span class="line"><span class="params">    user: User, <span class="comment"># 默认为Body参数（自定义）</span></span></span><br><span class="line"><span class="params">    importance: <span class="built_in">int</span> = Body(<span class="params">gt=<span class="number">0</span></span>), <span class="comment"># 指定为Body参数</span></span></span><br><span class="line"><span class="params">    q: <span class="built_in">str</span> | <span class="literal">None</span> = <span class="literal">None</span>, <span class="comment"># 默认为Query参数</span></span></span><br><span class="line"><span class="params"></span>): </span><br><span class="line">    results = &#123;<span class="string">&quot;item_id&quot;</span>: item_id, <span class="string">&quot;item&quot;</span>: item, <span class="string">&quot;user&quot;</span>: user, <span class="string">&quot;importance&quot;</span>: importance&#125;</span><br><span class="line">    <span class="keyword">if</span> q:</span><br><span class="line">        results.update(&#123;<span class="string">&quot;q&quot;</span>: q&#125;)</span><br><span class="line">    <span class="keyword">return</span> results</span><br></pre></td></tr></table></figure></p>
<p>4.单个请求体参数，指定使用key：<br />
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> fastapi <span class="keyword">import</span> Body, FastAPI</span><br><span class="line"><span class="keyword">from</span> pydantic <span class="keyword">import</span> BaseModel</span><br><span class="line"></span><br><span class="line">app = FastAPI()</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Item</span>(<span class="title class_ inherited__">BaseModel</span>):</span><br><span class="line">    name: <span class="built_in">str</span></span><br><span class="line">    description: <span class="built_in">str</span> | <span class="literal">None</span> = <span class="literal">None</span></span><br><span class="line">    price: <span class="built_in">float</span></span><br><span class="line">    tax: <span class="built_in">float</span> | <span class="literal">None</span> = <span class="literal">None</span></span><br><span class="line"></span><br><span class="line"><span class="meta">@app.put(<span class="params"><span class="string">&quot;/items/&#123;item_id&#125;&quot;</span></span>)</span></span><br><span class="line"><span class="comment"># embed=True表示此参数像多个请求体参数一样，要把参数名作为key</span></span><br><span class="line"><span class="keyword">async</span> <span class="keyword">def</span> <span class="title function_">update_item</span>(<span class="params">item_id: <span class="built_in">int</span>, item: Item = Body(<span class="params">embed=<span class="literal">True</span></span>)</span>):</span><br><span class="line">    results = &#123;<span class="string">&quot;item_id&quot;</span>: item_id, <span class="string">&quot;item&quot;</span>: item&#125;</span><br><span class="line">    <span class="keyword">return</span> results</span><br><span class="line"></span><br><span class="line"><span class="comment"># 此时请求期望如下：</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="string">&quot;item&quot;</span>: &#123; <span class="comment"># 要把参数名作为key</span></span><br><span class="line">        <span class="string">&quot;name&quot;</span>: <span class="string">&quot;Foo&quot;</span>,</span><br><span class="line">        <span class="string">&quot;description&quot;</span>: <span class="string">&quot;The pretender&quot;</span>,</span><br><span class="line">        <span class="string">&quot;price&quot;</span>: <span class="number">42.0</span>,</span><br><span class="line">        <span class="string">&quot;tax&quot;</span>: <span class="number">3.2</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<h2 id="参数校验-2">参数校验</h2>
<p>Body与Query、Path声明校验与元数据的方式一样，参数也相同。<br />
Pydantic模型使用Field在模型内部声明校验和元数据，也和Body、Query、Path声明校验与元数据的方式一样，参数也相同。<br />
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> fastapi <span class="keyword">import</span> Body, FastAPI</span><br><span class="line"><span class="keyword">from</span> pydantic <span class="keyword">import</span> BaseModel, Field</span><br><span class="line"></span><br><span class="line">app = FastAPI()</span><br><span class="line"></span><br><span class="line"><span class="comment"># Pydantic模型中使用Field进行参数校验</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Item</span>(<span class="title class_ inherited__">BaseModel</span>):</span><br><span class="line">    name: <span class="built_in">str</span></span><br><span class="line">    description: <span class="built_in">str</span> | <span class="literal">None</span> = Field(default=<span class="literal">None</span>, title=<span class="string">&quot;The description of the item&quot;</span>, max_length=<span class="number">300</span>)</span><br><span class="line">    price: <span class="built_in">float</span> = Field(gt=<span class="number">0</span>, description=<span class="string">&quot;The price must be greater than zero&quot;</span>)</span><br><span class="line">    tax: <span class="built_in">float</span> | <span class="literal">None</span> = <span class="literal">None</span></span><br><span class="line"></span><br><span class="line"><span class="meta">@app.put(<span class="params"><span class="string">&quot;/items/&#123;item_id&#125;&quot;</span></span>)</span></span><br><span class="line"><span class="keyword">async</span> <span class="keyword">def</span> <span class="title function_">update_item</span>(<span class="params">item_id: <span class="built_in">int</span>, item: Item = Body(<span class="params">embed=<span class="literal">True</span></span>)</span>):</span><br><span class="line">    results = &#123;<span class="string">&quot;item_id&quot;</span>: item_id, <span class="string">&quot;item&quot;</span>: item&#125;</span><br><span class="line">    <span class="keyword">return</span> results</span><br></pre></td></tr></table></figure></p>
<h1 id="cookie参数">Cookie参数</h1>
<p>1.定义 Cookie 参数与定义 Query 和 Path 参数一样：<br />
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> fastapi <span class="keyword">import</span> Cookie, FastAPI</span><br><span class="line"></span><br><span class="line">app = FastAPI()</span><br><span class="line"></span><br><span class="line"><span class="meta">@app.get(<span class="params"><span class="string">&quot;/items/&quot;</span></span>)</span></span><br><span class="line"><span class="comment"># 第一个值是默认值，还可以传递所有验证参数或注释参数：</span></span><br><span class="line"><span class="keyword">async</span> <span class="keyword">def</span> <span class="title function_">read_items</span>(<span class="params">ads_id: <span class="built_in">str</span> | <span class="literal">None</span> = Cookie(<span class="params">default=<span class="literal">None</span></span>)</span>):</span><br><span class="line">    <span class="keyword">return</span> &#123;<span class="string">&quot;ads_id&quot;</span>: ads_id&#125;</span><br></pre></td></tr></table></figure></p>
<p>2.Cookie也可以使用Pydantic模型定义，并且可以包含多个字段：<br />
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> fastapi <span class="keyword">import</span> Cookie, FastAPI</span><br><span class="line"><span class="keyword">from</span> pydantic <span class="keyword">import</span> BaseModel</span><br><span class="line"></span><br><span class="line">app = FastAPI()</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Cookies</span>(<span class="title class_ inherited__">BaseModel</span>):</span><br><span class="line">    <span class="comment"># model_config = &#123;&quot;extra&quot;: &quot;forbid&quot;&#125;</span></span><br><span class="line">    session_id: <span class="built_in">str</span></span><br><span class="line">    fatebook_tracker: <span class="built_in">str</span> | <span class="literal">None</span> = <span class="literal">None</span></span><br><span class="line">    googall_tracker: <span class="built_in">str</span> | <span class="literal">None</span> = <span class="literal">None</span></span><br><span class="line"></span><br><span class="line"><span class="meta">@app.get(<span class="params"><span class="string">&quot;/items/&quot;</span></span>)</span></span><br><span class="line"><span class="keyword">async</span> <span class="keyword">def</span> <span class="title function_">read_items</span>(<span class="params">cookies: Cookies = Cookie(<span class="params"></span>)</span>):</span><br><span class="line">    <span class="keyword">return</span> cookies</span><br></pre></td></tr></table></figure></p>
<h1 id="响应cookie">响应Cookie</h1>
<p>可以在响应中定义一个Response参数，这样就可以在这个临时响应对象中设置cookie。<br />
也可以创建一个JSONResponse对象，再添加cookie：<br />
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> fastapi <span class="keyword">import</span> FastAPI, Response</span><br><span class="line"><span class="keyword">from</span> fastapi.responses <span class="keyword">import</span> JSONResponse</span><br><span class="line"></span><br><span class="line">app = FastAPI()</span><br><span class="line"></span><br><span class="line"><span class="meta">@app.post(<span class="params"><span class="string">&quot;/cookie-and-object/&quot;</span></span>)</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">create_cookie</span>(<span class="params">response: Response</span>): <span class="comment"># 临时响应对象</span></span><br><span class="line">    response.set_cookie(key=<span class="string">&quot;fakesession&quot;</span>, value=<span class="string">&quot;fake-cookie-session-value&quot;</span>) <span class="comment"># 在响应中添加cookie</span></span><br><span class="line">    <span class="keyword">return</span> &#123;<span class="string">&quot;message&quot;</span>: <span class="string">&quot;Come to the dark side, we have cookies&quot;</span>&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">@app.post(<span class="params"><span class="string">&quot;/cookie/&quot;</span></span>)</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">create_cookie</span>():</span><br><span class="line">    content = &#123;<span class="string">&quot;message&quot;</span>: <span class="string">&quot;Come to the dark side, we have cookies&quot;</span>&#125;</span><br><span class="line">    response = JSONResponse(content=content) <span class="comment"># 创建JSONResponse</span></span><br><span class="line">    response.set_cookie(key=<span class="string">&quot;fakesession&quot;</span>, value=<span class="string">&quot;fake-cookie-session-value&quot;</span>) <span class="comment"># 添加cookie</span></span><br><span class="line">    <span class="keyword">return</span> response</span><br></pre></td></tr></table></figure></p>
<h1 id="header参数">Header参数</h1>
<p>Header 和 Path、Query、Cookie 一样的结构，但提供了更多功能。<br />
1.比如大部分标准请求头用<strong>连字符</strong>分隔，即<strong>减号</strong>（-），但是
user-agent 这样的变量在 Python 中是无效的，因此，默认情况下，Header
把参数名中的字符由下划线（_）改为连字符（-）来提取并存档请求头，同时，HTTP
的请求头不区分大小写，可以使用 Python 标准样式（即
snake_case）进行声明。如需禁用下划线自动转换为连字符，可以把 Header 的
convert_underscores 参数设置为 False（慎用）：<br />
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> fastapi <span class="keyword">import</span> FastAPI, Header</span><br><span class="line"></span><br><span class="line">app = FastAPI()</span><br><span class="line"></span><br><span class="line"><span class="meta">@app.get(<span class="params"><span class="string">&quot;/items/&quot;</span></span>)</span></span><br><span class="line"><span class="keyword">async</span> <span class="keyword">def</span> <span class="title function_">read_items</span>(<span class="params"></span></span><br><span class="line"><span class="params">    <span class="comment"># 慎用convert_underscores=Falses</span></span></span><br><span class="line"><span class="params">    user_agent: <span class="built_in">str</span> | <span class="literal">None</span> = Header(<span class="params">default=<span class="literal">None</span>, </span>) <span class="comment"># 从Header中获取User-Agent</span></span></span><br><span class="line"><span class="params"></span>):</span><br><span class="line">    <span class="keyword">return</span> &#123;<span class="string">&quot;user_agent&quot;</span>: user_agent&#125;</span><br></pre></td></tr></table></figure></p>
<p>2.重复的请求头，有时，可能需要接收重复的请求头。即同一个请求头有多个值。使用
Python list 可以接收重复请求头所有的值：<br />
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> fastapi <span class="keyword">import</span> FastAPI, Header</span><br><span class="line"></span><br><span class="line">app = FastAPI()</span><br><span class="line"></span><br><span class="line"><span class="meta">@app.get(<span class="params"><span class="string">&quot;/items/&quot;</span></span>)</span></span><br><span class="line"><span class="comment"># list[str]接收重复的请求头</span></span><br><span class="line"><span class="keyword">async</span> <span class="keyword">def</span> <span class="title function_">read_items</span>(<span class="params">x_token: <span class="built_in">list</span>[<span class="built_in">str</span>] | <span class="literal">None</span> = Header(<span class="params">default=<span class="literal">None</span></span>)</span>):</span><br><span class="line">    <span class="keyword">return</span> &#123;<span class="string">&quot;X-Token values&quot;</span>: x_token&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment"># 此时请求Header发送：</span></span><br><span class="line">X-Token: foo</span><br><span class="line">X-Token: bar</span><br><span class="line"><span class="comment"># 返回响应结果：</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="string">&quot;X-Token values&quot;</span>: [</span><br><span class="line">        <span class="string">&quot;bar&quot;</span>,</span><br><span class="line">        <span class="string">&quot;foo&quot;</span></span><br><span class="line">    ]</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>3.Header参数也可以使用Pydantic模型定义，并且可以包含多个字段：<br />
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> fastapi <span class="keyword">import</span> FastAPI, Header</span><br><span class="line"><span class="keyword">from</span> pydantic <span class="keyword">import</span> BaseModel</span><br><span class="line"></span><br><span class="line">app = FastAPI()</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">CommonHeaders</span>(<span class="title class_ inherited__">BaseModel</span>):</span><br><span class="line">    <span class="comment"># model_config = &#123;&quot;extra&quot;: &quot;forbid&quot;&#125;</span></span><br><span class="line">    host: <span class="built_in">str</span></span><br><span class="line">    save_data: <span class="built_in">bool</span></span><br><span class="line">    if_modified_since: <span class="built_in">str</span> | <span class="literal">None</span> = <span class="literal">None</span></span><br><span class="line">    traceparent: <span class="built_in">str</span> | <span class="literal">None</span> = <span class="literal">None</span></span><br><span class="line">    x_tag: <span class="built_in">list</span>[<span class="built_in">str</span>] = []</span><br><span class="line"></span><br><span class="line"><span class="meta">@app.get(<span class="params"><span class="string">&quot;/items/&quot;</span></span>)</span></span><br><span class="line"><span class="keyword">async</span> <span class="keyword">def</span> <span class="title function_">read_items</span>(<span class="params">headers: CommonHeaders = Header(<span class="params"></span>)</span>):</span><br><span class="line">    <span class="keyword">return</span> headers</span><br></pre></td></tr></table></figure></p>
<h1 id="响应header">响应Header</h1>
<p>可以在响应中定义一个Response参数，这样就可以在这个临时响应对象中设置header。<br />
也可以创建一个JSONResponse对象，再添加header：<br />
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> fastapi <span class="keyword">import</span> FastAPI, Response</span><br><span class="line"><span class="keyword">from</span> fastapi.responses <span class="keyword">import</span> JSONResponse</span><br><span class="line"></span><br><span class="line">app = FastAPI()</span><br><span class="line"></span><br><span class="line"><span class="meta">@app.get(<span class="params"><span class="string">&quot;/headers-and-object/&quot;</span></span>)</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">get_headers</span>(<span class="params">response: Response</span>): <span class="comment"># 临时响应对象</span></span><br><span class="line">    response.headers[<span class="string">&quot;X-Cat-Dog&quot;</span>] = <span class="string">&quot;alone in the world&quot;</span>  <span class="comment"># 响应中添加header</span></span><br><span class="line">    <span class="keyword">return</span> &#123;<span class="string">&quot;message&quot;</span>: <span class="string">&quot;Hello World&quot;</span>&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">@app.get(<span class="params"><span class="string">&quot;/headers/&quot;</span></span>)</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">get_headers</span>():</span><br><span class="line">    content = &#123;<span class="string">&quot;message&quot;</span>: <span class="string">&quot;Hello World&quot;</span>&#125;</span><br><span class="line">    headers = &#123;<span class="string">&quot;X-Cat-Dog&quot;</span>: <span class="string">&quot;alone in the world&quot;</span>, <span class="string">&quot;Content-Language&quot;</span>: <span class="string">&quot;en-US&quot;</span>&#125;</span><br><span class="line">    <span class="keyword">return</span> JSONResponse(content=content, headers=headers) <span class="comment"># 创建JSONResponse，并添加header</span></span><br></pre></td></tr></table></figure></p>
<h1 id="响应方式">响应方式</h1>
<p>FastAPI 默认会使用 JSONResponse 返回响应。<br />
1.JSONResponse是Response的子类，JSONResponse不能直接使用Pydantic模型，需要将其转换为dict，并将所有数据类型（如
datetime、UUID 等）转换为兼容 JSON
的类型（使用jsonable_encoder，参考【编码兼容】）：<br />
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> datetime <span class="keyword">import</span> datetime</span><br><span class="line"><span class="keyword">from</span> typing <span class="keyword">import</span> <span class="type">Union</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">from</span> fastapi <span class="keyword">import</span> FastAPI</span><br><span class="line"><span class="keyword">from</span> fastapi.encoders <span class="keyword">import</span> jsonable_encoder</span><br><span class="line"><span class="keyword">from</span> fastapi.responses <span class="keyword">import</span> JSONResponse</span><br><span class="line"><span class="keyword">from</span> pydantic <span class="keyword">import</span> BaseModel</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Item</span>(<span class="title class_ inherited__">BaseModel</span>):</span><br><span class="line">    title: <span class="built_in">str</span></span><br><span class="line">    timestamp: datetime</span><br><span class="line">    description: <span class="type">Union</span>[<span class="built_in">str</span>, <span class="literal">None</span>] = <span class="literal">None</span></span><br><span class="line"></span><br><span class="line">app = FastAPI()</span><br><span class="line"></span><br><span class="line"><span class="meta">@app.put(<span class="params"><span class="string">&quot;/items/&#123;id&#125;&quot;</span></span>)</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">update_item</span>(<span class="params"><span class="built_in">id</span>: <span class="built_in">str</span>, item: Item</span>):</span><br><span class="line">    json_compatible_item_data = jsonable_encoder(item) <span class="comment"># 需要先转化为兼容json类型</span></span><br><span class="line">    <span class="keyword">return</span> JSONResponse(content=json_compatible_item_data)</span><br></pre></td></tr></table></figure></p>
<p>2.上面本可以直接返回item，但为了兼容JSON，需要使用jsonable_encoder。<br />
现在使用Response返回一个自定义的响应，保持原始类型，注意，它没有校验，也不会转换（序列化）：<br />
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> fastapi <span class="keyword">import</span> FastAPI, Response</span><br><span class="line"></span><br><span class="line">app = FastAPI()</span><br><span class="line"></span><br><span class="line"><span class="meta">@app.get(<span class="params"><span class="string">&quot;/legacy/&quot;</span></span>)</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">get_legacy_data</span>():</span><br><span class="line">    data = <span class="string">&quot;&quot;&quot;&lt;?xml version=&quot;1.0&quot;?&gt;</span></span><br><span class="line"><span class="string">    &lt;shampoo&gt;</span></span><br><span class="line"><span class="string">    &lt;Header&gt;</span></span><br><span class="line"><span class="string">        Apply shampoo here.</span></span><br><span class="line"><span class="string">    &lt;/Header&gt;</span></span><br><span class="line"><span class="string">    &lt;Body&gt;</span></span><br><span class="line"><span class="string">        You&#x27;ll have to use soap here.</span></span><br><span class="line"><span class="string">    &lt;/Body&gt;</span></span><br><span class="line"><span class="string">    &lt;/shampoo&gt;</span></span><br><span class="line"><span class="string">    &quot;&quot;&quot;</span></span><br><span class="line">    <span class="keyword">return</span> Response(content=data, media_type=<span class="string">&quot;application/xml&quot;</span>)  <span class="comment"># 返回原始的xml类型</span></span><br></pre></td></tr></table></figure></p>
<p>3.路径函数中声明临时响应，可以根据条件改变响应的status_code、headers、cookies等：<br />
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> fastapi <span class="keyword">import</span> FastAPI, Response, status</span><br><span class="line"></span><br><span class="line">app = FastAPI()</span><br><span class="line"></span><br><span class="line">tasks = &#123;<span class="string">&quot;foo&quot;</span>: <span class="string">&quot;Listen to the Bar Fighters&quot;</span>&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">@app.put(<span class="params"><span class="string">&quot;/get-or-create-task/&#123;task_id&#125;&quot;</span>, status_code=<span class="number">200</span></span>)</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">get_or_create_task</span>(<span class="params">task_id: <span class="built_in">str</span>, response: Response</span>): <span class="comment"># 临时响应</span></span><br><span class="line">    <span class="keyword">if</span> task_id <span class="keyword">not</span> <span class="keyword">in</span> tasks:</span><br><span class="line">        tasks[task_id] = <span class="string">&quot;This didn&#x27;t exist before&quot;</span></span><br><span class="line">        response.status_code = status.HTTP_201_CREATED</span><br><span class="line">        response.headers[<span class="string">&quot;X-Cat-Dog&quot;</span>] = <span class="string">&quot;alone in the world&quot;</span>  <span class="comment"># 响应中添加header</span></span><br><span class="line">        response.set_cookie(key=<span class="string">&quot;fakesession&quot;</span>, value=<span class="string">&quot;fake-cookie-session-value&quot;</span>) <span class="comment"># 在响应中添加cookie</span></span><br><span class="line">    <span class="keyword">return</span> tasks[task_id]</span><br></pre></td></tr></table></figure></p>
<p>3.其他JSON响应：<br />
JSONResponse：性能上一般，但支持全部Python的类型。<br />
ORJSONResponse：使用orjon，在性能上强于JSONResponse，但不支持一些Python的类型，如Decimal
和 UUID。<br />
UJSONResponse：使用ujosn，同ORJSONResponse。<br />
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> fastapi <span class="keyword">import</span> FastAPI</span><br><span class="line"><span class="keyword">from</span> fastapi.responses <span class="keyword">import</span> ORJSONResponse</span><br><span class="line"></span><br><span class="line">app = FastAPI()</span><br><span class="line"></span><br><span class="line"><span class="comment"># 参数 response_class 也会用来定义响应的「媒体类型」</span></span><br><span class="line"><span class="comment"># 指定了返回类型，HTTP 响应头的 Content-Type 会被设置成 application/json</span></span><br><span class="line"><span class="meta">@app.get(<span class="params"><span class="string">&quot;/items/&quot;</span>, response_class=ORJSONResponse</span>)</span></span><br><span class="line"><span class="keyword">async</span> <span class="keyword">def</span> <span class="title function_">read_items</span>():</span><br><span class="line">    <span class="keyword">return</span> ORJSONResponse([&#123;<span class="string">&quot;item_id&quot;</span>: <span class="string">&quot;Foo&quot;</span>&#125;])</span><br></pre></td></tr></table></figure></p>
<p>4.HTML响应：<br />
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> fastapi <span class="keyword">import</span> FastAPI</span><br><span class="line"><span class="keyword">from</span> fastapi.responses <span class="keyword">import</span> HTMLResponse</span><br><span class="line"></span><br><span class="line">app = FastAPI()</span><br><span class="line"></span><br><span class="line"><span class="comment"># 指定了返回类型，HTTP 响应头的 Content-Type 会被设置成 text/html</span></span><br><span class="line"><span class="meta">@app.get(<span class="params"><span class="string">&quot;/items/&quot;</span>, response_class=HTMLResponse</span>)</span></span><br><span class="line"><span class="keyword">async</span> <span class="keyword">def</span> <span class="title function_">read_items</span>():</span><br><span class="line">    <span class="keyword">return</span> <span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">    &lt;html&gt;</span></span><br><span class="line"><span class="string">        &lt;head&gt;</span></span><br><span class="line"><span class="string">            &lt;title&gt;Some HTML in here&lt;/title&gt;</span></span><br><span class="line"><span class="string">        &lt;/head&gt;</span></span><br><span class="line"><span class="string">        &lt;body&gt;</span></span><br><span class="line"><span class="string">            &lt;h1&gt;Look ma! HTML!&lt;/h1&gt;</span></span><br><span class="line"><span class="string">        &lt;/body&gt;</span></span><br><span class="line"><span class="string">    &lt;/html&gt;</span></span><br><span class="line"><span class="string">    &quot;&quot;&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 或者如下方式，但没有response_class，自动文档中就不会记录返回的Response</span></span><br><span class="line"><span class="meta">@app.get(<span class="params"><span class="string">&quot;/items/&quot;</span></span>)</span></span><br><span class="line"><span class="keyword">async</span> <span class="keyword">def</span> <span class="title function_">read_items</span>():</span><br><span class="line">    html_content = <span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">    &lt;html&gt;</span></span><br><span class="line"><span class="string">        &lt;head&gt;</span></span><br><span class="line"><span class="string">            &lt;title&gt;Some HTML in here&lt;/title&gt;</span></span><br><span class="line"><span class="string">        &lt;/head&gt;</span></span><br><span class="line"><span class="string">        &lt;body&gt;</span></span><br><span class="line"><span class="string">            &lt;h1&gt;Look ma! HTML!&lt;/h1&gt;</span></span><br><span class="line"><span class="string">        &lt;/body&gt;</span></span><br><span class="line"><span class="string">    &lt;/html&gt;</span></span><br><span class="line"><span class="string">    &quot;&quot;&quot;</span></span><br><span class="line">    <span class="keyword">return</span> HTMLResponse(content=html_content, status_code=<span class="number">200</span>)</span><br></pre></td></tr></table></figure></p>
<p>5.纯文本响应：<br />
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> fastapi <span class="keyword">import</span> FastAPI</span><br><span class="line"><span class="keyword">from</span> fastapi.responses <span class="keyword">import</span> PlainTextResponse</span><br><span class="line"></span><br><span class="line">app = FastAPI()</span><br><span class="line"></span><br><span class="line"><span class="comment"># 指定了返回类型，HTTP 响应头的 Content-Type 会被设置成 text/html</span></span><br><span class="line"><span class="meta">@app.get(<span class="params"><span class="string">&quot;/&quot;</span>, response_class=PlainTextResponse</span>)</span></span><br><span class="line"><span class="keyword">async</span> <span class="keyword">def</span> <span class="title function_">main</span>():</span><br><span class="line">    <span class="keyword">return</span> <span class="string">&quot;Hello World&quot;</span></span><br></pre></td></tr></table></figure></p>
<p>6.重定向响应：<br />
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> fastapi <span class="keyword">import</span> FastAPI</span><br><span class="line"><span class="keyword">from</span> fastapi.responses <span class="keyword">import</span> RedirectResponse</span><br><span class="line"></span><br><span class="line">app = FastAPI()</span><br><span class="line"></span><br><span class="line"><span class="comment"># 默认使用 307 状态代码（临时重定向）</span></span><br><span class="line"><span class="meta">@app.get(<span class="params"><span class="string">&quot;/typer&quot;</span></span>)</span></span><br><span class="line"><span class="keyword">async</span> <span class="keyword">def</span> <span class="title function_">redirect_typer</span>():</span><br><span class="line">    <span class="keyword">return</span> RedirectResponse(<span class="string">&quot;https://typer.tiangolo.com&quot;</span>)</span><br></pre></td></tr></table></figure></p>
<p>7.流式传输响应：<br />
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> fastapi <span class="keyword">import</span> FastAPI</span><br><span class="line"><span class="keyword">from</span> fastapi.responses <span class="keyword">import</span> StreamingResponse</span><br><span class="line"></span><br><span class="line">app = FastAPI()</span><br><span class="line"></span><br><span class="line"><span class="comment"># 异步/同步生成器都可以</span></span><br><span class="line"><span class="keyword">async</span> <span class="keyword">def</span> <span class="title function_">fake_video_streamer</span>():</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">10</span>):</span><br><span class="line">        <span class="keyword">yield</span> <span class="string">b&quot;some fake video bytes&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="meta">@app.get(<span class="params"><span class="string">&quot;/&quot;</span></span>)</span></span><br><span class="line"><span class="keyword">async</span> <span class="keyword">def</span> <span class="title function_">main</span>():</span><br><span class="line">    <span class="comment"># 使用流式响应，传输响应主体</span></span><br><span class="line">    <span class="keyword">return</span> StreamingResponse(fake_video_streamer())</span><br><span class="line"></span><br><span class="line">some_file_path = <span class="string">&quot;large-video-file.mp4&quot;</span></span><br><span class="line"><span class="meta">@app.get(<span class="params"><span class="string">&quot;/video&quot;</span></span>)</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">main</span>():</span><br><span class="line">    <span class="comment"># 返回由open函数打开的对象，可以是文件、语音、视频</span></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">iterfile</span>():  </span><br><span class="line">        <span class="keyword">with</span> <span class="built_in">open</span>(some_file_path, mode=<span class="string">&quot;rb&quot;</span>) <span class="keyword">as</span> file_like: </span><br><span class="line">            <span class="comment"># file_like本身是一个生成器，所以用yield from</span></span><br><span class="line">            <span class="keyword">yield</span> <span class="keyword">from</span> file_like  </span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> StreamingResponse(iterfile(), media_type=<span class="string">&quot;video/mp4&quot;</span>)</span><br></pre></td></tr></table></figure></p>
<p>8.异步文件响应：<br />
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> fastapi <span class="keyword">import</span> FastAPI</span><br><span class="line"><span class="keyword">from</span> fastapi.responses <span class="keyword">import</span> FileResponse</span><br><span class="line"></span><br><span class="line">some_file_path = <span class="string">&quot;large-video-file.mp4&quot;</span></span><br><span class="line">app = FastAPI()</span><br><span class="line"></span><br><span class="line"><span class="meta">@app.get(<span class="params"><span class="string">&quot;/&quot;</span></span>)</span></span><br><span class="line"><span class="keyword">async</span> <span class="keyword">def</span> <span class="title function_">main</span>():</span><br><span class="line">    <span class="comment"># 异步传输文件作为响应</span></span><br><span class="line">    <span class="comment"># path: 要流式传输的文件的文件路径。</span></span><br><span class="line">    <span class="comment"># headers: 任何自定义响应头，传入字典类型。</span></span><br><span class="line">    <span class="comment"># media_type: 给出媒体类型的字符串。如果未设置，则文件名或路径将用于推断媒体类型。</span></span><br><span class="line">    <span class="comment"># filename：如果给出，它将包含在响应的 Content-Disposition 中。</span></span><br><span class="line">    <span class="keyword">return</span> FileResponse(some_file_path)</span><br></pre></td></tr></table></figure></p>
<h1 id="响应模型">响应模型</h1>
<p>FastAPI 允许声明响应的模型，并自动序列化它们。<br />
可以返回dict、list结构，也可以str、int一样的单个值，还可以返回 Pydantic
模型。</p>
<p>1.可以在路由中使用<code>response_model</code>参数来声明用于响应的模型：<br />
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> typing <span class="keyword">import</span> <span class="type">Any</span></span><br><span class="line"><span class="keyword">from</span> fastapi <span class="keyword">import</span> FastAPI</span><br><span class="line"><span class="keyword">from</span> pydantic <span class="keyword">import</span> BaseModel</span><br><span class="line"></span><br><span class="line">app = FastAPI()</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Item</span>(<span class="title class_ inherited__">BaseModel</span>):</span><br><span class="line">    name: <span class="built_in">str</span></span><br><span class="line">    description: <span class="built_in">str</span> | <span class="literal">None</span> = <span class="literal">None</span></span><br><span class="line">    price: <span class="built_in">float</span></span><br><span class="line">    tax: <span class="built_in">float</span> | <span class="literal">None</span> = <span class="literal">None</span></span><br><span class="line">    tags: <span class="built_in">list</span>[<span class="built_in">str</span>] = []</span><br><span class="line"></span><br><span class="line"><span class="comment"># response_model指定返回模型为Item</span></span><br><span class="line"><span class="meta">@app.post(<span class="params"><span class="string">&quot;/items/&quot;</span>, response_model=Item</span>)</span></span><br><span class="line"><span class="comment"># 返回模型慎用 &quot;-&gt; Item&quot;，防止其他使用该模型的也接收到该模型</span></span><br><span class="line"><span class="keyword">async</span> <span class="keyword">def</span> <span class="title function_">create_item</span>(<span class="params">item: Item</span>) -&gt; <span class="type">Any</span>: </span><br><span class="line">    <span class="keyword">return</span> item</span><br><span class="line"></span><br><span class="line"><span class="comment"># response_model指定返回模型为Dict[str, float]</span></span><br><span class="line"><span class="meta">@app.post(<span class="params"><span class="string">&quot;/items/dict&quot;</span>, response_model=<span class="type">Dict</span>[<span class="built_in">str</span>, <span class="built_in">float</span>]</span>)</span></span><br><span class="line"><span class="keyword">async</span> <span class="keyword">def</span> <span class="title function_">create_item</span>(<span class="params">item: Item</span>) -&gt; <span class="type">Any</span>: </span><br><span class="line">    <span class="keyword">return</span> &#123;<span class="string">&quot;price&quot;</span>: item.price&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment"># response_model指定返回模型为list[Item]</span></span><br><span class="line"><span class="meta">@app.get(<span class="params"><span class="string">&quot;/items/&quot;</span>, response_model=<span class="built_in">list</span>[Item]</span>)</span></span><br><span class="line"><span class="keyword">async</span> <span class="keyword">def</span> <span class="title function_">read_items</span>() -&gt; <span class="type">Any</span>: </span><br><span class="line">    <span class="keyword">return</span> [</span><br><span class="line">        &#123;<span class="string">&quot;name&quot;</span>: <span class="string">&quot;Portal Gun&quot;</span>, <span class="string">&quot;price&quot;</span>: <span class="number">42.0</span>&#125;,</span><br><span class="line">        &#123;<span class="string">&quot;name&quot;</span>: <span class="string">&quot;Plumbus&quot;</span>, <span class="string">&quot;price&quot;</span>: <span class="number">32.0</span>&#125;,</span><br><span class="line">    ]</span><br><span class="line"></span><br><span class="line"><span class="comment"># /items/返回响应结果，是指定的list[Item]模型：</span></span><br><span class="line">[</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="string">&quot;name&quot;</span>: <span class="string">&quot;Portal Gun&quot;</span>,</span><br><span class="line">        <span class="string">&quot;description&quot;</span>: null,</span><br><span class="line">        <span class="string">&quot;price&quot;</span>: <span class="number">42.0</span>,</span><br><span class="line">        <span class="string">&quot;tax&quot;</span>: null,</span><br><span class="line">        <span class="string">&quot;tags&quot;</span>: []</span><br><span class="line">    &#125;,</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="string">&quot;name&quot;</span>: <span class="string">&quot;Plumbus&quot;</span>,</span><br><span class="line">        <span class="string">&quot;description&quot;</span>: null,</span><br><span class="line">        <span class="string">&quot;price&quot;</span>: <span class="number">32.0</span>,</span><br><span class="line">        <span class="string">&quot;tax&quot;</span>: null,</span><br><span class="line">        <span class="string">&quot;tags&quot;</span>: []</span><br><span class="line">    &#125;</span><br><span class="line">]</span><br></pre></td></tr></table></figure></p>
<p>2.响应模型的默认值及配置：<br />
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> typing <span class="keyword">import</span> <span class="type">List</span>, <span class="type">Union</span></span><br><span class="line"><span class="keyword">from</span> fastapi <span class="keyword">import</span> FastAPI</span><br><span class="line"><span class="keyword">from</span> pydantic <span class="keyword">import</span> BaseModel</span><br><span class="line"></span><br><span class="line">app = FastAPI()</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Item</span>(<span class="title class_ inherited__">BaseModel</span>):</span><br><span class="line">    name: <span class="built_in">str</span></span><br><span class="line">    description: <span class="type">Union</span>[<span class="built_in">str</span>, <span class="literal">None</span>] = <span class="literal">None</span>  <span class="comment"># 默认值None</span></span><br><span class="line">    price: <span class="built_in">float</span></span><br><span class="line">    tax: <span class="built_in">float</span> = <span class="number">10.5</span> <span class="comment"># 默认值10.5</span></span><br><span class="line">    tags: <span class="type">List</span>[<span class="built_in">str</span>] = []</span><br><span class="line"></span><br><span class="line">items = &#123;</span><br><span class="line">    <span class="string">&quot;foo&quot;</span>: &#123;<span class="string">&quot;name&quot;</span>: <span class="string">&quot;Foo&quot;</span>, <span class="string">&quot;price&quot;</span>: <span class="number">50.2</span>&#125;,</span><br><span class="line">    <span class="string">&quot;bar&quot;</span>: &#123;<span class="string">&quot;name&quot;</span>: <span class="string">&quot;Bar&quot;</span>, <span class="string">&quot;description&quot;</span>: <span class="string">&quot;The bartenders&quot;</span>, <span class="string">&quot;price&quot;</span>: <span class="number">62</span>, <span class="string">&quot;tax&quot;</span>: <span class="number">20.2</span>&#125;,</span><br><span class="line">    <span class="string">&quot;baz&quot;</span>: &#123;<span class="string">&quot;name&quot;</span>: <span class="string">&quot;Baz&quot;</span>, <span class="string">&quot;description&quot;</span>: <span class="literal">None</span>, <span class="string">&quot;price&quot;</span>: <span class="number">50.2</span>, <span class="string">&quot;tax&quot;</span>: <span class="number">10.5</span>, <span class="string">&quot;tags&quot;</span>: []&#125;,</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">#  response_model_exclude_unset=True，表示只返回主动设置的字段，如果字段未主动设置且是默认值的，则不返回</span></span><br><span class="line"><span class="comment">#  response_model_exclude_none=True，表示只返回非None的值</span></span><br><span class="line"><span class="meta">@app.get(<span class="params"><span class="string">&quot;/items/&#123;item_id&#125;&quot;</span>, response_model=Item, </span>)</span></span><br><span class="line"><span class="keyword">async</span> <span class="keyword">def</span> <span class="title function_">read_item</span>(<span class="params">item_id: <span class="built_in">str</span></span>):</span><br><span class="line">    <span class="keyword">return</span> items[item_id]</span><br></pre></td></tr></table></figure></p>
<p>3.响应模型的包含、排除：<br />
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> typing <span class="keyword">import</span> <span class="type">Union</span></span><br><span class="line"><span class="keyword">from</span> fastapi <span class="keyword">import</span> FastAPI</span><br><span class="line"><span class="keyword">from</span> pydantic <span class="keyword">import</span> BaseModel</span><br><span class="line"></span><br><span class="line">app = FastAPI()</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Item</span>(<span class="title class_ inherited__">BaseModel</span>):</span><br><span class="line">    name: <span class="built_in">str</span></span><br><span class="line">    description: <span class="type">Union</span>[<span class="built_in">str</span>, <span class="literal">None</span>] = <span class="literal">None</span></span><br><span class="line">    price: <span class="built_in">float</span></span><br><span class="line">    tax: <span class="built_in">float</span> = <span class="number">10.5</span></span><br><span class="line"></span><br><span class="line">items = &#123;</span><br><span class="line">    <span class="string">&quot;foo&quot;</span>: &#123;<span class="string">&quot;name&quot;</span>: <span class="string">&quot;Foo&quot;</span>, <span class="string">&quot;price&quot;</span>: <span class="number">50.2</span>&#125;,</span><br><span class="line">    <span class="string">&quot;bar&quot;</span>: &#123;<span class="string">&quot;name&quot;</span>: <span class="string">&quot;Bar&quot;</span>, <span class="string">&quot;description&quot;</span>: <span class="string">&quot;The Bar fighters&quot;</span>, <span class="string">&quot;price&quot;</span>: <span class="number">62</span>, <span class="string">&quot;tax&quot;</span>: <span class="number">20.2</span>&#125;,</span><br><span class="line">    <span class="string">&quot;baw&quot;</span>: &#123;<span class="string">&quot;name&quot;</span>: <span class="string">&quot;Baz&quot;</span>, <span class="string">&quot;description&quot;</span>: <span class="literal">None</span>, <span class="string">&quot;price&quot;</span>: <span class="number">50.2</span>, <span class="string">&quot;tax&quot;</span>: <span class="number">10.5</span>, <span class="string">&quot;tags&quot;</span>: []&#125;,</span><br><span class="line">    <span class="string">&quot;baz&quot;</span>: &#123;<span class="string">&quot;name&quot;</span>: <span class="string">&quot;Baz&quot;</span>, <span class="string">&quot;description&quot;</span>: <span class="string">&quot;There goes my baz&quot;</span>, <span class="string">&quot;price&quot;</span>: <span class="number">50.2</span>, <span class="string">&quot;tax&quot;</span>: <span class="number">10.5</span>&#125;,</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment"># response_model_include = &#123;key1, key2...&#125;，表示只返回指定的字段</span></span><br><span class="line"><span class="meta">@app.get(<span class="params"></span></span></span><br><span class="line"><span class="params"><span class="meta">    <span class="string">&quot;/items/&#123;item_id&#125;/name&quot;</span>,</span></span></span><br><span class="line"><span class="params"><span class="meta">    response_model=Item,</span></span></span><br><span class="line"><span class="params"><span class="meta">    response_model_include=&#123;<span class="string">&quot;name&quot;</span>, <span class="string">&quot;description&quot;</span>&#125;,</span></span></span><br><span class="line"><span class="params"><span class="meta"></span>)</span></span><br><span class="line"><span class="keyword">async</span> <span class="keyword">def</span> <span class="title function_">read_item_name</span>(<span class="params">item_id: <span class="built_in">str</span></span>):</span><br><span class="line">    <span class="keyword">return</span> items[item_id]</span><br><span class="line"></span><br><span class="line"><span class="comment"># response_model_exclude，表示排除指定的字段</span></span><br><span class="line"><span class="meta">@app.get(<span class="params"><span class="string">&quot;/items/&#123;item_id&#125;/public&quot;</span>, response_model=Item, response_model_exclude=&#123;<span class="string">&quot;tax&quot;</span>&#125;</span>)</span></span><br><span class="line"><span class="keyword">async</span> <span class="keyword">def</span> <span class="title function_">read_item_public_data</span>(<span class="params">item_id: <span class="built_in">str</span></span>):</span><br><span class="line">    <span class="keyword">return</span> items[item_id]</span><br></pre></td></tr></table></figure></p>
<p>4.输入和输出模型的使用，比如用户模型，输入模型应该含密码、输出模型不应含密码、数据库模型需要加密的密码：<br />
<div class="tabs" id="1"><ul class="nav-tabs"><li class="tab active"><a href="#1-1">BaseModel模式</a></li><li class="tab"><a href="#1-2">继承模式</a></li></ul><div class="tab-content"><div class="tab-pane active" id="1-1"><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> fastapi <span class="keyword">import</span> FastAPI</span><br><span class="line"><span class="keyword">from</span> pydantic <span class="keyword">import</span> BaseModel, EmailStr</span><br><span class="line"></span><br><span class="line">app = FastAPI()</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">UserIn</span>(<span class="title class_ inherited__">BaseModel</span>):</span><br><span class="line">    username: <span class="built_in">str</span></span><br><span class="line">    password: <span class="built_in">str</span></span><br><span class="line">    email: EmailStr</span><br><span class="line">    full_name: <span class="built_in">str</span> | <span class="literal">None</span> = <span class="literal">None</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">UserOut</span>(<span class="title class_ inherited__">BaseModel</span>):</span><br><span class="line">    username: <span class="built_in">str</span></span><br><span class="line">    email: EmailStr</span><br><span class="line">    full_name: <span class="built_in">str</span> | <span class="literal">None</span> = <span class="literal">None</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">UserInDB</span>(<span class="title class_ inherited__">BaseModel</span>):</span><br><span class="line">    username: <span class="built_in">str</span></span><br><span class="line">    hashed_password: <span class="built_in">str</span></span><br><span class="line">    email: EmailStr</span><br><span class="line">    full_name: <span class="built_in">str</span> | <span class="literal">None</span> = <span class="literal">None</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">fake_password_hasher</span>(<span class="params">raw_password: <span class="built_in">str</span></span>):</span><br><span class="line">    <span class="keyword">return</span> <span class="string">&quot;supersecret&quot;</span> + raw_password</span><br><span class="line"></span><br><span class="line"><span class="comment"># UserInDB是数据库模型，需要加密的密码</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">fake_save_user</span>(<span class="params">user_in: UserIn</span>):</span><br><span class="line">    hashed_password = fake_password_hasher(user_in.password)</span><br><span class="line">    <span class="comment"># **user_in.dict()解包，并增加新kv对</span></span><br><span class="line">    user_in_db = UserInDB(**user_in.<span class="built_in">dict</span>(), hashed_password=hashed_password)  </span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;User saved! ..not really&quot;</span>)</span><br><span class="line">    <span class="keyword">return</span> user_in_db</span><br><span class="line"></span><br><span class="line"><span class="meta">@app.post(<span class="params"><span class="string">&quot;/user/&quot;</span>, response_model=UserOut</span>) </span><span class="comment"># UserOut输出模型</span></span><br><span class="line"><span class="keyword">async</span> <span class="keyword">def</span> <span class="title function_">create_user</span>(<span class="params">user_in: UserIn</span>): <span class="comment"># UserIn输入模型</span></span><br><span class="line">    user_saved = fake_save_user(user_in)</span><br><span class="line">    <span class="keyword">return</span> user_saved</span><br></pre></td></tr></table></figure></div><div class="tab-pane" id="1-2"><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> fastapi <span class="keyword">import</span> FastAPI</span><br><span class="line"><span class="keyword">from</span> pydantic <span class="keyword">import</span> BaseModel, EmailStr</span><br><span class="line"></span><br><span class="line">app = FastAPI()</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">UserBase</span>(<span class="title class_ inherited__">BaseModel</span>):</span><br><span class="line">    username: <span class="built_in">str</span></span><br><span class="line">    email: EmailStr</span><br><span class="line">    full_name: <span class="built_in">str</span> | <span class="literal">None</span> = <span class="literal">None</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 继承UserBase，仅声明模型之间的差异部分，便于维护</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">UserIn</span>(<span class="title class_ inherited__">UserBase</span>):</span><br><span class="line">    password: <span class="built_in">str</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">UserOut</span>(<span class="title class_ inherited__">UserBase</span>):</span><br><span class="line">    <span class="keyword">pass</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">UserInDB</span>(<span class="title class_ inherited__">UserBase</span>):</span><br><span class="line">    hashed_password: <span class="built_in">str</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">fake_password_hasher</span>(<span class="params">raw_password: <span class="built_in">str</span></span>):</span><br><span class="line">    <span class="keyword">return</span> <span class="string">&quot;supersecret&quot;</span> + raw_password</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">fake_save_user</span>(<span class="params">user_in: UserIn</span>):</span><br><span class="line">    hashed_password = fake_password_hasher(user_in.password)</span><br><span class="line">    user_in_db = UserInDB(**user_in.<span class="built_in">dict</span>(), hashed_password=hashed_password)</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;User saved! ..not really&quot;</span>)</span><br><span class="line">    <span class="keyword">return</span> user_in_db</span><br><span class="line"></span><br><span class="line"><span class="meta">@app.post(<span class="params"><span class="string">&quot;/user/&quot;</span>, response_model=UserOut</span>)</span></span><br><span class="line"><span class="keyword">async</span> <span class="keyword">def</span> <span class="title function_">create_user</span>(<span class="params">user_in: UserIn</span>):</span><br><span class="line">    user_saved = fake_save_user(user_in)</span><br><span class="line">    <span class="keyword">return</span> user_saved</span><br></pre></td></tr></table></figure></div></div></div></p>
<p>5.响应模型也可以指定多个模型：<br />
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> typing <span class="keyword">import</span> <span class="type">Union</span></span><br><span class="line"><span class="keyword">from</span> fastapi <span class="keyword">import</span> FastAPI</span><br><span class="line"><span class="keyword">from</span> pydantic <span class="keyword">import</span> BaseModel</span><br><span class="line"></span><br><span class="line">app = FastAPI()</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">BaseItem</span>(<span class="title class_ inherited__">BaseModel</span>):</span><br><span class="line">    description: <span class="built_in">str</span></span><br><span class="line">    <span class="built_in">type</span>: <span class="built_in">str</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">CarItem</span>(<span class="title class_ inherited__">BaseItem</span>):</span><br><span class="line">    <span class="built_in">type</span>: <span class="built_in">str</span> = <span class="string">&quot;car&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">PlaneItem</span>(<span class="title class_ inherited__">BaseItem</span>):</span><br><span class="line">    <span class="built_in">type</span>: <span class="built_in">str</span> = <span class="string">&quot;plane&quot;</span></span><br><span class="line">    size: <span class="built_in">int</span></span><br><span class="line"></span><br><span class="line">items = &#123;</span><br><span class="line">    <span class="string">&quot;item1&quot;</span>: &#123;<span class="string">&quot;description&quot;</span>: <span class="string">&quot;All my friends drive a low rider&quot;</span>, <span class="string">&quot;type&quot;</span>: <span class="string">&quot;car&quot;</span>&#125;,</span><br><span class="line">    <span class="string">&quot;item2&quot;</span>: &#123;</span><br><span class="line">        <span class="string">&quot;description&quot;</span>: <span class="string">&quot;Music is my aeroplane, it&#x27;s my aeroplane&quot;</span>,</span><br><span class="line">        <span class="string">&quot;type&quot;</span>: <span class="string">&quot;plane&quot;</span>,</span><br><span class="line">        <span class="string">&quot;size&quot;</span>: <span class="number">5</span>,</span><br><span class="line">    &#125;,</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment"># Union也可指定响应可以是多个模型，Union[PlaneItem, CarItem]</span></span><br><span class="line"><span class="meta">@app.get(<span class="params"><span class="string">&quot;/items/&#123;item_id&#125;&quot;</span>, response_model=PlaneItem | CarItem</span>)</span></span><br><span class="line"><span class="keyword">async</span> <span class="keyword">def</span> <span class="title function_">read_item</span>(<span class="params">item_id: <span class="built_in">str</span></span>):</span><br><span class="line">    <span class="keyword">return</span> items[item_id]</span><br></pre></td></tr></table></figure></p>
<h1 id="异常处理">异常处理</h1>
<p>1.向客户端返回 HTTP 错误响应，可以使用 HTTPException：<br />
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> fastapi <span class="keyword">import</span> FastAPI, HTTPException</span><br><span class="line"></span><br><span class="line">app = FastAPI()</span><br><span class="line"></span><br><span class="line">items = &#123;<span class="string">&quot;foo&quot;</span>: <span class="string">&quot;The Foo Wrestlers&quot;</span>&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">@app.get(<span class="params"><span class="string">&quot;/items/&#123;item_id&#125;&quot;</span></span>)</span></span><br><span class="line"><span class="keyword">async</span> <span class="keyword">def</span> <span class="title function_">read_item</span>(<span class="params">item_id: <span class="built_in">str</span></span>):</span><br><span class="line">    <span class="keyword">if</span> item_id <span class="keyword">not</span> <span class="keyword">in</span> items:</span><br><span class="line">        <span class="comment"># 客户端用 ID 请求的 item 不存在时，触发状态码为 404 的异常</span></span><br><span class="line">        <span class="comment"># 使用raise抛出异常，并指定HTTP状态码</span></span><br><span class="line">        <span class="comment"># 触发 HTTPException 时，可以用参数 detail 传递任何能转换为 JSON 的值，不仅限于 str。还支持传递 dict、list 等数据结构。</span></span><br><span class="line">        <span class="keyword">raise</span> HTTPException(status_code=<span class="number">404</span>, detail=<span class="string">&quot;Item not found&quot;</span>)</span><br><span class="line">    <span class="keyword">return</span> &#123;<span class="string">&quot;item&quot;</span>: items[item_id]&#125;</span><br></pre></td></tr></table></figure></p>
<p>2.可以为 HTTP 错误添加自定义响应头：<br />
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> fastapi <span class="keyword">import</span> FastAPI, HTTPException</span><br><span class="line"></span><br><span class="line">app = FastAPI()</span><br><span class="line"></span><br><span class="line">items = &#123;<span class="string">&quot;foo&quot;</span>: <span class="string">&quot;The Foo Wrestlers&quot;</span>&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">@app.get(<span class="params"><span class="string">&quot;/items-header/&#123;item_id&#125;&quot;</span></span>)</span></span><br><span class="line"><span class="keyword">async</span> <span class="keyword">def</span> <span class="title function_">read_item_header</span>(<span class="params">item_id: <span class="built_in">str</span></span>):</span><br><span class="line">    <span class="keyword">if</span> item_id <span class="keyword">not</span> <span class="keyword">in</span> items:</span><br><span class="line">        <span class="keyword">raise</span> HTTPException(</span><br><span class="line">            status_code=<span class="number">404</span>,</span><br><span class="line">            detail=<span class="string">&quot;Item not found&quot;</span>,</span><br><span class="line">            headers=&#123;<span class="string">&quot;X-Error&quot;</span>: <span class="string">&quot;There goes my error&quot;</span>&#125;, <span class="comment"># 自定义响应头</span></span><br><span class="line">        )</span><br><span class="line">    <span class="keyword">return</span> &#123;<span class="string">&quot;item&quot;</span>: items[item_id]&#125;</span><br></pre></td></tr></table></figure></p>
<p>3.自定义异常处理器：<br />
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># starlette也可以用于导入 Request 和 JSONResponse。</span></span><br><span class="line"><span class="comment"># from starlette.requests import Request </span></span><br><span class="line"><span class="comment"># from starlette.responses import JSONResponse </span></span><br><span class="line"><span class="keyword">from</span> fastapi <span class="keyword">import</span> FastAPI, Request</span><br><span class="line"><span class="keyword">from</span> fastapi.responses <span class="keyword">import</span> JSONResponse</span><br><span class="line"></span><br><span class="line"><span class="comment"># 自定义异常处理器，需要继承Exception类</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">UnicornException</span>(<span class="title class_ inherited__">Exception</span>):</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__init__</span>(<span class="params">self, name: <span class="built_in">str</span></span>):</span><br><span class="line">        self.name = name</span><br><span class="line"></span><br><span class="line">app = FastAPI()</span><br><span class="line"></span><br><span class="line"><span class="comment"># 使用 @app.exception_handler() 添加自定义异常控制器，并指定要处理的异常类</span></span><br><span class="line"><span class="meta">@app.exception_handler(<span class="params">UnicornException</span>)</span></span><br><span class="line"><span class="keyword">async</span> <span class="keyword">def</span> <span class="title function_">unicorn_exception_handler</span>(<span class="params">request: Request, exc: UnicornException</span>):</span><br><span class="line">    <span class="comment"># 接收到的错误信息清晰明了，HTTP 状态码为 418，JSON 内容如content：</span></span><br><span class="line">    <span class="keyword">return</span> JSONResponse(</span><br><span class="line">        status_code=<span class="number">418</span>,</span><br><span class="line">        content=&#123;<span class="string">&quot;message&quot;</span>: <span class="string">f&quot;Oops! <span class="subst">&#123;exc.name&#125;</span> did something. There goes a rainbow...&quot;</span>&#125;,</span><br><span class="line">    )</span><br><span class="line"></span><br><span class="line"><span class="meta">@app.get(<span class="params"><span class="string">&quot;/unicorns/&#123;name&#125;&quot;</span></span>)</span></span><br><span class="line"><span class="keyword">async</span> <span class="keyword">def</span> <span class="title function_">read_unicorn</span>(<span class="params">name: <span class="built_in">str</span></span>):</span><br><span class="line">    <span class="keyword">if</span> name == <span class="string">&quot;yolo&quot;</span>:</span><br><span class="line">        <span class="comment"># 请求 /unicorns/yolo 时，路径操作会触发 UnicornException。</span></span><br><span class="line">        <span class="comment"># 但该异常将会被 unicorn_exception_handler 处理。</span></span><br><span class="line">        <span class="keyword">raise</span> UnicornException(name=name)</span><br><span class="line">    <span class="keyword">return</span> &#123;<span class="string">&quot;unicorn_name&quot;</span>: name&#125;</span><br></pre></td></tr></table></figure></p>
<p>4.覆盖默认的异常，FastAPI
自带了一些默认异常处理器，以使用自定义处理器覆盖默认异常处理器：<br />
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> fastapi <span class="keyword">import</span> FastAPI, HTTPException  <span class="comment"># HTTPException继承自StarletteHTTPException</span></span><br><span class="line"><span class="keyword">from</span> fastapi.exceptions <span class="keyword">import</span> RequestValidationError  </span><br><span class="line"><span class="keyword">from</span> fastapi.responses <span class="keyword">import</span> PlainTextResponse</span><br><span class="line"><span class="keyword">from</span> starlette.exceptions <span class="keyword">import</span> HTTPException <span class="keyword">as</span> StarletteHTTPException </span><br><span class="line"></span><br><span class="line">app = FastAPI()</span><br><span class="line"></span><br><span class="line"><span class="comment"># 覆盖默认异常处理器StarletteHTTPException（覆盖Starlette 的 HTTPException）</span></span><br><span class="line"><span class="meta">@app.exception_handler(<span class="params">StarletteHTTPException</span>)</span></span><br><span class="line"><span class="keyword">async</span> <span class="keyword">def</span> <span class="title function_">http_exception_handler</span>(<span class="params">request, exc</span>):</span><br><span class="line">    <span class="keyword">return</span> PlainTextResponse(<span class="built_in">str</span>(exc.detail), status_code=exc.status_code)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 覆盖默认异常处理器RequestValidationError，请求中包含无效数据时触发</span></span><br><span class="line"><span class="meta">@app.exception_handler(<span class="params">RequestValidationError</span>)</span></span><br><span class="line"><span class="keyword">async</span> <span class="keyword">def</span> <span class="title function_">validation_exception_handler</span>(<span class="params">request, exc</span>):</span><br><span class="line">    <span class="keyword">return</span> PlainTextResponse(<span class="built_in">str</span>(exc), status_code=<span class="number">400</span>) <span class="comment"># 把默认的异常json，转为text格式</span></span><br><span class="line">    <span class="comment"># RequestValidationError 包含其接收到的无效数据请求的 body，开发时，可以用这个请求体生成日志、调试错误，并返回给用户。</span></span><br><span class="line">    <span class="comment"># return JSONResponse(</span></span><br><span class="line">    <span class="comment">#     status_code=status.HTTP_422_UNPROCESSABLE_ENTITY,</span></span><br><span class="line">    <span class="comment">#     content=jsonable_encoder(&#123;&quot;detail&quot;: exc.errors(), &quot;body&quot;: exc.body&#125;),</span></span><br><span class="line">    <span class="comment"># )</span></span><br><span class="line"></span><br><span class="line"><span class="meta">@app.get(<span class="params"><span class="string">&quot;/items/&#123;item_id&#125;&quot;</span></span>)</span></span><br><span class="line"><span class="keyword">async</span> <span class="keyword">def</span> <span class="title function_">read_item</span>(<span class="params">item_id: <span class="built_in">int</span></span>):</span><br><span class="line">    <span class="keyword">if</span> item_id == <span class="number">3</span>:</span><br><span class="line">        <span class="comment"># 触发http_exception_handler</span></span><br><span class="line">        <span class="keyword">raise</span> HTTPException(status_code=<span class="number">418</span>, detail=<span class="string">&quot;Nope! I don&#x27;t like 3.&quot;</span>) </span><br><span class="line">    <span class="keyword">return</span> &#123;<span class="string">&quot;item_id&quot;</span>: item_id&#125;</span><br></pre></td></tr></table></figure></p>
<p>5.先对异常进行某些处理，再使用默认异常处理器：<br />
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> fastapi <span class="keyword">import</span> FastAPI, HTTPException</span><br><span class="line"><span class="keyword">from</span> fastapi.exception_handlers <span class="keyword">import</span> http_exception_handler, request_validation_exception_handler</span><br><span class="line"><span class="keyword">from</span> fastapi.exceptions <span class="keyword">import</span> RequestValidationError</span><br><span class="line"><span class="keyword">from</span> starlette.exceptions <span class="keyword">import</span> HTTPException <span class="keyword">as</span> StarletteHTTPException</span><br><span class="line"></span><br><span class="line">app = FastAPI()</span><br><span class="line"></span><br><span class="line"><span class="meta">@app.exception_handler(<span class="params">StarletteHTTPException</span>)</span></span><br><span class="line"><span class="keyword">async</span> <span class="keyword">def</span> <span class="title function_">custom_http_exception_handler</span>(<span class="params">request, exc</span>):</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">f&quot;OMG! An HTTP error!: <span class="subst">&#123;<span class="built_in">repr</span>(exc)&#125;</span>&quot;</span>)  <span class="comment"># 先对异常处理</span></span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">await</span> http_exception_handler(request, exc)  <span class="comment"># 再使用默认异常处理器</span></span><br><span class="line"></span><br><span class="line"><span class="meta">@app.exception_handler(<span class="params">RequestValidationError</span>)</span></span><br><span class="line"><span class="keyword">async</span> <span class="keyword">def</span> <span class="title function_">validation_exception_handler</span>(<span class="params">request, exc</span>):</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">f&quot;OMG! The client sent invalid data!: <span class="subst">&#123;exc&#125;</span>&quot;</span>)  <span class="comment"># 先对异常处理</span></span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">await</span> request_validation_exception_handler(request, exc) <span class="comment"># 再使用默认异常处理器</span></span><br><span class="line"> </span><br><span class="line"><span class="meta">@app.get(<span class="params"><span class="string">&quot;/items/&#123;item_id&#125;&quot;</span></span>)</span></span><br><span class="line"><span class="keyword">async</span> <span class="keyword">def</span> <span class="title function_">read_item</span>(<span class="params">item_id: <span class="built_in">int</span></span>):</span><br><span class="line">    <span class="keyword">if</span> item_id == <span class="number">3</span>:</span><br><span class="line">        <span class="keyword">raise</span> HTTPException(status_code=<span class="number">418</span>, detail=<span class="string">&quot;Nope! I don&#x27;t like 3.&quot;</span>)</span><br><span class="line">    <span class="keyword">return</span> &#123;<span class="string">&quot;item_id&quot;</span>: item_id&#125;</span><br></pre></td></tr></table></figure></p>
<h1 id="表单参数">表单参数</h1>
<p>接收的不是 JSON，而是表单字段时，要使用 Form
(Form是继承自Body类)。<br />
要使用表单，需预先安装 <code>pip install python-multipart</code>。</p>
<p>1.表单的使用与 Body 和 Query 类似，只是需要导入 Form：<br />
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> fastapi <span class="keyword">import</span> FastAPI, Form</span><br><span class="line"></span><br><span class="line">app = FastAPI()</span><br><span class="line"></span><br><span class="line"><span class="meta">@app.post(<span class="params"><span class="string">&quot;/login/&quot;</span></span>)</span></span><br><span class="line"><span class="comment"># 一些参数必须通过Form()传递，比如OAuth2规范的&quot;密码流&quot;模式规定要通过表单字段发送username和password。</span></span><br><span class="line"><span class="comment"># 声明表单体要显式使用 Form ，否则，FastAPI 会把该参数当作&quot;查询参数&quot;或&quot;请求体&quot;参数。</span></span><br><span class="line"><span class="keyword">async</span> <span class="keyword">def</span> <span class="title function_">login</span>(<span class="params">username: <span class="built_in">str</span> = Form(<span class="params"></span>), password: <span class="built_in">str</span> = Form(<span class="params"></span>)</span>):</span><br><span class="line">    <span class="keyword">return</span> &#123;<span class="string">&quot;username&quot;</span>: username&#125;</span><br></pre></td></tr></table></figure></p>
<p>2.表单参数需Header参数<code>Content-Type</code>配合使用，其值如下：<br />
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 常用三个，Form和Body不能同时使用：</span></span><br><span class="line"><span class="comment"># Content-Type: application/x-www-form-urlencoded  # Form参数</span></span><br><span class="line"><span class="comment"># Content-Type: multipart/form-data  # # Form参数</span></span><br><span class="line"><span class="comment"># Content-Type: application/json  # Body参数</span></span><br><span class="line">text/html  ：HTML格式</span><br><span class="line">text/plain ：纯文本格式      </span><br><span class="line">text/xml   ：XML格式</span><br><span class="line">image/gif  ：gif图片格式    </span><br><span class="line">image/jpeg ：jpg图片格式 </span><br><span class="line">image/png  ：png图片格式</span><br><span class="line">application/xhtml+xml ：XHTML格式</span><br><span class="line">application/xml       ：XML数据格式</span><br><span class="line">application/atom+xml  ：Atom XML聚合格式    </span><br><span class="line">application/json      ：JSON数据格式</span><br><span class="line">application/pdf       ：pdf格式  </span><br><span class="line">application/msword    ：Word文档格式</span><br><span class="line">application/octet-stream ：二进制流数据（如常见的文件下载）</span><br><span class="line">application/x-www-form-urlencoded  : 表单数据格式</span><br><span class="line">multipart/form-data  ：需要在表单中进行文件上传时，就需要使用该格式</span><br></pre></td></tr></table></figure></p>
<p>3.Form同样支持Pydantic模型：<br />
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> fastapi <span class="keyword">import</span> FastAPI, Form</span><br><span class="line"><span class="keyword">from</span> pydantic <span class="keyword">import</span> BaseModel</span><br><span class="line"></span><br><span class="line">app = FastAPI()</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">FormData</span>(<span class="title class_ inherited__">BaseModel</span>):</span><br><span class="line">    <span class="comment"># model_config = &#123;&quot;extra&quot;: &quot;forbid&quot;&#125;</span></span><br><span class="line">    username: <span class="built_in">str</span></span><br><span class="line">    password: <span class="built_in">str</span></span><br><span class="line"></span><br><span class="line"><span class="meta">@app.post(<span class="params"><span class="string">&quot;/login/&quot;</span></span>)</span></span><br><span class="line"><span class="keyword">async</span> <span class="keyword">def</span> <span class="title function_">login</span>(<span class="params">data: FormData = Form(<span class="params"></span>)</span>):</span><br><span class="line">    <span class="keyword">return</span> data</span><br></pre></td></tr></table></figure></p>
<h1 id="文件参数">文件参数</h1>
<p>File 用于定义客户端的上传文件，是以 Form 形式发送。<br />
1.从 fastapi 导入 File 和 UploadFile，这两种方式都可以上传文件：<br />
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> fastapi <span class="keyword">import</span> FastAPI, File, UploadFile</span><br><span class="line"></span><br><span class="line">app = FastAPI()</span><br><span class="line"></span><br><span class="line"><span class="meta">@app.post(<span class="params"><span class="string">&quot;/files/&quot;</span></span>)</span></span><br><span class="line"><span class="comment"># 以 bytes 形式读取文件，并存储于内存，适用于小文件</span></span><br><span class="line"><span class="keyword">async</span> <span class="keyword">def</span> <span class="title function_">create_file</span>(<span class="params">file: <span class="built_in">bytes</span> = File(<span class="params"></span>)</span>):</span><br><span class="line">    <span class="keyword">return</span> &#123;<span class="string">&quot;file_size&quot;</span>: <span class="built_in">len</span>(file)&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">@app.post(<span class="params"><span class="string">&quot;/uploadfile/&quot;</span></span>)</span></span><br><span class="line"><span class="comment"># UploadFile 比 File 的优势：</span></span><br><span class="line"><span class="comment"># 1.使用 spooled 文件（存储在内存的文件超出最大上限时，会把文件存入磁盘）</span></span><br><span class="line"><span class="comment"># 2.这种方式更适于处理图像、视频、二进制文件等大型文件，好处是不会占用所有内存</span></span><br><span class="line"><span class="comment"># 3.可获取上传文件的元数据</span></span><br><span class="line"><span class="comment"># 4.自带 async 接口，可异步上传文件</span></span><br><span class="line"><span class="keyword">async</span> <span class="keyword">def</span> <span class="title function_">create_upload_file</span>(<span class="params">file: UploadFile</span>):</span><br><span class="line">    <span class="keyword">return</span> &#123;<span class="string">&quot;filename&quot;</span>: file.filename&#125;</span><br></pre></td></tr></table></figure></p>
<p>2.使用UploadFile的属性和方法：<br />
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">|-UploadFile属性：</span><br><span class="line">    |-filename：上传文件名字符串（<span class="built_in">str</span>），例如， myimage.jpg；</span><br><span class="line">    |-content_type：内容类型（MIME 类型 / 媒体类型）字符串（<span class="built_in">str</span>），例如，image/jpeg；</span><br><span class="line">    |-file： SpooledTemporaryFile（ file-like 对象）。其实就是 Python文件，可直接传递给其他预期 file-like 对象的函数或支持库。</span><br><span class="line">|-UploadFile的<span class="keyword">async</span>方法（需配合<span class="keyword">await</span>使用）：</span><br><span class="line">    |-write(data)：把 data （<span class="built_in">str</span> 或 <span class="built_in">bytes</span>）写入文件；</span><br><span class="line">    |-read(size)：按指定数量的字节或字符（size (<span class="built_in">int</span>)）读取文件内容；</span><br><span class="line">    |-seek(offset)：移动至文件 offset （<span class="built_in">int</span>）字节处的位置；</span><br><span class="line">        |-例如，<span class="keyword">await</span> myfile.seek(<span class="number">0</span>) 移动到文件开头；</span><br><span class="line">        |-执行 <span class="keyword">await</span> myfile.read() 后，需再次读取已读取内容时，这种方法特别好用；</span><br><span class="line">    |-close()：关闭文件。</span><br><span class="line"><span class="comment"># async 读取文件 contents = await myfile.read()</span></span><br><span class="line"><span class="comment"># 在普通 def 路径操作函数 内，则可以直接访问 UploadFile.file，无需 await。 contents = myfile.file.read()</span></span><br></pre></td></tr></table></figure></p>
<p>3.可将"文件上传"默认值设置None，表示为可选：<br />
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> fastapi <span class="keyword">import</span> FastAPI, File, UploadFile</span><br><span class="line"></span><br><span class="line">app = FastAPI()</span><br><span class="line"></span><br><span class="line"><span class="meta">@app.post(<span class="params"><span class="string">&quot;/files/&quot;</span></span>)</span></span><br><span class="line"><span class="keyword">async</span> <span class="keyword">def</span> <span class="title function_">create_file</span>(<span class="params">file: <span class="built_in">bytes</span> | <span class="literal">None</span> = File(<span class="params">default=<span class="literal">None</span></span>)</span>): <span class="comment"># 默认值None</span></span><br><span class="line">    <span class="keyword">if</span> <span class="keyword">not</span> file:</span><br><span class="line">        <span class="keyword">return</span> &#123;<span class="string">&quot;message&quot;</span>: <span class="string">&quot;No file sent&quot;</span>&#125;</span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        <span class="keyword">return</span> &#123;<span class="string">&quot;file_size&quot;</span>: <span class="built_in">len</span>(file)&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">@app.post(<span class="params"><span class="string">&quot;/uploadfile/&quot;</span></span>)</span></span><br><span class="line"><span class="keyword">async</span> <span class="keyword">def</span> <span class="title function_">create_upload_file</span>(<span class="params">file: UploadFile | <span class="literal">None</span> = <span class="literal">None</span></span>): <span class="comment"># 默认值None</span></span><br><span class="line">    <span class="keyword">if</span> <span class="keyword">not</span> file:</span><br><span class="line">        <span class="keyword">return</span> &#123;<span class="string">&quot;message&quot;</span>: <span class="string">&quot;No upload file sent&quot;</span>&#125;</span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        <span class="keyword">return</span> &#123;<span class="string">&quot;filename&quot;</span>: file.filename&#125;</span><br></pre></td></tr></table></figure></p>
<p>4.UploadFile和File一起使用，可为Swagger文档增加额外的元数据：<br />
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> fastapi <span class="keyword">import</span> FastAPI, File, UploadFile</span><br><span class="line"></span><br><span class="line">app = FastAPI()</span><br><span class="line"></span><br><span class="line"><span class="meta">@app.post(<span class="params"><span class="string">&quot;/files/&quot;</span></span>)</span></span><br><span class="line"><span class="comment"># Swagger文档增加了description</span></span><br><span class="line"><span class="keyword">async</span> <span class="keyword">def</span> <span class="title function_">create_file</span>(<span class="params">file: <span class="built_in">bytes</span> = File(<span class="params">description=<span class="string">&quot;A file read as bytes&quot;</span></span>)</span>):</span><br><span class="line">    <span class="keyword">return</span> &#123;<span class="string">&quot;file_size&quot;</span>: <span class="built_in">len</span>(file)&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">@app.post(<span class="params"><span class="string">&quot;/uploadfile/&quot;</span></span>)</span></span><br><span class="line"><span class="comment"># Swagger文档增加了description</span></span><br><span class="line"><span class="keyword">async</span> <span class="keyword">def</span> <span class="title function_">create_upload_file</span>(<span class="params">file: UploadFile = File(<span class="params">description=<span class="string">&quot;A file read as UploadFile&quot;</span></span>),</span>):</span><br><span class="line">    <span class="keyword">return</span> &#123;<span class="string">&quot;filename&quot;</span>: file.filename&#125;</span><br></pre></td></tr></table></figure></p>
<p>5.支持同时上传多个文件，同一个字段可接收多个文件，上传多个文件时，要声明含
bytes 或 UploadFile 的列表（List）：<br />
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> fastapi <span class="keyword">import</span> FastAPI, File, UploadFile</span><br><span class="line"><span class="keyword">from</span> fastapi.responses <span class="keyword">import</span> HTMLResponse</span><br><span class="line"></span><br><span class="line">app = FastAPI()</span><br><span class="line"></span><br><span class="line"><span class="meta">@app.post(<span class="params"><span class="string">&quot;/files/&quot;</span></span>)</span></span><br><span class="line"><span class="keyword">async</span> <span class="keyword">def</span> <span class="title function_">create_files</span>(<span class="params">files: <span class="built_in">list</span>[<span class="built_in">bytes</span>] = File(<span class="params"></span>)</span>):</span><br><span class="line">    <span class="keyword">return</span> &#123;<span class="string">&quot;file_sizes&quot;</span>: [<span class="built_in">len</span>(file) <span class="keyword">for</span> file <span class="keyword">in</span> files]&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">@app.post(<span class="params"><span class="string">&quot;/uploadfiles/&quot;</span></span>)</span></span><br><span class="line"><span class="keyword">async</span> <span class="keyword">def</span> <span class="title function_">create_upload_files</span>(<span class="params">files: <span class="built_in">list</span>[UploadFile]</span>):</span><br><span class="line">    <span class="keyword">return</span> &#123;<span class="string">&quot;filenames&quot;</span>: [file.filename <span class="keyword">for</span> file <span class="keyword">in</span> files]&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">@app.get(<span class="params"><span class="string">&quot;/&quot;</span></span>)</span></span><br><span class="line"><span class="keyword">async</span> <span class="keyword">def</span> <span class="title function_">main</span>():</span><br><span class="line">    content = <span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">&lt;body&gt;</span></span><br><span class="line"><span class="string">&lt;form action=&quot;/files/&quot; enctype=&quot;multipart/form-data&quot; method=&quot;post&quot;&gt;</span></span><br><span class="line"><span class="string">&lt;input name=&quot;files&quot; type=&quot;file&quot; multiple&gt;</span></span><br><span class="line"><span class="string">&lt;input type=&quot;submit&quot;&gt;</span></span><br><span class="line"><span class="string">&lt;/form&gt;</span></span><br><span class="line"><span class="string">&lt;form action=&quot;/uploadfiles/&quot; enctype=&quot;multipart/form-data&quot; method=&quot;post&quot;&gt;</span></span><br><span class="line"><span class="string">&lt;input name=&quot;files&quot; type=&quot;file&quot; multiple&gt;</span></span><br><span class="line"><span class="string">&lt;input type=&quot;submit&quot;&gt;</span></span><br><span class="line"><span class="string">&lt;/form&gt;</span></span><br><span class="line"><span class="string">&lt;/body&gt;</span></span><br><span class="line"><span class="string">    &quot;&quot;&quot;</span></span><br><span class="line">    <span class="keyword">return</span> HTMLResponse(content=content)</span><br></pre></td></tr></table></figure></p>
<h1 id="编码兼容">编码兼容</h1>
<p>在某些情况下，可能需要将数据类型（如Pydantic模型）转换为与JSON兼容的数据类型（如dict、list等）。常用于NoSQL数据库，如MongoDB，因为MongoDB只接收JSON兼容的数据类型，而不接收Python对象。<br />
1.比如，需要将请求数据存储在数据库中，数据库它不接收datetime这类的对象，因为这些对象与JSON不兼容，数据库也不会接收Pydantic模型（带有属性的对象），而只接收dict。对此可以使用<code>jsonable_encoder()</code>将数据转换为JSON兼容格式。<br />
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> datetime <span class="keyword">import</span> datetime</span><br><span class="line"><span class="keyword">from</span> fastapi <span class="keyword">import</span> FastAPI</span><br><span class="line"><span class="keyword">from</span> fastapi.encoders <span class="keyword">import</span> jsonable_encoder</span><br><span class="line"><span class="keyword">from</span> pydantic <span class="keyword">import</span> BaseModel</span><br><span class="line"></span><br><span class="line">fake_db = &#123;&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Item</span>(<span class="title class_ inherited__">BaseModel</span>):</span><br><span class="line">    title: <span class="built_in">str</span></span><br><span class="line">    timestamp: datetime</span><br><span class="line">    description: <span class="built_in">str</span> | <span class="literal">None</span> = <span class="literal">None</span></span><br><span class="line"></span><br><span class="line">app = FastAPI()</span><br><span class="line"></span><br><span class="line"><span class="meta">@app.put(<span class="params"><span class="string">&quot;/items/&#123;id&#125;&quot;</span></span>)</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">update_item</span>(<span class="params"><span class="built_in">id</span>: <span class="built_in">str</span>, item: Item</span>):</span><br><span class="line">    json_compatible_item_data = jsonable_encoder(item) <span class="comment"># 将item转换为JSON兼容格式</span></span><br><span class="line">    fake_db[<span class="built_in">id</span>] = json_compatible_item_data <span class="comment"># 直接存储于数据库中</span></span><br></pre></td></tr></table></figure></p>
<p>2.注意，在使用 PUT 更新数据库中数据时，如果设置了默认值，PUT
时未写该字段，但更新时也会把默认值也带上，从而更新该字段。可使用 PATCH
进行部分更新：<br />
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> typing <span class="keyword">import</span> <span class="type">List</span>, <span class="type">Union</span></span><br><span class="line"><span class="keyword">from</span> fastapi <span class="keyword">import</span> FastAPI</span><br><span class="line"><span class="keyword">from</span> fastapi.encoders <span class="keyword">import</span> jsonable_encoder</span><br><span class="line"><span class="keyword">from</span> pydantic <span class="keyword">import</span> BaseModel</span><br><span class="line"></span><br><span class="line">app = FastAPI()</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Item</span>(<span class="title class_ inherited__">BaseModel</span>):</span><br><span class="line">    name: <span class="type">Union</span>[<span class="built_in">str</span>, <span class="literal">None</span>] = <span class="literal">None</span></span><br><span class="line">    description: <span class="type">Union</span>[<span class="built_in">str</span>, <span class="literal">None</span>] = <span class="literal">None</span></span><br><span class="line">    price: <span class="type">Union</span>[<span class="built_in">float</span>, <span class="literal">None</span>] = <span class="literal">None</span></span><br><span class="line">    tax: <span class="built_in">float</span> = <span class="number">10.5</span></span><br><span class="line">    tags: <span class="type">List</span>[<span class="built_in">str</span>] = []</span><br><span class="line"></span><br><span class="line">items = &#123;</span><br><span class="line">    <span class="string">&quot;foo&quot;</span>: &#123;<span class="string">&quot;name&quot;</span>: <span class="string">&quot;Foo&quot;</span>, <span class="string">&quot;price&quot;</span>: <span class="number">50.2</span>&#125;,</span><br><span class="line">    <span class="string">&quot;bar&quot;</span>: &#123;<span class="string">&quot;name&quot;</span>: <span class="string">&quot;Bar&quot;</span>, <span class="string">&quot;description&quot;</span>: <span class="string">&quot;The bartenders&quot;</span>, <span class="string">&quot;price&quot;</span>: <span class="number">62</span>, <span class="string">&quot;tax&quot;</span>: <span class="number">20.2</span>&#125;,</span><br><span class="line">    <span class="string">&quot;baz&quot;</span>: &#123;<span class="string">&quot;name&quot;</span>: <span class="string">&quot;Baz&quot;</span>, <span class="string">&quot;description&quot;</span>: <span class="literal">None</span>, <span class="string">&quot;price&quot;</span>: <span class="number">50.2</span>, <span class="string">&quot;tax&quot;</span>: <span class="number">10.5</span>, <span class="string">&quot;tags&quot;</span>: []&#125;,</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">@app.get(<span class="params"><span class="string">&quot;/items/&#123;item_id&#125;&quot;</span>, response_model=Item</span>)</span></span><br><span class="line"><span class="keyword">async</span> <span class="keyword">def</span> <span class="title function_">read_item</span>(<span class="params">item_id: <span class="built_in">str</span></span>):</span><br><span class="line">    <span class="keyword">return</span> items[item_id]</span><br><span class="line"></span><br><span class="line"><span class="meta">@app.patch(<span class="params"><span class="string">&quot;/items/&#123;item_id&#125;&quot;</span>, response_model=Item</span>)</span></span><br><span class="line"><span class="keyword">async</span> <span class="keyword">def</span> <span class="title function_">update_item</span>(<span class="params">item_id: <span class="built_in">str</span>, item: Item</span>):</span><br><span class="line">    stored_item_data = items[item_id]</span><br><span class="line">    <span class="comment"># 创建原始值的model</span></span><br><span class="line">    stored_item_model = Item(**stored_item_data) </span><br><span class="line">    <span class="comment"># exclude_unset=True，表示生成的 dict 只包含创建 item 模型时显式设置的数据，而不包括默认值</span></span><br><span class="line">    update_data = item.<span class="built_in">dict</span>(exclude_unset=<span class="literal">True</span>)</span><br><span class="line">    <span class="comment"># .copy()为已有模型创建调用 update 参数的副本，设置值更新到model中</span></span><br><span class="line">    updated_item = stored_item_model.copy(update=update_data) </span><br><span class="line">    <span class="comment"># 把模型副本转换为可存入数据库的形式</span></span><br><span class="line">    items[item_id] = jsonable_encoder(updated_item)</span><br><span class="line">    <span class="keyword">return</span> updated_item</span><br></pre></td></tr></table></figure></p>
<h1 id="依赖项">依赖项</h1>
<p>依赖项是一个函数，可以复用相同得代码逻辑，常用于：共享业务逻辑、共享数据库连接、实现安全、验证、角色权限等。<br />
依赖项使用Depends注入，默认从Query参数中获取数据。<br />
1.函数形式依赖项：<br />
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> typing <span class="keyword">import</span> <span class="type">Union</span></span><br><span class="line"><span class="keyword">from</span> fastapi <span class="keyword">import</span> Depends, FastAPI</span><br><span class="line"></span><br><span class="line">app = FastAPI()</span><br><span class="line"></span><br><span class="line"><span class="comment"># 依赖项common_parameters函数，返回dict</span></span><br><span class="line"><span class="keyword">async</span> <span class="keyword">def</span> <span class="title function_">common_parameters</span>(<span class="params">q: <span class="type">Union</span>[<span class="built_in">str</span>, <span class="literal">None</span>] = <span class="literal">None</span>, skip: <span class="built_in">int</span> = <span class="number">0</span>, limit: <span class="built_in">int</span> = <span class="number">100</span></span>):</span><br><span class="line">    <span class="keyword">return</span> &#123;<span class="string">&quot;q&quot;</span>: q, <span class="string">&quot;skip&quot;</span>: skip, <span class="string">&quot;limit&quot;</span>: limit&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">@app.get(<span class="params"><span class="string">&quot;/items/&quot;</span></span>)</span></span><br><span class="line"><span class="keyword">async</span> <span class="keyword">def</span> <span class="title function_">read_items</span>(<span class="params">commons: <span class="built_in">dict</span> = Depends(<span class="params">common_parameters</span>)</span>): <span class="comment"># Depends注入依赖项</span></span><br><span class="line">    <span class="keyword">return</span> commons</span><br><span class="line"></span><br><span class="line"><span class="meta">@app.get(<span class="params"><span class="string">&quot;/users/&quot;</span></span>)</span></span><br><span class="line"><span class="keyword">async</span> <span class="keyword">def</span> <span class="title function_">read_users</span>(<span class="params">commons: <span class="built_in">dict</span> = Depends(<span class="params">common_parameters</span>)</span>):</span><br><span class="line">    <span class="keyword">return</span> commons</span><br></pre></td></tr></table></figure></p>
<p>2.类作为依赖项：<br />
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> fastapi <span class="keyword">import</span> Depends, FastAPI</span><br><span class="line"></span><br><span class="line">app = FastAPI()</span><br><span class="line"></span><br><span class="line">fake_items_db = [&#123;<span class="string">&quot;item_name&quot;</span>: <span class="string">&quot;Foo&quot;</span>&#125;, &#123;<span class="string">&quot;item_name&quot;</span>: <span class="string">&quot;Bar&quot;</span>&#125;, &#123;<span class="string">&quot;item_name&quot;</span>: <span class="string">&quot;Baz&quot;</span>&#125;]</span><br><span class="line"></span><br><span class="line"><span class="comment"># 依赖项</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">CommonQueryParams</span>:</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__init__</span>(<span class="params">self, q: <span class="built_in">str</span> | <span class="literal">None</span> = <span class="literal">None</span>, skip: <span class="built_in">int</span> = <span class="number">0</span>, limit: <span class="built_in">int</span> = <span class="number">100</span></span>):</span><br><span class="line">        self.q = q</span><br><span class="line">        self.skip = skip</span><br><span class="line">        self.limit = limit</span><br><span class="line"></span><br><span class="line"><span class="meta">@app.get(<span class="params"><span class="string">&quot;/items/&quot;</span></span>)</span></span><br><span class="line"><span class="comment"># 注入依赖项Depends</span></span><br><span class="line"><span class="comment"># 简化形式：commons: CommonQueryParams = Depends() 或 commons=Depends(CommonQueryParams)</span></span><br><span class="line"><span class="keyword">async</span> <span class="keyword">def</span> <span class="title function_">read_items</span>(<span class="params">commons: CommonQueryParams = Depends(<span class="params">CommonQueryParams</span>)</span>):</span><br><span class="line">    response = &#123;&#125;</span><br><span class="line">    <span class="keyword">if</span> commons.q:</span><br><span class="line">        response.update(&#123;<span class="string">&quot;q&quot;</span>: commons.q&#125;)</span><br><span class="line">    items = fake_items_db[commons.skip : commons.skip + commons.limit]</span><br><span class="line">    response.update(&#123;<span class="string">&quot;items&quot;</span>: items&#125;)</span><br><span class="line">    <span class="keyword">return</span> response</span><br></pre></td></tr></table></figure></p>
<p>3.子依赖（嵌套依赖）：<br />
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> typing <span class="keyword">import</span> <span class="type">Union</span></span><br><span class="line"><span class="keyword">from</span> fastapi <span class="keyword">import</span> Cookie, Depends, FastAPI</span><br><span class="line"></span><br><span class="line">app = FastAPI()</span><br><span class="line"></span><br><span class="line"><span class="comment"># 第一层依赖</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">query_extractor</span>(<span class="params">q: <span class="type">Union</span>[<span class="built_in">str</span>, <span class="literal">None</span>] = <span class="literal">None</span></span>):</span><br><span class="line">    <span class="keyword">return</span> q</span><br><span class="line"><span class="comment"># 第二层依赖</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">query_or_cookie_extractor</span>(<span class="params"></span></span><br><span class="line"><span class="params">    q: <span class="built_in">str</span> = Depends(<span class="params">query_extractor</span>),  <span class="comment"># 使用第一层依赖</span></span></span><br><span class="line"><span class="params">    last_query: <span class="type">Union</span>[<span class="built_in">str</span>, <span class="literal">None</span>] = Cookie(<span class="params">default=<span class="literal">None</span></span>),</span></span><br><span class="line"><span class="params"></span>):</span><br><span class="line">    <span class="keyword">if</span> <span class="keyword">not</span> q:</span><br><span class="line">        <span class="keyword">return</span> last_query</span><br><span class="line">    <span class="keyword">return</span> q</span><br><span class="line"></span><br><span class="line"><span class="meta">@app.get(<span class="params"><span class="string">&quot;/items/&quot;</span></span>)</span></span><br><span class="line"><span class="comment"># 只使用第二层依赖</span></span><br><span class="line"><span class="keyword">async</span> <span class="keyword">def</span> <span class="title function_">read_query</span>(<span class="params">query_or_default: <span class="built_in">str</span> = Depends(<span class="params">query_or_cookie_extractor</span>)</span>):</span><br><span class="line">    <span class="keyword">return</span> &#123;<span class="string">&quot;q_or_cookie&quot;</span>: query_or_default&#125;</span><br></pre></td></tr></table></figure></p>
<p>4.如果嵌套依赖，多次使用同一个子依赖项，FastAPI
在处理同一请求时，只调用一次该子依赖项，不会为同一个请求多次调用同一个依赖项，而是把依赖项的返回值进行「缓存」，并把它传递给同一请求中所有需要使用该返回值的「依赖项」。如果不想使用「缓存」值，而是为需要在同一请求的每一步操作（多次）中都实际调用依赖项，可以把
Depends 的参数 <code>use_cache</code> 的值设置为 False：<br />
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">async</span> <span class="keyword">def</span> <span class="title function_">needy_dependency</span>(<span class="params">fresh_value: <span class="built_in">str</span> = Depends(<span class="params">get_value, use_cache=<span class="literal">False</span></span>)</span>):</span><br><span class="line">    <span class="keyword">return</span> &#123;<span class="string">&quot;fresh_value&quot;</span>: fresh_value&#125;</span><br></pre></td></tr></table></figure></p>
<p>5.在路由上添加依赖项，不会接收使用依赖项的返回值：<br />
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> fastapi <span class="keyword">import</span> Depends, FastAPI, Header, HTTPException</span><br><span class="line"></span><br><span class="line">app = FastAPI()</span><br><span class="line"></span><br><span class="line"><span class="comment"># 赖项可以声明请求的需求项（比如响应头）或其他子依赖项</span></span><br><span class="line"><span class="keyword">async</span> <span class="keyword">def</span> <span class="title function_">verify_token</span>(<span class="params">x_token: <span class="built_in">str</span> = Header(<span class="params"></span>)</span>):</span><br><span class="line">    <span class="keyword">if</span> x_token != <span class="string">&quot;fake-super-secret-token&quot;</span>:</span><br><span class="line">        <span class="comment"># 可以 raise 异常</span></span><br><span class="line">        <span class="keyword">raise</span> HTTPException(status_code=<span class="number">400</span>, detail=<span class="string">&quot;X-Token header invalid&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">async</span> <span class="keyword">def</span> <span class="title function_">verify_key</span>(<span class="params">x_key: <span class="built_in">str</span> = Header(<span class="params"></span>)</span>):</span><br><span class="line">    <span class="keyword">if</span> x_key != <span class="string">&quot;fake-super-secret-key&quot;</span>:</span><br><span class="line">        <span class="keyword">raise</span> HTTPException(status_code=<span class="number">400</span>, detail=<span class="string">&quot;X-Key header invalid&quot;</span>)</span><br><span class="line">    <span class="comment"># 路由dependencies依赖项不会使用返回值</span></span><br><span class="line">    <span class="keyword">return</span> x_key</span><br><span class="line"></span><br><span class="line"><span class="comment"># dependencies必须是Depends组成的列表</span></span><br><span class="line"><span class="meta">@app.get(<span class="params"><span class="string">&quot;/items/&quot;</span>, dependencies=[Depends(<span class="params">verify_token</span>), Depends(<span class="params">verify_key</span>)]</span>)</span></span><br><span class="line"><span class="keyword">async</span> <span class="keyword">def</span> <span class="title function_">read_items</span>():</span><br><span class="line">    <span class="keyword">return</span> [&#123;<span class="string">&quot;item&quot;</span>: <span class="string">&quot;Foo&quot;</span>&#125;, &#123;<span class="string">&quot;item&quot;</span>: <span class="string">&quot;Bar&quot;</span>&#125;]</span><br></pre></td></tr></table></figure></p>
<p>6.全局注入依赖：<br />
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> fastapi <span class="keyword">import</span> Depends, FastAPI, Header, HTTPException</span><br><span class="line"></span><br><span class="line"><span class="keyword">async</span> <span class="keyword">def</span> <span class="title function_">verify_token</span>(<span class="params">x_token: <span class="built_in">str</span> = Header(<span class="params"></span>)</span>):</span><br><span class="line">    <span class="keyword">if</span> x_token != <span class="string">&quot;fake-super-secret-token&quot;</span>:</span><br><span class="line">        <span class="keyword">raise</span> HTTPException(status_code=<span class="number">400</span>, detail=<span class="string">&quot;X-Token header invalid&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">async</span> <span class="keyword">def</span> <span class="title function_">verify_key</span>(<span class="params">x_key: <span class="built_in">str</span> = Header(<span class="params"></span>)</span>):</span><br><span class="line">    <span class="keyword">if</span> x_key != <span class="string">&quot;fake-super-secret-key&quot;</span>:</span><br><span class="line">        <span class="keyword">raise</span> HTTPException(status_code=<span class="number">400</span>, detail=<span class="string">&quot;X-Key header invalid&quot;</span>)</span><br><span class="line">    <span class="keyword">return</span> x_key</span><br><span class="line"></span><br><span class="line"><span class="comment"># 依赖注入至整个FastAPI应用，app的所有路由都自带该依赖项</span></span><br><span class="line"><span class="comment"># 只执行依赖项，不会使用依赖项的返回值</span></span><br><span class="line">app = FastAPI(dependencies=[Depends(verify_token), Depends(verify_key)])</span><br><span class="line"></span><br><span class="line"><span class="meta">@app.get(<span class="params"><span class="string">&quot;/items/&quot;</span></span>)</span></span><br><span class="line"><span class="keyword">async</span> <span class="keyword">def</span> <span class="title function_">read_items</span>():</span><br><span class="line">    <span class="keyword">return</span> [&#123;<span class="string">&quot;item&quot;</span>: <span class="string">&quot;Portal Gun&quot;</span>&#125;, &#123;<span class="string">&quot;item&quot;</span>: <span class="string">&quot;Plumbus&quot;</span>&#125;]</span><br><span class="line"></span><br><span class="line"><span class="meta">@app.get(<span class="params"><span class="string">&quot;/users/&quot;</span></span>)</span></span><br><span class="line"><span class="keyword">async</span> <span class="keyword">def</span> <span class="title function_">read_users</span>():</span><br><span class="line">    <span class="keyword">return</span> [&#123;<span class="string">&quot;username&quot;</span>: <span class="string">&quot;Rick&quot;</span>&#125;, &#123;<span class="string">&quot;username&quot;</span>: <span class="string">&quot;Morty&quot;</span>&#125;]</span><br></pre></td></tr></table></figure></p>
<p>7.依赖项支持在完成后，执行额外操作，此时使用yield，且只能使用一次：<br />
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 在创建响应之前，仅执行yield 语句之前的代码（包括yield 语句）</span></span><br><span class="line"><span class="comment"># 在响应发送后执行yield语句后面的代码</span></span><br><span class="line"><span class="keyword">async</span> <span class="keyword">def</span> <span class="title function_">get_db</span>():</span><br><span class="line">    db = DBSession()</span><br><span class="line">    <span class="keyword">try</span>:</span><br><span class="line">        <span class="keyword">yield</span> db</span><br><span class="line">    <span class="keyword">finally</span>:</span><br><span class="line">        db.close()</span><br></pre></td></tr></table></figure></p>
<p>8.yield也可以嵌套使用：<br />
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> typing <span class="keyword">import</span> Annotated</span><br><span class="line"><span class="keyword">from</span> fastapi <span class="keyword">import</span> Depends</span><br><span class="line"></span><br><span class="line"><span class="keyword">async</span> <span class="keyword">def</span> <span class="title function_">dependency_a</span>():</span><br><span class="line">    dep_a = generate_dep_a()</span><br><span class="line">    <span class="keyword">try</span>:</span><br><span class="line">        <span class="keyword">yield</span> dep_a</span><br><span class="line">    <span class="keyword">finally</span>:</span><br><span class="line">        dep_a.close()</span><br><span class="line"></span><br><span class="line"><span class="comment"># 而 dependency_b 反过来则需要 dependency_a（此处称为 dep_a ）的值在其退出代码中可用。</span></span><br><span class="line"><span class="keyword">async</span> <span class="keyword">def</span> <span class="title function_">dependency_b</span>(<span class="params">dep_a: Annotated[DepA, Depends(<span class="params">dependency_a</span>)]</span>):</span><br><span class="line">    dep_b = generate_dep_b()</span><br><span class="line">    <span class="keyword">try</span>:</span><br><span class="line">        <span class="keyword">yield</span> dep_b</span><br><span class="line">    <span class="keyword">finally</span>:</span><br><span class="line">        dep_b.close(dep_a)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 在这种情况下，dependency_c 在执行其退出代码时需要 dependency_b（此处称为 dep_b）的值仍然可用。</span></span><br><span class="line"><span class="keyword">async</span> <span class="keyword">def</span> <span class="title function_">dependency_c</span>(<span class="params">dep_b: Annotated[DepB, Depends(<span class="params">dependency_b</span>)]</span>):</span><br><span class="line">    dep_c = generate_dep_c()</span><br><span class="line">    <span class="keyword">try</span>:</span><br><span class="line">        <span class="keyword">yield</span> dep_c</span><br><span class="line">    <span class="keyword">finally</span>:</span><br><span class="line">        dep_c.close(dep_b)</span><br></pre></td></tr></table></figure></p>
<p>9.yield的依赖项中使用 except
捕获了一个异常，需要raise它，这样FastAPI才能知道发生了错误，并返回一个适当的响应：<br />
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> typing <span class="keyword">import</span> Annotated</span><br><span class="line"><span class="keyword">from</span> fastapi <span class="keyword">import</span> Depends, FastAPI, HTTPException</span><br><span class="line"></span><br><span class="line">app = FastAPI()</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">InternalError</span>(<span class="title class_ inherited__">Exception</span>):</span><br><span class="line">    <span class="keyword">pass</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">get_username</span>():</span><br><span class="line">    <span class="keyword">try</span>:</span><br><span class="line">        <span class="keyword">yield</span> <span class="string">&quot;Rick&quot;</span></span><br><span class="line">    <span class="keyword">except</span> InternalError:</span><br><span class="line">        <span class="comment"># 在yield语句中捕获异常，需要raise它，让FastAPI知道发生了错误</span></span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;Oops, we didn&#x27;t raise again, Britney 😱&quot;</span>)</span><br><span class="line">        <span class="keyword">raise</span></span><br><span class="line"></span><br><span class="line"><span class="meta">@app.get(<span class="params"><span class="string">&quot;/items/&#123;item_id&#125;&quot;</span></span>)</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">get_item</span>(<span class="params">item_id: <span class="built_in">str</span>, username: Annotated[<span class="built_in">str</span>, Depends(<span class="params">get_username</span>)]</span>):</span><br><span class="line">    <span class="keyword">if</span> item_id == <span class="string">&quot;portal-gun&quot;</span>:</span><br><span class="line">        <span class="keyword">raise</span> InternalError(</span><br><span class="line">            <span class="string">f&quot;The portal gun is too dangerous to be owned by <span class="subst">&#123;username&#125;</span>&quot;</span></span><br><span class="line">        )</span><br><span class="line">    <span class="keyword">if</span> item_id != <span class="string">&quot;plumbus&quot;</span>:</span><br><span class="line">        <span class="keyword">raise</span> HTTPException(</span><br><span class="line">            status_code=<span class="number">404</span>, detail=<span class="string">&quot;Item not found, there&#x27;s only a plumbus here&quot;</span></span><br><span class="line">        )</span><br><span class="line">    <span class="keyword">return</span> item_id</span><br></pre></td></tr></table></figure></p>
<p>10.通过yield使用上下文管理器：<br />
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 创建一个带有__enter__()和__exit__()方法的类</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">MySuperContextManager</span>:</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__init__</span>(<span class="params">self</span>):</span><br><span class="line">        self.db = DBSession()</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__enter__</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="keyword">return</span> self.db</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__exit__</span>(<span class="params">self, exc_type, exc_value, traceback</span>):</span><br><span class="line">        self.db.close()</span><br><span class="line"></span><br><span class="line"><span class="comment"># yield 依赖项中通过 with 或者 async with 语句来使用它们</span></span><br><span class="line"><span class="keyword">async</span> <span class="keyword">def</span> <span class="title function_">get_db</span>():</span><br><span class="line">    <span class="keyword">with</span> MySuperContextManager() <span class="keyword">as</span> db:</span><br><span class="line">        <span class="keyword">yield</span> db</span><br></pre></td></tr></table></figure></p>
<p>另一种创建上下文管理器的方法是：<a
target="_blank" rel="noopener" href="https://docs.python.org/zh-cn/3/library/contextlib.html#contextlib.contextmanager"><code>@contextlib.contextmanager</code></a>
或者 <a
target="_blank" rel="noopener" href="https://docs.python.org/zh-cn/3/library/contextlib.html#contextlib.asynccontextmanager"><code>@contextlib.asynccontextmanager</code></a></p>
<h1 id="高级依赖项">高级依赖项</h1>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> fastapi <span class="keyword">import</span> Depends, FastAPI</span><br><span class="line"></span><br><span class="line">app = FastAPI()</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">FixedContentQueryChecker</span>:</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__init__</span>(<span class="params">self, fixed_content: <span class="built_in">str</span></span>):</span><br><span class="line">        self.fixed_content = fixed_content</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__call__</span>(<span class="params">self, q: <span class="built_in">str</span> = <span class="string">&quot;&quot;</span></span>):</span><br><span class="line">        <span class="keyword">if</span> q:</span><br><span class="line">            <span class="keyword">return</span> self.fixed_content <span class="keyword">in</span> q</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">False</span></span><br><span class="line"></span><br><span class="line"><span class="meta">@app.get(<span class="params"><span class="string">&quot;/query-checker/&quot;</span></span>)</span></span><br><span class="line"><span class="comment"># 传递FixedContentQueryChecker实例，并在被调用时检查查询参数q是否包含&quot;bar&quot;</span></span><br><span class="line"><span class="keyword">async</span> <span class="keyword">def</span> <span class="title function_">read_query_check</span>(<span class="params">fixed_content_included: <span class="built_in">bool</span> = Depends(<span class="params">FixedContentQueryChecker(<span class="params"><span class="string">&quot;bar&quot;</span></span>)</span>)</span>):</span><br><span class="line">    <span class="keyword">return</span> &#123;<span class="string">&quot;fixed_content_in_query&quot;</span>: fixed_content_included&#125;</span><br></pre></td></tr></table></figure>
<h1 id="安全性">安全性</h1>
<p>OAuth2是一个规范，它定义了几种处理身份认证和授权的方法。它包括了使用「第三方」进行身份认证的方法。<br />
OpenAPI（以前称为 Swagger）是用于构建 API 的开放规范（现已成为 Linux
Foundation 的一部分）。<br />
FastAPI 基于
OpenAPI。这就是使多个自动交互式文档界面，代码生成等成为可能的原因。<br />
OpenAPI
有一种定义多个安全「方案」的方法。通过使用它们，可以利用所有这些基于标准的工具，包括这些交互式文档系统。</p>
<p>1.OpenAPI 定义了以下安全方案：<br />
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">|-apiKey：一个特定于应用程序的密钥，可以来自：Query、Header、Cookie。</span><br><span class="line">|-http：标准的 HTTP 身份认证系统，包括：</span><br><span class="line">    |-bearer: 一个值为 Bearer 加令牌字符串的 Authorization 请求头。这是从 OAuth2 继承的。</span><br><span class="line">    |-HTTP Basic: 一个值为用户名和密码的 Authorization 请求头，使用 Base64 编码。</span><br><span class="line">    |-HTTP Digest: 一个值为用户名和密码的 Authorization 请求头，使用 MD5 哈希算法。</span><br><span class="line">|-oauth2：所有的 OAuth2 处理安全性的方式（称为「流程」）。 其中几个流程适合构建 OAuth <span class="number">2.0</span> 身份验证提供程序： </span><br><span class="line">    |-implicit：隐式流程。</span><br><span class="line">    |-clientCredentials：客户端凭证流程。</span><br><span class="line">    |-authorizationCode: 授权码流程。</span><br><span class="line">    |-password: 密码流程。完美地直接用于在同一应用程序中处理身份验证。</span><br><span class="line">|-openIdConnect：提供了一种定义如何自动发现 OAuth2 身份认证数据的方法。此自动发现机制是 OpenID Connect 规范中定义的内容。</span><br></pre></td></tr></table></figure></p>
<p>Password 流是 OAuth2 定义的，用于处理安全与身份验证的方式。OAuth2
的设计目标是为了让后端或 API 独立于服务器验证用户身份。<br />
2.FastAPI 应用会处理 API 与身份验证，其简化流程如下：<br />
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">1.</span>用户在前端输入 username 与password，并点击<span class="string">&quot;回车&quot;</span>；</span><br><span class="line"><span class="number">2.</span>前端将 username 与 password 发送到 API 中指定的 URL（使用 tokenUrl=<span class="string">&quot;token&quot;</span> 声明）；</span><br><span class="line"><span class="number">3.</span>API 检查 username 与password，并用令牌（Token） 响应（暂未实现此功能）；</span><br><span class="line"><span class="number">4.</span>前端将令牌存储在本地（例如，在浏览器的 LocalStorage 中），令牌一般在一段时间后过期，需再次登录；</span><br><span class="line"><span class="number">5.</span>每次请求时，前端都会将令牌添加到请求头中（例如，在 Authorization 请求头中，值为 Bearer &lt;token&gt;）；</span><br><span class="line"><span class="number">6.</span>API 检查令牌，如果令牌有效，则处理请求，否则返回 <span class="number">401</span> Unauthorized。</span><br></pre></td></tr></table></figure></p>
<p>3.FastAPI中的实现：<br />
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> fastapi <span class="keyword">import</span> Depends, FastAPI</span><br><span class="line"><span class="keyword">from</span> fastapi.security <span class="keyword">import</span> OAuth2PasswordBearer</span><br><span class="line"></span><br><span class="line">app = FastAPI()</span><br><span class="line"></span><br><span class="line"><span class="comment"># OAuth2PasswordBearer使用Password 流以及 Bearer 令牌（Token）处理验证</span></span><br><span class="line"><span class="comment"># tokenUrl=&quot;token&quot; 声明了令牌的 URL（相对路径&quot;/token&quot;），它将用于获取令牌</span></span><br><span class="line">oauth2_scheme = OAuth2PasswordBearer(tokenUrl=<span class="string">&quot;token&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="meta">@app.get(<span class="params"><span class="string">&quot;/items/&quot;</span></span>)</span></span><br><span class="line"><span class="comment"># oauth2_scheme是一个可调用项，使用 Depends 把 oauth2_scheme 传入依赖项，用于获取令牌</span></span><br><span class="line"><span class="keyword">async</span> <span class="keyword">def</span> <span class="title function_">read_items</span>(<span class="params">token: <span class="built_in">str</span> = Depends(<span class="params">oauth2_scheme</span>)</span>):</span><br><span class="line">    <span class="keyword">return</span> &#123;<span class="string">&quot;token&quot;</span>: token&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment"># FastAPI 校验请求中的 Authorization 请求头，核对请求头的值是不是由 Bearer ＋ 令牌组成， 并返回令牌字符串（str）。</span></span><br><span class="line"><span class="comment"># 如果没有找到 Authorization 请求头，或请求头的值不是 Bearer ＋ 令牌。FastAPI 直接返回 401 错误状态码（UNAUTHORIZED）。</span></span><br></pre></td></tr></table></figure></p>
<p>3.进一步完善，从oauth2_scheme获取令牌，返回当前用户：<br />
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> typing <span class="keyword">import</span> <span class="type">Union</span></span><br><span class="line"><span class="keyword">from</span> fastapi <span class="keyword">import</span> Depends, FastAPI</span><br><span class="line"><span class="keyword">from</span> fastapi.security <span class="keyword">import</span> OAuth2PasswordBearer</span><br><span class="line"><span class="keyword">from</span> pydantic <span class="keyword">import</span> BaseModel</span><br><span class="line"></span><br><span class="line">app = FastAPI()</span><br><span class="line"></span><br><span class="line"><span class="comment"># 用户模型</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">User</span>(<span class="title class_ inherited__">BaseModel</span>):</span><br><span class="line">    username: <span class="built_in">str</span></span><br><span class="line">    email: <span class="type">Union</span>[<span class="built_in">str</span>, <span class="literal">None</span>] = <span class="literal">None</span></span><br><span class="line">    full_name: <span class="type">Union</span>[<span class="built_in">str</span>, <span class="literal">None</span>] = <span class="literal">None</span></span><br><span class="line">    disabled: <span class="type">Union</span>[<span class="built_in">bool</span>, <span class="literal">None</span>] = <span class="literal">None</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 返回用户</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">fake_decode_token</span>(<span class="params">token</span>):</span><br><span class="line">    <span class="keyword">return</span> User(</span><br><span class="line">        username=token + <span class="string">&quot;fakedecoded&quot;</span>, email=<span class="string">&quot;john@example.com&quot;</span>, full_name=<span class="string">&quot;John Doe&quot;</span></span><br><span class="line">    )</span><br><span class="line"></span><br><span class="line"><span class="comment"># 依赖1</span></span><br><span class="line">oauth2_scheme = OAuth2PasswordBearer(tokenUrl=<span class="string">&quot;token&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 依赖2</span></span><br><span class="line"><span class="keyword">async</span> <span class="keyword">def</span> <span class="title function_">get_current_user</span>(<span class="params">token: <span class="built_in">str</span> = Depends(<span class="params">oauth2_scheme</span>)</span>):</span><br><span class="line">    user = fake_decode_token(token)</span><br><span class="line">    <span class="keyword">return</span> user</span><br><span class="line"></span><br><span class="line"><span class="meta">@app.get(<span class="params"><span class="string">&quot;/users/me&quot;</span></span>)</span></span><br><span class="line"><span class="comment"># 注入依赖（这里能看出，依赖的益处：安全和依赖注入的代码只需要写一次，在其他路由可用Depends复用）</span></span><br><span class="line"><span class="keyword">async</span> <span class="keyword">def</span> <span class="title function_">read_users_me</span>(<span class="params">current_user: User = Depends(<span class="params">get_current_user</span>)</span>):</span><br><span class="line">    <span class="keyword">return</span> current_user</span><br></pre></td></tr></table></figure></p>
<h2 id="oauth2简单的-password-和-bearer-验证">OAuth2简单的 Password 和
Bearer 验证</h2>
<p>OAuth2 使用<strong>表单数据</strong>发送 username 与
password，需先安装<code>python-multipart</code>库。<br />
1.完整的，OAuth2 实现简单的 Password 和 Bearer 验证：<br />
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> typing <span class="keyword">import</span> <span class="type">Union</span></span><br><span class="line"><span class="keyword">from</span> fastapi <span class="keyword">import</span> Depends, FastAPI, HTTPException, status</span><br><span class="line"><span class="keyword">from</span> fastapi.security <span class="keyword">import</span> OAuth2PasswordBearer, OAuth2PasswordRequestForm</span><br><span class="line"><span class="keyword">from</span> pydantic <span class="keyword">import</span> BaseModel</span><br><span class="line"></span><br><span class="line"><span class="comment"># （伪）数据库</span></span><br><span class="line">fake_users_db = &#123;</span><br><span class="line">    <span class="string">&quot;johndoe&quot;</span>: &#123;</span><br><span class="line">        <span class="string">&quot;username&quot;</span>: <span class="string">&quot;johndoe&quot;</span>,</span><br><span class="line">        <span class="string">&quot;full_name&quot;</span>: <span class="string">&quot;John Doe&quot;</span>,</span><br><span class="line">        <span class="string">&quot;email&quot;</span>: <span class="string">&quot;johndoe@example.com&quot;</span>,</span><br><span class="line">        <span class="string">&quot;hashed_password&quot;</span>: <span class="string">&quot;fakehashedsecret&quot;</span>,</span><br><span class="line">        <span class="string">&quot;disabled&quot;</span>: <span class="literal">False</span>,</span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="string">&quot;alice&quot;</span>: &#123;</span><br><span class="line">        <span class="string">&quot;username&quot;</span>: <span class="string">&quot;alice&quot;</span>,</span><br><span class="line">        <span class="string">&quot;full_name&quot;</span>: <span class="string">&quot;Alice Wonderson&quot;</span>,</span><br><span class="line">        <span class="string">&quot;email&quot;</span>: <span class="string">&quot;alice@example.com&quot;</span>,</span><br><span class="line">        <span class="string">&quot;hashed_password&quot;</span>: <span class="string">&quot;fakehashedsecret2&quot;</span>,</span><br><span class="line">        <span class="string">&quot;disabled&quot;</span>: <span class="literal">True</span>,</span><br><span class="line">    &#125;,</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">app = FastAPI()</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">fake_hash_password</span>(<span class="params">password: <span class="built_in">str</span></span>):</span><br><span class="line">    <span class="keyword">return</span> <span class="string">&quot;fakehashed&quot;</span> + password</span><br><span class="line"></span><br><span class="line">oauth2_scheme = OAuth2PasswordBearer(tokenUrl=<span class="string">&quot;token&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">User</span>(<span class="title class_ inherited__">BaseModel</span>):</span><br><span class="line">    username: <span class="built_in">str</span></span><br><span class="line">    email: <span class="type">Union</span>[<span class="built_in">str</span>, <span class="literal">None</span>] = <span class="literal">None</span></span><br><span class="line">    full_name: <span class="type">Union</span>[<span class="built_in">str</span>, <span class="literal">None</span>] = <span class="literal">None</span></span><br><span class="line">    disabled: <span class="type">Union</span>[<span class="built_in">bool</span>, <span class="literal">None</span>] = <span class="literal">None</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 不要保存明文密码</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">UserInDB</span>(<span class="title class_ inherited__">User</span>):</span><br><span class="line">    hashed_password: <span class="built_in">str</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="meta">@app.post(<span class="params"><span class="string">&quot;/token&quot;</span></span>)</span></span><br><span class="line"><span class="comment"># OAuth2PasswordRequestForm声明了请求表单username和password字段</span></span><br><span class="line"><span class="keyword">async</span> <span class="keyword">def</span> <span class="title function_">login</span>(<span class="params">form_data: OAuth2PasswordRequestForm = Depends(<span class="params"></span>)</span>):</span><br><span class="line">    <span class="comment"># 使用表单字段 username，从（伪）数据库中获取用户数据</span></span><br><span class="line">    user_dict = fake_users_db.get(form_data.username)</span><br><span class="line">    <span class="keyword">if</span> <span class="keyword">not</span> user_dict:</span><br><span class="line">        <span class="keyword">raise</span> HTTPException(status_code=<span class="number">400</span>, detail=<span class="string">&quot;Incorrect username or password&quot;</span>)</span><br><span class="line">    <span class="comment"># 创建用户pydantic模型</span></span><br><span class="line">    user = UserInDB(**user_dict)</span><br><span class="line">    <span class="comment"># 将&quot;用户密码&quot;哈希处理，和（伪）数据库中保存的&quot;哈希值密码&quot;对比校验</span></span><br><span class="line">    hashed_password = fake_hash_password(form_data.password)</span><br><span class="line">    <span class="keyword">if</span> <span class="keyword">not</span> hashed_password == user.hashed_password:</span><br><span class="line">        <span class="keyword">raise</span> HTTPException(status_code=<span class="number">400</span>, detail=<span class="string">&quot;Incorrect username or password&quot;</span>)</span><br><span class="line">    <span class="comment"># /token的响应必须是json对象，必须包含access_token和token_type字段</span></span><br><span class="line">    <span class="keyword">return</span> &#123;<span class="string">&quot;access_token&quot;</span>: user.username, <span class="string">&quot;token_type&quot;</span>: <span class="string">&quot;bearer&quot;</span>&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># 从数据库获取用户，创建pydantic模型</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">get_user</span>(<span class="params">db, username: <span class="built_in">str</span></span>):</span><br><span class="line">    <span class="keyword">if</span> username <span class="keyword">in</span> db:</span><br><span class="line">        user_dict = db[username]</span><br><span class="line">        <span class="keyword">return</span> UserInDB(**user_dict)</span><br><span class="line">        </span><br><span class="line"><span class="comment"># 处理token</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">fake_decode_token</span>(<span class="params">token</span>):</span><br><span class="line">    <span class="comment"># This doesn&#x27;t provide any security at all</span></span><br><span class="line">    <span class="comment"># Check the next version</span></span><br><span class="line">    user = get_user(fake_users_db, token)</span><br><span class="line">    <span class="keyword">return</span> user</span><br><span class="line"></span><br><span class="line"><span class="comment"># 需在请求头中添加Authorization字段，值为&quot;access_token&quot;的值</span></span><br><span class="line"><span class="comment"># 从oauth2_scheme获取Authorization字段值为token，返回当前用户</span></span><br><span class="line"><span class="keyword">async</span> <span class="keyword">def</span> <span class="title function_">get_current_user</span>(<span class="params">token: <span class="built_in">str</span> = Depends(<span class="params">oauth2_scheme</span>)</span>):</span><br><span class="line">    user = fake_decode_token(token)</span><br><span class="line">    <span class="keyword">if</span> <span class="keyword">not</span> user:</span><br><span class="line">        <span class="keyword">raise</span> HTTPException(</span><br><span class="line">            status_code=status.HTTP_401_UNAUTHORIZED,</span><br><span class="line">            detail=<span class="string">&quot;Invalid authentication credentials&quot;</span>,</span><br><span class="line">            headers=&#123;<span class="string">&quot;WWW-Authenticate&quot;</span>: <span class="string">&quot;Bearer&quot;</span>&#125;,</span><br><span class="line">        )</span><br><span class="line">    <span class="keyword">return</span> user</span><br><span class="line"></span><br><span class="line"><span class="keyword">async</span> <span class="keyword">def</span> <span class="title function_">get_current_active_user</span>(<span class="params">current_user: User = Depends(<span class="params">get_current_user</span>)</span>):</span><br><span class="line">    <span class="keyword">if</span> current_user.disabled: <span class="comment"># 非激活用户</span></span><br><span class="line">        <span class="keyword">raise</span> HTTPException(status_code=<span class="number">400</span>, detail=<span class="string">&quot;Inactive user&quot;</span>)</span><br><span class="line">    <span class="keyword">return</span> current_user</span><br><span class="line"></span><br><span class="line"><span class="comment"># /token响应完，更新依赖项（仅当前用户为激活状态时获取current_user）</span></span><br><span class="line"><span class="meta">@app.get(<span class="params"><span class="string">&quot;/users/me&quot;</span></span>)</span></span><br><span class="line"><span class="keyword">async</span> <span class="keyword">def</span> <span class="title function_">read_users_me</span>(<span class="params">current_user: User = Depends(<span class="params">get_current_active_user</span>)</span>):</span><br><span class="line">    <span class="keyword">return</span> current_user</span><br></pre></td></tr></table></figure></p>
<h2
id="oauth2实现密码哈希与bearer-jwt令牌验证">OAuth2实现密码哈希与Bearer
JWT令牌验证</h2>
<p>1.<strong>JWT</strong> 即 <strong>JSON Web Tokens</strong>。JWT
是一种将 JSON 对象编码为没有空格，且难以理解的长字符串的标准。<br />
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">JWT的格式：<span class="string">&quot;xxx.xxx.xxx&quot;</span></span><br><span class="line"><span class="comment"># 1.JWT 令牌由三部分组成：头部（header）、载荷（payload）、签名（signature）。</span></span><br><span class="line"><span class="comment"># 2.header包含令牌的类型（JWT）和所使用的哈希算法（比如 HMAC SHA256 或 RSA）。</span></span><br><span class="line"><span class="comment"># 3.payload包含声明（claims），声明是关于实体（通常是用户）和其他数据的声明。由JWT的标准所定义的。</span></span><br><span class="line"><span class="comment"># 4.signature使用header中指定的算法对header和payload进行哈希，然后使用密钥对哈希值进行签名。用于验证JWT的发送者是否可信任。</span></span><br></pre></td></tr></table></figure></p>
<p>JWT 字符串没有加密，任何人都能用它恢复原始信息，但 JWT
使用了签名机制，接受令牌时，可以用签名校验令牌。<br />
JWT
令牌具有时限性，过期后令牌失效，如果用户篡改令牌的过期时间，因为签名不匹配会导致身份验证失败。<br />
JWT 需安装<code>pip install pyjwt</code>。若使用类似 RSA 或 ECDSA
的数字签名算法，应该安装加密库依赖项<code>pip install pyjwt[crypto]</code>。</p>
<p>2.<strong>哈希</strong>是指把特定内容（本例中为密码）转换为乱码形式的字节序列（其实就是字符串）。<br />
每次传入完全相同的内容时（比如，完全相同的密码），返回的都是完全相同的乱码。<br />
但这个乱码无法转换回传入的密码。<br />
需安装处理密码哈希的包，本例推荐算法是Bcrypt，所以安装<code>pip install passlib[bcrypt]</code>。</p>
<p>3.此例为完整实用安全机制实现：<br />
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> datetime <span class="keyword">import</span> datetime, timedelta, timezone</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> jwt</span><br><span class="line"><span class="keyword">from</span> fastapi <span class="keyword">import</span> Depends, FastAPI, HTTPException, status</span><br><span class="line"><span class="keyword">from</span> fastapi.security <span class="keyword">import</span> OAuth2PasswordBearer, OAuth2PasswordRequestForm</span><br><span class="line"><span class="keyword">from</span> jwt.exceptions <span class="keyword">import</span> InvalidTokenError</span><br><span class="line"><span class="keyword">from</span> passlib.context <span class="keyword">import</span> CryptContext</span><br><span class="line"><span class="keyword">from</span> pydantic <span class="keyword">import</span> BaseModel</span><br><span class="line"></span><br><span class="line"><span class="comment"># 生成32位十六进制随机字符串，作为WT令牌签名的随机密钥：openssl rand -hex 32</span></span><br><span class="line">SECRET_KEY = <span class="string">&quot;09d25e094faa6ca2556c818166b7a9563b93f7099f6f0f4caa6cf63b88e8d3e7&quot;</span></span><br><span class="line">ALGORITHM = <span class="string">&quot;HS256&quot;</span> <span class="comment"># JWT令牌签名算法</span></span><br><span class="line">ACCESS_TOKEN_EXPIRE_MINUTES = <span class="number">30</span>  <span class="comment"># JWT令牌过期时间，分钟</span></span><br><span class="line"></span><br><span class="line">fake_users_db = &#123;</span><br><span class="line">    <span class="string">&quot;johndoe&quot;</span>: &#123;</span><br><span class="line">        <span class="string">&quot;username&quot;</span>: <span class="string">&quot;johndoe&quot;</span>,</span><br><span class="line">        <span class="string">&quot;full_name&quot;</span>: <span class="string">&quot;John Doe&quot;</span>,</span><br><span class="line">        <span class="string">&quot;email&quot;</span>: <span class="string">&quot;johndoe@example.com&quot;</span>,</span><br><span class="line">        <span class="string">&quot;hashed_password&quot;</span>: <span class="string">&quot;$2b$12$EixZaYVK1fsbw1ZfbX3OXePaWxn96p36WQoeG6Lruj3vjPGga31lW&quot;</span>,</span><br><span class="line">        <span class="string">&quot;disabled&quot;</span>: <span class="literal">False</span>,</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Token</span>(<span class="title class_ inherited__">BaseModel</span>):</span><br><span class="line">    access_token: <span class="built_in">str</span></span><br><span class="line">    token_type: <span class="built_in">str</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">TokenData</span>(<span class="title class_ inherited__">BaseModel</span>):</span><br><span class="line">    username: <span class="built_in">str</span> | <span class="literal">None</span> = <span class="literal">None</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">User</span>(<span class="title class_ inherited__">BaseModel</span>):</span><br><span class="line">    username: <span class="built_in">str</span></span><br><span class="line">    email: <span class="built_in">str</span> | <span class="literal">None</span> = <span class="literal">None</span></span><br><span class="line">    full_name: <span class="built_in">str</span> | <span class="literal">None</span> = <span class="literal">None</span></span><br><span class="line">    disabled: <span class="built_in">bool</span> | <span class="literal">None</span> = <span class="literal">None</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">UserInDB</span>(<span class="title class_ inherited__">User</span>):</span><br><span class="line">    hashed_password: <span class="built_in">str</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">pwd_context = CryptContext(schemes=[<span class="string">&quot;bcrypt&quot;</span>], deprecated=<span class="string">&quot;auto&quot;</span>)</span><br><span class="line">oauth2_scheme = OAuth2PasswordBearer(tokenUrl=<span class="string">&quot;token&quot;</span>)</span><br><span class="line"></span><br><span class="line">app = FastAPI()</span><br><span class="line"></span><br><span class="line"><span class="comment"># 校验接收的密码，是否匹配存储的哈希值</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">verify_password</span>(<span class="params">plain_password, hashed_password</span>):</span><br><span class="line">    <span class="keyword">return</span> pwd_context.verify(plain_password, hashed_password)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">get_password_hash</span>(<span class="params">password</span>):</span><br><span class="line">    <span class="keyword">return</span> pwd_context.<span class="built_in">hash</span>(password)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">get_user</span>(<span class="params">db, username: <span class="built_in">str</span></span>):</span><br><span class="line">    <span class="keyword">if</span> username <span class="keyword">in</span> db:</span><br><span class="line">        user_dict = db[username]</span><br><span class="line">        <span class="keyword">return</span> UserInDB(**user_dict)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 获取用户，并对用户密码进行哈希验证</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">authenticate_user</span>(<span class="params">fake_db, username: <span class="built_in">str</span>, password: <span class="built_in">str</span></span>):</span><br><span class="line">    user = get_user(fake_db, username)</span><br><span class="line">    <span class="keyword">if</span> <span class="keyword">not</span> user:</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">False</span></span><br><span class="line">    <span class="keyword">if</span> <span class="keyword">not</span> verify_password(password, user.hashed_password):</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">False</span></span><br><span class="line">    <span class="keyword">return</span> user</span><br><span class="line"></span><br><span class="line"><span class="comment"># payload字段：</span></span><br><span class="line"><span class="comment"># iss: 该JWT的签发者</span></span><br><span class="line"><span class="comment"># sub: 该JWT所面向的用户</span></span><br><span class="line"><span class="comment"># aud: 接收该JWT的一方</span></span><br><span class="line"><span class="comment"># exp(expires): 什么时候过期，这里是一个Unix时间戳</span></span><br><span class="line"><span class="comment"># iat(issued at): 在什么时候签发的</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">create_access_token</span>(<span class="params">data: <span class="built_in">dict</span>, expires_delta: timedelta | <span class="literal">None</span> = <span class="literal">None</span></span>): <span class="comment"># 生成JWT令牌</span></span><br><span class="line">    payload = data.copy()</span><br><span class="line">    <span class="keyword">if</span> expires_delta:</span><br><span class="line">        expire = datetime.now(timezone.utc) + expires_delta</span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        expire = datetime.now(timezone.utc) + timedelta(minutes=<span class="number">15</span>)  <span class="comment"># 默认有效时间15分钟</span></span><br><span class="line">    payload.update(&#123;<span class="string">&quot;exp&quot;</span>: expire&#125;) <span class="comment"># 添加有效时间</span></span><br><span class="line">    <span class="comment"># JWT令牌生成，to_encode要加密的数据，SECRET_KEY用于签名和验证JWT，algorithm指定签名算法</span></span><br><span class="line">    encoded_jwt = jwt.encode(payload, SECRET_KEY, algorithm=ALGORITHM)</span><br><span class="line">    <span class="keyword">return</span> encoded_jwt</span><br><span class="line"></span><br><span class="line"><span class="comment"># 根据JWT令牌（直接获取access_token的值）获取用户</span></span><br><span class="line"><span class="keyword">async</span> <span class="keyword">def</span> <span class="title function_">get_current_user</span>(<span class="params">token: <span class="built_in">str</span> = Depends(<span class="params">oauth2_scheme</span>)</span>):</span><br><span class="line">    credentials_exception = HTTPException(</span><br><span class="line">        status_code=status.HTTP_401_UNAUTHORIZED,</span><br><span class="line">        detail=<span class="string">&quot;Could not validate credentials&quot;</span>,</span><br><span class="line">        headers=&#123;<span class="string">&quot;WWW-Authenticate&quot;</span>: <span class="string">&quot;Bearer&quot;</span>&#125;,</span><br><span class="line">    )</span><br><span class="line">    <span class="keyword">try</span>:</span><br><span class="line">        <span class="comment"># JWT令牌解码</span></span><br><span class="line">        payload = jwt.decode(token, SECRET_KEY, algorithms=[ALGORITHM])</span><br><span class="line">        <span class="comment"># 获取令牌存储的数据</span></span><br><span class="line">        username: <span class="built_in">str</span> = payload.get(<span class="string">&quot;sub&quot;</span>)</span><br><span class="line">        <span class="comment"># 验证数据</span></span><br><span class="line">        <span class="keyword">if</span> username <span class="keyword">is</span> <span class="literal">None</span>:</span><br><span class="line">            <span class="keyword">raise</span> credentials_exception</span><br><span class="line">        <span class="comment"># 存入TokenData模型</span></span><br><span class="line">        token_data = TokenData(username=username)</span><br><span class="line">    <span class="keyword">except</span> InvalidTokenError:</span><br><span class="line">        <span class="keyword">raise</span> credentials_exception</span><br><span class="line">    <span class="comment"># 获取用户数据</span></span><br><span class="line">    user = get_user(fake_users_db, username=token_data.username)</span><br><span class="line">    <span class="keyword">if</span> user <span class="keyword">is</span> <span class="literal">None</span>:</span><br><span class="line">        <span class="keyword">raise</span> credentials_exception</span><br><span class="line">    <span class="keyword">return</span> user</span><br><span class="line"></span><br><span class="line"><span class="comment"># 获取当前激活用户数据</span></span><br><span class="line"><span class="keyword">async</span> <span class="keyword">def</span> <span class="title function_">get_current_active_user</span>(<span class="params">current_user: User = Depends(<span class="params">get_current_user</span>)</span>):</span><br><span class="line">    <span class="keyword">if</span> current_user.disabled:</span><br><span class="line">        <span class="keyword">raise</span> HTTPException(status_code=<span class="number">400</span>, detail=<span class="string">&quot;Inactive user&quot;</span>)</span><br><span class="line">    <span class="keyword">return</span> current_user</span><br><span class="line"></span><br><span class="line"><span class="comment"># 请参考【OAuth2简单的 Password 和 Bearer 验证】</span></span><br><span class="line"><span class="meta">@app.post(<span class="params"><span class="string">&quot;/token&quot;</span></span>)</span></span><br><span class="line"><span class="keyword">async</span> <span class="keyword">def</span> <span class="title function_">login_for_access_token</span>(<span class="params">form_data: OAuth2PasswordRequestForm = Depends(<span class="params"></span>),</span>) -&gt; Token:</span><br><span class="line">    <span class="comment"># 获取用户，并对用户密码进行哈希验证</span></span><br><span class="line">    user = authenticate_user(fake_users_db, form_data.username, form_data.password)</span><br><span class="line">    <span class="keyword">if</span> <span class="keyword">not</span> user:</span><br><span class="line">        <span class="keyword">raise</span> HTTPException(</span><br><span class="line">            status_code=status.HTTP_401_UNAUTHORIZED,</span><br><span class="line">            detail=<span class="string">&quot;Incorrect username or password&quot;</span>,</span><br><span class="line">            headers=&#123;<span class="string">&quot;WWW-Authenticate&quot;</span>: <span class="string">&quot;Bearer&quot;</span>&#125;,</span><br><span class="line">        )</span><br><span class="line">    <span class="comment"># 设定token过期时间</span></span><br><span class="line">    access_token_expires = timedelta(minutes=ACCESS_TOKEN_EXPIRE_MINUTES)</span><br><span class="line">    <span class="comment"># 生成JWT令牌，&quot;sub&quot;是JWT的用户</span></span><br><span class="line">    access_token = create_access_token(data=&#123;<span class="string">&quot;sub&quot;</span>: user.username&#125;, expires_delta=access_token_expires)</span><br><span class="line">    <span class="comment"># 返回pydantic模型，必须有access_token和token_type</span></span><br><span class="line">    <span class="keyword">return</span> Token(access_token=access_token, token_type=<span class="string">&quot;bearer&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 获取当前用户数据，输入时必须携带JWT令牌（需在请求头中添加Authorization字段，值为&quot;access_token&quot;的值）</span></span><br><span class="line"><span class="meta">@app.get(<span class="params"><span class="string">&quot;/users/me/&quot;</span>, response_model=User</span>)</span></span><br><span class="line"><span class="keyword">async</span> <span class="keyword">def</span> <span class="title function_">read_users_me</span>(<span class="params">current_user: User = Depends(<span class="params">get_current_active_user</span>)</span>):</span><br><span class="line">    <span class="keyword">return</span> current_user</span><br><span class="line"></span><br><span class="line"><span class="comment"># 同上</span></span><br><span class="line"><span class="meta">@app.get(<span class="params"><span class="string">&quot;/users/me/items/&quot;</span></span>)</span></span><br><span class="line"><span class="keyword">async</span> <span class="keyword">def</span> <span class="title function_">read_own_items</span>(<span class="params">current_user: User = Depends(<span class="params">get_current_active_user</span>)</span>):</span><br><span class="line">    <span class="keyword">return</span> [&#123;<span class="string">&quot;item_id&quot;</span>: <span class="string">&quot;Foo&quot;</span>, <span class="string">&quot;owner&quot;</span>: current_user.username&#125;]</span><br></pre></td></tr></table></figure></p>
<h2 id="oauth2作用域">OAuth2作用域</h2>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> datetime <span class="keyword">import</span> datetime, timedelta, timezone</span><br><span class="line"><span class="keyword">from</span> typing <span class="keyword">import</span> <span class="type">List</span>, <span class="type">Union</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> jwt</span><br><span class="line"><span class="keyword">from</span> fastapi <span class="keyword">import</span> Depends, FastAPI, HTTPException, Security, status</span><br><span class="line"><span class="keyword">from</span> fastapi.security <span class="keyword">import</span> OAuth2PasswordBearer, OAuth2PasswordRequestForm, SecurityScopes</span><br><span class="line"><span class="keyword">from</span> jwt.exceptions <span class="keyword">import</span> InvalidTokenError</span><br><span class="line"><span class="keyword">from</span> passlib.context <span class="keyword">import</span> CryptContext</span><br><span class="line"><span class="keyword">from</span> pydantic <span class="keyword">import</span> BaseModel, ValidationError</span><br><span class="line"></span><br><span class="line"><span class="comment"># to get a string like this run:</span></span><br><span class="line"><span class="comment"># openssl rand -hex 32</span></span><br><span class="line">SECRET_KEY = <span class="string">&quot;09d25e094faa6ca2556c818166b7a9563b93f7099f6f0f4caa6cf63b88e8d3e7&quot;</span></span><br><span class="line">ALGORITHM = <span class="string">&quot;HS256&quot;</span></span><br><span class="line">ACCESS_TOKEN_EXPIRE_MINUTES = <span class="number">30</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">fake_users_db = &#123;</span><br><span class="line">    <span class="string">&quot;johndoe&quot;</span>: &#123;</span><br><span class="line">        <span class="string">&quot;username&quot;</span>: <span class="string">&quot;johndoe&quot;</span>,</span><br><span class="line">        <span class="string">&quot;full_name&quot;</span>: <span class="string">&quot;John Doe&quot;</span>,</span><br><span class="line">        <span class="string">&quot;email&quot;</span>: <span class="string">&quot;johndoe@example.com&quot;</span>,</span><br><span class="line">        <span class="string">&quot;hashed_password&quot;</span>: <span class="string">&quot;$2b$12$EixZaYVK1fsbw1ZfbX3OXePaWxn96p36WQoeG6Lruj3vjPGga31lW&quot;</span>,</span><br><span class="line">        <span class="string">&quot;disabled&quot;</span>: <span class="literal">False</span>,</span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="string">&quot;alice&quot;</span>: &#123;</span><br><span class="line">        <span class="string">&quot;username&quot;</span>: <span class="string">&quot;alice&quot;</span>,</span><br><span class="line">        <span class="string">&quot;full_name&quot;</span>: <span class="string">&quot;Alice Chains&quot;</span>,</span><br><span class="line">        <span class="string">&quot;email&quot;</span>: <span class="string">&quot;alicechains@example.com&quot;</span>,</span><br><span class="line">        <span class="string">&quot;hashed_password&quot;</span>: <span class="string">&quot;$2b$12$gSvqqUPvlXP2tfVFaWK1Be7DlH.PKZbv5H8KnzzVgXXbVxpva.pFm&quot;</span>,</span><br><span class="line">        <span class="string">&quot;disabled&quot;</span>: <span class="literal">True</span>,</span><br><span class="line">    &#125;,</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Token</span>(<span class="title class_ inherited__">BaseModel</span>):</span><br><span class="line">    access_token: <span class="built_in">str</span></span><br><span class="line">    token_type: <span class="built_in">str</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">TokenData</span>(<span class="title class_ inherited__">BaseModel</span>):</span><br><span class="line">    username: <span class="type">Union</span>[<span class="built_in">str</span>, <span class="literal">None</span>] = <span class="literal">None</span></span><br><span class="line">    scopes: <span class="type">List</span>[<span class="built_in">str</span>] = []</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">User</span>(<span class="title class_ inherited__">BaseModel</span>):</span><br><span class="line">    username: <span class="built_in">str</span></span><br><span class="line">    email: <span class="type">Union</span>[<span class="built_in">str</span>, <span class="literal">None</span>] = <span class="literal">None</span></span><br><span class="line">    full_name: <span class="type">Union</span>[<span class="built_in">str</span>, <span class="literal">None</span>] = <span class="literal">None</span></span><br><span class="line">    disabled: <span class="type">Union</span>[<span class="built_in">bool</span>, <span class="literal">None</span>] = <span class="literal">None</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">UserInDB</span>(<span class="title class_ inherited__">User</span>):</span><br><span class="line">    hashed_password: <span class="built_in">str</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">pwd_context = CryptContext(schemes=[<span class="string">&quot;bcrypt&quot;</span>], deprecated=<span class="string">&quot;auto&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 增加scopes作用域，me和items</span></span><br><span class="line">oauth2_scheme = OAuth2PasswordBearer(</span><br><span class="line">    tokenUrl=<span class="string">&quot;token&quot;</span>,</span><br><span class="line">    scopes=&#123;<span class="string">&quot;me&quot;</span>: <span class="string">&quot;Read information about the current user.&quot;</span>, <span class="string">&quot;items&quot;</span>: <span class="string">&quot;Read items.&quot;</span>&#125;,</span><br><span class="line">)</span><br><span class="line"></span><br><span class="line">app = FastAPI()</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">verify_password</span>(<span class="params">plain_password, hashed_password</span>):</span><br><span class="line">    <span class="keyword">return</span> pwd_context.verify(plain_password, hashed_password)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">get_password_hash</span>(<span class="params">password</span>):</span><br><span class="line">    <span class="keyword">return</span> pwd_context.<span class="built_in">hash</span>(password)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">get_user</span>(<span class="params">db, username: <span class="built_in">str</span></span>):</span><br><span class="line">    <span class="keyword">if</span> username <span class="keyword">in</span> db:</span><br><span class="line">        user_dict = db[username]</span><br><span class="line">        <span class="keyword">return</span> UserInDB(**user_dict)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">authenticate_user</span>(<span class="params">fake_db, username: <span class="built_in">str</span>, password: <span class="built_in">str</span></span>):</span><br><span class="line">    user = get_user(fake_db, username)</span><br><span class="line">    <span class="keyword">if</span> <span class="keyword">not</span> user:</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">False</span></span><br><span class="line">    <span class="keyword">if</span> <span class="keyword">not</span> verify_password(password, user.hashed_password):</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">False</span></span><br><span class="line">    <span class="keyword">return</span> user</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">create_access_token</span>(<span class="params">data: <span class="built_in">dict</span>, expires_delta: <span class="type">Union</span>[timedelta, <span class="literal">None</span>] = <span class="literal">None</span></span>):</span><br><span class="line">    to_encode = data.copy()</span><br><span class="line">    <span class="keyword">if</span> expires_delta:</span><br><span class="line">        expire = datetime.now(timezone.utc) + expires_delta</span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        expire = datetime.now(timezone.utc) + timedelta(minutes=<span class="number">15</span>)</span><br><span class="line">    to_encode.update(&#123;<span class="string">&quot;exp&quot;</span>: expire&#125;)</span><br><span class="line">    encoded_jwt = jwt.encode(to_encode, SECRET_KEY, algorithm=ALGORITHM)</span><br><span class="line">    <span class="keyword">return</span> encoded_jwt</span><br><span class="line"></span><br><span class="line"><span class="comment"># 最底层的依赖项，SecurityScopes类似Request，可直接提取请求中的信息</span></span><br><span class="line"><span class="comment"># SecurityScopes有属性scopes，是作用域列表（scope_str是作用域空格形式连接的字符串）</span></span><br><span class="line"><span class="keyword">async</span> <span class="keyword">def</span> <span class="title function_">get_current_user</span>(<span class="params"></span></span><br><span class="line"><span class="params">    security_scopes: SecurityScopes, token: <span class="built_in">str</span> = Depends(<span class="params">oauth2_scheme</span>)</span></span><br><span class="line"><span class="params"></span>):</span><br><span class="line">    <span class="keyword">if</span> security_scopes.scopes:</span><br><span class="line">        authenticate_value = <span class="string">f&#x27;Bearer scope=&quot;<span class="subst">&#123;security_scopes.scope_str&#125;</span>&quot;&#x27;</span></span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        authenticate_value = <span class="string">&quot;Bearer&quot;</span></span><br><span class="line">    credentials_exception = HTTPException(</span><br><span class="line">        status_code=status.HTTP_401_UNAUTHORIZED,</span><br><span class="line">        detail=<span class="string">&quot;Could not validate credentials&quot;</span>,</span><br><span class="line">        headers=&#123;<span class="string">&quot;WWW-Authenticate&quot;</span>: authenticate_value&#125;,</span><br><span class="line">    )</span><br><span class="line">    <span class="keyword">try</span>:</span><br><span class="line">        payload = jwt.decode(token, SECRET_KEY, algorithms=[ALGORITHM])</span><br><span class="line">        username: <span class="built_in">str</span> = payload.get(<span class="string">&quot;sub&quot;</span>)</span><br><span class="line">        <span class="keyword">if</span> username <span class="keyword">is</span> <span class="literal">None</span>:</span><br><span class="line">            <span class="keyword">raise</span> credentials_exception</span><br><span class="line">        token_scopes = payload.get(<span class="string">&quot;scopes&quot;</span>, [])</span><br><span class="line">        <span class="comment"># 使用TokenData验证数据类型</span></span><br><span class="line">        token_data = TokenData(scopes=token_scopes, username=username)</span><br><span class="line">    <span class="keyword">except</span> (InvalidTokenError, ValidationError):</span><br><span class="line">        <span class="keyword">raise</span> credentials_exception</span><br><span class="line">    user = get_user(fake_users_db, username=token_data.username)</span><br><span class="line">    <span class="keyword">if</span> user <span class="keyword">is</span> <span class="literal">None</span>:</span><br><span class="line">        <span class="keyword">raise</span> credentials_exception</span><br><span class="line">    <span class="comment"># 令牌中的作用域，要在当前路径作用域字符串列表中</span></span><br><span class="line">    <span class="keyword">for</span> scope <span class="keyword">in</span> security_scopes.scopes:</span><br><span class="line">        <span class="keyword">if</span> scope <span class="keyword">not</span> <span class="keyword">in</span> token_data.scopes:</span><br><span class="line">            <span class="keyword">raise</span> HTTPException(</span><br><span class="line">                status_code=status.HTTP_401_UNAUTHORIZED,</span><br><span class="line">                detail=<span class="string">&quot;Not enough permissions&quot;</span>,</span><br><span class="line">                headers=&#123;<span class="string">&quot;WWW-Authenticate&quot;</span>: authenticate_value&#125;,</span><br><span class="line">            )</span><br><span class="line">    <span class="keyword">return</span> user</span><br><span class="line"></span><br><span class="line"><span class="comment"># 子依赖项，也可以有自己的作用域me</span></span><br><span class="line"><span class="keyword">async</span> <span class="keyword">def</span> <span class="title function_">get_current_active_user</span>(<span class="params"></span></span><br><span class="line"><span class="params">    current_user: User = Security(<span class="params">get_current_user, scopes=[<span class="string">&quot;me&quot;</span>]</span>),</span></span><br><span class="line"><span class="params"></span>):</span><br><span class="line">    <span class="keyword">if</span> current_user.disabled:</span><br><span class="line">        <span class="keyword">raise</span> HTTPException(status_code=<span class="number">400</span>, detail=<span class="string">&quot;Inactive user&quot;</span>)</span><br><span class="line">    <span class="keyword">return</span> current_user</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="meta">@app.post(<span class="params"><span class="string">&quot;/token&quot;</span></span>)</span></span><br><span class="line"><span class="comment"># form_data接收作用域scopes</span></span><br><span class="line"><span class="keyword">async</span> <span class="keyword">def</span> <span class="title function_">login_for_access_token</span>(<span class="params"></span></span><br><span class="line"><span class="params">    form_data: OAuth2PasswordRequestForm = Depends(<span class="params"></span>),</span></span><br><span class="line"><span class="params"></span>) -&gt; Token:</span><br><span class="line">    user = authenticate_user(fake_users_db, form_data.username, form_data.password)</span><br><span class="line">    <span class="keyword">if</span> <span class="keyword">not</span> user:</span><br><span class="line">        <span class="keyword">raise</span> HTTPException(status_code=<span class="number">400</span>, detail=<span class="string">&quot;Incorrect username or password&quot;</span>)</span><br><span class="line">    access_token_expires = timedelta(minutes=ACCESS_TOKEN_EXPIRE_MINUTES)</span><br><span class="line">    <span class="comment"># 这里把作用域scopes添加到token中了，注意，实际应把scopes添加到需要该作用域的用户中</span></span><br><span class="line">    access_token = create_access_token(</span><br><span class="line">        data=&#123;<span class="string">&quot;sub&quot;</span>: user.username, <span class="string">&quot;scopes&quot;</span>: form_data.scopes&#125;,</span><br><span class="line">        expires_delta=access_token_expires,</span><br><span class="line">    )</span><br><span class="line">    <span class="keyword">return</span> Token(access_token=access_token, token_type=<span class="string">&quot;bearer&quot;</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="meta">@app.get(<span class="params"><span class="string">&quot;/users/me/&quot;</span>, response_model=User</span>)</span></span><br><span class="line"><span class="keyword">async</span> <span class="keyword">def</span> <span class="title function_">read_users_me</span>(<span class="params">current_user: User = Depends(<span class="params">get_current_active_user</span>)</span>):</span><br><span class="line">    <span class="keyword">return</span> current_user</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="meta">@app.get(<span class="params"><span class="string">&quot;/users/me/items/&quot;</span></span>)</span></span><br><span class="line"><span class="comment"># 想声明路径的作用域，需要Security，它有scopes参数</span></span><br><span class="line"><span class="comment"># Security使用和Depends方式相同，都是依赖注入</span></span><br><span class="line"><span class="comment"># get_current_active_user子依赖可以有自己的依赖项</span></span><br><span class="line"><span class="keyword">async</span> <span class="keyword">def</span> <span class="title function_">read_own_items</span>(<span class="params"></span></span><br><span class="line"><span class="params">    current_user: User = Security(<span class="params">get_current_active_user, scopes=[<span class="string">&quot;items&quot;</span>]</span>),</span></span><br><span class="line"><span class="params"></span>):</span><br><span class="line">    <span class="keyword">return</span> [&#123;<span class="string">&quot;item_id&quot;</span>: <span class="string">&quot;Foo&quot;</span>, <span class="string">&quot;owner&quot;</span>: current_user.username&#125;]</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="meta">@app.get(<span class="params"><span class="string">&quot;/status/&quot;</span></span>)</span></span><br><span class="line"><span class="keyword">async</span> <span class="keyword">def</span> <span class="title function_">read_system_status</span>(<span class="params">current_user: User = Depends(<span class="params">get_current_user</span>)</span>):</span><br><span class="line">    <span class="keyword">return</span> &#123;<span class="string">&quot;status&quot;</span>: <span class="string">&quot;ok&quot;</span>&#125;</span><br></pre></td></tr></table></figure>
<h2 id="http基础授权">HTTP基础授权</h2>
<p>在 HTTP 基础授权中，应用需要请求头包含用户名与密码。<br />
如果没有接收到 HTTP 基础授权，就返回 HTTP 401 "Unauthorized"
错误。<br />
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> fastapi <span class="keyword">import</span> Depends, FastAPI</span><br><span class="line"><span class="keyword">from</span> fastapi.security <span class="keyword">import</span> HTTPBasic, HTTPBasicCredentials</span><br><span class="line"></span><br><span class="line">app = FastAPI()</span><br><span class="line"></span><br><span class="line"><span class="meta">@app.get(<span class="params"><span class="string">&quot;/users/me&quot;</span></span>)</span></span><br><span class="line"><span class="comment"># 使用HTTPBasic()实例接收header中的用户名和密码</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">read_current_user</span>(<span class="params">credentials: HTTPBasicCredentials = Depends(<span class="params">HTTPBasic(<span class="params"></span>)</span>)</span>):</span><br><span class="line">    <span class="keyword">return</span> &#123;<span class="string">&quot;username&quot;</span>: credentials.username, <span class="string">&quot;password&quot;</span>: credentials.password&#125;</span><br></pre></td></tr></table></figure></p>
<p>python的secrets库，检查用户名和密码，能防止时差攻击：<br />
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> secrets</span><br><span class="line"></span><br><span class="line"><span class="keyword">from</span> fastapi <span class="keyword">import</span> Depends, FastAPI, HTTPException, status</span><br><span class="line"><span class="keyword">from</span> fastapi.security <span class="keyword">import</span> HTTPBasic, HTTPBasicCredentials</span><br><span class="line"></span><br><span class="line">app = FastAPI()</span><br><span class="line"></span><br><span class="line">security = HTTPBasic()</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">get_current_username</span>(<span class="params">credentials: HTTPBasicCredentials = Depends(<span class="params">security</span>)</span>):</span><br><span class="line">    current_username_bytes = credentials.username.encode(<span class="string">&quot;utf8&quot;</span>)</span><br><span class="line">    correct_username_bytes = <span class="string">b&quot;stanleyjobson&quot;</span></span><br><span class="line">    is_correct_username = secrets.compare_digest(</span><br><span class="line">        current_username_bytes, correct_username_bytes</span><br><span class="line">    )</span><br><span class="line">    current_password_bytes = credentials.password.encode(<span class="string">&quot;utf8&quot;</span>)</span><br><span class="line">    correct_password_bytes = <span class="string">b&quot;swordfish&quot;</span></span><br><span class="line">    <span class="comment"># 使用secrets的compare_digest来对比密码，防止时差攻击</span></span><br><span class="line">    is_correct_password = secrets.compare_digest(</span><br><span class="line">        current_password_bytes, correct_password_bytes</span><br><span class="line">    )</span><br><span class="line">    <span class="keyword">if</span> <span class="keyword">not</span> (is_correct_username <span class="keyword">and</span> is_correct_password):</span><br><span class="line">        <span class="keyword">raise</span> HTTPException(</span><br><span class="line">            status_code=status.HTTP_401_UNAUTHORIZED,</span><br><span class="line">            detail=<span class="string">&quot;Incorrect username or password&quot;</span>,</span><br><span class="line">            headers=&#123;<span class="string">&quot;WWW-Authenticate&quot;</span>: <span class="string">&quot;Basic&quot;</span>&#125;,</span><br><span class="line">        )</span><br><span class="line">    <span class="keyword">return</span> credentials.username</span><br><span class="line"></span><br><span class="line"><span class="meta">@app.get(<span class="params"><span class="string">&quot;/users/me&quot;</span></span>)</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">read_current_user</span>(<span class="params">username: <span class="built_in">str</span> = Depends(<span class="params">get_current_username</span>)</span>):</span><br><span class="line">    <span class="keyword">return</span> &#123;<span class="string">&quot;username&quot;</span>: username&#125;</span><br></pre></td></tr></table></figure></p>
<h1 id="中间件">中间件</h1>
<p>中间件是一个函数，它在每个<strong>请求</strong>被路由处理之前、以及每个<strong>响应</strong>返回之前调用。</p>
<p>1.中间件示例<br />
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> time</span><br><span class="line"><span class="keyword">from</span> fastapi <span class="keyword">import</span> FastAPI, Request</span><br><span class="line"></span><br><span class="line">app = FastAPI()</span><br><span class="line"></span><br><span class="line"><span class="meta">@app.middleware(<span class="params"><span class="string">&quot;http&quot;</span></span>)</span></span><br><span class="line"><span class="keyword">async</span> <span class="keyword">def</span> <span class="title function_">add_process_time_header</span>(<span class="params">request: Request, call_next</span>):</span><br><span class="line">    <span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">    计算请求处理耗时，并将结果添加到响应头中</span></span><br><span class="line"><span class="string">    &quot;&quot;&quot;</span></span><br><span class="line">    start_time = time.time()</span><br><span class="line">    <span class="comment"># 调用下一个中间件或路由处理函数</span></span><br><span class="line">    response = <span class="keyword">await</span> call_next(request)</span><br><span class="line">    process_time = time.time() - start_time</span><br><span class="line">    response.headers[<span class="string">&quot;X-Process-Time&quot;</span>] = <span class="built_in">str</span>(process_time)</span><br><span class="line">    <span class="keyword">return</span> response</span><br></pre></td></tr></table></figure></p>
<p>CORS指浏览器中运行的前端拥有与后端通信的 JavaScript
代码，而后端处于与前端不同的「源」的情况。<br />
源是<strong>协议</strong>（http，https）、<strong>域</strong>（myapp.com，localhost）以及<strong>端口</strong>（80、443、8080）的组合。它们必须完全匹配才能被视为相同的源。即使它们都在
localhost
中，但是它们使用不同的协议或者端口，所以它们都是不同的「源」。<br />
2.CORS跨域资源共享中间件，后端添加一个「允许的源」列表，保证前后端能正常通信：<br />
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> fastapi <span class="keyword">import</span> FastAPI</span><br><span class="line"><span class="keyword">from</span> fastapi.middleware.cors <span class="keyword">import</span> CORSMiddleware</span><br><span class="line"></span><br><span class="line">app = FastAPI()</span><br><span class="line"></span><br><span class="line">origins = [</span><br><span class="line">    <span class="string">&quot;http://localhost:80&quot;</span>,</span><br><span class="line">    <span class="string">&#x27;http://127.0.0.1:80&#x27;</span>,</span><br><span class="line">    <span class="string">&quot;http://localhost:8080&quot;</span>,</span><br><span class="line">]</span><br><span class="line"></span><br><span class="line"><span class="comment"># &quot;allow_origins&quot;: 允许跨域请求的源列表，[&#x27;*&#x27;] 允许任何源。</span></span><br><span class="line"><span class="comment"># &quot;allow_origin_regex&quot;: 允许跨域请求的正则表达式。</span></span><br><span class="line"><span class="comment"># &quot;allow_credentials&quot;: 是否允许发送Cookie，默认False，若为True，则allow_origins不能设定为[&#x27;*&#x27;]，必须指定源。</span></span><br><span class="line"><span class="comment"># &quot;allow_methods&quot;: 允许跨域请求的请求的 HTTP 方法列表，默认为 [&#x27;GET&#x27;]，[&#x27;*&#x27;] 允许任何方法。</span></span><br><span class="line"><span class="comment"># &quot;allow_headers&quot;: 允许跨域请求的 HTTP 请求头列表，默认为 []，[&#x27;*&#x27;] 允许任何请求头。</span></span><br><span class="line"><span class="comment"># &quot;expose_headers&quot;: 指示可以被浏览器访问的响应头，默认为 []。</span></span><br><span class="line">app.add_middleware(</span><br><span class="line">    CORSMiddleware,</span><br><span class="line">    allow_origins=origins,</span><br><span class="line">    allow_credentials=<span class="literal">True</span>,</span><br><span class="line">    allow_methods=[<span class="string">&quot;*&quot;</span>],</span><br><span class="line">    allow_headers=[<span class="string">&quot;*&quot;</span>],</span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="meta">@app.get(<span class="params"><span class="string">&quot;/&quot;</span></span>)</span></span><br><span class="line"><span class="keyword">async</span> <span class="keyword">def</span> <span class="title function_">main</span>():</span><br><span class="line">    <span class="keyword">return</span> &#123;<span class="string">&quot;message&quot;</span>: <span class="string">&quot;Hello World&quot;</span>&#125;</span><br></pre></td></tr></table></figure></p>
<h1 id="高级中间件">高级中间件</h1>
<p>FaskAPI中集成了一些中间件，方便开发者使用，但绝大多数可用的中间件都直接继承自
Starlette。<br />
1.HTTPSRedirectMiddleware：<br />
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> fastapi <span class="keyword">import</span> FastAPI</span><br><span class="line"><span class="keyword">from</span> fastapi.middleware.httpsredirect <span class="keyword">import</span> HTTPSRedirectMiddleware</span><br><span class="line"></span><br><span class="line">app = FastAPI()</span><br><span class="line"><span class="comment"># 强制所有传入请求必须是 https 或 wss。</span></span><br><span class="line"><span class="comment"># 任何传向 http 或 ws 的请求都会被重定向至安全方案。</span></span><br><span class="line">app.add_middleware(HTTPSRedirectMiddleware)</span><br><span class="line"></span><br><span class="line"><span class="meta">@app.get(<span class="params"><span class="string">&quot;/&quot;</span></span>)</span></span><br><span class="line"><span class="keyword">async</span> <span class="keyword">def</span> <span class="title function_">main</span>():</span><br><span class="line">    <span class="keyword">return</span> &#123;<span class="string">&quot;message&quot;</span>: <span class="string">&quot;Hello World&quot;</span>&#125;</span><br></pre></td></tr></table></figure></p>
<p>2.TrustedHostMiddleware：<br />
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> fastapi <span class="keyword">import</span> FastAPI</span><br><span class="line"><span class="keyword">from</span> fastapi.middleware.trustedhost <span class="keyword">import</span> TrustedHostMiddleware</span><br><span class="line"></span><br><span class="line">app = FastAPI()</span><br><span class="line"></span><br><span class="line"><span class="comment"># 强制所有传入请求都必须正确设置 Host 请求头，以防 HTTP 主机头攻击。</span></span><br><span class="line"><span class="comment"># allowed_hosts：允许的域名（主机名）列表。</span></span><br><span class="line"><span class="comment"># *.example.com 等通配符域名可以匹配子域名，或使用 allowed_hosts=[&quot;*&quot;] 允许任意主机名，或省略中间件。</span></span><br><span class="line">app.add_middleware(</span><br><span class="line">    TrustedHostMiddleware, allowed_hosts=[<span class="string">&quot;example.com&quot;</span>, <span class="string">&quot;*.example.com&quot;</span>]</span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="meta">@app.get(<span class="params"><span class="string">&quot;/&quot;</span></span>)</span></span><br><span class="line"><span class="keyword">async</span> <span class="keyword">def</span> <span class="title function_">main</span>():</span><br><span class="line">    <span class="keyword">return</span> &#123;<span class="string">&quot;message&quot;</span>: <span class="string">&quot;Hello World&quot;</span>&#125;</span><br></pre></td></tr></table></figure></p>
<p>3.GZipMiddleware：<br />
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> fastapi <span class="keyword">import</span> FastAPI</span><br><span class="line"><span class="keyword">from</span> fastapi.middleware.gzip <span class="keyword">import</span> GZipMiddleware</span><br><span class="line"></span><br><span class="line">app = FastAPI()</span><br><span class="line"></span><br><span class="line"><span class="comment"># 处理 Accept-Encoding 请求头中包含 gzip 请求的 GZip 响应。</span></span><br><span class="line"><span class="comment"># 中间件会处理标准响应与流响应。</span></span><br><span class="line"><span class="comment"># minimum_size：小于最小字节的响应不使用 GZip。 默认值是 500。</span></span><br><span class="line">app.add_middleware(GZipMiddleware, minimum_size=<span class="number">1000</span>, compresslevel=<span class="number">5</span>)</span><br><span class="line"></span><br><span class="line"><span class="meta">@app.get(<span class="params"><span class="string">&quot;/&quot;</span></span>)</span></span><br><span class="line"><span class="keyword">async</span> <span class="keyword">def</span> <span class="title function_">main</span>():</span><br><span class="line">    <span class="keyword">return</span> <span class="string">&quot;somebigcontent&quot;</span></span><br></pre></td></tr></table></figure></p>
<h1 id="子路由">子路由</h1>
<p>子路由，可以为大型项目构建提供遍历，按照功能模块划分，将不同模块的API放在不同的文件中，再统一导入到主文件中，最后统一注册到FastAPI实例中。<br />
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">.</span><br><span class="line">├── app</span><br><span class="line">│   ├── __init__.py</span><br><span class="line">│   ├── main.py</span><br><span class="line">│   ├── dependencies.py</span><br><span class="line">│   └── routers <span class="comment"># 子路由</span></span><br><span class="line">│   │   ├── __init__.py</span><br><span class="line">│   │   ├── items.py</span><br><span class="line">│   │   └── users.py</span><br><span class="line">│   └── internal</span><br><span class="line">│       ├── __init__.py</span><br><span class="line">│       └── admin.py</span><br></pre></td></tr></table></figure></p>
<p>1.子路由的使用，和主路由一样：<br />
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> fastapi <span class="keyword">import</span> APIRouter <span class="comment"># 子路由</span></span><br><span class="line"><span class="keyword">from</span> fastapi <span class="keyword">import</span> Depends</span><br><span class="line"><span class="keyword">from</span> ..dependencies <span class="keyword">import</span> get_token_header</span><br><span class="line"></span><br><span class="line">router = APIRouter(</span><br><span class="line">    prefix=<span class="string">&quot;/items&quot;</span>, <span class="comment"># 子路由前缀</span></span><br><span class="line">    tags=[<span class="string">&quot;items&quot;</span>], <span class="comment"># 子路由标签</span></span><br><span class="line">    dependencies=[Depends(get_token_header)],</span><br><span class="line">    responses=&#123;<span class="number">404</span>: &#123;<span class="string">&quot;description&quot;</span>: <span class="string">&quot;Not found&quot;</span>&#125;&#125;,</span><br><span class="line">) <span class="comment"># 创建子路由</span></span><br><span class="line"></span><br><span class="line"><span class="meta">@router.get(<span class="params"><span class="string">&quot;/users/&quot;</span>, tags=[<span class="string">&quot;users&quot;</span>]</span>)</span></span><br><span class="line"><span class="keyword">async</span> <span class="keyword">def</span> <span class="title function_">read_users</span>():</span><br><span class="line">    <span class="keyword">return</span> [&#123;<span class="string">&quot;username&quot;</span>: <span class="string">&quot;Rick&quot;</span>&#125;, &#123;<span class="string">&quot;username&quot;</span>: <span class="string">&quot;Morty&quot;</span>&#125;]</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="meta">@router.get(<span class="params"><span class="string">&quot;/users/me&quot;</span>, tags=[<span class="string">&quot;users&quot;</span>]</span>)</span></span><br><span class="line"><span class="keyword">async</span> <span class="keyword">def</span> <span class="title function_">read_user_me</span>():</span><br><span class="line">    <span class="keyword">return</span> &#123;<span class="string">&quot;username&quot;</span>: <span class="string">&quot;fakecurrentuser&quot;</span>&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="meta">@router.get(<span class="params"><span class="string">&quot;/users/&#123;username&#125;&quot;</span>, tags=[<span class="string">&quot;users&quot;</span>]</span>)</span></span><br><span class="line"><span class="keyword">async</span> <span class="keyword">def</span> <span class="title function_">read_user</span>(<span class="params">username: <span class="built_in">str</span></span>):</span><br><span class="line">    <span class="keyword">return</span> &#123;<span class="string">&quot;username&quot;</span>: username&#125;</span><br></pre></td></tr></table></figure></p>
<p>2.主路由中，注册子路由：<br />
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> fastapi <span class="keyword">import</span> Depends, FastAPI</span><br><span class="line"><span class="keyword">from</span> .dependencies <span class="keyword">import</span> get_query_token, get_token_header</span><br><span class="line"><span class="keyword">from</span> .internal <span class="keyword">import</span> admin</span><br><span class="line"><span class="keyword">from</span> .routers <span class="keyword">import</span> items, users</span><br><span class="line"></span><br><span class="line">app = FastAPI(dependencies=[Depends(get_query_token)]) <span class="comment"># 主路由</span></span><br><span class="line"></span><br><span class="line">app.include_router(users.router) <span class="comment"># 主路由注册子路由</span></span><br><span class="line">app.include_router(items.router) <span class="comment"># 主路由注册子路由</span></span><br><span class="line">app.include_router(</span><br><span class="line">    admin.router,</span><br><span class="line">    prefix=<span class="string">&quot;/admin&quot;</span>,</span><br><span class="line">    tags=[<span class="string">&quot;admin&quot;</span>],</span><br><span class="line">    dependencies=[Depends(get_token_header)],</span><br><span class="line">    responses=&#123;<span class="number">418</span>: &#123;<span class="string">&quot;description&quot;</span>: <span class="string">&quot;I&#x27;m a teapot&quot;</span>&#125;&#125;,</span><br><span class="line">) <span class="comment"># 主路由注册子路由</span></span><br><span class="line"></span><br><span class="line"><span class="meta">@app.get(<span class="params"><span class="string">&quot;/&quot;</span></span>)</span></span><br><span class="line"><span class="keyword">async</span> <span class="keyword">def</span> <span class="title function_">root</span>():</span><br><span class="line">    <span class="keyword">return</span> &#123;<span class="string">&quot;message&quot;</span>: <span class="string">&quot;Hello Bigger Applications!&quot;</span>&#125;</span><br></pre></td></tr></table></figure></p>
<h1 id="后台任务">后台任务</h1>
<p>有时会遇到需要在请求处理完成后执行一些任务的情况，比如发送邮件、清理缓存等。FastAPI
提供了 BackgroundTasks 类来处理这种情况。<br />
注意，若后台任务非常复杂和繁重，应当选择专用的"异步任务队列"，如Celery，再配合一个"消息代理"（），如RabbitMQ。<br />
Celery：管理分配任务到不同的服务器，并取得结果。不管和服务器之间的通信。<br />
RabbitMQ：消息代理，用于Celery和服务器之间的通信。</p>
<p>1.比如收到的文件必须经过一个缓慢的过程，可以先返回一个"Accepted"(HTTP
202)响应，并在后台处理这个任务。<br />
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> fastapi <span class="keyword">import</span> BackgroundTasks, FastAPI </span><br><span class="line"></span><br><span class="line">app = FastAPI()</span><br><span class="line"></span><br><span class="line"><span class="comment"># 定义一个后台任务函数，可以是async或非async，这里写入不需要async和await，所以是非async。</span></span><br><span class="line"><span class="comment"># write_notification模拟发送电子邮件，在send_notification的响应返回后执行</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">write_notification</span>(<span class="params">email: <span class="built_in">str</span>, message=<span class="string">&quot;&quot;</span></span>):</span><br><span class="line">    <span class="keyword">with</span> <span class="built_in">open</span>(<span class="string">&quot;log.txt&quot;</span>, mode=<span class="string">&quot;w&quot;</span>) <span class="keyword">as</span> email_file:</span><br><span class="line">        content = <span class="string">f&quot;notification for <span class="subst">&#123;email&#125;</span>: <span class="subst">&#123;message&#125;</span>&quot;</span></span><br><span class="line">        email_file.write(content)</span><br><span class="line"></span><br><span class="line"><span class="meta">@app.post(<span class="params"><span class="string">&quot;/send-notification/&#123;email&#125;&quot;</span></span>)</span></span><br><span class="line"><span class="comment"># 使用类型声明 BackgroundTasks，FastAPI 会创建一个该类型的对象并传给指定参数。</span></span><br><span class="line"><span class="keyword">async</span> <span class="keyword">def</span> <span class="title function_">send_notification</span>(<span class="params">email: <span class="built_in">str</span>, background_tasks: BackgroundTasks</span>):</span><br><span class="line">    <span class="comment"># 添加后台任务，参数是&quot;后台任务函数&quot;和&quot;任务函数的多个参数&quot;</span></span><br><span class="line">    background_tasks.add_task(write_notification, email, message=<span class="string">&quot;some notification&quot;</span>)</span><br><span class="line">    <span class="keyword">return</span> &#123;<span class="string">&quot;message&quot;</span>: <span class="string">&quot;Notification sent in the background&quot;</span>&#125;</span><br></pre></td></tr></table></figure></p>
<p>2.依赖注入中也能使用BackgroundTasks：<br />
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> fastapi <span class="keyword">import</span> BackgroundTasks, Depends, FastAPI</span><br><span class="line"></span><br><span class="line">app = FastAPI()</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">write_log</span>(<span class="params">message: <span class="built_in">str</span></span>):</span><br><span class="line">    <span class="keyword">with</span> <span class="built_in">open</span>(<span class="string">&quot;log.txt&quot;</span>, mode=<span class="string">&quot;a&quot;</span>) <span class="keyword">as</span> log:</span><br><span class="line">        log.write(message)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 依赖中使用BackgroundTasks，信息会在响应发出 之后 被写到 log.txt 文件。</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">get_query</span>(<span class="params">background_tasks: BackgroundTasks, q: <span class="built_in">str</span> | <span class="literal">None</span> = <span class="literal">None</span></span>):</span><br><span class="line">    <span class="keyword">if</span> q:</span><br><span class="line">        message = <span class="string">f&quot;found query: <span class="subst">&#123;q&#125;</span>\n&quot;</span></span><br><span class="line">        background_tasks.add_task(write_log, message)</span><br><span class="line">    <span class="keyword">return</span> q</span><br><span class="line"></span><br><span class="line"><span class="meta">@app.post(<span class="params"><span class="string">&quot;/send-notification/&#123;email&#125;&quot;</span></span>)</span></span><br><span class="line"><span class="keyword">async</span> <span class="keyword">def</span> <span class="title function_">send_notification</span>(<span class="params">email: <span class="built_in">str</span>, background_tasks: BackgroundTasks, q: <span class="built_in">str</span> = Depends(<span class="params">get_query</span>)</span>):</span><br><span class="line">    message = <span class="string">f&quot;message to <span class="subst">&#123;email&#125;</span>\n&quot;</span></span><br><span class="line">    background_tasks.add_task(write_log, message)</span><br><span class="line">    <span class="keyword">return</span> &#123;<span class="string">&quot;message&quot;</span>: <span class="string">&quot;Message sent&quot;</span>&#125;</span><br></pre></td></tr></table></figure></p>
<h1 id="静态文件">静态文件</h1>
<p>可以使用 StaticFiles 从目录中自动提供静态文件。</p>
<p>1.使用 StaticFiles
创建一个静态文件路径实例，并挂载（Mount）到app上：<br />
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> fastapi <span class="keyword">import</span> FastAPI</span><br><span class="line"><span class="keyword">from</span> fastapi.staticfiles <span class="keyword">import</span> StaticFiles</span><br><span class="line"></span><br><span class="line">app = FastAPI()</span><br><span class="line"></span><br><span class="line"><span class="comment"># 创建一个 StaticFiles 实例，并指定静态文件目录为 &quot;static&quot;，挂载到 &quot;/static&quot; 路径下</span></span><br><span class="line"><span class="comment"># name=&quot;static&quot; 是可选的，用于在 FastAPI 应用中引用这个 StaticFiles 实例</span></span><br><span class="line">app.mount(<span class="string">&quot;/static&quot;</span>, StaticFiles(directory=<span class="string">&quot;static&quot;</span>), name=<span class="string">&quot;static&quot;</span>)</span><br></pre></td></tr></table></figure></p>
<h1 id="挂载子应用">挂载子应用</h1>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> fastapi <span class="keyword">import</span> FastAPI</span><br><span class="line"></span><br><span class="line"><span class="comment"># 顶层应用</span></span><br><span class="line">app = FastAPI()</span><br><span class="line"></span><br><span class="line"><span class="meta">@app.get(<span class="params"><span class="string">&quot;/app&quot;</span></span>)</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">read_main</span>():</span><br><span class="line">    <span class="keyword">return</span> &#123;<span class="string">&quot;message&quot;</span>: <span class="string">&quot;Hello World from main app&quot;</span>&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment"># 子应用</span></span><br><span class="line">subapi = FastAPI()</span><br><span class="line"></span><br><span class="line"><span class="meta">@subapi.get(<span class="params"><span class="string">&quot;/sub&quot;</span></span>)</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">read_sub</span>():</span><br><span class="line">    <span class="keyword">return</span> &#123;<span class="string">&quot;message&quot;</span>: <span class="string">&quot;Hello World from sub API&quot;</span>&#125;</span><br><span class="line"><span class="comment"># 挂载子应用到/subapi</span></span><br><span class="line"><span class="comment"># 通过/subapi/sub访问上面get(&quot;/sub&quot;)的接口</span></span><br><span class="line">app.mount(<span class="string">&quot;/subapi&quot;</span>, subapi)</span><br></pre></td></tr></table></figure>
<h1 id="直接使用请求">直接使用请求</h1>
<p>1.有些时候需要直接从 Request
对象提取数据，比如获取客户端IP和端口：<br />
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> fastapi <span class="keyword">import</span> FastAPI, Request</span><br><span class="line"></span><br><span class="line">app = FastAPI()</span><br><span class="line"></span><br><span class="line"><span class="meta">@app.get(<span class="params"><span class="string">&quot;/items/&#123;item_id&#125;&quot;</span></span>)</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">read_root</span>(<span class="params">item_id: <span class="built_in">str</span>, request: Request</span>):</span><br><span class="line">    client_host = request.client.host <span class="comment"># 获取客户端IP</span></span><br><span class="line">    client_port = request.client.port <span class="comment"># 虎丘客户端端口</span></span><br><span class="line">    <span class="keyword">return</span> &#123;<span class="string">&quot;client_host&quot;</span>: client_host, <span class="string">&quot;item_id&quot;</span>: item_id, <span class="string">&quot;client_port&quot;</span>: client_port&#125;</span><br></pre></td></tr></table></figure></p>
<h1 id="模板引擎">模板引擎</h1>
<p>1.使用Jinja2模板引擎，需要安装<code>pip install jinja2</code>，导入Jinja2Templates：<br />
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> fastapi <span class="keyword">import</span> FastAPI, Request</span><br><span class="line"><span class="keyword">from</span> fastapi.responses <span class="keyword">import</span> HTMLResponse</span><br><span class="line"><span class="keyword">from</span> fastapi.staticfiles <span class="keyword">import</span> StaticFiles</span><br><span class="line"><span class="keyword">from</span> fastapi.templating <span class="keyword">import</span> Jinja2Templates</span><br><span class="line"></span><br><span class="line">app = FastAPI()</span><br><span class="line"><span class="comment"># 创建静态文件挂载点</span></span><br><span class="line">app.mount(<span class="string">&quot;/static&quot;</span>, StaticFiles(directory=<span class="string">&quot;static&quot;</span>), name=<span class="string">&quot;static&quot;</span>)</span><br><span class="line"><span class="comment"># 创建模板渲染器</span></span><br><span class="line">templates = Jinja2Templates(directory=<span class="string">&quot;templates&quot;</span>)</span><br><span class="line"><span class="comment"># 定义一个HTML模板文件item.html，放在templates目录下</span></span><br><span class="line"><span class="meta">@app.get(<span class="params"><span class="string">&quot;/items/&#123;id&#125;&quot;</span>, response_class=HTMLResponse</span>) </span><span class="comment"># response_class指定后，API文档能识别响应对象是HTML</span></span><br><span class="line"><span class="keyword">async</span> <span class="keyword">def</span> <span class="title function_">read_item</span>(<span class="params">request: Request, <span class="built_in">id</span>: <span class="built_in">str</span></span>): <span class="comment"># 在返回模板的路径操作中声明 Request 参数</span></span><br><span class="line">    <span class="comment"># 使用 templates 渲染并返回 TemplateResponse</span></span><br><span class="line">    <span class="comment"># 传递模板的名称、request对象以及一个包含多个键值对（用于Jinja2模板）的&quot;context&quot;字典，</span></span><br><span class="line">    <span class="keyword">return</span> templates.TemplateResponse(request=request, name=<span class="string">&quot;item.html&quot;</span>, context=&#123;<span class="string">&quot;id&quot;</span>: <span class="built_in">id</span>&#125;)</span><br></pre></td></tr></table></figure></p>
<p>编写模板：<br />
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">html</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">title</span>&gt;</span>Item Details<span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- url_for()参数和路径函数的参数相同 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">link</span> <span class="attr">href</span>=<span class="string">&quot;&#123;&#123; url_for(&#x27;static&#x27;, path=&#x27;/styles.css&#x27;) &#125;&#125;&quot;</span> <span class="attr">rel</span>=<span class="string">&quot;stylesheet&quot;</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- &#123;&#123; id &#125;&#125; 会显示从context字典传递的id值 --&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- url_for(&#x27;read_item&#x27;, id=id) 生成read_item(id=id)函数url相同的连接，比如id=42时，herf=&quot;/items/42&quot; --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">h1</span>&gt;</span><span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">&quot;&#123;&#123; url_for(&#x27;read_item&#x27;, id=id) &#125;&#125;&quot;</span>&gt;</span>Item ID: &#123;&#123; id &#125;&#125;<span class="tag">&lt;/<span class="name">a</span>&gt;</span><span class="tag">&lt;/<span class="name">h1</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure></p>
<h1 id="websockets通信">WebSockets通信</h1>
<p>需要安装<code>pip install websockets</code>。</p>
<p>1.使用现代框架（如React、Vue.js或Angular）创建了一个前端，要使用
WebSockets 与后端进行通信。<br />
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> fastapi <span class="keyword">import</span> FastAPI, WebSocket <span class="comment"># WebSocket通信</span></span><br><span class="line"><span class="keyword">from</span> fastapi.responses <span class="keyword">import</span> HTMLResponse</span><br><span class="line"></span><br><span class="line">app = FastAPI()</span><br><span class="line"></span><br><span class="line">html = <span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">&lt;!DOCTYPE html&gt;</span></span><br><span class="line"><span class="string">&lt;html&gt;</span></span><br><span class="line"><span class="string">    &lt;head&gt;</span></span><br><span class="line"><span class="string">        &lt;title&gt;Chat&lt;/title&gt;</span></span><br><span class="line"><span class="string">    &lt;/head&gt;</span></span><br><span class="line"><span class="string">    &lt;body&gt;</span></span><br><span class="line"><span class="string">        &lt;h1&gt;WebSocket Chat&lt;/h1&gt;</span></span><br><span class="line"><span class="string">        &lt;form action=&quot;&quot; onsubmit=&quot;sendMessage(event)&quot;&gt;</span></span><br><span class="line"><span class="string">            &lt;input type=&quot;text&quot; id=&quot;messageText&quot; autocomplete=&quot;off&quot;/&gt;</span></span><br><span class="line"><span class="string">            &lt;button&gt;Send&lt;/button&gt;</span></span><br><span class="line"><span class="string">        &lt;/form&gt;</span></span><br><span class="line"><span class="string">        # 创建一个messages列表</span></span><br><span class="line"><span class="string">        &lt;ul id=&#x27;messages&#x27;&gt;</span></span><br><span class="line"><span class="string">        &lt;/ul&gt;</span></span><br><span class="line"><span class="string">        &lt;script&gt;</span></span><br><span class="line"><span class="string">            var ws = new WebSocket(&quot;ws://localhost:8000/ws&quot;);</span></span><br><span class="line"><span class="string">            # 接收后端返回的数据，放入messages列表</span></span><br><span class="line"><span class="string">            ws.onmessage = function(event) &#123;</span></span><br><span class="line"><span class="string">                var messages = document.getElementById(&#x27;messages&#x27;)</span></span><br><span class="line"><span class="string">                var message = document.createElement(&#x27;li&#x27;)</span></span><br><span class="line"><span class="string">                var content = document.createTextNode(event.data)</span></span><br><span class="line"><span class="string">                message.appendChild(content)</span></span><br><span class="line"><span class="string">                messages.appendChild(message)</span></span><br><span class="line"><span class="string">            &#125;;</span></span><br><span class="line"><span class="string">            # 发送数据</span></span><br><span class="line"><span class="string">            function sendMessage(event) &#123;</span></span><br><span class="line"><span class="string">                var input = document.getElementById(&quot;messageText&quot;)</span></span><br><span class="line"><span class="string">                ws.send(input.value)</span></span><br><span class="line"><span class="string">                input.value = &#x27;&#x27;</span></span><br><span class="line"><span class="string">                event.preventDefault()</span></span><br><span class="line"><span class="string">            &#125;</span></span><br><span class="line"><span class="string">        &lt;/script&gt;</span></span><br><span class="line"><span class="string">    &lt;/body&gt;</span></span><br><span class="line"><span class="string">&lt;/html&gt;</span></span><br><span class="line"><span class="string">&quot;&quot;&quot;</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="meta">@app.get(<span class="params"><span class="string">&quot;/&quot;</span></span>)</span></span><br><span class="line"><span class="keyword">async</span> <span class="keyword">def</span> <span class="title function_">get</span>():</span><br><span class="line">    <span class="keyword">return</span> HTMLResponse(html)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 创建一个 websocket</span></span><br><span class="line"><span class="meta">@app.websocket(<span class="params"><span class="string">&quot;/ws&quot;</span></span>)</span></span><br><span class="line"><span class="keyword">async</span> <span class="keyword">def</span> <span class="title function_">websocket_endpoint</span>(<span class="params">websocket: WebSocket</span>):</span><br><span class="line">    <span class="keyword">await</span> websocket.accept() <span class="comment"># 等待消息</span></span><br><span class="line">    <span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line">        data = <span class="keyword">await</span> websocket.receive_text() <span class="comment"># 接收消息</span></span><br><span class="line">        <span class="comment"># 可以接收和发送二进制、文本和 JSON 数据</span></span><br><span class="line">        <span class="keyword">await</span> websocket.send_text(<span class="string">f&quot;Message text was: <span class="subst">&#123;data&#125;</span>&quot;</span>) <span class="comment"># 发送消息</span></span><br></pre></td></tr></table></figure></p>
<p>2.WebSockets支持使用依赖项：<br />
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> fastapi <span class="keyword">import</span> Cookie, Depends, FastAPI, Query, WebSocket, WebSocketException, status</span><br><span class="line"><span class="keyword">from</span> fastapi.responses <span class="keyword">import</span> HTMLResponse</span><br><span class="line"></span><br><span class="line">app = FastAPI()</span><br><span class="line"></span><br><span class="line">html = <span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">&lt;!DOCTYPE html&gt;</span></span><br><span class="line"><span class="string">&lt;html&gt;</span></span><br><span class="line"><span class="string">    &lt;head&gt;</span></span><br><span class="line"><span class="string">        &lt;title&gt;Chat&lt;/title&gt;</span></span><br><span class="line"><span class="string">    &lt;/head&gt;</span></span><br><span class="line"><span class="string">    &lt;body&gt;</span></span><br><span class="line"><span class="string">        &lt;h1&gt;WebSocket Chat&lt;/h1&gt;</span></span><br><span class="line"><span class="string">        &lt;form action=&quot;&quot; onsubmit=&quot;sendMessage(event)&quot;&gt;</span></span><br><span class="line"><span class="string">            &lt;label&gt;Item ID: &lt;input type=&quot;text&quot; id=&quot;itemId&quot; autocomplete=&quot;off&quot; value=&quot;foo&quot;/&gt;&lt;/label&gt;</span></span><br><span class="line"><span class="string">            &lt;label&gt;Token: &lt;input type=&quot;text&quot; id=&quot;token&quot; autocomplete=&quot;off&quot; value=&quot;some-key-token&quot;/&gt;&lt;/label&gt;</span></span><br><span class="line"><span class="string">            &lt;button onclick=&quot;connect(event)&quot;&gt;Connect&lt;/button&gt;</span></span><br><span class="line"><span class="string">            &lt;hr&gt;</span></span><br><span class="line"><span class="string">            &lt;label&gt;Message: &lt;input type=&quot;text&quot; id=&quot;messageText&quot; autocomplete=&quot;off&quot;/&gt;&lt;/label&gt;</span></span><br><span class="line"><span class="string">            &lt;button&gt;Send&lt;/button&gt;</span></span><br><span class="line"><span class="string">        &lt;/form&gt;</span></span><br><span class="line"><span class="string">        &lt;ul id=&#x27;messages&#x27;&gt;</span></span><br><span class="line"><span class="string">        &lt;/ul&gt;</span></span><br><span class="line"><span class="string">        &lt;script&gt;</span></span><br><span class="line"><span class="string">        var ws = null;</span></span><br><span class="line"><span class="string">            function connect(event) &#123;</span></span><br><span class="line"><span class="string">                var itemId = document.getElementById(&quot;itemId&quot;)</span></span><br><span class="line"><span class="string">                var token = document.getElementById(&quot;token&quot;)</span></span><br><span class="line"><span class="string">                ws = new WebSocket(&quot;ws://localhost:8000/items/&quot; + itemId.value + &quot;/ws?token=&quot; + token.value);</span></span><br><span class="line"><span class="string">                ws.onmessage = function(event) &#123;</span></span><br><span class="line"><span class="string">                    var messages = document.getElementById(&#x27;messages&#x27;)</span></span><br><span class="line"><span class="string">                    var message = document.createElement(&#x27;li&#x27;)</span></span><br><span class="line"><span class="string">                    var content = document.createTextNode(event.data)</span></span><br><span class="line"><span class="string">                    message.appendChild(content)</span></span><br><span class="line"><span class="string">                    messages.appendChild(message)</span></span><br><span class="line"><span class="string">                &#125;;</span></span><br><span class="line"><span class="string">                event.preventDefault()</span></span><br><span class="line"><span class="string">            &#125;</span></span><br><span class="line"><span class="string">            function sendMessage(event) &#123;</span></span><br><span class="line"><span class="string">                var input = document.getElementById(&quot;messageText&quot;)</span></span><br><span class="line"><span class="string">                ws.send(input.value)</span></span><br><span class="line"><span class="string">                input.value = &#x27;&#x27;</span></span><br><span class="line"><span class="string">                event.preventDefault()</span></span><br><span class="line"><span class="string">            &#125;</span></span><br><span class="line"><span class="string">        &lt;/script&gt;</span></span><br><span class="line"><span class="string">    &lt;/body&gt;</span></span><br><span class="line"><span class="string">&lt;/html&gt;</span></span><br><span class="line"><span class="string">&quot;&quot;&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="meta">@app.get(<span class="params"><span class="string">&quot;/&quot;</span></span>)</span></span><br><span class="line"><span class="keyword">async</span> <span class="keyword">def</span> <span class="title function_">get</span>():</span><br><span class="line">    <span class="keyword">return</span> HTMLResponse(html)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 子依赖</span></span><br><span class="line"><span class="keyword">async</span> <span class="keyword">def</span> <span class="title function_">get_cookie_or_token</span>(<span class="params"></span></span><br><span class="line"><span class="params">    websocket: WebSocket,  <span class="comment"># 也接收websocket</span></span></span><br><span class="line"><span class="params">    session: <span class="built_in">str</span> | <span class="literal">None</span> = Cookie(<span class="params">default=<span class="literal">None</span></span>),</span></span><br><span class="line"><span class="params">    token: <span class="built_in">str</span> | <span class="literal">None</span> = Query(<span class="params">default=<span class="literal">None</span></span>),</span></span><br><span class="line"><span class="params"></span>):</span><br><span class="line">    <span class="keyword">if</span> session <span class="keyword">is</span> <span class="literal">None</span> <span class="keyword">and</span> token <span class="keyword">is</span> <span class="literal">None</span>:</span><br><span class="line">        <span class="keyword">raise</span> WebSocketException(code=status.WS_1008_POLICY_VIOLATION)</span><br><span class="line">    <span class="keyword">return</span> session <span class="keyword">or</span> token</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="meta">@app.websocket(<span class="params"><span class="string">&quot;/items/&#123;item_id&#125;/ws&quot;</span></span>)</span></span><br><span class="line"><span class="keyword">async</span> <span class="keyword">def</span> <span class="title function_">websocket_endpoint</span>(<span class="params"></span></span><br><span class="line"><span class="params">    websocket: WebSocket,</span></span><br><span class="line"><span class="params">    item_id: <span class="built_in">str</span>,</span></span><br><span class="line"><span class="params">    q: <span class="built_in">int</span> | <span class="literal">None</span> = <span class="literal">None</span>,</span></span><br><span class="line"><span class="params">    cookie_or_token: <span class="built_in">str</span> = Depends(<span class="params">get_cookie_or_token</span>),  <span class="comment"># 在websocket中使用依赖</span></span></span><br><span class="line"><span class="params"></span>):</span><br><span class="line">    <span class="keyword">await</span> websocket.accept()</span><br><span class="line">    <span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line">        data = <span class="keyword">await</span> websocket.receive_text()</span><br><span class="line">        <span class="keyword">await</span> websocket.send_text(<span class="string">f&quot;Session cookie or query token value is: <span class="subst">&#123;cookie_or_token&#125;</span>&quot;</span>)</span><br><span class="line">        <span class="keyword">if</span> q <span class="keyword">is</span> <span class="keyword">not</span> <span class="literal">None</span>:</span><br><span class="line">            <span class="keyword">await</span> websocket.send_text(<span class="string">f&quot;Query parameter q is: <span class="subst">&#123;q&#125;</span>&quot;</span>)</span><br><span class="line">        <span class="keyword">await</span> websocket.send_text(<span class="string">f&quot;Message text was: <span class="subst">&#123;data&#125;</span>, for item ID: <span class="subst">&#123;item_id&#125;</span>&quot;</span>)</span><br></pre></td></tr></table></figure></p>
<p>3.WebSockets处理连接关闭：<br />
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> fastapi <span class="keyword">import</span> FastAPI, WebSocket, WebSocketDisconnect</span><br><span class="line"><span class="keyword">from</span> fastapi.responses <span class="keyword">import</span> HTMLResponse</span><br><span class="line"></span><br><span class="line">app = FastAPI()</span><br><span class="line"></span><br><span class="line">html = <span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">&lt;!DOCTYPE html&gt;</span></span><br><span class="line"><span class="string">&lt;html&gt;</span></span><br><span class="line"><span class="string">    &lt;head&gt;</span></span><br><span class="line"><span class="string">        &lt;title&gt;Chat&lt;/title&gt;</span></span><br><span class="line"><span class="string">    &lt;/head&gt;</span></span><br><span class="line"><span class="string">    &lt;body&gt;</span></span><br><span class="line"><span class="string">        &lt;h1&gt;WebSocket Chat&lt;/h1&gt;</span></span><br><span class="line"><span class="string">        &lt;h2&gt;Your ID: &lt;span id=&quot;ws-id&quot;&gt;&lt;/span&gt;&lt;/h2&gt;</span></span><br><span class="line"><span class="string">        &lt;form action=&quot;&quot; onsubmit=&quot;sendMessage(event)&quot;&gt;</span></span><br><span class="line"><span class="string">            &lt;input type=&quot;text&quot; id=&quot;messageText&quot; autocomplete=&quot;off&quot;/&gt;</span></span><br><span class="line"><span class="string">            &lt;button&gt;Send&lt;/button&gt;</span></span><br><span class="line"><span class="string">        &lt;/form&gt;</span></span><br><span class="line"><span class="string">        &lt;ul id=&#x27;messages&#x27;&gt;</span></span><br><span class="line"><span class="string">        &lt;/ul&gt;</span></span><br><span class="line"><span class="string">        &lt;script&gt;</span></span><br><span class="line"><span class="string">            var client_id = Date.now()</span></span><br><span class="line"><span class="string">            document.querySelector(&quot;#ws-id&quot;).textContent = client_id;</span></span><br><span class="line"><span class="string">            var ws = new WebSocket(`ws://localhost:8000/ws/$&#123;client_id&#125;`);</span></span><br><span class="line"><span class="string">            ws.onmessage = function(event) &#123;</span></span><br><span class="line"><span class="string">                var messages = document.getElementById(&#x27;messages&#x27;)</span></span><br><span class="line"><span class="string">                var message = document.createElement(&#x27;li&#x27;)</span></span><br><span class="line"><span class="string">                var content = document.createTextNode(event.data)</span></span><br><span class="line"><span class="string">                message.appendChild(content)</span></span><br><span class="line"><span class="string">                messages.appendChild(message)</span></span><br><span class="line"><span class="string">            &#125;;</span></span><br><span class="line"><span class="string">            function sendMessage(event) &#123;</span></span><br><span class="line"><span class="string">                var input = document.getElementById(&quot;messageText&quot;)</span></span><br><span class="line"><span class="string">                ws.send(input.value)</span></span><br><span class="line"><span class="string">                input.value = &#x27;&#x27;</span></span><br><span class="line"><span class="string">                event.preventDefault()</span></span><br><span class="line"><span class="string">            &#125;</span></span><br><span class="line"><span class="string">        &lt;/script&gt;</span></span><br><span class="line"><span class="string">    &lt;/body&gt;</span></span><br><span class="line"><span class="string">&lt;/html&gt;</span></span><br><span class="line"><span class="string">&quot;&quot;&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 连接管理</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">ConnectionManager</span>:</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__init__</span>(<span class="params">self</span>):</span><br><span class="line">        self.active_connections: <span class="built_in">list</span>[WebSocket] = []</span><br><span class="line"></span><br><span class="line">    <span class="keyword">async</span> <span class="keyword">def</span> <span class="title function_">connect</span>(<span class="params">self, websocket: WebSocket</span>):</span><br><span class="line">        <span class="keyword">await</span> websocket.accept()</span><br><span class="line">        self.active_connections.append(websocket)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">disconnect</span>(<span class="params">self, websocket: WebSocket</span>):</span><br><span class="line">        self.active_connections.remove(websocket)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">async</span> <span class="keyword">def</span> <span class="title function_">send_personal_message</span>(<span class="params">self, message: <span class="built_in">str</span>, websocket: WebSocket</span>):</span><br><span class="line">        <span class="keyword">await</span> websocket.send_text(message)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">async</span> <span class="keyword">def</span> <span class="title function_">broadcast</span>(<span class="params">self, message: <span class="built_in">str</span></span>):</span><br><span class="line">        <span class="keyword">for</span> connection <span class="keyword">in</span> self.active_connections:</span><br><span class="line">            <span class="keyword">await</span> connection.send_text(message)</span><br><span class="line"></span><br><span class="line">manager = ConnectionManager()</span><br><span class="line"></span><br><span class="line"><span class="meta">@app.get(<span class="params"><span class="string">&quot;/&quot;</span></span>)</span></span><br><span class="line"><span class="keyword">async</span> <span class="keyword">def</span> <span class="title function_">get</span>():</span><br><span class="line">    <span class="keyword">return</span> HTMLResponse(html)</span><br><span class="line"></span><br><span class="line"><span class="meta">@app.websocket(<span class="params"><span class="string">&quot;/ws/&#123;client_id&#125;&quot;</span></span>)</span></span><br><span class="line"><span class="keyword">async</span> <span class="keyword">def</span> <span class="title function_">websocket_endpoint</span>(<span class="params">websocket: WebSocket, client_id: <span class="built_in">int</span></span>):</span><br><span class="line">    <span class="keyword">await</span> manager.connect(websocket)</span><br><span class="line">    <span class="keyword">try</span>:</span><br><span class="line">        <span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line">            data = <span class="keyword">await</span> websocket.receive_text()</span><br><span class="line">            <span class="keyword">await</span> manager.send_personal_message(<span class="string">f&quot;You wrote: <span class="subst">&#123;data&#125;</span>&quot;</span>, websocket)</span><br><span class="line">            <span class="keyword">await</span> manager.broadcast(<span class="string">f&quot;Client #<span class="subst">&#123;client_id&#125;</span> says: <span class="subst">&#123;data&#125;</span>&quot;</span>)</span><br><span class="line">    <span class="keyword">except</span> WebSocketDisconnect: <span class="comment"># 连接断开的话，广播报错</span></span><br><span class="line">        manager.disconnect(websocket)</span><br><span class="line">        <span class="keyword">await</span> manager.broadcast(<span class="string">f&quot;Client #<span class="subst">&#123;client_id&#125;</span> left the chat&quot;</span>)</span><br></pre></td></tr></table></figure></p>
<h1 id="应用启动关闭事件">应用启动关闭事件</h1>
<p>Fastapi 0.115.0版本以后，使用Lifespan
Events来处理应用启动前后事件。<br />
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> contextlib <span class="keyword">import</span> asynccontextmanager  <span class="comment"># 引入上下文管理</span></span><br><span class="line"><span class="keyword">from</span> fastapi <span class="keyword">import</span> FastAPI</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">fake_answer_to_everything_ml_model</span>(<span class="params">x: <span class="built_in">float</span></span>):</span><br><span class="line">    <span class="keyword">return</span> x * <span class="number">42</span></span><br><span class="line"></span><br><span class="line">ml_models = &#123;&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">@asynccontextmanager</span></span><br><span class="line"><span class="keyword">async</span> <span class="keyword">def</span> <span class="title function_">lifespan</span>(<span class="params">app: FastAPI</span>):</span><br><span class="line">    <span class="comment"># Load the ML model，应用启动前执行</span></span><br><span class="line">    ml_models[<span class="string">&quot;answer_to_everything&quot;</span>] = fake_answer_to_everything_ml_model</span><br><span class="line">    <span class="keyword">yield</span></span><br><span class="line">    <span class="comment"># Clean up the ML models and release the resources，应用关闭前执行</span></span><br><span class="line">    ml_models.clear()</span><br><span class="line"></span><br><span class="line">app = FastAPI(lifespan=lifespan)  <span class="comment"># 指定应用lifespan</span></span><br><span class="line"></span><br><span class="line"><span class="meta">@app.get(<span class="params"><span class="string">&quot;/predict&quot;</span></span>)</span></span><br><span class="line"><span class="keyword">async</span> <span class="keyword">def</span> <span class="title function_">predict</span>(<span class="params">x: <span class="built_in">float</span></span>):</span><br><span class="line">    result = ml_models[<span class="string">&quot;answer_to_everything&quot;</span>](x)</span><br><span class="line">    <span class="keyword">return</span> &#123;<span class="string">&quot;result&quot;</span>: result&#125;</span><br></pre></td></tr></table></figure></p>
<h1 id="接口测试">接口测试</h1>
<p>多个接口可通过python代码统一进行测试，需要安装两个插件<code>pip install httpx</code>和<code>pip install pytest</code>。</p>
<p>1.创建一个测试文件test_main.py，对多个接口进行测试，运行test_main.py即可：<br />
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> fastapi.testclient <span class="keyword">import</span> TestClient</span><br><span class="line"><span class="keyword">from</span> .main <span class="keyword">import</span> app</span><br><span class="line"></span><br><span class="line">client = TestClient(app) <span class="comment"># 创建一个测试实例</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># pytest约定名字以 test_ 开头的函数</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">test_read_item</span>():</span><br><span class="line">    <span class="comment"># 测试get</span></span><br><span class="line">    response = client.get(<span class="string">&quot;/items/foo&quot;</span>, headers=&#123;<span class="string">&quot;X-Token&quot;</span>: <span class="string">&quot;coneofsilence&quot;</span>&#125;)</span><br><span class="line">    <span class="keyword">assert</span> response.status_code == <span class="number">200</span></span><br><span class="line">    <span class="keyword">assert</span> response.json() == &#123;</span><br><span class="line">        <span class="string">&quot;id&quot;</span>: <span class="string">&quot;foo&quot;</span>,</span><br><span class="line">        <span class="string">&quot;title&quot;</span>: <span class="string">&quot;Foo&quot;</span>,</span><br><span class="line">        <span class="string">&quot;description&quot;</span>: <span class="string">&quot;There goes my hero&quot;</span>,</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">test_read_item_bad_token</span>():</span><br><span class="line">    response = client.get(<span class="string">&quot;/items/foo&quot;</span>, headers=&#123;<span class="string">&quot;X-Token&quot;</span>: <span class="string">&quot;hailhydra&quot;</span>&#125;)</span><br><span class="line">    <span class="keyword">assert</span> response.status_code == <span class="number">400</span></span><br><span class="line">    <span class="keyword">assert</span> response.json() == &#123;<span class="string">&quot;detail&quot;</span>: <span class="string">&quot;Invalid X-Token header&quot;</span>&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">test_read_nonexistent_item</span>():</span><br><span class="line">    response = client.get(<span class="string">&quot;/items/baz&quot;</span>, headers=&#123;<span class="string">&quot;X-Token&quot;</span>: <span class="string">&quot;coneofsilence&quot;</span>&#125;)</span><br><span class="line">    <span class="keyword">assert</span> response.status_code == <span class="number">404</span></span><br><span class="line">    <span class="keyword">assert</span> response.json() == &#123;<span class="string">&quot;detail&quot;</span>: <span class="string">&quot;Item not found&quot;</span>&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">test_create_item</span>():</span><br><span class="line">    <span class="comment"># 测试post</span></span><br><span class="line">    response = client.post(</span><br><span class="line">        <span class="string">&quot;/items/&quot;</span>,</span><br><span class="line">        headers=&#123;<span class="string">&quot;X-Token&quot;</span>: <span class="string">&quot;coneofsilence&quot;</span>&#125;,</span><br><span class="line">        json=&#123;<span class="string">&quot;id&quot;</span>: <span class="string">&quot;foobar&quot;</span>, <span class="string">&quot;title&quot;</span>: <span class="string">&quot;Foo Bar&quot;</span>, <span class="string">&quot;description&quot;</span>: <span class="string">&quot;The Foo Barters&quot;</span>&#125;,</span><br><span class="line">    )</span><br><span class="line">    <span class="keyword">assert</span> response.status_code == <span class="number">200</span></span><br><span class="line">    <span class="keyword">assert</span> response.json() == &#123;</span><br><span class="line">        <span class="string">&quot;id&quot;</span>: <span class="string">&quot;foobar&quot;</span>,</span><br><span class="line">        <span class="string">&quot;title&quot;</span>: <span class="string">&quot;Foo Bar&quot;</span>,</span><br><span class="line">        <span class="string">&quot;description&quot;</span>: <span class="string">&quot;The Foo Barters&quot;</span>,</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">test_create_item_bad_token</span>():</span><br><span class="line">    response = client.post(</span><br><span class="line">        <span class="string">&quot;/items/&quot;</span>,</span><br><span class="line">        headers=&#123;<span class="string">&quot;X-Token&quot;</span>: <span class="string">&quot;hailhydra&quot;</span>&#125;,</span><br><span class="line">        json=&#123;<span class="string">&quot;id&quot;</span>: <span class="string">&quot;bazz&quot;</span>, <span class="string">&quot;title&quot;</span>: <span class="string">&quot;Bazz&quot;</span>, <span class="string">&quot;description&quot;</span>: <span class="string">&quot;Drop the bazz&quot;</span>&#125;,</span><br><span class="line">    )</span><br><span class="line">    <span class="keyword">assert</span> response.status_code == <span class="number">400</span></span><br><span class="line">    <span class="keyword">assert</span> response.json() == &#123;<span class="string">&quot;detail&quot;</span>: <span class="string">&quot;Invalid X-Token header&quot;</span>&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">test_create_existing_item</span>():</span><br><span class="line">    response = client.post(</span><br><span class="line">        <span class="string">&quot;/items/&quot;</span>,</span><br><span class="line">        headers=&#123;<span class="string">&quot;X-Token&quot;</span>: <span class="string">&quot;coneofsilence&quot;</span>&#125;,</span><br><span class="line">        json=&#123;</span><br><span class="line">            <span class="string">&quot;id&quot;</span>: <span class="string">&quot;foo&quot;</span>,</span><br><span class="line">            <span class="string">&quot;title&quot;</span>: <span class="string">&quot;The Foo ID Stealers&quot;</span>,</span><br><span class="line">            <span class="string">&quot;description&quot;</span>: <span class="string">&quot;There goes my stealer&quot;</span>,</span><br><span class="line">        &#125;,</span><br><span class="line">    )</span><br><span class="line">    <span class="keyword">assert</span> response.status_code == <span class="number">409</span></span><br><span class="line">    <span class="keyword">assert</span> response.json() == &#123;<span class="string">&quot;detail&quot;</span>: <span class="string">&quot;Item already exists&quot;</span>&#125;</span><br></pre></td></tr></table></figure></p>
<h1 id="参考文献">参考文献</h1>
<p><span class="exturl" data-url="aHR0cHM6Ly9mYXN0YXBpLnRpYW5nb2xvLmNvbS8=">fastapi官方文档<i class="fa fa-external-link-alt"></i></span><br />
<span class="exturl" data-url="aHR0cHM6Ly9kb2NzLnB5ZGFudGljLmRldi9sYXRlc3Qv">Pydantic官网<i class="fa fa-external-link-alt"></i></span></p>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="https://soundmemories.github.io/2024/07/18/Paper/04.Retrieval-Augmented%20Generation%20Survey/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avstar.png">
      <meta itemprop="name" content="SoundMemories">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="SoundMemories">
      <meta itemprop="description" content="今日事，今日毕">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | SoundMemories">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2024/07/18/Paper/04.Retrieval-Augmented%20Generation%20Survey/" class="post-title-link" itemprop="url">Retrieval-Augmented Generation Survey</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>

      <time title="创建时间：2024-07-18 00:00:00" itemprop="dateCreated datePublished" datetime="2024-07-18T00:00:00+08:00">2024-07-18</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">分类于</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/Paper/" itemprop="url" rel="index"><span itemprop="name">Paper</span></a>
        </span>
    </span>

  
    <span class="post-meta-break"></span>
    <span class="post-meta-item" title="本文字数">
      <span class="post-meta-item-icon">
        <i class="far fa-file-word"></i>
      </span>
      <span class="post-meta-item-text">本文字数：</span>
      <span>5.1k</span>
    </span>
    <span class="post-meta-item" title="阅读时长">
      <span class="post-meta-item-icon">
        <i class="far fa-clock"></i>
      </span>
      <span class="post-meta-item-text">阅读时长 &asymp;</span>
      <span>19 分钟</span>
    </span>
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <h1
id="retrieval-augmented-generation-for-natural-language-processing-a-survey">Retrieval-Augmented
Generation for Natural Language Processing: A Survey</h1>
<h2 id="摘要">摘要</h2>
<p>1.大语言模型（LLMs）的成功，得益于存储知识的巨大参数量，然而LLMs仍然面临几个关键问题，比如<strong>幻觉问题（hallucination）、知识更新问题、缺乏特定领域的专业知识</strong>。<br />
2.检索增强生成（RAG，Retrieval-Augmented
Generation）<strong>利用外部知识数据库来增强LLMs</strong>，弥补了LLMs的这些缺点。<br />
3.本文回顾了RAG的所有<strong>重要技术</strong>，特别时在<strong>检索器（retriever）</strong>、<strong>检索融合（retrieval
fusions）</strong>方面。<br />
4.此外，还<strong>提供</strong>了实现<strong>RAG中代表性技术</strong>的教程<strong>代码</strong>。<br />
5.进一步讨论了RAG训练，包括在<strong>有无数据仓库更新</strong>的情况下RAG的效果。<br />
6.介绍了RAG在<strong>代表性NLP任务</strong>、<strong>工业场景</strong>中的应用。<br />
7.讨论了RAG的<strong>未来方向和挑战</strong>，以促进其发展。</p>
<h2 id="介绍">介绍</h2>
<p>1.大语言模型（LLMs）通常是在<strong>大量的自然语言语料库上进行预训练</strong>的，然后<strong>在特定的下游任务的数据集上进行微调</strong>。LLMs的成功可以解释为语言模型作为知识库，在<strong>参数中隐含地存储了从训练数据集中学到的知识</strong>，作为内部记忆，并通过从记忆中检索答案来生成响应。<br />
2.目前为了存储更多的知识以获得更好的生成性能，现有的方法<strong>通常通过增加参数的体积来扩大存储容量</strong>，从而记忆更多的知识。</p>
<p>1.尽管LLMs已经展示出巨大能力，但仍有几个问题阻碍了LLMs的发展：<br />
（1）最突出的问题是<strong>幻觉问题</strong>，它指定是<strong>LLMs倾向于生成连贯、流畅但事实错误的响应</strong>。<br />
（2）另一个巨大挑战是<strong>知识更新问题</strong>，它指定是<strong>LLMs内部知识的更新，那么这就需要重新/微调LLMs，这就需要花费大量money</strong>。<br />
（3）另一个挑战是<strong>LLMs缺乏特定领域的专业知识</strong>，如果训练一个特定领域的LLMs，这就<strong>需要耗费大量人力来收集这些特定领域的数据</strong>。</p>
<p>1.为了<strong>应对这些问题和挑战</strong>，最近的研究<strong>建议利用外部知识数据库来增强LLMs，这就是RAG</strong>。<br />
（1）RAG通过<strong>从外部数据库检索的相关事实信息</strong>，可以在<strong>一定程度上缓解幻觉问题</strong>。<br />
（2）<strong>知识更新问题</strong>，可以通过<strong>更新外部数据库的知识信息</strong>，从而<strong>增强LLMs的知识实时性</strong>。<br />
（3）RAG通过<strong>构建和利用特定领域知识数据库</strong>，将<strong>通用LLMs扩展到特定领域</strong>，从而<strong>增强LLMs的特定领域专业知识</strong>。</p>
<p>1.本文回顾了涉及RAG涉及的所有技术，尽管已经由很多篇调查论文，但本文仍然提供了一些关键见解：<br />
（1）本文<strong>系统介绍了RAG的各个组成部分</strong>，包括<strong>检索器从构建到查询的细节</strong>，以及<strong>检索融合的指导性代码</strong>。<br />
（2）本文<strong>展示了不同的RAG训练策略</strong>，包括<strong>有/没有数据存储更新</strong>的RAG。<br />
（3）本文进一步讨论了<strong>RAG在下游NLP任务</strong>和<strong>实际NLP场景</strong>中的应用。<br />
（4）本文最终确定了<strong>未来有希望的探索方向</strong>和<strong>需要解决的主要挑战</strong>。</p>
<p>1.文章结构：<br />
（1）第二节给出了<strong>RAG概述</strong>。<br />
（2）第三、四节介绍了<strong>检索器</strong>和<strong>检索融合</strong>中使用的所有技术细节。<br />
（3）第五节介绍了<strong>生成器</strong>。<br />
（4）第六节介绍了<strong>如何训练有/没有数据存储更新的RAG</strong>。<br />
（7）第七节介绍了<strong>代表性的NLP任务中使用的技术</strong>。<br />
（8）第八节展示了<strong>RAG在实际NLP场景中的应用</strong>。<br />
（9）第九节讨论<strong>RAG的未来方向</strong>。<br />
（10）第十节对本文做出了<strong>最终结论</strong>。</p>
<h2 id="概述-检索增强生成第二节">概述-检索,增强,生成（第二节）</h2>
<p>RAG技术应用在NLP任务处理概述：<br />
<img src="/images/RAG/1.RAG处理流程概述图.png" width="75%"></p>
<p>如图1所示，RAG主要包含三个模块：<strong>检索器（Retriever）、生成器（Generator）、检索融合（Retrieval
Fusions）</strong>。</p>
<p>1.<strong>检索器（Retriever）</strong>：主要包含三个部分：<br />
（1）<strong>编码器（encoder）</strong>：encoder将inputs编码为embeddings。<br />
（2）<strong>索引（index）</strong>：用来支持近似最近邻高效搜索的索引。<br />
（3）<strong>数据存储（datastore）</strong>：kv对形式存储外部知识的数据库。<br />
2.检索器主要挑战在于<strong>检索效率和检索质量之间，找到最佳的权衡</strong>。<br />
3.<strong>检索效率</strong>：指获取相关信息的速度有多快，这涉及到<strong>加速编码、高效索引、在数据库中批量查询等</strong>。<br />
4.<strong>检索质量</strong>：指的是信息的关联性如何，这涉及到<strong>块表示学习、高级近似近邻搜索算法等</strong>。</p>
<p>1.<strong>检索融合（Retrieval
Fusions）</strong>：利用检索信息来增强生成。<br />
2.<strong>融合技术</strong>，主要包含三种：<br />
（1）<strong>基于查询的融合（Query-based
Fusion）</strong>：在将检索信息输入生成器之前增强输入。<br />
（2）<strong>基于逻辑的融合（Logits-based
Fusion）</strong>：侧重于生成器的输出逻辑，并融合检索的逻辑以获得更稳健的逻辑输出。<br />
（3）<strong>潜在融合（Latent
Fusion）</strong>：将检索表示引入生成器的潜在表示中，从而隐式地提高模型的性能。</p>
<p>1.<strong>生成器（Generator）</strong>：生成器模块可以分为两个分支:<br />
（1）<strong>默认生成器</strong>：预训练/微调的LLMs，如GPT系列、Gemini系列。<br />
（2）<strong>检索增强(RA)生成器</strong>：预训练/微调生成器，融合了检索模块，比如RETRO、ENCDEC。潜在融合使用的时RA生成器。<br />
2.<strong>RAG的工作流程</strong>包括三个步骤：<br />
（1）根据给定的输入从外部数据库检索相关信息。<br />
（2）根据融合技术将检索到的信息与输入或中间状态融合。<br />
（3）根据输入和相应的检索结果由生成器进行预测。</p>
<h2 id="检索器第三节">检索器（第三节）</h2>
<p><img src="/images/RAG/2.检索器处理流程.png" width="85%"></p>
<p>如图2展示了检索器的两个步骤：1.<strong>构建检索器</strong>。2.<strong>查询检索器</strong>。</p>
<p>1.<strong>构建检索器</strong>：涉及三个步骤（图2,a）：<br />
（1）<strong>语料分块</strong>：将输入的大文件，分块成小的文本块。<br />
（2）<strong>块编码</strong>：将文本块数字化为向量表示（embedding）。<br />
（3）<strong>向量数据库构建</strong>：包括<strong>ANN索引构建</strong>、<strong>kv对形式的数据存储</strong>。</p>
<p>1.<strong>语料分块</strong>：<br />
（1）<strong>用于索引的文本或embedding应该在语义上是独立的</strong>。注意，短文本易产生歧义，比如"苹果"可以指水果或公司。<br />
（2）编码整个文档（长文本）导致资源开销大。<strong>而处理短文本，可以加速编码过程、节省内存开销</strong>。<br />
（3）分块主要挑战在于，<strong>找到最佳的分块大小，在文本语义和编码效率之间做出权衡</strong>。<br />
2.<strong>决定分块大小时</strong>，主要考虑三个要点：<br />
（1）<strong>任务属性</strong>：<strong>不同的检索快有益于不同任务</strong>，比如问答任务更喜欢简短的短语，摘要任务可能喜欢长文档。<br />
（2）<strong>编码属性</strong>：<strong>不同的编码器对不同长度的文本效果有很大区别</strong>。例如，sentence-transformer
[125]中的模型在单个句子上表现更好，而 text-embedding-ada-002
[113]则擅长较长的文本。<br />
（3）<strong>查询属性</strong>：<strong>用户查询的长度应与分块大小保持一致</strong>。这隐式地将块中的上下文信息量与查询中的上下文信息量对齐，从而提高查询和检索之间的相关性。例如，基于短语构建的检索数据库对于长文档的查询可能毫无用处。<br />
3.<strong>基础的分块技术</strong>，主要有三种：<br />
（1）<strong>固定长度分块</strong>：使用长度超参数按顺序分割文档的最简单方法。<br />
（2）<strong>基于语义分块</strong>：根据语义来切割文档，例如代表句子结尾的字符或换行符。NLTK[112]和spaCy[33]提供了方便的句子切割方法。<br />
（3）<strong>基于内容的分块</strong>：根据独特的结构特征对文档进行分块。例如，电子病历可以轻松地根据小节进行分块，编程代码可以根据功能块进行分块。</p>
<p>1.<strong>块编码</strong>：指的是将文本块编码为向量表示（embedding）。这些embedding通常能捕获块的语义，使<strong>检索器</strong>能够<strong>基于内容相关性</strong>而<strong>不是仅是关键字匹配</strong>来执行相似性搜索。<br />
2.根据embedding的<strong>稀疏性</strong>，有两种编码方法：<br />
（1）<strong>稀疏编码（sparse
encoding）</strong>：稀疏编码创建的向量，大多数元素为零。此种编码<strong>无法捕捉更深层的语义含义</strong>。<br />
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">one-hot[<span class="number">50</span>]：向量维度为词表大小，句子中出现的单词，其对应的向量位，置<span class="number">1</span>。</span><br><span class="line">Bag of Words (BoW)[<span class="number">51</span>]：改进one-hot编码，使用词频代替零，但仍忽略了文档中语法和词序信息，专注统计信息，只能表达有限的语义。</span><br><span class="line">TF-IDF[<span class="number">120</span>]：除了计算词频，还根据单词在所有文档中的常见程度（逆文档频率）来调整结果，更倾向于强调描述文档内容的单词。</span><br></pre></td></tr></table></figure></p>
<p>（2）<strong>稠密编码（dense
encoding）</strong>：稠密编码创建的向量，每个维度都可以捕获一系列语义特征，并且大多数元素是非零浮点数。通常由DNN模型产生的。<br />
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">BERT及其变体：Bert[<span class="number">29</span>]是一种来自Transformers的双向编码器，典型的预训练模型，可以捕捉上下问信息，使用稠密向量表示语义信息。其他变体RoBERTa[<span class="number">99</span>]、DistilBERT[<span class="number">128</span>]、ELECTRA[<span class="number">19</span>]进一步改进了语义表示。</span><br><span class="line">孪生编码器（siamese encoder）：这是一种旨在学习输入之间相似性的神经网络，通常通过对比学习进行训练。</span><br><span class="line">    现有最先进的孪生编码器是DPR[<span class="number">79</span>]、SimCSE[<span class="number">40</span>]。</span><br><span class="line">基于LLM的编码器：LLMs在涵盖广泛主题的大数据上进行预训练，具有强大的语义理解能力。</span><br><span class="line">    典型的基于LLMs的编码器是text-embedding-ada-002[<span class="number">113</span>]、bge-embedding[<span class="number">156</span>]、mxbai-embedding[<span class="number">130</span>]。</span><br></pre></td></tr></table></figure></p>
<p>3.与稀疏编码相比，稠密编码利用深层神经网络，尤其是Transformer[140]来捕获更广泛的语言和语义信息。目前，此类编码广泛应用于大多数语义表示场景。</p>
<p>1.<strong>创建索引</strong>：<br />
创建索引的目的：加速处理query
embedding和表示知识的高维embedding之间的相似性搜索。<br />
向量数据库中的索引主要侧重于支持高效的近似近邻（ANN）搜索[32,47,77]，而不是插入、删除和更新等事务操作。<br />
索引的难点在于<strong>搜索质量</strong>和<strong>搜索效率</strong>之间取得良好的平衡。<br />
为解决这一难题，在算法和系统两方面都有各种具体的优化方案有待探索，包括相似度指标的选择、embeddings降维（DR）、高级ANN索引、系统级优化、硬件感知优化等。<br />
本文只讲<strong>明显影响</strong>，<strong>搜索质量</strong>和<strong>搜索效率</strong>的优化：<br />
（1）<strong>相似度指标的选择</strong>：相似性度量是检索器中的基本组件，它测量query
embedding和chunk
embedding之间的相关程度。相似性度量会影响搜索质量。<br />
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 常见的相似度指标</span></span><br><span class="line">cosine similarity</span><br><span class="line">Euclidean similarity</span><br><span class="line">Manhattan distance</span><br><span class="line">Jaccard similarity</span><br></pre></td></tr></table></figure></p>
<p>（2）<strong>embeddings降维（DR）</strong>：降低embedding维度可以提高搜索效率，但存在损害语义表示的风险。<br />
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">主成分分析（PCA，Principal Component Analysis）：它将原始数据转换到新的坐标系，同时保留最重要的特征。</span><br><span class="line">局部敏感哈希（LSH，Locality Sensitive Hashing）：它将数据映射到哈希桶中来降维，保留了和输入数据的相似性。</span><br><span class="line">乘积量化（PQ，Product Quantization）[<span class="number">68</span>]：将高维空间划分为更小的、独立量化的子空间，每个子空间都会创建一个由不同量化整数组成的编码本，以形成具有代表性的紧凑向量。</span><br><span class="line">最新的是一种名为AutoCompressor[<span class="number">17</span>]的新技术：通过将原始上下文压缩为语义上更短的嵌入来减少嵌入的维度。</span><br></pre></td></tr></table></figure></p>
<p>（3）<strong>高级ANN索引</strong>：ANN
索引通常是指用于组织和管理数据的方法或结构，以便优化近似最近邻搜索过程以提高检索质量和检索效率。本文将介绍几种先进的
ANN 索引技术。<br />
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">The InVerted File system <span class="keyword">with</span> Product Quantization(IVFPQ)：首先对数据进行聚类，进行粗粒度划分；然后对每个聚类内的数据进行压缩，形成子向量，进行细粒度量化。</span><br><span class="line">    粗粒度聚类（IVF 组件）显著减少了搜索空间。</span><br><span class="line">    细粒度量化（PQ 组件）确保了较高的检索性能。</span><br><span class="line">The Hierarchical Navigable Small World (HNSW) ：使用分层图结构在高维空间中高效地执行 ANN 搜索。</span><br><span class="line">    将高向量视为节点，并将它们与其最近的邻居连接起来。</span><br><span class="line">    多层图结构是按概率确定的，以确保较高层的节点较少，从而实现高效搜索。</span><br><span class="line">tree-based Indexing：将高维向量组织成树状结构。例如KD 树 [<span class="number">123</span>]、Ball 树 [<span class="number">62</span>] 和 VP 树 [<span class="number">98</span>]。</span><br><span class="line">    典型的基于树的索引是近似最近邻ANN[<span class="number">135</span>]，它使用基于随机预测建立的树森林，将向量空间分离成多个超平面，以实现高效的ANN搜索。</span><br></pre></td></tr></table></figure></p>
<p>以上三种是<strong>明显影响</strong>，<strong>搜索质量</strong>和<strong>搜索效率</strong>的优化。</p>
<p>1.<strong>创建kv对形式的数据存储</strong>：向量数据使用专用的数据库存储，它将数据作为kv对集合进行存储和管理，其中k是高维embedding唯一标识符，v是特定领域的知识。<br />
2.由于数据存储中存储的数据量可能非常大，因此存储引擎（例如LMDB[100]或RocksDB[35]）应该能够高效检索和数据持久化。<br />
3.存储的关键在于，把什么样的数据作为v进行存储，这有助于后续的生成过程。比如，问答任务中，可以把问题embedding作为k，问题对作为v进行存储。<br />
5.最近的工作提出了各种最先进的向量数据库，包括索引和数据存储，例如Milvus[46,143]、FAISS[32,77]、LlamaIndex[95]等。</p>
<p>1.<strong>创建检索器的伪代码</strong>：<br />
<img src="/images/RAG/3.创建检索器伪代码.png" width="55%"></p>
<p>2.第2~9行展示了将多个文档分块、编码的过程。<br />
3.第6行将当前块和下一个块concatenate在一起作为v值存储，注意，不同任务v值得选择会有所不同。<br />
4.实际任务中，所有kv值的内存消耗可能超过服务器内存容量，因此建议将kv持久化到磁盘上，以减少内存消耗。</p>
<hr />
<p>1.<strong>查询检索器</strong>（图2,b）：如何查询预构建的检索器，三个步骤：<br />
（1）<strong>编码查询</strong>：将输入的query编码为向量表示（embedding）。<br />
（2）<strong>ANN搜索</strong>：利用预先构建index，使用近似搜索算法，找到与query相似的key，然后获取对应的value。<br />
（3）<strong>后处理</strong>：对检索到的value重新排序（reorder）。</p>
<p>1.<strong>编码查询</strong>：为了与预先构建index的embedding空间一致，使用相同的编码器对query进行编码。</p>
<p>1.<strong>ANN搜索</strong>：具体指搜索预先构建的index，找到前k个最近邻的key。<br />
2.最近邻搜索取决于使用的索引算法和结构：<br />
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 以IVFPQ为例，搜索过程：</span></span><br><span class="line">首先将query embedding与粗粒度的聚类embedding进行比较，并选择几个候选聚类进行进一步搜索。</span><br><span class="line">然后在每个候选聚类内，对query embedding执行相同的乘积量化，并根据距离找到前 k 个最近邻。</span><br><span class="line">最后合并所有最近邻候选者，并对最终的前 k 个最近邻的所有候选者重新排序。</span><br></pre></td></tr></table></figure></p>
<p>3.根据找到k个最近邻的key，从向量数据库中取对应的value。</p>
<p>1.<strong>后处理</strong>：根据特定任务目标细化、增强、调整检索结果。一些经典的后处理技术：<br />
<strong>重排（rerank）</strong>：根据任务特定的目标，对检索到的知识进行重新排序。直观理解是，基于和任务无关的指标，对知识进行排序，比如欧式距离。现有的重新排序方法[18、56、85、141]大多设计不同的架构或策略来对检索到的知识进行重新排序。</p>
<p>1.<strong>查询检索器的伪代码</strong>：<br />
<img src="/images/RAG/4.查询检索器伪代码.png" width="55%"></p>
<p>2.第1行：将query编码为向量表示。<br />
3.第2行：执行最近邻搜索ANN，使用预先构建的index，找到前k个最近邻的key。<br />
4.第3行：根据找到的key，从向量数据库中取对应的value。<br />
5.第4行：对检索到的value进行后处理，比如重排。</p>
<h2 id="检索融合第4节">检索融合（第4节）</h2>
<p>1.<strong>检索融合（Retrieval
Fusions</strong>）：指得是如何有效的利用检索到的知识，以提高生成器（generator）的性能。<br />
2.基本上检索融合分为前面介绍的三类：query-based fusions, logits-based
fusions, latent fusions。<br />
<img src="/images/RAG/5.检索融合分类.png" width="75%"></p>
<p>3.图3展示了检索融合的分类和每个类别下的代表性方法。</p>
<p>1.<strong>Query-based
fusions</strong>：这是最简单直接的一种融合方式，它将检索到的信息与输入查询信息相集成来生成响应。<br />
根据连接信息的方式，分为两个类别：text concatenation、feature
concatenation。<br />
（1）<strong>text
concatenation</strong>：涉及检索结果与原始文本合并，使其特别适合GPT-4等当代LLM。这些模型充当黑盒系统，交互能力有限，通常只向用户提供API接口。<br />
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">当前的研究工作[<span class="number">49</span>,<span class="number">87</span>,<span class="number">122</span>]直接将输入与检索最多的句子/文档连接起来以形成生成器的查询语句。</span><br><span class="line">为了更好的利用LLMs上下文学习能力，一些研究工作[<span class="number">34</span>,<span class="number">90</span>,<span class="number">141</span>,<span class="number">145</span>]设计了有效的prompt templates来整合输入和检索的信息。</span><br><span class="line">为了解决拼接检索信息导致输入过长的问题，最近的一些研究[<span class="number">5</span>,<span class="number">96</span>,<span class="number">101</span>,<span class="number">150</span>,<span class="number">159</span>]提出了在检索知识结果的基础上，为每个结果中的元素分配重要性权重，并基于此权重，过滤弱相关的检索结果。</span><br></pre></td></tr></table></figure></p>
<p>（2）<strong>feature
concatenation</strong>：涉及编码检索结果与编码输入合并。<br />
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">简单的方法是FID[<span class="number">66</span>]，首先将检索结果们编码到稀疏/稠密空间，然后将编码检索结果和编码输入concat，作为输入给生成器。FID在sota最先进性能表现证明了feature concatenation的有效性。</span><br><span class="line">后续工作[<span class="number">25</span>,<span class="number">48</span>,<span class="number">67</span>,<span class="number">97</span>,<span class="number">127</span>]通过联合调整检索器和编码器进一步改进了FID，这可以增强检索到的知识的表示。</span><br><span class="line">此外，[<span class="number">14</span>]将相关知识的表示连接起来作为prompt learning的演示，从而产生更好的泛化能力。</span><br></pre></td></tr></table></figure></p>
<p>2.如算法4.1所示，query-based fusions的伪代码：<br />
<img src="/images/RAG/6.query_base_fusions.png" width="55%"></p>
<p>（1）对于使用text
concatenation的[49,122]：首先将检索结果和输入concat起来（第2行），然后将concat结果输入到生成器（第3行）。注意，目前LLMs对输入长度有限制，太多的检索结果concat后会导致输入过长而被LLMs截断。因此，设计prompt
template是text concatenation一个关键步骤。<br />
（2）对于使用feature
concatenation的[48,66]：首先将检索结果和输入进行编码得到特征（第5行），然后将检索结果和输入特征concat（第6行），作为输入给生成器（第7行）。由于序列长度过长，导致产生较高的内存成本。</p>
<h1
id="retrieval-augmented-generation-for-ai-generated-content-a-survey">Retrieval-Augmented
Generation for AI-Generated Content: A Survey</h1>
<h2 id="摘要-1">摘要</h2>
<h1 id="参考文献">参考文献</h1>
<p><span class="exturl" data-url="aHR0cHM6Ly9hcnhpdi5vcmcvcGRmLzI0MDcuMTMxOTM=">Retrieval-Augmented
Generation for Natural Language Processing: A Survey<i class="fa fa-external-link-alt"></i></span><br />
<span class="exturl" data-url="aHR0cHM6Ly9hcnhpdi5vcmcvYWJzLzI0MDIuMTk0NzM=">Retrieval-Augmented
Generation for AI-Generated Content: A Survey<i class="fa fa-external-link-alt"></i></span><br />
<span class="exturl" data-url="aHR0cHM6Ly9naXRodWIuY29tL2h5bWllMTIyL1JBRy1TdXJ2ZXk=">Retrieval-Augmented
Generation for AI-Generated Content: A Survey参考文献整理<i class="fa fa-external-link-alt"></i></span></p>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="https://soundmemories.github.io/2024/04/02/Web/01.html%E5%92%8Ccss/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avstar.png">
      <meta itemprop="name" content="SoundMemories">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="SoundMemories">
      <meta itemprop="description" content="今日事，今日毕">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | SoundMemories">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2024/04/02/Web/01.html%E5%92%8Ccss/" class="post-title-link" itemprop="url">html和css</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>

      <time title="创建时间：2024-04-02 00:00:00" itemprop="dateCreated datePublished" datetime="2024-04-02T00:00:00+08:00">2024-04-02</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">分类于</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/Web/" itemprop="url" rel="index"><span itemprop="name">Web</span></a>
        </span>
    </span>

  
    <span class="post-meta-break"></span>
    <span class="post-meta-item" title="本文字数">
      <span class="post-meta-item-icon">
        <i class="far fa-file-word"></i>
      </span>
      <span class="post-meta-item-text">本文字数：</span>
      <span>3.4k</span>
    </span>
    <span class="post-meta-item" title="阅读时长">
      <span class="post-meta-item-icon">
        <i class="far fa-clock"></i>
      </span>
      <span class="post-meta-item-text">阅读时长 &asymp;</span>
      <span>13 分钟</span>
    </span>
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <h1 id="html">Html</h1>
<h2 id="文档声明">文档声明</h2>
<p>html开头的文档声明，是告诉浏览器使用HTML标准，采用标准模式渲染页面，避免进入怪异模式：<br />
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;!Doctype <span class="keyword">html</span>&gt;</span></span><br></pre></td></tr></table></figure></p>
<h2 id="页面模板">页面模板</h2>
<p>最基础的页面模板，包含文档声明、头head、体body：<br />
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;!DOCTYPE <span class="keyword">html</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">html</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">meta</span> <span class="attr">charset</span>=<span class="string">&quot;utf-8&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">title</span>&gt;</span>小乐的交友网站<span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure></p>
<h2 id="如何注释">如何注释</h2>
<p>html可以如下这样注释，vscode快捷键是<code>ctrl+/</code>：<br />
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- 这是注释内容 --&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">&lt;!--</span></span><br><span class="line"><span class="comment">    这是注释的内容</span></span><br><span class="line"><span class="comment">    这是注释的内容</span></span><br><span class="line"><span class="comment">--&gt;</span></span><br></pre></td></tr></table></figure></p>
<h2 id="路径写法">路径写法</h2>
<p><strong>当前文件：</strong> html文件。<br />
<strong>目标文件：</strong> 被引用的文件。</p>
<p><strong>1.绝对路径</strong>：<br />
<strong>网络绝对路径：</strong> 目标文字在万维网上的绝对地址，如
<code>https://www.baidu.com/img/xx.png</code>，前端开发主要使用网络绝对路径。<br />
<strong>本地绝对路径：</strong> 目标文字在计算上的绝对地址, 如
<code>D:\Library\xx.jpg</code>，后端开发主要使用本地绝对路径。</p>
<p><strong>2.相对路径</strong>：<br />
<code>./</code>：当前目录（当前文件所在的目录），
<code>./</code>可以省略，适用于目标文件在同级或者下级。<br />
<code>../</code>：上级目录（当前文件的上级目录），不可以省略，适用于目标文件在上级或者先进入上级再访问所在目录。<br />
<code>../../</code>：上上级。</p>
<p><strong>HTML中使用路径的场景</strong>：<br />
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">1. img 标签引入图片</span><br><span class="line">2. 超链接设置目标文件</span><br><span class="line">3. video 标签引入视频</span><br><span class="line">4. audio 标签引入音频</span><br><span class="line">5. iframe 标签引入各种类型的文件</span><br><span class="line">6. link 标签关联 css 文件</span><br><span class="line">7. script 标签引入 js 文件</span><br><span class="line">...</span><br></pre></td></tr></table></figure></p>
<h2 id="标签基础">标签基础</h2>
<p>1.标签是 HTML 的基本组成，也叫元素；<br />
2.标签里面可以包裹标签，被包裹的标签一定要缩进，同级的标签一定要对齐；<br />
3.标签分双标签和单标签：<strong>双标签</strong>由开始标签和结束标签组成，结束标签需要
<code>/</code>；<strong>单标签</strong>也称为自闭和标签，标准中也有
<code>/</code> ，可以省略；<br />
4.标签具有语义，语义决定什么时候使用该标签；<br />
5.标签名不区分大小写。</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">标签名</span>&gt;</span>内容<span class="tag">&lt;/<span class="name">标签名</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">标签名</span> /&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">标签名</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>如何掌握一个 HTML 标签：<br />
1.标签的语义和功能；<br />
2.该标签有哪些属性以及属性的值如何设置；<br />
3.该标签是单标签还是双标签。</p>
<h2 id="标签属性">标签属性</h2>
<p>1.属性是属于标签的，不同的标签有不同的属性；<br />
2.属性由属性名和属性值组成，属性值使用单引号或双引号包裹，或者不使用引号；<br />
3.标签中，同名的属性不能设置多次，如果设置后面的属性不会生效；<br />
4.属性不区分大小写。</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">标签名</span> <span class="attr">属性名1</span>=<span class="string">&quot;属性值&quot;</span> <span class="attr">属性名2</span>=<span class="string">&quot;属性值&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">标签名</span>&gt;</span></span><br></pre></td></tr></table></figure>
<h2 id="标签总结">标签总结</h2>
<h3 id="主标签">主标签</h3>
<table>
<thead>
<tr class="header">
<th>标签名</th>
<th>语义和功能</th>
<th>属性</th>
<th>单or双标签</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>html</td>
<td>根元素</td>
<td>无</td>
<td>双</td>
</tr>
<tr class="even">
<td>head</td>
<td>头</td>
<td>无</td>
<td>双</td>
</tr>
<tr class="odd">
<td>body</td>
<td>主体</td>
<td>无</td>
<td>双</td>
</tr>
</tbody>
</table>
<p>head中的标签：</p>
<table>
<colgroup>
<col style="width: 8%" />
<col style="width: 18%" />
<col style="width: 51%" />
<col style="width: 21%" />
</colgroup>
<thead>
<tr class="header">
<th>标签名</th>
<th>语义和功能</th>
<th>属性</th>
<th>单or双标签</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>meta</td>
<td>设置页面元信息</td>
<td>charset: 设置字符集编码，推荐utf-8</td>
<td>单标签</td>
</tr>
<tr class="even">
<td>title</td>
<td>标题栏标题</td>
<td></td>
<td>双标签</td>
</tr>
</tbody>
</table>
<h3 id="排版标签body内">排版标签（body内）</h3>
<p>排版标签都会自己占一行，使用嵌套要注意。</p>
<table>
<thead>
<tr class="header">
<th>标签名</th>
<th>语义和功能</th>
<th>属性</th>
<th>单or双标签</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>h1 ~ h6</td>
<td>一级标题~六级标题</td>
<td>无</td>
<td>双</td>
</tr>
<tr class="even">
<td>p</td>
<td>段落</td>
<td>无</td>
<td>双</td>
</tr>
<tr class="odd">
<td>hr</td>
<td>分隔线</td>
<td>无</td>
<td>单</td>
</tr>
<tr class="even">
<td>br</td>
<td>换行</td>
<td>无</td>
<td>单</td>
</tr>
<tr class="odd">
<td>pre</td>
<td>原格式显示，一般用于代码块，配合css</td>
<td>无</td>
<td>双</td>
</tr>
<tr class="even">
<td>div</td>
<td>无语义，用于页面布局，可嵌套，配合css</td>
<td>无</td>
<td>双</td>
</tr>
</tbody>
</table>
<h3 id="文本标签排版标签内">文本标签（排版标签内）</h3>
<table>
<thead>
<tr class="header">
<th>标签名</th>
<th>语义和功能</th>
<th>属性</th>
<th>单or双标签</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>em</td>
<td>强调，默认表现斜体字</td>
<td>无</td>
<td>双</td>
</tr>
<tr class="even">
<td>strong</td>
<td>强调，默认表现粗体字</td>
<td>无</td>
<td>双</td>
</tr>
<tr class="odd">
<td>ins</td>
<td>表示增加的内容，默认有下划线</td>
<td>无</td>
<td>双</td>
</tr>
<tr class="even">
<td>del</td>
<td>表示删除的内容，默认有删除线</td>
<td>无</td>
<td>双</td>
</tr>
<tr class="odd">
<td>sub</td>
<td>下标字</td>
<td>无</td>
<td>双</td>
</tr>
<tr class="even">
<td>sup</td>
<td>上标字</td>
<td>无</td>
<td>双</td>
</tr>
<tr class="odd">
<td>span</td>
<td>无语义，配合CSS给文字设置样式</td>
<td>无</td>
<td>双</td>
</tr>
</tbody>
</table>
<p>了解即可：<br />
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">cite</span>&gt;</span>  用于引证、举例、标签定义作品（比如书籍、歌曲、电影、电视节目、绘画、雕塑等的标题），通常为斜体字</span><br><span class="line"><span class="tag">&lt;<span class="name">dfn</span>&gt;</span>   定义一个定义项目</span><br><span class="line"><span class="tag">&lt;<span class="name">code</span>&gt;</span>  定义计算机代码文本</span><br><span class="line"><span class="tag">&lt;<span class="name">samp</span>&gt;</span>  定义样式文本。标签并不经常使用，只有在要从正常的上下文中将某些短字符序列提取出来，对它们加以强调的极少情况下，才使用这个标签</span><br><span class="line"><span class="tag">&lt;<span class="name">kbd</span>&gt;</span>   定义键盘文本。它表示文本是从键盘上键入的。它经常用在与计算机相关的文档或手册中</span><br><span class="line"><span class="tag">&lt;<span class="name">abbr</span>&gt;</span>  定义缩写。配合title属性，需IE6以上</span><br><span class="line"><span class="tag">&lt;<span class="name">bdo</span>&gt;</span>   来覆盖默认的文本方向。dir属性 值: lrt  rtl</span><br><span class="line"><span class="tag">&lt;<span class="name">var</span>&gt;</span>   定义变量。可以将此标签与 <span class="tag">&lt;<span class="name">pre</span>&gt;</span> 及 <span class="tag">&lt;<span class="name">code</span>&gt;</span> 标签配合使用</span><br><span class="line"><span class="tag">&lt;<span class="name">small</span>&gt;</span> 标签定义小型文本（和旁注）</span><br><span class="line"><span class="tag">&lt;<span class="name">b</span>&gt;</span>     粗体字标签；根据HTML5的规范，<span class="tag">&lt;<span class="name">b</span>&gt;</span> 标签应该做为最后的选择，只有在没有其他标记比较合适时才使用它</span><br><span class="line"><span class="tag">&lt;<span class="name">i</span>&gt;</span>     斜体字标签；标签被用来表示科技术语、其他语种的成语俗语、想法、宇宙飞船的名字等</span><br><span class="line"><span class="tag">&lt;<span class="name">u</span>&gt;</span>     下划线字体标签。标签定义与常规文本风格不同的文本，像拼写错误的单词或者汉语中的专有名词。请尽量避免使用该标签为文本加下划线，用户会把它混淆为一个超链接</span><br><span class="line"><span class="tag">&lt;<span class="name">q</span>&gt;</span>     签定义一个短的引用。浏览器经常会在这种引用的周围插入引号。(小段文字)</span><br><span class="line"><span class="tag">&lt;<span class="name">blockquote</span>&gt;</span> 标签定义摘自另一个源的块引用。浏览器通常会对 <span class="tag">&lt;<span class="name">blockquote</span>&gt;</span> 元素进行缩进。(大段文字)(块状元素)</span><br><span class="line"><span class="tag">&lt;<span class="name">address</span>&gt;</span> 定义地址。通常为斜体 (注意非通讯地址) ，块状元素</span><br><span class="line"><span class="tag">&lt;<span class="name">font</span>&gt;</span>   H5已删除 字体标签，可以通过标签的属性指定文字的大小、颜色及字体等信息</span><br><span class="line"><span class="tag">&lt;<span class="name">tt</span>&gt;</span>     H5已删除 打字机文字</span><br><span class="line"><span class="tag">&lt;<span class="name">big</span>&gt;</span>    H5已删除 大型字体标签</span><br><span class="line"><span class="tag">&lt;<span class="name">strike</span>&gt;</span> H5已删除 添加删除线</span><br><span class="line"><span class="tag">&lt;<span class="name">acronym</span>&gt;</span>H5已删除 首字母缩写 请使用<span class="tag">&lt;<span class="name">abbr</span>&gt;</span>代替</span><br></pre></td></tr></table></figure></p>
<h3 id="图片标签">图片标签</h3>
<p>常见图片后缀有：jpg、jpeg、png、gif、bmp、webp。<br />
如果单独设置宽度或者高度，另一个方向根据比例自动计算。同时设置宽高容易导致图片拉伸失真。</p>
<table>
<colgroup>
<col style="width: 11%" />
<col style="width: 19%" />
<col style="width: 47%" />
<col style="width: 21%" />
</colgroup>
<thead>
<tr class="header">
<th>标签名</th>
<th>语义和功能</th>
<th>属性</th>
<th>单or双标签</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>img</td>
<td>引入图片</td>
<td>src：图片地址。alt：图片替代文字，图片无法正常显示时显示此文字。<br>width：宽度。height：高度。宽高默认单位都是像素。</td>
<td>单</td>
</tr>
</tbody>
</table>
<p>base64编码图片:<br />
1.本质：一串特殊的文本，要通过浏览器打开，传统看图应用通常无法打开。<br />
2.原理：把图片进行 base64 编码，形成一串文本。<br />
3.如何生成：靠一些工具或网站，https://tool.chinaz.com/tools/imgtobase/。<br />
4.如何使用：直接作为 img 标签的 src
属性的值即可，并且不受文件位置的影响。<br />
5.使用场景：一些较小的图片，或者需要和网页一起加载的图片。</p>
<h3 id="超链接和锚点">超链接和锚点</h3>
<p><strong>a标签</strong>：target
属性设置目标文件在哪个窗口打开，默认值是
<code>_self</code>，表示本窗口打开；可以设置为 <code>_blank</code>,
表示新窗口打开。</p>
<table>
<colgroup>
<col style="width: 10%" />
<col style="width: 17%" />
<col style="width: 44%" />
<col style="width: 27%" />
</colgroup>
<thead>
<tr class="header">
<th>标签名</th>
<th>语义和功能</th>
<th>属性</th>
<th>单or双标签</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>a</td>
<td>超链接</td>
<td>href：设置目标文件地址。target：设置目标文件在哪个窗口打开。</td>
<td>双</td>
</tr>
</tbody>
</table>
<p>超链接可以使用文字、图片等触发：<br />
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- 文字 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">&quot;https://www.163.com/xx.html&quot;</span>&gt;</span>测试<span class="tag">&lt;/<span class="name">a</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">&lt;!-- 图片 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">&quot;https://www.163.com/xx.html&quot;</span>&gt;</span>测试</span><br><span class="line">    <span class="tag">&lt;<span class="name">img</span> <span class="attr">src</span>=<span class="string">&quot;xx.jpg&quot;</span> <span class="attr">alt</span>=<span class="string">&quot;&quot;</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">a</span>&gt;</span></span><br></pre></td></tr></table></figure></p>
<p>超链接目标文件主要为两种：<br />
1.浏览器能够打开：点击超链接，浏览器直接打开，如网页文件、图片文件、视频文件、pdf文件等。<br />
2.浏览器无法打开：点击超链接，直接下载。<br />
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- 目标是网页 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">&quot;../pages/index.html&quot;</span>&gt;</span>相对路径<span class="tag">&lt;/<span class="name">a</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">&lt;!-- 目标是非网页文件 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">&quot;D:/Library/xx.jpg&quot;</span>&gt;</span>[图片]绝对路径<span class="tag">&lt;/<span class="name">a</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">&quot;./resouces/xx.pdf&quot;</span>&gt;</span>[pdf]测试<span class="tag">&lt;/<span class="name">a</span>&gt;</span></span><br></pre></td></tr></table></figure></p>
<p>超链接其他功能：<br />
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- 唤起指定应用 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">&quot;tel:10086&quot;</span>&gt;</span>打电话<span class="tag">&lt;/<span class="name">a</span>&gt;</span> <span class="tag">&lt;<span class="name">br</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">&quot;sms:10010&quot;</span>&gt;</span>发短信<span class="tag">&lt;/<span class="name">a</span>&gt;</span> <span class="tag">&lt;<span class="name">br</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">&quot;mailto:xx@xxx.cn&quot;</span>&gt;</span>发邮件<span class="tag">&lt;/<span class="name">a</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">&lt;!-- 空值刷新功能 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">&quot;&quot;</span>&gt;</span>刷新<span class="tag">&lt;/<span class="name">a</span>&gt;</span></span><br></pre></td></tr></table></figure></p>
<p><strong>超链接锚点</strong>：类似目录的跳转，跳转到 id
指定地方。<br />
1.如何设置锚点：给标签设置一个 id 属性，该标签就成为一个锚点， id
的属性值就是锚点的名字。<br />
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">id</span>=<span class="string">&quot;锚点名&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">p</span> <span class="attr">id</span>=<span class="string">&quot;锚点名&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">hr</span> <span class="attr">id</span>=<span class="string">&quot;锚点名&quot;</span>&gt;</span></span><br></pre></td></tr></table></figure></p>
<p>2.如何跳转到锚点：通过超链接跳转到锚点。<br />
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- 跳转到本页面的锚点 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">&quot;#锚点名&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">a</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">&lt;!-- 跳转到其他页面的锚点 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">&quot;页面地址#锚点名&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">a</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">&lt;!-- 跳转到页面顶部 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">&quot;#&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">a</span>&gt;</span></span><br></pre></td></tr></table></figure></p>
<h3 id="列表标签">列表标签</h3>
<table>
<colgroup>
<col style="width: 22%" />
<col style="width: 33%" />
<col style="width: 14%" />
<col style="width: 29%" />
</colgroup>
<thead>
<tr class="header">
<th>标签名</th>
<th>功能和语义</th>
<th>属性</th>
<th>单or双标签</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>ul</td>
<td>无序列表，包裹其他标签</td>
<td></td>
<td>双</td>
</tr>
<tr class="even">
<td>ol</td>
<td>有序列表，包裹其他标签</td>
<td></td>
<td>双</td>
</tr>
<tr class="odd">
<td>li</td>
<td>列表项，<strong>li必须被 ul 或者 ol 直接包裹！</strong></td>
<td></td>
<td>双</td>
</tr>
<tr class="even">
<td>dl</td>
<td>定义列表，包裹其他标签</td>
<td></td>
<td>双</td>
</tr>
<tr class="odd">
<td>dt</td>
<td>定义列表项标题</td>
<td></td>
<td>双</td>
</tr>
<tr class="even">
<td>dd</td>
<td>定义列表项描述</td>
<td></td>
<td>双</td>
</tr>
</tbody>
</table>
<p><strong>1.无序列表</strong>：用于表示一组相关的内容，如新闻列表、文章列表、商品列表、导航
等。</p>
<div class="tabs" id="1"><ul class="nav-tabs"><li class="tab active"><a href="#1-1">文字无序列表</a></li><li class="tab"><a href="#1-2">超链接无序列表</a></li><li class="tab"><a href="#1-3">嵌套无序列表</a></li></ul><div class="tab-content"><div class="tab-pane active" id="1-1"><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">ul</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">li</span>&gt;</span>HTML：超文本标记语言<span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">li</span>&gt;</span>CSS：层叠样式表<span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">li</span>&gt;</span>JavaScript：浏览器端脚本语言<span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">ul</span>&gt;</span></span><br></pre></td></tr></table></figure></div><div class="tab-pane" id="1-2"><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">ul</span>&gt;</span></span><br><span class="line">     <span class="tag">&lt;<span class="name">li</span>&gt;</span></span><br><span class="line">         <span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">&quot;#&quot;</span>&gt;</span>携手向未来！习近平谈构建人类命运共同体<span class="tag">&lt;/<span class="name">a</span>&gt;</span></span><br><span class="line">     <span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br><span class="line">     <span class="tag">&lt;<span class="name">li</span>&gt;</span></span><br><span class="line">         <span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">&quot;#&quot;</span>&gt;</span>命运与共携手建设更加美好的世界<span class="tag">&lt;/<span class="name">a</span>&gt;</span></span><br><span class="line">     <span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">ul</span>&gt;</span></span><br><span class="line"></span><br></pre></td></tr></table></figure></div><div class="tab-pane" id="1-3"><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">ul</span>&gt;</span></span><br><span class="line">     <span class="tag">&lt;<span class="name">li</span>&gt;</span></span><br><span class="line">         <span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">&quot;#&quot;</span>&gt;</span>首页<span class="tag">&lt;/<span class="name">a</span>&gt;</span></span><br><span class="line">     <span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br><span class="line">     <span class="tag">&lt;<span class="name">li</span>&gt;</span></span><br><span class="line">         <span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">&quot;#&quot;</span>&gt;</span>论坛<span class="tag">&lt;/<span class="name">a</span>&gt;</span></span><br><span class="line">     <span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br><span class="line">     <span class="tag">&lt;<span class="name">li</span>&gt;</span></span><br><span class="line">         <span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">&quot;#&quot;</span>&gt;</span>关于我们<span class="tag">&lt;/<span class="name">a</span>&gt;</span></span><br><span class="line">         <span class="tag">&lt;<span class="name">ul</span>&gt;</span>   <span class="comment">&lt;!-- li外面必须ul包裹，不然会拉成和前面标签同级别 --&gt;</span></span><br><span class="line">             <span class="tag">&lt;<span class="name">li</span>&gt;</span></span><br><span class="line">                 <span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">&quot;#&quot;</span>&gt;</span>联系我们<span class="tag">&lt;/<span class="name">a</span>&gt;</span></span><br><span class="line">             <span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br><span class="line">             <span class="tag">&lt;<span class="name">li</span>&gt;</span></span><br><span class="line">                 <span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">&quot;#&quot;</span>&gt;</span>加入我们<span class="tag">&lt;/<span class="name">a</span>&gt;</span></span><br><span class="line">             <span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br><span class="line">         <span class="tag">&lt;/<span class="name">ul</span>&gt;</span></span><br><span class="line">     <span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br><span class="line">     <span class="tag">&lt;<span class="name">li</span>&gt;</span></span><br><span class="line">         <span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">&quot;#&quot;</span>&gt;</span>商城<span class="tag">&lt;/<span class="name">a</span>&gt;</span></span><br><span class="line">     <span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br><span class="line">     <span class="tag">&lt;<span class="name">li</span>&gt;</span></span><br><span class="line">         <span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">&quot;#&quot;</span>&gt;</span>博客<span class="tag">&lt;/<span class="name">a</span>&gt;</span></span><br><span class="line">     <span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">ul</span>&gt;</span></span><br></pre></td></tr></table></figure></div></div></div>
<p><strong>2.有序列表</strong>：有序列表可以用于<strong>排序类</strong>的列表，如排行榜等。有序列表嵌套方式和无序列表一样，这里不再演示。<br />
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">ol</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">li</span>&gt;</span>巴菲特<span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">li</span>&gt;</span>索罗斯<span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">li</span>&gt;</span>马云<span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">ol</span>&gt;</span></span><br></pre></td></tr></table></figure></p>
<p><strong>3.自定义列表</strong>：<br />
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- dl自定义列表 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dl</span>&gt;</span> </span><br><span class="line">    <span class="comment">&lt;!-- 一个dt对应一个dd --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dt</span>&gt;</span>HTML<span class="tag">&lt;/<span class="name">dt</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dd</span>&gt;</span>超文本标记语言<span class="tag">&lt;/<span class="name">dd</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dt</span>&gt;</span>CSS<span class="tag">&lt;/<span class="name">dt</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dd</span>&gt;</span>层叠样式表<span class="tag">&lt;/<span class="name">dd</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dt</span>&gt;</span>JavaScript<span class="tag">&lt;/<span class="name">dt</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dd</span>&gt;</span>浏览器端脚本语言<span class="tag">&lt;/<span class="name">dd</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dl</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">dl</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- 一个dt对应多个dd --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dt</span>&gt;</span>如何掌握一个HTML标签？<span class="tag">&lt;/<span class="name">dt</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dd</span>&gt;</span>该标签的语义功能<span class="tag">&lt;/<span class="name">dd</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dd</span>&gt;</span>该标签的属性以及属性值如何设置<span class="tag">&lt;/<span class="name">dd</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dd</span>&gt;</span>该标签是单标签还是双标签<span class="tag">&lt;/<span class="name">dd</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dl</span>&gt;</span></span><br></pre></td></tr></table></figure></p>
<h3 id="表格标签">表格标签</h3>
<table>
<colgroup>
<col style="width: 12%" />
<col style="width: 22%" />
<col style="width: 35%" />
<col style="width: 29%" />
</colgroup>
<thead>
<tr class="header">
<th>标签名</th>
<th>功能和语义</th>
<th>属性</th>
<th>单标签还是双标签</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>table</td>
<td>包裹表格元素</td>
<td>width、height、cellspacing、cellpadding、border、align</td>
<td>双标签</td>
</tr>
<tr class="even">
<td>caption</td>
<td>表格的标题</td>
<td></td>
<td>双标签</td>
</tr>
<tr class="odd">
<td>thead</td>
<td>表格头</td>
<td>align、valign</td>
<td>双标签</td>
</tr>
<tr class="even">
<td>tbody</td>
<td>表格体</td>
<td>align、valign</td>
<td>双标签</td>
</tr>
<tr class="odd">
<td>tfoot</td>
<td>表格脚</td>
<td>align、valign</td>
<td>双标签</td>
</tr>
<tr class="even">
<td>tr</td>
<td>普通行</td>
<td>height、align、valign</td>
<td>双标签</td>
</tr>
<tr class="odd">
<td>td</td>
<td>普通单元格</td>
<td>width、height、align、valign、colspan、rowspan</td>
<td>双标签</td>
</tr>
<tr class="even">
<td>th</td>
<td>表头中的单元格</td>
<td>width、height、align、valign、colspan、rowspan</td>
<td>双标签</td>
</tr>
</tbody>
</table>
<p><strong>1.表格的结构</strong><br />
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">table</span><br><span class="line">    caption <span class="comment"># 表格的标题</span></span><br><span class="line">    thead  <span class="comment"># 表格的头部</span></span><br><span class="line">        tr</span><br><span class="line">            td/th</span><br><span class="line">            ....</span><br><span class="line">        tr</span><br><span class="line">        ...</span><br><span class="line">    tbody  <span class="comment"># 表格的主体</span></span><br><span class="line">        tr</span><br><span class="line">            td/th</span><br><span class="line">            ...</span><br><span class="line">        tr</span><br><span class="line">        ...</span><br><span class="line">    tfoot  <span class="comment"># 表格的脚部</span></span><br><span class="line">        tr</span><br><span class="line">            td/th</span><br><span class="line">            ...</span><br><span class="line">        tr</span><br><span class="line">        ...</span><br></pre></td></tr></table></figure></p>
<p><strong>2 设置表格整体样式</strong><br />
给 <strong>table</strong> 标签设置如下属性：<br />
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 值得单位为像素</span></span><br><span class="line">width：设置宽度。</span><br><span class="line">height: 设置高度，一般不设置高度，由内容撑开。</span><br><span class="line">cellspacing：设置单元格之间的间距。</span><br><span class="line">cellpadding：设置单元格内补白（边框与内容的间距）。</span><br><span class="line">border：设置边框边框。</span><br><span class="line">align：设置整个表格相对页面的对齐方式，值为left、right、center。</span><br></pre></td></tr></table></figure></p>
<p><strong>3.设置单元格宽高</strong><br />
给 <strong>td、th</strong> 标签设置宽高属性：<br />
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 同一行/列中，设置多个td、th的宽度/高度，以最大值为准。</span></span><br><span class="line">给一个td、th设置width相当于设置了列宽，这一列（其他td、th）宽度都是这个值。</span><br><span class="line">给一个td、th设置height相当于设置行高，这一行（其他td、th）宽度都是这个值。</span><br><span class="line"><span class="comment"># 给 th、td 和 tr 设置 height 有什么区别？</span></span><br><span class="line">给th、td设置height，实际行高会在设置的高度的基础上加上，上下的cellpadding。</span><br><span class="line">给tr设置得height就是实际的行高。</span><br></pre></td></tr></table></figure></p>
<p><strong>4.1设置单元格内容，横向对齐方式</strong><br />
设置 align 属性，值为left、right、center：<br />
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 外层和内层都设置了，就近原则，离得近的优先生效。</span></span><br><span class="line">给thead、tbody、tfoot设置：当前标签下，所包裹的单元格都会生效。</span><br><span class="line">给tr设置：当前标签下，所包裹的单元格都会生效。</span><br><span class="line">给td、th设置：本单元格会生效。</span><br></pre></td></tr></table></figure></p>
<p><strong>4.2设置单元格内容，纵向对齐方式：</strong><br />
设置 valign 属性，值为top、bottom、middle：<br />
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 外层和内层都设置了，就近原则，单元格离哪个近，优先使用哪个设置。</span></span><br><span class="line">给thead、tbody、tfoot设置：当前标签下，所包裹的单元格都会生效。</span><br><span class="line">给tr设置：当前标签下，所包裹的单元格都会生效。</span><br><span class="line">给td、th设置：本单元格会生效。</span><br></pre></td></tr></table></figure></p>
<p><strong>5.单元格跨行和跨列（合并单元格）（重要）</strong><br />
给 <strong>td、th</strong> 标签设置属性：<br />
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 跨行/跨列都只在第一次出现的单元格设置，后面的单元格不用设置，也因此后面的单元格会少一行/一列。</span></span><br><span class="line">rowspan：设置所跨行数。</span><br><span class="line">colspan：设置所跨列数。</span><br></pre></td></tr></table></figure></p>
<h1 id="参考资料">参考资料</h1>
<p><span class="exturl" data-url="aHR0cHM6Ly9odG1sLnNwZWMud2hhdHdnLm9yZy9tdWx0aXBhZ2Uv">W3C官方html和css设计文档<i class="fa fa-external-link-alt"></i></span><br />
<span class="exturl" data-url="aHR0cHM6Ly93d3cudzNjc2Nob29sLmNuL2h0bWx0YWdzLw==">W3Cscholl的中文文档<i class="fa fa-external-link-alt"></i></span><br />
<span class="exturl" data-url="aHR0cHM6Ly9kZXZlbG9wZXIubW96aWxsYS5vcmcvemgtQ04vZG9jcy9XZWIvSFRNTA==">MDN<i class="fa fa-external-link-alt"></i></span></p>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="https://soundmemories.github.io/2024/03/21/Other/%E7%B3%BB%E7%BB%9F%E5%AE%89%E8%A3%85%E5%92%8C%E7%8E%AF%E5%A2%83%E9%85%8D%E7%BD%AE/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avstar.png">
      <meta itemprop="name" content="SoundMemories">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="SoundMemories">
      <meta itemprop="description" content="今日事，今日毕">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | SoundMemories">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2024/03/21/Other/%E7%B3%BB%E7%BB%9F%E5%AE%89%E8%A3%85%E5%92%8C%E7%8E%AF%E5%A2%83%E9%85%8D%E7%BD%AE/" class="post-title-link" itemprop="url">系统安装和环境配置</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>

      <time title="创建时间：2024-03-21 00:00:00" itemprop="dateCreated datePublished" datetime="2024-03-21T00:00:00+08:00">2024-03-21</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">分类于</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/Other/" itemprop="url" rel="index"><span itemprop="name">Other</span></a>
        </span>
    </span>

  
    <span class="post-meta-break"></span>
    <span class="post-meta-item" title="本文字数">
      <span class="post-meta-item-icon">
        <i class="far fa-file-word"></i>
      </span>
      <span class="post-meta-item-text">本文字数：</span>
      <span>4.1k</span>
    </span>
    <span class="post-meta-item" title="阅读时长">
      <span class="post-meta-item-icon">
        <i class="far fa-clock"></i>
      </span>
      <span class="post-meta-item-text">阅读时长 &asymp;</span>
      <span>15 分钟</span>
    </span>
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <h2 id="系统选择">系统选择</h2>
<p>Ubantu系统可以去<span class="exturl" data-url="aHR0cHM6Ly9jbi51YnVudHUuY29tLw==">官网<i class="fa fa-external-link-alt"></i></span>上寻找和下载，主要分为以下两个版本：<br />
<strong>Ubuntu桌面版</strong>：个人用户使用，带有图形界面，类似windows。<br />
<strong>Ubuntu
Server版</strong>：纯服务器版本，给企业作为服务器使用，不带图形界面。</p>
<p>型号的选择一般选择较新的版本，这里选择 <strong>Ubuntu Service 22.04.4
LTS</strong>，LTS是指长期维护的版本，选择好后直接下载即可。</p>
<h2 id="u盘镜像">U盘镜像</h2>
<p>需要将下载好的系统制作成U盘镜像，这样才能在系统启动时安装Ubantu系统，这里使用了<span class="exturl" data-url="aHR0cHM6Ly9ldGNoZXIuYmFsZW5hLmlvLw==">balenaEtcher<i class="fa fa-external-link-alt"></i></span>工具制作U盘镜像，Unabntu官网也给出了具体制作教程：<span class="exturl" data-url="aHR0cHM6Ly91YnVudHUuY29tL3R1dG9yaWFscy9pbnN0YWxsLXVidW50dS1kZXNrdG9wIzMtY3JlYXRlLWEtYm9vdGFibGUtdXNiLXN0aWNr">Create
a Bootable USB stick<i class="fa fa-external-link-alt"></i></span>。</p>
<p>系统具体的安装步骤可参考<span class="exturl" data-url="aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3lqdW44OS9hcnRpY2xlL2RldGFpbHMvMTMxMzQ0OTQw">Ubuntu
Server版本选择及安装<i class="fa fa-external-link-alt"></i></span>和<span class="exturl" data-url="aHR0cHM6Ly96aHVhbmxhbi56aGlodS5jb20vcC82NjA0MzYwOTY/dXRtX2lkPTA=">Ubuntu server
20.04详细安装教程<i class="fa fa-external-link-alt"></i></span>。</p>
<h2 id="系统配置">系统配置</h2>
<p>1.安装完成后可按需执行命令：<br />
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 更新软件包列表</span></span><br><span class="line">sudo apt update</span><br><span class="line"><span class="comment"># 所有已安装的包至最新版本</span></span><br><span class="line">sudo apt upgrade</span><br><span class="line"><span class="comment"># 可以进行内核升级</span></span><br><span class="line">sudo apt dist-upgrade</span><br></pre></td></tr></table></figure></p>
<p>2.查看是否开启休眠模式：<br />
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">systemctl status sleep.target</span><br></pre></td></tr></table></figure></p>
<p>sleep状态是loaded，表示自动休眠模式是处于开启状态，显示如下：<br />
<img src="/images/系统安装和环境配置/1.系统配置.png" width="60%"></p>
<p>执行关闭休眠功能的命令：<br />
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo systemctl mask sleep.target suspend.target hibernate.target hybrid-sleep.target</span><br></pre></td></tr></table></figure></p>
<p>执行后返回结果和再次查看状态：<br />
<img src="/images/系统安装和环境配置/2.系统配置.png" width="80%"></p>
<p><img src="/images/系统安装和环境配置/3.系统配置.png" width="60%"></p>
<p>想要恢复休眠可执行：<br />
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo systemctl unmask sleep.target suspend.target hibernate.target hybrid-sleep.target</span><br></pre></td></tr></table></figure></p>
<h2 id="ssh配置">Ssh配置</h2>
<p>增加远程ssh的root访问权限：<br />
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 切换到root</span></span><br><span class="line">su root</span><br><span class="line"><span class="comment"># 修改sshd_config文件</span></span><br><span class="line">vim /etc/ssh/sshd_config</span><br></pre></td></tr></table></figure></p>
<p>sshd_config最后一行增加如下，保存退出：<br />
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#PermitRootLogin prohibit-password </span></span><br><span class="line">PermitRootLogin <span class="built_in">yes</span></span><br></pre></td></tr></table></figure></p>
<p>执行下面命令重启：<br />
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">/etc/init.d/ssh restart</span><br></pre></td></tr></table></figure></p>
<h2 id="nvidia驱动">Nvidia驱动</h2>
<p>1.先卸载所有的驱动：<br />
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo apt remove nvidia*</span><br></pre></td></tr></table></figure></p>
<p>2.更新软件列表和安装必要软件、依赖：<br />
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">sudo apt update</span><br><span class="line">sudo apt install g++</span><br><span class="line">sudo apt install gcc</span><br><span class="line">sudo apt install make</span><br></pre></td></tr></table></figure></p>
<p>3.查询硬件(显卡)信息：<br />
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">lspci | grep -i nvidia</span><br></pre></td></tr></table></figure></p>
<p>显卡信息如下：<br />
<img src="/images/系统安装和环境配置/1.显卡信息.png" width="80%"></p>
<p>4.去<span class="exturl" data-url="aHR0cHM6Ly93d3cubnZpZGlhLmNuL0Rvd25sb2FkL2luZGV4LmFzcHg/bGFuZz1jbg==">官网<i class="fa fa-external-link-alt"></i></span>下载对应驱动:<br />
<img src="/images/系统安装和环境配置/2.显卡驱动.png" width="50%"></p>
<p>5.搜索后下载，下载的驱动文件是.run结尾：<br />
<img src="/images/系统安装和环境配置/3.显卡驱动.png" width="50%"></p>
<p>6.禁用默认nouveau驱动，此驱动是Ubantu自带的Nvidia驱动，我们需要禁止掉：<br />
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo vim /etc/modprobe.d/blacklist.conf</span><br></pre></td></tr></table></figure></p>
<p>7.在文件末尾添加：<br />
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">blacklist nouveau</span><br><span class="line">options nouveau modeset=0</span><br></pre></td></tr></table></figure></p>
<p>8.更新一下系统的initramfs镜像文件：<br />
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo update-initramfs -u</span><br></pre></td></tr></table></figure></p>
<p>9.完成以上步骤后，重启系统：<br />
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo reboot</span><br></pre></td></tr></table></figure></p>
<p>10.检查禁用是否生效，执行完无显示表示成功：<br />
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">lsmod | grep nouveau</span><br></pre></td></tr></table></figure></p>
<p>11.把显卡驱动放到服务器上，执行安装步骤：<br />
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 赋予权限</span></span><br><span class="line">sudo <span class="built_in">chmod</span> 777 NVIDIA-Linux-x86_64-550.67.run</span><br><span class="line"><span class="comment"># 安装</span></span><br><span class="line">sudo ./NVIDIA-Linux-x86_64-550.67.run -no-opengl-files -no-x-check -no-nouveau-check</span><br><span class="line"><span class="comment"># 安装错误可卸载</span></span><br><span class="line">sudo ./NVIDIA-Linux-x86_64-550.67.run --uninstall</span><br></pre></td></tr></table></figure></p>
<p>安装时可使用的参数：<br />
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">–no-opengl-files：表示只安装驱动文件，不安装OpenGL文件。</span><br><span class="line">                  这个参数不可省略，否则会导致登陆界面死循环，英语一般称为”login loop”或者”stuck in login”。</span><br><span class="line">–no-x-check：表示安装驱动时不检查X服务。</span><br><span class="line">             无此参数，可能会出现“X-Server needs to be disabled before installing the drivers”的错误。</span><br><span class="line">–no-nouveau-check：表示安装驱动时不检查nouveau，我们已手动禁用了，非必需。</span><br><span class="line">-Z, --disable-nouveau：禁用nouveau。此参数非必需，因为之前已经手动禁用了nouveau。</span><br><span class="line">-A：查看更多高级选项</span><br></pre></td></tr></table></figure></p>
<p>安装的时候遇到的问题：<br />
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">An alternate method...：这个选择继续安装 continue installation。</span><br><span class="line">The target kernel has CONFIG_MODULE_SIG set...：这个是bios的Secure Boot打开了，需要关闭。</span><br><span class="line">WARNING: nvidia-installer was forced to guess the X library path &#x27;/usr/lib64&#x27;...：未找到图形相关库，点ok跳过。</span><br><span class="line">Install NVIDIA&#x27;s 32-bit compatibility libraries?：选择no，不需要安装32位支持库。</span><br><span class="line">The initramfs ... * Nouveau is present in the initramfs...rebuild the initramfs?：选择Do not rebuild initramfs。</span><br><span class="line">Would you like to run the nvidia-xconfig utility to ...：选择yes。</span><br><span class="line">Your X configuration file has been sucessfully updated...：ok。</span><br></pre></td></tr></table></figure></p>
<p>12.安装完成后验证：<br />
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">nvidia-smi</span><br></pre></td></tr></table></figure></p>
<p>显示如下，cuda的版本是12.4：<br />
<img src="/images/系统安装和环境配置/4.显卡驱动.png" width="70%"></p>
<p>显卡驱动在电脑重启后失效：<br />
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># nvidia-smi出现如下提示：</span></span><br><span class="line">NVIDIA-SMI has failed because it couldn<span class="string">&#x27;t communicate with the NVIDIA driver. </span></span><br><span class="line"><span class="string">Make sure that the latest NVIDIA driver is installed and running.</span></span><br></pre></td></tr></table></figure></p>
<p>解决办法：<br />
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 查看驱动版本，比如结果为nvidia-470.103.01</span></span><br><span class="line"><span class="built_in">ls</span> /usr/src | grep nvidia</span><br><span class="line"><span class="comment"># 安装dkms</span></span><br><span class="line">sudo apt install dkms</span><br><span class="line"><span class="comment"># 根据nvidia版本重新安装</span></span><br><span class="line">sudo dkms install -m nvidia -v 470.103.01</span><br></pre></td></tr></table></figure></p>
<h2 id="cuda安装">Cuda安装</h2>
<p>1.进入<span class="exturl" data-url="aHR0cHM6Ly9kZXZlbG9wZXIubnZpZGlhLmNvbS9jdWRhLXRvb2xraXQtYXJjaGl2ZQ==">官网<i class="fa fa-external-link-alt"></i></span>，选择和驱动显示的cuda版本号一致的cuda驱动，既进入后选择平台和系统版本，下面会给出具体的安装命令：<br />
<img src="/images/系统安装和环境配置/5.显卡驱动.png" width="70%"></p>
<p>2.按照给出的步骤下载安装：<br />
<img src="/images/系统安装和环境配置/6.显卡驱动.png" width="80%"></p>
<p>3.安装完成后添加环境变量：<br />
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo vim ~/.bashrc</span><br></pre></td></tr></table></figure></p>
<p>4.在文件末尾添加：<br />
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">export LD_LIBRARY_PATH=$LD_LIBRARY_PATH:/usr/local/cuda-12.4/lib64</span><br><span class="line">export PATH=$PATH:/usr/local/cuda-12.4/bin</span><br><span class="line">export CUDA_HOME=$CUDA_HOME:/usr/local/cuda-12.4</span><br></pre></td></tr></table></figure></p>
<p>5.环境变量生效：<br />
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">source</span> ~/.bashrc</span><br></pre></td></tr></table></figure></p>
<p>6.查看安装是否成功：<br />
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">nvcc -V</span><br></pre></td></tr></table></figure></p>
<p>显示如下表示成功：<br />
<img src="/images/系统安装和环境配置/7.显卡驱动.png" width="50%"></p>
<h2 id="cudnn安装">cuDNN安装</h2>
<p>进入<span class="exturl" data-url="aHR0cHM6Ly9kZXZlbG9wZXIubnZpZGlhLmNvbS9jdWRubg==">官网<i class="fa fa-external-link-alt"></i></span>，选择较新的版本，和Cuda安装一样会给出安装命令：<br />
<img src="/images/系统安装和环境配置/8.显卡驱动.png" width="80%"><br />
<img src="/images/系统安装和环境配置/9.显卡驱动.png" width="90%"></p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> torch</span><br><span class="line"><span class="built_in">print</span>(<span class="string">&quot;CUDA版本:&quot;</span>, torch.version.cuda)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">&quot;CuDNN版本:&quot;</span>, torch.backends.cudnn.version())</span><br></pre></td></tr></table></figure>
<h2 id="anaconda安装">Anaconda安装</h2>
<p><span class="exturl" data-url="aHR0cHM6Ly93d3cuYW5hY29uZGEuY29tL2Rvd25sb2FkI2Rvd25sb2Fkcw==">官网<i class="fa fa-external-link-alt"></i></span>下载对应系统的安装包，这里选择linux版本x86安装包。</p>
<p>1.先赋予执行权限：<br />
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">chmod</span> +x Anaconda3-2024.02-1-Linux-x86_64.sh</span><br></pre></td></tr></table></figure></p>
<p>2.再执行安装包，一路enter和yes即可：<br />
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sh Anaconda3-2024.02-1-Linux-x86_64.sh</span><br></pre></td></tr></table></figure></p>
<p>3.安装完成配置PATH，在最后面加上anaconda路径：<br />
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 打开配置文件</span></span><br><span class="line">sudo vim ~/.bashrc</span><br><span class="line"><span class="comment"># 最后面加上anaconda路径</span></span><br><span class="line"><span class="built_in">export</span> PATH=<span class="variable">$PATH</span>:/usr/local/cuda-12.4/bin:/home/admusr/anaconda3/bin</span><br><span class="line"><span class="comment"># 环境变量生效</span></span><br><span class="line"><span class="built_in">source</span> ~/.bashrc</span><br><span class="line"><span class="comment"># 若还没生效，可执行`conda init`初始化一下</span></span><br></pre></td></tr></table></figure></p>
<p>4.conda换源：<br />
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 生成.condarc文件</span></span><br><span class="line">conda config</span><br><span class="line"><span class="comment"># 编辑.condarc文件，添加如下内容</span></span><br><span class="line">channels:</span><br><span class="line">  - defaults</span><br><span class="line">show_channel_urls: <span class="literal">true</span></span><br><span class="line">default_channels:</span><br><span class="line">  - https://mirrors.tuna.tsinghua.edu.cn/anaconda/pkgs/main</span><br><span class="line">  - https://mirrors.tuna.tsinghua.edu.cn/anaconda/pkgs/r</span><br><span class="line">  - https://mirrors.tuna.tsinghua.edu.cn/anaconda/pkgs/msys2</span><br><span class="line">custom_channels:</span><br><span class="line">  conda-forge: https://mirrors.tuna.tsinghua.edu.cn/anaconda/cloud</span><br><span class="line">  msys2: https://mirrors.tuna.tsinghua.edu.cn/anaconda/cloud</span><br><span class="line">  bioconda: https://mirrors.tuna.tsinghua.edu.cn/anaconda/cloud</span><br><span class="line">  menpo: https://mirrors.tuna.tsinghua.edu.cn/anaconda/cloud</span><br><span class="line">  pytorch: https://mirrors.tuna.tsinghua.edu.cn/anaconda/cloud</span><br><span class="line">  simpleitk: https://mirrors.tuna.tsinghua.edu.cn/anaconda/cloud</span><br><span class="line"><span class="comment">#envs_dirs:  # 更改env路径, win下更方便</span></span><br><span class="line">  <span class="comment">#- /Anaconda_/envs</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># vscode使用conda环境需要安装python插件，然后右下角选择解释器。</span></span><br></pre></td></tr></table></figure></p>
<p>5.python验证cuda和cudnn<br />
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 验证cuda</span></span><br><span class="line"><span class="keyword">import</span> torch</span><br><span class="line"><span class="built_in">print</span>(torch.cuda.is_available())</span><br><span class="line"><span class="comment"># 验证cuDNN</span></span><br><span class="line"><span class="keyword">from</span> torch.backends <span class="keyword">import</span> cudnn </span><br><span class="line"><span class="built_in">print</span>(cudnn.is_available())</span><br></pre></td></tr></table></figure></p>
<h2 id="docker安装">Docker安装</h2>
<p>按照 <span class="exturl" data-url="aHR0cHM6Ly9kb2NzLmRvY2tlci5jb20vZW5naW5lL2luc3RhbGwvdWJ1bnR1Lw==">Ubantu的Docker官网<i class="fa fa-external-link-alt"></i></span>
给的安装教程安装。</p>
<p>在安装前确保电脑bios开启了虚拟化支持，具体开启方式需根据电脑情况Google。</p>
<p>1.查看系统是否开启虚拟化支持：<br />
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">lscpu | grep Virtualization</span><br></pre></td></tr></table></figure></p>
<p>返回"Virtualization: VT-x"或"Virtualization:
AMD-V"表示已开启虚拟化，这里我的系统返回如下：<br />
<img src="/images/系统安装和环境配置/4.系统配置.png" width="50%"></p>
<p>2.卸载可能因版本问题而导致冲突的环境包：<br />
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">for</span> pkg <span class="keyword">in</span> docker.io docker-doc docker-compose docker-compose-v2 podman-docker containerd runc; <span class="keyword">do</span> sudo apt-get remove <span class="variable">$pkg</span>; <span class="keyword">done</span></span><br></pre></td></tr></table></figure></p>
<p>3.apt添加Docker库：<br />
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># Add Docker&#x27;s official GPG key:</span></span><br><span class="line">sudo apt-get update</span><br><span class="line">sudo apt-get install ca-certificates curl</span><br><span class="line">sudo install -m 0755 -d /etc/apt/keyrings</span><br><span class="line">sudo curl -fsSL https://download.docker.com/linux/ubuntu/gpg -o /etc/apt/keyrings/docker.asc</span><br><span class="line">sudo <span class="built_in">chmod</span> a+r /etc/apt/keyrings/docker.asc</span><br><span class="line"></span><br><span class="line"><span class="comment"># Add the repository to Apt sources:</span></span><br><span class="line"><span class="built_in">echo</span> \</span><br><span class="line">  <span class="string">&quot;deb [arch=<span class="subst">$(dpkg --print-architecture)</span> signed-by=/etc/apt/keyrings/docker.asc] https://download.docker.com/linux/ubuntu \</span></span><br><span class="line"><span class="string">  <span class="subst">$(. /etc/os-release &amp;&amp; echo <span class="string">&quot;<span class="variable">$VERSION_CODENAME</span>&quot;</span>)</span> stable&quot;</span> | sudo <span class="built_in">tee</span> /etc/apt/sources.list.d/docker.list &gt; /dev/null</span><br><span class="line">sudo apt-get update</span><br></pre></td></tr></table></figure></p>
<p>4.安装Docker包：<br />
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo apt-get install docker-ce docker-ce-cli containerd.io docker-buildx-plugin docker-compose-plugin</span><br></pre></td></tr></table></figure></p>
<p>5.验证是否安装成功：<br />
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo docker run hello-world</span><br></pre></td></tr></table></figure></p>
<p>以上命令会拉取 hello-world
镜像并运行后退出，显示如下结果表示成功：<br />
<img src="/images/系统安装和环境配置/5.系统配置.png" width="60%"></p>
<p>6.Docker换源：<br />
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 查看默认信息</span></span><br><span class="line">docker info</span><br><span class="line"><span class="comment"># 创建/修改/etc/docker/daemon.json</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="string">&quot;registry-mirrors&quot;</span>: [</span><br><span class="line">    <span class="string">&quot;https://docker.996.ninja&quot;</span>,</span><br><span class="line">    <span class="string">&quot;https://registry.hub.docker.com&quot;</span>,</span><br><span class="line">    <span class="string">&quot;https://registry.docker-cn.com&quot;</span>,</span><br><span class="line">    <span class="string">&quot;https://docker.mirrors.ustc.edu.cn&quot;</span>,</span><br><span class="line">    <span class="string">&quot;http://hub-mirror.c.163.com&quot;</span>,</span><br><span class="line">    <span class="string">&quot;https://mirror.baidubce.com&quot;</span>,</span><br><span class="line">    <span class="string">&quot;https://ccr.ccs.tencentyun.com&quot;</span></span><br><span class="line">    ]</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment"># 重启daemon进程</span></span><br><span class="line">systemctl daemon-reload        </span><br><span class="line"><span class="comment"># 重启Docker</span></span><br><span class="line">systemctl restart docker</span><br><span class="line"><span class="comment"># 查看是否生效</span></span><br><span class="line">docker info</span><br></pre></td></tr></table></figure></p>
<p>配置成功显示如下：<br />
<img src="/images/系统安装和环境配置/6.系统配置.png" width="40%"></p>
<h2 id="jdk安装">JDK安装</h2>
<p><strong>1.linux版本</strong><br />
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 查看JDK版本</span></span><br><span class="line">apt list OpenJDK\*</span><br><span class="line"><span class="comment"># 安装JDK(以21版本为例)</span></span><br><span class="line">sudo apt install openjdk-21-jdk</span><br><span class="line"><span class="comment"># JDK安装成功后验证</span></span><br><span class="line">java -version</span><br></pre></td></tr></table></figure></p>
<p>JDK安装完成后，需要查找JDK安装地址：<br />
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 查看JDK</span></span><br><span class="line"><span class="comment"># 输出/usr/bin/java为软连接</span></span><br><span class="line"><span class="built_in">which</span> java</span><br><span class="line"><span class="built_in">ls</span> -l /usr/bin/java</span><br><span class="line"><span class="built_in">ls</span> -l /etc/alternatives/java</span><br><span class="line"><span class="comment"># 一直&quot;ls -l&quot;软连接，可见到最终目录/usr/lib/jvm/java-21-openjdk-amd64</span></span><br></pre></td></tr></table></figure></p>
<p>找到JDK安装地址后，配置环境变量：<br />
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 编辑.bashrc</span></span><br><span class="line">vim ~/.bashrc</span><br><span class="line"><span class="comment"># 插入环境变量，保存退出</span></span><br><span class="line"><span class="built_in">export</span> JAVA_HOME=/usr/lib/jvm/java-21-openjdk-amd64</span><br><span class="line"><span class="built_in">export</span> PATH=<span class="variable">$PATH</span>:<span class="variable">$JAVA_HOME</span>/bin</span><br><span class="line"><span class="comment"># 生效</span></span><br><span class="line"><span class="built_in">source</span> ~/.bashrc</span><br></pre></td></tr></table></figure></p>
<p>多版本可切换：<br />
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo update-alternatives --config java</span><br></pre></td></tr></table></figure></p>
<p>卸载JDK：<br />
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 查看java版本</span></span><br><span class="line">java -version</span><br><span class="line"><span class="comment"># 卸载java，以21版本为例</span></span><br><span class="line">sudo apt purge openjdk-21-*</span><br><span class="line"><span class="comment"># purge不光删除软件，还删除配置文件</span></span><br></pre></td></tr></table></figure></p>
<p><strong>2.Win版本</strong><br />
1.<span class="exturl" data-url="aHR0cHM6Ly93d3cub3JhY2xlLmNvbS9jbi9qYXZhL3RlY2hub2xvZ2llcy9kb3dubG9hZHMvI2phdmEyMQ==">官网<i class="fa fa-external-link-alt"></i></span>选择exe版本JDK下载。默认安装。<br />
2.安装后在<span
id="inline-purple">系统变量</span>中增加<code>JAVA_HOME</code>变量，值为安装路径<code>C:\Program Files\Java\jdk-21</code>，<br />
3.PATH中增加<code>%JAVA_HOME%\bin</code>。<br />
4.注意，默认安装后PATH中会多一个路径<code>C:\Program Files\Common Files\Oracle\Java\javapath</code>，把这个路径移动到<code>%JAVA_HOME%\bin</code>下面，这样系统默认寻找的就是我们配置的路径，在有多版本的时候可避免使用的JDK不一致问题。<br />
5.VScode搜索<code>Extension Pack for Java</code>安装即可。</p>
<h2 id="mvn安装">Mvn安装</h2>
<p>linux版本安装：<br />
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo apt install maven</span><br></pre></td></tr></table></figure></p>
<p>win版本安装：<span class="exturl" data-url="aHR0cHM6Ly9tYXZlbi5hcGFjaGUub3JnL2Rvd25sb2FkLmNnaQ==">官网<i class="fa fa-external-link-alt"></i></span>选择zip版本Maven下载，选择解压地址解压，并添加环境变量<code>MAVEN_HOME</code>，值为解压路径，PATH中增加<code>%MAVEN_HOME%\bin</code>。</p>
<p>配置本地仓库路径：找到/etc/maven/settings.xml，增加<code>&lt;localRepository&gt;本地仓库地址&lt;/localRepository&gt;</code>。<br />
配置国内镜像源：找到/etc/maven/settings.xml，在<code>&lt;mirrors&gt;&lt;/mirrors&gt;</code>节点中增加一个国内节点：<br />
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">mirror</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">id</span>&gt;</span>aliyunmaven<span class="tag">&lt;/<span class="name">id</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">mirrorOf</span>&gt;</span>*<span class="tag">&lt;/<span class="name">mirrorOf</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">name</span>&gt;</span>阿里云公共仓库<span class="tag">&lt;/<span class="name">name</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">url</span>&gt;</span>https://maven.aliyun.com/repository/public<span class="tag">&lt;/<span class="name">url</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">mirror</span>&gt;</span></span><br></pre></td></tr></table></figure></p>
<p>验证远程中央仓库是否修改成功：<br />
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">mvn <span class="built_in">help</span>:system</span><br><span class="line"><span class="comment"># Downloading from aliyunmaven: https://maven.aliyun.com/repository/public/...</span></span><br><span class="line"><span class="comment"># Downloaded from aliyunmaven: https://maven.aliyun.com/repository/public/...</span></span><br><span class="line"><span class="comment"># ...</span></span><br></pre></td></tr></table></figure></p>
<h2 id="npm安装">Npm安装</h2>
<p>1.安装：<br />
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo apt install npm</span><br></pre></td></tr></table></figure></p>
<p>2.设置国内源：<br />
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 查看当前源</span></span><br><span class="line">npm config get registry</span><br><span class="line"><span class="comment"># 设置淘宝源</span></span><br><span class="line">npm config <span class="built_in">set</span> registry https://registry.npmmirror.com</span><br><span class="line"><span class="comment"># 官方源</span></span><br><span class="line"><span class="comment"># npm config set registry https://registry.npmjs.org/</span></span><br></pre></td></tr></table></figure></p>
<h2 id="vscode配置">Vscode配置</h2>
<p>1.安装插件：<br />
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">Chinese (Simplified) (简体中文) Language Pack <span class="keyword">for</span> Visual Studio Code</span><br><span class="line">Remote - SSH</span><br><span class="line">Extension Pack <span class="keyword">for</span> Java <span class="comment"># 该系列扩展都安装即可</span></span><br><span class="line">Language Support <span class="keyword">for</span> Java(TM) by Red Hat</span><br><span class="line">Spring Boot Tools</span><br></pre></td></tr></table></figure></p>
<p>2.ssh连接服务器，创建Spring Boot项目后配置：<br />
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 如果没正确配置settings.json，SpringBoot项目import后面是灰色不可跳转的。</span></span><br><span class="line"><span class="comment"># Ctrl + Shift + P -&gt; 输入&quot;remote settings&quot; -&gt; 打开远程设置settings.json。</span></span><br><span class="line"><span class="comment"># 复制下面内容替换setting.json内容</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="string">&quot;workbench.colorTheme&quot;</span>: <span class="string">&quot;Default Dark+&quot;</span>,</span><br><span class="line">    <span class="string">&quot;maven.terminal.useJavaHome&quot;</span>: true,</span><br><span class="line">    <span class="string">&quot;java.help.firstView&quot;</span>: <span class="string">&quot;gettingStarted&quot;</span>,</span><br><span class="line">    <span class="string">&quot;files.exclude&quot;</span>: &#123;</span><br><span class="line">        <span class="string">&quot;**/.classpath&quot;</span>: true,</span><br><span class="line">        <span class="string">&quot;**/.project&quot;</span>: true,</span><br><span class="line">        <span class="string">&quot;**/.settings&quot;</span>: true,</span><br><span class="line">        <span class="string">&quot;**/.factorypath&quot;</span>: true</span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="string">&quot;java.configuration.maven.globalSettings&quot;</span>: <span class="string">&quot;/usr/share/maven/conf/settings.xml&quot;</span>,</span><br><span class="line">    <span class="string">&quot;java.maven.downloadSources&quot;</span>: true,</span><br><span class="line">    <span class="string">&quot;java.eclipse.downloadSources&quot;</span>: true,</span><br><span class="line">    <span class="string">&quot;java.configuration.maven.userSettings&quot;</span>: <span class="string">&quot;/usr/share/maven/conf/settings.xml&quot;</span>,</span><br><span class="line">    <span class="string">&quot;maven.executable.path&quot;</span>: <span class="string">&quot;/usr/bin/mvn&quot;</span>,</span><br><span class="line">    <span class="string">&quot;java.configuration.runtimes&quot;</span>: [</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="string">&quot;name&quot;</span>: <span class="string">&quot;JavaSE-21&quot;</span>,</span><br><span class="line">            <span class="string">&quot;path&quot;</span>: <span class="string">&quot;/usr/lib/jvm/java-21-openjdk-amd64&quot;</span></span><br><span class="line">        &#125;,</span><br><span class="line">    ],</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment"># Ctrl + Shift + P -&gt; 输入&quot;configure Java Runtime&quot; -&gt; 选择项目运行时使用的JDK。</span></span><br></pre></td></tr></table></figure></p>
<h2 id="svn安装">Svn安装</h2>
<p>1.安装：<br />
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo apt install subversion</span><br></pre></td></tr></table></figure></p>
<p>2.配置：<br />
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 查看版本</span></span><br><span class="line">svn --version</span><br><span class="line">subversion --version</span><br><span class="line"><span class="comment"># 创建仓库</span></span><br><span class="line">svnadmin create /usr/svn/repo</span><br></pre></td></tr></table></figure></p>
<p>3.新建仓库repo下的文件:<br />
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">|-conf <span class="comment"># 配置目录（SVN用户名的权限、密码）</span></span><br><span class="line">  |-authz <span class="comment"># 权限配置</span></span><br><span class="line">  |-hooks-env.tmpl <span class="comment"># 钩子脚本环境变量</span></span><br><span class="line">  |-passwd <span class="comment"># 用户配置</span></span><br><span class="line">  |-svnserve.conf <span class="comment"># svn服务配置</span></span><br><span class="line">|-db <span class="comment"># 数据库目录（包含上传到SVN服务器上面的文档、代码等数据的不同版本）</span></span><br><span class="line">|-hooks <span class="comment"># 钩子脚本放置目录</span></span><br><span class="line">|-locks <span class="comment"># 锁定目录</span></span><br><span class="line">|-<span class="built_in">format</span> <span class="comment"># 存储格式版本</span></span><br><span class="line">|-README.txt <span class="comment"># 说明文件</span></span><br></pre></td></tr></table></figure></p>
<p>4.修改db的访问权限（否则客户端可能无法连接SVN服务器），修改后db变成绿色：<br />
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo <span class="built_in">chmod</span> -R 777 /usr/svn/repo/db</span><br></pre></td></tr></table></figure></p>
<p>5.1修改配置文件conf/svnserve.conf：<br />
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 修改前</span></span><br><span class="line"><span class="comment"># anon-access = read</span></span><br><span class="line"><span class="comment"># auth-access = write</span></span><br><span class="line"><span class="comment"># password-db = passwd</span></span><br><span class="line"><span class="comment"># authz-db = authz</span></span><br><span class="line"><span class="comment"># 修改后</span></span><br><span class="line">anon-access = none  <span class="comment"># 无认证用户权限（none为禁止）</span></span><br><span class="line">auth-access = write <span class="comment"># 认证用户权限</span></span><br><span class="line">password-db = passwd <span class="comment"># 用户密码设置文件</span></span><br><span class="line">authz-db = authz <span class="comment"># 用户权限设置文件</span></span><br></pre></td></tr></table></figure></p>
<p>5.2增加用户密码，conf/passwd：<br />
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># [users]</span></span><br><span class="line"><span class="comment"># username = password</span></span><br><span class="line">root = root</span><br><span class="line">test1 = test1</span><br><span class="line">test2 = test2</span><br></pre></td></tr></table></figure></p>
<p>5.3增加用户权限，conf/authz：<br />
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 设置用户组</span></span><br><span class="line"><span class="comment"># [groups]</span></span><br><span class="line"><span class="comment"># groupname = username1, username2, username3 ...</span></span><br><span class="line">admins = root,test1  <span class="comment"># 设置管理员组</span></span><br><span class="line">developers = test2  <span class="comment"># 设置开发组</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 根据用户组设置权限</span></span><br><span class="line"><span class="comment"># [/]</span></span><br><span class="line"><span class="comment"># groupname = rw</span></span><br><span class="line"><span class="comment"># * =</span></span><br><span class="line">[/]</span><br><span class="line">@admins = rw  <span class="comment"># 管理员组有读写权限</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 客户端管理员Checkout后，新建trunk、branches、tags三个文件夹后commit，分别用于存放主版本、分支版本、标签版本。</span></span><br><span class="line">[/trunk]</span><br><span class="line">@developers = r <span class="comment"># 开发者组有读权限</span></span><br><span class="line"></span><br><span class="line">[/branches]</span><br><span class="line">@developers = rw <span class="comment"># 开发者组有读写权限</span></span><br><span class="line"></span><br><span class="line">[/tags]</span><br><span class="line">@developers = r <span class="comment"># 开发者组有读权限</span></span><br><span class="line"><span class="comment"># 具体到项目某个文件夹的权限设置</span></span><br><span class="line"><span class="comment"># [repo:/project]</span></span><br><span class="line"><span class="comment"># username = rw</span></span><br><span class="line"><span class="comment"># * =</span></span><br></pre></td></tr></table></figure></p>
<p>6.启动/关闭svn服务：<br />
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 启动服务：启动后默认端口3690</span></span><br><span class="line"><span class="comment"># -d 表示svnserver以“守护”进程模式运行</span></span><br><span class="line"><span class="comment"># -r 指定文件系统的根位置（版本库的根目录），这样客户端不用输入全路径，就可以访问版本库</span></span><br><span class="line">svnserve -d -r /usr/svn/</span><br><span class="line"><span class="comment"># 关闭服务</span></span><br><span class="line"><span class="comment"># 如果你想更换版本的根目录，找出svnserve id杀死掉进程，重新启动即可</span></span><br><span class="line">killall svnserve</span><br></pre></td></tr></table></figure></p>
<p>7.开机启动：<br />
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">cd</span> /etc/profile.d</span><br><span class="line">vim startsvn.sh</span><br><span class="line"><span class="comment"># 添加以下内容</span></span><br><span class="line"><span class="comment">#!/bin/bash</span></span><br><span class="line">sudo svnserve -d -r /usr/svn</span><br><span class="line"><span class="comment"># wq保存后设置可执行权限</span></span><br><span class="line">sudo <span class="built_in">chmod</span> +x startsvn.sh</span><br></pre></td></tr></table></figure></p>
<p>8.基础使用：<br />
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">同步本地库：找个目录右键TortoiseSVN-&gt;Checkout，输入格式svn://服务器ip/repo，输入配置的svn账号密码即可。</span><br><span class="line">清除登录用户：右键TortoiseSVN-&gt;settings-&gt;saved data-&gt;Authentication data，点击clear/clear all即可。</span><br><span class="line">更新本地代码：右键TortoiseSVN-&gt;Update。</span><br><span class="line">提交本地代码：右键TortoiseSVN-&gt;Commit。</span><br><span class="line">版本回退：右键TortoiseSVN-&gt;Revert，选择需要回退的版本。</span><br></pre></td></tr></table></figure></p>
<p>多人协作流程：<br />
<figure class="highlight txt"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">检出（Checkout）：开发者从 trunk 检出代码到本地。</span><br><span class="line">创建分支（Create Branch）：当开始开发新功能或修复 bug 时，开发者从 trunk 创建一个新的分支。</span><br><span class="line">开发（Develop）：在分支上进行开发工作。</span><br><span class="line">提交（Commit）：开发完成后，开发者将代码提交到分支。</span><br><span class="line">合并（Merge）：将分支的更改合并回 trunk。这通常需要通过代码审查和测试来确保合并后的代码质量。</span><br><span class="line">创建标签（Create Tag）：当 trunk 中的代码达到一个稳定的状态，并且准备发布时，创建一个新的标签。</span><br><span class="line">部署（Deploy）：将标签对应的代码部署到生产环境。</span><br></pre></td></tr></table></figure></p>
<p>9.进阶使用：<br />
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 创建分支</span></span><br><span class="line">主版本右键-&gt;TortoiseSVN-&gt;Branch/Tag-&gt;To path（选择分支存放路径）\</span><br><span class="line">-&gt;Create copy <span class="keyword">in</span> repository <span class="keyword">from</span>（选择从那个版本创建分支）-&gt;点击OK。</span><br><span class="line"><span class="comment"># 合并分支</span></span><br><span class="line"><span class="comment"># Merge a range of revisions（主干不能选择版本、分支可选版本）主干和分支版本一致时使用。</span></span><br><span class="line"><span class="comment"># Merge two different trees（主干、分支都可选择版本，合并以分支代码为主）主干有变化过时使用，主干选择创建分支时的版本。</span></span><br><span class="line">主版本右键-&gt;TortoiseSVN-&gt;Merge-&gt;Merge a <span class="built_in">range</span> of revisions-&gt;URL to merge <span class="keyword">from</span>（选择分支路径）\</span><br><span class="line">-&gt;Revision <span class="built_in">range</span> to merge选择合并的分支版本-&gt;点击OK。</span><br><span class="line"><span class="comment"># 合并冲突</span></span><br><span class="line">在合并分支时，如果两个分支对同一个文件的同一部分进行了不同的修改，就会产生冲突。</span><br><span class="line">解决冲突：<span class="number">1.</span>Accept incoming <span class="keyword">for</span> conflicts（冲突部分以分支代码为主）<span class="number">2.</span>Reject conflicts（冲突部分以主版本为主）。</span><br></pre></td></tr></table></figure></p>
<h2 id="参考资料">参考资料</h2>
<p><span class="exturl" data-url="aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3lqdW44OS9hcnRpY2xlL2RldGFpbHMvMTMxMzQ0OTQw">Ubuntu
Server版本选择及安装<i class="fa fa-external-link-alt"></i></span><br />
<span class="exturl" data-url="aHR0cHM6Ly96aHVhbmxhbi56aGlodS5jb20vcC82NjA0MzYwOTY/dXRtX2lkPTA=">Ubuntu
server20.04详细安装教程<i class="fa fa-external-link-alt"></i></span><br />
<span class="exturl" data-url="aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L20wXzQ2ODI1NzQwL2FydGljbGUvZGV0YWlscy8xMjE0MTgxMTM=">ubuntu20.04安装cuda和cudnn<i class="fa fa-external-link-alt"></i></span><br />
<span class="exturl" data-url="aHR0cHM6Ly9kZXZlbG9wZXIubnZpZGlhLmNvbS9jdWRhLXRvb2xraXQtYXJjaGl2ZQ==">cuda<i class="fa fa-external-link-alt"></i></span><br />
<span class="exturl" data-url="aHR0cHM6Ly9kZXZlbG9wZXIubnZpZGlhLmNvbS9jdWRubg==">cudnn<i class="fa fa-external-link-alt"></i></span><br />
<span class="exturl" data-url="aHR0cHM6Ly93d3cuYW5hY29uZGEuY29tL2Rvd25sb2FkI2Rvd25sb2Fkcw==">Anaconda<i class="fa fa-external-link-alt"></i></span><br />
<span class="exturl" data-url="aHR0cHM6Ly95ZWFzeS5naXRib29rLmlvL2RvY2tlcl9wcmFjdGljZQ==">Docker从入门到实践<i class="fa fa-external-link-alt"></i></span><br />
<span class="exturl" data-url="aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3dlaXhpbl81MTk4NTE1Mi9hcnRpY2xlL2RldGFpbHMvMTMwMjc3Mzk3">Docker更换国内镜像源<i class="fa fa-external-link-alt"></i></span><br />
<span class="exturl" data-url="aHR0cHM6Ly96aHVhbmxhbi56aGlodS5jb20vcC82NjExMDg4MjU=">Ubuntu安装JDK<i class="fa fa-external-link-alt"></i></span><br />
<span class="exturl" data-url="aHR0cHM6Ly93d3cub3JhY2xlLmNvbS9qYXZhL3RlY2hub2xvZ2llcy9qYXZhLXNlLXN1cHBvcnQtcm9hZG1hcC5odG1s">JDK版本计划<i class="fa fa-external-link-alt"></i></span><br />
<span class="exturl" data-url="aHR0cHM6Ly9tYXZlbi5hcGFjaGUub3JnL2Rvd25sb2FkLmNnaQ==">Maven官网<i class="fa fa-external-link-alt"></i></span><br />
<span class="exturl" data-url="aHR0cHM6Ly9ibG9nLjUxY3RvLmNvbS91XzEyNjU3NzEwLzkwNjY4Nzc=">SVN配置<i class="fa fa-external-link-alt"></i></span><br />
<span class="exturl" data-url="aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L2xpYW93ZW54aW9uZy9hcnRpY2xlL2RldGFpbHMvMTE5MzUwMDUw">SVN的merge<i class="fa fa-external-link-alt"></i></span></p>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="https://soundmemories.github.io/2023/05/21/NLP/10.%E7%BA%A0%E9%94%99/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avstar.png">
      <meta itemprop="name" content="SoundMemories">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="SoundMemories">
      <meta itemprop="description" content="今日事，今日毕">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | SoundMemories">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2023/05/21/NLP/10.%E7%BA%A0%E9%94%99/" class="post-title-link" itemprop="url">纠错</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>

      <time title="创建时间：2023-05-21 00:00:00" itemprop="dateCreated datePublished" datetime="2023-05-21T00:00:00+08:00">2023-05-21</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">分类于</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/NLP/" itemprop="url" rel="index"><span itemprop="name">NLP</span></a>
        </span>
    </span>

  
    <span class="post-meta-break"></span>
    <span class="post-meta-item" title="本文字数">
      <span class="post-meta-item-icon">
        <i class="far fa-file-word"></i>
      </span>
      <span class="post-meta-item-text">本文字数：</span>
      <span>8k</span>
    </span>
    <span class="post-meta-item" title="阅读时长">
      <span class="post-meta-item-icon">
        <i class="far fa-clock"></i>
      </span>
      <span class="post-meta-item-text">阅读时长 &asymp;</span>
      <span>29 分钟</span>
    </span>
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <h1 id="简介">简介</h1>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line">|-业界产品</span><br><span class="line">    |-百度AI纠错服务</span><br><span class="line">    |-科大讯飞纠错服务</span><br><span class="line">|-纠错场景</span><br><span class="line">    |-对话系统</span><br><span class="line">    |-asr语音识别</span><br><span class="line">    |-ocr文字识别</span><br><span class="line">    |-文本内容校验</span><br><span class="line">|-文本错误类型</span><br><span class="line">    |-通用场景：不需要专业知识，普通人就能看出的错误。</span><br><span class="line">    |-垂直场景：需要领域内专业知识，才能发现的错误。</span><br><span class="line">|-纠错问题解决思路</span><br><span class="line">    |-基于规则和统计学习</span><br><span class="line">    |-基于深度学习模型</span><br><span class="line">|-业界解决方案</span><br><span class="line">    |-端到端纠错：bart生成式</span><br><span class="line">    |-阶段性纠错：平安寿险、小爱同学、爱奇艺FASPell</span><br><span class="line">|-方案拆解</span><br><span class="line">    |-通用文本错误</span><br><span class="line">        |-Macbert4csc模型</span><br><span class="line">        |-数据增强</span><br><span class="line">    |-垂直领域专有名词错误</span><br><span class="line">        |-成分抽取</span><br><span class="line">        |-对比学习下的语义相似度</span><br><span class="line">        |-实体链接</span><br><span class="line">        |-faiss语义搜索和向量检索</span><br><span class="line">        |-Ranking</span><br></pre></td></tr></table></figure>
<h1 id="错误类型">错误类型</h1>
<p>用于纠错的文本错误类型从宏观上可分为两大类：<br />
1、<strong>通用文本错误</strong>，常见的多字、漏字、错字和别字等等。<br />
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">类别            细类                        例子</span><br><span class="line">---------------------------------------------------------</span><br><span class="line">音似    谐音/混淆音/拼音全拼/拼音缩写       配副眼(睛)-配副眼(镜)/(流浪)织女-(牛郎)织女/xingfu-幸福/bj-北京</span><br><span class="line">形似    形似                              高(梁)-高(粱)</span><br><span class="line">多字    多字                              即帅(又又)高-即帅(又)高</span><br><span class="line">少字    少字                              爱有天意-(假如)爱有天意</span><br><span class="line">乱序    顺序颠倒                           伍迪艾伦-艾伦伍迪</span><br><span class="line">语法    搭配错误                           想象难以-难以想象</span><br></pre></td></tr></table></figure></p>
<p>2、<strong>专有领域错误</strong>，垂直领域下专有名词、专有术语的错误。<br />
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">领域     类型                 例子</span><br><span class="line">---------------------------------------------------------</span><br><span class="line">金融    股票名          (山河药辅)分时资金-(山河药铺)分时资金</span><br><span class="line">医疗    疾病/药物名     肌(萎缩)性侧索硬化症-肌性侧索硬化症/(砒)罗(昔)康-(眦)罗(喜)康</span><br></pre></td></tr></table></figure><br />
一些成熟的纠错产品：<span class="exturl" data-url="aHR0cHM6Ly96ai54Znl1bi5jbi8=">讯飞智检<i class="fa fa-external-link-alt"></i></span>，<span class="exturl" data-url="aHR0cHM6Ly9qZHQubWlkdS5jb20vcHJvZHVjZQ==">校对通<i class="fa fa-external-link-alt"></i></span>。</p>
<p>成熟产品可作为参考，比如讯飞智检中有日期、成语古诗、错别词、语法、机构、地点名称等纠错；校对通中有对标点、知识性差错、内容导向风险识别等。</p>
<p>校对通还对错误检测类型进行了详细的介绍：<br />
1、<strong>通用文本差错</strong>：错别字/词、多字、少字、语义重复、语序错误、句式杂糅、标点符号错误、量词和单位错误、数字错误、序号检查、句子查重，英文校对。<br />
2、<strong>知识性差错</strong>：重要讲话引用、姓名和职务信息、地理名词、机构名称、专有名词及术语、法律法规名称、常识差错、时政重点词、媒体报道禁用词和慎用词。<br />
3、<strong>内容导向风险识别</strong>：涉国家统一及主权和领土完整、涉民族宗教、涉黄赌毒暴恐、涉低俗辱骂、涉违法违规(如广告违禁)、其他敏感内容。</p>
<h1 id="关键技术">关键技术</h1>
<p><strong>语言知识学习</strong>：可以理解为是对语言规则等先验知识的学习，通过学习词法、句法等规则进行语言模型构建，例如中英文的主谓宾结构就是不一样的。</p>
<p><strong>上下文理解</strong>：是指分析错误点上下文语境和语义，从纠错候选中选择最合适的。尤其是中文，相同的词汇在不同语境中往往表达不同的含义。</p>
<p><strong>知识计算</strong>：知识计算主要包括关联知识计算和文本理解，关联知识主要是通过对全局知识的统计来实现纠错，可以是局部不完整语句的补充。文本理解是通过统计理解全局句子内容，解决低频领域知识的泛化问题。</p>
<h1 id="产品设计">产品设计</h1>
<p><strong>用户场景</strong>：审稿或者编辑人员输入中文文字信息，系统自动纠错，并给出修改建议，审稿人员对错误快速修订。<br />
<strong>应用边界</strong>：(1)
支持用词错误检测，针对音近、形近的错字和别字进行纠正。(2)
支持句子级错误检测，主要是针对句子中出现的多字、少字等错误，相对难度校大。(3)
支持场景类错误纠正，这类错误需要具备一些特定领域的知识才能识别纠错，所以尽量支持。</p>
<p><strong>产品定位</strong>：为应用工具型产品，实现中文文本自动纠错功能。<br />
<strong>用户定位</strong>：满足两类B端用户，(1)
针对具备自主的文稿编辑工具，提供API服务，与现有系统进行改造融合；(2)
针对缺少文稿编辑工具的用户，提供web页面功能。</p>
<h1 id="规则思路">规则思路</h1>
<p>中文纠错首先<strong>错误检测</strong>，其次是<strong>错误纠正</strong>。</p>
<ul>
<li><p><strong>错误检测</strong>：对于中文首先要分词，可以使用<span class="exturl" data-url="aHR0cHM6Ly9naXRodWIuY29tL2Z4c2p5L2ppZWJh">jieba<i class="fa fa-external-link-alt"></i></span>、<span class="exturl" data-url="aHR0cHM6Ly9naXRodWIuY29tL2xhbmNvcGt1L3BrdXNlZy1weXRob24=">pkuseg<i class="fa fa-external-link-alt"></i></span>等工具分词，但由于句子中存在错误字，所以分词可能出现错误的情况，可从<strong>字粒度</strong>和<strong>词粒度</strong>两方面检测错误，整合这两种粒度的疑似错误结果，形成疑似错误位置候选集。</p>
<ul>
<li><strong>字粒度处理</strong>：先对句子进行n-gram的划分，之后根据语言模型对这些n-gram打分，汇总每个字下所有n-gram评分，通过计算MAD(<span
class="math inline">\(\overline\sum|\text{每个字gram}-\text{当前字下所有gram的均值}|\)</span>)获得每个字的得分，通过设置超参数阈值和这些字的得分比较，如果高于阈值就认为这个字是错误的，把这个字和它的位置加入到字粒度疑似错误候选项里。</li>
<li><strong>词粒度处理</strong>：首先准备一个常用词词典，如果句子中有gram出现在词典就是正确的，没有出现就可能是错误的，加入到词粒度疑似错误候选项里。</li>
</ul></li>
<li><p><strong>错误纠正</strong>：由字和词度疑似错误候选项组成的集合就是混淆字典。遍历混淆字典每个项，通过形近和音似字典替换它在句子中的位置，通过语言模型计算句子的困惑度，困惑度排序值越小代表句子可能性越高，这样得到最优的纠正结果。<br />
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">|-规则纠错:</span><br><span class="line">    |-字粒度-语言模型-平均绝对离差(MAD)-基于字粒度疑似错误候选项</span><br><span class="line">        |-混淆字典-困惑度(perplexity)-排序-输出</span><br><span class="line">    |-词粒度-常用词典-基于词粒度疑似错误候选项</span><br><span class="line">        |-混淆字典-困惑度(perplexity)-排序-输出</span><br></pre></td></tr></table></figure></p></li>
<li><p><strong>缺点</strong>：</p>
<ul>
<li>强依赖形近和音似等常用词字典，这种方式会造成精准率还可以，但召回率是极低的，整体的效果还是一般的。</li>
<li>需要很多遍历搜索的操作，性能提升也是问题，这与字典的量级有关系。</li>
</ul></li>
</ul>
<h1 id="模型方法">模型方法</h1>
<p>主要分为<strong>端到端纠错</strong>和<strong>分阶段纠错</strong>。</p>
<p>学术界大多基于预训练模型的方式进行<strong>端到端纠错</strong>，代表如下几种：<br />
<span class="exturl" data-url="aHR0cHM6Ly9hcnhpdi5vcmcvcGRmLzE5MTAuMTM0NjEucGRm">BART: Denoising
Sequence-to-Sequence Pre-training for Natural Language Generation,
Translation, and Comprehension<i class="fa fa-external-link-alt"></i></span>：<br />
<strong>Auto-encoding</strong>(自编码模型)，Bert就是Auto-encoding的一个典型代表。不仅如此，Bert采用了MLM，在输入层加入一定的噪音，是一种典型的DAELM(Denoising
Autoencoder)降噪自编码。<br />
<strong>Autoregressive</strong>(自回归模型)，典型代表是GPT系列的模型，是一种基于上文预测下文或下文预测上文的模型。<br />
<strong>BART是Auto-encoding和Autoregressive组合</strong>，结合自回归和自编码模型的优点，结构上和Transformer没什么不同，其主要区别在训练的任务和目标不同。<br />
<strong>BART预训练</strong>：通过破坏文档再优化重建损失(即解码器输出和原始文档之间的交叉熵)训练得到的。与目前仅适合特定噪声机制的去噪自编码不同，BART可应用于任意类型的文档破坏。<br />
<strong>BART的finetune</strong>：由于BART具备自回归解码器，因此它可以针对序列生成任务进行直接微调，如抽象问答和摘要。在这两项任务中，信息复制自输入但经过了处理，这与去噪预训练紧密相关，这里，编码器的输入是输入序列，解码器以自回归的方式生成输出。</p>
<p>BART使用标准Transformer结果，但还是有些区别：<br />
(1) 同GPT一样，将ReLU激活函数改为GeLU，并且参数初始化服从正态分布<span
class="math inline">\(N(0,0.02)\)</span>。<br />
(2) BART
base模型的Encoder和Decoder各有6层，large模型增加到了12层。<br />
(3) BART解码器的各层对编码器最终隐藏层额外执行cross-attention。<br />
(4) BERT在词预测之前使用了额外的Feed Forward Layer，而BART没有。</p>
<h1 id="端到端">端到端</h1>
<h2 id="小米">小米</h2>
<p>小米小爱同学：基于bert的asr(语音内容识别)纠错，F1准确率77.6%。<br />
用户query文本，通常是由asr系统将用户的语音命令转换而成，但由于技术上的原因，这些由asr生成的文本可能包含错误，继而导致后续的用户意图理解出现偏差。如何利用NLP技术对asr的query文本进行预处理纠错成了一个待解决的问题。<br />
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">    错误示例                   正确示例</span><br><span class="line">---------------------------------------------------------</span><br><span class="line">给我播放一首(升壁纸)        给我播放一首(生僻字)</span><br><span class="line">你讲话好像(被)句子          你讲话好像(背)句子</span><br><span class="line">(岫岩)血斑怎么回事          (右眼)血斑怎么回事</span><br><span class="line">(意味着)什么意思            (eraser)什么意思</span><br></pre></td></tr></table></figure><br />
纠错初步设定：</p>
<ul>
<li>只考虑 6 字以上中长 query：短的 query
不能体现充足的语境信息，纠错比较难。</li>
<li>不考虑上下文对话信息：上下文对话信息问题更复杂，并且在小爱同学对话信息中多轮对话只占
1%，目前先不考虑多轮对话的场景。</li>
<li>不考虑音频信息：作为 ASR 下游的一个纠错产品，只考虑文本信息。</li>
<li>仅考虑一对一纠错：基于 BERT
模型的纠错，一对一比较容易实现，后续可以放宽限制。</li>
<li>仅使用非监督语料：非监督语料节省人力成本，可以使用预训练模型，数据分布的头部语料可以嵌入到模型中，但可能不利于尾部数据的纠错，也就是说对于那些在语料中没有出现过的信息，不太可能纠正过来。</li>
</ul>
<p>网络结构：<strong>整个流程为自监督学习，无需标注</strong>。<br />
<img src="/images/纠错/小米模型.jpg" width="90%"></p>
<p><strong>语料库</strong>：包括维基百科中文、知乎中文、爬取的一些新闻语料，以及小爱同学运行的用户日志，总共将近有
1 亿条的数据。</p>
<p>从<strong>语料库中抽样</strong>出原始样本，类似“请播放歌曲芒种”、“布朗熊跳个舞”、“打开和平精英”等等。小米开发了专门模拟
ASR
生成错误数据的<strong>模糊音生成器</strong>，基于<strong>模糊拼音</strong>来对原始样本处理生成错误样本，生成结果如“请播放歌曲曼钟”、“波兰熊跳个舞”、“打开和平静音”等等。</p>
<p>构造好正确样本和错误样本的样本对输入到<strong>判别器模型</strong>，判别器进行<strong>端到端的纠错</strong>，即给模型输入错误样本，模型输出为正确的样本。</p>
<p><strong>模糊音生成器</strong>：<br />
<img src="/images/纠错/小米模型2.jpg" width="70%"></p>
<p>标准的拼音方案不能很好的体现<strong>汉字的发音相似问题</strong>，<strong>非标准拼音方案</strong>更准确的描述asr语音出现错误的规律，找到合适的编辑距离计算方案。比如正常“wa”和“hua”读音相似，但以编辑距离计算是2，通过非标准拼音方案把“wa”记为“ua”，此时和“hua”的编辑距离为1，这种方案更好处理发音相似问题。</p>
<p><img src="/images/纠错/小米模型3.jpg" width="70%"></p>
<p>判别器结构上，输入数据为汉字和拼音的特征，其中汉字经过Bert预训练模型得到汉字的词向量，而拼音数据则是通过Bert模型重新训练一个关于拼音数据的词向量，二者拼接后经过Softmax层，计算交叉熵损失。</p>
<p><img src="/images/纠错/小米模型4.jpg" width="70%"></p>
<p><strong>Trick-1，词表过滤</strong>：如果词表很大，比如 10000
维，想要限制一下端到端纠错模型在纠错时的搜索范围，可以对词表增加限制，比如只允许在过滤后的
300
甚至几十个相似的词语中选择，理论上召回有所损失，但是纠正的准确率大大提升，并且这种过滤程度可以调整。实际测评中显示，加入词表过滤，显著提升了模型的效果和性能。<br />
<strong>Trick-2，递归预测</strong>：BERT
在纠错过程中是一对一的纠错，如果一个句子中有多个错误的位置，但是对于端到端输入模型一次
Feed Forward
过程可能只纠正了一个位置，若要整个句子实现纠错，那么需要把纠正后的结果放到句子中再次输入模型，进行递归纠错。如果两次递归结果相同则停止递归纠错，否则会递归纠错最多
3 次。</p>
<p>从结果中发现，原生 BERT 微调之后直接纠错，模型评测指标为
9.3%，加入词表过滤和递归预测后，f1 提升到 21.6%，加入纠错训练后 f1
大幅提升到 65%，加入 trick 后，又提升到
73.4%，再加入拼音特征数据，效果提升明显，f1 提升到 77.6%。</p>
<h2 id="爱奇艺">爱奇艺</h2>
<p>爱奇艺拼写检查FASPell准确率73.5%。<br />
FASPell: A Fast, Adaptable, Simple, Powerful Chinese Spell Checker Based
On DAE-Decoder Paradigm<br />
论文地址: <span class="exturl" data-url="aHR0cHM6Ly9hY2xhbnRob2xvZ3kub3JnL0QxOS01NTIyLnBkZg==">https://aclanthology.org/D19-5522.pdf<i class="fa fa-external-link-alt"></i></span><br />
FASPell是爱奇艺在2019年提出的汉字纠错模型，主要解决的是相似字形、读音相似文字的纠错，模型采用的自动解码器DAE加上解码器decoder结构，其中的解码器涉及有助于减少模型对混淆集的使用，这是因为在解码器中充分利用了中文相似性特征。<br />
<img src="/images/纠错/爱奇艺模型1.jpg" width="40%"></p>
<p>Encoder训练：</p>
<ul>
<li>对于正确语句，按照bert的原始生成策略来。</li>
<li>对于错误的语句，做如下处理：对于错误文字不做mask操作（也就是用自身作为mask），但是label为正确的文字，对于正确的文字也使用自身进行mask，label也是自身。</li>
</ul>
<p>CSD解码器：是FASPell首次提出的，相比过去提出的字符相似度量方法，FASPell更加精准。形状相似度+读音相似度+Encoder置信度，输入到CSD中处理。</p>
<p><strong>形状相似度</strong>：按上下左右嵌套拆分，拆分后可以通过前序遍历二叉树记录idx序列，通过计算两个序列idx的编辑距离。<br />
<img src="/images/纠错/爱奇艺模型2.jpg" width="40%"></p>
<p><strong>读音相似度</strong>：中文存在很多方言，所以这里的相似度就是众多方言的读音的编辑距离的平均值。和上面一样，也需要进行归一化处理将值域放在[0,1]之间。</p>
<p>有了上述相似文字的相似度衡量指标之后，结合bert给出语句中每个汉字的候选集置信度，通过绘制<strong>置信度-相似性曲线</strong>来过滤候选结果得到置信度最高的纠错结果。<br />
<img src="/images/纠错/爱奇艺模型3.jpg" width="80%"></p>
<p>形状相似度+读音相似度 -&gt; similarity参数。<br />
Encoder置信度 -&gt; confidence参数。<br />
通过以上两组参数画出的曲线来确定参数，从而筛选出每个字对应的候选集。</p>
<h1 id="分阶段">分阶段</h1>
<h2 id="平安寿险">平安寿险</h2>
<p>平安寿险纠错方案(误报率0.1%，召回率70%)：<br />
<img src="/images/纠错/平安寿险.jpg" width="90%"><br />
在日常生活中，比如微信、微博等社交工具中会发现许多错别字，在这几个方面平安对文本出错概率进行了统计。<br />
(1) 微博等新媒体领域，文本出错概率在2%左右；<br />
(2) 语音识别领域，出错最高可达8-10%；<br />
(3)
平安人寿问答领域，用户提问错误率在去重后仍高达9%(应该包含直接输入错误和语音识别错误)。<br />
<img src="/images/纠错/平安寿险2.jpg" width="90%"><br />
上图是其纠错系统的流程图：<br />
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"># 此系统更注重效果，未对效率和性能进行优化</span><br><span class="line">|-错误检测</span><br><span class="line">    |-拼音匹配：规则上的处理，文字-拼音(通过拼音查找准确词)-文字，这种规则处理方式。</span><br><span class="line">    |-单双向2gram语言模型：基于输入中词与词搭配正确的比错误的多的假设，</span><br><span class="line">      句子中某些词前后组成的2gram分很低，这个词就可能是错误的，加入错误候选集中。</span><br><span class="line">    |-BILSTM+CRF实体识别的分类模型，看成是序列标注任务，也可以学习bert的mlm任务，</span><br><span class="line">      每个词都进行完形填空，如果实际词不在预测的候选集中，这个词就可能是错误的，加入错误候选集中。</span><br><span class="line">|-候选召回</span><br><span class="line">    |-拼音倒排、汉字倒排、同音召回、语言模型。</span><br><span class="line">    |-混淆字集：通过业界积累，以种子词为核心扩展，通过形近、音近、编辑距离等构建错误集合。</span><br><span class="line">|-候选排序</span><br><span class="line">    |-一级排序(粗排)：词频变化、编辑距离、拼音距离、语言模型，LR。</span><br><span class="line">    |-二级排序(精排)：词频变化、分词变化、音形距离、PMI变化、统计语言模型变化、nn语言模型变化。</span><br><span class="line">|-候选筛选：交叉处理、包含处理、点位跟踪。</span><br><span class="line">|-底层资源：双数组字典树、CSR压缩、分层倒排、4gram语言模型、nn语言模型。</span><br></pre></td></tr></table></figure></p>
<h1 id="bert系列">BERT系列</h1>
<p><img src="/images/纠错/bert1.jpg" width="90%"><br />
可以看到，Bert和同时期的GPT和ELMo的一些区别：<br />
（1）从结构来看，Bert和GPT同属Transformer系列（encoder和decoder），ELMo是lstm系列。<br />
（2）从特征提取看，Transformer可以并行处理序列但不能过长序列，lstm可以单行双向处理长序列，但ELMo是分开的两边分开单独的双向和lstm有区别，算是伪双向。</p>
<p>对于Bert的细节，可参考<a
href="https://soundmemories.github.io/2021/07/20/NLP/05.Bert/">Bert</a>
。<br />
那么在做纠错任务时，可以想到mask策略定制化，比如用形近字、音近字去mask。</p>
<h1 id="分布式训练">分布式训练</h1>
<p>主要使用DistributedDataParallel和Horovod进行分布式训练：Distributed
Sampler
能够帮助我们分发数据，DistributedDataParallel、hvd.broadcast_parameters
能够帮助我们分发模型，并在框架的⽀持下解决梯度汇总和参数更新的问题。</p>
<p>交互过程：<br />
（1）通过调⽤ <code>all_reduce(tensor, op=...)</code>
，当前进程会向其他进程发送 tensor （如rank0 会发送 rank0 的 tensor 到
rank 1、2、3）<br />
（2）接受其他进程发来的 tensor （如 rank0 会接收 rank1 的 tensor、rank2
的 tensor、rank3的 tensor）。<br />
（3）在全部接收完成后，当前进程（如rank0）会对当前进程的和接收到的
tensor （如 rank0、rank1、rank2、rank3 的 tensor）进行 op
（如求和）操作。</p>
<h2 id="dataparallel">DataParallel</h2>
<p>DataParallel 是torch早期推出的用于分布式训练的包，DataParallel
使用起来⾮常方便，只需要用 DataParallel
包装模型，再设置⼀些参数即可。需要定义的参数包括：<br />
（1）参与训练的 GPU 有哪些，device_ids=gpus。<br />
（2）用于汇总梯度的 GPU 是哪个，output_device=gpus[0] 。<br />
DataParallel 会自动将数据切分 load 到相应 GPU，将模型复制到相应
GPU，进行正向传播计算梯度并汇总：<br />
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">model = nn.DataParallel(model.cuda(), device_ids=gpus, output_device=gpus[<span class="number">0</span>])</span><br></pre></td></tr></table></figure><br />
<img src="/images/纠错/并行1.jpg" width="100%"></p>
<p>以4张GPU为例，那么就是1个进程，4个线程：<br />
（1）<strong>将模型复制到各个GPU中</strong>，并将一个<strong>batch的数据划分成mini_batch</strong>并分发给各个GPU。<br />
（2）各个GPU在<strong>独立的线程</strong>上，独自<strong>完成mini_batch的forward</strong>，并把获得的output传递给GPU_1（主GPU）。<br />
（3）<strong>GPU_1整合各个GPU传递过来的output，并计算loss</strong>，再分发loss给各个GPU。<br />
（4）各个GPU在<strong>独立的线程</strong>上，根据loss独自完成<strong>各自的backforward并计算梯度</strong>，再将各自的梯度传递给GPU_1。<br />
（5）梯度汇总到GPU_1上，然后梯度下降，<strong>权重更新</strong>，GPU_1将<strong>更新好的模型权重又传递给其余GPU</strong>，保证每个GPU的模型一致。</p>
<p>存在的问题：负载不均衡、网络通信瓶颈（类似PS模式通信，Parameter
Server）。</p>
<h2 id="distributeddataparallel">DistributedDataParallel</h2>
<p>在 pytorch 1.0 之后，官方终于对分布式的常用方法进行了封装，支持
all-reduce，broadcast，send 和 receive 等等。通过 MPI 实现 CPU
通信，通过 NCCL 实现 GPU 通信。官方也曾经提到用 DistributedDataParallel
解决 DataParallel 速度慢，GPU 负载不均衡的问题，目前已经很成熟了。</p>
<p>与 DataParallel 的单进程控制多 GPU 不同，在 distributed
的帮助下，我们只需要编写⼀份代码，torch 就会自动将其分配给 n
个进程，分别在 n 个 GPU 上运行。<br />
<img src="/images/纠错/并行2.jpg" width="90%"></p>
<p>以4张GPU为例，那么就是4个进程：<br />
（1）每个进程独立占有⼀张显卡，独立的加载自己的数据和模型，不需要数据广播、也不需要模型广播（每个gpu都有⼀个相同的模型副本），<strong>分布式数据采样器</strong>（DistributedSampler）可确保加载的数据在各个进程之间不重叠。<br />
（2）每个gpu独立进行forward，计算output，每个gpu独立计算loss，在<strong>计算梯度同时对梯度执行all-reduce操作</strong>（进程独立将梯度进行汇总平均）。<br />
（3）每个gpu用相同的梯度，独立更新参数，因为每个gpu都是从⼀个相同的模型副本开始的，初始参数⼀致，并且梯度被all-reduced，下降的梯度相同，因此每个GPU在反向传播结束时最终得到平均梯度的相同副本，所有gpu上的权重更新都相同，也就不需要模型同步了。</p>
<p>注意：和DP的类似PS模式不同，DDP使用all-reduce模式通信。确切地说，DP和DDP默认首选的通信后端都是nccl。nccl支持的原语中，DP使用的Broadcast和Reduce，以及Scatter和Gather，而DDP则使用all-reduce。</p>
<p><strong>使用方式</strong>：<br />
1.在 API 层面，pytorch 为我们提供了 torch.distributed.launch
启动器，用于在命令行分布式地执行 python
文件。在执行过程中，启动器会将当前进程的（其实就是 GPU的）index
通过参数传递给 python，我们可以这样获得当前进程的 index：<br />
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">local_rank = torch.distributed.get_rank()  <span class="comment"># 当前进程的index</span></span><br><span class="line">torch.cuda.set_device(local_rank)</span><br></pre></td></tr></table></figure></p>
<p>2.接着，使用 init_process_group 设置GPU
之间通信使用的后端和端口：<br />
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">torch.distributed.init_process_group(backend=<span class="string">&#x27;nccl&#x27;</span>)</span><br></pre></td></tr></table></figure></p>
<p>3.然后使用 DistributedSampler 对数据集进行划分。它能将每个 batch
划分成几个 partition，在当前进程中只需要获取和 local_rank 对应的那个
partition 进行训练：<br />
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">train_sampler = torch.utils.data.distributed.DistributedSampler(train_dataset)</span><br><span class="line">train_loader = torch.utils.data.DataLoader(train_dataset, batch_size=..., sampler=train_sampler)</span><br></pre></td></tr></table></figure></p>
<p>4.使用 DistributedDataParallel 包装模型，它能为不同 GPU
上求得的梯度进行 all reduce（即汇总不同 GPU
计算所得的梯度，并同步计算结果）。all reduce 后不同 GPU 中模型的梯度均为
all reduce 之前各 GPU 梯度的均值。<br />
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">model = torch.nn.parallel.DistributedDataParallel(model, device_ids=[local_rank])</span><br></pre></td></tr></table></figure></p>
<h2 id="horovod">Horovod</h2>
<p>Horovod 是 Uber 开源的深度学习工具，它的发展吸取了 Facebook "Training
ImageNet In 1 Hour" 与百度 "Ring Allreduce" 的优点，可以无痛与
PyTorch/Tensorflow
等深度学习框架结合，实现并行训练。Horovod优势体现在多级多卡，几百上千块卡的训练。</p>
<p>在 API 层面，Horovod 和 torch.distributed 十分相似。在 mpirun
的基础上，Horovod 提供了自己封装的 horovodrun 作为启动器。</p>
<p>与 torch.distributed.launch 相似，我们只需要编写⼀份代码，horovodrun
启动器就会自动将其分配给 n个进程，分别在n 个 GPU
上运行。在执行过程中，启动器会将当前进程的（其实就是 GPU的）index 注入
hvd，我们可以这样获得当前进程的 index：<br />
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> horovod.torch <span class="keyword">as</span> hvd</span><br><span class="line">hvd.local_rank()</span><br></pre></td></tr></table></figure></p>
<p>与 init_process_group 相似，Horovod 使用 init 设置GPU
之间通信使用的后端和端口:<br />
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">hvd.init()</span><br></pre></td></tr></table></figure></p>
<p>接着，使用 DistributedSampler
对数据集进行划分。如此前我们介绍的那样，它能帮助我们将每个batch
划分成几个 partition，在当前进程中只需要获取和 rank 对应的那个 partition
进行训练：<br />
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">train_sampler = torch.utils.data.distributed.DistributedSampler(train_dataset)</span><br><span class="line">train_loader = torch.utils.data.DataLoader(train_dataset, batch_size=..., sampler=train_sampler)</span><br></pre></td></tr></table></figure></p>
<p>之后，使用 broadcast_parameters 包装模型参数，将模型参数从编号为
root_rank 的 GPU 复制到所有其他 GPU 中：<br />
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">hvd.broadcast_parameters(model.state_dict(), root_rank=<span class="number">0</span>)</span><br></pre></td></tr></table></figure></p>
<p>然后，使用 DistributedOptimizer 包装优化器。它能帮助我们为不同 GPU
上求得的梯度进行 all reduce（即汇总不同 GPU
计算所得的梯度，并同步计算结果）。all reduce 后不同 GPU 中模型的梯度均为
all reduce 之前各 GPU 梯度的均值：<br />
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">hvd.DistributedOptimizer(optimizer, named_parameters=model.named_parameters(),...)</span><br></pre></td></tr></table></figure></p>
<p>在使用时，调用 horovodrun 启动器启动：<br />
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">CUDA_VISIBLE_DEVICES=<span class="number">0</span>,<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span> horovodrun -np <span class="number">4</span> -H localhost:<span class="number">4</span> python main.py</span><br></pre></td></tr></table></figure></p>
<h1 id="apex加速">Apex加速</h1>
<p>Apex 是 NVIDIA 开源的用于混合精度训练和分布式训练库。Apex
除了对混合精度训练的过程进行了封装，改两三行配置就可以进行混合精度的训练，从而大幅度降低显存占用，节约运算时间。Apex
也提供了对分布式训练的封装，针对 NVIDIA 的 NCCL 通信库进行了优化。</p>
<p>在混合精度训练上，Apex 的封装十分优雅。直接使用 amp.initialize
包装模型和优化器，apex
就会自动帮助我们管理模型参数和优化器的精度了，根据精度需求不同可以传入其他配置参数。</p>
<p>在分布式训练的封装上，Apex 改动并不大，主要是优化了 NCCL
的通信。因此，大部分代码仍与torch.distributed
保持⼀致。使用的时候只需要将 torch.nn.parallel.DistributedDataParallel
替换为 apex.parallel.DistributedDataParallel 用于包装模型。在 API
层面，相对于 torch.distributed
，它可以自动管理⼀些参数（可以少传⼀点）：<br />
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> apex.parallel <span class="keyword">import</span> DistributedDataParallel</span><br><span class="line">model = DistributedDataParallel(model)</span><br></pre></td></tr></table></figure><br />
在使用时，调用 torch.distributed.launch 启动器启动：<br />
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">CUDA_VISIBLE_DEVICES=0,1,2,3 python -m torch.distributed.launch --nproc_per_node=4 --nnodes=3 --node_rank=0 --master_addr=<span class="string">&quot;192.168.1.201&quot;</span> --master_port=23456 train.py</span><br></pre></td></tr></table></figure><br />
需要注意梯度溢出的问题。<br />
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> torch.cuda.amp <span class="keyword">import</span> autocast <span class="keyword">as</span> ac</span><br><span class="line"><span class="comment"># 训练时加上, 不然一直报梯度溢出, 训练的模型可能有问题</span></span><br><span class="line"><span class="keyword">with</span> ac():</span><br><span class="line">    loss = model(input_ids=input_ids, attention_mask=attention_mask,token_type_ids=token_type_ids, labels=label)[<span class="number">0</span>]</span><br></pre></td></tr></table></figure></p>
<h1 id="成分抽取">成分抽取</h1>
<p>文本的错误类型有多种，但是没有⼀种纠错技术可以纠正所有类型的文本错误，对于特定的错误类型来说，需要设计特定的方式去纠错，其中，垂直领域下的专属名词，例如：金融领域的股票和基金名称、医疗领域的药物和疾病名称、地图和本地生活领域的poi名称，等等，这些<strong>专有名词</strong>⼀旦发生错误，<strong>很难通过端到端</strong>的方式直接进行纠错，需要定制化的策略去应对。</p>
<p>如何对垂直领域下的专属名词进行抽取就是一个需要考虑的问题，目前工业界常见的成分抽取框架，例如<strong>序列标注</strong>、<strong>指针⽹络</strong>、<strong>⽚段排列</strong>等技术⽅案。</p>
<h2 id="序列标注">序列标注</h2>
<p>实现序列标注的常⽤⽅法有BiLSTM/IDCNN/BERT+CRF等，与BiLSTM/IDCNN/BERT+Softmax相⽐，CRF使模型考虑到了标签之间的相关性，标签之间的相关性就是标签之间的转移概率，CRF层可以学习到标签之间的转移概率。</p>
<p><strong>BiLSTM+CRF</strong>：<br />
<img src="/images/纠错/bilstm+crf.jpg" width="70%"><br />
<img src="/images/纠错/bilstm+crf2.jpg" width="80%"></p>
<p>重要的点一个是bilstm学习后得到每个token是什么标签的似然值，另一个是不断迭代后crf学习到的转移矩阵，从而确定最大概率序列标注结果，当然不是对所有可能结果的穷举探索，而是使用一些优化算法比如前向后向算法等，来确定最大概率序列标注结果。<br />
对于crf的效果，在BiLSTM/IDCNN上面提升一般很大，在10%左右。</p>
<p><strong>BERT+CRF</strong>：<br />
⾃从bert横空出世之后，现在基本上都是基于bert这个强⼤的编码器来做的序列标注。<br />
对于crf的效果，在bert上面提升一般很小，crf提升在1-2%左右，因为bert本身具有很强的编码能力。<br />
<img src="/images/纠错/bert+crf.jpg" width="80%"></p>
<h2 id="指针络">指针⽹络</h2>
<p><strong>BERT+SPAN</strong>：<br />
从句⼦中正确的抽取出实体，需要知道三个要素：开始位置、结束位置、实体类型。<br />
下图中，有两个识别层，分别预测起始位置和结束位置，label中的颜色代表实体类型。<br />
指针网络的后半部分是全连接层，不管是训练还是推理都比带crf的快，crf毕竟是串行维特比解码的。<br />
<img src="/images/纠错/bert+span.jpg" width="80%"></p>
<p><strong>BERT+MRC</strong>：<br />
BERT-MRC模型在不同的数据集上的表现<strong>差异较⼤</strong>，并且不同的数据处理（主要是数据处理影响很大）对模型的性能影响也很⼤，需要使⽤者理解其内部的原理后采⽤合适的⽅法来使⽤。<br />
在数据预处理阶段需要将实<strong>体类型的描述</strong>作为query，拼接到每个输⼊句⼦的前⾯，然后针对性的修改原有的标注。<br />
（1）数据扩充：根据实体类型扩充；<br />
（2）类别均衡：平衡负例；</p>
<p>假设现在现在待抽取的成分有三种：<br />
（1）股票名称：从公司全称中精选出2到4个字的称呼；<br />
（2）⾦融指标：⽤于衡量公司经营状况⾦融描述；<br />
（3）⼈名：⼈物的名称；<br />
例如下⾯的例⼦：<br />
（1）每个样本，根据要识别实体的数量，扩充对应数量的样本。<br />
（2）每个样本不可能有全部要识别的实体，那么扩充后，没有query对应实体的样本负例很大，需要平衡负例，只需抽取部分负例训练而不是全部拿来训练。<br />
<img src="/images/纠错/bert+mrc.jpg" width="60%"></p>
<p>模型结构如下：<br />
从下图label可以看出，没有用颜色来区分实体类别，是因为在输入时的query已经确定了要是别的实体类型了。<br />
<img src="/images/纠错/bert+mrc1.jpg" width="80%"></p>
<p>所以，总结起来，BERT-MRC模型能取得⽐其他模型更好的性能的原因是它特殊的数据处理⽅法使得变相做了<strong>数据扩充</strong>，其次在输⼊⽂本前加上了实体类型的描述信息，这些实体类型的描述作为<strong>先验知识</strong>提⾼了模型抽取的效果，所以BERT-MRC模型在数据量匮乏的场景下，通过在输⼊⽂本前⾯拼接的query获得了⼀定的先验信息，提升了性能。<br />
作者论文使用了不同的query形式实验，结论是使用自然语言描述的大白话作为query效果最好。<br />
实际使用时，数据量少的时候使用效果很好，数据量足够效果和其他模型比劣势，因为数据量大增，训练成本大；实体类型多时，推理次数也会10次，速度也很差。可以考虑用于小数据扩充方法。</p>
<h2 id="段排列">⽚段排列</h2>
<h1 id="参考文献">参考文献</h1>
<p><span class="exturl" data-url="aHR0cHM6Ly93d3cuamlhbnNodS5jb20vcC84ZDJmMDk5MWI4NDA=">中文文本纠错任务简介<i class="fa fa-external-link-alt"></i></span><br />
<span class="exturl" data-url="aHR0cHM6Ly9iYWlqaWFoYW8uYmFpZHUuY29tL3M/aWQ9MTczMzg3MzU5MDEwMTUzMzc4NCZ3ZnI9c3BpZGVyJmZvcj1wYw==">文本校对产品的应用设计场景<i class="fa fa-external-link-alt"></i></span><br />
<span class="exturl" data-url="aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3dlaXhpbl8zOTUzMzM2MS9hcnRpY2xlL2RldGFpbHMvMTEyMTU3OTAy">中文文本纠错_垂直电商搜索纠错<i class="fa fa-external-link-alt"></i></span><br />
<span class="exturl" data-url="aHR0cHM6Ly93d3cuaW5mb3EuY24vYXJ0aWNsZS81V3FrZUhsSkJFWjhqUlU5Sms2Uy8=">小米小爱同学-基于BERT的ASR纠错<i class="fa fa-external-link-alt"></i></span><br />
<span class="exturl" data-url="aHR0cHM6Ly96aHVhbmxhbi56aGlodS5jb20vcC8xNTkxMDE4NjA=">平安寿险-文本纠错技术探索和实践<i class="fa fa-external-link-alt"></i></span><br />
<span class="exturl" data-url="aHR0cHM6Ly93d3cub3NjaGluYS5uZXQvcXVlc3Rpb24vMjkxODE4Ml8yMzEyNzg1Lw==">爱奇艺-开源SOTA高性能中文拼写检查工具FASPell<i class="fa fa-external-link-alt"></i></span><br />
<span class="exturl" data-url="aHR0cHM6Ly96aHVhbmxhbi56aGlodS5jb20vcC8zNzg0MTk5OTA=">文本纠错目前是怎么做的,BERT怎么做文本纠错<i class="fa fa-external-link-alt"></i></span><br />
<span class="exturl" data-url="aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzE1ODIxNDg3L2FydGljbGUvZGV0YWlscy8xMTk5OTc4ODI=">BART模型<i class="fa fa-external-link-alt"></i></span><br />
<span class="exturl" data-url="aHR0cHM6Ly9hZGFuaW5nLmdpdGh1Yi5pby9wb3N0cy8xMzk0Lmh0bWw=">BART和mBART<i class="fa fa-external-link-alt"></i></span><br />
<span class="exturl" data-url="aHR0cHM6Ly96aHVhbmxhbi56aGlodS5jb20vcC8zNTY5NjcxOTU=">pytorch中的分布式训练之DP
VS DDP<i class="fa fa-external-link-alt"></i></span><br />
<span class="exturl" data-url="aHR0cHM6Ly96aHVhbmxhbi56aGlodS5jb20vcC83NjYzODk2Mg==">Pytorch
分布式训练<i class="fa fa-external-link-alt"></i></span><br />
<span class="exturl" data-url="aHR0cHM6Ly9ncHVzaGFyZS5jb20v">Gpushare
Cloud恒源云-可分布式练习<i class="fa fa-external-link-alt"></i></span></p>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="https://soundmemories.github.io/2023/04/05/NLP/09.%E5%88%86%E8%AF%8D/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avstar.png">
      <meta itemprop="name" content="SoundMemories">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="SoundMemories">
      <meta itemprop="description" content="今日事，今日毕">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | SoundMemories">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2023/04/05/NLP/09.%E5%88%86%E8%AF%8D/" class="post-title-link" itemprop="url">分词</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>

      <time title="创建时间：2023-04-05 00:00:00" itemprop="dateCreated datePublished" datetime="2023-04-05T00:00:00+08:00">2023-04-05</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">分类于</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/NLP/" itemprop="url" rel="index"><span itemprop="name">NLP</span></a>
        </span>
    </span>

  
    <span class="post-meta-break"></span>
    <span class="post-meta-item" title="本文字数">
      <span class="post-meta-item-icon">
        <i class="far fa-file-word"></i>
      </span>
      <span class="post-meta-item-text">本文字数：</span>
      <span>7</span>
    </span>
    <span class="post-meta-item" title="阅读时长">
      <span class="post-meta-item-icon">
        <i class="far fa-clock"></i>
      </span>
      <span class="post-meta-item-text">阅读时长 &asymp;</span>
      <span>1 分钟</span>
    </span>
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <h2 id="闲聊式">闲聊式</h2>
<h2 id="参考文献">参考文献</h2>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="https://soundmemories.github.io/2022/09/02/IELTS/04.%E5%8F%A3%E8%AF%AD/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avstar.png">
      <meta itemprop="name" content="SoundMemories">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="SoundMemories">
      <meta itemprop="description" content="今日事，今日毕">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | SoundMemories">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2022/09/02/IELTS/04.%E5%8F%A3%E8%AF%AD/" class="post-title-link" itemprop="url">口语</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>

      <time title="创建时间：2022-09-02 00:00:00" itemprop="dateCreated datePublished" datetime="2022-09-02T00:00:00+08:00">2022-09-02</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">分类于</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/IELTS/" itemprop="url" rel="index"><span itemprop="name">IELTS</span></a>
        </span>
    </span>

  
    <span class="post-meta-break"></span>
    <span class="post-meta-item" title="本文字数">
      <span class="post-meta-item-icon">
        <i class="far fa-file-word"></i>
      </span>
      <span class="post-meta-item-text">本文字数：</span>
      <span>5.6k</span>
    </span>
    <span class="post-meta-item" title="阅读时长">
      <span class="post-meta-item-icon">
        <i class="far fa-clock"></i>
      </span>
      <span class="post-meta-item-text">阅读时长 &asymp;</span>
      <span>20 分钟</span>
    </span>
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <h1 id="考试介绍">考试介绍</h1>
<p>part1 - 日常问题 - 3-4 topic - 3-4 question - 10-16问题 20s
4句话左右<br />
part2 - 话题卡- 1min 准备 -2min 回答 - 不会打断 - follow up question
20s<br />
part3 - 深刻问题的探讨 - 40s 听懂问题说出点东西</p>
<p>1月、5月、9月是雅思口语的换题季。</p>
<h1 id="必考题p1">必考题P1</h1>
<p><strong>1.work，介绍你的工作</strong>：<br />
-job description<br />
-like or dislike：对自己的价值value、未来计划future
plan、专业major匹配度方面表达。</p>
<p><strong>2.hometown，介绍你的家乡</strong>：<br />
-城市位置location，有名点famous for<br />
-大城市 vs 小城市 - 人口 / 经济<br />
-like - 2点<br />
-dislike - 2点</p>
<p><strong>3.accommodation，介绍你的住的地方</strong>：<br />
-location<br />
-description：屋子格局，喜欢呆在哪个屋子，2个理由。<br />
-plan - 是否搬家，理由。</p>
<div class="tabs" id="8分"><ul class="nav-tabs"><li class="tab active"><a href="#8分-1">工作</a></li><li class="tab"><a href="#8分-2">家乡</a></li><li class="tab"><a href="#8分-3">居住</a></li></ul><div class="tab-content"><div class="tab-pane active" id="8分-1"><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br></pre></td><td class="code"><pre><span class="line">As a natural language processing engineer, my main job <span class="keyword">is</span> to develop <span class="keyword">and</span> </span><br><span class="line">implement software algorithms <span class="keyword">and</span> models <span class="keyword">for</span> analysing <span class="keyword">and</span> understanding human language. </span><br><span class="line">I work on improving the accuracy <span class="keyword">and</span> efficiency of language processing systems, </span><br><span class="line">such <span class="keyword">as</span> speech recognition, machine translation <span class="keyword">and</span> sentiment analysis.</span><br><span class="line"></span><br><span class="line">One reason I value my work <span class="keyword">is</span> the potential impact it has on various industries. </span><br><span class="line">For instance, <span class="keyword">in</span> the healthcare sector, my language processing algorithms can extract </span><br><span class="line"><span class="keyword">and</span> analyze medical information <span class="keyword">from</span> patients<span class="string">&#x27; records, </span></span><br><span class="line"><span class="string">helping doctors make accurate diagnoses and treatment plans. </span></span><br><span class="line"><span class="string">This not only saves time but also enhances patient care. </span></span><br><span class="line"><span class="string">Moreover, in the customer service industry, my language processing models </span></span><br><span class="line"><span class="string">enable chatbots to understand customer inquiries and </span></span><br><span class="line"><span class="string">provide relevant solutions, resulting in improved customer satisfaction </span></span><br><span class="line"><span class="string">and cost reduction for companies.</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">In terms of future plans, I am highly motivated to further advance </span></span><br><span class="line"><span class="string">the field of natural language understanding. </span></span><br><span class="line"><span class="string">Current language processing systems still face some challenges, </span></span><br><span class="line"><span class="string">such as accurately understanding the nuances of human conversation </span></span><br><span class="line"><span class="string">and maintaining context over extended dialogues. </span></span><br><span class="line"><span class="string">I aspire to contribute to the development of more sophisticated algorithms and </span></span><br><span class="line"><span class="string">models that can tackle these issues effectively. </span></span><br><span class="line"><span class="string">By doing so, I aim to enable machines to truly understand and </span></span><br><span class="line"><span class="string">interpret human language, revolutionizing human-computer interaction.</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">I find great satisfaction in the close alignment between my professional skills and </span></span><br><span class="line"><span class="string">interests with the requirements of this job. </span></span><br><span class="line"><span class="string">Throughout my academic years, I have extensively studied and </span></span><br><span class="line"><span class="string">worked on various natural language processing projects, </span></span><br><span class="line"><span class="string">including sentiment analysis of social media data and automatic speech recognition systems. </span></span><br><span class="line"><span class="string">These experiences have equipped me with a deep understanding of </span></span><br><span class="line"><span class="string">the theoretical foundations and practical applications of natural language processing.</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">Additionally, my passion for solving complex problems drives me to seek innovative solutions. </span></span><br><span class="line"><span class="string">I enjoy delving into the intricacies of language and </span></span><br><span class="line"><span class="string">finding creative ways to overcome the challenges that arise in processing it. </span></span><br><span class="line"><span class="string">By leveraging my knowledge in machine learning and computational linguistics, </span></span><br><span class="line"><span class="string">I constantly strive to improve the accuracy and efficiency of language processing systems.</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">In conclusion, my role as a natural language processing engineer offers me </span></span><br><span class="line"><span class="string">the opportunity to make a positive impact on various industries, </span></span><br><span class="line"><span class="string">while fueling my passion for advancing the field of language understanding. </span></span><br><span class="line"><span class="string">With my expertise and determination to overcome challenges, </span></span><br><span class="line"><span class="string">I am confident in my ability to contribute towards the development of more advanced language processing systems.</span></span><br></pre></td></tr></table></figure></div><div class="tab-pane" id="8分-2"><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><span class="line">Beijing <span class="keyword">is</span> a city steeped <span class="keyword">in</span> history <span class="keyword">and</span> culture.</span><br><span class="line">Located <span class="keyword">in</span> the heart of China, it <span class="keyword">is</span> a bustling metropolis filled <span class="keyword">with</span> mesmerizing sights <span class="keyword">and</span> diverse experiences. </span><br><span class="line">Although I am <span class="keyword">not</span> originally <span class="keyword">from</span> here, having spent more than three years working </span><br><span class="line"><span class="keyword">in</span> this vibrant city, it has become my second home. </span><br><span class="line">I would like to share <span class="keyword">with</span> you two reasons why I love Beijing <span class="keyword">and</span> two reasons why I find it challenging at times.</span><br><span class="line"></span><br><span class="line">Firstly, Beijing <span class="keyword">is</span> known <span class="keyword">for</span> its rich historical heritage. </span><br><span class="line">The city boasts magnificent landmarks such <span class="keyword">as</span> the Great Wall of China <span class="keyword">and</span> the Forbidden City, </span><br><span class="line">which are testaments to the country<span class="string">&#x27;s ancient civilization. </span></span><br><span class="line"><span class="string">Exploring these architectural marvels gives one a profound sense of awe and </span></span><br><span class="line"><span class="string">admiration for the ingenuity of our ancestors. </span></span><br><span class="line"><span class="string">Walking through the narrow alleyways known as hutongs allows you to </span></span><br><span class="line"><span class="string">witness the traditional way of life that has been preserved amidst modernization.</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">Secondly, Despite being deeply rooted in its cultural heritage, </span></span><br><span class="line"><span class="string">Beijing never ceases to amaze with its innovative advancements in technology. </span></span><br><span class="line"><span class="string">As a major hub for tech industries, the city has witnessed tremendous growth in fields </span></span><br><span class="line"><span class="string">such as artificial intelligence, e-commerce, and high-speed transportation systems. </span></span><br><span class="line"><span class="string">Beijing&#x27;</span>s embrace of new technologies <span class="keyword">is</span> most evident <span class="keyword">in</span> the implementation of mobile payment systems, </span><br><span class="line">smart transportation networks, <span class="keyword">and</span> futuristic architecture. </span><br><span class="line">The convenience <span class="keyword">and</span> efficiency offered by these advancements truly </span><br><span class="line">make Beijing a technologically advanced city <span class="keyword">and</span> enhance the quality of life <span class="keyword">for</span> its residents.</span><br><span class="line"></span><br><span class="line">However, there are also a few aspects of Beijing that can be challenging <span class="keyword">for</span> its residents. </span><br><span class="line">One of the drawbacks <span class="keyword">is</span> the Busy <span class="keyword">and</span> Hectic Lifestyle. </span><br><span class="line">The city<span class="string">&#x27;s constant energy and numerous opportunities for professional growth can be exciting, </span></span><br><span class="line"><span class="string">but it also comes with a downside. </span></span><br><span class="line"><span class="string">The relentless pace of life, coupled with long working hours and intense competition, </span></span><br><span class="line"><span class="string">can leave little room for relaxation and personal time. </span></span><br><span class="line"><span class="string">The pressure to keep up with the bustling city can be exhausting and overwhelming at times. </span></span><br><span class="line"><span class="string">It is crucial to find a balance between work and personal life in order to </span></span><br><span class="line"><span class="string">maintain overall well-being and prevent burnout.</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">Another challenge is the overwhelming crowds. </span></span><br><span class="line"><span class="string">Beijing attracts millions of tourists each year, leading to crowded streets and popular attractions. </span></span><br><span class="line"><span class="string">Navigating through the bustling crowds can be tiring and time-consuming, particularly during peak seasons. </span></span><br><span class="line"><span class="string">It&#x27;</span>s essential to plan outings carefully to avoid the busiest times <span class="keyword">and</span> secure a more enjoyable experience.</span><br><span class="line"></span><br><span class="line">In conclusion, Beijing <span class="keyword">is</span> a city that captivates <span class="keyword">with</span> its rich history, cultural treasures, <span class="keyword">and</span> vibrant lifestyle. </span><br><span class="line">While a busy lifestyle <span class="keyword">and</span> overcrowding present challenges, they do <span class="keyword">not</span> overshadow the city<span class="string">&#x27;s unique charm. </span></span><br><span class="line"><span class="string">It is a place where modernity meets tradition, making it a truly extraordinary and captivating destination.</span></span><br></pre></td></tr></table></figure></div><div class="tab-pane" id="8分-3"><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line">I live <span class="keyword">in</span> Haidian District, Beijing, <span class="keyword">in</span> a two-bedroom apartment. </span><br><span class="line">The location <span class="keyword">is</span> fantastic <span class="keyword">as</span> there are numerous shopping malls <span class="keyword">for</span> convenient shopping <span class="keyword">and</span> entertainment. </span><br><span class="line">Additionally, there <span class="keyword">is</span> a beautiful park right <span class="built_in">next</span> to my building </span><br><span class="line">where I can engage <span class="keyword">in</span> fitness activities <span class="keyword">and</span> take leisurely walks.</span><br><span class="line"></span><br><span class="line">One of the reasons I enjoy staying at home <span class="keyword">is</span> because of my study room. </span><br><span class="line">It <span class="keyword">is</span> a cozy <span class="keyword">and</span> well-lit space filled <span class="keyword">with</span> <span class="built_in">all</span> my books <span class="keyword">and</span> study materials. </span><br><span class="line">Firstly, I appreciate the peace <span class="keyword">and</span> quiet it provides. </span><br><span class="line">It allows me to concentrate <span class="keyword">and</span> delve into my studies without <span class="built_in">any</span> distractions. </span><br><span class="line">Secondly, it has a comfortable desk <span class="keyword">and</span> chair that promote good posture </span><br><span class="line"><span class="keyword">and</span> ensure a conducive learning environment. </span><br><span class="line">I find myself being more productive <span class="keyword">and</span> focused <span class="keyword">in</span> this dedicated study space.</span><br><span class="line"></span><br><span class="line">Living <span class="keyword">in</span> such a prime location, I have no plans to move anytime soon. </span><br><span class="line">I want to stay here until I decide to switch jobs. </span><br><span class="line">The convenience of having various shopping malls nearby makes life extremely convenient, </span><br><span class="line">saving me time <span class="keyword">and</span> effort. Furthermore, the park adjacent to my apartment <span class="keyword">is</span> a sanctuary <span class="keyword">for</span> me. </span><br><span class="line">It provides me <span class="keyword">with</span> a peaceful retreat amidst the bustling city, where I can relax, exercise, </span><br><span class="line"><span class="keyword">and</span> connect <span class="keyword">with</span> nature. </span><br><span class="line">This sense of tranquility <span class="keyword">is</span> essential <span class="keyword">for</span> me <span class="keyword">in</span> maintaining a healthy work-life balance.</span><br><span class="line"></span><br><span class="line">Overall, <span class="keyword">with</span> <span class="built_in">all</span> the amenities available <span class="keyword">and</span> the comfort of my study room, </span><br><span class="line">I have no desire to relocate <span class="keyword">in</span> the foreseeable future. </span><br><span class="line">This place meets <span class="built_in">all</span> my needs <span class="keyword">and</span> allows me to enjoy a balanced <span class="keyword">and</span> fulfilling lifestyle. </span><br><span class="line">Considering the convenience, tranquility, <span class="keyword">and</span> productivity that my current residence offers, </span><br><span class="line">I am confident that it will <span class="keyword">continue</span> to suit me until I decide to make a career change.</span><br></pre></td></tr></table></figure></div></div></div>
<div class="tabs" id="6分"><ul class="nav-tabs"><li class="tab active"><a href="#6分-1">家乡</a></li><li class="tab"><a href="#6分-2">居住</a></li></ul><div class="tab-content"><div class="tab-pane active" id="6分-1"><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><span class="line">today I<span class="string">&#x27;d like to introduce my hometown, Beijing. </span></span><br><span class="line"><span class="string">Although I am not originally from here, having spent more than three years working in this vibrant city, </span></span><br><span class="line"><span class="string">it has become my second home. </span></span><br><span class="line"><span class="string">I would like to share with you two reasons why I love Beijing and </span></span><br><span class="line"><span class="string">two reasons why I find it challenging at times.</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">Beijing is known for its rich historical heritage. </span></span><br><span class="line"><span class="string">The city boasts magnificent landmarks such as the Great Wall of China and the Forbidden City, </span></span><br><span class="line"><span class="string">which are testaments to the country&#x27;</span>s ancient civilization. </span><br><span class="line">Exploring these architectural marvels gives one a profound sense of awe <span class="keyword">and</span> </span><br><span class="line">admiration <span class="keyword">for</span> the ingenuity of our ancestors. </span><br><span class="line">Walking through the narrow alleyways known <span class="keyword">as</span> hutongs allows you to witness </span><br><span class="line">the traditional way of life that has been preserved amidst modernization.</span><br><span class="line"></span><br><span class="line">Another aspect that has deeply impressed me <span class="keyword">is</span> Beijing<span class="string">&#x27;s advancements in technology and innovation. </span></span><br><span class="line"><span class="string">The city is a global hub for tech enthusiasts and entrepreneurs alike. </span></span><br><span class="line"><span class="string">High-tech parks like Zhongguancun are brimming with cutting-edge startups and </span></span><br><span class="line"><span class="string">research centers, contributing to China&#x27;</span>s prominence <span class="keyword">in</span> the tech world. </span><br><span class="line">The convenience of mobile payment systems, bike-sharing services, </span><br><span class="line"><span class="keyword">and</span> the integration of technology into daily life has truly transformed the city<span class="string">&#x27;s </span></span><br><span class="line"><span class="string">landscape and made it a futuristic marvel.</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">However, no place is without its challenges. One notable drawback is the traffic congestion. </span></span><br><span class="line"><span class="string">The city&#x27;</span>s rapid growth <span class="keyword">and</span> ever-increasing population have led to </span><br><span class="line">crowded roads <span class="keyword">and</span> extended commute times. Navigating through traffic jams can be frustrating <span class="keyword">and</span> </span><br><span class="line">time-consuming, impacting both productivity <span class="keyword">and</span> overall quality of life.</span><br><span class="line"></span><br><span class="line">Furthermore, the fast-paced lifestyle <span class="keyword">in</span> Beijing often brings about significant life pressures. </span><br><span class="line">The competitive nature of the city, coupled <span class="keyword">with</span> high expectations <span class="keyword">and</span> demands, </span><br><span class="line">can lead to stress <span class="keyword">and</span> burnout. Finding a balance between work <span class="keyword">and</span> </span><br><span class="line">personal life can sometimes be a real challenge, </span><br><span class="line"><span class="keyword">and</span> it<span class="string">&#x27;s crucial to actively seek ways to manage these pressures effectively.</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">In conclusion, despite not being born in Beijing, </span></span><br><span class="line"><span class="string">I&#x27;</span>ve grown to love this vibrant city <span class="keyword">as</span> <span class="keyword">if</span> it were my hometown. </span><br><span class="line">Its rich cultural tapestry <span class="keyword">and</span> technological advancements are </span><br><span class="line">truly captivating aspects that have left a lasting impression on me. </span><br><span class="line">However, I can<span class="string">&#x27;t ignore the challenges of traffic congestion and </span></span><br><span class="line"><span class="string">the high-paced lifestyle that can sometimes take a toll on residents. </span></span><br><span class="line"><span class="string">Through embracing the positives and finding ways to mitigate the negatives, </span></span><br><span class="line"><span class="string">I&#x27;</span>ve come to see Beijing <span class="keyword">as</span> a unique blend of tradition <span class="keyword">and</span> modernity that has made a profound impact on my life.</span><br></pre></td></tr></table></figure></div><div class="tab-pane" id="6分-2"><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line">Well, I<span class="string">&#x27;d like to talk about the place where I currently live. </span></span><br><span class="line"><span class="string">It&#x27;</span>s <span class="keyword">in</span> the Haidian district of Beijing, which <span class="keyword">is</span> a bustling <span class="keyword">and</span> vibrant area. </span><br><span class="line">I<span class="string">&#x27;m residing in a two-bedroom, one-living room apartment that I&#x27;</span>m renting.</span><br><span class="line"></span><br><span class="line">What makes my living situation even better <span class="keyword">is</span> the fact that there<span class="string">&#x27;s a beautiful park right next to the building. </span></span><br><span class="line"><span class="string">This park offers a perfect setting for outdoor activities like jogging, exercising, and leisurely walks. </span></span><br><span class="line"><span class="string">Spending time there is not only a great way to stay active but also provides a much-needed escape from </span></span><br><span class="line"><span class="string">the city&#x27;</span>s hustle <span class="keyword">and</span> bustle. I find it refreshing to connect <span class="keyword">with</span> nature, especially after a long day.</span><br><span class="line"></span><br><span class="line">One of the things I really appreciate about my apartment <span class="keyword">is</span> the dedicated study room. </span><br><span class="line">Spending time there has become a cherished part of my routine <span class="keyword">for</span> a couple of reasons. </span><br><span class="line">Firstly, it greatly aids my work <span class="keyword">and</span> research. As I<span class="string">&#x27;m someone who values productivity, </span></span><br><span class="line"><span class="string">having a dedicated space to focus on tasks helps me maintain a structured routine. </span></span><br><span class="line"><span class="string">The room&#x27;</span>s ambiance promotes concentration, <span class="keyword">and</span> I find myself accomplishing tasks more efficiently.</span><br><span class="line"></span><br><span class="line">As <span class="keyword">for</span> my living plans, I don<span class="string">&#x27;t have any intentions of moving anytime soon. </span></span><br><span class="line"><span class="string">I&#x27;</span>m planning to <span class="keyword">continue</span> living here until I find a new job opportunity that prompts a relocation. </span><br><span class="line">I believe that my current living situation aligns perfectly <span class="keyword">with</span> my needs <span class="keyword">and</span> preferences, </span><br><span class="line"><span class="keyword">and</span> it<span class="string">&#x27;s conducive to my personal and professional growth.</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">In conclusion, my apartment in Haidian District, Beijing, offers a blend of convenience, relaxation, </span></span><br><span class="line"><span class="string">and productivity. The array of shopping centers nearby, coupled with the adjacent park and </span></span><br><span class="line"><span class="string">my beloved study room, create a balanced and fulfilling lifestyle. </span></span><br><span class="line"><span class="string">As I look ahead, I&#x27;</span>m content <span class="keyword">with</span> my current living situation <span class="keyword">and</span> excited to see </span><br><span class="line">how it supports my aspirations <span class="keyword">and</span> endeavors.</span><br></pre></td></tr></table></figure></div></div></div>
<h1 id="section">2023</h1>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">yestarday, last week, last month</span><br><span class="line">when I was a child, </span><br></pre></td></tr></table></figure>
<h2 id="name">name</h2>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># what&#x27;s your name? What can I call you? </span></span><br><span class="line"><span class="comment"># are you a student or do you work? </span></span><br><span class="line">well, i am work right now, <span class="keyword">as</span> a computer programmer, i work <span class="keyword">in</span> a leading company. </span><br><span class="line"></span><br><span class="line"><span class="comment"># hometown? (smog / fog , dislike - poor traffic condition peak hour - natural environment - smog / fog )</span></span><br><span class="line">my hometown <span class="keyword">is</span> jilin, but i worked <span class="keyword">in</span> BJ <span class="keyword">for</span> <span class="number">3</span> years, so i think BJ <span class="keyword">is</span> my second hometown. </span><br><span class="line"></span><br><span class="line"><span class="comment"># like reason?</span></span><br><span class="line">I like BJ, it<span class="string">&#x27;s a big city and it&#x27;</span>s our capital, </span><br><span class="line">The most important reason <span class="keyword">is</span> that it provides me <span class="keyword">with</span> more opportunities, especially to start my career.</span><br><span class="line"></span><br><span class="line"><span class="comment"># Is there any thing you don&#x27;t like BJ?</span></span><br><span class="line">Yes, I don<span class="string">&#x27;t like the bad state of traffic at peak times，there are so many people, it&#x27;</span>s very crowded.</span><br><span class="line">And the natural environment <span class="keyword">is</span> <span class="keyword">not</span> particularly nice, especially <span class="keyword">in</span> autumn <span class="keyword">and</span> winter.There <span class="keyword">is</span> a lot of smog there.</span><br><span class="line"></span><br><span class="line"><span class="comment"># accommodation</span></span><br><span class="line">I rent an apartment, there <span class="keyword">is</span> a bedroom, it <span class="keyword">is</span> <span class="keyword">not</span> very special, but it has a bed <span class="keyword">and</span> a desk, I think it <span class="keyword">is</span> very cozy. </span><br><span class="line">In addition, there <span class="keyword">is</span> also a small room attached, which I use <span class="keyword">as</span> my study <span class="keyword">and</span> workplace. </span><br><span class="line">It allows me to concentrate on my studies without distractions.</span><br></pre></td></tr></table></figure>
<h2 id="tea-and-coffee">Tea and coffee</h2>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># Do people like tea and coffee nowadays?</span></span><br><span class="line">yes, most people prefer drinking them. But I think the young generation likes coffee, </span><br><span class="line">when they get up, they like taking a cup of coffee to the office. it <span class="keyword">is</span> very refreshing. </span><br><span class="line">The older generation prefers tea more than coffee because most of them have a problem getting sleep, </span><br><span class="line">they hardly drink coffee.</span><br><span class="line"></span><br><span class="line"><span class="comment"># Do you like tea or coffee?</span></span><br><span class="line">I don<span class="string">&#x27;t like them. Because most of the time I prefer drinking soda water, like sparkling water. </span></span><br><span class="line"><span class="string">It is very refreshing. But tea and coffee have bad flavor compared with water.</span></span><br><span class="line"><span class="string">So most of the morning, when I get up, I want to buy sparkling water and take it to the office. </span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string"># do you prefer to use tea or coffee to serve your guests?</span></span><br><span class="line"><span class="string">I prefer tea better than coffee. As most Chinese like drinking hot water, </span></span><br><span class="line"><span class="string">we are not very familiar with the flavor of coffee. So tea is a better choice.</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string"># when was the last time you had a cup of coffee?</span></span><br><span class="line"><span class="string">Last week, when my colleague wanted to order a cup of coffee. She asked me what I wanted, </span></span><br><span class="line"><span class="string">so I chose a cap of latte. But you know, I am not a big fan of coffee, I do not think it tastes good.</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string"># do you ususally buy your coffee in a coffee shop?</span></span><br><span class="line"><span class="string">If I buy coffee, I like buying from real coffee shops such as Lukin and Starbucks. </span></span><br><span class="line"><span class="string">As there are so many shops near my office, it is a good choice to buy from them. </span></span><br><span class="line"><span class="string">It tastes better than instant coffee.</span></span><br></pre></td></tr></table></figure>
<h2 id="film">film</h2>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># what films do you like? </span></span><br><span class="line">The Matrix 黑客帝国</span><br><span class="line">The movie was born <span class="keyword">in</span> the 20th century, but nowadays, it <span class="keyword">is</span> also a high-tech film, the plot <span class="keyword">is</span> <span class="keyword">not</span> old-fashioned. </span><br><span class="line">The main topic of this film <span class="keyword">is</span> related to AI, which has been a hot topic <span class="keyword">in</span> recent years. </span><br><span class="line">As you know, I am a CP,  so I am very interested <span class="keyword">in</span> this field.</span><br><span class="line"></span><br><span class="line"><span class="comment"># Do you often watch film?</span></span><br><span class="line">When I was a university student, I always watched films <span class="keyword">in</span> the cinema. But now, I am so busy <span class="keyword">with</span> my work, </span><br><span class="line">you know my workload <span class="keyword">is</span> so heavy. So I don<span class="string">&#x27;t have much time to go to the cinema.</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string"># Did you ever go to the cinema alone as a child? [过去]</span></span><br><span class="line"><span class="string">As a little boy, I had never been to the cinema alone. Because at that time I lived in a small place, </span></span><br><span class="line"><span class="string">where there was only one cinema in my city, it was very far from my home. </span></span><br><span class="line"><span class="string">So my parents didn&#x27;</span>t allow me to go alone when considering safety.</span><br><span class="line"></span><br><span class="line"><span class="comment"># do you think going to the cinema is a good way to spend time with friends? </span></span><br><span class="line">depend on the situation. <span class="keyword">if</span> we are familar <span class="keyword">with</span> each other, cinema <span class="keyword">is</span> a good place <span class="keyword">as</span> </span><br><span class="line">we can share the emotions of the movie. But <span class="keyword">if</span> we just date <span class="keyword">for</span> one time, I will <span class="keyword">not</span> choose the cinema, </span><br><span class="line"><span class="keyword">as</span> it <span class="keyword">is</span> too dark inside <span class="keyword">and</span> we cannot talk at <span class="built_in">all</span>.</span><br></pre></td></tr></table></figure>
<h2 id="running">Running</h2>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># do you go running a lot?</span></span><br><span class="line">I run around my community after work, maybe <span class="number">3</span> <span class="keyword">or</span> <span class="number">4</span> times a week. I think it <span class="keyword">is</span> a good way to keep fit <span class="keyword">and</span> healthy, </span><br><span class="line"><span class="keyword">and</span> running <span class="keyword">is</span> completely free, you can run anywhere.</span><br><span class="line"></span><br><span class="line"><span class="comment"># where do you usually go running?</span></span><br><span class="line">Community - There <span class="keyword">is</span> a park downstairs <span class="keyword">from</span> where I live. When I<span class="string">&#x27;m running, I like to watch other people exercising. </span></span><br><span class="line"><span class="string">Also, the air in the park is fresh because there are lots of green trees and plants.</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string"># what do you think of running as a form of exercies?</span></span><br><span class="line"><span class="string">I think it is a good way, it can bring a lot of benefits, firstly, running is good for all parts of the muscles, </span></span><br><span class="line"><span class="string">including legs, arms and core, not just one point, secondly, it is a good habit, for example, </span></span><br><span class="line"><span class="string">if someone runs for half an hour every day, it is easy to keep fit.</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string"># when was the last time you went to running?</span></span><br><span class="line"><span class="string">Yesterday, As I have to take IELTS today, I felt nervous, so I went downstairs and </span></span><br><span class="line"><span class="string">ran for one hour in order to keep calm. After doing that, I felt better right now.</span></span><br></pre></td></tr></table></figure>
<h2 id="robots">robots</h2>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># are robots improtant? [写作]</span></span><br><span class="line">I think robots are very necessary. For example, there are many dangerous works that have already been done by robots, </span><br><span class="line">you can find robots polishing the window outside the skyscraper. besides that, some boring jobs, </span><br><span class="line">such <span class="keyword">as</span> those on assembly lines, can be replaced by robotic arms, which can work <span class="number">24</span>/<span class="number">7</span> <span class="keyword">and</span> make few mistakes.</span><br><span class="line"></span><br><span class="line"><span class="comment"># would robots affect people&#x27;s lives? </span></span><br><span class="line">yes, the positive effect <span class="keyword">and</span> negative effects <span class="keyword">as</span> well. For example, robots can bring convenience to people,</span><br><span class="line">such <span class="keyword">as</span> when we go to restaurants, we can find many robots deliver dishes, </span><br><span class="line">it <span class="keyword">is</span> cleaner <span class="keyword">and</span> safer than the people deliver dishes. but on the other hand, </span><br><span class="line">it also raises the unemployment rate, such that poor people hard to support their families, </span><br><span class="line">because they lose their jobs.</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># have you ever watched a moive about robots? plot情节</span></span><br><span class="line">Artificial Intelligence 人工智能</span><br><span class="line">As I<span class="string">&#x27;m a big fan of film. I watch a lot of fiction films, there are several films to talk about robots, </span></span><br><span class="line"><span class="string">such as AI. The main plot in the film is about the future world, The parents lost their child, </span></span><br><span class="line"><span class="string">they asked the company to design a robot boy for them. But in the end, they want to drop the robot boy </span></span><br><span class="line"><span class="string">because of moral ideas. The robot boy tries his best to find love and trust in a close relationship.</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string"># should we let a robot drive for us for long journeys? </span></span><br><span class="line"><span class="string">I think it&#x27;</span>s okay. the driverless car, we can enjoy the journey by doing some entertainment such <span class="keyword">as</span> </span><br><span class="line">watching films <span class="keyword">and</span> chatting <span class="keyword">with</span> passengers. When the technology <span class="keyword">is</span> mature, </span><br><span class="line">I think most cars don<span class="string">&#x27;t need drivers in the future.</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string"># What can robots do for you at home? </span></span><br><span class="line"><span class="string"># boring works - such as pick up deliveries / cooking / housework - dishwasher </span></span><br><span class="line"><span class="string">Sweeping robots that have variable written programs to clean the floor hygienically at regular intervals. </span></span><br><span class="line"><span class="string">Robots that take care of the elderly or children, but this has some safety risks that </span></span><br><span class="line"><span class="string">will take a long time to resolve in the future.</span></span><br></pre></td></tr></table></figure>
<h2 id="gifts">gifts</h2>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># have you ever sent handmade gifts to others? </span></span><br><span class="line">Well, never, It<span class="string">&#x27;s hard for me to do some handicrafts because I&#x27;</span>m stupid.</span><br><span class="line">I<span class="string">&#x27;d like to buy a real gift for others on special occasions, last year for my mother&#x27;</span>s birthday I bought her a flower.</span><br><span class="line"></span><br><span class="line"><span class="comment"># have you ever received a great gift? </span></span><br><span class="line">Nothing special. but recently I got some tea <span class="keyword">from</span> my colleague because he went to FJ where </span><br><span class="line">there <span class="keyword">is</span> a famous tea plantation. He bought me some tea <span class="keyword">as</span> a gift. It <span class="keyword">is</span> really tasty, the flavour <span class="keyword">is</span> good.</span><br><span class="line"></span><br><span class="line"><span class="comment"># how to choose a gift ？</span></span><br><span class="line">The first step <span class="keyword">is</span> to get to know the other person<span class="string">&#x27;s tastes, such as their preference for electronics or perfume.</span></span><br><span class="line"><span class="string">When we choose the gift what we have to satisfy the needs and wants of them. </span></span><br><span class="line"><span class="string">And next step is to find out the meaning of gifts, such as flowers have a lot of meaning, </span></span><br><span class="line"><span class="string">especially to a girl, and then have a nice package as the last step. </span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string"># do you think you are good at choosing gifts? </span></span><br><span class="line"><span class="string">No, I&#x27;</span>m <span class="keyword">not</span> considerate, Sometimes I choose items they don<span class="string">&#x27;t like, </span></span><br><span class="line"><span class="string">but I don&#x27;</span>t know because the target may <span class="keyword">not</span> tell me their real feelings.</span><br><span class="line"></span><br><span class="line"><span class="comment"># what will you consider when choosing a gift. </span></span><br><span class="line">When I choose a gift, I consider the price <span class="keyword">and</span> the relationship. For the close relationship, </span><br><span class="line">such <span class="keyword">as</span> my parents <span class="keyword">and</span> my family, I prefer to buy things that they really want <span class="keyword">or</span> really need. </span><br><span class="line"><span class="keyword">not</span> just experience, but <span class="keyword">if</span> our relationship <span class="keyword">is</span> far away, <span class="keyword">not</span> so close, </span><br><span class="line">I have to decide why I am giving the gift <span class="keyword">and</span> decide how much money to spend.</span><br></pre></td></tr></table></figure>
<h2 id="helping-others">helping others</h2>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># do you usually help people around you?</span></span><br><span class="line">Yes, I always <span class="built_in">help</span> my colleagues to solve problems <span class="keyword">in</span> the workplace. As you know, our work <span class="keyword">is</span> professional, </span><br><span class="line">my skills are really good. I can always offer some <span class="built_in">help</span> to others.</span><br><span class="line"></span><br><span class="line"><span class="comment"># how do you help people around you, such as neighobours, family and friends?</span></span><br><span class="line">I rarely talk to my neighbors, I always work until midnight, <span class="keyword">and</span> sometimes I have to work overtime, </span><br><span class="line">so I hardly meet my neighbors, that<span class="string">&#x27;s why I rarely help them. </span></span><br><span class="line"><span class="string">I work in BJ, which is far away from my hometown when they have problems, </span></span><br><span class="line"><span class="string">it&#x27;</span>s hard <span class="keyword">for</span> me to <span class="built_in">help</span> them. but <span class="keyword">for</span> friends, I always offer them some <span class="built_in">help</span>.</span><br><span class="line"></span><br><span class="line"><span class="comment"># do your parents teach you how to help others? / do you teach your child how to help others? </span></span><br><span class="line">Yes, because helping others <span class="keyword">is</span> our traditional culture, when I was a little boy, </span><br><span class="line">my parents always told me to <span class="built_in">help</span> others, <span class="keyword">not</span> only my neighbors but also my friends.</span><br><span class="line"></span><br><span class="line"><span class="comment"># did your parents help you a lot when you were young? </span></span><br><span class="line">Yes, definitely. When I was a little boy, I was <span class="keyword">not</span> good at studying, especially my maths problem, </span><br><span class="line">so my parents always taught me <span class="keyword">and</span> told me how to do my homework after work.</span><br><span class="line"></span><br><span class="line"><span class="comment"># what have you done to help the elderly?</span></span><br><span class="line">During Cover <span class="number">19</span>, we have to work <span class="keyword">or</span> study at home, My neighbor <span class="keyword">is</span> an old lady <span class="keyword">with</span> a young grandchild, </span><br><span class="line">the young grandchild has to attend school classes but she cannot use the laptop, </span><br><span class="line">so I use my skills to <span class="built_in">help</span> the old lady solve the problems <span class="keyword">with</span> her grandchildren.</span><br></pre></td></tr></table></figure>
<h2 id="fishing">fishing</h2>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># is fishing popular in your country? </span></span><br><span class="line">A few years ago, fishing was a good family activity, </span><br><span class="line">but now that people have more activities to do <span class="keyword">in</span> their spare time, </span><br><span class="line">such <span class="keyword">as</span> going to a theme park, they are less likely to go fishing, so it <span class="keyword">is</span> <span class="keyword">not</span> <span class="keyword">as</span> popular <span class="keyword">as</span> it used to be.</span><br><span class="line"></span><br><span class="line"><span class="comment"># do you like eating fish?</span></span><br><span class="line">I am a fish lover, you know recently I have kept fit, there <span class="keyword">is</span> a lot of protein <span class="keyword">in</span> fish, </span><br><span class="line">contains low calories, so eating fish <span class="keyword">is</span> good <span class="keyword">for</span> my health <span class="keyword">and</span> keeping fit.</span><br><span class="line"></span><br><span class="line"><span class="comment"># have you ever been to a place where there are lots of fish around you?</span></span><br><span class="line">Well, last year when I visited Ocean Park <span class="keyword">in</span> BJ, there was a huge glass window <span class="keyword">in</span> front of me, </span><br><span class="line"><span class="keyword">and</span> inside there were lots of fish, including big fish, small fish, colorful fish, <span class="keyword">and</span> sharks, </span><br><span class="line">I felt amazing, I never saw so many fish before.</span><br><span class="line"></span><br><span class="line"><span class="comment"># have you seen any movies with lots of fish? documentary 纪录片</span></span><br><span class="line">Well, it <span class="keyword">is</span> hard to remember, but I still remember I saw a documentary, especially a film on the BBC, </span><br><span class="line">it talked about different kinds of marine animals, like dolphins, sharks <span class="keyword">and</span> different kinds of fish.</span><br></pre></td></tr></table></figure>
<h2 id="geography">geography</h2>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># how do you like Geography?</span></span><br><span class="line">I don<span class="string">&#x27;t like geography. because I think it&#x27;</span>s complicated, <span class="keyword">and</span> there can be too much information to remember. </span><br><span class="line">I still remember when I was studying geography <span class="keyword">in</span> middle school, the teacher asked us to remember </span><br><span class="line">wind patterns <span class="keyword">and</span> ocean currents, it<span class="string">&#x27;s too terrible for me.</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string"># do you think Geography is useful? </span></span><br><span class="line"><span class="string">Yes, I think it&#x27;</span>s very useful, especially when we go travelling to other places, some places where unfamiliar visit, </span><br><span class="line">we have to know the weather <span class="keyword">and</span> culture <span class="keyword">and</span> some habits there, so geography <span class="keyword">is</span> useful <span class="keyword">for</span> our life.</span><br><span class="line"></span><br><span class="line"><span class="comment"># have you ever learned Geography?</span></span><br><span class="line">Well, <span class="keyword">in</span> middle school I had to study geography, It<span class="string">&#x27;s kind of a compulsory course, but I&#x27;</span>m <span class="keyword">not</span> good at it, </span><br><span class="line">I don<span class="string">&#x27;t have a high score, so I didn&#x27;</span>t choose geography <span class="keyword">as</span> my major.</span><br><span class="line"></span><br><span class="line"><span class="comment"># do you want to be a Geography teacher? criteria标准</span></span><br><span class="line">nope, when I consider my starting career, there are several criteria, First of <span class="built_in">all</span>, <span class="keyword">as</span> my major <span class="keyword">is</span> computer science, </span><br><span class="line">I want to choose a job related to my major. secondly, I want to pursue a high salary, <span class="keyword">and</span> lastly, </span><br><span class="line">I have to find a platform that can <span class="built_in">help</span> me get a promotion. but <span class="keyword">if</span> the position does <span class="keyword">not</span> satisfy <span class="built_in">all</span> career criteria, </span><br><span class="line">I wouldn<span class="string">&#x27;t choose that, In my opinion, geography teacher is not my opinion at all.</span></span><br></pre></td></tr></table></figure>
<h2 id="noise">noise</h2>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># do you like to stay in a place with a lot of noise?</span></span><br><span class="line">well, i don<span class="string">&#x27;t like to stay in a noisy place because it&#x27;</span>s hard <span class="keyword">for</span> me to concentrate on my work, </span><br><span class="line"><span class="keyword">and</span> <span class="keyword">if</span> i stay <span class="keyword">in</span> a noisy place I would lose my mind, besides I think the noise <span class="keyword">is</span> <span class="keyword">not</span> good <span class="keyword">for</span> health, </span><br><span class="line">especially <span class="keyword">for</span> people<span class="string">&#x27;s mental health. so maybe people in noisy places are easy to get mental diseases.</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string"># what knids of noises are there in the area where you live?</span></span><br><span class="line"><span class="string">Around my place, there are several noises, such as traffic noise, especially in the peak hour in the morning, </span></span><br><span class="line"><span class="string">and car bibi, Besides that there is construction noise, such as people decorating or refreshing their apartment. </span></span><br><span class="line"><span class="string">and the most disturbing noise may be the chatting noise, When people talk about gossip, it attracts my attention.</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string"># do you want to move to a quieter place?</span></span><br><span class="line"><span class="string">Yes, because in the city center it&#x27;</span>s always too noisy, but <span class="keyword">in</span> a quiet place, maybe far away <span class="keyword">from</span> the city, </span><br><span class="line">it<span class="string">&#x27;s easy for me to concentrate on what I&#x27;</span>m doing, it can <span class="built_in">help</span> me relax without pressure, <span class="keyword">and</span> it<span class="string">&#x27;s good for my health.</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string"># do you think there is too much noise in today&#x27;</span>s world?</span><br><span class="line">Yes, nowadays there <span class="keyword">is</span> too much noise, especially <span class="keyword">in</span> the big city where I live, </span><br><span class="line">it<span class="string">&#x27;s too crowded with so many people living in the city, there are many voices, like chatting, traffic, construction.</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string"># is making noise one of people&#x27;</span>s rights? </span><br><span class="line">You have the freedom to make noise, but you can<span class="string">&#x27;t disturb others. </span></span><br><span class="line"><span class="string">for example, there&#x27;</span>s a hot topic on the high-speed train carriage, <span class="keyword">if</span> you make some noise, </span><br><span class="line">you might <span class="keyword">break</span> the rights of others who want a quiet environment.</span><br></pre></td></tr></table></figure>
<h2 id="musical-instruments">musical instruments</h2>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># have you ever learned to play a musical instrument?</span></span><br><span class="line">Well, I never played a musical instrument like piano <span class="keyword">or</span> violin because I lacked the talent <span class="keyword">for</span> that, </span><br><span class="line">when I was a little boy, I was <span class="keyword">not</span> good at music including singing <span class="keyword">and</span> playing on <span class="built_in">all</span> of them.</span><br><span class="line"></span><br><span class="line"><span class="comment"># what musical instrument do you enjoy listening to the most?</span></span><br><span class="line">I prefer the piano, it<span class="string">&#x27;s easy to access, and with more famous musicians, and more beautiful melodies, </span></span><br><span class="line"><span class="string">it can also provide emotional value, When I&#x27;</span>m feeling down, listening to some piano music can make me feel good.</span><br><span class="line"></span><br><span class="line"><span class="comment"># do you think children should learn to play an instrument at school? </span></span><br><span class="line">Yes， learning to play an instrument can <span class="built_in">help</span> children develop a sense of art, </span><br><span class="line">especially <span class="keyword">if</span> they have more opportunities to show themselves when they grow up.</span><br><span class="line"></span><br><span class="line"><span class="comment"># Do you think music education is important for children?</span></span><br><span class="line">Yes, music education can teach them to enjoy the art <span class="keyword">and</span> give them more choices when they choose a major.</span><br></pre></td></tr></table></figure>
<h2 id="chatting">chatting</h2>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># do you like chatting with friends?</span></span><br><span class="line">Yes, it<span class="string">&#x27;s easy for someone who is unfamiliar to become familiar with each other, </span></span><br><span class="line"><span class="string">It can strengthen the relationship if you find some common interests when you chat, </span></span><br><span class="line"><span class="string">and it&#x27;</span>s also a good way to learn <span class="keyword">from</span> othe<span class="string">r&#x27;s experiences, especially from older people.</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string"># what do you ususally chat about with friends?</span></span><br><span class="line"><span class="string">Yes, I usually like to share my interests with male colleagues, such as information about computers and games. </span></span><br><span class="line"><span class="string">For my female colleagues, I like to talk about topics that interest them, such as restaurants and shopping.</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string"># do you prefer to chat with a group of people or with only one friend?</span></span><br><span class="line"><span class="string">well, it depends on the situation, If discussing some open topic, </span></span><br><span class="line"><span class="string">like the destination where we will travel to, I like groups. </span></span><br><span class="line"><span class="string">however personal topics, I prefer one on one better.</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string"># do you prefer to communicate face-to-face or via social media?</span></span><br><span class="line"><span class="string">I prefer to communicate with others face to face, because it&#x27;</span>s real <span class="keyword">and</span> it can improve the efficiency of communication, </span><br><span class="line">Compared to social media, you know we can use the text <span class="keyword">or</span> pictures to talk to others, but lack of consistency.</span><br><span class="line"></span><br><span class="line"><span class="comment"># do you argue with friends?</span></span><br><span class="line">Normally no, I<span class="string">&#x27;m a good listener and follower, when we go on a trip, I always listen to others, </span></span><br><span class="line"><span class="string">you decide which restaurant we can go to, what we eat and how long we stay there.</span></span><br></pre></td></tr></table></figure>
<h2 id="map">map</h2>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># do you often use maps?</span></span><br><span class="line">Yes, I always use the online <span class="built_in">map</span>, when I want to find a specific place, such <span class="keyword">as</span> a restaurant <span class="keyword">or</span> a shop, </span><br><span class="line">I use my mobile phone <span class="keyword">and</span> <span class="built_in">open</span> my navigator, <span class="keyword">and</span> I can find it directly.</span><br><span class="line"></span><br><span class="line"><span class="comment"># do you use paper maps?</span></span><br><span class="line">No, it<span class="string">&#x27;s old-fashioned and inconvenient, and it can&#x27;</span>t be updated <span class="keyword">in</span> real-time, </span><br><span class="line"><span class="keyword">for</span> example, <span class="keyword">if</span> some roads are closer, it<span class="string">&#x27;s not shown on the paper map.</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string"># how often do you use maps on your phone? </span></span><br><span class="line"><span class="string">Well, almost every week, during the weekend, I like to go out with my friends, a</span></span><br><span class="line"><span class="string">nd sometimes we go to an unfamiliar place, I have to use my smartphone </span></span><br><span class="line"><span class="string">and open my navigator to find the unfamiliar place.</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string"># do you have maps at home?</span></span><br><span class="line"><span class="string">Yes, I have a big map of the world at home, because I have to study geography in middle school </span></span><br><span class="line"><span class="string">and my parents want the map to be useful.</span></span><br></pre></td></tr></table></figure>
<h2 id="transport">transport</h2>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># how do you go to work everyday?</span></span><br><span class="line">I usually take the bus to work, which takes about <span class="number">10</span> minutes. But <span class="keyword">if</span> the weather <span class="keyword">is</span> fine, I like to cycle. </span><br><span class="line">I think it <span class="keyword">is</span> a good way to get exercise <span class="keyword">and</span> it <span class="keyword">is</span> environmentally friendly.</span><br><span class="line"></span><br><span class="line"><span class="comment"># what means of transport do you use when going for a trip from your workplace?</span></span><br><span class="line">I prefer to take the shuttle bus. You know there <span class="keyword">is</span> a shuttle bus <span class="keyword">for</span> employees <span class="keyword">in</span> our company, </span><br><span class="line">it <span class="keyword">is</span> very convenient <span class="keyword">for</span> us to use it. It only takes <span class="number">10</span> minutes when I go home <span class="keyword">from</span> my company.</span><br><span class="line"></span><br><span class="line"><span class="comment"># is driving to work popular in your country?</span></span><br><span class="line">depend on which city to live <span class="keyword">in</span>. For the big city, driving to work <span class="keyword">is</span> <span class="keyword">not</span> convenient, </span><br><span class="line">because you have to pay <span class="keyword">for</span> parking <span class="keyword">and</span> there are traffic jams during the peak hour. </span><br><span class="line">But <span class="keyword">in</span> a small place, driving can <span class="built_in">help</span> people save time <span class="keyword">and</span> it <span class="keyword">is</span> an efficient way.</span><br><span class="line"></span><br><span class="line"><span class="comment"># Do you think people will drive more in the future.</span></span><br><span class="line">yes, <span class="keyword">with</span> the development of the economy, people will become richer than before, </span><br><span class="line"><span class="keyword">and</span> more people will afford the expense of using a car. So more people would like to buy a car <span class="keyword">in</span> the future. </span><br><span class="line">In addition, the government <span class="built_in">set</span> a policy to support electric cars, so <span class="keyword">in</span> my opinion, </span><br><span class="line">more people would like to use them <span class="keyword">in</span> the future.</span><br></pre></td></tr></table></figure>
<h2 id="clothing">clothing</h2>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># what kind of clothes do you like to wear?</span></span><br><span class="line">As I work <span class="keyword">in</span> a large company, there <span class="keyword">is</span> a dress code at work. So during the week, I will wear professional suits. </span><br><span class="line">But at the weekend, I prefer to wear sports clothes so that I can do sports easily.</span><br><span class="line"></span><br><span class="line"><span class="comment"># Do you prefer to wear comfortable and casual clothes or smart clothes? </span></span><br><span class="line">I prefer casual clothes because it <span class="keyword">is</span> very comfortable <span class="keyword">for</span> me to do everything like running <span class="keyword">and</span> other sports. </span><br><span class="line">You know, I have a habit of running after work, so <span class="keyword">if</span> I wear smart clothes, I have to change them before I do sports.</span><br><span class="line"></span><br><span class="line"><span class="comment"># do you like wearing T-shirts?</span></span><br><span class="line">No, I don<span class="string">&#x27;t. Because they don&#x27;</span>t look nice. Most T-shirts look the same, there <span class="keyword">is</span> no difference. </span><br><span class="line">I want to show my difference, so I prefer other clothes than T-shirts.</span><br><span class="line"></span><br><span class="line"><span class="comment"># Do you spend a lot of time choosing clothes?</span></span><br><span class="line">I don<span class="string">&#x27;t want to spend time choosing clothes because I think it&#x27;</span>s a waste of time.</span><br><span class="line">I usually <span class="keyword">match</span> my outfit sets ahead of time so I can choose a whole outfit quickly, it <span class="keyword">is</span> very convenient!</span><br></pre></td></tr></table></figure>
<p>口语 - 整理新题- 思考旧题；part2素材 写出来 - 英文</p>
<h1 id="p2">P2</h1>
<h2 id="材料准备">材料准备</h2>
<p>朋友、名人各一个，通过其实际例子体现他的性格和特点。<br />
旅游，时间地点人物，介绍景点，遇到的美好的事情，消极的事情，感受。</p>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="https://soundmemories.github.io/2022/09/02/IELTS/03.%E5%86%99%E4%BD%9C/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avstar.png">
      <meta itemprop="name" content="SoundMemories">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="SoundMemories">
      <meta itemprop="description" content="今日事，今日毕">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | SoundMemories">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2022/09/02/IELTS/03.%E5%86%99%E4%BD%9C/" class="post-title-link" itemprop="url">写作</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>

      <time title="创建时间：2022-09-02 00:00:00" itemprop="dateCreated datePublished" datetime="2022-09-02T00:00:00+08:00">2022-09-02</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">分类于</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/IELTS/" itemprop="url" rel="index"><span itemprop="name">IELTS</span></a>
        </span>
    </span>

  
    <span class="post-meta-break"></span>
    <span class="post-meta-item" title="本文字数">
      <span class="post-meta-item-icon">
        <i class="far fa-file-word"></i>
      </span>
      <span class="post-meta-item-text">本文字数：</span>
      <span>6k</span>
    </span>
    <span class="post-meta-item" title="阅读时长">
      <span class="post-meta-item-icon">
        <i class="far fa-clock"></i>
      </span>
      <span class="post-meta-item-text">阅读时长 &asymp;</span>
      <span>22 分钟</span>
    </span>
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <h2 id="考试介绍">考试介绍</h2>
<p>40min:
一大一小作文。大作文议论文占分数2/3，小作文图表占分数1/3，大作文很重要。</p>
<h2 id="大作文">大作文</h2>
<p>1.不要跑题，审题一定要严谨。<br />
2.对题干的每个关键词，都要有回应。<br />
3.给出一个清晰的立场。<br />
4.逻辑链要有层层推进，比如A好好学习，C达到人生巅峰，需要有B能上好学校，这种分论点支持链接。<br />
5.句子间有效链接。<br />
6.每个段落只能围绕一个分论点说，不能一个出点第二个分论点。</p>
<h3 id="题目类型">题目类型</h3>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 观点类</span></span><br><span class="line">Advantanges <span class="keyword">and</span> disadvantages？</span><br><span class="line">Positive <span class="keyword">or</span> negative development？</span><br><span class="line">To what extent do you agree <span class="keyword">or</span> disagree？</span><br><span class="line"><span class="comment"># 论述类</span></span><br><span class="line">Discuss both views <span class="keyword">and</span> give your own opinion？</span><br><span class="line"><span class="comment"># 报告类</span></span><br><span class="line">why has it happened？ How to solve it？</span><br><span class="line"><span class="comment"># 混合类</span></span><br><span class="line">原因 + 影响 + 方法</span><br></pre></td></tr></table></figure>
<h3 id="审题方法">审题方法</h3>
<p>ABC—审题准确度<br />
A：行为/动作<br />
B：A的结果<br />
C：B的结果</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">In the future, many people choose to study abroad. Is it a positive or negative development?</span><br><span class="line">A.出国留学 B.去优秀的大学读书 C.以后好找工作</span><br><span class="line">事情未必会发生 讨论主观想法：好处/坏处</span><br><span class="line"></span><br><span class="line">In the future, many people will choose to study abroad. Why will it happen？</span><br><span class="line">A.社会竞争激烈 B.雇主对好的文凭更加重视 C.出国留学</span><br><span class="line">针对已经发生或将来可能发生的事—想客观原因</span><br><span class="line"></span><br><span class="line">Many countries today require people to live a healthy life. Do you think it is a positive or negative trend?</span><br><span class="line">A.要求人们健康生活 B.注意运动和饮食 C.身体好</span><br><span class="line"></span><br><span class="line">The government should require people to lead a healthy lifestyle. To what extent do you agree or disagree?</span><br><span class="line">A.政府要人们过健康生活 B.人们多运动 减少疾病 C.提高社会生产力</span><br><span class="line"></span><br><span class="line">The only way to promote a healthy lifestyle is to pass laws. To what extent do you agree or disagree?</span><br><span class="line">A.立法 B.惩罚不健康行为 C.推广健康生活方式</span><br><span class="line">A.除了立法 增加宣传 B.提高健康意识 C.推广健康生活方式</span><br><span class="line"></span><br><span class="line">Many countries today have passed laws to require people to live a healthy life. Why do you think this has happened?</span><br><span class="line">A.市场竞争激烈 B.人们忙于工作 忽视健康 C.需要推广健康生活方式</span><br></pre></td></tr></table></figure>
<p>总结：<br />
1.判断题目类型？<br />
2.确定A（动作）还是C（结果）？<br />
3.人是谁？有没有限定讨论范围？<br />
4.有没有，形容词/状语/例子，解释名词？<br />
5.两个并列名词，要结合共同点进行写。<br />
6.比较级/最高级（instead of/rather than），重点是前面的主语。</p>
<p><img src="/images/IELTS/写作1.png" width="80%"></p>
<h3 id="观点类1">观点类1</h3>
<p>advantages &amp; disadvantages？<br />
Positive or negative development？</p>
<p>1.确定A后不能换<br />
2.主体部分两正一反/两反一正（支持的立场写前面）</p>
<p><img src="/images/IELTS/写作2.png" width="80%"></p>
<p>1.审题确定A/C<br />
2.想观点，列出每段论点路线<br />
3.开头段：改写题目 +
个人观点。注意不要直接抄题，不写模板，字数不要太多。<br />
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 改写题目</span></span><br><span class="line"><span class="number">1.</span>替换词</span><br><span class="line"><span class="number">2.</span>改词性</span><br><span class="line"><span class="number">3.</span>改结构</span><br><span class="line"><span class="number">4.</span>换表达，可以具体解释成某个抽象名词</span><br><span class="line"><span class="comment">## 改写结构的方法</span></span><br><span class="line"><span class="number">1.</span> 句子后半部分的信息移到前面去</span><br><span class="line"><span class="number">2.</span> there be + 名词 + 定语从句</span><br><span class="line"><span class="number">3.</span> it seems that..</span><br><span class="line"><span class="number">4.</span> it <span class="keyword">is</span> clear/obvious/believed/argued that</span><br><span class="line"><span class="number">5.</span> it <span class="keyword">is</span> <span class="keyword">not</span> unusual/uncommon..</span><br><span class="line"><span class="number">6.</span> it <span class="keyword">is</span> reasonable/important/necessary/appropriate..</span><br><span class="line"><span class="comment"># 个人观点</span></span><br><span class="line"><span class="number">1.</span>我认为好，although 有不好</span><br><span class="line"><span class="number">2.</span>不好，but 我认为好</span><br><span class="line"><span class="number">3.</span>While 不好，我认为好</span><br></pre></td></tr></table></figure></p>
<p>4.主体段：Topic sentence + 论述（3—4句）<br />
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 论述结构</span></span><br><span class="line">确定A:</span><br><span class="line"><span class="number">1.</span>解释A-B </span><br><span class="line"><span class="number">2.</span>解释B-C</span><br><span class="line"><span class="number">3.</span>说一下C的影响</span><br><span class="line">确定C/确定A+C：</span><br><span class="line"><span class="number">1.</span>解释A-B </span><br><span class="line"><span class="number">2.</span>B-C 注意：不要再拓展C</span><br><span class="line"></span><br><span class="line">注意：</span><br><span class="line"><span class="number">1.</span>当A和B没有跳跃或B-C没有跳跃，可以解释B为什么重要/B如何发生</span><br><span class="line"><span class="number">2.</span>A-B、B-C的解释想出两个，用两个</span><br><span class="line"><span class="number">3.</span>解释是最重要的，举例只是锦上添花</span><br><span class="line"></span><br><span class="line"><span class="comment"># 三种论述扩展方式</span></span><br><span class="line"><span class="number">1.</span>论证一个好处或坏处</span><br><span class="line">TS：明确的影响不能写的宽泛(C)—&gt; 原因分析(A-B)—&gt; 举例/对比/反向假设 —&gt; 扣回</span><br><span class="line">TS（重复改写或降层）</span><br><span class="line"><span class="number">2.</span>一个段落多分论点的展开(discussion/outweighs)</span><br><span class="line">信号词(some/several/two/three) 分论点<span class="number">1</span>-解释 分论点<span class="number">2</span>-解释</span><br><span class="line"><span class="number">3.</span>分析一个原因(report)</span><br><span class="line">TS：用事实/趋势作为原因-结果/举例-结果（回应题目主题）</span><br></pre></td></tr></table></figure></p>
<p><img src="/images/IELTS/写作3.png" width="80%"></p>
<p>5.写 Topic sentence<br />
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># Topic sentence</span></span><br><span class="line"><span class="number">1.</span>与题目紧密相关（与题目关键词一一对应）</span><br><span class="line"><span class="number">2.</span>写观点，不要写背景，ABC是观点（结构CAB或ACB）</span><br><span class="line"><span class="number">3.</span>TS和主体部分立场一致</span><br></pre></td></tr></table></figure></p>
<p>6.写结尾段<br />
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">1.</span>写立场（观点类和论述类）</span><br><span class="line"><span class="number">2.</span>总结观点（<span class="number">2</span>/<span class="number">3</span>个）</span><br><span class="line"></span><br><span class="line">注意：</span><br><span class="line"><span class="number">1.</span>结尾段不要出现新的信息</span><br><span class="line"><span class="number">2.</span>时间不够可以改写开头段第二句</span><br></pre></td></tr></table></figure></p>
<p>实际例子：<br />
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line">Nowadays more <span class="keyword">and</span> more jobs <span class="keyword">and</span> tasks are done by machines which involve hard physical work. </span><br><span class="line">Do these effects of this trend outweigh the negative effects?</span><br><span class="line"><span class="comment"># 两正一反</span></span><br><span class="line">A.机器代替人工 B.产出更高 C.有利于经济发展</span><br><span class="line">A.机器代替人工 B.减少人的工作量 C.人们生活更轻松</span><br><span class="line">A.机器代替人工 B.很多人失业 C.社会不稳定</span><br><span class="line"><span class="comment"># 改写题目：替换词</span></span><br><span class="line">nowadays： today, currently, over the past few decades, <span class="keyword">in</span> today‘s world, theses days, at present, <span class="keyword">in</span> modern times</span><br><span class="line">more <span class="keyword">and</span> more： an increasing number of</span><br><span class="line">jobs <span class="keyword">and</span> tasks： work <span class="keyword">and</span> duties</span><br><span class="line">done by machines：mechanized，automated，finished/completed by machines，mechanically</span><br><span class="line">Hard physical work： manual work，physically demanding work</span><br><span class="line"></span><br><span class="line">Machines are used today by a growing number of companies <span class="keyword">and</span> </span><br><span class="line">factories to complete some manual work which <span class="keyword">is</span> traditionally done by human worker.</span><br><span class="line"><span class="comment"># 个人观点</span></span><br><span class="line">I personally believe that it <span class="keyword">is</span> a positive development，although it has drawbacks.</span><br><span class="line"></span><br><span class="line"><span class="comment"># 观点拓展</span></span><br><span class="line">A.机器代替人工 B.产出更高 C.有利于经济发展</span><br><span class="line">解释(A-B): 可以不断工作，不用休息</span><br><span class="line">Machine can operate <span class="number">24</span>/<span class="number">7</span> without taking a <span class="keyword">break</span> <span class="keyword">and</span> committing errors.</span><br><span class="line">解释(B-C)：价格下降，有优势 (reduced the price, cut the price, gain advantages)</span><br><span class="line">Prices are reduced, <span class="keyword">and</span> companies gained advantages. This can improve output <span class="keyword">and</span> lead to a drop <span class="keyword">in</span> prices，</span><br><span class="line">thus giving business competitive advantages <span class="keyword">in</span> the market <span class="keyword">and</span> increasing revenue.</span><br><span class="line">解释(B-C): 速度更快，更快完成订单，销量高</span><br><span class="line">Meanwhile，machines can work faster <span class="keyword">and</span> fill orders quickly，this means that companies can attract more </span><br><span class="line">customers <span class="keyword">and</span> make profits，which can benefit the economy.</span><br><span class="line">A.机器代替人工 B.减少人的工作量 C.人们生活更轻松</span><br><span class="line">解释(A-B)</span><br><span class="line">解释(B-C)：准时下班，花时间休闲</span><br><span class="line">解释(C的拓展): 身体健康，不会因为长期的压力或不好的工作环境产生疾病</span><br><span class="line">A.机器代替人工 B.很多人失业 C.社会不稳定</span><br><span class="line">解释(A-B): 公司会裁员</span><br><span class="line">解释(B-C)：没有技术和文凭去做其他工作</span><br><span class="line">解释(B-C): 没有收入，没有生活保障，不满</span><br><span class="line"></span><br><span class="line"><span class="comment"># Topic sentence</span></span><br><span class="line">A.机器代替人工 B.产出更高 C.有利于经济发展</span><br><span class="line">TS：Mechanization can boost the economy because it can increase the productivity.（结构：ACB）</span><br></pre></td></tr></table></figure></p>
<p>作业：<br />
1.举办奥运会的好处<br />
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">A举办奥运会 B有利于国民关注和参与运动 C提升了民众健康水平</span><br><span class="line">A举办奥运会 B提升国内游客和消费量 C有利于国家经济发展</span><br><span class="line">A举办奥运会 B获得国际关注 C提升国家在国际上的知名度</span><br><span class="line">Holding the Olympics can boost the economy because it can increase consumption.（ACB）</span><br><span class="line">The Olympics will attract a large number of tourists <span class="keyword">and</span> spectators, </span><br><span class="line">which will result <span class="keyword">in</span> a significant increase <span class="keyword">in</span> consumption.（A-B）</span><br><span class="line">The large amount of consumption will promote the demand <span class="keyword">for</span> more products, </span><br><span class="line">which will promote the development of related industries <span class="keyword">and</span> thus the development of the country<span class="string">&#x27;s economy.（B-C）</span></span><br><span class="line"><span class="string">更具体：</span></span><br><span class="line"><span class="string">Holding the Olympics can boost the economy because it can attract numerous tourists all over the world </span></span><br><span class="line"><span class="string">to the host country. The Olympics is a world-class sport occasion, so people who are interested in sport </span></span><br><span class="line"><span class="string">could come to watch matches. It is inevitable for them to consume in a wide range of industries, such as accommodation </span></span><br><span class="line"><span class="string">and local food, and experience the local culture. Both of which would promote the growth of economy.</span></span><br></pre></td></tr></table></figure></p>
<p>2.早上学对孩子的好处<br />
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">A早上学 B能够更早地同龄人接触 C提高社交能力</span><br><span class="line">Going to school earlier could make children more sociable. This is because teenagers could get along with peers, </span><br><span class="line">so they would communicate with each other and complete a variety of teamwork, thus improving their social ability. </span><br><span class="line">This is unlikely to happen at home, because they are always the only child, </span><br><span class="line">or their sisters and brothers are older or younger.</span><br></pre></td></tr></table></figure></p>
<h3 id="观点类2">观点类2</h3>
<p>To what extent do you agree &amp; disagree？What is your
opinion？</p>
<p>1.有可能确定A或C，也可能A+C（区别优缺点类），确定A后不能换。<br />
2.完全支持/反对、部分支持/反对（对坏处设定条件/对象，sometimes/in some
cases/in some circumstances/may/be likely to/might）。<br />
3.The only/best折中回答。</p>
<p>常用结构：<br />
<img src="/images/IELTS/写作4.png" width="60%"></p>
<p>三种观点：<br />
1.完全同意：出现几率最低、极端限定词。<br />
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line">Some people have benefited <span class="keyword">from</span> modern communication technology, but some groups of people have <span class="keyword">not</span> benefited at <span class="built_in">all</span>. </span><br><span class="line">To what extent do you agree <span class="keyword">or</span> disagree?</span><br><span class="line"></span><br><span class="line"><span class="comment"># 范文</span></span><br><span class="line">The 21st century has seen a large number of changes that are beyond our wildest expectations. </span><br><span class="line">One of these advances <span class="keyword">is</span> the rapid development of communications technology. </span><br><span class="line">The advantages of convenience <span class="keyword">and</span> high efficiency brought by digital communication are obvious, </span><br><span class="line">but I do <span class="keyword">not</span> think that everyone has access to these benefits.</span><br><span class="line"></span><br><span class="line">Digital forms of communication enable many people, mainly including students, </span><br><span class="line">families <span class="keyword">as</span> well <span class="keyword">as</span> entrepreneurs, to reap the maximum benefits. </span><br><span class="line">From an educational perspective, learning can be incredibly efficient <span class="keyword">and</span> effective, </span><br><span class="line"><span class="keyword">as</span> students having the internet connection can virtually solve <span class="built_in">all</span> their puzzles </span><br><span class="line">by browsing teaching websites <span class="keyword">or</span> asking <span class="keyword">for</span> <span class="built_in">help</span> <span class="keyword">from</span> teachers simultaneously. </span><br><span class="line">Internet-based communication also contributes positively to strengthening family relationships </span><br><span class="line"><span class="keyword">and</span> increasing closeness between family members. </span><br><span class="line">For example, students who attend boarding schools <span class="keyword">or</span> study abroad are able to keep <span class="keyword">in</span> daily contact easily </span><br><span class="line"><span class="keyword">with</span> parents by sending greeting messages <span class="keyword">or</span> camera chatting. </span><br><span class="line">What <span class="keyword">is</span> more, companies can be run at a much lower cost because the internet <span class="keyword">and</span> computers <span class="built_in">help</span> to expand </span><br><span class="line">business cheaply <span class="keyword">and</span> because information technology allows employees to work at home, </span><br><span class="line">which saves most of the rents <span class="keyword">for</span> office space.</span><br><span class="line"></span><br><span class="line">In conclusion, I agree <span class="keyword">with</span> the idea that technological </span><br><span class="line">advances <span class="keyword">in</span> information <span class="keyword">and</span> communication have only </span><br><span class="line">brought benefits to a certain group of people, even </span><br><span class="line">though it <span class="keyword">is</span> a large group.</span><br></pre></td></tr></table></figure><br />
2.完全不同意：可能性高，怼人能力。<br />
反驳常见逻辑：这么做带来<strong>负面影响</strong>；这么做<strong>不公平</strong>；这么做<strong>不现实</strong>。<br />
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">1.</span>改写题目+个人观点（完全不赞同）</span><br><span class="line"><span class="number">2.</span>不赞同理由<span class="number">1</span></span><br><span class="line"><span class="number">3.</span>不赞同理由<span class="number">2</span></span><br><span class="line"><span class="number">4.</span>不赞同理由<span class="number">3</span></span><br><span class="line"><span class="number">5.</span>In conclusion，重复个人观点</span><br><span class="line"></span><br><span class="line">Some people believe that wild animals have no place <span class="keyword">in</span> the 21st century, </span><br><span class="line">so protecting them <span class="keyword">is</span> a waste of resources. To what extent do you agree <span class="keyword">or</span> disagree?</span><br><span class="line"></span><br><span class="line"><span class="comment"># 范文</span></span><br><span class="line">Some people argue that it <span class="keyword">is</span> pointless to spend money </span><br><span class="line">on the protection of wild animals because we humans </span><br><span class="line">have no need <span class="keyword">for</span> them. I completely disagree <span class="keyword">with</span> this </span><br><span class="line">point of view.</span><br><span class="line"></span><br><span class="line">In my opinion, it <span class="keyword">is</span> absurd to argue that wild animals have no </span><br><span class="line">place <span class="keyword">in</span> the 21st century. I do <span class="keyword">not</span> believe that planet Earth </span><br><span class="line">exists only <span class="keyword">for</span> the benefit of humans, <span class="keyword">and</span> there <span class="keyword">is</span> nothing </span><br><span class="line">special about this particular century that means that we </span><br><span class="line">suddenly have the right to allow <span class="keyword">or</span> encourage the extinction of </span><br><span class="line"><span class="built_in">any</span> species. Furthermore, there <span class="keyword">is</span> no compelling reason why we </span><br><span class="line">should let animals die out. We do <span class="keyword">not</span> need to exploit <span class="keyword">or</span> destroy </span><br><span class="line">every last square metre of land <span class="keyword">in</span> order to feed <span class="keyword">or</span> accommodate </span><br><span class="line">the worldʼs population. There <span class="keyword">is</span> plenty of room <span class="keyword">for</span> us to exist </span><br><span class="line">side by side <span class="keyword">with</span> wild animals, <span class="keyword">and</span> this should be our aim.</span><br><span class="line"></span><br><span class="line">I also disagree <span class="keyword">with</span> the idea that protecting animals <span class="keyword">is</span> a waste </span><br><span class="line">of resources. It <span class="keyword">is</span> usually the protection of natural habitats that </span><br><span class="line">ensures the survival of wild animals, <span class="keyword">and</span> most scientists agree </span><br><span class="line">that these habitats are also crucial <span class="keyword">for</span> human survival. For </span><br><span class="line">example, rainforests produce oxygen, absorb carbon dioxide <span class="keyword">and</span> </span><br><span class="line">stabilise the Earthʼs climate. If we destroyed these areas, the </span><br><span class="line">costs of managing the resulting changes to our planet would far </span><br><span class="line">outweigh the costs of conservation. By protecting wild animals </span><br><span class="line"><span class="keyword">and</span> their habitats, we maintain the natural balance of <span class="built_in">all</span> life on </span><br><span class="line">Earth.</span><br><span class="line"></span><br><span class="line">In conclusion, we have no right to decide whether <span class="keyword">or</span> <span class="keyword">not</span> </span><br><span class="line">wild animals should exist, <span class="keyword">and</span> I believe that we should </span><br><span class="line">do everything we can to protect them</span><br></pre></td></tr></table></figure></p>
<p>3.一分为二：部分同意，但又有明确的个人观点（虽然…但是）。<br />
1）部分对，部分错（题目中出现<strong>and</strong>连接两个部分）。<br />
2）题目笼统，我认为<strong>分人分情况</strong>（确保有明确标准）。<br />
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">Too much money <span class="keyword">is</span> spent looking after <span class="keyword">and</span> repairing old buildings. </span><br><span class="line">We should knock them down <span class="keyword">and</span> build modern ones instead. Do you</span><br><span class="line">agree <span class="keyword">or</span> disagree？  </span><br><span class="line"><span class="comment"># 取决于old buildings的艺术和历史价值</span></span><br><span class="line"></span><br><span class="line">政府应该花钱购买艺术品，让城市变成更好的生活的地方。Do you agree <span class="keyword">or</span> disagree？</span><br><span class="line"><span class="comment"># 取决于城市的发展水平（没有基础设施、缺教育医疗的城市VS发达城市 提高生活质量）</span></span><br><span class="line"></span><br><span class="line">有人认为政府应该限制电视/电影/游戏里面的暴力内容来减少犯罪。Do you agree <span class="keyword">or</span> disagree？</span><br><span class="line"><span class="comment"># 取决于观众/玩家的年纪（孩子—模仿犯罪行为 成人—区分现实和虚拟）</span></span><br></pre></td></tr></table></figure></p>
<h3 id="论述题">论述题</h3>
<p>Discuss both views and give your own opinion.<br />
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">1.</span>两个观点的AC可能不同，双边讨论合理性（立场与观点一致不能反驳）</span><br><span class="line"><span class="number">2.</span>个人观点</span><br><span class="line"></span><br><span class="line"><span class="comment"># 讨论部分</span></span><br><span class="line"><span class="number">1.</span>一个观点各一个主体段</span><br><span class="line"><span class="number">2.</span>两个主体段字数尽量平衡</span><br><span class="line"><span class="number">3.</span>主体段语气不要太肯定，因为这是分析别人的看法（could/might/be likely to..）</span><br><span class="line"><span class="number">4.</span>主体段只能使用第三人称（people，或具体人群）</span><br><span class="line"></span><br><span class="line"><span class="comment"># 个人观点</span></span><br><span class="line"><span class="number">90</span>%: 一弱一强 </span><br><span class="line"><span class="number">10</span>%: 共存</span><br><span class="line"><span class="number">1</span>%: 取决于（一个标准）</span><br></pre></td></tr></table></figure></p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 第一种：一弱一强 </span></span><br><span class="line">介绍段：背景介绍+个人倾向</span><br><span class="line">主体段：按照弱-&gt;强的顺序依次展开</span><br><span class="line">结尾段：结合主体段的扩展内容来强化强，弱化弱 </span><br><span class="line"></span><br><span class="line">开头段：一句话引出争论或者背景事实 + 预告个人观点</span><br><span class="line">Body <span class="number">1</span>：On the one hand, 弱观点(TS是现成的)</span><br><span class="line">Body <span class="number">2</span>：On the other hand, 强观点(TS是现成的)</span><br><span class="line">结尾：用强化强，弱化弱的方法，突出自己的偏向(短期-长远，少数-多数，偶尔-经常) </span><br><span class="line"></span><br><span class="line"><span class="comment"># 例子</span></span><br><span class="line">Some people believe famous people<span class="string">&#x27;s support towards international aid organizations draws the attention to problems, </span></span><br><span class="line"><span class="string">while others think celebrities make the problems seem less important. Discuss both views and give your opinion.</span></span><br><span class="line"><span class="string">A.名人做慈善 B.通过社交媒体扩大影响 C.让更多人关注慈善问题</span></span><br><span class="line"><span class="string">A.名人做慈善 B.名人的绯闻转移注意力 C.更关注明星本身</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string"># 开头段</span></span><br><span class="line"><span class="string">It is quite common that many celebrities, like movie stars and famous athletes, </span></span><br><span class="line"><span class="string">participate in activities held by international aid organizations. </span></span><br><span class="line"><span class="string">Opinions are divided on how their support affects these activities. </span></span><br><span class="line"><span class="string">I believe that famous people’s involvement in charitable events can definitely attract more attention </span></span><br><span class="line"><span class="string">and provide more help to the problems. </span></span><br><span class="line"><span class="string"># Body1</span></span><br><span class="line"><span class="string">On the one hand, there has been a concern that the importance of charitable activities may be weakened </span></span><br><span class="line"><span class="string">with the presence of many famous people. This is because fans of the movie stars or the NBA legends </span></span><br><span class="line"><span class="string">may pay more attention to how their idols dress themselves or whether they are in the center of the stage. </span></span><br><span class="line"><span class="string">What is worse, tabloids lead readers to the gossips or scandals of the celebrities instead of </span></span><br><span class="line"><span class="string">how much they contribute to helping people in need. This explains why many people worry that </span></span><br><span class="line"><span class="string">famous people may have a negative effect on the charitable activity they participate in. </span></span><br><span class="line"><span class="string"># Body2，例子需要清晰的因-&gt;果，不好想不建议写</span></span><br><span class="line"><span class="string">On  the other hand, advocates of celebrities&#x27;</span> support towards worldwide pressing issues believe that </span><br><span class="line">they have such significant influence on millions of people following their accounts on social media, </span><br><span class="line">such <span class="keyword">as</span> Twitter <span class="keyword">or</span> Facebook. When these famous people deliver a speech <span class="keyword">in</span> a fundraising gala <span class="keyword">or</span> </span><br><span class="line">make a donation to an organization towards assisting needy people <span class="keyword">in</span> third world countries, </span><br><span class="line">their followers may contribute their own effort to combating the same problems. For example, <span class="keyword">in</span> <span class="number">2015</span>, </span><br><span class="line">hundreds of sports stars <span class="keyword">and</span> Nobel Prize winners who took part <span class="keyword">in</span> a series of activities named </span><br><span class="line">the Ice Bucket Challenge successfully promoted awareness of the disease ALS <span class="keyword">and</span> encouraged donations to research. </span><br><span class="line"><span class="comment"># 结尾段</span></span><br><span class="line">Personally, my view <span class="keyword">is</span> that <span class="keyword">while</span> the attention of the public may be drawn <span class="keyword">from</span> </span><br><span class="line">the event itself to the stars they are interested <span class="keyword">in</span>, this usually lasts <span class="keyword">for</span> a short period of time. </span><br><span class="line">Support <span class="keyword">from</span> these famous people, <span class="keyword">in</span> the long term, will play a significant role <span class="keyword">in</span> </span><br><span class="line">arousing people<span class="string">&#x27;s awareness towards the issues that need to be addressed.</span></span><br></pre></td></tr></table></figure>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 第二种：共存</span></span><br><span class="line"><span class="number">1.</span> 用模板句来引出争论 或者从两个观点里找出共通的事实+个人观点</span><br><span class="line"><span class="number">2.</span> On the one hand, 核心段—展开A观点(现成的TS) </span><br><span class="line"><span class="number">3.</span> On the other hand, 核心段—展开B观点(现成的TS) </span><br><span class="line"><span class="number">4.</span> Personally, 先重复个人观点，强调两者各自的重要性.</span><br><span class="line"></span><br><span class="line"><span class="comment"># 背诵句子</span></span><br><span class="line"><span class="number">1.</span> I believe that rules <span class="keyword">and</span> freedom play equally important roles, so they should co-exist <span class="keyword">in</span> the growth of every child. </span><br><span class="line"><span class="number">2.</span> I believe that the joint effort of the government <span class="keyword">and</span> individuals <span class="keyword">is</span> the key to eradicating environmental problems. </span><br><span class="line"><span class="number">3.</span> I believe that a combination of skyscrapers <span class="keyword">and</span> low-rise buildings <span class="keyword">is</span> an ideal strategy of city planning. </span><br><span class="line"><span class="number">4.</span> I believe that both punishments <span class="keyword">and</span> other measures should be used together to make roads safer.</span><br><span class="line"></span><br><span class="line"><span class="comment"># 例子</span></span><br><span class="line">Some people think that strict punishments <span class="keyword">for</span> driving offences are the key to reducing traffic accidents. </span><br><span class="line">Others, however, believe that other measures would be more effective <span class="keyword">in</span> improving road safety. </span><br><span class="line">Discuss both these views <span class="keyword">and</span> give your own opinion.</span><br><span class="line"></span><br><span class="line"><span class="comment"># 开头段</span></span><br><span class="line">People have differing views <span class="keyword">with</span> regard to the question of how to make our roads safer. </span><br><span class="line">In my view, both punishments <span class="keyword">and</span> a <span class="built_in">range</span> of other measures can be used together to promote better driving habits. </span><br><span class="line"><span class="comment"># Body1</span></span><br><span class="line">On the one hand, strict punishments can certainly <span class="built_in">help</span> to encourage people to drive more safely. </span><br><span class="line">Penalties <span class="keyword">for</span> dangerous drivers can act <span class="keyword">as</span> a deterrent, meaning that people avoid repeating the same offence. </span><br><span class="line">There are various types of driving penalty, such <span class="keyword">as</span> small fines, licence suspension, driver awareness courses, </span><br><span class="line"><span class="keyword">and</span> even prison sentences. The aim of these punishments <span class="keyword">is</span> to show dangerous drivers that their actions </span><br><span class="line">have negative consequences. As a result, we would hope that drivers become more disciplined <span class="keyword">and</span> alert, </span><br><span class="line"><span class="keyword">and</span> that they follow the rules more carefully</span><br><span class="line"><span class="comment"># Body2</span></span><br><span class="line">On the other hand, (many people believe that) safe driving can be promoted <span class="keyword">in</span> several different ways that </span><br><span class="line">do <span class="keyword">not</span> punish drivers. Firstly, it <span class="keyword">is</span> vitally important to educate people properly before they start to drive, </span><br><span class="line"><span class="keyword">and</span> this could be done <span class="keyword">in</span> schools <span class="keyword">or</span> even <span class="keyword">as</span> part of an extended <span class="keyword">or</span> more difficult driving test. Secondly, </span><br><span class="line">more attention could be paid to safe road design. For example, signs can be used to warn people, speed bumps <span class="keyword">and</span> </span><br><span class="line">road bends can be added to calm traffic, <span class="keyword">and</span> speed cameras can <span class="built_in">help</span> to deter people <span class="keyword">from</span> driving too quickly. </span><br><span class="line">Finally, governments <span class="keyword">or</span> local councils could reduce road accidents by investing <span class="keyword">in</span> better public transport, </span><br><span class="line">which would mean that fewer people would need to travel by car.</span><br><span class="line"><span class="comment"># 结尾段</span></span><br><span class="line">In conclusion, <span class="keyword">while</span> punishments can <span class="built_in">help</span> to prevent bad driving, I believe that other road safety measures </span><br><span class="line">should also be introduced.</span><br></pre></td></tr></table></figure>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 第三种：取决于</span></span><br><span class="line"><span class="number">1.</span>改写题目+个人观点（给出明确的标准）</span><br><span class="line"><span class="number">2.</span>On the one hand, 核心段—展开A观点(现成的TS) </span><br><span class="line"><span class="number">3.</span>On the other hand, 核心段—展开B观点(现成的TS) </span><br><span class="line"><span class="number">4.</span>Personally, 先重复个人观点，再结合主体段的拓展分情况讨论</span><br><span class="line"></span><br><span class="line"><span class="comment"># 例子</span></span><br><span class="line">Completing university education <span class="keyword">is</span> thought by some to be the best way to get a good job. </span><br><span class="line">On the other hand, other people think that getting experience <span class="keyword">and</span> developing soft skills <span class="keyword">is</span> more important. </span><br><span class="line">Discuss both sides <span class="keyword">and</span> give your opinion.</span><br><span class="line"></span><br><span class="line"><span class="comment"># 开头段</span></span><br><span class="line">It <span class="keyword">is</span> considered by some that being a university graduate <span class="keyword">is</span> the key to securing a good job, </span><br><span class="line"><span class="keyword">while</span> there are others who think that it <span class="keyword">is</span> better to have experience <span class="keyword">and</span> soft skills. In my opinion, </span><br><span class="line">I believe that having university education <span class="keyword">is</span> essential <span class="keyword">for</span> academic jobs <span class="keyword">while</span> soft skills <span class="keyword">and</span> </span><br><span class="line">experience are more useful <span class="keyword">in</span> business.</span><br><span class="line"><span class="comment"># Body1</span></span><br><span class="line">On the one hand, many think it <span class="keyword">is</span> easier <span class="keyword">for</span> most people to find a good job <span class="keyword">if</span> they are university graduates <span class="keyword">with</span> </span><br><span class="line">a good degree. In other words, having tertiary education puts people one step ahead of others who do <span class="keyword">not</span> <span class="keyword">and</span> </span><br><span class="line">this can be the deciding factor <span class="keyword">in</span> getting a good job. The competition to get <span class="keyword">in</span> to universities <span class="keyword">and</span> </span><br><span class="line">the increasing number of graduates show just how significant this level of education <span class="keyword">is</span> </span><br><span class="line"><span class="keyword">for</span> people<span class="string">&#x27;s future work opportunities.</span></span><br><span class="line"><span class="string"># Body2</span></span><br><span class="line"><span class="string">On the other hand, having work experience and soft skills, such as leadership skills and other interpersonal skills, </span></span><br><span class="line"><span class="string">can also throw the balance in favour of the applicant, according to some. For many positions there are an </span></span><br><span class="line"><span class="string">overwhelming number of applicants and, therefore, it is often thought that having relevant experience in that </span></span><br><span class="line"><span class="string">line of work or having acquired useful soft skills that can be valuable to a company, can put one ahead of the game </span></span><br><span class="line"><span class="string">when applying for a position.</span></span><br><span class="line"><span class="string"># 个人观点</span></span><br><span class="line"><span class="string">Finally, in my opinion, whether needing high level education or skills and experience, depends on the </span></span><br><span class="line"><span class="string">position being applied for. Take for example law, medicine or teaching, it is impossible to be considered </span></span><br><span class="line"><span class="string">for a position without the required educational background. In contrast, in business, it would be more important </span></span><br><span class="line"><span class="string">for a candidate to have soft skills and experience in that line of business so they can step into a position </span></span><br><span class="line"><span class="string">without further training and be of immediate benefit to the company.</span></span><br><span class="line"><span class="string"># 结尾段</span></span><br><span class="line"><span class="string">In conclusion, getting a good job requires a relevant background either in experience or education depending on </span></span><br><span class="line"><span class="string">the type of work and field. People should make sure they attain the necessary skills or degrees before applying </span></span><br><span class="line"><span class="string">for a job in order to be sure of success.</span></span><br></pre></td></tr></table></figure>
<h3 id="报告类">报告类</h3>
<p>Why has it happened？How to solve it？<br />
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">原因分析+解决方案</span><br><span class="line">原因分析+影响</span><br><span class="line">原因分析+随机</span><br><span class="line">造成的问题+解决方式（特别注意）</span><br><span class="line"></span><br><span class="line"><span class="comment"># causes两个易错点: </span></span><br><span class="line"><span class="number">1.</span>What do you think are the causes?   名词(原因)，问原因</span><br><span class="line"><span class="number">2.</span>What problems does it cause?   动词(引起)，问影响</span><br></pre></td></tr></table></figure></p>
<p>文章结构：<br />
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">开头段：改写原题+预告(详细/笼统)</span><br><span class="line">Body <span class="number">1</span>,<span class="number">2</span>：原因<span class="number">1</span>,<span class="number">2</span></span><br><span class="line">Body <span class="number">3</span>：解决方法(<span class="number">2</span>个)，切实可行，避免罗列方法，要进行解释</span><br><span class="line">结尾段: 原因或解决方法各一段/其中一个问题两段（总结主要内容）</span><br><span class="line"></span><br><span class="line"><span class="comment"># 注意事项</span></span><br><span class="line">题目中有today/research shows that/people know that...不要写提高意识</span><br><span class="line">positive/negative：可以一边倒</span><br><span class="line"></span><br><span class="line">原因：</span><br><span class="line">原因TS：大部分人承认的事实，考虑因素：互联网/物价上涨/科技发展/广告影响/出生率下降/女性地位提高/全球化</span><br><span class="line"><span class="number">1.</span>不能局限（中国）</span><br><span class="line"><span class="number">2.</span>客观（有证据，摆事实）</span><br><span class="line"><span class="number">3.</span>如果有比较级，通过年代对比找到原因</span><br></pre></td></tr></table></figure></p>
<p>思考方向：<br />
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">1.政府职能---至关重要(收税/花钱/颁布法律);</span><br><span class="line">    1. The government could impose higher taxes on...so that...</span><br><span class="line">    2. What the government should do is to invest in.../financially support.../spend money doing... </span><br><span class="line">    3. The government ought to require...to... </span><br><span class="line">2. 家长</span><br><span class="line">3. 学校</span><br><span class="line">4. 公司</span><br><span class="line">5. authorities</span><br></pre></td></tr></table></figure></p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 例1</span></span><br><span class="line">Many people believe that today there <span class="keyword">is</span> a general increase <span class="keyword">in</span> anti-social behaviour <span class="keyword">and</span> lack of respect <span class="keyword">for</span> others. </span><br><span class="line">What might have caused this situation? How to improve it?</span><br><span class="line"></span><br><span class="line">A. spoil children/indulgent parenting. </span><br><span class="line">B. unaware of boundaries of behaviour </span><br><span class="line"></span><br><span class="line">A. exposed to unwanted information <span class="keyword">in</span> the media. </span><br><span class="line">B. copy behaviour</span><br><span class="line"></span><br><span class="line">A. government action.</span><br><span class="line">B. tighten the regulations on the media/regulate the media, promote good parenting skills </span><br><span class="line">C. 人们知道尊重和友好</span><br><span class="line"></span><br><span class="line"><span class="comment"># 例2</span></span><br><span class="line">As economy develops, people get richer. Studies show that people <span class="keyword">in</span> developing countries </span><br><span class="line">feel happier than before, <span class="keyword">while</span> people <span class="keyword">in</span> developed countries feel less happy. </span><br><span class="line">Why do you think <span class="keyword">is</span> it? What lessons can we learn <span class="keyword">from</span> it?</span><br><span class="line"></span><br><span class="line">A. differences <span class="keyword">in</span> expectations </span><br><span class="line">B. 发展中国家在意basic quality of life，略有改善就meet expectations，而发达国家have more demands </span><br><span class="line"></span><br><span class="line">A. 调整自己的观念和期望adjust expectations/change mindset </span><br><span class="line">B. <span class="built_in">set</span> realistic/attainable objectives </span><br><span class="line">C. 更容易快乐</span><br><span class="line"></span><br><span class="line"><span class="comment"># 例3</span></span><br><span class="line">In some societies, the role of a mother differs <span class="keyword">in</span> some ways <span class="keyword">from</span> the role of a father. </span><br><span class="line">Why do you think these differences exist? How might parental roles develop <span class="keyword">in</span> the future ?</span><br><span class="line"></span><br><span class="line">A.biological factors </span><br><span class="line">B.involved <span class="keyword">in</span> child-rearing tasks </span><br><span class="line">C.角色不同</span><br><span class="line"></span><br><span class="line">A.face discrimination <span class="keyword">in</span> the workplace </span><br><span class="line">B.a glass ceiling </span><br><span class="line">C.所以丈夫是主要的breadwinner</span><br><span class="line"></span><br><span class="line">A.社会思想进步 </span><br><span class="line">B.男女地位趋于平等 </span><br><span class="line">C.男性女性角色差不多</span><br></pre></td></tr></table></figure>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 范文1</span></span><br><span class="line">Fewer <span class="keyword">and</span> fewer people choose to ride bicycles when going outside. </span><br><span class="line">What do you think are the causes? </span><br><span class="line">What can be done to encourage people to cycle? </span><br><span class="line"></span><br><span class="line"></span><br><span class="line">Owning a bicycle <span class="keyword">and</span> using it frequently seems to be much less popular today. </span><br><span class="line">I believe that the growth <span class="keyword">in</span> the size of cities <span class="keyword">and</span> the advanced modern transport system </span><br><span class="line">are the main reasons <span class="keyword">for</span> this.（具体原因预告） The government should take steps to change this situation. </span><br><span class="line"></span><br><span class="line">The first reason why riding bicycles <span class="keyword">is</span> no longer popular <span class="keyword">is</span> that cities have been growing bigger. </span><br><span class="line">This means that the distance between home <span class="keyword">and</span> destinations has become much farther. </span><br><span class="line">If people keep the habit of cycling, then they will find it really time-consuming <span class="keyword">and</span> energy-consuming. </span><br><span class="line">When they <span class="keyword">finally</span> get to the school <span class="keyword">or</span> office, they will probably feel exhausted </span><br><span class="line"><span class="keyword">and</span> can hardly concentrate on their work <span class="keyword">or</span> study. </span><br><span class="line"></span><br><span class="line">Another cause <span class="keyword">is</span> that a greater variety of means of transport are available to daily commuters today. </span><br><span class="line">In the past, riding a bicycle was the main choice <span class="keyword">for</span> many people to go to work <span class="keyword">or</span> <span class="keyword">for</span> fun. </span><br><span class="line">Today, however, people living <span class="keyword">in</span> cities <span class="keyword">and</span> towns can have a wider <span class="built_in">range</span> of choices, including more bus lines, </span><br><span class="line">taxies <span class="keyword">and</span> even the Uber service. <span class="type">Any</span> of these <span class="keyword">is</span> more efficient <span class="keyword">and</span> comfortable than cycling <span class="keyword">and</span> </span><br><span class="line">therefore this traditional way of transport has been losing popularity. </span><br><span class="line"></span><br><span class="line">It <span class="keyword">is</span> undeniable that riding a bike <span class="keyword">is</span> beneficial <span class="keyword">for</span> both the individual <span class="keyword">and</span> society, </span><br><span class="line">so measures should be taken to entice <span class="keyword">and</span> encourage people to be more active <span class="keyword">in</span> this choice. </span><br><span class="line">Firstly, the government could build special lanes <span class="keyword">for</span> cyclists, so that they can ride safely <span class="keyword">and</span> quickly. </span><br><span class="line">In addition, monetary rewards should be provided to people who ride their bicycles more often.</span><br><span class="line">In this way, more people would have the incentive to use this old-fashioned way to commute. </span><br><span class="line"></span><br><span class="line">In conclusion, the development of modern cities has led to a decreasing number of people traveling by bicycle. </span><br><span class="line">I believe that measures mentioned above could effectively reverse this situation. </span><br></pre></td></tr></table></figure>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 范文2</span></span><br><span class="line">A lot of young people do <span class="keyword">not</span> know how to manage their money when graduating <span class="keyword">from</span> high school. </span><br><span class="line">What do you think are the reasons? What can be done to teach them this important skill?</span><br><span class="line">A.高中毕业不知道如何管理自己的金钱 B.缺乏金融教育</span><br><span class="line">A.高中毕业不知道如何管理自己的金钱 B.缺乏生活经验</span><br><span class="line"></span><br><span class="line">Fewer <span class="keyword">and</span> fewer young people today have experience <span class="keyword">in</span> managing money when graduating <span class="keyword">from</span> high school.</span><br><span class="line">I believe that a lack of life experience <span class="keyword">and</span> school education are the main reasons <span class="keyword">for</span> this.</span><br><span class="line">The school <span class="keyword">and</span> parents should take steps to change this situation. </span><br><span class="line"></span><br><span class="line">The first reason why young people do <span class="keyword">not</span> know how to manage their money when they leave school <span class="keyword">is</span> a lack of life experience. </span><br><span class="line">High school graduates often have <span class="keyword">not</span> experienced the pressure of independent living <span class="keyword">and</span> financial decision-making, </span><br><span class="line"><span class="keyword">and</span> they may <span class="keyword">not</span> realize the importance of money management, which can lead them to fall into a consumption trap </span><br><span class="line"><span class="keyword">and</span> consume ahead of schedule.</span><br><span class="line"></span><br><span class="line">Another cause <span class="keyword">is</span> that a lack of financial education <span class="keyword">in</span> schools.there <span class="keyword">is</span> usually no systematic teaching of </span><br><span class="line">personal financial management skills, <span class="keyword">and</span> students<span class="string">&#x27; main focus is on academic courses and exams. </span></span><br><span class="line"><span class="string">Therefore, they may not have been exposed to the basic concepts and techniques of financial management.</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">It is undeniable that the skill of managing one&#x27;</span>s own <span class="built_in">property</span> <span class="keyword">is</span> becoming increasingly important, especially among young people.</span><br><span class="line">There are two suggestions. Firstly, schools should offer some basic courses <span class="keyword">in</span> financial management to enable students </span><br><span class="line">to learn this knowledge <span class="keyword">in</span> advance. Secondly, parents can encourage their children to participate <span class="keyword">in</span> </span><br><span class="line">small tasks related to family <span class="built_in">property</span> management <span class="keyword">in</span> advance to exercise their money management skills.</span><br><span class="line">In this way, young people will have sufficient knowledge <span class="keyword">and</span> experience to manage their own money <span class="keyword">in</span> the future.</span><br><span class="line"></span><br><span class="line">In conclusion, young people today have a lack of money management skills - schools <span class="keyword">and</span> parents have a responsibility.</span><br><span class="line">Schools <span class="keyword">and</span> parents need to work together to solve this problem so that students graduate <span class="keyword">with</span> money management skills.</span><br></pre></td></tr></table></figure>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="https://soundmemories.github.io/2022/07/16/IELTS/01.%E9%98%85%E8%AF%BB/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avstar.png">
      <meta itemprop="name" content="SoundMemories">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="SoundMemories">
      <meta itemprop="description" content="今日事，今日毕">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | SoundMemories">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2022/07/16/IELTS/01.%E9%98%85%E8%AF%BB/" class="post-title-link" itemprop="url">阅读</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>

      <time title="创建时间：2022-07-16 00:00:00" itemprop="dateCreated datePublished" datetime="2022-07-16T00:00:00+08:00">2022-07-16</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">分类于</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/IELTS/" itemprop="url" rel="index"><span itemprop="name">IELTS</span></a>
        </span>
    </span>

  
    <span class="post-meta-break"></span>
    <span class="post-meta-item" title="本文字数">
      <span class="post-meta-item-icon">
        <i class="far fa-file-word"></i>
      </span>
      <span class="post-meta-item-text">本文字数：</span>
      <span>3.8k</span>
    </span>
    <span class="post-meta-item" title="阅读时长">
      <span class="post-meta-item-icon">
        <i class="far fa-clock"></i>
      </span>
      <span class="post-meta-item-text">阅读时长 &asymp;</span>
      <span>14 分钟</span>
    </span>
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <h2 id="考试介绍">考试介绍</h2>
<p>考试时间：3个月<br />
阅读时间：60min<br />
阅读题：3篇文章<br />
阅读每篇字数：800/1000<br />
阅读题数：40（13+13+14）<br />
阅读目标：7分，允许错8-10道题。<br />
准备：单词（538+剑雅真题14-17），雅思的本质是同意替换。</p>
<p>3篇文章：<br />
P1：考察快速阅读-抓取信息的能力：填空题+判断题，15min。<br />
P2：考察有目的阅读的能力：配对题（四种），20min。<br />
P3：考察对文章的深度理解：选择题（单选or多选） 25min。</p>
<p>难度等级：<br />
L1：填空（summary填空除外）+ 判断<br />
L2：句子结尾匹配+人物观点匹配+信息匹配+多选<br />
L3：标题匹配+单选</p>
<p>主要题型：<br />
<img src="/images/IELTS/阅读题型.png" width="80%"></p>
<p>进考场：<br />
1：先打开卷子，查看3篇题型组合。<br />
2：阅读一篇文章时，先看题，再读文章。<br />
3：看题型、看标题-&gt;审题定位-&gt;扫读原文找定位-&gt;定位句出答案。</p>
<h2 id="主要技巧">主要技巧</h2>
<h3 id="定位-划关键词">定位-划关键词</h3>
<p><strong>ABC多点定位法</strong>：通过<strong>多组关键词</strong>确定问题和答案。A和B级的级别最高，同转最少，28%几率在题干中出现；C级原词出现几率最小，同转最多，82%几率在题干中出现。</p>
<p>做题时，每道题目至少划出<strong>两组</strong>关键词进行<strong>多点组合定位</strong>，只有个别简单题目可以但一定位。</p>
<p>现在6分以下的考生，建议采取A+C或B+C搭配。<br />
6分到7分考生，建议采取A+C+C或B+C+C搭配。</p>
<p><strong>A级（特殊词）：专有名词、数字、时间、特殊符号和字体、卖相奇怪吸引的眼球词（ichthyosaur,
shinbashira, xylophone）</strong>。<br />
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 数字时间的特例</span></span><br><span class="line"><span class="number">50</span>%=half</span><br><span class="line"><span class="number">12</span>=dozen   <span class="number">24</span>=two dozens</span><br><span class="line"><span class="number">10</span> years=decade     <span class="number">20</span> years=two decades     <span class="number">50</span> years=five decades</span><br><span class="line"><span class="number">100</span> years=a century    <span class="number">1000</span> years=millennium 千禧年</span><br></pre></td></tr></table></figure></p>
<p>例1：The _____ of London increased rapidly <span
id="inline-purple">between 1800 and 1850</span>.<br />
例2：In <span id="inline-purple">1911</span>, Marie Curie received
recongnition for her work on the emement _____.<br />
例3：<span id="inline-purple">Marie and Irene</span> Curie develpoed
<span id="inline-purple">X-radiography</span> which was used as a
medical technique for _____.</p>
<p><strong>B级（具体且唯一词）：一般为名词/名词短语、形容词、副词、动词（大概率被同义替换）</strong>。<br />
例1：reference to what can be <span id="inline-purple">lost</span> if
<span id="inline-purple">learns</span> are given <span
id="inline-purple">too much guidance</span>.<br />
例2：Children of <span id="inline-purple">average ability</span> seem to
need more <span id="inline-purple">direction</span> from teachers
because they <span id="inline-purple">do not</span> have _____.</p>
<p><strong>C级（逻辑词）：因果关系、并列关系、比较关系...；否定，双否</strong>。<br />
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">|-后跟原因                           |-后跟结果</span><br><span class="line">  |-<span class="keyword">as</span>                              |-<span class="keyword">as</span> a result/consequence</span><br><span class="line">  |-<span class="keyword">as</span> a result of                  |-so/therefore/thus/thereby/hence</span><br><span class="line">  |-<span class="keyword">as</span> a consequence of             |-cause/trigger/stimulate/engender/pose/arouse/prompt/breed/affect</span><br><span class="line">  |-result/arise/derive/stem <span class="keyword">from</span>     |-lead to/result <span class="keyword">in</span>/give rise to/contribute to</span><br><span class="line">  |-be responsible <span class="keyword">for</span>              |-amount to</span><br><span class="line">  |-be brought about by             |-bring about</span><br><span class="line">  |-on account of</span><br><span class="line">  |-because of</span><br><span class="line">  |-due/owing/attribute to</span><br><span class="line">  |-thanks to</span><br><span class="line">  |-since</span><br></pre></td></tr></table></figure><br />
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">|-并列关系</span><br><span class="line">  |-And</span><br><span class="line">  |-<span class="keyword">as</span> well <span class="keyword">as</span></span><br><span class="line">  |-also</span><br><span class="line">  |-<span class="keyword">in</span> addition (to)</span><br><span class="line">  |-besides</span><br><span class="line">  |-other than</span><br><span class="line">  |-apart <span class="keyword">from</span></span><br><span class="line">  |-along <span class="keyword">with</span></span><br><span class="line">  |-coupled <span class="keyword">with</span></span><br><span class="line">  |-accompanying</span><br><span class="line">  |-<span class="keyword">not</span> only...but also...</span><br><span class="line">  |-together</span><br></pre></td></tr></table></figure><br />
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">|-表对比</span><br><span class="line">  |-by contrast</span><br><span class="line">  |-conversely</span><br><span class="line">  |-whereas</span><br><span class="line">  |-<span class="keyword">while</span>/whilst</span><br><span class="line">|-表转折</span><br><span class="line">  |-but</span><br><span class="line">  |-however</span><br><span class="line">  |-yet</span><br><span class="line">  |-nevertheless</span><br><span class="line">  |-nonetheless</span><br><span class="line">|-表让步</span><br><span class="line">  |-although</span><br><span class="line">  |-though</span><br><span class="line">  |-even <span class="keyword">if</span></span><br><span class="line">  |-even though</span><br><span class="line">  |-despite</span><br><span class="line">  |-<span class="keyword">in</span> spite of</span><br><span class="line">  |-notwithstanding</span><br><span class="line"><span class="comment"># 最高级和比较级分清</span></span><br></pre></td></tr></table></figure></p>
<p>例1：During migration, animals are <span
id="inline-purple">unlikely</span> to..</p>
<p>哪些词<strong>不能</strong>做为定位词？</p>
<ul>
<li>过于<strong>简单</strong>的名词不合适：people, humans, children,
students, schools..</li>
<li>过于<strong>宽泛抽象</strong>的名词不合适：reference, explanation,
examples, account, description, statement..</li>
<li>相邻题目<strong>反复出现</strong>的，原文标题中有的主题词都不可以。</li>
</ul>
<h3 id="同替-三级同转">同替-三级同转</h3>
<p>同义词替换，可能是词和词，也可能是词和句子的同意替换，40%都是此类。</p>
<p><strong>一级同转：简单换词/词组，词性大意字数都一样</strong>。<br />
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">massive &lt;–&gt; large</span><br><span class="line">speed       rate</span><br><span class="line">rely on     depend on </span><br><span class="line">increase    accelerate</span><br><span class="line">emit        trigger</span><br><span class="line">stimulate   trigger</span><br><span class="line">depend on   according to</span><br><span class="line">disease     according to</span><br></pre></td></tr></table></figure></p>
<p><strong>二级同转：解释转述总结，换个说法，大意一致</strong>。<br />
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">well <span class="built_in">set</span> out      well organised <span class="keyword">and</span> logically developed</span><br><span class="line">bicycle friendly  high level of bicycle usage</span><br><span class="line">easily            without difficulty</span><br></pre></td></tr></table></figure></p>
<p>例1：a phantom <span id="inline-purple">limb</span> = a _____ <span
id="inline-purple">arm and leg</span></p>
<p><strong>三级同转：抽象到具体，宽泛概念-&gt;具体例子</strong>。<br />
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">air pollution   CO2 emission(具体)</span><br><span class="line">chemical        fertilizer(具体)</span><br><span class="line">produce         meat(具体)</span><br><span class="line">substance       chemical(具体)</span><br><span class="line">paramount       necessary</span><br><span class="line">be based on     underlie</span><br><span class="line">independent of  separate <span class="keyword">from</span></span><br><span class="line">air pollution   carbon dioxide</span><br><span class="line">harness         utilise</span><br><span class="line">prosperity      successful</span><br></pre></td></tr></table></figure></p>
<h3 id="顺序-找定位词">顺序-找定位词</h3>
<p>有些题型，题目答案在原文中，一定是在上一个题目答案所在原文的后面，这种是顺序题型。<br />
顺序题型有：填空、判断、选择、句子搭配。<br />
乱序题型有：分类匹配、人名观点匹配。</p>
<h2 id="填空题">填空题</h2>
<p>分类：Summary、Sentence completion/notes、Graph/diagram、Table、Flow
chart、Short answer questions。</p>
<p>填空题特点：<br />
- <strong>1.原词：不需要任何改变</strong>。<br />
- <strong>2.顺序题型：下一题答案永远在前一题答案后面</strong>。<br />
- <strong>3.偶尔乱序题型：summary、graph/diagram、table</strong>。<br />
-
<strong>4.除有选项Summary外，都有字数要求，超字相当没做，至少一道题达到字数要求上限</strong>。</p>
<p>技巧：3+4+3。</p>
<h3 id="大考点">3大考点</h3>
<p><strong>1.并列：A and B，词性相同、性质相同</strong>。<br />
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line">|-And</span><br><span class="line">|-<span class="keyword">as</span> well <span class="keyword">as</span></span><br><span class="line">|-also</span><br><span class="line">|-<span class="keyword">in</span> addition (to)</span><br><span class="line">|-besides</span><br><span class="line">|-other than</span><br><span class="line">|-apart <span class="keyword">from</span></span><br><span class="line">|-along <span class="keyword">with</span></span><br><span class="line">|-coupled <span class="keyword">with</span></span><br><span class="line">|-accompanying</span><br><span class="line">|-<span class="keyword">not</span> only...but also...</span><br><span class="line">|-together</span><br><span class="line"><span class="comment"># 新增</span></span><br><span class="line">one...another</span><br><span class="line">either...<span class="keyword">or</span></span><br><span class="line">both...<span class="keyword">and</span></span><br><span class="line">too</span><br><span class="line">first</span><br><span class="line">second</span><br><span class="line"><span class="built_in">range</span> <span class="keyword">from</span>... to...</span><br><span class="line"><span class="comment"># 特殊并列(A, B是从属关系)</span></span><br><span class="line">A <span class="keyword">and</span> other B</span><br><span class="line">=B including A</span><br><span class="line">=B such <span class="keyword">as</span> A</span><br><span class="line">小明喜欢吃草莓和很多其他的水果</span><br><span class="line">=小明喜欢吃很多水果包括草莓</span><br><span class="line">=小明喜欢吃很多水果比如草莓</span><br></pre></td></tr></table></figure></p>
<p><strong>2.否定：否定前缀、否定后缀、否定词组</strong>。<br />
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 否定前缀</span></span><br><span class="line">un-</span><br><span class="line">dis-</span><br><span class="line"><span class="comment"># 否定后缀</span></span><br><span class="line">-less</span><br><span class="line"><span class="comment"># 否定词/词组</span></span><br><span class="line">lack</span><br><span class="line">scarce</span><br><span class="line">without</span><br><span class="line">impossible</span><br><span class="line">fail to</span><br><span class="line">out of</span><br><span class="line">far <span class="keyword">from</span></span><br><span class="line">too...to..</span><br><span class="line">rather than 而不是  </span><br><span class="line">instead of  而不是</span><br><span class="line"><span class="comment"># 注意区别</span></span><br><span class="line">rather  而是</span><br><span class="line">instead 而是</span><br></pre></td></tr></table></figure></p>
<p><strong>3.下定义：对特殊/专有名词的定义和解释</strong>。<br />
<strong>破折号、引号：同位语（n1，n2，后面的名词/名词短语对前面的名词进行解释说明，调换位置意思仍然不发生改变）</strong>。<br />
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">be known <span class="keyword">as</span></span><br><span class="line">be called</span><br><span class="line">defined</span><br><span class="line">referred to <span class="keyword">as</span>...</span><br><span class="line">name/term</span><br><span class="line">coin/first use</span><br><span class="line"><span class="comment"># 例子</span></span><br><span class="line">Beijing <span class="keyword">is</span> known <span class="keyword">as</span> the capital of China.</span><br><span class="line">Beijing — the capital of China，xxxx.</span><br><span class="line">Beijing，the capital of China，xxxx.</span><br></pre></td></tr></table></figure></p>
<h3 id="个步骤">4个步骤</h3>
<p>首先，按顺序优先好定位，答案为原词，最后确定字数。扫读大小标题，圈字数。<br />
<strong>1.认真读题，找定位：空格前后</strong>。<br />
<strong>2.同时判断空格处：词性单复数+修饰关系+3大考点</strong>。<br />
<strong>3.读完定位句，划掉题干在原文中的同替</strong>。<br />
<strong>4.出答案：空格前后、答案就近/词性排除法</strong>。</p>
<h3 id="个注意">3个注意</h3>
<p><strong>1.词性、单复数</strong><br />
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 词性</span></span><br><span class="line">be (adj) enough</span><br><span class="line">be used (adv)</span><br><span class="line">feel/stay/remain (adj)</span><br><span class="line">can (v)</span><br></pre></td></tr></table></figure></p>
<p><strong>2.空格前：单复数(主谓一致)</strong><br />
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">a/an/one + (单数可数名词)</span><br><span class="line">an amount of + (不可数名词)</span><br><span class="line">some/many/several + (可数名词复数)</span><br><span class="line">a number of + (可数名词复数)</span><br></pre></td></tr></table></figure></p>
<p><strong>3.空格后：词性、四种修饰关系(现在分词、过去分词、定语从句、介词短语)</strong><br />
<strong>有修饰找修饰，比如现在和过去分词，一般问题中此类修饰是在原文答案(空格)前，即题目A(B)对应原文(B)A，B为修饰，A为答案</strong>。<br />
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">(人), who..</span><br><span class="line">(地点), where..</span><br></pre></td></tr></table></figure></p>
<p>例1：4000BC: _____ <span id="inline-purple">made of stone</span> were
covered in a coating of man-made glass. between 1800 and 1850.<br />
案1：this took the form of glazes used for coating <span
id="inline-purple">stone</span> beads.</p>
<p>作业1：完成C16所有填空题（除了summary填空）-总结错题文档
复盘考点。</p>
<h3 id="摘要填空">摘要填空</h3>
<p>summary类型的填空。</p>
<p><strong>1.看题型位置：结合小标题和首题定位词，确定整体定位</strong>。<br />
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">如果summary为首题，那么从第一段开始定位.</span><br><span class="line">如果summary非首题，那么从第三段开始定位.</span><br><span class="line">特例：heading+summary题，summary 题仍算首题，那么从第一段开始找.</span><br></pre></td></tr></table></figure></p>
<p><strong>2.认真读题画定位</strong>：<br />
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">尤其, 空格前后 + 空格分析3+4+3 + 重点看逻辑 + 指代</span><br><span class="line">逻辑不变  but—however</span><br></pre></td></tr></table></figure></p>
<p><strong>3.出答案：重点根据空格前后：不认识单词——词性排除法/标注法</strong>。</p>
<h2 id="判断题">判断题</h2>
<p>科普文：T、F、NG。<br />
议论文：Y、N、NG。<br />
议论文比较难，在第三篇阅读。</p>
<p>作业2：刷完C16判断题+总结错题，复盘考点。</p>
<h3 id="ty">T/Y</h3>
<p><strong>1.题干对原文的同替改写</strong>。<br />
<strong>2.不同段落信息归纳总结</strong>。</p>
<h3 id="fn">F/N</h3>
<p><strong>1.考点在文中出现矛盾点/反义词</strong>。<br />
<strong>2.事实/关系相驳斥</strong>。<br />
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">原文：小明迟到是因为路上堵车 </span><br><span class="line">选项：小明迟到是因为起来晚了-F</span><br></pre></td></tr></table></figure></p>
<h3 id="ng">NG</h3>
<p><strong>1.定位词未提及</strong>。<br />
<strong>2.有定位，考点未提及</strong>。<br />
<strong>3.题干是原文的一种可能性</strong>。<br />
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">原文：小明今晚去外地出差</span><br><span class="line">选项：小明今晚去广州出差—NG</span><br><span class="line"></span><br><span class="line">原文：小明今晚去上海出差</span><br><span class="line">选项：小明今晚去广州出差—F</span><br></pre></td></tr></table></figure></p>
<p><strong>如何区分NG和F</strong>：<strong>判断题目和原文两件事能不能同时发生，能-NG；不能-F</strong>。</p>
<p><strong>做题策略：</strong><br />
<strong>1.关键词定位，highlight。</strong><br />
<strong>2.分析考点，一句话里面最重要最核心的信息。</strong><br />
<strong>3.根据原则判断。</strong></p>
<p><strong>判断题四大考点：</strong><br />
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#逻辑关系</span></span><br><span class="line">|-比较、最高: ..than, <span class="keyword">as</span>...<span class="keyword">as</span>, the same <span class="keyword">as</span> </span><br><span class="line">  |-比较对象 都要有</span><br><span class="line">  |-比较关系 好像还是一样？</span><br><span class="line">  |-比较内容 一致不一致？</span><br><span class="line">|-因果</span><br><span class="line">  |-结果相同，原因相同 T</span><br><span class="line">  |-结果相同，原因不相同  F</span><br><span class="line">  原因决定T/F，定位先找结果</span><br><span class="line">  因果关系的逻辑链一定要短短短！</span><br><span class="line">  <span class="comment">#森林的破坏是由于水稻，水稻的破坏是由于昆虫</span></span><br><span class="line">  <span class="comment">#昆虫-水稻-森林，不能说，森林破坏是由于昆虫</span></span><br><span class="line">|-否定: few/little,hardly</span><br><span class="line">|-绝对词: <span class="built_in">all</span>,only</span><br><span class="line">|-数字: 数字对应和含义是否和原文一致</span><br><span class="line">|-句子结构</span><br><span class="line">  |-adj/adv替换: first,most,majority,unlikey</span><br><span class="line">  |-时间/地点/人物: 是这个时间/地点/人物吗？</span><br><span class="line">  |-动词: 动词是否发生？</span><br><span class="line">    |-首尾当定位，考点看中间</span><br><span class="line">    |-动词看完整，动宾短语带宾语一起看</span><br></pre></td></tr></table></figure></p>
<h2 id="配对题">配对题</h2>
<p>注意提示：<strong>NB You may use any letter more than once.</strong>
表示选项可能会复用，有NB不一定复选，没有NB一定不复选。</p>
<h3 id="分类细节匹配">分类/细节匹配</h3>
<p><strong>分类/细节匹配：填空题或判断题</strong><br />
<strong>1.先找定位词，题干和选项哪个词短，就用哪个当定位词</strong>。<br />
<strong>2.定位词在原文可能多次出现，首先找出第一次出现的highlight，其他出现的地方不一定是原词，可能是代词或缩略词</strong>。<br />
<strong>3.根据定位词找出定位句，理解并对比完整的定位句，找出至少2组关键词替换</strong>。</p>
<h3 id="人名观点配对">人名观点配对</h3>
<p><strong>人名搭配题：选项是人名</strong><br />
<strong>1.在文中找到人物第一次出现的位置（选项顺序）（第一次出现，有名有姓有工作单位）</strong>。<br />
<strong>2.找到观点句，注意答案出现的位置</strong>。<br />
<strong>3.理解观点句并比对观点句与题干，2组关键词同替（三级）</strong>。<br />
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 关键词</span></span><br><span class="line">sb believe/demonstrate宾语从句</span><br><span class="line">...<span class="keyword">for</span> sb</span><br><span class="line">according to A，B...</span><br><span class="line">he，she，they</span><br><span class="line">xxxxxxxx（Lexi，<span class="number">2023</span>）</span><br></pre></td></tr></table></figure></p>
<h3 id="句子句首配句尾">句子/句首配句尾</h3>
<p><strong>句子搭配题：给出句首，选项中找搭配的句尾</strong><br />
<strong>1.定位看题干，和填空题一样找关键词，顺序和原文一致（大部分为密集出现在1~2段，也有分散到全文的）</strong>。<br />
<strong>2.重点看逗号后的内容，主谓，逻辑一致</strong>。<br />
<strong>3.选项是乱序的，不能复选</strong>。</p>
<p>作业3：c16人物观点配对，单词。</p>
<h3 id="段落匹配">段落匹配</h3>
<p>考点：<br />
1.题干关键词（有用的功能词+事实信息）<br />
2.反向思维</p>
<p><strong>做题方法：</strong><br />
<strong>1.一次性看完所有题干，画出2-3组关键词（情感趋势+逻辑）</strong>。<br />
<strong>2.通读全文，刻意找所画关键词的同替</strong>。<br />
<strong>3.选出一道题就划掉题干和段落</strong>。</p>
<p><strong>必画的定位词：</strong><br />
<strong>1.复数可数名词、并列</strong><br />
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">different</span><br><span class="line">a variety of</span><br><span class="line">a <span class="built_in">list</span> of</span><br><span class="line">a <span class="built_in">range</span> of</span><br><span class="line">examples = such <span class="keyword">as</span></span><br><span class="line">an example = <span class="keyword">for</span> example</span><br><span class="line">reasons</span><br><span class="line">a reason</span><br></pre></td></tr></table></figure></p>
<p><strong>2.否定、比较/最高级、first等</strong><br />
<strong>3.age/data/proportion/percentage/statistics</strong><br />
<strong>4.a particular/specific/certain+n.</strong></p>
<h3 id="标题配对难">标题配对(难)</h3>
<p>1.先划掉例题，扫读所有选项，划<strong>关键词</strong>。<br />
2.读段落，找<strong>主题句</strong>，和关键词比对：<br />
<strong>（1）科普文：首2句、末1句，出现主题句。</strong><br />
<strong>（2）议论文：没有明显的主题句子。</strong></p>
<p>主题句特点：概括总结、设问句、举例之前、转折之后。<br />
主题句位置：首2句、最后1句、下一段首1句（承上this/such+名词）、段中（重点看转折强调，没有就一句句比较了）。<br />
特殊首1句肯定不是主题句：<br />
1.some people think that...<br />
2.There is a widespread belief that...</p>
<p>作业：C16 C17刷题-总结错题 复盘考点<br />
优先搞定P1 P2</p>
<h2 id="选择题">选择题</h2>
<p>做题顺序：<br />
1.首先凭借记忆排除一眼假选项：不符合文章主体思想、说的空洞。<br />
2.把剩下选项当成判断题去做，排除NG，排除F。<br />
3.在文中找到段落，比对定位句与选项。</p>
<p>作业：C17-C14总结错题，复盘考点，积累同意替换，第三篇文章涉及题目，局部精度</p>
<h3 id="细节题">细节题</h3>
<p>1.题干划细节定位词，看清楚【逻辑+修饰】<br />
2.定位句读完整，重点看【主干+逻辑】<br />
3.比对四个选项【两组同替/排除法】</p>
<h3 id="例证题">例证题</h3>
<p>题干中，出现某个具体例子/标志性单词，问举例目的（mention/refer
to）。<br />
重点看，支持作者观点/反驳别人观点（support/correct/valid），不要关注例子本身，要看作者观点。<br />
具体观点-&gt;例子前一句找同替（完整！！！）-&gt;不认识看例子本身末1句。</p>
<h3 id="指定段落观点">指定段落观点</h3>
<p>只有段落指明，没有细节定位词/例子<br />
段首1和2-&gt;末1和2-&gt;前面都没有，看段中转折/强调词后句子（must/only/情感趋势词）</p>
<h3 id="全篇主旨单选">全篇主旨单选</h3>
<p>文章大意+末段首末句+首段</p>
<h3 id="多选题难">多选题(难)</h3>
<p>分全文多选、段落多选，数量较少，2~4个。<br />
比如C15T1P2。</p>
<h2 id="平行阅读法">平行阅读法</h2>
<p><strong>针对P2配对题的做题方法：</strong><br />
<strong>步骤1：先看题型，遇到PM题每个题干都先画出关键词，遇到人物配对题到文章中画出人物首次出现的位置，遇到填空题只需画出第一个题关键词（因为是顺序的后面可以先不看）</strong>。<br />
<strong>步骤2:
从A段开始通读文章，遇到关键词或人名就去找对应问题，读一遍文章所有类型问题都做完</strong>。</p>
<p>平行阅读作业：<br />
剑雅17Test 1-Passage 2<br />
剑雅16Test 3-Passage 2</p>
<p>P1:填空+判断 定位 10-15min<br />
P2:配对（段落信息/人名/句子配对）+细节题（填空/判断） 通读文章
20-25min<br />
P3:标题配对+单选+summary填空 局部精读 25min</p>
<h2 id="基础补充">基础补充</h2>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">冠词：名词前的词。the、a、an。</span><br><span class="line">名词：代表名称的词。microphone。</span><br><span class="line">代词：代替名词的词。it、he、she、this、that。</span><br><span class="line">动词：代表动作的词。run、walk、jump。</span><br><span class="line">be动词：引出动作状态的词。<span class="keyword">is</span>、am、are、was、were。</span><br><span class="line">形容词：代表名词性质/状态的词。beautiful、happy、sad。</span><br><span class="line">副词：代表动词、形容词、其他副词性质/程度的词。fast、slow、well、badly。</span><br><span class="line">连词：连接词。<span class="keyword">and</span>、but、<span class="keyword">or</span>、so。</span><br><span class="line">感叹词：表示情感的词。oh、wow、oh my god。</span><br></pre></td></tr></table></figure>
<h2 id="参考网站">参考网站</h2>
<p><span class="exturl" data-url="aHR0cHM6Ly9pZWx0c2NhdC54ZGYuY24vcHJhY3RpY2UvcmVhZA==">https://ieltscat.xdf.cn/practice/read<i class="fa fa-external-link-alt"></i></span></p>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




  <nav class="pagination">
    <span class="page-number current">1</span><a class="page-number" href="/page/2/">2</a><span class="space">&hellip;</span><a class="page-number" href="/page/13/">13</a><a class="extend next" rel="next" title="下一页" aria-label="下一页" href="/page/2/"><i class="fa fa-angle-right"></i></a>
  </nav>

</div>
  </main>

  <footer class="footer">
    <div class="footer-inner">

  <div class="copyright">
    &copy; 2019 – 
    <span itemprop="copyrightYear">2024</span>
    <span class="with-love">
      <i class="fa fa-heart"></i>
    </span>
    <span class="author" itemprop="copyrightHolder">SoundMemories</span>
  </div>
  <div class="powered-by">由 <span class="exturl" data-url="aHR0cHM6Ly9oZXhvLmlv">Hexo</span> & <span class="exturl" data-url="aHR0cHM6Ly90aGVtZS1uZXh0LmpzLm9yZy9tdXNlLw==">NexT.Muse</span> 强力驱动
  </div>

    </div>
  </footer>

  
  <div class="toggle sidebar-toggle" role="button">
    <span class="toggle-line"></span>
    <span class="toggle-line"></span>
    <span class="toggle-line"></span>
  </div>
  <div class="sidebar-dimmer"></div>
  <div class="back-to-top" role="button" aria-label="返回顶部">
    <i class="fa fa-arrow-up fa-lg"></i>
    <span>0%</span>
  </div>
  <a role="button" class="book-mark-link book-mark-link-fixed"></a>

<noscript>
  <div class="noscript-warning">Theme NexT works best with JavaScript enabled</div>
</noscript>


  
  <script src="https://cdnjs.cloudflare.com/ajax/libs/animejs/3.2.1/anime.min.js" integrity="sha256-XL2inqUJaslATFnHdJOi9GfQ60on8Wx1C2H8DYiN1xY=" crossorigin="anonymous"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/next-theme-pjax/0.6.0/pjax.min.js" integrity="sha256-vxLn1tSKWD4dqbMRyv940UYw4sXgMtYcK6reefzZrao=" crossorigin="anonymous"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.7.0/jquery.min.js" integrity="sha256-2Pmvv0kuTBOenSvLm6bvfBSSHrUJ+3A7x6P5Ebd07/g=" crossorigin="anonymous"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/fancybox/3.5.7/jquery.fancybox.min.js" integrity="sha256-yt2kYMy0w8AbtF89WXb2P1rfjcP/HTHLT7097U8Y5b8=" crossorigin="anonymous"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/medium-zoom/1.0.8/medium-zoom.min.js" integrity="sha256-7PhEpEWEW0XXQ0k6kQrPKwuoIomz8R8IYyuU1Qew4P8=" crossorigin="anonymous"></script>
<script src="/js/comments.js"></script><script src="/js/utils.js"></script><script src="/js/motion.js"></script><script src="/js/schemes/muse.js"></script><script src="/js/next-boot.js"></script><script src="/js/bookmark.js"></script><script src="/js/pjax.js"></script>

  <script src="https://cdnjs.cloudflare.com/ajax/libs/hexo-generator-searchdb/1.4.1/search.js" integrity="sha256-1kfA5uHPf65M5cphT2dvymhkuyHPQp5A53EGZOnOLmc=" crossorigin="anonymous"></script>
<script src="/js/third-party/search/local-search.js"></script>

  <script class="next-config" data-name="pdf" type="application/json">{"object_url":{"url":"https://cdnjs.cloudflare.com/ajax/libs/pdfobject/2.2.12/pdfobject.min.js","integrity":"sha256-g2xji1rlE3KsGVClvuxTbcR0Kn2+wtQADSff2Tbb4zA="},"url":"/lib/pdf/web/viewer.html"}</script>
  <script src="/js/third-party/tags/pdf.js"></script>

  <script class="next-config" data-name="mermaid" type="application/json">{"enable":true,"theme":{"light":"neutral","dark":"neutral"},"js":{"url":"https://cdnjs.cloudflare.com/ajax/libs/mermaid/10.2.3/mermaid.min.js","integrity":"sha256-JFptYy4KzJ5OQP+Q9fubNf3cxpPPmZKqUOovyEONKrQ="}}</script>
  <script src="/js/third-party/tags/mermaid.js"></script>


  <script src="/js/third-party/fancybox.js"></script>



  




  

  <script class="next-config" data-name="enableMath" type="application/json">true</script><script class="next-config" data-name="mathjax" type="application/json">{"enable":true,"tags":"none","js":{"url":"https://cdnjs.cloudflare.com/ajax/libs/mathjax/3.2.2/es5/tex-mml-chtml.js","integrity":"sha256-MASABpB4tYktI2Oitl4t+78w/lyA+D7b/s9GEP0JOGI="}}</script>
<script src="/js/third-party/math/mathjax.js"></script>


  <script src="https://cdnjs.cloudflare.com/ajax/libs/quicklink/2.3.0/quicklink.umd.js" integrity="sha256-yvJQOINiH9fWemHn0vCA5lsHWJaHs6/ZmO+1Ft04SvM=" crossorigin="anonymous"></script>
  <script class="next-config" data-name="quicklink" type="application/json">{"enable":true,"home":true,"archive":true,"delay":true,"timeout":3000,"priority":true,"url":"https://soundmemories.github.io/"}</script>
  <script src="/js/third-party/quicklink.js"></script>

</body>
</html>
